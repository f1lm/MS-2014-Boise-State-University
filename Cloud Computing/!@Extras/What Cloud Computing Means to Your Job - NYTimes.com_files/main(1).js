define("shared/page/helpers/page-mixin",["jquery/nyt"],function(e){var t={handleSwipe:function(e){this.broadcast("nyt:app-swipe",e,e.gesture.direction)},handleSwipeStartEnd:function(e){var t="swipestart"===e.type?"start":"end";this.broadcast("nyt:app-swipe",e,t)},handleDrag:function(t){!t||e(t.srcElement).closest(".slideshow").length>0||this.broadcast("nyt:app-drag",t,t.gesture.direction)},handleDragStartEnd:function(t){var i="dragstart"===t.type?"start":"end";!t||e(t.srcElement).closest(".slideshow").length>0||this.broadcast("nyt:app-drag",t,i)},truncateCaptionText:function(){var t=this;this.$el.find("figure").each(function(){var i,n,s=88,a=e(this);a.hasClass("layout-small-vertical")||a.hasClass("layout-small-horizontal")||a.hasClass("has-adjacency layout-large-horizontal")?(n=a.find(".caption-text"),n>=1&&n.html().indexOf("<")<0&&t.truncateText(n,s,!0)):a.hasClass("layout-large-horizontal")?(i=a.find("img").height()-s,n=a.find(".caption-text"),n>=1&&n.html().indexOf("<")<0&&t.truncateText(n,i,!0)):a.hasClass("photo")&&a.hasClass("inline")&&(n=a.find(".caption-text"),n>=1&&n.html().indexOf("<")<0&&t.truncateText(n,s,!0))})}};return t}),define("blogs/views/blogs",["underscore/nyt","jquery/nyt","foundation/views/base-view","shared/page/helpers/page-mixin"],function(e,t,i,n){var s=i.extend(n).extend({el:"#main",events:{dragleft:"handleDrag",dragright:"handleDrag",dragstart:"handleDragStartEnd",dragend:"handleDragStartEnd","click .nyt-dynamic-url":"swapHref"},swapHref:function(e){e.preventDefault();var i=t(e.currentTarget);return window.history&&window.history.pushState?window.history.pushState(null,null,i.data("url")):window.location.href=i.data("url"),!1}});return s}),define("blogs/instances/blogs",["blogs/views/blogs"],function(e){new e}),define("shared/modal/templates",["underscore/nyt"],function(_){var templates={};return templates.modal=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="overlay"></div>\n<div class="modal '+(null==(__t=id)?"":__t)+" "+(null==(__t=addlClasses)?"":__t)+'" style="'+(null==(__t=modalStyles)?"":__t)+'" role="dialog" aria-labelledby="'+(null==(__t=id)?"":__t)+'-modal-heading" tabindex="-1">\n<div class="modal-header">\n<h3 class="modal-heading" id="'+(null==(__t=id)?"":__t)+'-modal-heading">'+(null==(__t=modalTitle)?"":__t)+"</h3>\n"+(null==(__t=headerContent)?"":__t)+'\n</div>\n<div class="modal-content">\n'+(null==(__t=modalContent)?"":__t)+'\n</div>\n<button type="button" class="modal-close '+(null==(__t=closeClass)?"":__t)+'" aria-disabled="false"><i class="icon"></i><span class="visually-hidden">Close this modal window</span></button>\n<div class="modal-pointer '+(null==(__t="modal-pointer-"+tailDirection)?"":__t)+'"><div class="modal-pointer-conceal"></div></div>\n</div>';return __p},templates}),define("shared/modal/views/modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/templates"],function(e,t,i,n){var s=i.registerView("modal").extend({template:n.modal,className:"modal-container",events:{"click .modal-close, .modal-pointer, .dismiss-button":"close","mouseenter .modal":"handleMouseOutClose"},defaultSettings:{id:"default-modal",modalTitle:"",headerContent:"",modalContent:"",addlClasses:"",binding:"",disableBindings:!1,tailDirection:"down",tailTopOffset:0,tailLeftOffset:0,fixedOverride:!1,hasOverlay:!1,hasCloseButton:!1,canOpenOnHover:!1,closeOnMouseOut:!1,mouseOutDelay:0,mouseEnterDelay:0,closeOnClick:!0,autoPosition:!1,positionTailSide:!1,toggleSpeed:300,focusOnShow:!0},initialize:function(e){t.bindAll(this,"close","open","mouseEnterOpen","mouseOutClose","handleClickClose","removeFromPage"),this.settings=t.extend({},this.defaultSettings,e),this.settings.modalStyles="width: "+e.width+";",this.render()},render:function(){var e=this.settings.id+"-container";return this.settings.closeClass=this.settings.hasCloseButton?"":"hidden",this.$el.hide().addClass(e).html(this.template(this.settings)),this.$modal=this.$el.find(".modal"),this.$el.find(".overlay").toggle(this.settings.hasOverlay),this},addToPage:function(e,t){var i="string"==typeof e?this.$body.find(e):this.$body;return t="function"==typeof i[t]?t:"append",i[t](this.$el),""===this.settings.binding||this.settings.disableBindings||(this.$body.on("click",this.settings.binding,this.open),this.settings.canOpenOnHover&&(this.$body.on("mouseenter",this.settings.binding,this.mouseEnterOpen),this.$body.on("mouseleave",this.settings.binding,this.mouseOutClose))),this},removeFromPage:function(){return this.close(),this.$el.remove(),""===this.settings.binding||this.settings.disableBindings||(this.$body.off("click",this.settings.binding,this.open),this.settings.canOpenOnHover&&(this.$body.off("mouseenter",this.settings.binding,this.mouseEnterOpen),this.$body.off("mouseleave",this.settings.binding,this.mouseOutClose))),this.remove()},updateTemplate:function(e){return this.$modal.find(".modal-content").html(e),this.positionDialog(!1),this},open:function(t){var i=this;return t?(t.returnValue=!1,t.preventDefault(),this.$target=e(t.currentTarget)):this.$target=e(this.settings.binding).eq(0),this.$el.fadeIn(this.settings.toggleSpeed,function(){i.broadcast("nyt:modal-show"),i.broadcast("nyt:modal-show-"+i.settings.id)}),this.settings.autoPosition?this.autoPosition():this.positionDialog(!0),(this.settings.openCallback||e.noop).call(this),this.subscribe("nyt:page-resize",this.positionDialog),this.subscribeOnce("nyt:page-key-esc",this.close),this.$body.on("click",this.handleClickClose),this.pageManager.isMobile()&&this.$body.css("cursor","pointer"),this.settings.focusOnShow&&this.$modal.focus(),this},mouseEnterOpen:function(e){window.clearTimeout(this.mouseLeaveTimeout),this.mouseEnterTimeout=t.delay(this.open,this.settings.mouseEnterDelay,e)},close:function(t){var i=this;return t&&t.currentTarget&&this.settings.disableBindings&&e(t.currentTarget).hasClass("modal-pointer")?this:(this.$el.fadeOut(this.settings.toggleSpeed,function(){(i.settings.closeCallback||e.noop).call(i),i.broadcast("nyt:modal-hide"),i.broadcast("nyt:modal-hide-"+i.settings.id)}),this.stopSubscribing("nyt:page-resize",this.positionDialog),this.$body.off("click",this.handleClickClose),window.clearTimeout(this.mouseEnterTimeout),this.pageManager.isMobile()&&this.$body.css("cursor",""),this)},mouseOutClose:function(t){var i=e(t.relatedTarget);i.is(this.$.target)||this.$modal.has(i).length>0||(window.clearTimeout(this.mouseEnterTimeout),this.$modal.is(":visible")&&(this.mouseLeaveTimeout=window.setTimeout(this.close,this.settings.mouseOutDelay)))},handleMouseOutClose:function(){this.settings.closeOnMouseOut&&this.$modal.on("mouseleave",this.close)},handleClickClose:function(e){this.settings.closeOnClick&&0===this.$modal.has(e.target).length&&this.$modal[0]!==e.target&&this.close()},positionDialog:function(t){var i,n,s,a,o,r=this.pageManager.getViewport(),l=this.$target,d=this.$modal,c="absolute",h=d.outerHeight(),u=d.outerWidth(),m={marginLeft:"0",marginTop:"0",top:"",left:""};switch(l&&l.length>0&&(a=l.outerHeight(),o=l.outerWidth(),n=l.offset().top+this.settings.tailTopOffset,s=l.offset().left+this.settings.tailLeftOffset),this.settings.tailDirection){case"up":m.top=n+a+14,m.left=s+Math.floor(.5*o)-Math.floor(.5*u)-9;break;case"up-right":m.top=n+a+14,m.left=s+Math.floor(.5*o)-(u-25);break;case"up-left":m.top=n+a+14,m.left=s+Math.floor(.5*o)-25;break;case"down":m.top=n-h-15,m.left=s+Math.floor(.5*o)-Math.floor(.5*u)-8;break;case"down-right":m.top=n-h-15,m.left=s+Math.floor(.5*o)-(u-25);break;case"down-left":m.top=n-h-15,m.left=s+Math.floor(.5*o)-25;break;case"left":m.top=n+Math.floor(.5*a)-Math.floor(.5*h)+5,m.left=s+o+15;break;case"left-bottom":m.top=n+Math.floor(.5*a)-(h-25),m.left=s+o+15;break;case"left-top":m.top=n+Math.floor(.5*a)-25,m.left=s+o+15;break;case"right":m.top=n+Math.floor(.5*a)-Math.floor(.5*h)+5,m.left=s-u-16;break;case"right-bottom":m.top=n+Math.floor(.5*a)-(h-25),m.left=s-u-16;break;case"right-top":m.top=n+Math.floor(.5*a)-25,m.left=s-u-16;break;case"centered":i=r.height,m.top=h>i?r.top+5:Math.floor(.5*(i-h))+r.top,m.left=Math.floor(.5*r.width-.5*u);break;case"fixed":default:c="fixed",u=this.settings.width||d.width(),h=this.settings.height||d.height(),m.top="50%",m.left="50%",m.marginLeft=-Math.floor(.5*u)+this.settings.tailLeftOffset+"px",m.marginTop=-Math.floor(.5*h)+this.settings.tailTopOffset+"px"}return l&&"fixed"===l.css("position")||this.settings.fixedOverride?(c="fixed",m.top-=r.top,this.$el.css("position","fixed")):this.$el.css("position",""),m.top+=e.isNumeric(m.top)?"px":"",m.left+=e.isNumeric(m.left)?"px":"",d.css("position",c),t===!0?d.css(m):d.stop().animate(m,"fast"),this},autoPosition:function(){var e,t,i,n=this.pageManager.getViewport(),s=this.$modal.outerHeight(),a=this.$modal.outerWidth();return this.settings.positionTailSide&&(i=this.$target.offset().left>n.width/2,this.settings.tailDirection=i?"right":"left"),this.positionDialog(!0),e=this.$target.offset(),this.settings.positionTailSide?(t=this.settings.tailDirection,e.top-n.top-.5*s<0?t+="-top":e.top-n.top+.5*s>n.height&&s-40<e.top-n.top&&(t+="-bottom")):(t=e.top-s<0?"up":"down",e.left+a>n.width?t+="-right":e.left<0&&(t+="-left")),this.$modal.find(".modal-pointer").attr("class","modal-pointer modal-pointer-"+t),this.settings.tailDirection=t,this.positionDialog(!0),this}});return s}),define("shared/account/templates",["underscore/nyt"],function(_){var templates={};return templates.logInModal=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="login-form-control form-control">\n<form id="login-form" class="login-form" role="form">\n<fieldset>\n<legend>Log in</legend>\n<h6 class="legend-sub-heading form-hint">Don\'t have an account? <a href="javascript:;" class="registration-modal-trigger">Register now</a></h6>\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="login-email" id="login-email-label">Email address</label>\n</div>\n<div class="field-container">\n<input type="text" id="login-email" name="login-email" class="text login-email" placeholder="Email address" aria-labelledby="login-email-label" aria-required="true" />\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-email-description"><i class="icon"></i><span class="visually-hidden" id="clear-email-description">Clear this text input</span></button>\n</div>\n</div><!-- close control -->\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="login-password" id="login-password-label">Password</label>\n</div>\n<div class="field-container">\n<input type="password" id="login-password" name="login-password" class="text login-password" placeholder="Password" data-type="password" aria-labelledby="login-password-label" aria-required="true" />\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-password-description"><i class="icon"></i><span class="visually-hidden" id="clear-password-description">Clear this text input</span></button>\n</div>\n</div><!-- close control -->\n<div class="control layout-horizontal">\n<div class="control checkbox-control">\n<div class="field-container">\n<input type="checkbox" id="login-remember" name="login-remember" class="checkbox login-remember" checked="checked" aria-labelledby="login-remember-label" aria-checked="true" />\n</div>\n<div class="label-container">\n<label for="login-remember" class="checkbox-label" id="login-remember-label">Remember me</label>\n</div>\n</div>\n<p class="form-hint password-hint">\n<a href="'+(null==(__t=hosts.www)?"":__t)+'/forgot">Forgot password?</a>\n</p>\n</div><!-- close control -->\n<div class="control last-control">\n<button id="login-send-button" class="button login-button" >Log in</button>\n</div>\n</fieldset>\n</form>\n</div><!-- close registration-form-control -->';return __p},templates.registrationModal=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="registration-form-control form-control">\n<form id="registration-form" class="registration-form" role="form">\n<fieldset>\n<legend>Register</legend>\n<h6 class="legend-sub-heading form-hint">Already have an account? <a href="javascript:;" class="login-modal-trigger">Log in</a></h6>\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="register-email" id="register-email-label">Email address</label>\n</div>\n<div class="field-container">\n<input type="email" id="register-email" name="register-email" class="text register-email" placeholder="Email address" aria-labelledby="register-email-label" aria-required="true" />\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-email-description"><i class="icon"></i><span class="visually-hidden" id="clear-email-description">Clear this text input</span></button>\n</div>\n</div><!-- close control -->\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="register-password" id="register-password-label">Password</label>\n</div>\n<div class="field-container">\n<input type="password" id="register-password" name="register-password" class="text register-password" placeholder="Password" data-type="password" aria-labelledby="register-password-label" aria-required="true" />\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-password-description"><i class="icon"></i><span class="visually-hidden" id="clear-password-description">Clear this text input</span></button>\n</div>\n</div><!-- close control -->\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="retype-password" id="retype-password-label">Retype Password</label>\n</div>\n<div class="field-container">\n<input type="password" id="retype-password" name="retype-password" class="text retype-password" placeholder="Retype Password" data-type="password" aria-labelledby="retype-password-label" aria-required="true" />\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-retyped-password-description"><i class="icon"></i><span class="visually-hidden" id="clear-retyped-password-description">Clear this text input</span></button>\n</div>\n</div><!-- close control -->\n<div class="control layout-horizontal">\n<div class="control checkbox-control">\n<div class="field-container">\n<input type="checkbox" id="receive-offers" name="receive-offers" class="checkbox receive-offers" checked="checked" aria-labelledby="receive-offers-label" aria-checked="true" />\n</div>\n<div class="label-container">\n<label for="receive-offers" class="checkbox-label" id="receive-offers-label">Receive occasional email updates and special offers for New York Times products and services.</label>\n</div>\n</div>\n</div><!-- close control -->\n<div class="control last-control">\n<button id="register-send-button" class="button register-button">Create Account</button>\n</div>\n</fieldset>\n</form>\n</div><!-- close registration-form-control -->\n<div class="modal-footer">\n<p class="disclaimer"><a href="http://www.nytimes.com/content/help/rights/terms/terms-of-service.html">Terms of Service</a> <a href="http://www.nytimes.com/content/help/rights/privacy/policy/privacy-policy.html">Privacy Policy</a></p>\n</div>';return __p},templates}),define("shared/account/helpers/account-modal-mixin",["jquery/nyt","underscore/nyt","foundation/lib/polyfills/placeholder"],function(e,t,i){var n={handleDefaultSubmit:function(e){e.preventDefault()},handleKeyUp:function(t){var i=e(t.target);i.parent().find(".clear-button").toggle(""!==i.val())},handleClearButton:function(t){var n=e(t.currentTarget),s=n.parent().find("input");n.toggle(!1),s.val(""),i()}};return n}),define("shared/account/views/login-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/models/user-data","shared/modal/views/modal","shared/account/templates","foundation/lib/auth/userauth","foundation/hosts","shared/account/helpers/account-modal-mixin","foundation/lib/polyfills/placeholder"],function(e,t,i,n,s,a,o,r,l,d){var c=i.extend(t.extend({},l,{events:{"click .registration-modal-trigger":"handleRegisterClick","click #login-send-button":"handleLogInButton","submit #login-form":"handleDefaultSubmit","click .clear-button":"handleClearButton","keyup .text":"handleKeyUp"},nytEvents:{"nyt:loginmodal-open":"handleOpen"},defaultSettings:{id:"login-modal",addlClasses:"account-modal",modalContent:a.logInModal({hosts:r}),binding:".login-modal-trigger",tailDirection:"fixed",hasCloseButton:!0,hasOverlay:!0,tailLeftOffset:-40,tailTopOffset:-40},initialize:function(e){var i=this;this.modalSettings=t.extend({},this.defaultSettings,e),this.modalSettings.openCallback=function(){var e=i.modalTitle||this.$target.data("modal-title")||"Log in";i.hasPlaceholderSupport&&this.$modal.find(".login-email").focus(),this.$modal.find("legend").text(e),this.$modal.find(".field-container input").val(""),i.modalTitle=null},this.subscribe("nyt:modal-show-login-modal",d)},handleDomReady:function(){this.render()},render:function(){this.logInModal=new s(this.modalSettings).addToPage(),this.setElement(this.logInModal.$modal),this.local(this,"nyt:modal-login-modal-rendered")},handleOpen:function(e){e&&e.modalTitle&&(this.modalTitle=e.modalTitle),this.logInModal&&this.logInModal.open()},handleUserReady:function(){n.isLoggedIn()&&(this.logInModal?(this.logInModal.removeFromPage(),this.remove()):this.subscribeOnce(this,"nyt:modal-login-modal-rendered",this.handleUserReady))},handleRegisterClick:function(){this.logInModal.close(),this.trackingTrigger("loginmodal-register-click",{module:"Registration",action:"Click","WT.z_ract":"Regnow"})},handleLogInButton:function(){this.executeLogin()},executeLogin:function(){o.login({user:this.$el.find(".login-email").val(),password:this.$el.find(".login-password").val(),remember:this.$el.find(".login-remember").is(":checked")})}}));return c}),define("shared/account/views/registration-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","shared/account/templates","foundation/lib/auth/userauth","shared/account/helpers/account-modal-mixin","foundation/lib/polyfills/placeholder"],function(e,t,i,n,s,a,o,r){var l=i.extend(t.extend({},o,{events:{"click .login-modal-trigger":"handleLoginClick","click #register-send-button":"handleRegistrationButton","submit #registration-form":"handleDefaultSubmit","click .clear-button":"handleClearButton","keyup .text":"handleKeyUp"},defaultSettings:{id:"registration-modal",addlClasses:"account-modal",modalContent:s.registrationModal(),binding:".registration-modal-trigger",tailDirection:"fixed",hasCloseButton:!0,hasOverlay:!0,tailLeftOffset:-40,tailTopOffset:-40},initialize:function(e){var i=this;this.modalSettings=t.extend({},this.defaultSettings,e),this.modalSettings.openCallback=function(){var e=this.$target.data("modal-title")||"Register";i.hasPlaceholderSupport&&this.$modal.find(".register-email").focus(),this.$modal.find("legend").text(e),this.$modal.find(".field-container input").val("")},this.subscribe("nyt:modal-show-registration-modal",r)},handleDomReady:function(){this.render()},render:function(){this.registrationModal=new n(this.modalSettings).addToPage(),this.setElement(this.registrationModal.$modal)},handleLoginClick:function(){this.registrationModal.close()},handleRegistrationButton:function(){this.executeRegistration()},executeRegistration:function(){a.register({email:this.$el.find(".register-email").val(),password:this.$el.find(".register-password").val(),confPassword:this.$el.find(".retype-password").val(),specialOffers:this.$el.find(".receive-offers").is(":checked")})}}));return l}),define("shared/account/instances/account",["shared/account/views/login-modal","shared/account/views/registration-modal","foundation/models/user-data"],function(e,t,i){i.isLoggedIn()||(new e,new t)}),require(["jquery/nyt"],function(e){e(document).ready(function(){e(".toggleContent").on("click",".showContent",function(){e(this).hide().parents(".toggleContent").find(".hiddenContent").slideDown("fast")}),e(".entry-content").on("click",".toggle-more-link",function(){e(this).hide().parents(".entry-content").find(".toggle-content").slideDown("fast").removeClass("hidden")})})}),define("blogs/legacy/video-poster",["jquery/nyt"],function(e){function t(){e(".a-column, #a-col").on("click",".youtubeVideo .thumb",function(){var t=e(this).parent(".youtubeVideo"),i=t.data("youtube-id"),n=t.data("start");""!==n&&(n="&start="+n);var s=['<iframe src="//www.youtube.com/embed/',i,"?autoplay=1&wmode=transparent",n,'" frameborder="0" allowfullscreen></iframe>'].join("");t.html(s)})}e(document).ready(t)}),define("shared/ad/models/ad",["backbone/nyt"],function(e){var t=e.Model.extend({});return t}),define("shared/ad/collections/ads",["backbone/nyt","underscore/nyt","foundation/collections/base-collection","foundation/hosts","shared/ad/models/ad"],function(e,t,i,n,s){var a=i.extend({deliveryProofParams:["adxforce","debug"],adForceLookup:{leaderboard:"728x90testnyt5",billboard:"970x90horiztest",pushdown:"testnyt5pushdown",halfpage:"mediamindhalfexptest",xxl:"nyt5xxltestpickletag",bigad:"middlerighttest"},initialize:function(e,i){return i?(this.options=i,t.isUndefined(this.pageManager.getMeta("adxPage"))?this.host=this.pageManager.getUrlParam("adx_campaign")||i.adx_campaign||"www.nytimes.com":(this.host="",this.options.page=this.pageManager.getMeta("adxPage")),this.interstitial=i.interstitial?1:0,void this.setPageParameter()):!1},setPageParameter:function(){var e;this.options.page||(e=location.pathname,e=e.replace(/\d{4}/,"yr").replace(/\d{2}/,"mo").replace(/\d{2}/,"day"),this.options.page=this.host+e)},model:s,url:n.adx+"/adx/bin/adxrun.html",sync:function(i,n,s){var a=this,o=["nyt5"];return s.dataType="jsonp",s.jsonp="jsonp",s.data={page:a.options.page,positions:a.options.positions.join(","),autoconfirm:a.options.autoconfirm||0,v:3,cpp:1,attributes:"nyt5",interstitials:this.interstitial},this.options.cpp===!1&&(delete s.data.interstitials,delete s.data.cpp),s.data=a.assignDeliveryProofParams(s.data),"undefined"!=typeof this.pageManager.getUrlParam("hp")&&o.push("hp"),"undefined"!=typeof this.pageManager.getUrlParam("src")&&o.push("src-"+this.pageManager.getUrlParam("src")),"undefined"!=typeof a.options.keywords&&(o=t.union(o,a.chainKeywords(a.options.keywords))),s.data.keywords=t.filter(o,function(e){return!("undefined"==typeof e||""===e)}).join(","),e.sync(i,n,s)},assignDeliveryProofParams:function(e){for(var i,n={},s=this.deliveryProofParams.length-1;s>=0;s-=1)i=this.pageManager.getUrlParam(this.deliveryProofParams[s]),"undefined"!=typeof i&&(n[this.deliveryProofParams[s]]=i||"1");return t.extend(e,n)},chainKeywords:function(e){var t,i,n=e.length,s=[],a=this;for(t=0;n>t;t+=1)i=a.adForceLookup[e[t]],s.push(i||e[t]);return"1"===this.pageManager.getUrlParam("rico")&&s.push(this.pageManager.getUrlParam("keywords")),s},parse:function(e){var i=e.ads;return i=t.map(i,function(e,t){var i=e.isInlineSafe;return e.name=t,e.isInlineSafe="Y"===i||"true"===i,e}),"undefined"!=typeof this.pageManager.getUrlParam("debug")&&(window.adx_debug_output=e,console.log("adx debug page: ",this.options.page),console.log("adx debug positions: ",this.options.positions.join(",")),console.log("adx debug output: ",e),console.log("adx debug keywords: ",this.chainKeywords(this.options.keywords).join(","))),i},getConfirmPixel:function(){return this.confirmPixel?this.confirmPixel.creative:void 0}});return a}),define("shared/ad/templates",["underscore/nyt"],function(_){var templates={};return templates.iFrameStyleSheet=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<style type="text/css">\nbody {\nmargin: 0;\noverflow: hidden;\n}a img {\nborder: none;\n}\n</style>';return __p},templates.interstitialModal=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div id="Interstitial" class="ad interstitial-ad"></div><p class="user-action dismiss-button">Continue &raquo;</p>';return __p},templates.ribbonInterstitial=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="ribbon-interstitial-ad-overlay">\n<h4 class="ad-heading"> Advertisement </h4>\n<div id="RibbonInterstitial" class="ad ribbon-interstitial-ad"> </div>\n</div>';return __p},templates}),define("shared/ad/views/ads",["underscore/nyt","jquery/nyt","foundation/views/base-view","foundation/views/ad-view-manager","shared/ad/collections/ads","shared/ad/templates","shared/modal/views/modal"],function(e,t,i,n,s,a,o){var r=i.registerView("ads").extend({el:".ad",template:a,pushdownWidth:"970",billboardHeight:"90",navBreakPoint:10040,positions:null,blocking:!1,adShown:{},initialize:function(t){e.bindAll(this,"completeInterstitial","renderAd"),this.options=t||this.options||{},this.positions=[],this.preInitialize(),this.local(this,"nyt:ads-pre-initialize"),this.detectTragedy(),this.setAdParametersOnOptions(),this.scope=this.options.scope||this.scope,this.confirm=!0,this.ads=new s([],this.options),this.subscribe(this.ads,"sync",this.receiveAds),this.secondaryIframeClass="frame-for-"+this.scope,this.listenTo(this.pageManager,"nyt:page-breakpoint",this.responsive),this.postInitialize(),this.local(this,"nyt:ads-post-initialize"),this.subscribe("nyt:ads-new-placement",this.handleRemoteAdRequest),this.subscribe("nyt:ads-fire-ribbon-interstitial",this.fireRibbonInterstitial),this.subscribe("nyt:slideshow-ad",this.fireSlideShowAd),this.addAmazonKeywords?this.getAmazonAds():this.requestAds()},getAmazonAds:function(){window.amznads={updateAds:function(t){window.amazonAdData=t.ads,window.amazonAdSlots=e.keys(window.amazonAdData)},renderAd:function(e,t){var i,n;window.amazonAdData&&window.amazonAdData[t]?(e.write(window.amazonAdData[t]),e.close()):(i={c:"dtb",src:"3030",kvmismatch:1,pubReturnedKey:t,aaxReturnedKeys:window.amazonAdSlots,cb:Math.round(1e7*Math.random()),u:window.encodeURIComponent(window.location.host+window.location.pathname),ua:encodeURIComponent(window.navigator.userAgent)},n=window.encodeURIComponent(JSON.stringify(i)),e.write('<img src="//aax.amazon-adsystem.com/x/px/p/0/'+n+'"/>'),e.close())}},this.getAmazonKeywordsAndRequestAds()},getAmazonKeywordsAndRequestAds:function(){var e=this,i="3030",n=encodeURIComponent(document.location);try{n=encodeURIComponent(""+window.top.location)}catch(s){}t.ajax({url:"//aax.amazon-adsystem.com/e/dtb/bid?src="+i+"&u="+n+"&cb="+Math.round(1e7*Math.random()),dataType:"script"}).done(function(){e.addAmazonKeywords()}).always(function(){e.requestAds()})},preInitialize:t.noop,postInitialize:t.noop,responsive:t.noop,setHtmlClasses:t.noop,requestAds:function(){this.options.response?(this.ads.reset(this.ads.parse(this.options.response)),this.ads.trigger("sync")):this.ads.fetch()},receiveAds:function(){this.hasInterstitial()||this.checkAds()},resizeTopAd:e.debounce(function(){var e=this.ads.findWhere({name:"TopAd"});if(e){var i=e.get("height");i&&90>i&&t("#TopAd").css("min-height",parseInt(i,10))}},1e3),checkAds:function(){var i,n,s,a,o,r=this;for(this.removeAds(),i=this.getReturnedAdNames(this.pageManager.isDomReady()),this.pageManager.isDomReady()||this.subscribe("nyt:page-ready",function(){r.getReturnedAdNames(!0)}),i&&i.length>0&&(this.pageManager.getMeta("ads_adNames")||this.pageManager.setMeta("ads_adNames",this.returnAdNames())),e.indexOf(i,"TopAd")<0?(o=t("#TopAd"),0===o.length&&o.addClass("hidden")):r.resizeTopAd(),a=this.getPositions(),n=0,s=a.length;s>n;n+=1)t("#"+a[n]).toggleClass("hidden",r.isAdUnavailable(i,a[n]));e.indexOf(this.options.positions,"Middle1C")>=0&&!this.ads.findWhere({name:"Middle1C"})&&t("#TopNavAd, .search-flyout-panel .ad").addClass("hidden"),e.defer(function(){r.broadcast("nyt:ads-rendered",r)}),r.setHtmlClasses(),e.delay(function(){r.loadGoogleAdScript()},1200)},loadGoogleAdScript:function(){if(0!==t("#SponLink, #SponLinkA, #HPSponLink").length&&!this.pageManager.getMeta("googleAdScriptInjected")){var e="script",i=document.createElement(e),n=document.getElementsByTagName(e)[0];i.src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",n.parentNode.insertBefore(i,n),this.pageManager.setMeta("googleAdScriptInjected","true")}},renderAd:function(e){e.page=e.page||this.ads.options.page,e.frameStyle=e.frameStyle||this.template.iFrameStyleSheet(),e.secondaryIframeClass=e.secondaryIframeClass||this.secondaryIframeClass,n.render(e)},renderAdByPositionName:function(i,n){var s=t("#"+i);return n||(n=this.ads.where({name:i})[0]),s.length&&n||"ADX_CLIENTSIDE"===i?(this.isCreativeBlank(n)||s.removeClass("hidden"),e.defer(this.renderAd,{model:n,el:s}),!0):!1},handleRemoteAdRequest:function(e){this.ads.length>0&&this.renderAdByPositionName(e)},getPositions:function(){return this.options.positions},detectTragedy:function(){var e=this.pageManager.getMeta("ad_sensitivity");e&&(this.options.page="www.nytimes.com/"+e)},returnAdNames:function(){return this.ads.pluck("name")},cleanHtmlClasses:function(){this.htmlClasses&&this.$html.removeClass(e.values(this.htmlClasses).join(" "))},isDirectlySold:function(e){var t=this.ads.where({name:e})[0].attributes.isDirectlySold;return"true"===t},returnAdParametersObject:function(){var t=this.pageManager.getUrlParam("ad-keywords"),i=this.pageManager.getUrlParam("ad-positions");return{keywords:e.isString(t)?[t]:t,positions:e.isString(i)?[i]:i}},setAdParametersOnOptions:function(){var t=this.returnAdParametersObject();this.options.keywords=e.union(this.options.keywords,t.keywords),t.positions&&(this.options.positions=t.positions)},isPlaceholderInViewport:function(e){var i;return!e||e&&0===e.length?!1:(i=e.get(0).getBoundingClientRect(),i.top+e.height()>=0&&i.left+e.width()>=0&&i.bottom-e.height()<=t(window).height()&&i.right-e.width()<=t(window).width())},isCreativeBlank:function(e){var t=e.get("classification");return"blank"===t||"blank-but-count-imps"===t},handleApplicationAd:function(e){var t,i;return t=e.get("name"),i=this.renderAdByPositionName(t,e)},getReturnedAdNames:function(e){var t=this,i=[];return e="undefined"!=typeof e?e:!1,this.ads.length>0&&this.ads.each(function(n){e?t.handleApplicationAd(n)?i.push(n.get("name")):t.confirm=!1:i.push(n.get("name"))}),i},isAdUnavailable:function(t,i){return e.indexOf(t,i)<0||this.isCreativeBlank(this.ads.where({name:i})[0])},removeAds:function(){t("."+this.secondaryIframeClass).remove()},isHalfPage:function(e,t){return 300===parseInt(e,10)&&600===parseInt(t,10)},isPushdown:function(e,t){return e===this.pushdownWidth&&t!==this.billboardHeight},handleTopNav:function(i){var n,s,a,o,r=t("#SponsorAd"),l=r.find("iframe"),d=t("#TopNavAd"),c=d.find("iframe");return n=this.ads.findWhere({name:"Middle1C"}),a=i<this.navBreakPoint&&0===l.length,o=i>=this.navBreakPoint&&0===c.length,n&&(a||o)?(a?(s=r,c.remove()):(s=d,l.remove()),e.defer(this.renderAd,{el:s,model:n}),!0):!1},fireSlideShowAd:function(e){var i=this.ads.findWhere({name:e.position}),n=t('<div class="ad-wrapper"></div>');this.adShown[e.position]||"object"!=typeof i||(this.adShown[e.position]=!0,e.el.html(n),this.renderAd({el:n,model:i}),this.broadcast("nyt:slideshow-ad-render",i))},hasInterstitial:function(){var e,t=this.ads.findWhere({name:"Interstitial"});return t?(e=t.get("timeout")?1e3*parseInt(t.get("timeout"),10):15e3,this.createInterstitial(t,this.completeInterstitial,e),!0):!1},fireRibbonInterstitial:function(){var e=this.pageManager.getViewport();this.$shell.prepend(a.ribbonInterstitial()),this.renderAdByPositionName("RibbonInterstitial"),this.$shell.find("#main").addClass("visually-hidden").end().find(".ribbon-interstitial-ad-overlay").css("height",e.height-150).find("iframe").css("width","")},createInterstitial:function(e,t,i){var n=this;this.interstitialModal=new o({id:"interstitial-ad-modal",modalTitle:"advertisement",tailDirection:"fixed",hasOverlay:!0,hasCloseButton:!0,width:e.get("width"),height:e.get("height"),modalContent:a.interstitialModal(),closeCallback:t,openCallback:function(){n.renderAdByPositionName(e.get("name"))}}).addToPage().open(),i&&(n.closeTimeout=window.setTimeout(this.interstitialModal.close,i))
},completeInterstitial:function(e){window.clearTimeout(this.closeTimeout),this.interstitialModal.removeFromPage(),this.ads.remove(e),this.checkAds()}});return r}),define("blogs/templates",["underscore/nyt"],function(_){var templates={};return templates.embeddedSlideshow=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",isLede===!1&&(__p+='\n<h4 class="headline">'+(null==(__t=headline)?"":__t)+"</h4>\n"),__p+='\n<div class="image"></div>\n<nav class="arrow-navigation previous" >\n<span class="visually-hidden">Go to previous slide</span>\n<div class="arrow-background" style="display: none;">\n<div class="arrow arrow-left">\n<div class="arrow-conceal"></div>\n</div>\n</div>\n</nav>\n<nav class="arrow-navigation next">\n<span class="visually-hidden">Go to next slide</span>\n<div class="arrow-background" style="display: none;">\n<div class="arrow arrow-right">\n<div class="arrow-conceal"></div>\n</div>\n</div>\n</nav>\n',collection.length>1&&(__p+='\n<nav class="dot-navigation ',collection.length>20&&(__p+="visually-hidden"),__p+='">\n<ol>\n',collection.each(function(e,t){__p+='\n<li class="navigation-dot '+(null==(__t=0===t?"active":"")?"":__t)+'" dot-index="'+(null==(__t=t)?"":__t)+'">\n<span class="dot"></span>\n<span class="visually-hidden">Go to slide '+(null==(__t=t+1)?"":__t)+" of "+(null==(__t=collection.length)?"":__t)+"</span>\n</li>"}),__p+="\n</ol>\n</nav>\n"),__p+="\n",collection.length>20&&collection.length>1&&(__p+='\n<div class="counter"></div>\n'),__p+='\n<figcaption class="caption" itemprop="description"></figcaption>';return __p},templates.embeddedSlideshowHP=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="image"></div>\n',isMobile===!1&&(__p+='\n<nav class="arrow-navigation previous" >\n<span class="visually-hidden">Go to previous slide</span>\n<div class="arrow-background" style="display: none;">\n<div class="arrow arrow-left">\n<div class="arrow-conceal"></div>\n</div>\n</div>\n</nav>\n<nav class="arrow-navigation next">\n<span class="visually-hidden">Go to next slide</span>\n<div class="arrow-background" style="display: none;">\n<div class="arrow arrow-right">\n<div class="arrow-conceal"></div>\n</div>\n</div>\n</nav>\n'),__p+="\n",collection.length<=20&&collection.length>1?(__p+='\n<nav class="dot-navigation">\n<ol>\n',collection.each(function(e,t){__p+='\n<li class="navigation-dot '+(null==(__t=0===t?"active":"")?"":__t)+'" dot-index="'+(null==(__t=t)?"":__t)+'">\n<span class="dot"></span>\n<span class="visually-hidden">Go to slide '+(null==(__t=t+1)?"":__t)+" of "+(null==(__t=collection.length)?"":__t)+"</span>\n</li>"}),__p+="\n</ol>\n</nav>\n"):__p+='\n<div class="counter"></div>\n',__p+='<figcaption class="caption" itemprop="description"></figcaption>';return __p},templates.google300x250Text=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>\n<ins class="adsbygoogle"\nstyle="display:inline-block;width:300px;height:250px"\ndata-ad-client="nytimes_article_var"\ndata-color-bg="#ffffff"\ndata-font-face="times"\ndata-font-size="small"\ndata-color-border = \'e5e5e5\'\ndata-color-line = \'ffffff\'\ndata-color-link = \'3886ab\'\ndata-color-url = \'3886ab\'\ndata-color-text = \'666666\'\ndata-safe = \'high\'\n></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>';return __p},templates.google728x90Text=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>\n<ins class="adsbygoogle"\nstyle="display:inline-block;width:728px;height:90px"\ndata-ad-client="nytimes_article_var"\ndata-color-bg="#ffffff"\ndata-font-face="times"\ndata-font-size="small"\ndata-color-border = \'e5e5e5\'\ndata-color-line = \'ffffff\'\ndata-color-link = \'3886ab\'\ndata-color-url = \'3886ab\'\ndata-color-text = \'666666\'\ndata-safe = \'high\'></ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n</script>';return __p},templates.image=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<img src="'+(null==(__t=src)?"":__t)+'" data-caption="" style="display:none;" />';return __p},templates.imageInfo=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<span class="caption-control" style="display:none;">\n'+(null==(__t=caption)?"":__t)+'\n<span class="credit" itemprop="copyrightHolder">\n'+(null==(__t=credit)?"":__t)+"\n</span>\n</span>";return __p},templates.interstitialModal=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+=""+(null==(__t=creative)?"":__t)+'<p class="user-action dismiss-button">Continue &raquo;</p>';return __p},templates.mostEmailed=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",collection.length&&(__p+='<header>\n<h4 class="module-heading">Most E-mailed</h4>\n</header><ol>\n',_.each(collection.slice(0,10),function(e){__p+='\n<li>\n<a class="story-link" href="'+(null==(__t=e.get("link"))?"":__t)+'">\n<article class="story theme-summary">';var t=null;_.each(e.get("media"),function(e){t||"Standard Thumbnail"===e["media-metadata"][0].format&&(t=e)}),__p+="",t&&(__p+='\n<div class="thumb">\n<img src="'+(null==(__t=t["media-metadata"][0].url)?"":__t)+'" alt="'+(null==(__t=t.caption)?"":__t)+'" />\n</div>\n'),__p+='<h5 class="story-heading">\n<span class="story-text truncate-text">\n',e.get("kicker")&&(__p+="\n"+(null==(__t=e.get("kicker"))?"":__t)+":\n"),__p+="\n"+(null==(__t=e.get("headline"))?"":__t)+"\n</span>\n</h5></article>\n</a>\n</li>\n"}),__p+="\n</ol>"),__p+="";return __p},templates.welcomeBack=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="story-group"></div><div id="WelcomeBack" class="ad welcome-back-ad"></div><div class="modal-footer">\n<button class="button dismiss-button">Back to Article</button>\n</div>';return __p},templates.welcomeBackStories=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",collection.length&&(__p+="<ul>",_.each(collection.slice(0,3),function(e){__p+='<li>\n<a class="story-link" href="'+(null==(__t=e.get("link"))?"":__t)+'">\n<article class="story theme-summary">',e.getCrop("thumbStandard")&&(__p+='\n<div class="thumb">\n<img src="'+(null==(__t=e.getCrop("thumbStandard").url)?"":__t)+'" />\n</div>\n'),__p+='<h2 class="story-heading">\n<span class="story-heading-text">',e.get("kicker")&&(__p+="\n"+(null==(__t=e.get("kicker"))?"":__t)+":\n"),__p+="\n"+(null==(__t=e.get("headline"))?"":__t)+'</span>\n<time class="dateline" datetime="'+(null==(__t=e.getDatetime())?"":__t)+'">'+(null==(__t=e.getFormattedDate())?"":__t)+"</time>\n</h2></article>\n</a>\n</li>"}),__p+='</ul><p class="user-action">\n<a href="/recommendations">More Recommended Articles &raquo;</a>\n</p>'),__p+="";return __p},templates.welcomeBackTitle=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<i class="icon"></i>\n<span class="heading-text">Recommended Articles</span>';return __p},templates}),define("blogs/views/ads/ads",["jquery/nyt","underscore/nyt","shared/ad/views/ads","blogs/templates"],function(e,t,i,n){var s=i.extend({bigAdTopTarget:775,halfPageTopTarget:600,adFold:900,verticalImagePixelMargin:15,portraitSize:1020,scope:"article",$story:null,bigAdCounter:1,htmlClasses:{XXL:"has-xxl",HalfPage:"has-half-page",BigAd:"has-big-ad",TopAd:"has-top-ad"},templates:n,options:{response:window.NYTADX?window.NYTADX.response:null,adx_campaign:"www.nytimes.com",positions:window.NYTADX?window.NYTADX.positions:[],keywords:[]},preInitialize:function(){var i=e(".ad");document.body.className.indexOf("nyt-blog-first-draft")>-1&&t.each(i,function(t){var i=e(t);return NYTADX.width<=960&&("TopAd"===t.id?i.addClass("hidden"):t.id.match(/TopAd[0-9]/)&&i.attr("id",t.id.replace(/TopAd([0-9]+)/,"MiddleRight$1"))),-1===NYTADX.positions.indexOf(i.attr("id"))?void i.parents(".first-draft-ad").remove():void 0}),this.$story=e("#story"),this.addArticleKeywords()},postInitialize:function(){this.adPlacements=this.$story.find(".ad-placeholder"),this.adPlacements.length>0&&this.subscribe("nyt:page-scroll",this.checkBigAdPlacements)},handleAdsForSmallViewport:function(i){var n=e("#XXL"),s=e("#TopAd"),a=s.find("iframe");-1!==t.indexOf(this.options.positions,"XXL")&&n.find("iframe").length>0&&(i<=this.portraitSize?(n.addClass("hidden"),this.$html.removeClass(this.htmlClasses.XXL)):(n.removeClass("hidden"),this.$html.addClass(this.htmlClasses.XXL))),-1!==t.indexOf(this.options.positions,"TopAd")&&a.length>0&&a.height()>1&&s.toggleClass("hidden",a.width()>728&&1030>=i)},handleApplicationAd:function(e){var t,i=e.get("name");return"Middle1C"===i?t=this.handleTopNav(this.pageManager.getCurrentBreakpoint()):"MiddleRight"===i?t=this.handleMiddleRightAd(e):("XXL"===i&&this.$html.addClass(this.htmlClasses.XXL),"TopAd"===i&&"blank"!==e.get("classification")&&this.$html.addClass(this.htmlClasses.TopAd),t=this.renderAdByPositionName(i,e)),t},checkBigAdPlacements:function(){var t,i,n=this,s=this.adPlacements.length-1;this.adPlacements.each(function(a,o){n.isPlaceholderInViewport(e(o))&&(a===s?(i="Box1",n.stopSubscribing("nyt:page-scroll",this.checkBigAdPlacements)):i="MiddleRight"+n.bigAdCounter,t=n.ads.findWhere({name:i}),t&&(n.renderAd({el:e(o),model:t}),n.adPlacements.splice(a,1),n.bigAdCounter+=1,n.trackingComscorePVC({module:"Ad",version:t.get("name"),action:"Impression",contentCollection:t.get("campaign"),contentID:t.get("classification"),region:n.ads.options.page,eventName:"AdImpression"})))})},handleMiddleRightAd:function(e){var t=this,i=this.$story.find(".lede-container-ads");return this.$html.toggleClass(function(){return"false"===e.get("isDirectlySold")&&i.length>0&&t.hasAppropriateLedeForRemnantAds(i)?(t.$story.find(".story-body-text").eq(0).before(i),""):"blank"===e.get("classification")?"":(t.cleanHtmlClasses(),t.isHalfPage(e.get("width"),e.get("height"))?t.htmlClasses.HalfPage:t.htmlClasses.BigAd)}),t.renderAdByPositionName("MiddleRight"),!0},hasAppropriateLedeForRemnantAds:function(e){var t=e.siblings("figure");return t.length>0&&t.attr("class").indexOf("layout-small")<0},setHtmlClasses:function(){var t=this;this.$html.toggleClass(function(){return 1===e("#XXL").find("iframe").length?(t.cleanHtmlClasses(),t.htmlClasses.XXL):""})},responsive:function(e){this.handleAdsForSmallViewport(e),this.handleTopNav(e)},addArticleKeywords:function(){var e=this.pageManager.getMeta("article:tag"),i=this.pageManager.getMeta("channels");"undefined"!=typeof e&&(this.options.keywords=t.union(this.options.keywords,e)),this.pageManager.getCurrentBreakpoint()<=1030&&this.options.keywords.push("smallviewport"),i&&/NytNow/.test(i)&&this.options.keywords.push("nytnow-article")}});return s}),define("blogs/instances/ad-manager",["blogs/views/ads/ads"],function(e){new e}),define("shared/ribbon/templates",["underscore/nyt"],function(_){var templates={};return templates.ad=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<li class="collection-item ribbon-ad-container">\n<div id="Ribbon" class="ad ribbon-ad">\n</div>\n</li>';return __p},templates.article=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){__p+='<li class="collection-item '+(null==(__t=classString)?"":__t)+' " >\n<a class="story-link" href="'+(null==(__t=newLink)?"":__t)+'">\n<div class="story-container">\n<article class="story theme-summary">\n';var image=article.getCrop("thumbStandard");__p+="\n",image&&(__p+='\n<div class="thumb">\n<img src="'+(null==(__t=image.url)?"":__t)+'" alt="" />\n',"image"!==image.type&&(__p+='\n<div class="media-action-overlay">\n<i class="icon '+(null==(__t=image.type)?"":__t)+'-icon"></i>\n<span class="overlay-text visually-hidden">'+(null==(__t=image.typeName)?"":__t)+"</span>\n</div>\n"),__p+="\n</div>\n"),__p+="",""!==article.get("kicker")&&(__p+='\n<h3 class="kicker">'+(null==(__t=article.get("kicker"))?"":__t)+"</h3>\n"),__p+='<h2 class="story-heading" title="'+(null==(__t=article.get("headline"))?"":__t)+'">'+(null==(__t=article.get("headline"))?"":__t)+"</h2>\n</article>\n</div>\n</a>\n</li>"}return __p},templates.ribbonPageNavTip=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="placeholder-button-group">\n<div class="placeholder-button"><div class="previous"></div></div>\n<div class="placeholder-button"><div class="next"></div></div>\n</div>\n<h4>New!</h4>\n<p>Use your left and right arrow keys to browse articles.</p>';return __p},templates.ribbonPageNavigation=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<nav data-href="'+(null==(__t=link)?"":__t)+'" data-queue-ad="'+(null==(__t=shouldQueueAd)?"":__t)+'" class="ribbon-page-navigation '+(null==(__t=direction)?"":__t)+'" style="display:'+(null==(__t=display)?"":__t)+'; overflow:hidden;">\n<a href="'+(null==(__t=link)?"":__t)+'" >\n<article class="story theme-summary ',image||(__p+=" no-thumb "),__p+='" style="display:none;">\n',image&&(__p+='\n<div class="thumb">\n<img src="'+(null==(__t=image.url)?"":__t)+'" />\n</div>\n'),__p+='\n<div class="summary">\n',kicker&&(__p+='\n<h3 class="kicker">'+(null==(__t=kicker)?"":__t)+"</h3>\n"),__p+='\n<h2 title="'+(null==(__t=title)?"":__t)+'" class="story-heading">'+(null==(__t=title)?"":__t)+'</h2>\n</div>\n</article>\n<div class="arrow arrow-',__p+="next"===direction?"right":"left",__p+='">\n<span class="visually-hidden">Go to the '+(null==(__t=direction)?"":__t)+' story</span>\n<div class="arrow-conceal"></div>\n</div>\n</a>\n</nav>';return __p},templates.storyCollection=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<li class="collection '+(null==(__t=collectionLabel.type)?"":__t)+'-collection">\n',collectionLabel.title&&(__p+='\n<div class="collection-marker">\n<h2 class="label"><a href="'+(null==(__t=collectionLabel.url)?"":__t)+'">'+(null==(__t=collectionLabel.title)?"":__t)+"</a></h2>\n</div>\n"),__p+='\n<ol class="collection-menu">\n'+(null==(__t=storyCollection)?"":__t)+"\n</ol>\n</li>";return __p},templates}),define("shared/data/models/article",["underscore/nyt","backbone/nyt"],function(e,t){var i=t.Model.extend({defaults:{title:"",kicker:"",pubdate:"",link:"",media:[{caption:"","media-metadata":[{url:""}]}],promotional_media:[{image:{image_crops:{}}}],processed:!1},initialize:function(){this.adjustKicker()},adjustKicker:function(){this.isOpinion()&&this.get("authors")&&this.set("kicker",this.get("authors")[0])},isOpinion:function(){return"Op-Ed Columnist"===this.get("kicker")||"Opinionator"===this.get("kicker")},getCrop:function(e){var t=this.get("promotional_media"),i="",n="image";try{if(t.type&&"image"!==t.type){switch(n=t.type){case"video":i="Play Video";break;case"slideshow":i="View Slideshow";break;case"interactive":i="View Interactive";break;default:i="View Media"}t=t.promotional_media}return t.image.image_crops[e].type=n,t.image.image_crops[e].typeName=i,t.image.image_crops[e]}catch(s){return}},getLink:function(){return this.get("link")},createDateObject:function(e){var t,i,n=new Date(e);return n.getDate()||e.search(/\d+T\d+/)>=0&&(t=e.split("T")[0],i=t.split("-"),n=new Date(i[0],i[1]-1,i[2])),n},getFormattedDate:function(e){var t,i=["Jan.","Feb.","March","April","May","June","July","Aug.","Sept.","Oct.","Nov.","Dec."];return e=e||this.get("pubDate"),t=this.createDateObject(e),i[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear()},getDatetime:function(e){var t;return e=e||this.get("pubDate"),t=this.createDateObject(e),t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}});return i}),define("shared/data/helpers/collection-mixin",["jquery/nyt","underscore/nyt"],function(){var e={hasFetched:!1,getNext:function(e,t){var i=e.indexOf(t),n=i===e.length?0:i+1;return e.at(n)},loadData:function(){return 0!==this.length||this.hasFetched||(this.hasFetched=!0,this.fetch()),this},getIdentifier:function(){return"rref="+this.sectionId},getName:function(){return this.sectionName},getUrl:function(){return this.sectionUrl}};return e}),define("shared/data/collections/most-popular",["backbone/nyt","foundation/collections/base-collection","shared/data/models/article","foundation/hosts","underscore/nyt","shared/data/helpers/collection-mixin"],function(e,t,i,n,s,a){var o=t.extend(s.extend({},a,{model:i,apis:{mostviewed:{url:n.s1+"/du/mostpopular/viewed/all_1.jsonp?v1",callback:"jsonCallbackViewed"},mostemailed:{url:n.s1+"/du/mostpopular/emailed/all_1.jsonp?v1",callback:"jsonCallbackEmailed"}},initialize:function(e,t){this.url=this.apis[t.type].url,this.callback=this.apis[t.type].callback},sync:function(t,i,n){return n.dataType="jsonp",n.jsonpCallback=this.callback,n.jsonp="callback",n.cache=!0,e.sync(t,i,n)},parse:function(e){var t=this,i=s.map(e.results,function(e){var i=[];return e.id&&(e.data_id=e.id,delete e.id),e.asset_id&&delete e.asset_id,""===e.media?delete e.media:i=e.media[0]["media-metadata"]||[],e.promotional_media={image:{image_crops:{thumbStandard:t.getCrop(i,"Standard Thumbnail"),mediumThreeByTwo210:t.getCrop(i,"mediumThreeByTwo210")}}},e.description=e.abstract,e.link=e.url,e.kicker=e.column,e.headline=e.title,e.authors=[e.byline.replace("By ","").replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})],e.pubDate=e.published_date,e});return i},getCrop:function(e,t){var i,n;for(i=0,n=e.length;n>i;i+=1)if(e[i].format===t)return e[i]},getIdentifier:function(){return"src=me"}}));return o}),define("shared/data/instances/most-emailed",["jquery/nyt","foundation/views/page-manager","foundation/hosts","shared/data/collections/most-popular"],function(e,t,i,n){return new n([],{type:"mostemailed"})}),define("shared/data/collections/recommendations",["backbone/nyt","foundation/collections/base-collection","shared/data/models/article","foundation/hosts","underscore/nyt","shared/data/helpers/collection-mixin"],function(e,t,i,n,s,a){var o=t.extend(s.extend({},a,{model:i,url:n.du+"/svc/recommendations/v3/personalized.jsonp",sync:function(t,i,n){return n.dataType="jsonp",n.jsonpCallback="jsonRecommended",n.jsonp="callback",n.cache=!0,n.data={access_key:"776ACB1E-6C7F-4702-9E18-CF329376F5A3"},e.sync(t,i,n)},parse:function(e){var t=this,i=s.map(e.suggestions,function(e){var i=e.thumbs||{};return e.promotional_media={image:{image_crops:{thumbStandard:e.thumbnail,mediumThreeByTwo210:t.getCrop(i,"mediumThreeByTwo210")}}},e.kicker&&"Video"===e.item_type?e.kicker="Video | "+e.kicker:"Video"===e.item_type&&(e.kicker="Video"),e.authors=e.byline?[e.byline.replace("By ","").replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})]:"",e.description=e.abstract,e.link=e.url,e.headline=e.title,e.pubDate=e.published_date,e});return this.num_articles=e.num_articles,this.uid=e.uid,this.user_displayname=e.user_displayname,this.user_pic_url=e.user_pic_url,i},getCount:function(){return this.num_articles||0},getUserId:function(){return this.uid||0},getUserDisplayName:function(){return this.user_displayname||null},getUserPictureUrl:function(){return this.user_pic_url||null},getCrop:function(e,t){var i,n;for(i=0,n=e.length;n>i;i+=1)if(e[i].type===t)return e[i].url=e[i].content,e[i]},getIdentifier:function(){return"src=recg"}}));return o}),define("shared/data/instances/recommendations",["jquery/nyt","foundation/views/page-manager","shared/data/collections/recommendations"],function(e,t,i){return new i}),define("shared/data/collections/context",["backbone/nyt","foundation/collections/base-collection","shared/data/models/article","foundation/hosts","underscore/nyt","shared/data/helpers/collection-mixin"],function(e,t,i,n,s,a){var o=t.extend(s.extend({},a,{model:i,sync:function(t,i,n){var s,a=this.pageManager.getMeta("article:collection");return a?(n.url=a,n.dataType="jsonp",s=n.url.match(/sectionfronts\/(.+)\/index/)||["","homepage"],n.jsonpCallback="jsonFeedCallback_"+s[1].replace(/\/|\-/g,"_"),this.sectionId=s[1],e.sync(t,i,n)):void 0},parse:function(e){return this.sectionName=e.title.replace("NYT > ",""),this.sectionUrl=e.link,e.items}}));return o}),define("shared/data/instances/context",["jquery/nyt","foundation/views/page-manager","shared/data/collections/context"],function(e,t,i){return new i}),define("shared/data/collections/top-news",["underscore/nyt","backbone/nyt","foundation/collections/base-collection","shared/data/models/article","foundation/hosts","shared/data/helpers/collection-mixin"],function(e,t,i,n,s,a){var o=i.extend(e.extend({},a,{model:n,initialize:function(){this.url=s.json+("us"===this.pageManager.getEdition()?"/services/json/sectionfronts/index.jsonp":"/services/json/sectionfronts/international/index.jsonp")},sync:function(e,i,n){return n.dataType="jsonp",n.jsonpCallback="us"===this.pageManager.getEdition()?"jsonFeedCallback_homepage":"jsonFeedCallback_international",t.sync(e,i,n)},parse:function(e){return e.items},getIdentifier:function(){return"rref=homepage"}}));return o}),define("shared/data/instances/top-news",["jquery/nyt","foundation/views/page-manager","shared/data/collections/top-news"],function(e,t,i){return new i}),define("shared/data/collections/section-origin",["underscore/nyt","backbone/nyt","foundation/collections/base-collection","shared/data/models/article","foundation/hosts","shared/data/helpers/collection-mixin"],function(e,t,i,n,s,a){var o=i.extend(e.extend({},a,{model:n,sync:function(e,i,n){var a,o,r=this.pageManager.getUrlParam("rref");return r?a=r:(o=this.createAnchor(document.referrer),a=o.pathname.match(/pages\/(.+)\//)[1]),n.url=s.json+"/services/json/sectionfronts/"+a+"/index.jsonp",n.dataType="jsonp",n.jsonpCallback="jsonFeedCallback_"+a.replace(/\/|\-/g,"_"),this.sectionId=a,t.sync(e,i,n)},parse:function(e){return this.sectionName=e.title.replace("NYT > ",""),this.sectionUrl=e.link,e.items}}));return o}),define("shared/data/instances/section-origin",["jquery/nyt","foundation/views/page-manager","shared/data/collections/section-origin"],function(e,t,i){return new i}),define("shared/data/collections/nyt-collection",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/collections/base-collection","foundation/hosts","shared/data/helpers/collection-mixin","shared/data/models/article"],function(e,t,i,n,s,a,o){var r=n.extend(t.extend({},a,{model:o,url:s.add+"/svc/add/v1/collection.json",sync:function(e,t,n){var a=this.pageManager.getMeta("nyt-collection:identifier"),o=s.www.replace(/^\/\//,"");return n.dataType="json",n.cache=!0,n.data={name:a,dom:o},i.sync(e,t,n)},parse:function(e){var i=t.map(e.result.members.items,function(e){var t=e.promotional_media;return t&&t.image&&t.image.image_crops&&(e.thumbnail=t.image.image_crops.mediumThreeByTwo210),"video"===e.data_type&&(e.kicker="Video"),e.link=e.url,e});return this.nytCollectionName=e.result.collection.name,this.nytCollectionType=e.result.collection.type,this.nytCollectionDescription=e.result.collection.long_description,i},getIdentifier:function(){var e=["collection"];return e[1]=this.nytCollectionType,e[2]=this.pageManager.getMeta("nyt-collection:identifier"),"rref="+e.join("/")},getName:function(){return this.nytCollectionName},getUrl:function(){var e=this.pageManager.getMeta("nyt-collection:url")||"";return e},getDescription:function(){return this.nytCollectionDescription}}));return r}),define("shared/data/instances/nyt-collection",["jquery/nyt","foundation/views/page-manager","shared/data/collections/nyt-collection"],function(e,t,i){return new i}),define("shared/ribbon/collections/ribbon",["backbone/nyt","underscore/nyt","foundation/collections/base-collection","shared/data/models/article","foundation/hosts","foundation/models/user-data","shared/data/instances/most-emailed","shared/data/instances/recommendations","shared/data/instances/context","shared/data/instances/top-news","shared/data/instances/section-origin","shared/data/instances/nyt-collection"],function(e,t,i,n,s,a,o,r,l,d,c,h){var u=i.extend({url:function(){return t.isFunction(this.feedUrl)&&this.handleFeedAsFunction(this.feedUrl),this.feedUrl||""},model:n,initialize:function(e){t.bindAll(this,"getMostEmailed","getContext","getTopNews","getRecommendations","getOrigin","getNytCollection"),this.collectionLabels=[],this.feedSource=[{nytCollection:this.getNytCollection},{origin:this.getOrigin},{context:this.getContext},{mostEmailed:this.getMostEmailed},{homepage:this.getTopNews},{recommendations:this.getRecommendations},{world:s.json+"/services/json/sectionfronts/world/index.jsonp"},{us:s.json+"/services/json/sectionfronts/national/index.jsonp"},{business:s.json+"/services/json/sectionfronts/business/index.jsonp"},{opinion:s.json+"/services/json/sectionfronts/opinion/index.jsonp"},{technology:s.json+"/services/json/sectionfronts/technology/index.jsonp"},{politics:s.json+"/services/json/sectionfronts/politics/index.jsonp"},{sports:s.json+"/services/json/sectionfronts/sports/index.jsonp"},{science:s.json+"/services/json/sectionfronts/science/index.jsonp"},{health:s.json+"/services/json/sectionfronts/health/index.jsonp"},{arts:s.json+"/services/json/sectionfronts/arts/index.jsonp"},{style:s.json+"/services/json/sectionfronts/style/index.jsonp"},{nyregion:s.json+"/services/json/sectionfronts/nyregion/index.jsonp"}],this.currentArticleUrl=e.currentArticleUrl,this.originalLoadType="context",this.feedUrl=this.setFeedUrl(e.sectionFeedUrl),this.subscribe(this,"sync",this.setCurrentArticle)},loadData:function(){t.isFunction(this.feedUrl)?this.handleFeedAsFunction(this.feedUrl):this.fetch()},sync:function(t,i,n){var s=this.url().match(/sectionfronts\/(.+)\/index/)||["","homepage"];return n.dataType="jsonp",n.jsonpCallback="jsonFeedCallback_"+s[1].replace("/","_"),this.sectionId="rref="+s[1],e.sync(t,i,n)},setCurrentArticle:function(){var e=this;this.currentArticle=this.find(function(t){return t.get("link")===e.currentArticleUrl})},parse:function(e){return this.prepCollection(e.items,e.title.replace("NYT > ",""),e.link,"news")},getFeedSourceValue:function(e){for(var t=0,i=this.feedSource.length;i>t;t++)if(this.feedSource[t].hasOwnProperty(e))return this.feedSource[t][e]},removeFeedByKey:function(e){for(var i=0,n=this.feedSource.length;n>i;i++)if(t.keys(this.feedSource[i])[0]===e)return void this.feedSource.splice(i,1)},removeFeedByUrl:function(e){for(var i,n=this.createAnchor(e).pathname,s=0,a=this.feedSource.length;a>s;s++)if(i=t.values(this.feedSource[s])[0],!t.isFunction(i)&&i.indexOf(n)>-1)return void this.feedSource.splice(s,1)},createAnchor:function(e){var t=document.createElement("a");return t.href=e,t},isUrlForSection:function(e,t){var i=this.createAnchor(e).pathname,n=this.createAnchor(this.getFeedSourceValue(t)).pathname;return i===n},setFeedUrl:function(){var e,t,i,n,s=this,o=this.pageManager.getUrlParam("src")||"",r=this.pageManager.getUrlParam("rref"),l=this.pageManager.getMeta("nyt-collection:identifier"),d="origin";return r&&(n=decodeURIComponent(r).split("/")),n&&3===n.length&&n[2]===l?t="nytCollection":r&&"homepage"!==r?(this.removeFeedByKey(r),t="origin"):""===this.pageManager.getUrlParam("hp")||"homepage"===r?t="homepage":this.pageManager.getUrlParam("ref")?(e=this.createAnchor(document.referrer),/.nytimes.com$/.test(e.host)&&/^\/pages/.test(e.pathname)?t="origin":(t="context",d="context")):"me"===o?t="mostEmailed":0===o.indexOf("rec")?t="recommendations":(t="context",d="context"),i=this.getFeedSourceValue(t),this.originalLoadType=d,this.removeFeedByKey("nytCollection"),this.removeFeedByKey("context"),this.removeFeedByKey("origin"),this.removeFeedByKey(t),a.ready(function(){a.isLoggedIn()||s.removeFeedByKey("recommendations")}),i},handleFeedAsFunction:function(e){var i=e();t.isArray(i)?(this[1===this.length?"reset":"add"](i),this.local(this,"sync"),this.local(this,"nyt:ribbon-custom-collection-loaded")):i()},loadFeed:function(){var e;return this.feedSource.length>0?(e=t.values(this.feedSource.shift())[0],t.isFunction(e)?this.handleFeedAsFunction(e):(this.feedUrl=e,this.fetch({remove:!1})),!0):!1},getAdModel:function(){return new n({processed:!1,isAd:!0})},prepCollection:function(e,t,i,n){var s,a,o=this.collectionLabels.length;for(s=0,a=e.length;a>s;s+=1)e[s].collectionId=o;return this.collectionLabels.push({title:t,url:i,type:n}),e},next:function(e){var t,i=this.indexOf(e);return t=i===this.length?0:i+1,this.local(this,"nyt:ribbon-collection-next",this.models[t]),this.models[t]},previous:function(e){var t,i=this.indexOf(e);return t=0===i?this.models.length:i-1,this.local(this,"nyt:ribbon-collection-previous",this.models[t]),this.models[t]},importCollection:function(e){var t=this,i=e.collection.toJSON();return i.length>0?(this.sectionId=e.collection.getIdentifier(),this.prepCollection(i,e.name,e.url,e.type)):(this.feedSource.unshift(e.callback),function(){var i=function(){window.clearTimeout(n),t.loadFeed()},n=window.setTimeout(function(){t.stopSubscribing(e.collection,"sync",i),t.feedSource.shift(),t.loadFeed()},1500);t.subscribeOnce(e.collection,"sync",i)})},getIdentifier:function(){return this.sectionId},getMostEmailed:function(){return this.importCollection({collection:o.loadData(),name:"Most Emailed",url:s.www+"/most-popular-emailed",type:"most-emailed",callback:{mostEmailed:this.getMostEmailed}})},getNytCollection:function(){return this.importCollection({collection:h.loadData(),name:h.getName(),url:h.getUrl(),type:"nytCollection",callback:{nytCollection:this.getNytCollection}})},getRecommendations:function(){return this.importCollection({collection:r.loadData(),name:"Recommended",url:s.www+"/recommendations",type:"news",callback:{recommendations:this.getRecommendations}})},getTopNews:function(){return this.importCollection({collection:d.loadData(),name:"Home Page",url:s.www,type:"news",callback:{homepage:this.getTopNews}})},getContext:function(){var e=this.pageManager.getMeta("article:collection")||"";return this.removeFeedByUrl(e),this.importCollection({collection:l.loadData(),name:l.getName(),url:l.getUrl(),type:"news",callback:{context:this.getContext}})},getOrigin:function(){return this.removeFeedByKey(this.pageManager.getUrlParam("ref")),this.importCollection({collection:c.loadData(),name:c.getName(),url:c.getUrl(),type:"news",callback:{origin:this.getOrigin}})}});return u}),define("shared/ribbon/instances/ribbon-data",["jquery/nyt","foundation/views/page-manager","shared/ribbon/collections/ribbon"],function(e,t,i){var n=e('head link[rel="canonical"]').attr("href"),s=t.getMeta("article:collection");return new i({sectionFeedUrl:s,currentArticleUrl:n})}),define("shared/ribbon/views/helpers/mixin",["underscore/nyt","jquery/nyt"],function(e,t){var i={collectionStoryWidth:249,getActiveModel:function(t){var i=this;return e.find(t,function(e){return e.get("link")===i.canonical})},getStoryIndex:function(t,i){var n;return i||(i=this.getActiveModel(t)),n=e.indexOf(t,i),n>=0?n:0},getAdIndex:function(e){var i,n,s=t("#ribbon"),a=this.pageManager.getUrlParam("ribbon-ad-idx");return a?i=a:this.pageManager.getCurrentBreakpoint()<=1e4?(0===e?i=n=this.storyUnitsInView():(n=Math.floor((s.width()-.25*this.collectionStoryWidth)/this.collectionStoryWidth),i=e+n),n>1&&(i-=1)):i=this.getLargeScreenAdPosition(e),i},getLargeScreenAdPosition:function(e){var i,n,s,a="ribbon"===this.$el.attr("id")?this.$el:t("#ribbon"),o=this.storyUnitsInView(a);return i=0===e?a.width():a.width()-.25*this.collectionStoryWidth,n=i%this.collectionStoryWidth>.25*this.collectionStoryWidth,s=n?o-1:o-2,s+=e},storyUnitsInView:function(e){return e||(e=this.$el),Math.floor(e.width()/this.collectionStoryWidth)},createAdsDeferral:function(e){this.pageManager.getMeta("ads_adNames")?e():(this.adxTimeout=window.setTimeout(e,500),this.subscribeOnce("nyt:ads-rendered",e))}};return i}),define("shared/ribbon/views/ribbon-page-navigation",["jquery/nyt","underscore/nyt","foundation/hosts","foundation/views/base-view","foundation/views/page-manager","shared/ribbon/instances/ribbon-data","shared/ribbon/templates","shared/modal/views/modal","foundation/models/page-storage","shared/ribbon/views/helpers/mixin"],function(e,t,i,n,s,a,o,r,l,d){var c=n.registerView("arrows").extend(t.extend({},d,{el:"body",delay:200,speed:250,expandWidth:275,expanded:!1,events:{"click .ribbon-page-navigation":"changeArticle","mouseenter .ribbon-page-navigation":"showArticle","mouseleave .ribbon-page-navigation":"hideArticle","mouseleave #ribbon-page-navigation-modal .modal":"hideArticle"},nytEvents:{"nyt:comments-panel-opened":"hideRightArrow","nyt:comments-panel-closed":"showRightArrow","nyt:page-drag":"handlePageDrag"},initialize:function(){t.bindAll(this,"preventScroll","checkForFeed"),this.feed=a,this.subscribe("nyt:ads-fire-ribbon-interstitial",this.ribbonInterstitialFired),this.pageManager.isDomReady()?this.handlePageReady():this.subscribe("nyt:page-ready",this.handlePageReady),this.trackingBaseData={module:"ArrowsNav",contentCollection:this.pageManager.getMeta("article:section")}
},handlePageReady:function(){this.restrict=this.pageManager.isComponentVisible(e("#ribbon")),this.createAdsDeferral(this.checkForFeed)},checkForFeed:function(){var e=this;this.feed.length>1&&this.render(),this.subscribeOnce(a,"sync",this.render),l.ready(function(){l.get("ribbon_hasViewedTooltip")!==!0&&e.addToolTip()})},render:function(){var t=this.feed.currentArticle,i=this.feed.previous(t),n=this.feed.next(t);this.activeStoryIndex=this.getStoryIndex(this.feed.models,this.feed.currentArticle),this.$arrows=e(this.createTemplate("previous",i)+this.createTemplate("next",n)),this.$shell.append(this.$arrows),this.adjustArrows(),this.adjustText(),this.subscribe("nyt:page-resize",this.adjustArrows),this.subscribe("nyt:ribbon-visiblility",this.restrictArrow),this.subscribe("nyt:ribbon-left",this.handleKeyboardLeftArrow),this.subscribe("nyt:ribbon-right",this.handleKeyboardRightArrow),this.pageManager.isMobile()&&this.$arrows.hide()},adjustArrows:function(){var e,t,i=this.pageManager.getCurrentBreakpoint(),n=this.$arrows.filter(".previous"),s=this.$arrows.filter(".next");if(i>=10070)e=this.$window.width(),t=this.$shell.width(),n.css("left",(e-t)/2),s.css("right",(e-t)/2),this.cssControl=!1;else{if(this.cssControl)return;n.css("left",""),s.css("right",""),this.cssControl=!0}},adjustText:function(){var t,i,n,s;this.$arrows.each(function(a,o){n=e(o),i=n.find(".story"),t=n.find(".story .summary"),s=parseInt(i.css("padding-top"),10),i.css({display:"block",opacity:0}),t.css("margin-top",n.height()/2-t.height()/2-s),i.css({display:"none",opacity:1})})},restrictArrow:function(e){this.restrict=e},previousPage:function(){var e=this.$arrows.filter(".previous"),t=e.data("href");t&&(window.location=t)},nextPage:function(){var e=this.$arrows.filter(".next"),t=e.data("href");t&&(window.location=t)},createTemplate:function(e,i){var n,s,a,r={direction:e,display:"none",title:"",image:"",link:"",kicker:"",shouldQueueAd:!1};return i&&(t.indexOf(this.pageManager.getMeta("ads_adNames"),"Ribbon")>=0&&(a=this.getAdIndex(this.activeStoryIndex),n=a-t.indexOf(this.feed.models,i),s="previous"===e&&1===n||"next"===e&&0===n),r={direction:e,display:"block",title:i.get("headline")||i.get("title"),image:i.getCrop("thumbStandard"),link:this.processLink(i.get("link"),a),kicker:i.get("kicker"),shouldQueueAd:s}),o.ribbonPageNavigation(r)},processLink:function(e,t){var n=document.createElement("a");return n.href=e,0===n.hostname.indexOf("www")&&0===window.location.hostname.indexOf("www")&&(e=0===n.pathname.indexOf("/")?i.www+n.pathname:i.www+"/"+n.pathname),t&&(e+="?ribbon-ad-idx="+t),e+=/\?/.test(e)?"&":"?",e+=this.feed.getIdentifier(),n.search.length>0&&(e+=n.search.replace("?","&")),e},changeArticle:function(t){t.preventDefault();var i=e(t.currentTarget),n=this.trackingAppendParams(i.data("href"),{action:"click",region:i.is(".next")?"FixedRight":"FixedLeft"});this.fireQueuedAd(i)!==!0&&(window.location=n)},fireQueuedAd:function(t){var i=t.data("queue-ad"),n=e(".ribbon-ad");return e("#ribbon").find(".collection-item").removeClass("active"),i!==!0?!1:(n.find("> iframe").length>0?(this.broadcast("nyt:ads-fire-ribbon-interstitial"),t.data("queue-ad",!1)):window.location=n.find("#ribbonAdBodytxt").attr("href"),!0)},ribbonInterstitialFired:function(){this.pageManager.isMobile()&&this.$arrows.show()},preventScroll:function(e){this.scrollLock=!0,e.preventDefault()},handlePageDrag:function(e,t){var i=this.pageManager.getMeta("mediaviewer_isVisible")||!1;if(!i&&e.gesture){var n,s,a=this.expandWidth,o=0,r=(e.gesture.distance,1.5*e.gesture.distance-20);if(this.scrollLock||this.$document.on("touchmove",this.preventScroll),"left"===e.gesture.direction?s=this.$arrows.filter(".next"):"right"===e.gesture.direction&&(s=this.$arrows.filter(".previous")),!s||!s.data("href")||e.gesture.distance<20)return this.$arrows.hide(),this.$document.off("touchmove",this.preventScroll),void(this.scrollLock=!1);if("right"===t||"left"===t)r=a>r?r:a,r=r>o?r:o,n=100>r?"hide":"show",s.show().css("width",r+"px").find(".story")[n](),this.truncateArticleSummary(s);else if(s&&"end"===t){if(s.width()<a-5)s.hide();else{var l=this.trackingAppendParams(s.data("href"),{action:"swipe",region:"left"===e.gesture.direction?"FixedRight":"FixedLeft"});window.location=l}this.$document.off("touchmove",this.preventScroll),this.scrollLock=!1}else"start"!==t&&(this.$arrows.hide(),this.$document.off("touchmove",this.preventScroll),this.scrollLock=!1)}},handleKeyboardLeftArrow:function(){var e=this.$arrows.filter(".previous"),t=this.trackingAppendParams(e.data("href"),{action:"keypress",region:"FixedLeft"});this.fireQueuedAd(e)!==!0&&(e.data("href",t),this.previousPage())},handleKeyboardRightArrow:function(){var e=this.$arrows.filter(".next"),t=this.trackingAppendParams(e.data("href"),{action:"keypress",region:"FixedRight"});this.fireQueuedAd(e)!==!0&&(e.data("href",t),this.nextPage())},showArticle:function(t){var i=this,n=e(t.currentTarget);this.restrict||this.expanded||(this.origWidth=this.$arrows.width(),this.timeout=window.setTimeout(function(){n.animate({width:i.expandWidth},{duration:i.speed,complete:function(){return i.expanded?(n.find(".story").fadeIn(i.speed),void i.truncateArticleSummary(n)):!1}}),i.expanded=!0},this.delay))},truncateArticleSummary:function(e){var t=48,i=e.find(".story .summary");e.find(".story-heading").height()>t&&(this.truncateText(e.find(".story-heading"),t),i.css("margin-top",e.find(".story-heading").height()/2-t/2))},hideArticle:function(t){var i=this,n=e("#ribbon-page-navigation-modal").find(".modal"),s=e(n.is(t.currentTarget)?".ribbon-page-navigation.next":t.currentTarget);clearTimeout(this.timeout),!this.expanded||n.has(t.relatedTarget).length>0||(s.animate({width:i.origWidth},{duration:this.speed,complete:function(){s.css("width","")}}).find(".story").hide(),this.expanded=!1)},showRightArrow:function(){this.$arrows&&this.$arrows.filter(".next").show()},hideRightArrow:function(){this.$arrows&&this.$arrows.filter(".next").hide()},addToolTip:function(){var e,t=this,i=new r({id:"ribbon-page-navigation-modal",modalContent:o.ribbonPageNavTip(),binding:".ribbon-page-navigation.next",tailDirection:"right",canOpenOnHover:!0,width:"322px",mouseEnterDelay:500,tailTopOffset:-5,tailLeftOffset:9,closeOnMouseOut:!0,openCallback:function(){l.set("ribbon_hasViewedTooltip",!0),e=window.setTimeout(i.close,2e4),t.subscribeOnce("nyt:page-scroll",i.close)},closeCallback:function(){i.removeFromPage(),window.clearTimeout(e)}});i.addToPage()}}));return c}),define("shared/ribbon/views/ribbon",["jquery/nyt","underscore/nyt","foundation/hosts","foundation/views/base-view","shared/ribbon/templates","shared/ribbon/views/ribbon-page-navigation","shared/ribbon/instances/ribbon-data","shared/ribbon/views/helpers/mixin"],function(e,t,i,n,s,a,o,r){var l=n.registerView("ribbon").extend(t.extend({},r,{el:"#ribbon",collection:o,template:s.storyCollection,articleTemplate:s.article,adTemplate:s.ad,isRibbonVisible:!1,firstLoad:!0,toggleDisabled:0,oldScrollTop:0,animationDistance:100,minDownDistance:100,minUpDistance:300,speed:200,hammerSettings:{drag_block_vertical:!0,swipe_velocity:.7,drag_min_distance:3},events:{"click .collection-menu li a":"handleArticleClick","click .ribbon-navigation-container .next":"handleNextArrow","click .ribbon-navigation-container .previous":"handlePreviousArrow",mouseenter:"handleRibbonMouseEnter",mouseleave:"handleRibbonMouseOut",touch:"handleTouch",tap:"handleArticleClick",hold:"handleTouchHold",dragstart:"handleTouchDragStart",drag:"handleRibbonDrag",swipe:"handleRibbonSwipe"},nytEvents:{"nyt:page-resize":"resizeRibbon","nyt:messaging-critical-alerts-move-furniture":"moveRibbonForAlerts","nyt:messaging-suggestions-move-furniture":"moveRibbonForAlerts","nyt:messaging-message-critical-alerts-closed":"enableRibbonToggle","nyt:messaging-message-suggestions-closed":"enableRibbonToggle","nyt:comments-panel-opened":"disableRibbonToggle","nyt:comments-panel-closed":"enableRibbonToggle","nyt:masthead-absolute":"disableRibbonToggle","nyt:masthead-fixed":"enableRibbonToggle"},initialize:function(){t.bindAll(this,"handleMouseMove","handleArticleClick","handleRibbonAdClick","hideCollectionMarkers","pollHiddenCollections","pollShowingTabs","revertRibbon","handleRibbonSwipe","handleRibbonDrag","handleTouch","handleTouchHold","handleTouchDragStart","applyTranslateToRibbon","assignListenersAndLoad"),this.isDesktop=this.pageManager.isDesktop(),this.canonical=this.pageManager.getCanonical(),this.trackingBaseData={module:"Ribbon",version:this.collection.originalLoadType,region:"Header"},this.listenToOnce(this.collection,"sync",t.bind(function(){this.trackingTriggerImpression("ribbon-first-load",{eventName:"impression",action:"impression",contentCollection:this.collection.collectionLabels[0].title})},this))},handleDomReady:function(){this.$loader=this.$(".ribbon-loader"),this.ribbonMarginTop=parseInt(this.$el.css("margin-top"),10),this.ribbonMarginBottom=parseInt(this.$el.css("margin-bottom"),10),this.ribbonHeight=this.$el.height(),this.mastheadHeight=e("#masthead").height()-1,this.toggleDisabled=!1,this.$ribbonMenu=this.$el.find(".ribbon-menu"),this.$ribbonNavigation=this.$el.find(".ribbon-navigation-container"),this.$previousArrow=this.$ribbonNavigation.find(".previous"),this.$nextArrow=this.$ribbonNavigation.find(".next"),this.isRibbonVisible=this.pageManager.isComponentVisible(this.$el),this.listenTo(this.pageManager,"nyt:page-scroll",this.handleScroll),this.createAdsDeferral(this.assignListenersAndLoad)},assignListenersAndLoad:function(){window.clearTimeout(this.adxTimeout),this.stopSubscribing("nyt:ads-rendered",this.assignListenersAndLoad),this.listenTo(this.collection,"sync",this.render),this.listenToOnce(this.collection,"sync",this.renderFurniture),this.listenTo(this.collection,"nyt:ribbon-custom-collection-loaded",this.render),this.collection.loadData(),new a},render:function(){var i,n,s,a,o,r,l,d,c=this.collectionStoryWidth+this.animationDistance,h=t.indexOf(this.pageManager.getMeta("ads_adNames"),"Ribbon")>=0;if(i=this.collection.where({processed:!1}),0!==i.length&&((h||this.pageManager.getUrlParam("ribbon-ad-idx"))&&this.firstLoad===!0&&(r=this.returnRibbonAdData(i,h),o=r.index,r.model&&i.splice(r.index,0,r.model)),n=this.collection.collectionLabels[i[0].get("collectionId")])){if(s=e(this.template({storyCollection:this.createStoryCollection(i,o),collectionLabel:n})),a=this.collection.length*c+this.$loader.width()+this.collection.collectionLabels.length,this.$ribbonMenu.css("width",a),this.$loader.before(s),(this.firstLoad&&!this.referredFromArticle()||!this.firstLoad)&&this.animateRibbonStories(s),l=this.$el.find("#Ribbon"),l.length>0&&this.firstLoad===!0){this.broadcast("nyt:ads-new-placement","Ribbon"),d=l.find("> a"),d.length&&d.attr("href",d.attr("href")+"?"+this.collection.getIdentifier());var u=this;t.defer(function(){u.assignHandlerToIframeClick(l.find("iframe"),u.handleRibbonAdClick)})}this.assignSyncedHtmlToView(),this.updateCollectionValues(),this.firstLoad=!1,this.broadcast("nyt:ribbon-rendered")}},createStoryCollection:function(e,i){var n=this,s="";return t.each(e,function(e,t,a){var o,r=[],l=e.get("link"),d=n.processLink(l,i);-1!==l.indexOf(n.canonical)&&n.firstLoad&&r.push("active"),t===a.length-1&&r.push("last-collection-item"),o=r.join(" "),s+=e.get("isAd")!==!0?n.articleTemplate({article:e,classString:o,newLink:d}):n.adTemplate(),e.set("processed",!0)}),s},processLink:function(e,t){var n=document.createElement("a"),s=this.collection.getIdentifier();return n.href=e,0===n.hostname.indexOf("www")&&0===window.location.hostname.indexOf("www")&&(e=0===n.pathname.indexOf("/")?i.www+n.pathname:i.www+"/"+n.pathname),t&&(e+="?ribbon-ad-idx="+t),e+=/\?/.test(e)?"&":"?",e+=s,n.search.length>0&&(e+=n.search.replace("?","&")),e},assignHandlerToIframeClick:function(e,t){var i,n;e.length&&(i=e.get(0),n=i.contentDocument||i.contentWindow.document,"undefined"!=typeof n.addEventListener?n.addEventListener("click",t,!1):"undefined"!=typeof n.attachEvent&&n.attachEvent("onclick",t))},returnRibbonAdData:function(e,t){var i,n,s;return s=this.getStoryIndex(e),i=this.getAdIndex(s),t&&(n=this.collection.getAdModel()),{index:i,model:n}},referredFromArticle:function(){var e,t=document.createElement("a");return document.referrer?(t.href=document.referrer,e=t.pathname,t.hostname.indexOf("nytimes.com")>-1&&/^(\/\w+)?\/\d+/.test(e)):!1},renderFurniture:function(){var e=-this.$el.find(".active").index();this.ribbonAnimation(e,!0),this.testForCollectionEnd()&&this.collection.loadFeed(),Modernizr.touch?this.assignCustomEasing():this.collectionMarkerTimeout=setTimeout(this.hideCollectionMarkers,2e3)},assignCustomEasing:function(){return e.easing.easeOutCirc=function(e,t,i,n,s){return n*Math.sqrt(1-(t=t/s-1)*t)+i},this},matrixToArray:function(e){return e.substr(7,e.length-8).split(", ")},returnXForTransform:function(){var e=this.$ribbonMenu.css("-webkit-transform");return"none"===e?this.$ribbonMenu.position().left:parseInt(this.matrixToArray(e)[4],10)},applyTranslateToRibbon:function(e){var t;return isNaN(e)?void 0:(t="translate3d("+e+"px, 0, 0)",this.$ribbonMenu.css({transform:t,"-webkit-transform":t,msTransform:t}))},handleRibbonDrag:function(e){if(e.gesture){e.gesture.preventDefault();var t,i,n,s,a=this.returnXForTransform();t=this.startDragLocation-a,i=0===t?e.gesture.deltaX:e.gesture.deltaX+t,s=this.handleRibbonEdges(a+i),n=this.testForCollectionEnd(this.startDragLocation),this.applyTranslateToRibbon(s),this.testForCollectionEnd()&&!n&&this.collection.loadFeed(),e.gesture.deltaX<0?this.pollShowingTabs():this.pollHiddenCollections()}},returnStartingXForTransform:function(){var e=this.$ribbonMenu.css("transform");return"none"===e?this.$ribbonMenu.position().left:parseInt(this.matrixToArray(e)[4],10)},handleRibbonSwipe:function(e){var i,n,s,a,o,r=this,l=2e3;e.gesture.preventDefault(),i=1+e.gesture.distance/r.$el.width(),n=e.gesture.deltaX*i,a=l/e.gesture.velocityX,s=r.handleRibbonEdges(r.returnXForTransform()+n),o=t.throttle(function(){"left"===e.gesture.direction?r.pollShowingTabs():r.pollHiddenCollections()});var d={duration:a,easing:"easeOutCirc",step:r.applyTranslateToRibbon,progress:o,always:function(){r.testForCollectionEnd(s)&&r.collection.loadFeed(),o()}};this.animateSwipe(s,d)},handleTouch:function(e){e.gesture.preventDefault()},handleTouchHold:function(){this.stopSwipeAnimation()},handleTouchDragStart:function(){this.stopSwipeAnimation(),this.startDragLocation=this.returnXForTransform()},stopSwipeAnimation:function(){this.$swipeAnimationElement&&this.$swipeAnimationElement.stop()},handleRibbonMouseEnter:function(){Modernizr.touch||"undefined"==typeof this.$ribbonMenu||(this.$el.on("mousemove",this.handleMouseMove),clearTimeout(this.collectionMarkerTimeout),this.$collectionMarkers&&this.$collectionMarkers.fadeIn(150),this.$firstCollectionMarker&&this.$firstCollectionMarker.fadeIn(150))},handleMouseMove:t.throttle(function(e){this.checkForActiveNavigation(e.clientX,e.clientY)}),handleRibbonMouseOut:function(){Modernizr.touch||(this.$el.off("mousemove",this.handleMouseMove),this.hideRibbonArrows(),this.hideCollectionMarkers())},handleNextArrow:function(t){e(t.currentTarget).hasClass("inactive")||(this.trackingTrigger("ribbon-page-right",{eventName:"ScrollRight",contentCollection:this.getSectionInView(),action:"click"}),this.$previousArrow.removeClass("inactive"),this.shiftRibbonLeft())},handlePreviousArrow:function(t){e(t.currentTarget).hasClass("inactive")||(this.trackingTrigger("ribbon-page-left",{eventName:"ScrollLeft",contentCollection:this.getSectionInView(),action:"click"}),this.$nextArrow.removeClass("inactive"),this.shiftRibbonRight())},handleRibbonAdClick:function(e){var t;return this.broadcast("nyt:ads-fire-ribbon-interstitial"),t=this.$el.find(".ribbon-ad-container"),this.animateRibbon(t),e.preventDefault?void e.preventDefault():!1},animateRibbon:function(e){var t,i,n;return i=Modernizr.touch?-1*this.returnXForTransform():e.offset().left,t=-1*Math.floor(i/this.collectionStoryWidth),n=this.ribbonAnimation(t)},handleArticleClick:function(t){var i,n,s,a,o,r,l,d=e(t.target),c=d.parents("li.collection-item");c.length>0?(s=c.find("> a, #Ribbon > a"),a=s.attr("href"),a=this.trackingAppendParams(a,{action:"click",contentCollection:this.getCollectionByArticleElement(c)}),t.metaKey!==!0?(t.preventDefault(),this.$el.find(".collection-item").removeClass("active"),c.addClass("active"),"tap"===t.type?(r=.25*this.collectionStoryWidth-c.offset().left,l=this.returnXForTransform()+r,n=this.animateSwipe(l)):(o=c.offset().left,i=Math.floor(o/this.collectionStoryWidth),n=this.ribbonAnimation(-i)),n.done(function(){window.location.href=a})):s.attr("href",a)):d.parents(".collection-marker").length>0&&(window.location.href=t.target.href)},handleScroll:function(){var e=this.pageManager.getViewport().top;this.toggleRibbon(e),this.checkRibbonVisibility()},hideCollectionMarkers:function(){this.$collectionMarkers&&this.$collectionMarkers.fadeOut(200),this.$firstCollectionMarker&&this.$firstCollectionMarker.fadeOut(200)},slideCollectionMarkers:function(){var e=this.$firstCollectionMarker.outerWidth(),t=this.$el.find(".first-collection-marker");return t.eq(0).animate({marginLeft:-e},100).promise()},pollHiddenCollections:function(){var t,i,n,s,a=this,o=this.$collectionMarkers.filter(".past-left-border");o.each(function(o,r){i=e(r),t=i.offset().left,t-(a.$el.offset().left+1)>.25*a.collectionStoryWidth&&(i.removeClass("past-left-border"),n=i.closest(".collection").prev().find(".collection-marker"),s=a.createFirstCollectionMarker(n,!0),a.$firstCollectionMarker.last().remove(),a.$firstCollectionMarker=a.$el.find(".first-collection-marker"))})},pollShowingTabs:function(){var t=this,i=this.$collectionMarkers.not(".past-left-border");i.each(function(i,n){t.testForNewMarker(e(n))})},testForNewMarker:function(e){var t,i=this,n=this.$firstCollectionMarker;if(e.offset().left-(i.$el.offset().left+1)<=.25*this.collectionStoryWidth){t=this.createFirstCollectionMarker(e);var s=this.slideCollectionMarkers();s.done(function(){n.remove(),i.$firstCollectionMarker=i.$el.find(".first-collection-marker")})}},createFirstCollectionMarker:function(e,t){var i=e.clone().addClass("first-collection-marker");return t===!0?(i.removeClass("past-left-border"),this.$firstCollectionMarker.before(i)):(e.addClass("past-left-border"),i.appendTo(this.$el)),e},ribbonAnimation:function(e,i){var n,s,a=this,o=this.$ribbonMenu.position().left;return 0===o&&(o=.25*this.collectionStoryWidth),n=o+e*this.collectionStoryWidth,n=this.handleRibbonEdges(n),this.checkArrowsAgainstRibbonBoundaries(n),i?Modernizr.touch?this.applyTranslateToRibbon(n):this.$ribbonMenu.css({left:n}):Modernizr.touch?this.animateSwipe(n):(s=t.throttle(function(){0>e?a.pollShowingTabs():a.pollHiddenCollections()},75),this.$ribbonMenu.stop().animate({left:n},{step:s}).promise())},animateSwipe:function(t,i){var n=this;return i||(i={step:this.applyTranslateToRibbon}),this.stopSwipeAnimation(),this.$swipeAnimationElement=e({animateDummyProperty:n.returnXForTransform()}),this.$swipeAnimationElement.animate({animateDummyProperty:t},i).promise()},checkArrowsAgainstRibbonBoundaries:function(e){e===this.$el.width()-this.getCollectionsWidth()?this.$nextArrow.addClass("inactive"):0===e&&this.$previousArrow.addClass("inactive")},testForCollectionEnd:function(e){return"undefined"==typeof e&&(e=this.$ribbonMenu.position().left),e+this.getCollectionsWidth()<this.$el.width()},handleRibbonEdges:function(e){return e>0&&(e=0),this.testForCollectionEnd(e)&&0===this.collection.feedSource.length&&(e=this.$el.width()-this.getCollectionsWidth()),this.$el.toggleClass("ribbon-start",0===e),e},shiftRibbonRight:function(){var e=this,t=this.storyUnitsInView(),i=e.ribbonAnimation(t);i.done(function(){e.pollHiddenCollections(),e.broadcast("nyt:ribbon-animation-finished")})},shiftRibbonLeft:function(){var e=this,t=this.storyUnitsInView(),i=this.ribbonAnimation(-t);i.done(function(){e.testForCollectionEnd()&&e.collection.loadFeed(),e.pollShowingTabs(),e.broadcast("nyt:ribbon-animation-finished")})},assignSyncedHtmlToView:function(){this.$collectionMarkers=this.$ribbonMenu.find(".collection-marker"),0===this.$el.find(".first-collection-marker").length&&this.createFirstCollectionMarker(this.$collectionMarkers.eq(0)),this.$firstCollectionMarker=this.$el.find(".first-collection-marker").eq(0)},updateCollectionValues:function(){var t=this;this.$ribbonMenu.find(".story").each(function(){var i=e(this),n=i.find(".story-heading");t.truncateText(n,i.find(".kicker").length?48:64),n.toggleClass("long-story-heading",n.height()>48)})},checkForActiveNavigation:function(e){{var t,i=this.$el.width(),n=Math.ceil(.4*i),s=Math.ceil(.6*i),a=n>=e,o=e>=s,r=this.$ribbonMenu.offset().top;this.$ribbonMenu.height()+r}a?t={left:"10px",right:"auto"}:o&&(t={left:"auto",right:"10px"}),a||o?(this.$ribbonNavigation.css(t),this.showRibbonArrows()):this.hideRibbonArrows()},resizeRibbon:function(){this.$el.css("width",this.getWidth())},getWidth:function(){var e=parseInt(this.$el.css("margin-left"),10);return this.$shell.width()-e},showRibbonArrows:function(){this.$ribbonNavigation.fadeIn(300)},hideRibbonArrows:function(){this.$ribbonNavigation&&this.$ribbonNavigation.fadeOut(300)},getCollectionsWidth:function(){return this.collection.length*this.collectionStoryWidth},moveRibbonForAlerts:function(e){this.disableRibbonToggle(),e(this.$el)},disableRibbonToggle:function(){this.toggleDisabled+=1,this.revertRibbon()},enableRibbonToggle:function(){this.toggleDisabled-=1},animateRibbonStories:function(t){var i=200,n=t.find(".active").index();n=0>n?0:n,t.find(".collection-item").slice(n).css({opacity:0,"margin-left":this.animationDistance}).each(function(){i+=200,e(this).animate({opacity:1,"margin-left":0},i)})},checkRibbonVisibility:function(){var e=this.pageManager.isComponentVisible(this.$el);e!==this.isRibbonVisible&&(this.isRibbonVisible=e,this.broadcast("nyt:ribbon-visiblility",e))},revertRibbon:function(){this.ribbonFixed&&(this.ribbonFixed=!1,this.$shell.css("padding-top",""),this.$el.stop(!0).css({position:"","margin-top":"",width:"",top:""}))},slideRibbonDown:function(){var e=this.ribbonHeight+this.ribbonMarginTop+this.ribbonMarginBottom;this.ribbonFixed=!0,this.$shell.css("padding-top",e),this.$el.stop(!0).css({position:"fixed","margin-top":0,width:this.getWidth(),top:-this.ribbonHeight}).animate({top:this.mastheadHeight},this.speed)},slideRibbonUp:function(){this.$el.stop(!0).animate({top:-this.ribbonHeight},this.speed,this.revertRibbon)},toggleRibbon:function(e){var t=0>=e,i=e>this.oldScrollTop,n=e<this.oldScrollTop,s=Math.abs(e-this.oldScrollTop);if(!(this.toggleDisabled>0)){if(t)return this.oldScrollTop=e,void this.revertRibbon();if(i&&this.ribbonFixed){if(s<this.minDownDistance)return;this.slideRibbonUp(),this.broadcast("nyt:ribbon-visiblility",!1)}else if(n&&!this.ribbonFixed){if(s<this.minUpDistance)return void(this.oldScrollTop=e);this.slideRibbonDown(),this.broadcast("nyt:ribbon-visiblility",!0)}this.oldScrollTop=e}},getSectionInView:function(){return e.trim(this.$el.find(".first-collection-marker").text())},getCollectionByArticleElement:function(t){return e.trim(t.parents(".collection-menu").prev(".collection-marker").text())}}));return l}),define("shared/ribbon/instances/ribbon",["jquery/nyt","shared/ribbon/views/ribbon","backbone/nyt"],function(e,t){e("#ribbon").length>0&&new t}),define("shared/masthead/templates",["underscore/nyt"],function(_){var templates={};return templates.profileIcon=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<span class="avatar" role="presentation">\n<a href="http://timespeople.nytimes.com/view/user/'+(null==(__t=userData.getUserId())?"":__t)+'/settings.html"><img src="'+(null==(__t=userData.getImageUrl())?"":__t)+'" alt="" /></a>\n</span>';return __p},templates.userName=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<button class="button user-name-button">\n<span class="button-text">'+(null==(__t=getTruncatedUserName(15))?"":__t)+'</span>\n<i class="icon user-icon"></i>\n<i class="icon caret-icon"></i>\n</button>';return __p},templates.userNameModalContent=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<ul>\n<li><a href="http://timespeople.nytimes.com/view/user/'+(null==(__t=userData.getUserId())?"":__t)+'/settings.html">My Profile</a></li>\n<li><a href="'+(null==(__t=hosts.myaccount)?"":__t)+'/membercenter/myaccount.html">My Account</a></li>\n<li><a href="'+(null==(__t="http:"+hosts.www)?"":__t)+'/saved">My Saved Items</a></li>\n<li><button class="button log-out-button">Log Out</button></li>\n</ul>';return __p},templates.userNameModalTitle=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",""!=userData.getImageUrl()&&(__p+='<span class="avatar">\n<a href="http://timespeople.nytimes.com/view/user/'+(null==(__t=userData.getUserId())?"":__t)+'/settings.html"><img src="'+(null==(__t=userData.getImageUrl())?"":__t)+'" /></a>\n</span>'),__p+='\n<span class="user-name-subscription">\n<span class="user-name">'+(null==(__t=userData.getUserName())?"":__t)+'</span>\n<span class="user-subscription"><a href="https://myaccount.nytimes.com/membercenter/myaccount.html">'+(null==(__t=subscription.label)?"":__t)+"</a></span>\n</span>";return __p},templates.userSettingsModal=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="menu edition-menu">\n<h5 class="modal-heading">Edition</h5>\n<ul>\n<li><a href="http://www.nytimes.com" data-edition="us">U.S.</a></li>\n<li><a href="http://global.nytimes.com" data-edition="global">International</a></li>\n<li><a href="http://cn.nytimes.com" data-edition="chinese">中文 (Chinese)</a></li>\n</ul>\n</div>\n<div class="menu help-menu">\n<h5 class="modal-heading">Help</h5>\n<ul>\n<li><a href="http://www.nytimes.com/content/help/front.html">FAQ</a></li>\n<li><a href="http://www.nytimes.com/content/help/contact/directory.html">Contact Us</a></li>\n</ul>\n</div>\n',showTypeSizer&&(__p+='\n<div class="menu type-sizer-menu">\n<h5 class="modal-heading">Type Size</h5>\n<ul>\n<li data-size="small" class="type-sizer-small"><a href="javascript:;">A <span class="visually-hidden">Type size small</span></a></li>\n<li data-size="medium" class="type-sizer-medium"><a href="javascript:;">A <span class="visually-hidden">Type size medium</span></a></li>\n<li data-size="large" class="type-sizer-large"><a href="javascript:;">A <span class="visually-hidden">Type size large</span></a></li>\n</ul>\n</div>\n'),__p+="";return __p},templates}),define("shared/masthead/views/masthead",["jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/hosts","foundation/models/user-data","shared/masthead/templates"],function(e,t,i,n,s,a){var o=i.registerView("masthead").extend({el:"#masthead",events:{"click .home-button":"handleHomeClick","click .search-button":"handleSearchClick","click .sections-button":"handleSectionsClick","click .branding a":"handleLogoClick","click .editions-menu a":"handleEditionClick"},nytEvents:{"nyt:ribbon-visiblility":"accomodateRibbon","nyt:masthead-search-toggle":"handleSearchToggle","nyt:messaging-critical-alerts-move-furniture":"handlePageAlerts","nyt:messaging-suggestions-move-furniture":"handlePageAlerts","nyt:messaging-notification-count-update":"handleMessagingCountChange","nyt:masthead-edition-change":"handleEditionClick"},initialize:function(){this.trackingBaseData={action:"click",contentCollection:this.pageManager.getMeta("article:section"),region:"TopBar"}},handleUserReady:function(){var e=this.$el.find(".user-tools-button-group");s.isLoggedIn()?e.prepend(a.userName(s)):e.find(".login-button").removeClass("hidden")},accomodateRibbon:function(e){e?this.$el.addClass("ribbon-visible"):this.$el.removeClass("ribbon-visible")},handlePageAlerts:function(e){e(this.$el)},handleHomeClick:function(t){var i=e(t.currentTarget).closest(".home-button"),n=this.trackingAppendParams(i.data("href"),{module:"HomePage-Button"});window.location=n},handleSearchClick:function(e){this.broadcast("nyt:masthead-search-click",e),this.trackingTrigger("masthead-search-click",{module:"SearchOpen",eventName:"OpenSearchBar"})},handleSectionsClick:function(e){this.broadcast("nyt:masthead-section-click",e)},handleLogoClick:function(t){var i=e(t.currentTarget),n=this.trackingAppendParams(i.attr("href"),{module:"HomePage-Title"});i.attr("href",n)},handleSearchToggle:function(e){this.$el.find(".search-button")[e?"addClass":"removeClass"]("active")},handleMessagingCountChange:function(e){var t=this.$el.find(".notifications-button");e>0?(t.find(".button-text").html(e),t.addClass("new")):(t.find(".button-text").html("0"),t.removeClass("new"))},handleEditionClick:function(t){var i=e(t.target),n=i.data("edition"),s=i.attr("href");this.pageManager.setEdition(n);var a="";switch(n){case"us":a="EditionToggleToUS";break;case"global":a="EditionToggleToGlobal";break;case"chinese":a="EditionToggleToCHNS"}s=this.trackingAppendParams(s,{module:a}),i.attr("href",s)}});return o}),define("shared/masthead/views/in-story-theme",["jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/views/page-manager"],function(e,t,i,n){var s=i.extend({el:"#masthead",events:{"click .kicker":"scrollToTop","click .kicker-label a":"handleSectionClick"},nytEvents:{"nyt:page-scroll":"toggleTheme","nyt:page-scroll-after":"setSwitchPosition","nyt:page-resize":"handleResize","nyt:page-breakpoint":"handleBreakPoint","nyt:masthead-switch-change":"handleSwitchChange","nyt:masthead-position-change":"handlePositionChange"},defaultSettings:{themeClass:"in-content",switchPosition:0,shouldScrollAway:!1,currentBreakPoint:n.getCurrentBreakpoint(),metaContainer:".story-meta",contentSelector:"#story",contentSwitchPointSelector:".story-meta .kicker"},initialize:function(e){this.settings=t.extend({},this.defaultSettings,e)},handleDomReady:function(){this.isTransparent()?this.setSwitchOverrides("#story .story-body-text",!0):this.$switchSelector=e("#story").find(".story-meta .kicker"),this.$pageContainer=this.$el.find(".container"),this.$mastheadKicker=this.$el.find(".kicker"),this.setSwitchPosition(),this.toggleTheme()},handleSwitchChange:function(e,t){this.setSwitchOverrides(e,t)},handlePositionChange:function(e){this.settings.shouldScrollAway=e||!1,e||this.$el.css("position","fixed"),this.toggleTheme()},handleResize:function(){n.isDomReady()&&(this.isTransparent()?this.setSwitchOverrides("#story .story-body-text",!0):this.$switchSelector=e("#story").find(".story-meta .kicker"),this.moveMastheadKicker(),this.settings.currentBreakPoint<1010?this.removeStoryTheme():this.toggleTheme())},setSwitchOverrides:function(t,i){this.settings.shouldScrollAway=i||!1,this.$switchSelector=e(t),this.setSwitchPosition(!0),this.toggleTheme()},setSwitchPosition:function(e){this.$switchSelector.length>0&&(this.settings.switchPosition=this.$switchSelector.offset().top-this.$el.height()),e===!0&&(this.settings.overridePosition=this.settings.switchPosition)},toggleTheme:function(){var e=this.settings.overridePosition||100;this.settings.switchPosition<e&&(this.settings.switchPosition=e);var t=n.getViewport().top,i=t>this.settings.switchPosition,s=t>e,a=this.$el.hasClass(this.settings.themeClass),o="nyt:masthead-storytheme";i&&!a&&this.settings.currentBreakPoint>=1010?(this.settings.shouldScrollAway===!0&&this.$el.css("position","fixed"),this.addStoryTheme(),this.broadcast(o,!0)):!s&&a?(this.settings.shouldScrollAway===!0&&this.$el.css("position","absolute"),this.removeStoryTheme(),this.broadcast(o,!1)):a||this.settings.shouldScrollAway!==!0||this.$el.css("position","absolute")},addStoryTheme:function(){this.isTransparent()||this.$el.find(".branding").fadeOut(300).end().addClass(this.settings.themeClass),this.$el.find(this.settings.metaContainer).fadeIn(300).end().addClass(this.settings.themeClass),this.moveMastheadKicker()},removeStoryTheme:function(){this.isTransparent()||this.$el.find(".branding").stop(!1,!0).show().end().removeClass(this.settings.themeClass),this.$el.find(this.settings.metaContainer).stop().hide().end().removeClass(this.settings.themeClass)
},moveMastheadKicker:function(){var e;this.$mastheadKicker&&(this.settings.currentBreakPoint>=10050&&this.settings.currentBreakPoint<10070?(e=this.$pageContainer.width()-1389,this.$mastheadKicker.css({"margin-left":Math.floor(e/2)+"px"})):10070===this.settings.currentBreakPoint?this.$mastheadKicker.css("margin-left","138px"):this.settings.currentBreakPoint<10050&&this.$mastheadKicker.css("margin-left","0px"))},scrollToTop:function(t){var i=e(t.target);i.is("a")||i.parent().is("a")||e("html, body").animate({scrollTop:0},400)},handleBreakPoint:function(e){this.settings.currentBreakPoint=e},isTransparent:function(){return this.$el.hasClass("masthead-theme-transparent")||this.$el.hasClass("masthead-theme-transparent-ffffff")?!0:void 0},handleSectionClick:function(t){var i=e(t.currentTarget),n=this.trackingAppendParams(i.attr("href"),{module:"SF-FixedNav",action:"click",contentCollection:this.pageManager.getMeta("article:section"),region:"TopBar"});i.attr("href",n)}});return s}),define("shared/searchform/models/search-suggest",["foundation/models/base-model"],function(e){var t=e.extend({defaults:{query:"",results:[]}});return t}),define("shared/searchform/collections/search-suggest",["backbone/nyt","foundation/collections/base-collection","foundation/views/page-manager","shared/searchform/models/search-suggest","foundation/hosts"],function(e,t,i,n,s){var a=t.extend({model:n,mobileBaseUrl:s.mobileWeb,desktopBaseUrl:s.www,settings:{numOfSuggestions:7},query:"",sync:function(t,i,n){var s="/svc/suggest/v1/homepage?query="+this.query;return n.url=this.pageManager.getCurrentBreakpoint()<120?this.mobileBaseUrl+s:this.desktopBaseUrl+s,e.sync(t,i,n)},parse:function(e){return{query:e[0],results:e[1].slice(0,this.settings.numOfSuggestions)}},newQuery:function(e){this.query=e,this.fetch()}});return a}),define("shared/searchform/templates",["underscore/nyt"],function(_){var templates={};return templates.autoSuggest=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<li><a href="'+(null==(__t=queryUrl)?"":__t)+'">\n'+(null==(__t=suggest.replace(queryRegExp,"<strong>"+query+"</strong>"))?"":__t)+"\n</a></li>";return __p},templates}),define("shared/searchform/helpers/search-form-mixin",["jquery/nyt","underscore/nyt","foundation/lib/polyfills/placeholder","shared/searchform/collections/search-suggest","shared/searchform/templates","foundation/hosts"],function(e,t,i,n,s,a){var o=t.extend({},{collection:new n,searchBaseUrl:a.search+"/search/sitesearch/#/",searchMobileUrl:a.mobileWeb+"/search?query=",KEYS:{ENTER:13,ESC:27,UP_ARROW:38,DOWN_ARROW:40,LEFT_ARROW:37,RIGHT_ARROW:39},initialize:function(){var e=this.pageManager.getMeta("article:section")||"";t.bindAll(this,"handlePageClicks"),this.trackingBaseData={action:"click",contentCollection:e,region:"TopBar"}},handleDomReady:function(){this.$list=this.$el.find(".auto-suggest"),this.$clearButton=this.$el.find(".clear-button"),this.$overlay=this.$shell.find(".search-overlay"),this.$input=this.$el.find(".search-input"),this.$submitButton=this.$el.find(".submit-button"),this.disableSubmitButton(),this.listenTo(this.collection,"sync change",this.render),this.throttledSuggestions=t.debounce(this.getAutoSuggestions,250),this.afterInitialize()},afterInitialize:e.noop,render:function(){var e,t="",i=this.collection.toJSON()[0],n=new RegExp(i.query,"ig"),a=s.autoSuggest,o=i.results.length;if(o>0&&this.getSearchValue().length>0){for(e=0;o>e;e+=1)t+=a({query:i.query,queryUrl:this.getSearchUrl(i.results[e]),suggest:i.results[e],queryRegExp:n});this.$list.show().find("ol").html(t)}else this.$list.hide()},handleKeyDown:function(e){var t=e.which;t===this.KEYS.ENTER&&e.preventDefault()},handleKeyUp:function(e){e.preventDefault();var t=e.which;t===this.KEYS.UP_ARROW||t===this.KEYS.DOWN_ARROW?this.navigateAutoSuggestions(t):t===this.KEYS.ENTER?this.handleEnterKey(e):t===this.KEYS.RIGHT_ARROW||t===this.KEYS.LEFT_ARROW?this.handleRightLeftKey(e):(this.$clearButton[this.getSearchValue().length>0?"fadeIn":"fadeOut"](200),this.getSearchValue().length?this.$submitButton.hasClass("disabled")&&this.$submitButton.removeClass("disabled"):this.disableSubmitButton(),this.throttledSuggestions())},handleEnterKey:function(){this.submitSearch()},handleRightLeftKey:e.noop,handleClearButton:function(e){e.preventDefault(),this.setSearchValue(""),this.$clearButton.fadeOut(200),this.disableSubmitButton(),this.$input.focus(),i()},setSearchValue:function(e){this.$input.val(e)},getSearchValue:function(){return e.trim(this.$input.val())},hideAutoSuggest:function(){this.$list.hide()},getAutoSuggestions:function(){var e=this.getSearchValue();e.length>1?this.collection.newQuery(e):this.hideAutoSuggest()},getSearchUrl:function(e){return this.pageManager.getCurrentBreakpoint()<120?this.searchMobileUrl+e+"&sort=rel":this.searchBaseUrl+e},navigateAutoSuggestions:function(e){var t,i;i=this.$list.find(".active"),t=i.parent().index()||0,t+=e===this.KEYS.UP_ARROW?-1:1,this.$list.find("a").removeClass("active").eq(t).addClass("active"),this.setSearchValue(this.$list.find("a").eq(t).text())},submitSearch:function(e){var t,i=this.getSearchValue();e&&e.preventDefault(),i&&(t=this.trackingAppendParams(this.getSearchUrl(i),{module:"SearchSubmit"}),this.$el.is(":visible")&&(window.location=t))},handlePageClicks:function(){this.hideAutoSuggest()},disableSubmitButton:function(){this.$submitButton.addClass("disabled")}});return o}),define("shared/masthead/views/search",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/searchform/helpers/search-form-mixin"],function(e,t,i,n){var s=i.extend(t.extend({},n,{el:e("#masthead").find(".search-flyout-panel"),events:{"click .close-button":"close","keyup .search-input":"handleKeyUp","keydown .search-input":"handleKeyDown","click .submit-button":"submitSearch","click .clear-button":"handleClearButton"},nytEvents:{"nyt:masthead-search-click":"toggle","nyt:masthead-search-toggle":"handleSearchToggle","nyt:navigation-search-click":"toggle","nyt:search-close-ready":"close"},slideTiming:100,afterInitialize:function(){this.trackingBaseData["WT.nav"]="searchWidget",this.$input.removeAttr("placeholder")},open:function(){var e=this;this.$el.slideDown(this.slideTiming,function(){e.$el.find(".control").fadeIn(e.slideTiming).end().find(".search-input").val("").focus()}),this.broadcast("nyt:masthead-search-toggle",!0),this.$shell.on("click",this.handlePageClicks),this.subscribeOnce("nyt:page-key-esc",this.close),this.$overlay.fadeIn(200),this.$html.addClass("search-active")},close:function(){var e=this;this.$html.hasClass("search-active")&&(this.$el.find(".control").fadeOut(this.slideTiming,function(){e.$el.slideUp(e.slideTiming,function(){e.$html.removeClass("search-active")})}),this.broadcast("nyt:masthead-search-toggle",!1),this.$shell.off("click",this.handlePageClicks),this.setSearchValue(""),this.$overlay.fadeOut(200))},toggle:function(){this[this.$el.is(":visible")?"close":"open"]()},isSearchButton:function(t){var i=e(t).hasClass("search-button"),n=1===e(t).parents(".search-button").length;return i||n},isSearchFlyout:function(t){var i=e(t).hasClass("search-flyout-panel"),n=1===e(t).parents(".search-flyout-panel").length;return i||n},handlePageClicks:function(e){this.isSearchButton(e.target)||this.isSearchFlyout(e.target)||this.close(),this.hideAutoSuggest()},handleSearchToggle:function(e){e===!1&&(this.$el.find(".submit-button").addClass("disabled"),this.$el.find(".clear-button").hide())}}));return s}),define("shared/masthead/views/user-settings-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","shared/masthead/templates","foundation/cookies"],function(e,t,i,n,s){var a=i.extend({events:{"click .edition-menu a":"handleEditionClick","click .type-sizer-menu li":"handleFontSizeClick","click .help-menu a":"handleHelpMenuClick"},nytEvents:{"nyt:fontsizer-initialize":"handleFontSizeChange","nyt:fontsizer-change":"handleFontSizeChange"},defaultSettings:{id:"user-settings-modal",binding:".user-settings-button",tailDirection:"up-right",tailTopOffset:-8,tailLeftOffset:-1,width:"260px",toggleSpeed:1,showTypeSizer:!0,openCallback:function(){this.$target.addClass("active"),this.subscribeOnce("nyt:page-scroll",this.close)},closeCallback:function(){this.$target.removeClass("active")}},webTrendsNav:"user-settings-modalContainer",initialize:function(e){var i=this.pageManager.getMeta("article:section")||"";this.settings=t.extend({},this.defaultSettings,e),this.settings.modalContent=s.userSettingsModal({showTypeSizer:this.settings.showTypeSizer}),this.trackingBaseData={action:"click",region:"TopBar","WT.nav":this.webTrendsNav,contentCollection:i}},handleDomReady:function(){this.render()},render:function(){var e=new n(this.settings);this.setElement(e.$modal),e.$modal.find("a[data-edition="+this.pageManager.getEdition()+"]").addClass("selected"),e.addToPage(),this.handleFontSizeChange()},handleEditionClick:function(e){this.broadcast("nyt:masthead-edition-change",e,{"WT.nav":this.webTrendsNav})},handleHelpMenuClick:function(t){var i=e(t.target),n=i.attr("href");n&&(n=this.trackingAppendParams(n,{}),i.attr("href",n))},handleFontSizeClick:function(t){var i=e(t.currentTarget).data("size");this.broadcast("nyt:fontsizer-change",i)},handleFontSizeChange:function(e){var t="type-size-selected";e=e||this.pageManager.getMeta("fontsizer_typeSize"),this.$el.find(".type-sizer-menu li").removeClass(t),this.$el.find(".type-sizer-"+e).addClass(t)}});return a}),define("shared/masthead/views/user-name-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","shared/masthead/templates","foundation/models/user-data","foundation/hosts"],function(e,t,i,n,s,a,o){var r=i.extend({events:{"click .premier-subscriber a":"handleUserSubscriptionClick","click li a":"handleUserOptionClick"},defaultSettings:{id:"user-name-modal",modalTitle:"",modalContent:"",binding:".user-name-button",tailDirection:"up-right",tailTopOffset:-8,tailLeftOffset:-1,width:"260px",toggleSpeed:1,openCallback:function(){this.$target.addClass("active"),this.listenToOnce(this.pageManager,"nyt:page-scroll",this.close)},closeCallback:function(){this.$target.removeClass("active")}},initialize:function(e){t.bindAll(this,"handleLogOut"),this.settings=t.extend({},this.defaultSettings,e),this.trackingBaseData={module:"ProfileDropdown",action:"click",region:"Masthead","WT.nav":"shell"}},handleUserReady:function(){var e,t=this.getSubscriptionLabel(a);this.settings.modalTitle=s.userNameModalTitle({userData:a,subscription:t}),this.settings.modalContent=s.userNameModalContent({userData:a,hosts:o}),this.render(),e=this.$el.find(".user-subscription"),""===t.label&&e.remove(),""!==t.className&&e.addClass(t.className),""!==t.link&&e.find("a").attr("href",t.link),"NYT Now Subscriber"===t.label&&e.find("a").after('<i class="icon dot-logo-icon"></i>'),this.listenToOnce(a,"nyt:user-image-loaded",this.handleProfileImage),this.$el.on("click",".log-out-button",this.handleLogOut)},getSubscriptionLabel:function(e){var t={label:"",className:"",link:""};return e.isPremierSubscriber()?(t.label="Times Premier Subscriber",t.className="premier-subscriber",t.link="http://www.nytimes.com/times-insider"):e.isWebSubscriber()&&e.isMobileSubscriber()?t.label="All Digital Access Subscriber":e.isTabletSubscriber()&&e.isWebSubscriber()?t.label="Tablet and Web Subscriber":e.isSmartphoneSubscriber()&&e.isWebSubscriber()?t.label="Smartphone and Web Subscriber":e.isWebSubscriber()?t.label="Web Subscriber":e.isNytNowSubscriber()&&e.isCookingSubscriber()?(t.label="NYT Now & Cooking Subscriber",t.link="http://www.nytnow.com"):e.isNytNowSubscriber()&&e.isOpinionSubscriber()?(t.label="NYT Now & NYT Opinion Subscriber",t.link="http://www.nytimes.com/content/help/mobile/mobile.html"):e.isNytNowSubscriber()?(t.label="NYT Now Subscriber",t.link="http://www.nytimes.com/content/help/mobile/nyt-now/nyt-now.html"):e.isOpinionSubscriber()&&e.isCookingSubscriber()?t.label="NYT Opinion & Cooking Subscriber":e.isCookingSubscriber()?t.label="Cooking Subscriber":e.isOpinionSubscriber()?(t.label="NYT Opinion Subscriber",t.link="http://www.nytimes.com/content/help/mobile/nyt-opinion/nyt-opinion.html"):e.isCrosswordsSubscriber()&&(t.label="Crosswords Subscriber"),t},render:function(){var e=new n(this.settings);this.setElement(e.$modal),e.addToPage()},handleProfileImage:function(){var e=s.profileIcon({userData:a});this.$el.find(".modal-heading").prepend(e)},handleUserSubscriptionClick:function(t){var i=e(t.currentTarget),n=this.trackingAppendParams(i.attr("href"),{contentCollection:"TimesPremier-InsideStory"});i.attr("href",n)},handleUserOptionClick:function(t){var i=e(t.target),n=i.text(),s=i.attr("href"),a={action:"Click",region:"TopBar","WT.nav":"shell"};s&&(n&&(a.module=n.replace(/\s/g,"")),s=this.trackingAppendParams(s,a),i.attr("href",s))},handleLogOut:function(){var e="http:"+o.www+"/logout";e=this.trackingAppendParams(e,{module:"LogOut",action:"Click",region:"TopBar","WT.nav":"shell"}),window.location=e}});return r}),define("shared/masthead/instances/masthead",["jquery/nyt","shared/masthead/views/masthead","shared/masthead/views/in-story-theme","shared/masthead/views/search","shared/masthead/views/user-settings-modal","shared/masthead/views/user-name-modal"],function(e,t,i,n,s,a){new t,new n,new s({fixedOverride:!0,openCallback:function(){this.$target.addClass("active"),this.listenToOnce(this.pageManager,"nyt:masthead-storytheme",this.close)}}),new a({fixedOverride:!0,openCallback:function(){this.$target.addClass("active"),this.listenToOnce(this.pageManager,"nyt:masthead-storytheme",this.close)}}),e("#masthead .kicker").text().length>1&&new i}),define("shared/searchform/views/search-form",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/searchform/helpers/search-form-mixin"],function(e,t,i,n){var s=i.extend(t.extend({},n,{events:{"keyup .search-input":"handleKeyUp","keydown .search-input":"handleKeyDown","click .submit-button":"submitSearch","click .clear-button":"handleClearButton"},afterInitialize:function(){this.$shell.on("click",this.handlePageClicks)}}));return s}),define("shared/searchform/instances/search-form",["jquery/nyt","foundation/views/page-manager","shared/searchform/views/search-form"],function(e,t,i){t.getMeta("errorpage")&&new i({el:e(".error-page .search-form-control")})}),define("shared/messaging/templates",["underscore/nyt"],function(_){var templates={};return templates.message=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){if(__p+="",closeButton&&(__p+='\n<button class="button close-message">\n<i class="icon"></i>\n<span class="visually-hidden">Close alert</span>\n</button>\n'),__p+="",sub_type&&(sub_type=sub_type.replace(/([A-Z])/g,"-$1").toLowerCase(),"-"===sub_type.charAt(0)&&(sub_type=sub_type.substr(1))),__p+='<div class="message '+(null==(__t=sub_type)?"":__t)+'" data-messageId="'+(null==(__t=id)?"":__t)+'"><i class="icon"></i>',label&&(__p+='\n<span class="label">'+(null==(__t=label)?"":__t)+"</span>\n"),__p+='<span class="message-content">\n<span class="message-title">'+(null==(__t=title)?"":__t)+"</span>\n",buttons.length>0){__p+="\n";for(var i=0;i<buttons.length;i++)buttons[i].url&&(__p+='\n<a href="'+(null==(__t=buttons[i].url)?"":__t)+'" class="button message-button action-button">'+(null==(__t=buttons[i].text)?"":__t)+"</a>\n");__p+="\n"}if(__p+="\n",1===display_type_id&&start_time){var minutes,hours,formatted,date=new Date(1e3*start_time);hours=date.getHours(),minutes=date.getMinutes(),minutes=9>=minutes?"0"+minutes:minutes,ampm=hours>=12?"PM":"AM",hours=hours>12?hours-12:hours,formatted=""+hours+":"+minutes+" "+ampm,__p+='\n<span class="timestamp">\n'+(null==(__t=formatted)?"":__t)+"\n</span>\n"}__p+="\n",4===display_type_id&&(__p+="\n<a href='#' class=\"close-message\">"+(null==(__t=payload.dsm_cpy)?"":__t)+"</a>\n"),__p+="\n</span></div>"}return __p},templates.messenger=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="message-bed"></div>';return __p},templates.notificationModals=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){if(__p+="",__p+=notification_type?'\n<div class="message comment-'+(null==(__t=notification_type)?"":__t)+'-message">\n':'\n<div class="message">\n',__p+='\n<a href="'+(null==(__t=link)?"":__t)+'">'+(null==(__t=title)?"":__t)+"\n","reply"===notification_type&&(__p+="\n"+(null==(__t=referenced_comment)?"":__t)+"\n"),__p+='\n</a>\n<span class="message-metadata">\n<i class="icon"></i>\n',created){__p+="\n";var hours,formatted;__p+="\n";var time=created.split(/[- :]/);__p+="\n";var date=new Date(time[0],time[1]-1,time[2],time[3],time[4],time[5]);__p+="\n",hours=date.getHours()>12?date.getHours()-12:date.getHours(),__p+="\n",formatted=""+hours+":"+date.getMinutes()+" "+(date.getHours()>=12?"PM":"AM")+" E.S.T.",__p+='\n<time class="timestamp" datetime="'+(null==(__t=created)?"":__t)+'">'+(null==(__t=formatted)?"":__t)+"</time>\n"}__p+="\n</span>\n</div>"}return __p},templates.notificationsModal=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){if(__p+="","default"===show)__p+='\n<div class="message default-message">\n<span class="message-content">Notifications related to your NYTimes activity will be collected for you here.</span>\n</div>\n';else{if(__p+="\n",__p+=notification_type?'\n<div class="message comment-'+(null==(__t=notification_type)?"":__t)+'-message">\n':'\n<div class="message">\n',__p+="\n",user_avatar&&(__p+='\n<span class="avatar"><img src="'+(null==(__t=user_avatar)?"":__t)+'" /></span>\n'),__p+='<div class="message-content">\n',__p+=link?'\n<a class="link" href="'+(null==(__t=link)?"":__t)+'">'+(null==(__t=title)?"":__t)+"</a>\n":"\n"+(null==(__t=title)?"":__t)+"\n",__p+="",("recommendation"===notification_type||"published"===notification_type)&&(__p+="\n",referenced_comment&&(__p+='\n<p class="referenced-comment">'+(null==(__t=referenced_comment)?"":__t)+"</p>\n"),__p+="\n"),__p+='\n<i class="icon"></i>\n',created){__p+="\n";var hours,formatted;__p+="\n";var time=created.split(/[- :]/);__p+="\n";var date=new Date(time[0],time[1]-1,time[2],time[3],time[4],time[5]);__p+="\n",hours=date.getHours()>12?date.getHours()-12:date.getHours(),__p+="\n",formatted=""+hours+":"+date.getMinutes()+" "+(date.getHours()>=12?"PM":"AM")+" E.S.T.",__p+='\n<time class="timestamp" datetime="'+(null==(__t=created)?"":__t)+'">'+(null==(__t=formatted)?"":__t)+"</time>\n"}__p+="\n</div>\n</div>\n"}__p+=""}return __p},templates}),define("shared/messaging/views/message",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/messaging/templates"],function(e,t,i,n){var s=i.registerView("messaging").extend({className:"message-container hidden",events:{"click .close-message":"dismissed","mousedown .action-button":"acknowledged","mousedown .action-link":"acknowledged"},defaults:{closeButton:!0,dismissAcknowledged:!0,hiddenClass:"hidden",revealClass:"",show:function(){this.$el.removeClass(this.settings.hiddenClass).addClass(this.settings.revealClass)},hide:function(){this.$el.removeClass(this.settings.revealClass).addClass(this.settings.hiddenClass)}},initialize:function(e){this.settings=t.extend({},this.defaults,e),this.template=n[this.settings.template],this.subscribe(this,"nyt:messaging-message-expired",this.expired)},render:function(){return this.$el.html(this.template(t.extend(this.model.toJSON(),this.settings))).addClass(this.settings.hiddenClass),this.model.get("links")&&this.insertLinks(),this},replaceBetween:function(e,t,i,n){return n.substring(0,e)+i+n.substring(t)},insertLinks:function(){var e,t,i,n,s=this.$el.find(".message-title"),a=s.html(),o=this.model.get("links");o.length>1&&o.sort(function(e,t){return t.start-e.start});for(var r=0;r<o.length;r++)if(e=o[r].offset,i=o[r].count,n=decodeURI(o[r].url),e+i&&(t=e+i),n&&"null"!==n)if("undefined"!=typeof e&&"undefined"!=typeof t){if(o[r-1]&&t>o[r-1].start)break;var l=a.substring(e,t),d='<a class="action-link" href="'+n+'">'+l+"</a>";a=this.replaceBetween(e,t,d,a)}else a='<a class="action-link" href="'+n+'">'+a+"</a>";s.html(a)},reveal:function(e){e?this.settings.show.call(this):this.settings.hide.call(this)},dimensions:function(){return{width:this.$el.outerWidth(),height:this.$el.outerHeight()}},displayed:function(t){var i=this.$el.find(".message");t=t||0,i.hasClass("theme-new")&&window.setTimeout(function(){i.removeClass("theme-new").addClass("theme-read").delay(t).queue(function(){e(this).addClass("no-transition").dequeue()})},t),this.model.displayed()},showOnce:function(){this.model.showOnce()},acknowledged:function(){this.settings.dismissAcknowledged&&this.model.acknowledged(),this.local(this,"nyt:messaging-message-view-acknowledged",this)},expired:function(){this.model.expired(),this.local(this,"nyt:messaging-message-view-expired",this)},dismissed:function(e){this.model.dismissed(),this.local(this,"nyt:messaging-message-view-dismissed",this),e.preventDefault()}});return s}),define("shared/messaging/models/message",["backbone/nyt","foundation/models/base-model","foundation/models/page-storage"],function(e,t,i){var n=t.extend({defaults:{display_type_id:"1",id:"",title:"",status:"new",sub_type:"",label:"",pub_date:"",start_time:"",end_time:"",links:[],buttons:[],payload:{}},showOnce:function(){this.saveToLocalStorage()},displayed:function(){this.set("status","displayed")},acknowledged:function(){this.set("status","acknowledged"),this.saveToLocalStorage()},expired:function(){this.set("status","expired"),this.saveToLocalStorage()},dismissed:function(){this.set("status","dismissed"),this.saveToLocalStorage()},saveToLocalStorage:function(){var e=this.get("id"),t=this.get("version"),n=(new Date).getTime(),s=i.get("messaging"),a=s?s+","+e:e;t&&(a=a+"-"+t+"-"+n),i.set("messaging",a)}});return n}),define("shared/messaging/collections/messages",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/collections/base-collection","foundation/views/websockets-transport","shared/messaging/models/message","foundation/hosts","foundation/cookies","foundation/models/page-storage"],function(e,t,i,n,s,a,o,r,l){var d=n.extend({model:a,url:o.msg+"/svc/message/v1/list/global.json",pageStorageKey:"messaging",defaultSettings:{webSockets:!0,longPoll:!1,fauxLongPoll:!1,interval:10},initialize:function(e){this.isHomepage="Homepage"===this.pageManager.getMeta("PT"),this.cleanLocalStorage(),this.settings=t.extend({},this.defaultSettings,e),t.bindAll(this,"fetch","fetchSuccess","handleSave","stopSaving"),this.received={},this.pageManager.isDomReady()?this.prepareToConnect():this.subscribe(this.pageManager,"nyt:page-ready",this.prepareToConnect)},prepareToConnect:function(){this.isHomepage?(this.settings.fauxLongPoll=!0,this.settings.webSockets=!1,this.makeHTTPRequest()):this.initWebSockets()},initWebSockets:function(){var t=r.readCookie("NYT-S")||"";s.registerClient({name:"messaging",collection:this,fabrikApp:"hermes.push",cookies:{"nyt-s":t},handleMessage:this.handleMessage,notifyOnError:e.noop,handleFailover:this.switchToHTTP})},makeHTTPRequest:function(){var e=this;this.url=o.msg+"/svc/message/v1/list/global.json",this.fetch({success:function(t,i){e.fetchSuccess(t,i)},error:function(){}})},switchToHTTP:function(e){e.settings.fauxLongPoll=!0,e.settings.webSockets=!1,e.stopSaving(),e.makeHTTPRequest()},sync:function(e,t,n){return this.settings.longPoll?(n.timeout=2e3,i.sync(e,t,n)):(n.cache=!1,i.sync(e,t,n))},parse:function(e){return e&&e.results?e.results.messages:void 0},handleMessage:function(e,t){var i;e.body&&(i=JSON.parse(e.body),t.add(i),t.handleSave(),t.fetchSuccess(t,i))},fetchSuccess:function(e,t){var i,n,s,a,o,r,l,d={},c=e||this;if(t){for(i=0,n=c.length;n>i;i+=1)s=c.at(i),a=s.get("id"),o=s.get("title"),r=this.categorizeMessage(s),d[r]=d[r]||[],a&&o&&(this.expired(s)||this.inactive(s)||this.isInLocalStorage(s)||this.exists(a)||this.titleExists(o)||(this.received[a]=o,d[r].push(this.get(s.id))));for(r in d)c.trigger(r,d[r]);l=t.count,l&&c.trigger("nyt:messaging-count-received",l)}this.settings.fauxLongPoll&&window.setTimeout(function(){c.makeHTTPRequest()},1e3*c.settings.interval)},categorizeMessage:function(e){var t,i=e.get("display_type_id");switch(i){case 1:e.get("label")||e.set("label","Breaking News"),t="nyt:messaging-breaking-news-received";break;case 2:e.get("label")||e.set("label","Account Alert"),t="nyt:messaging-account-alert-received";break;case 3:e.get("label")||e.set("label","Live Video"),t="nyt:messaging-video-received";break;case 4:t="nyt:messaging-velcro-received";break;case 5:t="nyt:messaging-notification-received";break;default:t="nyt:messaging-message-received"}return t},expired:function(e){var t,i=e.get("end_time"),n=(new Date).getTime();return i?(t=new Date(1e3*i).getTime(),n>t?!0:!1):void 0},exists:function(e){return e in this.received},titleExists:function(i){var n=t.values(this.received);return e.inArray(i,n)>-1},inactive:function(e){return"dismissed"===e.get("status")||"expired"===e.get("status")||"acknowledged"===e.get("status")},isInLocalStorage:function(i){var n=[],s=[],a=l.get(this.pageStorageKey),o=i.get("id").toString();return a?(n=a.split(","),s=t.map(n,function(e){return e.split("-")[0]}),e.inArray(o,s)>-1):!1},cleanLocalStorage:function(){var e,t,i,n,s,a,o,r=l.get(this.pageStorageKey);if(r)for(e=r.split(","),i=0;i<e.length;i++)t=e[i],n=t.split("-")[2],s=(new Date).getTime(),n&&(a=(s-n)/1e3,o=Math.floor(a/86400),o>7&&this.deleteInLocalStorage(t))},deleteInLocalStorage:function(e){var t=l.get(this.pageStorageKey),i=new RegExp(e+",?"),n=t.replace(i,"");l.set(this.pageStorageKey,n)},handleSave:function(){this.listenTo(this,"change:status",function(e){this.saveMessage(e)})},stopSaving:function(){this.stopListening(this,"change:status")},saveMessage:function(e){var t=e.get("status"),i=e.get("id");s.publish({action:"send",client_app:"hermes.push",message:{status:t,messageId:i}})}});return d}),define("shared/messaging/instances/messages",["shared/messaging/collections/messages"],function(e){return new e}),define("shared/messaging/views/messenger-mixin",["jquery/nyt","underscore/nyt","shared/messaging/views/message","shared/messaging/instances/messages","shared/messaging/templates"],function(e,t,i,n,s){var a={template:s.messenger,mixinSettings:{id:null,notifyWhen:null,messageType:null,parent:null,template:"message",newestFirst:!0,closeButton:!0,expiration:!1,animationSpeed:200,expirationAfterPause:null,fadeOutDelay:1500,dismissAcknowledged:!0,trackingVersion:""},events:{"click .action-link":"trackLinkClicks","click .action-button":"trackLinkClicks"},initialize:function(e){this.options=t.extend({},this.mixinSettings,this.defaultSettings,e),this.subscribe(this,"nyt:messaging-message-rendered",this.afterMessageReceived),this.subscribe(this,"nyt:messaging-message-removed",this.afterMessageRemoved),this.subscribe(this,"nyt:messaging-message-"+this.options.id+"-displayed nyt:messaging-message-cleared",this.addLastMessageClass),this.subscribe(this,"nyt:messaging-message-"+this.options.id+"-displayed",this.trackImpressions),this.delegateEvents(),this.collection=n,this.active={messages:{}},this.notActive={messages:{}},this.received={messages:{}},this.pageManager.isDomReady()?this.render():this.subscribe(this.pageManager,"nyt:page-ready",this.render),this.trackingBaseData={module:"Notification",version:this.options.trackingVersion,region:"FixedTop"},this.local(this,"nyt:messaging-messenger-initialized")},render:function(){return this.$parent=this.options.parent?this.options.parent():this.$body,this.rendered||(this.$el.hide().addClass(this.options.id).append(this.template(this.options)),this.$parent.prepend(this.$el),this.rendered=!0,this.local(this,"nyt:messaging-messenger-rendered"),this.prepareView(),this.subscribe(this.collection,this.options.notifyWhen,this.notify)),this},notify:function(i){var n,s,a=this,o=[];t.each(i||[],function(e){s=e.get("id"),s&&o.push(e)}),n=o.length>0?function(){a.createMessageViews(o)}:e.noop,this.pageManager.isDomReady()?n():this.subscribe(this.pageManager,"nyt:page-ready",t.debounce(n,0))},createMessageViews:function(e){return e&&t.each(e||[],function(e){var t;t=new i({model:e,template:this.options.template,closeButton:this.options.closeButton,dismissAcknowledged:this.options.dismissAcknowledged}),this.subscribe(t,"nyt:messaging-message-view-expired",this.removeMessage),this.subscribe(t,"nyt:messaging-message-view-dismissed",this.removeMessage),this.subscribe(t,"nyt:messaging-message-view-dismissed",this.trackDismissal),this.addMessage(t)},this),this},addMessage:function(e){if(e){var t,i=this.options.newestFirst?"prepend":"append",n=e.model.get("id");this.received.messages[n]=e,this.active.messages[n]=e,t=this.countMessages(),this.$(".message-bed")[i](e.render().$el),e.$el.data("messageId",n),this.local(this,"nyt:messaging-message-rendered",e,t)}},removeMessage:function(e){var t,i;e&&(t=e.model.get("id"),this.notActive.messages[t]=e,this.active.messages[t]&&delete this.active.messages[t],i=this.countMessages(),this.local(this,"nyt:messaging-message-removed",e,i))},addLastMessageClass:function(){this.$(".message-container").removeClass("last-message-container").last().addClass("last-message-container")},dimensions:function(){return{width:this.$el.find(".message-bed").outerWidth(!0),height:this.$el.find(".message-bed").outerHeight(!0)}},countMessages:function(){return t.size(this.active.messages)},trackImpressions:function(e){var t,i;e=e||"",t=this.received.messages[e],i=this.getcontentCollection(t)||"",this.trackingTriggerImpression("messaging-impression",{action:"Impression",contentCollection:i,eventName:"Impression",contentID:e})},trackDismissal:function(e){var t=e.model.get("id"),i=this.getcontentCollection(e);this.trackingTrigger("messaging-dismissal",{action:"Click",contentCollection:i,eventName:"DismissNotification",contentID:t})},trackLinkClicks:function(t){var i=e(t.currentTarget),n=i.parents(".message-container").data("messageId"),s=this.received.messages[n],a=this.getcontentCollection(s),o=this.trackingAppendParams(i.attr("href"),{action:"Click",contentCollection:a,contentID:n});i.attr("href",o)},getcontentCollection:function(e){return e.model.get("sub_type")?e.model.get("sub_type"):""}};return a}),define("shared/messaging/views/move-furniture-mixin",["jquery/nyt","underscore/nyt"],function(e){var t={moveFurniture:function(t,i,n){var s,a,o,r=this,l=this.options.animationSpeed||200;"add"===i?s="+="+t:"subtract"===i&&(s="-="+t),a=function(e){e.animate({marginTop:s},l)},o=function(t){t.promise().done(function(){e(this).css({marginTop:s})})},n?(this.$el.promise().done(function(){e(this).css("height",s),r.broadcast("nyt:messaging-"+r.options.messageType+"-after")}),this.messagesHeight=this.dimensions().height,this.broadcast("nyt:messaging-"+this.options.messageType+"-move-furniture",o,s,this)):(this.$el.animate({height:s},l,function(){r.messagesHeight=r.dimensions().height,r.broadcast("nyt:messaging-"+r.options.messageType+"-after")}),this.broadcast("nyt:messaging-"+this.options.messageType+"-move-furniture",a,s,this))}};return t}),define("shared/messaging/views/critical-alerts",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/messaging/views/messenger-mixin","shared/messaging/views/move-furniture-mixin","shared/messaging/templates"],function(e,t,i,n,s){var a=i.registerView("messaging").extend(t.extend({},s,n,{defaultSettings:{messageType:"critical-alerts",parent:function(){return 0===e("#critical-alerts").length&&e("body").prepend('<div id="critical-alerts"></div>'),e("#critical-alerts")}},prepareView:function(){this.options.id;this.messagesHeight=0,this.$el.addClass("alerts"),this.$el.parent("#critical-alerts").addClass("critical-alerts messenger"),this.$el.css("height","0")},afterMessageReceived:function(e,t){var i,n=0;e&&t>0&&(this.broadcast("nyt:messaging-message-"+this.options.id+"-received",e,this),1===t&&(n+=this.openMessenger()),e.reveal(!0),e.displayed(),n+=e.dimensions().height,this.moveFurniture(n,"add"),i=e.model.get("id"),this.local(this,"nyt:messaging-message-"+this.options.id+"-displayed",i),this.createMessageClone(e),this.alignMessages(),this.options.expiration&&this.startTimer(e))
},startTimer:function(e){var t;window.setTimeout(function(){t=e.model.get("status"),t&&"dismissed"!==t&&"expired"!==t&&e.trigger("nyt:messaging-message-expired")},60*this.options.expiration*1e3)},openMessenger:function(){var e;return this.$el.show(),this.$el.find(".message-bed").show(),e=this.dimensions().height,this.subscribe(this.pageManager,"nyt:page-resize",this.handleWindowResize),this.broadcast("nyt:messaging-messenger-"+this.options.id+"-opened",this),e},afterMessageRemoved:function(e,t){var i=0;e&&null!==t&&(i+=e.dimensions().height,e.$el.hide(),this.local(this,"nyt:messaging-message-cleared"),0===t&&(i+=this.closeMessenger()),this.broadcast("nyt:messaging-message-"+this.options.id+"-closed",e,this),this.moveFurniture(i,"subtract",!0))},closeMessenger:function(){var t=this.dimensions().height,i=this;return this.$el.hide(),this.$el.find(".message-bed").hide(),this.stopListening(this.pageManager,"nyt:page-resize"),this.broadcast("nyt:messaging-messenger-"+this.options.id+"-closed",this),this.$el.promise().done(function(){e(this).siblings(".alerts").is(":hidden")&&i.broadcast("nyt:messaging-message-"+i.options.messageType+"-closed",i)}),t},createMessageClone:function(e){e.$el.find(".message").clone().addClass("hidden-message").wrapInner('<div class="message-wrap" />').appendTo(e.$el)},handleWindowResize:function(){var e,t,i,n=this;this.$el.promise().done(function(){t=n.dimensions().height,i=n.messagesHeight,t>i?(e=t-i,n.moveFurniture(e,"add",!0),n.messagesHeight=t):i>t&&(e=i-t,n.moveFurniture(e,"subtract",!0),n.messagesHeight=t),n.alignMessages()})},maxMessageWidth:function(){var e=this.$(".message-container").width();this.$(".message:not(.hidden-message)").css({"max-width":e+"px"})},alignMessages:function(){var e=0,i=this.active.messages;t.size(i)>0&&(t.each(i,function(t){var i=t.$el.find(".hidden-message .message-wrap").outerWidth();i>e&&(e=i)}),this.$el.find(".message:not(.hidden-message)").css({width:e+2+"px"}),this.maxMessageWidth())}}));return a}),define("shared/messaging/views/suggestions",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/messaging/views/messenger-mixin","shared/messaging/views/move-furniture-mixin","shared/messaging/templates"],function(e,t,i,n,s){var a=i.registerView("messaging").extend(t.extend({},s,n,{nytEvents:{"nyt:masthead-storytheme":"toggleTheme","nyt:masthead-contenttheme":"toggleTheme","nyt:messaging-message-breaking-news-alerts-received":"hideMessenger","nyt:messaging-message-account-alerts-received":"hideMessenger"},defaultSettings:{messageType:"suggestions",closeButton:!1,trackingVersion:"Velcro"},prepareView:function(){this.messagePresent=!1,this.stayHidden=!1,this.$el.addClass("messenger"),this.$el.css("height","0")},afterMessageReceived:function(t){var i,n,s=e("#account-alerts"),a=e("#breaking-news-alerts"),o=e("#masthead");t&&this.$el.is(":hidden")&&s.is(":hidden")&&a.is(":hidden")&&(this.stayHidden||this.messagePresent||(t.reveal(!0),t.displayed(),t.showOnce(),this.messagePresent=!0,o.hasClass("theme-in-story")||(this.openMessenger(),i=this.dimensions().height,this.moveFurniture(i,"add"),n=t.model.get("id"),this.local(this,"nyt:messaging-message-"+this.options.id+"-displayed",n))))},openMessenger:function(){this.$el.show(),this.broadcast("nyt:messaging-messenger-"+this.options.id+"-opened",this)},afterMessageRemoved:function(e){var t=this.dimensions().height;e&&(e.$el.hide(),this.moveFurniture(t,"subtract",!0),this.broadcast("nyt:messaging-message-"+this.options.id+"-closed",e,this),this.closeMessenger())},closeMessenger:function(){this.$el.hide(),this.broadcast("nyt:messaging-messenger-"+this.options.id+"-closed",this)},hideMessenger:function(){var e=this.dimensions().height;this.$el.is(":visible")&&(this.$el.hide(),this.moveFurniture(e,"subtract",!0)),this.broadcast("nyt:messaging-message-"+this.options.id+"-hidden",this),this.stayHidden=!0},showMessenger:function(){var e=this.dimensions().height;this.moveFurniture(e,"add"),this.broadcast("nyt:messaging-message-"+this.options.id+"-shown",this),this.$el.show()},toggleTheme:function(t){var i,n=e("#account-alerts"),s=e("#breaking-news-alerts"),a=t?"hide":"show";"hide"===a&&this.$el.is(":visible")?(i=this.dimensions().height,this.moveFurniture(i,"subtract",!0),this.$el.addClass("theme-changed"),this.$el.hide()):"show"===a&&this.$el.is(":hidden")&&n.is(":hidden")&&!this.stayHidden&&this.messagePresent&&n.is(":hidden")&&s.is(":hidden")&&(this.$el.show(),i=this.dimensions().height,this.moveFurniture(i,"add",!0),this.$el.removeClass("theme-changed")),this.broadcast("nyt:messaging-message"+this.options.id+a,i,this)}}));return a}),define("shared/messaging/views/announcements",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/messaging/views/messenger-mixin","shared/messaging/templates"],function(e,t,i,n){var s=i.registerView("messaging").extend(t.extend({},n,{nytEvents:{"nyt:page-resize":"adjustWidth"},defaultSettings:{messageType:"announcements",parent:function(){return e("#masthead").find(".container")},animationSpeed:400,expiration:30,expirationAfterPause:3,trackingVersion:"LiveVideo"},prepareView:function(){var e=this,t=1e3*this.options.expirationAfterPause;this.messagePresent=!1,this.timer=null,this.currentMessageId=null,this.widthDiff=45,this.$el.addClass("messenger"),this.adjustWidth(),this.$el.on("mouseenter",function(){e.clearTimer()}),this.$el.on("mouseleave",function(){e.startTimer(t)})},afterMessageReceived:function(e){var t=e.model.get("id"),i=this,n=1e3*this.options.expiration;e&&(this.messagePresent?window.setTimeout(function(){i.afterMessageReceived(e)},n):(e.reveal(!0),e.displayed(),this.local(this,"nyt:messaging-message-"+this.options.id+"-displayed",t),this.messagePresent=!0,this.openMessenger(),this.currentMessageId=t,this.startTimer(n)))},startTimer:function(e){var t=this.currentMessageId,i=this.active.messages[t],n=function(){i&&i.trigger("nyt:messaging-message-expired")};e=e||5e3,this.timer=window.setTimeout(n,e)},clearTimer:function(){window.clearTimeout(this.timer)},openMessenger:function(){var e=this.options.animationSpeed||500;this.$el.stop(!0).show().animate({top:0},e),this.broadcast("nyt:messaging-messenger-"+this.options.id+"-opened",this)},afterMessageRemoved:function(e){e&&this.closeMessenger(e)},closeMessenger:function(t){var i=this.dimensions().height,n=this.options.animationSpeed||500,s=this;t&&this.$el.stop(!0).animate({top:"-"+i},n,function(){e(this).hide(),t.$el.hide(),s.messagePresent=!1,s.broadcast("nyt:messaging-messenger-"+s.options.id+"-closed",s)})},adjustWidth:function(){var t,i=e("#masthead"),n=i.width(),s=this.widthDiff,a=this.pageManager.getCurrentBreakpoint(),o=0;a>1020?(10060>=a&&(o=parseInt(i.css("margin-left"),10)),t=n-(2*s+o),this.$el.css("width",t+"px"),this.$el.css("left",s+"px")):(this.$el.css("left","0px"),this.$el.css("width","100%"))}}));return s}),define("shared/messaging/instances/messaging",["jquery/nyt","foundation/views/page-manager","shared/messaging/views/critical-alerts","shared/messaging/views/suggestions","shared/messaging/views/announcements"],function(e,t,i,n,s){!t.$html.hasClass("lt-ie9")&&!t.$html.hasClass("template-minimal")&&t.getCurrentBreakpoint()>=120&&(new n({id:"suggestions",notifyWhen:"nyt:messaging-velcro-received"}),new i({id:"breaking-news-alerts",notifyWhen:"nyt:messaging-breaking-news-received",expiration:20,dismissAcknowledged:!1,trackingVersion:"BreakingNews"}),new i({id:"account-alerts",notifyWhen:"nyt:messaging-account-alert-received",expiration:10,trackingVersion:"UserAccounts"}),new s({id:"announcements",notifyWhen:"nyt:messaging-video-received"}))}),define("shared/navigation/templates",["underscore/nyt"],function(_){var templates={};return templates.mobileNav=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<section class="edition-navigation">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li class="'+(null==(__t="global"!==pageManager.getEdition()?"active":"")?"":__t)+'"><a href="http://mobile.nytimes.com/"><span>U.S. Edition</span></a></li>\n</ul>\n<ul class="menu">\n<li class="'+(null==(__t="global"===pageManager.getEdition()?"active":"")?"":__t)+'"><a href="http://mobile.nytimes.com/international/"><span>International Edition</span></a></li>\n</ul>\n</section>\n<section class="primary-navigation">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><a href="http://mobile.nytimes.com/"><span>Home</span></a></li>\n<li><a href="http://mobile.nytimes.com/world/"><span>World</span></a></li>\n<li><a href="http://mobile.nytimes.com/national/"><span>U.S.</span></a></li>\n<li><a href="http://mobile.nytimes.com/politics/"><span>Politics</span></a></li>\n<li><a href="http://mobile.nytimes.com/nyregion/"><span>N.Y. / Region</span></a></li>\n<li><a href="http://mobile.nytimes.com/business/"><span>Business Day</span></a></li>\n<li><a href="http://mobile.nytimes.com/technology/"><span>Technology</span></a></li>\n<li><a href="http://mobile.nytimes.com/sports/"><span>Sports</span></a></li>\n</ul>\n<ul class="menu">\n<li><a href="http://mobile.nytimes.com/opinion/"><span>Opinion</span></a></li>\n<li><a href="http://mobile.nytimes.com/science/"><span>Science</span></a></li>\n<li><a href="http://mobile.nytimes.com/health/"><span>Health</span></a></li>\n<li><a href="http://mobile.nytimes.com/arts/"><span>Arts</span></a></li>\n<li><a href="http://mobile.nytimes.com/style/"><span>Style</span></a></li>\n<li><a href="http://mobile.nytimes.com/photos/"><span>Photos</span></a></li>\n<li><a href="http://mobile.nytimes.com/video/"><span>Video</span></a></li>\n<li><a href="http://mobile.nytimes.com/most-emailed/"><span>Most Emailed</span></a></li>\n</ul>\n</section>\n<section class="secondary-navigation">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><a href="http://mobile.nytimes.com/automobiles/"><span>Automobiles</span></a></li>\n<li><a href="http://mobile.nytimes.com/blogs/"><span>Blogs</span></a></li>\n<li><a href="http://mobile.nytimes.com/books/"><span>Books</span></a></li>\n<li><a href="http://mobile.nytimes.com/dining/"><span>Dining &amp; Wine</span></a></li>\n<li><a href="http://mobile.nytimes.com/education/"><span>Education</span></a></li>\n<li><a href="http://mobile.nytimes.com/garden/"><span>Home &amp; Garden</span></a></li>\n<li><a href="http://mobile.nytimes.com/magazine/"><span>Magazine</span></a></li>\n<li><a href="http://mobile.nytimes.com/movies/"><span>Movies</span></a></li>\n<li><a href="http://mobile.nytimes.com/music/"><span>Music</span></a></li>\n<li><a href="http://mobile.nytimes.com/business/media/"><span>Media &amp; Advertising</span></a></li>\n<li><a href="http://mobile.nytimes.com/obituaries/"><span>Obituaries</span></a></li>\n</ul>\n<ul class="menu">\n<li><a href="http://mobile.nytimes.com/publiceditor/"><span>Public Editor</span></a></li>\n<li><a href="http://mobile.nytimes.com/realestate/"><span>Real Estate</span></a></li>\n<li><a href="http://mobile.nytimes.com/opinion/sundayreview/"><span>Sunday Review</span></a></li>\n<li><a href="http://mobile.nytimes.com/tmagazine/"><span>T Magazine</span></a></li>\n<li><a href="http://mobile.nytimes.com/television/"><span>Television</span></a></li>\n<li><a href="http://mobile.nytimes.com/theater/"><span>Theater</span></a></li>\n<li><a href="http://mobile.nytimes.com/timeswire/"><span>Times Wire</span></a></li>\n<li><a href="http://mobile.nytimes.com/travel/"><span>Travel</span></a></li>\n<li><a href="http://mobile.nytimes.com/weddings/"><span>Weddings / Celebrations</span></a></li>\n<li><a href="http://mobile.nytimes.com/corrections/"><span>Corrections</span></a></li>\n</ul>\n</section>\n<section class="tertiary-navigation">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><a href="http://mobile.nytimes.com/recommendations/"><span>Recommendations</span></a></li>\n</ul>\n<ul class="menu">\n<li><a href="http://mobile.nytimes.com/saved/"><span>Saved</span></a></li>\n</ul>\n</section>\n<section class="settings '+(null==(__t=userData.isLoggedIn()?"":"hidden")?"":__t)+'">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><span class="label">Account:</span> '+(null==(__t=userData.getUserName())?"":__t)+'</li>\n</ul>\n</section>\n<section class="logout '+(null==(__t=userData.isLoggedIn()?"":"hidden")?"":__t)+'">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><a href="http://mobile.nytimes.com/logout"><span>Log out</span></a></li>\n</ul>\n</section>\n<section class="account '+(null==(__t=userData.isLoggedIn()?"hidden":"")?"":__t)+'">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><a href="http://www.nytimes.com/mowweb/ftnotlog"><span>Subscribe</span></a></li>\n</ul>\n<ul class="menu">\n<li><a href="https://myaccount.nytimes.com/mobile/login/smart/index.html?EXIT_URI='+(null==(__t=encodeURIComponent(window.location))?"":__t)+'"><span>Log In</span></a></li>\n</ul>\n</section>';return __p},templates.navigationModalContent=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="secondary-container">\n'+(null==(__t=secondary)?"":__t)+'\n</div>\n<div class="tertiary-container">\n'+(null==(__t=tertiary)?"":__t)+"\n</div>";return __p},templates}),define("shared/navigation/views/navigation",["module","jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/views/page-manager","foundation/hosts","foundation/models/user-data","shared/modal/views/modal","shared/navigation/templates"],function(e,t,i,n,s,a,o,r,l){var d=n.registerView("navigation").extend({module:e,el:"#navigation",navTemplate:l.navigation,modalTemplate:l.navigationModalContent,events:{mouseleave:"delayedClose",mouseenter:"cancelDelayedClose","mouseenter li a":"tryPrimaryHover","mouseleave li a.expandable":"delayedModalClose","click li a":"activatePrimaryItem","click .menu a[href]":"handlePrimaryNavigationClick"},nytEvents:{"nyt:masthead-section-click":"toggle","nyt:navigation-toggle-ready":"toggle","nyt:navigation-edge-click":"open","nyt:navigation-edge-mouse-enter":"delayedOpen","nyt:navigation-edge-mouse-leave":"cancelDelayedOpen","nyt:messaging-critical-alerts-move-furniture":"moveNav","nyt:messaging-suggestions-move-furniture":"moveNav","nyt:a11y-enabled":"enableA11Nav","nyt:a11y-disabled":"disableA11yNav"},defaultSettings:{panelwidth:210,navTimeout:500,navAnimation:150,hoverTimeout:500,intentRangeLower:10,intentRangeUpper:170,maxMouseLocs:2,a11yEnabled:!1},modalSettings:{id:"navigation-modal",modalTitle:"",modalContent:"",tailDirection:"left-top",closeOnClick:!1,fixedOverride:!0,autoPosition:!0,positionTailSide:!0,toggleSpeed:1},mouseLocs:[],navIds:{REAL_ESTATE:"navId-92720057-BCB6-4BDB-9351-12F29393259F",OPINION_DOMESTIC:"navId-09736473-CB3F-4B2F-9772-3AF128ABE12D",OPINION_INTERNATIONAL:"navId-AD8090D7-4137-4D71-84C8-70DA3BD89778",MORE:"navId-more-section"},navLevels:{PRIMARY:1,SECONDARY:2,TERTIARY:3},initialize:function(e){i.bindAll(this,"tryPrimaryHover","trySecondaryHover","open","close","render","saveMousePosition","delayedOpen","delayedClose","cancelDelayedOpen","cancelDelayedClose","delayedModalOpen","delayedModalClose","cancelDelayedModalOpen","cancelDelayedModalClose","delayedPrimaryHover","cancelDelayedPrimaryHover","delayedSecondaryHover","cancelDelayedSecondaryHover","handleClickClose","handleTapClose","detectFalsePositive"),this.settings=i.extend({},this.defaultSettings,e),this.singlePanelWidth=this.settings.panelwidth+"px",this.singlePanelPartlyShut=this.settings.panelwidth-20+"px",this.isNavAnimating=!1,this.timer={},this.render(),this.$document.on("click","#navigation-modal a[href]",i.bind(this.handleModalClick,this)),this.trackingBaseData={module:"SectionsNav",action:"click",version:"BrowseTree",region:"TopBar"}},handleUserReady:function(){this.updateCrosswordSubscriptionLink()},updateCrosswordSubscriptionLink:function(){var e=o.isTabletSubscriber(),i=o.isSmartphoneSubscriber(),n=o.isHomeDeliverySubscriber(),s=o.isPremierSubscriber(),r=o.isOpinionSubscriber(),l=o.isNytNowSubscriber(),d=o.isCrosswordsSubscriber(),c=a.www+"/subscriptions/games/lp8J6KQ.html?campaignId=49W96",h=a.www+"/subscriptions/games/lp897H9.html?campaignId=49W8Y";(e||i||n||s||r||l)&&!d?t("#nyt-crossword").attr("href",c):d?t(".nyt-crossword").addClass("hidden"):t("#nyt-crossword").attr("href",h)},handlePrimaryNavigationClick:function(e){var i=t(e.currentTarget),n=this.trackingAppendParams(i.attr("href"),{contentCollection:t.trim(i.text())});i.attr("href",n)},handleModalClick:function(e){var i=t(e.currentTarget),n=t.trim(t("#navigation-modal").find(".secondary-container .header").text()),s=this.trackingAppendParams(i.attr("href"),{contentCollection:n+"/"+t.trim(i.text()),contentPlacement:i.closest("ul").hasClass("secondary")?2:3});i.attr("href",s)},moveNav:function(e){e(this.$el)},render:function(){var e=this,t=this.$body.find(".navigation-modal"),i=t.find(".secondary-container"),n=t.find(".tertiary-container");t.eq(0).remove(),this.modalSettings.modalContent=l.navigationModalContent({secondary:i.html(),tertiary:n.html()}),this.navigationModal=new r(this.modalSettings),this.navigationModal.addToPage(),this.navigationModal.$modal.on("mouseover",".secondary li a",e.trySecondaryHover).on("click",".secondary li a.expandable",e.activateSecondaryItem).on("mouseenter",".tertiary-container",e.cancelDelayedSecondaryHover).on("mouseenter",function(){e.cancelDelayedClose(),e.cancelDelayedModalClose(),e.cancelDelayedPrimaryHover()}).on("mouseleave",function(){e.delayedClose(),e.delayedModalClose()})},toggle:function(){this.$el.hasClass("active")?this.close():this.open()},open:function(){var e=this,t={width:e.singlePanelPartlyShut,display:"block",opacity:"0"},i={width:e.singlePanelWidth,opacity:"1"};this.isNavAnimating||this.$el.hasClass("active")!==!1||(this.$el.css(t),this.$el.toggleClass("active"),this.$html.toggleClass("navigation-active"),this.isNavAnimating=!0,this.$el.animate(i,this.settings.navAnimation,function(){e.isNavAnimating=!1,e.$body.on("click",e.handleTapClose)}),this.pageManager.isMobile()&&this.$body.css("cursor","pointer"),this.settings.a11yEnabled&&this.toggleFocusEvents(!0),this.broadcast("nyt:navigation-opened",this),this.$document.on("mousemove",this.saveMousePosition))},close:function(){var e,t,i;this.isNavAnimating||this.$el.hasClass("active")!==!0||(e=this,t=this.$el.css("marginTop"),i={width:this.singlePanelPartlyShut,opacity:"0"},this.navigationModal.close(),this.resetNav(this.navLevels.SECONDARY),this.isNavAnimating=!0,this.$el.animate(i,this.settings.navAnimation,function(){e.$el.toggleClass("active"),e.$html.toggleClass("navigation-active"),e.$body.off("click",e.handleClickClose),e.$body.off("click",e.handleTapClose),e.$el.removeAttr("style"),e.$el.css("marginTop",t),e.$el.find("a").removeClass("active"),e.isNavAnimating=!1}),this.pageManager.isMobile()&&this.$body.css("cursor",""),this.settings.a11yEnabled&&this.toggleFocusEvents(!1),this.broadcast("nyt:navigation-closed",this),this.$document.off("mousemove",this.saveMousePosition))},resetNav:function(e){var t=this.navigationModal.$modal;e===this.navLevels.SECONDARY&&t.find(".section").removeClass("active"),t.find(".secondary a").removeClass("active"),t.find(".tertiary").removeClass("active"),t.find(".modal-content").removeClass("expanded"),t.find(".section-heading a").removeClass("active")},activatePrimaryItem:function(e){var i,n,s,a,o,r,l=t(e.target).closest("a");e.stopPropagation(),l.hasClass("active")||this.isNavAnimating!==!1||(l.hasClass("expandable")?(i=this.navigationModal,n=i.$modal.find('[data-parent="'+l.attr("id")+'"]').find("li").length,s=55,a=29*n,o=a+s,l.attr("id")===this.navIds.REAL_ESTATE?o=175:l.attr("id")===this.navIds.MORE?o=553:(l.attr("id")===this.navIds.OPINION_DOMESTIC||l.attr("id")===this.navIds.OPINION_INTERNATIONAL)&&(o=357),this.cancelDelayedModalClose(),this.resetNav(this.navLevels.SECONDARY),i.$modal.height(o),e.currentTarget=e.target,i.open(e),this.moveModalArrow(),this.$el.find("a").removeClass("active").attr("aria-expanded","false"),l.addClass("active").attr("aria-expanded","true"),i.$modal.find(".secondary").removeClass("active"),r=i.$modal.find(".secondary-container .section-heading"),this.setHeadingText(l,r),i.$modal.find('[data-parent="'+l.attr("id")+'"]').addClass("active"),this.broadcast("nyt:navigation-level-one-open",i.$modal)):this.modalClose())},setHeadingText:function(e,t){t.html(e.attr("href")?'<a href="'+e.attr("href")+'" tabinxdex="0" role="menuitem" class="active">'+e.text()+"</a>":e.text())},moveModalArrow:function(){var e,i,n,s=this.navigationModal.$modal,a=12,o=18,r=39,l=this.settings.panelwidth-10;t("html").hasClass("viewport-large-70")&&(l+=t("#navigation-edge").width()),s.css("left",l+"px"),e=s.find(".modal-pointer"),e.hasClass("modal-pointer-left")?(i=Math.floor(s.outerHeight()/2)-o,e.css("top",i+"px")):e.hasClass("modal-pointer-left-top")?e.css("top",a,"px"):e.hasClass("modal-pointer-left-bottom")&&(n=s.outerHeight()-r,e.css("top",n+"px"))},activateSecondaryItem:function(e){var i,n,s=t(e.target).closest("a");s.hasClass("active")||this.isNavAnimating!==!1||(e.preventDefault(),i=this.navigationModal.$modal,s.hasClass("expandable")?(this.resetNav(this.navLevels.TERTIARY),i.find(".modal-content").addClass("expanded"),n=i.find(".tertiary-container .section-heading"),this.setHeadingText(s,n),i.find("[data-parent='"+s.attr("id")+"']").eq(0).addClass("active"),s.addClass("active").attr("aria-expanded","true"),this.broadcast("nyt:navigation-level-two-open",i.find(".tertiary-container"))):(this.resetNav(this.navLevels.TERTIARY),s.addClass("active")))},tryPrimaryHover:function(e){var i,n=t(e.target).closest("a"),s=n.hasClass("expandable");this.cancelDelayedClose(),s&&this.cancelDelayedModalClose(),this.cancelDelayedPrimaryHover(),this.$el.find("li a.active").length>0?(i=this.getAngle(this.mouseLocs[0],this.mouseLocs[1]),i>this.defaultSettings.intentRangeLower&&i<this.defaultSettings.intentRangeUpper?this.delayedPrimaryHover(e):this.activatePrimaryItem(e)):this.activatePrimaryItem(e)},trySecondaryHover:function(e){var t;this.cancelDelayedClose(),this.cancelDelayedModalClose(),this.cancelDelayedSecondaryHover(),this.navigationModal.$modal.find(".modal-content").hasClass("expanded")?(t=this.getAngle(this.mouseLocs[0],this.mouseLocs[1]),t>this.defaultSettings.intentRangeLower&&t<this.defaultSettings.intentRangeUpper?this.delayedSecondaryHover(e):this.activateSecondaryItem(e)):this.activateSecondaryItem(e)},getAngle:function(e,t){if(e&&t){var i=e.x,n=e.y,s=t.x,a=t.y,o=s-i,r=a-n,l=Math.round(180*Math.atan2(o,r)/Math.PI*10)/10;return l}return null},delayedOpen:function(){this.timer.navOpen=window.setTimeout(this.open,this.defaultSettings.navTimeout)},delayedClose:function(){this.timer.navClose=window.setTimeout(this.close,this.defaultSettings.navTimeout)},cancelDelayedOpen:function(){window.clearTimeout(this.timer.navOpen)},cancelDelayedClose:function(){window.clearTimeout(this.timer.navClose)},delayedModalOpen:function(){this.timer.modalOpen=window.setTimeout(this.navigationModal.open,this.defaultSettings.navTimeout)},delayedModalClose:function(){var e=this;this.cancelDelayedPrimaryHover(),this.cancelDelayedSecondaryHover(),this.timer.modalClose=window.setTimeout(function(){e.modalClose()},this.defaultSettings.navTimeout)},modalClose:function(){this.$el.find("a").removeClass("active"),this.navigationModal.close()},cancelDelayedModalOpen:function(){window.clearTimeout(this.timer.modalOpen)},cancelDelayedModalClose:function(){window.clearTimeout(this.timer.modalClose)},delayedPrimaryHover:function(e){var t=this;t.timer.primaryHoverIntent=window.setTimeout(function(){t.activatePrimaryItem(e)},this.defaultSettings.hoverTimeout)},cancelDelayedPrimaryHover:function(){window.clearTimeout(this.timer.primaryHoverIntent)},delayedSecondaryHover:function(e){var t=this;t.timer.secondaryHoverIntent=window.setTimeout(function(){t.activateSecondaryItem(e)},this.defaultSettings.hoverTimeout)},cancelDelayedSecondaryHover:function(){window.clearTimeout(this.timer.secondaryHoverIntent)},handleClickClose:function(e){0===t(e.target).closest("#navigation, #navigation-modal").length&&this.close()},handleTapClose:function(e){0===t(e.target).closest("#navigation, #navigation-modal").length&&this.close()},saveMousePosition:function(e){this.mouseLocs.length>1?(this.mouseLocs[1].x!==e.pageX||this.mouseLocs[1].y!==e.pageY)&&(this.mouseLocs.push({x:e.pageX,y:e.pageY}),this.mouseLocs.length>this.defaultSettings.maxMouseLocs&&this.mouseLocs.shift()):this.mouseLocs.push({x:e.pageX,y:e.pageY})},toggleFocusEvents:function(e){var t=e?"subscribe":"stopSubscribing";this[t]("nyt:page-key-tab nyt:page-key-up-a11y nyt:page-key-down-a11y",this.handleFocusKey),this[t]("nyt:page-key-esc-a11y nyt:page-key-left-a11y",this.handleCollapseKey),this[t]("nyt:page-key-enter nyt:page-key-right-a11y",this.handleExpandKey),this[t]("nyt:navigation-level-one-open nyt:navigation-level-two-open",this.addFocusableElements),e?(this.focusableElements=[],this.addFocusableElements(),this.$document.on("mousemove",this.detectFalsePositive)):delete this.focusableElements},addFocusableElements:function(e){var t,n;this.settings.a11yEnabled&&(e&&e.length>0?n=".active a[role=menuitem]:visible, .section-heading a.active[role=menuitem]:visible":(e=this.$el,n="a[role=menuitem]:visible, .section-heading a.active[role=menuitem]:visible"),t=e.find(n).toArray(),this.focusableElements.push({first:t[0],all:t,last:i.last(t)}),t[0].focus())},handleFocusKey:function(e){var t=i.last(this.focusableElements),n=this.getKeyDirection(e),s=document.activeElement;if(s===t.last&&"forward"===n)t.first.focus();else if(s===t.first&&"backward"===n)t.last.focus();else if("forward"===n)t.all[i.indexOf(t.all,s)+1].focus();else{if("backward"!==n)return;t.all[i.indexOf(t.all,s)-1].focus()}e.preventDefault()},handleCollapseKey:function(){var e;this.focusableElements.pop(),e=i.last(this.focusableElements),this.focusableElements.length>1?(this.resetNav(this.navLevels.TERTIARY),e.active.focus()):this.focusableElements.length>0?(this.modalClose(),e.active.focus()):this.close()},handleExpandKey:function(e){var n=t(document.activeElement),s=i.last(this.focusableElements);s.active=n,n.hasClass("expandable")&&(e.preventDefault(),n.closest(".secondary").length>0?this.activateSecondaryItem(e):this.activatePrimaryItem(e))},detectFalsePositive:i.throttle(function(e){t(e.target).is('a[role="menuitem"], li[role="presentation"')&&this.disableA11yNav()},1e3),getKeyDirection:function(e){var t="",i=this.pageManager.KEYS,n=e&&e.keyCode?e.keyCode:null;switch(n){case i.UP:case i.LEFT:t="backward";break;case i.DOWN:case i.RIGHT:case i.TAB:t="forward"}return t},enableA11Nav:function(){this.settings.a11yEnabled=!0},disableA11yNav:function(){this.settings.a11yEnabled=!1,this.toggleFocusEvents(!1),this.$document.off("mousemove",this.detectFalsePositive)}});return d}),define("shared/navigation/views/navigation-edge-adjust",["jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/views/page-manager"],function(e,t,i){var n=i.registerView("navigation").extend({el:"#navigation-edge",events:{mouseenter:"handleMouseOver",mouseleave:"handleMouseOut",click:"handleClick"},nytEvents:{"nyt:page-breakpoint":"handleBreakPoint"},initialize:function(){this.pageManager.isDomReady()?this.render():this.subscribe("nyt:page-ready",this.render)},render:function(){this.$shell=e("#shell"),this.pageManager.getCurrentBreakpoint()>=10070&&(this.setNavWidth(),this.subscribe("nyt:page-resize",this.setNavWidth))},setNavWidth:function(){var e=this.$shell.offset();this.$shell.offset()&&(this.broadcast("nyt:navigation-edge-size-change",e.left),this.$el.css("width",e.left))},handleBreakPoint:function(e){e>=10070?this.subscribe("nyt:page-resize",this.setNavWidth):(this.stopSubscribing("nyt:page-resize",this.setNavWidth),this.$el.css("width",""))},handleMouseOver:function(e){(0!==e.clientX||0!==e.clientY)&&this.broadcast("nyt:navigation-edge-mouse-enter",e)},handleMouseOut:function(e){this.broadcast("nyt:navigation-edge-mouse-leave",e)},handleClick:function(){this.broadcast("nyt:navigation-edge-click")}});return n}),define("shared/navigation/views/mobile-navigation",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/navigation/views/navigation","shared/navigation/views/navigation-edge-adjust","shared/navigation/templates","foundation/models/user-data"],function(e,t,i,n,s,a,o){var r=i.registerView("mobile-navigation").extend({el:"#mobile-navigation",hiddenEl:"#main, #ribbon, #site-index",nytEvents:{"nyt:masthead-section-click":"handleSectionClick","nyt:page-breakpoint":"handleBreakPoint"},handleUserReady:function(){this.$masthead=e("#masthead").find(".sections-button"),this.render()},render:function(){this.$el.html(a.mobileNav({userData:o,pageManager:this.pageManager}))},open:function(){this.$el.removeClass("hidden"),this.$masthead.addClass("mobile-navigation-active"),this.$el.focus(),e(this.hiddenEl).addClass("hidden"),window.scrollTo(0,0)},close:function(){this.$el.addClass("hidden"),this.$masthead.removeClass("mobile-navigation-active"),e(this.hiddenEl).removeClass("hidden")},handleSectionClick:function(){this[this.$el.is(":visible")?"close":"open"]()},handleBreakPoint:function(e){e>=120&&(new n,new s,this.close(),this.remove())}});return r}),define("shared/navigation/views/site-index-responsive",["jquery/nyt","underscore/nyt","foundation/views/base-view"],function(e,t,i){var n=i.registerView("navigation").extend({events:{"click a":"handleSiteIndexClick","click .menu-heading":"handleClick","click .menu-label":"handleClick","keyup .menu-heading":"handleKeyboard"},nytEvents:{"nyt:page-breakpoint":"handleBreakPoint"},initialize:function(){var e=this.$el.find(".column");this.$columnHeader=e.find("h3"),this.$columnContents=e.find("ul")},handleDomReady:function(){this.render()},render:function(){this.subscribe("nyt:page-resize",this.setNavWidth),this.handleBreakPoint()},handleBreakPoint:function(){var t,i,n,s;this.pageManager.getCurrentBreakpoint()>=1e3?(this.isSmallSiteIndex=!1,t="removeClass",i="removeAttr",this.$columnContents[t]("expanded")[t]("collapsed")[i]("aria-expanded","true")[i]("aria-expanded","false")):(this.isSmallSiteIndex=!0,t="addClass",i="attr",this.$columnContents[t]("collapsed")[i]("aria-expanded","true")[i]("aria-expanded","false")),this.$columnHeader[t]("toggle")[i]("role","button")[i]("tabindex","0")[i]("aria-pressed","true")[i]("aria-pressed","false"),e.each(this.$columnHeader,function(t,a){s=e(a),n=s.text(),n=n.substr(0,n.indexOf(" ")).toLowerCase(),s[i]("id",n+"-menu-heading")[i]("aria-controls",n+"-menu"),s.siblings("ul")[i]("id",n+"-menu")[i]("aria-labelled-by",n+"-menu-heading")})},handleKeyboard:function(e){(13===e.keyCode||32===e.keyCode)&&this.handleClick(e)},handleClick:function(t){var i,n,s;this.isSmallSiteIndex&&(n=e(t.target),i=n.nextAll("ul"),s=i.find("a"),i.toggleClass("collapsed"),i.toggleClass("expanded"),"false"===n.attr("aria-pressed")?(n.attr("aria-pressed","true"),i.attr("aria-expanded","true"),s.removeAttr("tabindex","-1")):(n.attr("aria-pressed","false"),i.attr("aria-expanded","false"),s.attr("tabindex","-1")))},handleSiteIndexClick:function(t){var i=e(t.currentTarget),n=this.trackingAppendParams(i.attr("href"),{module:"SiteIndex",region:"Footer"});i.attr("href",n)}});return n}),define("shared/navigation/instances/navigation",["jquery/nyt","foundation/views/page-manager","shared/navigation/views/navigation","shared/navigation/views/mobile-navigation","shared/navigation/views/navigation-edge-adjust","shared/navigation/views/site-index-responsive"],function(e,t,i,n,s,a){t.getCurrentBreakpoint()>=120?(new i,new s):new n,new a({el:e("#site-index")})}),define("shared/community/api-mixin",["jquery/nyt","underscore/nyt","foundation/hosts"],function(e,t,i){var n={apiPath:i.community+"/svc/community/V3/requestHandler",COMMANDS:{all:"GetCommentsAll",reader:"GetCommentsReadersPicks",nytpicks:"GetCommentsNYTPicks",nytreplies:"GetCommentsNYTReplies",replies:"GetRepliesBySequence",permalink:"GetCommentByPermid",recommend:"PostRecommend",userinfo:"GetBasicInfo",comment:"PostComment",notify:"CommentNotify",summary:"GetCommentSummary",content:"GetUserContentSummary",reply:"PostComment",flag:"FlagComment",review:"",rate:"",avgRating:"",usrRating:""},QUERIES:{asset:"url",filter:"cmd",command:"cmd",context:"commentSequence"},apiPost:function(e){return this.makeRequest(e,"post")
},apiGet:function(e){return this.makeRequest(e,"get")},hasErrors:function(e,t){var i=!0;return e&&("undefined"!=typeof e.status?(i=!1,this.wantsComments(t)?i=!(e.results&&e.results.comments):"OK"!==e.status&&(i=!0)):i=!1),i},wantsComments:function(e){if(!e)return!1;switch(e.filter){case"all":case"nytreplies":case"nytpicks":case"reader":case"replies":return!0;default:return!1}},sanitize:function(e,t){var i=[];return e&&(i=e.comments),t&&i&&i[0]&&("replies"===t.filter?(i[0].replies.context=i[0].commentSequence,i=i[0].replies):"permalink"===t.filter&&(i.context=i[0].commentSequence)),i},formatRequest:function(e,i){var n,s={};switch(t.each(e,function(e,t){t=this.QUERIES[t]||t,"cmd"===t||"commentSequence"===t&&0===e||(s[t]=e)},this),e.command){case"comment":s.commentType="comment";break;case"notify":i=s.commentNotify?"post":"delete",delete s.commentNotify;break;case"reply":s.commentType="userReply";break;case"review":}return"post"===i?s={postdata:encodeURIComponent(JSON.stringify(s))}:s.url=s.url?encodeURIComponent(s.url):void 0,s.cmd=this.COMMANDS[e.filter||e.command],s.method=i,n={url:this.apiPath,dataType:"jsonp",data:s,contentType:"post"===i?"application/json; charset=utf-8":"application/x-www-form-urlencoded; charset=utf-8",jsonp:"callback",cache:!1}},makeRequest:function(t,i){var n=this,s=new e.Deferred,a=this.formatRequest(t,i),o=!0;return a.success=function(e){n.hasErrors(e,t)?a.error(e):s.resolve(e.results||e)},a.error=function(t){o?(e.ajax(a),o=!1):s.reject({status:"ERROR",message:"The request failed",response:t})},e.ajax(a),s.promise()}};return n}),define("shared/community/models/community-user",["underscore/nyt","foundation/models/base-model","shared/community/api-mixin"],function(e,t,i){var n=t.extend(e.extend({},i,{defaults:{userID:null,picURL:"",location:"",displayName:"",userEmail:"",myaccounturl:"",wwwhost:"",tphost:"",comment_notify:0},initialize:function(){this.getUserId()||this.fetch()},fetch:function(){var e=this,t={command:"userinfo"};return this.apiGet(t).done(function(t){e.set(t)}).promise()},setCarefully:function(t){var i={userID:"UserId",picURL:"Avatar",location:"Location",displayName:"Name",userEmail:"Email"};e.isObject(t)&&e.each(t,function(e,t){i[t]&&!this["has"+i[t]]()&&e&&this["set"+i[t]](e)},this)},getUserId:function(){return this.get("userID")},getAvatar:function(){return this.get("picURL")},getLocation:function(){return this.get("location")},getName:function(){return this.get("displayName")},getEmail:function(){return this.get("userEmail")},getAccountUrl:function(){return this.get("myaccounturl")},getNotify:function(){return this.get("comment_notify")},hasUserId:function(){return null!==this.get("userID")&&this.get("userID")>0},hasAvatar:function(){return this.getAvatar().length>0?-1===this.getAvatar().indexOf("none.png"):!1},hasLocation:function(){return"string"==typeof this.get("location")&&this.get("location").length>0},hasName:function(){return"string"==typeof this.get("displayName")&&this.get("displayName").length>0},hasEmail:function(){return"string"==typeof this.get("userEmail")&&this.get("userEmail").length>0},setUserId:function(e){this.set("userID",e)},setLocation:function(e){this.set("location",e)},setName:function(e){return this.set("displayName",e)},setEmail:function(e){return this.set("userEmail",e)},setNotify:function(e){return this.set("comment_notify",e)},setAvatar:function(e){return this.set("picURL",e)}}));return n}),define("shared/community/instances/community-user",["shared/community/models/community-user"],function(e){return new e}),define("shared/community/models/post",["underscore/nyt","foundation/models/base-model","shared/community/api-mixin","shared/community/instances/community-user"],function(e,t,i,n){var s=t.extend(e.extend({},i,{defaults:{commentID:0,replies:[]},initialize:function(){this.getReplies().length>2&&(this.getReplies().length=2),this.convertUnixTimeStamp()},recommend:function(e,t,i){var s=this,a=arguments.length>3?Array.prototype.slice.call(arguments,3):[];return"undefined"==typeof e&&(e=this.isRecommended()?0:1),this.apiPost({command:"recommend",userID:n.getUserId(),userEmail:n.getEmail(),asset:t,commentSequence:this.getSequence(),parentID:this.getParentId(),recommend:e}).done(function(e){s.set({recommendedFlag:e.recommended,recommendations:e.recommendations}),i.local.apply(this,[i,"nyt:community-post-recommended",s].concat(a))})},convertUnixTimeStamp:function(){e.each(["approveDate","createDate","updateDate"],function(e){this.set(e,1e3*parseInt(this.get(e),10))},this)},isTrusted:function(){return this.get("trusted")>0},isPicked:function(){return this.get("editorsSelection")},isNyt:function(){return"reporterReply"===this.get("commentType")},isRecommended:function(){return 1===this.get("recommendedFlag")},isReported:function(){return 1===this.get("reportAbuseFlag")},hasReplies:function(){return this.getReplyCount()>0},hasAvatar:function(){return this.getAvatar().length>0?-1===this.getAvatar().indexOf("none.png"):!1},hasAdditionalReplies:function(){return this.getReplyCount()>this.getReplies().length},getDate:function(){return this.get("approveDate")},getBody:function(){return this.get("commentBody")},getAuthor:function(){return this.get("userDisplayName")||this.get("display_name")},getAvatar:function(){return this.get("picURL")||""},getLocation:function(){return this.get("userLocation")||this.get("location")},getReplies:function(){return this.get("replies")},getReplyCount:function(){return this.get("replyCount")},getId:function(){return this.get("commentID")},getPermId:function(){return this.get("permID")},getSequence:function(){return this.get("commentSequence")},getParentId:function(){return this.get("parentID")||0},getRecommendations:function(){return this.get("recommendations")},getUserTitle:function(){return this.get("userTitle")},getParentAuthor:function(){return this.get("parentUserDisplayName")},getParentPermId:function(){return this.get("parentPermID")}}));return s}),define("shared/community/collections/stream",["underscore/nyt","foundation/collections/base-collection","shared/community/models/post"],function(e,t,i){var n=t.extend({model:i,sortMethods:{newest:function(e){return-parseInt(e.getDate(),10)},oldest:function(e){return parseInt(e.getDate(),10)},reader:function(e){return-parseInt(e.getRecommendations(),10)}},order:function(e){this.comparator=this.sortMethods[e||"newest"]},has:function(e){return this.where({commentID:e.getId()}).length>0},convertPosts:function(t,n){return e.each(t,function(e,s){var a=new i(e);n&&(n.getReplies()[s]=a),a.hasReplies()&&this.convertPosts(a.getReplies(),a),t[s]=a},this),this},stripDupes:function(t){var i=[],n=[];return e.each(t,function(t){-1===e.indexOf(n,t.getId())&&(i.push(t),n.push(t.getId()))},this),i},populate:function(t){var i=[],n=t.context;return t=this.convertPosts(t).stripDupes(t),e.each(t,function(t){this.has(t)||(i.push(t),this.ensurePermId(t,n),t.hasReplies()&&(t.set("replies",this.stripDupes(t.getReplies())),e.each(t.getReplies(),function(e){this.ensurePermId(e,t.getSequence())},this)))},this),this.add(i),i},ensurePermId:function(e,t){e.getPermId()||e.set("permID",(t?t+":":"")+e.getSequence()),e.set("parentPermID",e.getPermId().split(":")[0])}});return n}),define("shared/community/models/thread",["underscore/nyt","foundation/models/base-model","shared/community/collections/stream"],function(e,t,i){var n=t.extend({defaults:{context:"0",filter:"all",sort:"newest",offset:0,permID:null,stream:null,requested:25},initialize:function(){var e=this.getStream();e&&"function"!=typeof e.slice||(e=new i(e),this.set("stream",e)),e.order(this.get("sort"))},toQuery:function(t){return e.extend({context:this.get("context"),filter:this.get("filter"),sort:this.get("sort"),offset:this.get("offset")},{permID:this.get("permID")||void 0},t)},getStream:function(){return this.get("stream")},getCount:function(){return this.get("count")},getRequested:function(){return this.get("requested")},isEmpty:function(){return!this.isLoading()&&0===this.getStream().length},isLoading:function(){return this.get("loading")},setLoading:function(e){this.set("loading",e)},setCount:function(e){this.set("count",e)},trackRequested:function(e){this.set("requested",e+(this.getRequested()||0))},hasAdditionalPosts:function(){return this.getRequested()<this.get("count")}});return n}),define("shared/community/models/discussion",["underscore/nyt","foundation/models/base-model","foundation/collections/base-collection","shared/community/api-mixin","shared/community/models/thread"],function(e,t,i,n,s){var a=t.extend(e.extend({},n,{defaults:{views:[],isOpen:!0,totalPosts:0,nytPicks:0,nytReplies:0,userPicks:0,averageRating:0,userRating:0,prompt:"Share your thoughts."},initialize:function(e){var t=new i([],{model:s});e.asset&&!e.taxonomy&&this.listenToOnce(t,"add",this.buildTaxonomy),this.listenToOnce(t,"add",this.getUserContent),this.listenToOnce(this,"nyt:community-summary",this.load),this.set("threads",t),this.getSummary()},buildValidQuery:function(t){var i,n=["context","filter","sort","permID","taxonomy"],s={};for(i in t)e.indexOf(n,i)>-1&&"undefined"!=typeof t[i]&&(s[i]=t[i]);return s},getSummary:function(){var e=this,t={"comment-list-sort-approvedate":{sort:"oldest",filter:"all"},"comment-list-sort-approvedate-desc":{sort:"newest",filter:"all"},"comment-list-sort-recommended":{filter:"reader"},"comment-list-sort-editors":{filter:"nytpicks"},"comment-list-sort-replies":{filter:"nytreplies"}};this.apiGet({asset:this.getAsset(),command:"summary"}).done(function(i){var n=t[i.sortBy||"comment-list-sort-approvedate-desc"];e.setDefaultQuery(n),e.setMetaData(i),e.local(e,"nyt:community-summary",n,e)}).fail(function(){e.local(e,"nyt:community-summary",t["comment-list-sort-approvedate-desc"],e)})},load:function(e,t){var i=arguments.length>2?Array.prototype.slice.call(arguments,2):[],n=this.getThreads(),s=this.buildValidQuery(e),a=n.findWhere(s);this.local(t||this,"nyt:community-request",e),a||(n.add(s),a=n.findWhere(s)),a.isLoading()?this.addThreadWatcher.apply(this,[t,a].concat(i)):e.limit?this.fetchMorePosts(e,a,t,i):a.isEmpty()||"replies"===e.filter?this.fetchPosts(e,a,t,i):(this.local.apply(this,[t||this,"nyt:community-thread-loaded",[],a.getStream().models].concat(i)),this.addReplies.apply(this,[a.getStream().models,t].concat(i)))},addThreadWatcher:function(e,t){var i=this;this.listenTo(t,"nyt:community-thread-loaded",function(){i.local.apply(i,[e,"nyt:community-thread-loaded"].concat(Array.prototype.slice.call(arguments,0)))})},fetchPosts:function(e,t,i,n){var s,a,o=this,r=this.toQuery(e||{},t);t.setLoading(!0),this.addThreadWatcher.apply(this,[i||this,t].concat(n)),a=this.apiGet(r).done(function(i){s=t.getStream().populate(o.sanitize(i,r)),"replies"===e.filter&&o.updateParentPost(t),o.setMetaData(i,t,e),t.setLoading(!1),o.local.apply(o,[t,"nyt:community-thread-loaded",s,t.getStream().models].concat(n)),o.addReplies.apply(o,[s,t].concat(n)),o.stopListening(t,"nyt:community-thread-loaded")}).fail(function(){t.setLoading(!1),o.local.apply(o,[t,"nyt:community-thread-loaded",[],t.getStream().models].concat(n))}),this.local(i||this,"nyt:community-thread-requested",this,a)},toQuery:function(t,i,n){return e.extend(i.toQuery(),{offset:t&&t.offset?t.offset:i.get("offset"),limit:t?t.limit:void 0,asset:this.getAsset()},n)},addReplies:function(t,i,n){var a,o=this.getThreads();n=n||{},a=arguments.length>2?Array.prototype.slice.call(arguments,2):[n],e.each(t,function(t){var r=t.getReplies(),l=o.findWhere({context:t.getSequence(),permID:t.getPermId()});r.length>0&&(l||(l=new s({context:t.getSequence(),filter:"replies",permID:t.getPermId(),stream:r}),o.add(l)),n.parent=t.getId(),this.local.apply(this,[i||this,"nyt:community-thread-loaded",r,l.getStream().models].concat(a)),this.addReplies(l.getStream().models,i,e.clone(n)))},this)},updateParentPost:function(e){var t=this.getThreads().findWhere({context:"0"}),i=t.getStream().findWhere({commentSequence:e.get("context")});i&&i.set("replies",e.getStream().models)},buildTaxonomy:function(){var e,t,i,n,s,a=this.pageManager.getMeta("SCG");this.isValidTaxonomy(this.getTaxonomy())||(s=this.pageManager.getMeta("communityAssetTaxonomy"),t=this.pageManager.getMeta("CG"),i=this.pageManager.getMeta("hdl"),n=this.pageManager.getMeta("slug"),s||(e=[],"string"==typeof t&&""!==t&&e.push(t),"string"==typeof i&&""!==i&&(i=i.replace(/\&\%\?/g,""),e.push(i)),s=e.join("/"),"string"==typeof n&&""!==n&&(s+=" ("+n+")")),"roomfordebate"===a&&s.indexOf("(undefined)")>-1&&(e=[],"string"==typeof t&&""!==t&&e.push(t.toLowerCase()),e.push(a),"string"==typeof n&&""!==n&&"undefined"!==n&&e.push(n),s=e.join("/")),this.setTaxonomy(s))},fetchMorePosts:function(t,i,n){this.fetchPosts(e.extend({limit:25},t,{offset:i.getStream().length}),i,n)},fetchLatestPosts:function(e){this.fetchPosts({},e)},post:function(e,t,i){var n,s,a=this,o=this.getUser();return i.ancestorId>0||i.parentId>0?(n="reply",s=i.ancestorId>0?i.ancestorId:i.parentId):(n="comment",s=0),this.apiPost({command:n,userID:o.getUserId(),userEmail:o.getEmail(),userDisplayName:o.getName(),userLocation:o.getLocation(),asset:this.getAsset(),parentID:s,commentBody:t.commentBody,commentTitle:t.commentTitle,assetTaxonomy:this.getTaxonomy()}).done(function(){e.local(e,"nyt:community-comment-posted",t,i),a.apiPost({command:"notify",commentNotify:t.commentNotify})})},setMetaData:function(t,i,n){var s=["all"];i&&"permalink"!==i.get("filter")&&(this.setCount(t,i,n),this.setUserData(t.userData)),"string"==typeof t.commentQuestion&&t.commentQuestion.length>0&&this.setPrompt(t.commentQuestion),"undefined"!=typeof t.userRating&&this.setRating(t),e.isObject(t.asset)&&this.isValidTaxonomy(t.asset.taxonomy)&&this.setTaxonomy(t.asset.taxonomy),"undefined"!=typeof t.canSubmit&&this.setOpen(t.canSubmit),t.totalRecommendationsFound&&s.push("reader"),t.totalEditorsSelectionFound&&s.push("nytpicks"),t.totalReporterReplyCommentsFound&&s.push("nytreplies"),this.setFilters(s)},findPost:function(e){var t=!1;return this.getThreads().each(function(i){var n;return t?!1:(n=i.getStream().findWhere(e),n?(t=n,!1):void 0)},this),t},setUserData:function(e){var t=this.getUser();t&&t.setCarefully(e)},setRating:function(e){this.set("userRating",e.userRating),this.set("avgRating",e.averageRating)},setCount:function(e,t,i){if("replies"!==t.get("filter")){switch(this.set("total-all",e.totalCommentsFound),this.set("total-parent",e.totalParentCommentsFound),this.set("total-reader",e.totalRecommendationsFound),this.set("total-nytpicks",e.totalEditorsSelectionFound),this.set("total-nytreplies",e.totalReporterReplyCommentsFound),t.get("filter")){case"all":t.set("count",e.totalParentCommentsFound);break;case"reader":t.set("count",e.totalRecommendationsFound);break;case"nytpicks":t.set("count",e.totalEditorsSelectionFound);break;case"nytreplies":t.set("count",e.totalReporterReplyCommentsFound)}i.limit&&t.trackRequested(i.limit)}},getUserContent:function(){var e=this,t=e.getThreads();("undefined"==typeof this.getExcerpt()||0===this.getExcerpt().length)&&this.apiGet({path:this.getAsset(),command:"content"}).done(function(i){var n;i.hasOwnProperty("excerpts")&&(n=new s({context:0,filter:"excerpt",stream:i.excerpts}),t.add(n),e.setExcerpt(n.getStream().models[0]))})},getNumberOfPosts:function(e){return this.get("total-"+("string"==typeof e?e:"all"))},hasAdditionalPosts:function(e){var t=this.getThreads(),i=this.buildValidQuery(e),n=t.findWhere(i);return n?n.hasAdditionalPosts():!1},isValidTaxonomy:function(e){return"string"==typeof e&&e.length>0&&-1===e.indexOf("undefined")},getAverageRating:function(){return this.get("averageRating")},getViews:function(){return this.get("views")},getAsset:function(){return this.get("asset")},getThreads:function(){return this.get("threads")},getTaxonomy:function(){return this.get("taxonomy")},getExcerpt:function(){return this.get("excerpt")||""},getUser:function(){return this.get("user")},isOpen:function(){return this.get("isOpen")},getPrompt:function(){return this.get("prompt")},getFilters:function(){return this.get("filters")},getDefaultQuery:function(){return this.get("defaultQuery")},setTaxonomy:function(e){this.set("taxonomy",e)},setExcerpt:function(e){this.set("excerpt",e)},setOpen:function(e){this.set("isOpen",e)},setPrompt:function(e){this.set("prompt",e)},setFilters:function(e){this.set("filters",e)},setUser:function(e){this.set("user",e)},setDefaultQuery:function(e){this.set("defaultQuery",e)}}));return a}),define("shared/community/collections/community-loader",["underscore/nyt","foundation/hosts","foundation/collections/base-collection","shared/community/models/discussion","shared/community/instances/community-user"],function(e,t,i,n,s){var a=i.extend({model:n,StatusCode:{ENABLED:"enabled",DISABLED:"disabled",WAITING:"waiting"},enabledQueue:[],disabledQueue:[],initialize:function(){this.subscribe("nyt:community-request",this.loadDiscussion),this.subscribe(this,"add",this.notify),this.subscribe(this,"add",this.setUserModel),this.status=this.StatusCode.WAITING,this.pageManager.isDomReady()?this.ready():this.subscribe("nyt:page-ready",this.ready)},enabled:function(e){"function"==typeof e&&this.enabledQueue.push(e)},disabled:function(e){"function"==typeof e&&this.disabledQueue.push(e)},ready:function(){this.setStatus(this.pageManager.$html.hasClass("has-comments")?this.StatusCode.ENABLED:this.StatusCode.DISABLED),this.runQueue()},setStatus:function(e){this.status=e},isEnabled:function(){return this.status===this.StatusCode.ENABLED},runQueue:function(){e.each(this[this.status+"Queue"],function(e){e.call(this)},this),this[this.status]=function(e){"function"==typeof e&&e.call(this)}},loadDiscussion:function(t,i,n){var s;t=t||((location.origin||location.protocol+"//"+location.hostname)+location.pathname).replace(/www\.dev|www\.sbx/i,"www.stg"),s=this.findWhere({asset:t}),this.local(i,"nyt:community-loading",t),s?(s.getViews().push(i),this.notify(s,this,{},i)):this.add(e.extend({},n||{},{asset:t,views:[i],permID:location.hash.substr(location.hash.indexOf("=")+1)||void 0}))},notify:function(e,t,i,n){this.local(n||e.getViews()[0],"nyt:community-loaded",e)},setUserModel:function(e){e.setUser(s)}});return a}),define("shared/community/templates",["underscore/nyt"],function(_){var templates={};return templates.button=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",skipToContentId&&(__p+='\n<a class="visually-hidden" href="#'+(null==(__t=skipToContentId)?"":__t)+'">Continue reading the main story</a>\n'),__p+='\n<i class="icon"></i>\n',__p+=count>0?'\n<span class="button-text">\n':'\n<span class="button-text no-comments">\n',__p+="\n",count>0?(__p+='\n<span class="count">'+(null==(__t=count)?"":__t)+"</span>\n",showUnits&&(__p+='\n<span class="units">'+(null==(__t=units)?"":__t)+"</span>\n"),__p+="\n"):defaultText&&(__p+='\n<span class="default">'+(null==(__t=defaultText)?"":__t)+"</span>\n"),__p+="\n</span>";return __p},templates.comments=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<section id="comments" class="comments" tabindex="1">\n<div class="comment-permalink-view">\n</div>\n<div class="comments-header-container">\n<header class="comments-header">\n<div id="Spon2" class="ad comments-tile-ad"></div>\n<h2 class="section-heading" tabindex="1"><i class="icon comments-icon"></i>'+(null==(__t=header)?"":__t)+"</h2>\n",commentPromptVisibility&&(__p+='\n<p class="comment-prompt">'+(null==(__t=commentPrompt)?"":__t)+"</p>\n"),__p+="\n",isOpen||(__p+='\n<p class="comments-status">The comments section is closed. To send a letter to the editor, write to <a href="mailto:letters@nytimes.com">letters@nytimes.com</a>. </p>\n'),__p+='\n</header>\n<div class="comment-form-control form-control thread-form active"></div>\n<div class="comments-view-navigation">\n<div class="tabs-container">\n<ul class="tabs ',4===filterCount&&(__p+="theme-all-tabs"),__p+='">\n',_.each(filters,function(e,t){__p+='\n<li class="tab '+(null==(__t=t)?"":__t)+'" data-filter="'+(null==(__t=t)?"":__t)+'" tabindex="5">'+(null==(__t=e)?"":__t)+"\n",(4!==filterCount||"All"!==e)&&(__p+='\n<span class="count" data-filter="'+(null==(__t=t)?"":__t)+'">&nbsp;'+(null==(__t=view.model.getNumberOfPosts(t))?"":__t)+"</span>\n"),__p+="\n</li>\n"}),__p+='\n</ul>\n</div>\n<div class= "comments-sort-container">\n<div class="comments-sort" tabindex="5">'+(null==(__t=sort)?"":__t)+'</div><i class="icon"></i>\n</div>\n</div>\n</div>\n<div class="comments-view tab-content" tabindex="50">\n<footer class="comments-footer">\n<div class="comments-expand comments-thread-expand" data-action="read-more" tabindex="55">Read More <i class="icon"></i></div>\n</footer>\n<div class="loader-container">\n<div class="loader"><span class="visually-hidden">Loading...</span></div>\n</div>\n</div><!-- close comments-view -->\n',view.model.getNumberOfPosts("all")>1&&(__p+='\n<div class="view-all" data-filter="all">View all '+(null==(__t=view.model.getNumberOfPosts("all"))?"":__t)+" comments</div>\n"),__p+="\n</section><!-- close comments -->";return __p},templates.commentsPanel=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="panel-controls">\n<button class="button close-panel-button">\n<i class="icon"></i><span class="visually-hidden">Close this panel</span>\n</button>\n<button class="button toggle-panel-button">\n<i class="icon expand"> &laquo; </i><span class="visually-hidden">Expand this panel</span>\n<i class="icon collapse"> &raquo; </i><span class="visually-hidden">Collapse this panel</span>\n</button>\n</div>\n<div class="panel-content">\n</div>';return __p},templates.flag=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){__p+='<form class="flag-form">\n';var i=0;_.each(reasons,function(e,t){i+=1,__p+='\n<div class="control checkbox-control control-'+(null==(__t=i%2===1?"odd":"even")?"":__t)+'">\n<div class="field-container">\n<input type="checkbox" value="'+(null==(__t=t)?"":__t)+'" id="flag-checkbox-'+(null==(__t=e)?"":__t)+'" name="flag-checkbox-'+(null==(__t=e)?"":__t)+'" class="flag-input checkbox" tabindex="'+(null==(__t=i)?"":__t)+'" />\n</div>\n<div class="label-container">\n<label for="flag-checkbox-'+(null==(__t=e)?"":__t)+'" class="checkbox-label">'+(null==(__t=t)?"":__t)+"</label>\n</div>\n</div><!-- close control -->\n"}),__p+='\n<div class="control last-control">\n<button id="flag-send-button" class="button flag-button" tabindex="'+(null==(__t=i+=1)?"":__t)+'" >Flag</button>\n<button id="flag-cancel-button" class="button cancel-button" tabindex="'+(null==(__t=i+=2)?"":__t)+'">Cancel</button>\n</div>\n</form>'}return __p},templates.form=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<form class="comment-form" role="form">\n',"0"!==user.getUserId()&&(__p+='<div class="control header-control layout-horizontal secondary-control">',user.getName()&&user.getLocation()?(__p+="<!-- registered/logged in commenter -->\n",user.hasAvatar()&&(__p+='\n<div class="avatar"><img src="'+(null==(__t=user.getAvatar())?"":__t)+'"/></div>\n'),__p+='\n<div class="commenter-meta">\n<h2 class="commenter">'+(null==(__t=user.getName())?"":__t)+'</h2>\n<div class="form-hint-container">\n<p class="form-hint">Not You? <a href="'+(null==(__t=user.get("wwwhost")+"/logout")?"":__t)+'">Log Out</a></p>\n</div>\n<p class="commenter-location">'+(null==(__t=user.getLocation())?"":__t)+"</p>\n</div>"):(__p+="\n<!-- first time commenter -->",user.hasAvatar()&&(__p+='\n<div class="avatar"><img src="'+(null==(__t=user.getAvatar())?"":__t)+'"/></div>\n'),__p+='<div class="control">\n<div class="label-container visually-hidden">\n<label for="commenter-input" id="commenter-input-label">Full Name</label>\n</div>\n<div class="field-container">\n<input type="text" id="commenter-input" name="commenter-input" class="commenter-input text" placeholder="Full Name" tabindex="3" autocomplete="off" aria-labelledby="commenter-input-label" aria-required="true"/>\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-name-description"><i class="icon"></i><span class="visually-hidden" id="clear-name-description">Clear this text input</span></button>\n</div>\n</div><!-- close control --><div class="control">\n<div class="label-container visually-hidden">\n<label for="commenter-location-input" id="commenter-location-input-label">Location</label>\n</div>\n<div class="field-container">\n<input type="text" id="commenter-location-input" name="commenter-location-input" class="commenter-location-input text" placeholder="Location" tabindex="3" autocomplete="off" aria-labelledby="commenter-location-input-label" aria-required="true"/>\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-location-description"><i class="icon"></i><span class="visually-hidden" id="clear-location-description">Clear this text input</span></button>\n</div>\n</div><!-- close control -->'),__p+="\n</div><!-- close control -->"),__p+='<div class="control input-control primary-control">\n<div class="label-container visually-hidden">\n<label class="commenter-gateway-input-label" for="commenter-gateway-input" id="commenter-gateway-input-label">'+(null==(__t=gatewayLabel)?"":__t)+'</label>\n</div>\n<div class="field-container">\n<input type="text" id="commenter-gateway-input" name="commenter-gateway-input" class="commenter-gateway-input comment-primary" placeholder="'+(null==(__t=gatewayPlaceholder)?"":__t)+'" tabindex="3" aria-labelledby="commenter-gateway-input-label" aria-required="false" />\n</div>\n</div><!-- close control -->',parseInt(user.getUserId(),10)>0&&(__p+='\n<div class="control textarea-control secondary-control">\n<p id="comment-character-count" class="comment-character-count">1500</p>\n<div class="field-container">\n<textarea id="comment-textarea" class="comment-textarea textarea" tabindex="3" aria-required="true"></textarea>\n<div class="error-container">\n<div id="comment-form-error" class="comment-form-error">\n<p class="character-error hidden">Please ensure that your comment is under 1500 characters, and then click Submit.</p>\n<p class="user-info-error hidden">Please enter your location and name.</p>\n<p class="server-error hidden">An error has occurred, please try again later.</p>\n</div>\n</div>\n</div>\n</div><!-- close control --><div class="control footer-control layout-horizontal secondary-control">\n<div class="control checkbox-control">\n<div class="field-container">\n<input type="checkbox" id="comment-notify" class="comment-notify" name="comment-notify" class="checkbox" tabindex="3"\n'+(null==(__t=user.getNotify()>0?'checked="checked"':"")?"":__t)+' aria-labelledby="comment-notify-label" aria-required="false" />\n</div><!-- close field-container -->\n<div class="label-container">\n<label class="checkbox-label" for="comment-notify" id="comment-notify-label">Email me when my comment is published.</label>\n<p class="form-description">Comments are moderated. <a href="http://www.nytimes.com/content/help/site/usercontent/usercontent.html">FAQ &raquo;</a></p>\n</div>\n</div><!-- close control -->\n<div class="control button-control">\n<span id="comment-submit-loader" class="comment-submit-loader hidden"><img src=""></span><!-- this may end up a data uri in the less -->\n<button type="submit" id="comment-submit-button" class="button comment-submit-button disabled" disabled="disabled" tabindex="3">Submit</button>\n</div><!-- close control -->\n</div><!-- close control -->'),__p+="\n</form>",confirmPost&&(__p+='\n<div class="comment-confirmation">\n<p class="confirmation">',__p+=message.commentNotify?" Thank you for your submission. We'll notify you at "+(null==(__t=user.getEmail())?"":__t)+" when your comment has been approved.\n":"\nThank you for your submission. Your comment will appear once it has been approved.\n",__p+='</p>\n<article class="comment">\n',showAvatar&&user.hasAvatar()&&(__p+='\n<div class="avatar"><img src="'+(null==(__t=user.getAvatar())?"":__t)+'"/></div>\n'),__p+='\n<header>\n<h2 class="commenter">'+(null==(__t=user.getName())?"":__t)+"</h2>\n",showLocation&&(__p+='\n<span class="commenter-location">'+(null==(__t=user.getLocation())?"":__t)+"</span>\n"),__p+='\n<time class="comment-time" datetime="">Pending Approval</time>\n</header>\n<p class="comment-text">'+(null==(__t=message.commentBody)?"":__t)+"</p>\n</article>\n</div>\n"),__p+="";return __p},templates.peek=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",skipToContentId&&(__p+='\n<a class="visually-hidden" href="#'+(null==(__t=skipToContentId)?"":__t)+'">Continue reading the main story</a>\n'),__p+="\n",header&&(__p+='\n<header>\n<h2 class="module-heading"><i class="icon"></i>'+(null==(__t=header)?"":__t)+"</h2>\n</header>\n"),__p+='\n<div class="comments-view">\n',_.each(posts,function(e,t){isPrompt?__p+='\n<h3 class="comment-prompt">'+(null==(__t=e)?"":__t)+'</h3>\n<p class="user-action"><a href="javascript:">Share your thoughts &raquo;</a></p>\n':maxPosts>t&&(__p+='\n<article class="comment" data-permid="'+(null==(__t=e.getPermId())?"":__t)+'">\n<header>\n<h2 class="commenter">'+(null==(__t=e.getAuthor())?"":__t)+"</h2>\n",showDate&&(__p+='\n<time class="comment-time" datetime="">'+(null==(__t=e.get(dateFormat+"Date"))?"":__t)+"</time>\n"),__p+="\n",showLocation&&(__p+='\n<span class="commenter-location">'+(null==(__t=e.getLocation())?"":__t)+"</span>\n"),__p+='\n</header>\n<p class="comment-text">'+(null==(__t=e.get(isExcerpt?"commentExcerpt":"commentBody"+(maxChars||"")))?"":__t)+"</p>\n</article>\n")}),__p+="\n</div><!-- close comments-view -->\n",showFooter&&(__p+='\n<footer>\n<ul class="comment-actions">\n<li class="comment-count">\n',__p+=showCount?"\n"+(null==(__t=count)?"":__t)+" Comment"+(null==(__t=1===count?"":"s")?"":__t)+"\n":"\nSee All Comments\n",__p+="\n</li>\n",isOpen&&(__p+='\n<li class="comment-reply">Write a comment</li>\n'),__p+="\n</ul>\n</footer>\n"),__p+="";return __p},templates.post=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<article class="comment '+(null==(__t=isSubThread?"threaded-comment":"")?"":__t)+" "+(null==(__t=post.isPicked()?"picked-comment":"")?"":__t)+" "+(null==(__t=post.isNyt()?"reporter-comment":"")?"":__t)+'" data-id="'+(null==(__t=post.getId())?"":__t)+'" data-parentid="'+(null==(__t=post.getParentId())?"":__t)+'" data-sequence="'+(null==(__t=post.getSequence())?"":__t)+'"  data-permID="'+(null==(__t=post.getPermId())?"":__t)+'" tabindex="30">\n',post.isPicked()&&(__p+='\n<i class="icon nyt-pick-icon"><span class="visually-hidden">NYT Pick</span></i>\n'),__p+="\n",showAvatar&&post.hasAvatar()&&(__p+='\n<div class="avatar"><img src="'+(null==(__t=post.getAvatar())?"":__t)+'"/></div>\n'),__p+='\n<header>\n<h3 class="commenter">'+(null==(__t=post.getAuthor())?"":__t)+"</h3>\n",(post.isTrusted()||post.isNyt())&&(__p+='\n<span class="commenter-credentials"><i class="icon '+(null==(__t=post.isTrusted()?"trusted-icon":"t-icon")?"":__t)+'"><span class="visually-hidden">'+(null==(__t=post.isTrusted()?"is a trusted commenter":"is an NYTimes reporter")?"":__t)+"</span></i></span>\n"),__p+="\n",post.isNyt()?__p+='\n<span class="commenter-title">'+(null==(__t=post.getUserTitle())?"":__t)+"</span>\n":showLocation&&(__p+='\n<span class="commenter-location">'+(null==(__t=post.getLocation())?"":__t)+"</span>\n"),__p+='\n<a href="'+(null==(__t=view.model.getAsset()+"#permid="+post.getPermId())?"":__t)+'"class="comment-time" datetime="">'+(null==(__t=post.get(dateFormat+"Date"))?"":__t)+'</a>\n</header>\n<p class="comment-text">'+(null==(__t=post.get("commentBody"))?"":__t)+'</p>\n<footer>\n<ul class="comment-actions">\n<li class="comment-flag login-modal-trigger '+(null==(__t=post.isReported()?"comment-reported":"")?"":__t)+'"><i class="icon"></i>'+(null==(__t=post.isReported()?"Reported":"Flag")?"":__t)+"</li>\n","all"!==filter&&!isPermalink&&post.getParentId()>0&&(__p+='\n<li class="comment-parent" data-permid="'+(null==(__t=post.getParentPermId())?"":__t)+'">In Reply to '+(null==(__t=post.getParentAuthor())?"":__t)+"</li>\n"),__p+="\n",isOpen&&(__p+='\n<li class="comment-reply login-modal-trigger">Reply</li>\n'),__p+='\n<li class="comment-recommend login-modal-trigger '+(null==(__t=post.isRecommended()?"recommended":"")?"":__t)+'">',post.getRecommendations()>0&&(__p+="<span class='recommend-count'><i class=\"icon\"></i>"+(null==(__t=post.getRecommendations())?"":__t)+"</span>"),__p+=""+(null==(__t=post.isRecommended()?"Recommended":"Recommend")?"":__t)+'</li>\n<li class="sharetools"><span class="facebook-share" data-share="facebook"><i class="icon"></i><span class="visually-hidden">Share this comment on Facebook</span></span><span class="twitter-share" data-share="twitter"><i class="icon"></i><span class="visually-hidden">Share this comment on Twitter</span></span></li>\n</ul>\n</footer>\n<div class="comment-form-control form-control reply-form-control active"></div>\n',post.hasReplies()&&(__p+='\n<div class="thread"></div>\n',post.hasAdditionalReplies()&&!isPermalink&&"all"===filter&&(__p+='\n<div class="comments-expand comments-subthread-expand">See All Replies <i class="icon"></i></div>\n'),__p+="\n"),__p+="\n</article>";
return __p},templates.verified=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<a class="faq-link" href="http://www.nytimes.com/content/help/site/usercontent/verified/verified-commenters.html">\nVerified Commenters\n</a>\ncan leave comments on NYTimes.com without initial moderation. Verified status is earned based on a history of quality comments.';return __p},templates}),define("shared/community/views/comments-panel",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/community/templates"],function(e,t,i,n){var s=i.extend({className:"comments-panel",template:n.commentsPanel,mastheadHeight:47,ribbonHeight:82,events:{"click .close-panel-button":"close","click .toggle-panel-button":"expandCollapsePanel"},nytEvents:{"nyt:community-commentspanel-open":"open","nyt:community-commentspanel-close":"close","nyt:messaging-critical-alerts-move-furniture":"movePanelForAlerts","nyt:messaging-suggestions-move-furniture":"movePanelForAlerts"},defaultSettings:{},initialize:function(i){this.settings=t.extend({},this.defaultSettings,i),this.$main=e("#main"),this.$story=e("#story"),this.$commentsButton=e(".comments-button"),this.$whiteOverlay=e('<div class="comments-overlay"></div>').appendTo(this.$body).hide(),this.expandIsExplicit=!1,this.pageManager.isDomReady()?this.render():this.subscribe("nyt:page-ready",this.render)},render:function(){this.$el.hide().addClass(this.settings.className).html(this.template(this.settings)),this.$story.append(this.$el);var t=this.$el.find(".expand"),i=this.$el.find(".collapse"),n=this;return this.isPanelExpanded()?(t.hide(),i.show()):(i.hide(),t.show()),this.$body.on("click",function(t){e(t.target).hasClass("comments-panel-trigger")&&n.open()}),this},open:function(){this.$commentsButton.each(function(t,i){e(i).hasClass("button-masthead")?e(i).addClass("active"):e(i).hide()}),this.$html.addClass("comments-panel-opened"),this.isScrollAboveTrigger()&&this.scrollToTarget(this.$story,55),this.$el.show().animate({opacity:1,right:this.handleRightOffset()},250),this.handlePanelSettings(),this.handleScroll(),this.subscribe("nyt:page-breakpoint",this.handlePanelSettings),this.subscribe("nyt:page-scroll",this.isScrollAboveTrigger),this.subscribe("nyt:page-scroll",this.handleScroll),this.broadcast("nyt:comments-panel-opened")},close:function(){var t=this.pageManager.getMeta("isCommentsOpen");this.$el.animate({opacity:0,right:"-40px"},250,function(){e(this).hide()}),this.$whiteOverlay.hide(),this.$commentsButton.each(function(i,n){var s=e(n);s.hasClass("button-masthead")?s.removeClass("active"):s.hasClass("theme-speech-bubble")&&!t?s.hide():s.show()}),this.$html.removeClass("comments-panel-opened"),this.stopSubscribing("nyt:page-breakpoint",this.handlePanelSettings),this.stopSubscribing("nyt:page-resize",this.adjustRightOffset),this.stopSubscribing("nyt:page-resize",this.setElasticPanelWidth),this.stopSubscribing("nyt:page-scroll",this.isScrollAboveTrigger),this.stopSubscribing("nyt:page-scroll",this.handleScroll),this.stopSubscribing("nyt:page-scroll-unthrottled",this.setVerticalPosition),this.broadcast("nyt:comments-panel-closed")},scrollToTarget:function(e,t){this.$body.animate({scrollTop:e.offset().top-t},500)},expandCollapsePanel:function(){var e,t=this.$el.find(".expand"),i=this.$el.find(".collapse"),n=this.$el.find(".comments-header-container"),s=Math.round(this.$main.width()-this.$story.width()-50),a=this;this.isPanelExpanded()?(this.$el.removeClass("panel-wide").animate({width:s},300,function(){e=a.$el.width()-73,t.show(),i.hide(),n.css("width",e)}),this.expandIsExplicit=!1):(this.$el.addClass("panel-wide").animate({width:555},300,function(){t.hide(),i.show(),n.css("width","481px")}),this.expandIsExplicit=!0)},adjustRightOffset:function(){this.$el.css("right",this.$shell.offset().left+1)},handleRightOffset:function(){var e,t=this.pageManager.getCurrentBreakpoint();return t>=10070?(e=this.$shell.offset().left+1,this.subscribe("nyt:page-resize",this.adjustRightOffset)):(e="0",this.stopSubscribing("nyt:page-resize",this.adjustRightOffset)),e},setPanelWidth:function(){var e=this.pageManager.getCurrentBreakpoint();e>=10011||1020>=e?(this.$el.addClass("panel-wide").css("width","585px"),this.stopSubscribing("nyt:page-resize",this.setElasticPanelWidth)):e>=1050&&10011>e?this.expandIsExplicit===!1&&(this.$el.removeClass("panel-wide"),this.setElasticPanelWidth(),this.subscribe("nyt:page-resize",this.setElasticPanelWidth)):(this.$el.addClass("panel-wide").css("width","435px"),this.stopSubscribing("nyt:page-resize",this.setElasticPanelWidth))},setElasticPanelWidth:function(){var e=this.$main.width()-this.$story.width()-50;this.$el.css("width",e)},handlePanelSettings:function(){this.$el.css("right",this.handleRightOffset()),this.setPanelWidth(),this.setVerticalPosition()},shortPanel:function(){var e,t=this.$window.scrollTop(),i=Math.abs(this.$story.offset().top-8),n=i-t;e=10>t?i:n,this.$el.css("top",e)},tallPanel:function(){this.$el.css("top",this.mastheadHeight)},setVerticalPosition:function(){var e=this.pageManager.getCurrentBreakpoint();1020>=e?(this.$whiteOverlay.show(),this.$el.css("top","-2px")):(this.$whiteOverlay.hide(),this.isScrollAboveTrigger()?this.shortPanel():this.tallPanel())},isScrollAboveTrigger:function(){var e=this.$window.scrollTop(),t=this.$story.offset().top-56;return t>=e?!0:void 0},handleScroll:function(){this.isScrollAboveTrigger()?this.subscribe("nyt:page-scroll-unthrottled",this.setVerticalPosition):(this.stopSubscribing("nyt:page-scroll-unthrottled",this.setVerticalPosition),this.setVerticalPosition()),this.broadcast("nyt:community-panel-positioned")},isPanelExpanded:function(){return this.$el.hasClass("panel-wide")},movePanelForAlerts:function(e){e(this.$el)}});return s}),define("shared/community/views/utils-mixin",["jquery/nyt","underscore/nyt"],function(e,t){var i={request:function(){this.broadcast("nyt:community-request",this.settings.asset,this,this.settings)},getPosts:function(e){this.model=e,this.model.load(this.settings,this)},toQuery:function(e){return e=e||{},t.extend({},this.settings,e)},openPanel:function(e){var i;this.broadcast("nyt:community-commentspanel-open",e),i=t.extend({module:"Comments",action:"Click",eventName:"OpenCommentsPanel"},this.getTrackingParams()),this.trackingTrigger("comments-open-panel",i),this.trackingComscorePVC(i)},truncate:function(e){var i=this,n=function(e,t){return e.length<=t?e:" "!==e.charAt(t)&&"."!==e.charAt(t)?n(e,t-1):e.substr(0,t)+"..."};"undefined"!=typeof e&&(e=e.slice?e:[e],t.each(e,function(e){e.set("commentBody"+i.settings.maxChars,n(i.stripHtml(e.getBody()),i.settings.maxChars))}))},stripHtml:function(t){return"string"==typeof t?e("<p>"+t+"</p>").text():""+t},formatDefaultDate:function(e){return e},formatDate:function(e){"undefined"!=typeof e&&(e=e.slice?e:[e]),t.each(e,function(e){var t=e.getDate();t="interval"===this.settings.dateFormat?this.prettyDate(t):this.formatDefaultDate(t),e.set(this.settings.dateFormat+"Date",t),e.hasReplies()&&this.formatDate(e.getReplies())},this)},getTrackingParams:function(){var e={},i={"theme-kicker":{region:"Header",version:"CommentsHeader"},"button-masthead":{region:"TopBar",version:"CommentsTopBar"},"selected-comment-marginalia":{region:"Marginalia",version:"RecentComments"},"featured-comment-marginalia":{region:"Body",version:"FeaturedComments"},"comment-prompt-marginalia":{region:"Body",version:"CommentsPrompt"},"theme-speech-bubble":{region:"Body",version:"CommentsBubble"},"comments-panel":{region:"Body",version:"CommentsPanel"}},n=this.$el.attr("class").split(" ");return t.each(n,function(t){i.hasOwnProperty(t)&&(e=i[t])}),this.trackingBaseData.contentCollection=this.trackingBaseData.contentCollection||this.pageManager.getMeta("article:section"),e}};return i}),define("shared/community/views/comments-button",["underscore/nyt","foundation/views/base-view","shared/community/views/utils-mixin","shared/community/templates"],function(e,t,i,n){var s=t.extend(e.extend({},i,{template:n.button,events:{click:"openPanel"},defaultSettings:{units:"Comments",showUnits:!0,defaultText:null,hideWhenClosed:!1},initialize:function(t){this.settings=e.extend({},this.defaultSettings,t),this.subscribeOnce(this,"nyt:community-loaded",this.render),this.request()},render:function(t){var i,n=t.getNumberOfPosts(),s=this.$el.attr("data-skip-to-para-id");return 1===n&&(this.settings.units="Comment"),i=e.extend({},this.settings,{count:n,skipToContentId:s}),this.model||(this.model=t,this.listenTo(t,"change:total-all",this.render)),!this.model.isOpen()&&this.settings.hideWhenClosed?this.$el.hide():(this.$el.html(this.template(i)),this)}}));return s}),define("shared/community/views/comments-peek",["underscore/nyt","foundation/views/base-view","shared/community/views/utils-mixin","shared/community/templates"],function(e,t,i,n){var s=t.extend(e.extend({},i,{className:"comments-peek",template:n.peek,events:{click:"openWithPermId"},defaultSettings:{header:null,hideOnOpen:!0,maxPosts:3,filter:"all",sort:"newest",showCount:!1,showDate:!0,dateFormat:"standard",isExcerpt:!1,isPrompt:!1,showLocation:!0,showFooter:!0,maxChars:140,defaultPrompt:"Share your thoughts."},initialize:function(t){this.settings=e.extend({},this.defaultSettings,t),this.settings.isPrompt&&(this.settings.showFooter=!1,this.settings.showDate=!1),this.settings.isExcerpt&&(this.settings.showDate=!1,this.settings.showCount=!0),this.subscribe(this,"nyt:community-loaded",this.getPosts),this.subscribeOnce(this,"nyt:community-thread-loaded",this.render),this.request()},render:function(t){var i,n=this.$el.attr("data-skip-to-para-id");if(this.settings.isExcerpt){if(0===this.model.getExcerpt().length)return this.$el.hide();t=[this.model.getExcerpt()],this.listenTo(this.model,"change:excerpt",this.render)}else if(this.settings.isPrompt){if(!this.model.isOpen()||this.model.getPrompt().toLowerCase()===this.settings.defaultPrompt.toLowerCase())return this.$el.hide();t=[this.model.getPrompt()];var s=1===this.model.getNumberOfPosts()?"Comment":"Comments";this.settings.header=this.model.getNumberOfPosts()+" "+s}else if(this.model.getNumberOfPosts()<=this.settings.maxPosts)return this.$el.hide();return i=e.extend({},this.settings,{posts:t,count:this.model.getNumberOfPosts(),isOpen:this.model.isOpen(),skipToContentId:n}),this.settings.maxChars>0&&!this.settings.isPrompt&&!this.settings.isExcerpt&&this.truncate(i.posts),this.settings.showDate&&this.formatDate(i.posts),this.$el.html(this.template(i)).show(),this},openWithPermId:function(){var e=this.$(".comment");1===e.length?this.openPanel(e.data("permid")):this.openPanel()}}));return s}),define("shared/sharetools/templates",["underscore/nyt"],function(_){var templates={};return templates.emailModal=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<iframe src="'+(null==(__t=emailThisUrl)?"":__t)+(null==(__t=dataUrl)?"":__t)+'" title="Email This" id="emailthis" scrolling="'+(null==(__t=scrolling)?"":__t)+'" marginheight="0" marginwidth="0" frameborder="0"></iframe>';return __p},templates.savemodal=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<ul class="instructions">\n<li>This item has been saved to read later from any device. </li>\n<li>Access saved items through your user name at the top of the page.</li>\n</ul>\n<p><a href="'+(null==(__t=link)?"":__t)+'">View Saved Items</a><p>\n<button class="button dismiss-button">OK</button>';return __p},templates.shareTool=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<a href="javascript:;" data-share="'+(null==(__t=id)?"":__t)+'"><i class="icon"></i><span class="sharetool-text '+(null==(__t=isLabelHidden===!0?"visually-hidden":"")?"":__t)+'">'+(null==(__t=label)?"":__t)+"</span></a>";return __p},templates.shareTools=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="<ul>\n",_.each(shares,function(e){__p+='\n<li class="sharetool '+(null==(__t=e.type)?"":__t)+"-sharetool "+(null==(__t=config[e.type].loginRequired?"login-modal-trigger":"")?"":__t)+'" data-modal-title="'+(null==(__t=config[e.type].loginModalText||"")?"":__t)+'">\n<a href="javascript:;" data-share="'+(null==(__t=e.type)?"":__t)+'"><i class="icon"></i><span class="sharetool-text">'+(null==(__t=e.label)?"":__t)+"</span></a>\n</li>\n"}),__p+="\n</ul>";return __p},templates.shareToolsModal=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="section share">\n<ul class="sharetools-menu">\n'+(null==(__t=standardToolsList)?"":__t)+'\n</ul>\n<form class="short-url-form">\n<div class="control">\n<div class="label-container"><label for="short-url-input">Permalink</label></div>\n<div class="field-container">\n<input id="short-url-input" class="short-url-input text" type="text" name="short-url-input" value="'+(null==(__t=shortUrl)?"":__t)+'" readonly="readonly" />\n</div>\n</div>\n</form>\n</div><!--close section -->\n<div class="section tools">\n<h4 class="modal-heading">Tools</h4>\n<ul class="sharetools-menu">\n'+(null==(__t=articleToolsList)?"":__t)+'\n</ul>\n</div><!--close section -->\n<div class="modal-footer">\n<div class="ad show-all-sharetool-modal-ad hidden">\n<small class="ad-sponsor">Article Tools Sponsored By</small>\n</div>\n</div><!-- close modal footer -->';return __p},templates.showAllSharetoolCompactModal=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="section share">\n<ul class="sharetools-menu">\n'+(null==(__t=showAllLinkList)?"":__t)+'\n</ul>\n</div> <!--close section -->\n<div class="section tools">\n<ul class="sharetools-menu">\n'+(null==(__t=showAllToolList)?"":__t)+'\n</ul>\n<div class="control permalink-control">\n<div class="label-container">\n<label for="permalink-input" class="sharetools-label">Permalink</label>\n</div>\n<div class="field-container">\n<input id="permalink-input" type="text" class="text short-url-input" placeholder="" readonly />\n<span class="textbox-fade"></span>\n</div>\n</div><!-- close control -->\n<div class="control embed-control">\n<div class="label-container">\n<label for="embed-input" class="sharetools-label">Embed</label>\n</div>\n<div class="field-container">\n<input id="embed-input" type="text" class="text embed-input" placeholder="" readonly />\n<span class="textbox-fade"></span>\n</div>\n</div><!-- close control -->\n</div> <!--close section -->\n<div class="modal-footer">\n<div class="ad show-all-sharetool-modal-ad hidden">\n<small class="ad-sponsor">Share Tools Sponsored By</small>\n</div>\n</div> <!-- close modal footer -->';return __p},templates.showAllSharetoolModal=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="section share">\n<ul class="sharetools-menu">\n'+(null==(__t=showAllLinkList)?"":__t)+'\n</ul>\n<form class="short-url-form">\n<div class="control">\n<div class="label-container"><label for="short-url-input">Permalink</label></div>\n<div class="field-container">\n<input id="short-url-input" class="short-url-input text" type="text" name="short-url-input" value="'+(null==(__t=shortUrl)?"":__t)+'" readonly/>\n</div>\n</div>\n</form>\n</div> <!--close section -->\n<div class="section tools">\n<h5 class="modal-heading"> Tools </h5>\n<ul class="sharetools-menu">\n'+(null==(__t=showAllToolList)?"":__t)+'\n</ul>\n</div> <!--close section -->\n<div  class="modal-footer">\n<div class="ad show-all-sharetool-modal-ad hidden">\n<small class="ad-sponsor">Article Tools Sponsored By</small>\n</div>\n</div> <!-- close modal footer -->';return __p},templates.showallLinks=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<li class="sharetool '+(null==(__t=shareObj.type)?"":__t)+"-sharetool "+(null==(__t=config.loginRequired?"login-modal-trigger":"")?"":__t)+'" data-modal-title="'+(null==(__t=config.loginModalText||"")?"":__t)+'">\n<a href="javascript:;" data-share="'+(null==(__t=shareObj.type)?"":__t)+'"><i class="icon"></i>'+(null==(__t=shareObj.label)?"":__t)+"</a>\n</li>";return __p},templates}),define("shared/sharetools/views/email",["jquery/nyt","underscore/nyt","foundation/hosts","foundation/views/base-view","shared/modal/views/modal","shared/sharetools/templates"],function(e,t,i,n,s,a){var o=n.extend({template:a.emailModal,className:"email-view-container",frameSize:{small:507,full:867,ad:285},defaultSettings:{emailThisUrl:"https:"+i.www+"/mem/email-this.html?url=",scrolling:window.Modernizr.postmessage?"no":"yes"},defaultModalSettings:{id:"email-share-modal",modalTitle:"Email This Article",binding:".email-sharetool",tailDirection:"centered",hasOverlay:!0,hasCloseButton:!0,modalContent:""},initialize:function(e){var i=this;t.bindAll(this,"handlePostMessage","responsive"),this.settings=t.extend({},this.defaultSettings,e),this.frameState="full",this.modalSettings=t.extend({},this.defaultModalSettings,{openCallback:function(){window.Modernizr.postmessage&&(window.addEventListener?window.addEventListener("message",i.handlePostMessage,!1):window.attachEvent("onmessage",i.handlePostMessage)),i.listenTo(i.pageManager,"nyt:page-breakpoint",i.responsive)},closeCallback:function(){this.removeFromPage(),window.addEventListener?window.removeEventListener("message",i.handlePostMessage,!1):window.detachEvent("onmessage",i.handlePostMessage),i.stopListening(i.pageManager,"nyt:page-breakpoint",i.responsive)}}),this.prepareUrls(),this.render()},render:function(){this.modalSettings.modalContent=this.template(this.settings),this.emailModal=new s(this.modalSettings),this.emailModal.addToPage(),t.defer(this.responsive,this.pageManager.getCurrentBreakpoint())},responsive:function(e){var t=this.emailModal.$modal.find("iframe");1010>=e&&"full"===this.frameState&&(t.css("height",t.height()+this.frameSize.ad+"px").width(this.frameSize.small),this.frameSize.state="small",this.emailModal.positionDialog()),e>1010&&"small"===this.frameState&&(t.css("height",t.height()-this.frameSize.ad+"px").width(this.frameSize.full),this.frameState="full",this.emailModal.positionDialog())},handlePostMessage:function(e){var t;/\.nytimes\.com$/.test(e.origin)&&(t=e.data.match(/(.+)\:(.+)/),t&&"frameheight"===t[1]?this.$el.css("height",t[2]):t&&"closewindow"===t[1]?this.emailModal.close():t&&"loginredirect"===t[1]&&(window.location=i.myaccount+"/auth/login?URI="+encodeURIComponent(window.location.href)))},prepareUrls:function(){"string"==typeof this.settings.dataUrl&&-1===this.settings.dataUrl.indexOf("http")&&(this.settings.dataUrl="http:"+i.www+this.settings.dataUrl)}});return o}),define("shared/sharetools/helpers/sharetools-config",["jquery/nyt","foundation/hosts"],function(){var e={};return e.common={mainClassName:"shareTools",itemClassName:"shareToolsItem",defaultActiveShares:"email,facebook,twitter,save,show-all|more,ad",defaultShowAllShares:"facebook|Share,email|Email,twitter|Tweet,linkedin|LinkedIn,google|Google+,reddit|Reddit,save|Save,reprints|Reprints,print|Print,ad",defaultUrl:window.location.href.replace(/#.*/,""),defaultTitle:document.title,defaultDescription:"",defaultAdPosition:"Frame4A",defaultOverlayAdPosition:"Frame6A",defaultWidth:600,defaultHeight:450,defaultTransition:"fade",labelSpecialChar:"|",hasAd:!1,loadedAdPositions:[],shortUrlApi:"http://www.nytimes.com/svc/bitly/shorten.jsonp",emailThisUrl:"https://www.nytimes.com/mem/email-this.html?url=",count:0},e.tools={facebook:{active:!0,onShowAll:!0,label:"Facebook",postUrl:"http://www.facebook.com/sharer.php",postType:"popup",shareParameters:{url:"u"},smid:"fb-share",width:655,height:430},twitter:{active:!0,onShowAll:!0,label:"Twitter",postUrl:"https://twitter.com/share",postType:"popup",shareParameters:{url:"url",title:"text",via:"via"},smid:"tw-share",width:600,height:450},google:{active:!0,onShowAll:!0,label:"Google+",postUrl:"https://plus.google.com/share",postType:"popup",shareParameters:{url:"url"},urlParameters:{hl:"en-US"},smid:"go-share",width:600,height:600},tumblr:{active:!0,onShowAll:!0,label:"Tumblr",postUrl:"http://www.tumblr.com/share/link",postType:"popup",shareParameters:{url:"url",title:"name",description:"description"},smid:"tu-share",width:560},linkedin:{active:!0,onShowAll:!0,label:"Linkedin",postUrl:"http://www.linkedin.com/shareArticle",postType:"popup",shareParameters:{url:"url",title:"title",description:"summary"},urlParameters:{mini:"true",source:"The New York Times"},smid:"li-share",width:750,height:450},reddit:{active:!0,onShowAll:!0,label:"Reddit",postUrl:"http://www.reddit.com/submit",postType:"popup",shareParameters:{url:"url",title:"title"},smid:"re-share",width:854,height:550},email:{loginModalText:"Log in to Email",active:!0,onShowAll:!0,label:"Email",loginRequired:!0},permalink:{active:!0,onShowAll:!0,label:"Permalink",postUrl:"http://www.nytimes.com/export_html/common/new_article_post.html",postType:"popup",shareParameters:{url:"url",title:"title",description:"summary"},smid:"pl-share",width:460,height:380,loginRequired:!1},"show-all":{active:!0,onShowAll:!1,label:"Show All"},reprints:{active:!0,onShowAll:!1,label:"Reprints",postUrl:"https://s100.copyright.com/AppDispatchServlet",postType:"popup",shareParameters:{url:"contentID"},urlParameters:{publisherName:"The New York Times",publication:"nytimes.com",token:"",orderBeanReset:"true",postType:"",wordCount:"",title:document.title,publicationDate:"",author:""}},save:{loginModalText:"Log in to Save",active:!0,onShowAll:!1,label:"Save",postUrl:e.common.defaultUrl.replace(/\?.*/,""),loginRequired:!0},print:{active:!0,onShowAll:!1,label:"Print",postUrl:e.common.defaultUrl,postType:"link",urlParameters:{pagewanted:"print"}},ad:{active:!0,onShowAll:!1,label:"Advertisement"},embed:{active:!0,onShowAll:!0,label:"Embed",loginRequired:!1},pinterest:{active:!0,onShowAll:!0,label:"Pinterest",postUrl:"https://www.pinterest.com/pin/create/button/",postType:"popup",shareParameters:{url:"url",media:"media",description:"description"},smid:"pin-share",width:600,height:450,loginRequired:!1}},e}),define("shared/sharetools/collections/cross-platform-save",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/collections/base-collection","foundation/hosts","foundation/lib/auth/userauth"],function(e,t,i,n,s,a){var o=n.extend({COMMAND:{save:"add",check:"list"},url:s.du+"/svc/profile/reading-list/v1/",save:function(e){var t=this;this.sync(this.COMMAND.save,e).done(function(i){t.add(i),t.trigger("nyt:xps-saved",e,i)}).fail(function(){t.trigger("nyt:xps-failed",e)})},sync:function(t,i){var n=new e.Deferred,s=setTimeout(function(){n.reject()},5e3),o={url:i},r={type:"GET",jsonp:"callback",jsonpCallback:"xpsCallback",dataType:"jsonp",cache:!0,url:this.url+t+".jsonp",data:"",success:function(e){clearTimeout(s),e&&e.assets?n.resolve(e.assets):n.reject()}};return a.getToken().done(function(t,i,n){t&&i&&"undefined"!=typeof n&&(r.data+="&token="+t),r.data+="&data="+JSON.stringify(o),e.ajax(r)}),n.promise()}});return o}),define("shared/sharetools/instances/cross-platform-save",["shared/sharetools/collections/cross-platform-save"],function(e){return new e}),define("shared/sharetools/collections/short-url",["jquery/nyt","backbone/nyt","foundation/collections/base-collection","shared/data/models/article","foundation/hosts","underscore/nyt"],function(e,t,i){var n=i.extend({url:"http://www.nytimes.com/svc/bitly/shorten.jsonp",initialize:function(){this.currentUrlRequest="",this.addCurrentPage()},sync:function(e,i,n){return n.dataType="jsonp",n.jsonpCallback="shortUrlCallback",n.jsonp="callback",n.cache=!0,n.data={url:this.currentUrlRequest},t.sync(e,i,n)},parse:function(e){return{url:this.currentUrlRequest,shortUrl:e.payload?e.payload.short_url:""}},addCurrentPage:function(){var t,i=this.pageManager.getCanonical();t="1"===this.pageManager.getUrlParam("rico")&&"undefined"!=typeof this.pageManager.getUrlParam("share_url")?this.pageManager.getUrlParam("share_url"):e("#masthead").find(".story-short-url").text(),i&&t&&this.add({url:i,shortUrl:t})},getRicoUrl:function(e){var t=this.pageManager.getUrlParam("share_url"),i=document.createElement("a");return i.href=e,i.pathname===location.pathname&&t&&7===t.indexOf("r-i.co/")?t:void 0},requestUrl:function(e){var t,i=this.findWhere({url:e});return i?i.get("shortUrl"):(t=this.getRicoUrl(e))?t:(this.currentUrlRequest=e,void this.fetch())}});return n}),define("shared/sharetools/instances/short-url",["shared/sharetools/collections/short-url"],function(e){return new e}),define("shared/sharetools/helpers/sharetools-mixin",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/sharetools/templates","shared/ad/views/ads","shared/sharetools/views/email","shared/modal/views/modal","shared/sharetools/instances/cross-platform-save","foundation/models/page-storage","foundation/hosts","foundation/models/user-data","shared/sharetools/helpers/sharetools-config","shared/sharetools/instances/short-url"],function(e,t,i,n,s,a,o,r,l,d,c,h,u){var m={getDataAttrs:function(e,i){var n,s=i||this.$el.data(),a=(s.shares||h.common[e?"defaultShowAllShares":"defaultActiveShares"]).split(","),o=[],r=h.common.hasAd;e&&(h.common.defaultUrl.indexOf("aponline")>-1||h.common.defaultUrl.indexOf("reuters")>-1)&&(a=t.without(a,"reprints|Reprints"));for(var l=0,d=a.length;d>l;l+=1)a[l].indexOf("|")>0?(n=a[l].split("|"),o.push({type:n[0],label:n[1]})):"ad"===a[l]?r=!0:o.push({type:a[l],label:a[l]});return h.tools.reprints.urlParameters.publicationDate=s.publishDate,t.extend({},{inlineTools:o,ad:r,url:h.common.defaultUrl,title:h.common.defaultTitle,description:h.common.defaultDescription},s)},setUpConfigOptions:function(){h.common.defaultTitle=this.pageManager.getMeta("og:title")||document.title,h.common.defaultDescription=this.pageManager.getMeta("description")||""},isMobileSharetools:function(){return this.pageManager.getCurrentBreakpoint()<1e3},openMailToLink:function(){var e="%0A%0A",t=encodeURIComponent(this.settings.title),i=encodeURIComponent(this.settings.description),n=encodeURIComponent(this.settings.url),s="NYTimes.com: "+t,a="From The New York Times:"+e+t+e+i+e+n;window.location="mailto:?subject="+s+"&body="+a},handleShortUrlShareAction:function(t,i){var n,s=this,a=window.open("",t.label+"Share","toolbar=0,status=0,height="+t.height+",width="+t.width+",scrollbars=yes,resizable=yes"),o=i||this.settings.url,r=this.createAnchor(o);t.smid&&!this.pageManager.isMobile()&&(r.search+=0===r.search.indexOf("?")?"&":"?",r.search+="smid="+t.smid,o=r.href),n=u.requestUrl(o)||"",n?this.shortUrlRedirect(n,t,a):this.listenToOnce(u,"add",function(){var e=u.findWhere({url:o});e&&s.shortUrlRedirect(e.get("shortUrl"),t,a)}),navigator.userAgent.match(/iPad/i)&&navigator.userAgent.match(/Safari/i)&&this.shortUrlRedirect(e("#masthead").find(".story-short-url").text(),t,a)},shortUrlRedirect:function(i,n,s){var a,o,r=[],l=t.extend({},this.settings);if(n.shareParameters&&l){var d=this.getTrackingParam();d&&(n.shareParameters.smv=d,l.smv=null),e.each(n.shareParameters,function(e,t){a="url"===e?i:l[e],a?r.push(t+"="+encodeURIComponent(a)):null===a&&r.push(t)})}r=r.join("&"),o=n.postUrl+this.paramChar(n.postUrl)+r,this.shoveUrlToNewWindow(o,s)},shoveUrlToNewWindow:function(e,t){t.document.location=e,t.document.close()},itemSaved:function(){l.get("sharetools_hasSaves")!==!0?(this.firstTimeSaveModal(),l.set("sharetools_hasSaves",!0)):this.growlSaveModal()},growlSaveModal:function(){var e=new o({id:"save-item-growl-modal",modalTitle:'<i class="icon"></i>Saved',tailDirection:"centered",openCallback:function(){window.setTimeout(this.removeFromPage,2e3)}}).addToPage();t.defer(e.open)},firstTimeSaveModal:function(){var e=new o({id:"save-item-modal",modalTitle:'<i class="icon"></i>Saved',modalContent:n.savemodal({link:d.www+"/saved"}),hasOverlay:!0,hasCloseButton:!0,tailDirection:"centered",closeCallback:function(){this.removeFromPage()}}).addToPage();t.defer(e.open)},saveAction:function(){var e=r.where({url:this.settings.url});return c.isLoggedIn()?void(0===e.length?(this.subscribeOnce(r,"nyt:xps-saved",this.itemSaved),r.save(this.settings.url)):this.growlSaveModal()):!0},paramChar:function(e){return-1!==e.indexOf("?")?"&":"?"},buildUrl:function(i,n){var s,a,o=h.tools[i],r=[],l=o.postUrl,d=t.extend({},n||this.settings),c=this.getTrackingParam();if(c&&(o.urlParameters=o.urlParameters||{},o.urlParameters[c]=null),s=u.getRicoUrl(d.url),s&&"email"!==i&&(d.url=s),a=this.createAnchor(d.url),o.smid&&(a.search+=0===a.search.indexOf("?")?"&":"?",a.search+="smid="+o.smid,d.url=a.href),o.shareParameters&&d){var m;e.each(o.shareParameters,function(e,t){m=d[e],r.push(t+"="+encodeURIComponent(m))})}return o.urlParameters&&e.each(o.urlParameters,function(e,t){r.push(null!==t?e+"="+encodeURIComponent(t):e)}),r=r.join("&"),l=l+this.paramChar(l)+r},popupShareAction:function(e,t){var i=h.tools[e],n=i.width?i.width:h.common.defaultWidth,s=i.height?i.height:h.common.defaultHeight,a=this.buildUrl(e,t);window.open(a,e+"Share","toolbar=0,status=0,height="+s+",width="+n+",scrollbars=yes,resizable=yes")},getTrackingParam:function(){var e=this.isUserVariant("articleSharetools"),t="smv"+e;return"string"==typeof e?t:void 0}};return m}),define("shared/sharetools/views/showall",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","shared/ad/views/ads","shared/sharetools/templates","shared/sharetools/helpers/sharetools-config","shared/sharetools/helpers/sharetools-mixin","shared/sharetools/views/email","foundation/models/user-data","shared/sharetools/instances/short-url"],function(e,t,i,n,s,a,o,r,l,d,c){var h=i.extend(t.extend({},r,{events:{"click .sharetool":"handleLinkClick","click .short-url-input, .text":"handleInputSelect"},className:"show-all-view-container",defaultModalSettings:{id:"show-all-sharetool-modal",modalTitle:"share this video",binding:".show-all-sharetool",tailDirection:"up",hasOverlay:!1,hasCloseButton:!1,positionTailSide:!1,autoPosition:!1,modalContent:"",tailLeftOffset:0,tailTopOffset:0,template:"showAllSharetoolModal",openCallback:function(){this.$target.addClass("active")},closeCallback:function(){this.$target.removeClass("active"),this.removeFromPage()}},articleTools:["save","print","reprints"],initialize:function(e,i){var n;t.bindAll(this,"handleShortUrl"),this.settings=t.extend({},this.getDataAttrs(!0,i)),this.modalSettings=t.extend({},this.defaultModalSettings,e),this.isMobileSharetools()&&(this.modalSettings=t.extend({},this.modalSettings,{tailDirection:"centered",hasCloseButton:!0,hasOverlay:!0,positionTailSide:!1,autoPosition:!1})),n=this.createAnchor(this.settings.url),n.search+=0===n.search.indexOf("?")?"&":"?",n.search+="smid=pl-share",this.settings.permalinkUrlWithSmid=n.href,this.settings.shortUrl=c.requestUrl(this.settings.permalinkUrlWithSmid)||"",this.settings.shortUrl||this.listenToOnce(c,"add",this.handleShortUrl),this.render(),this.trackingBaseData={module:"ShareTools",action:"click",contentCollection:this.pageManager.getMeta("article:section")}},render:function(){var e=this.settings.ad?"Frame6A":"";this.modalSettings.modalContent=a[this.modalSettings.template](this.buildShareHTML()),this.showAllModal=new n(this.modalSettings),this.setElement(this.showAllModal.$modal),this.showAllModal.$modal.find(".show-all-sharetool-modal-ad").attr("id",e),this.showAllModal.addToPage(),this.settings.ad&&this.pageManager.getCurrentBreakpoint()>=1e3&&new s({positions:[e],scope:"modal",autoconfirm:0}),this.settings.embedCode&&this.handleEmbedCode(),this.settings.shortUrl&&this.handleShortUrl()},buildShareHTML:function(){for(var e,i=this.settings.inlineTools,n="",s="",r=0,l=i.length;l>r;r+=1)e=a.showallLinks({shareObj:i[r],config:o.tools[i[r].type]}),t.indexOf(this.articleTools,i[r].type)>=0?s+=e:n+=e;return{shortUrl:this.settings.shortUrl,showAllLinkList:n,showAllToolList:s}},handleShortUrl:function(){var e=c.findWhere({url:this.settings.permalinkUrlWithSmid});e&&(this.settings.shortUrl=e.get("shortUrl"),this.showAllModal.$modal.find(".short-url-input").val(this.settings.shortUrl))},handleEmbedCode:function(){this.settings.embedCode&&this.showAllModal.$modal.find(".embed-input").val(this.settings.embedCode)},handleInputSelect:function(e){e.target.select()
},handleLinkClick:function(t){var i=e(t.target),n=i.data("share")||i.parent().data("share"),s="popup"===o.tools[n].postType?"popup":n;this.showAllModal.close();var a={version:this.settings.contentType||"Content",region:"ToolsMenu"};switch("save"===n||"reprints"===n||"print"===n?(a.module="ArticleTools",a.eventName="ArticleTool-"+n):a.eventName="Share-"+n,this.trackingTrigger("share-tools-click",a),s){case"email":this.isMobileSharetools()?this.openMailToLink():d.isLoggedIn()&&new l({dataUrl:this.settings.url});break;case"popup":"twitter"===n?this.handleShortUrlShareAction(o.tools[n]):this.popupShareAction(n);break;case"save":this.saveAction();break;case"reprints":this.popupShareAction(n);break;case"print":window.print()}}}));return h}),define("shared/sharetools/views/sharetools",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/sharetools/templates","shared/sharetools/views/email","shared/sharetools/views/showall","shared/sharetools/instances/cross-platform-save","foundation/models/user-data","shared/sharetools/helpers/sharetools-config","shared/sharetools/helpers/sharetools-mixin"],function(e,t,i,n,s,a,o,r,l,d){var c=i.registerView("sharetools").extend(t.extend({},d,{events:{"click .sharetool":"handleShareAction"},defaultModalData:{shares:"facebook|Share,email|Email,twitter|Tweet,linkedin|LinkedIn,google|Google+,reddit|Reddit,save|Save,reprints|Reprints,print|Print,ad"},initialize:function(e){0===this.$el.length||this.$el.hasClass("sharetools-init")||(this.settings=t.extend({},this.getDataAttrs(),e),this.modalSettings=t.extend({},e.showAllModalSettings),this.modalData=t.extend({},this.$el.data(),this.defaultModalData,e.showAllModalData),this.$el.addClass("sharetools"),this.setUpConfigOptions(),this.render(),this.trackingBaseData={module:"ShareTools",version:this.$el.data("content-type")||"Content",action:"click",contentCollection:this.pageManager.getMeta("article:section"),pgtype:this.pageManager.getMeta("PT")})},render:function(){var t,i=(this.$el.find(".middle-left-ad"),this.$el.find(".sharetools-inline-article-ad")),s=n.shareTools({shares:this.settings.inlineTools,config:l.tools});return this.$el.addClass("sharetools-init"),i.length>0?e(s).insertBefore(this.$el.find(".sharetools-inline-article-ad")):this.$el.append(s),this.isTemplateMinimal()&&e("#sharetools-masthead .show-all-sharetool .sharetool-text").text("Share"),this.settings.ad&&(t=this.pageManager.getCurrentBreakpoint()<=1020?"Position1":"Frame4A",this.$el.find(".sharetools-inline-article-ad").attr("id",t),this.broadcast("nyt:ads-new-placement",t)),this},handleShareAction:function(t){var i=e(t.target),n=i.data("share")||i.parent().data("share"),o="popup"===l.tools[n].postType?"popup":n,d=this.trackingBaseData;switch(i.parents(".video-player-region").size()>0?d.region="video-player-region":i.parents("#main").size()>0?d.region="Body":i.parents("#masthead").size()>0&&(d.region="TopBar"),"show-all"===n?d.eventName="Share-ShowAll":"save"===n||"reprints"===n||"print"===n?(d.module="ArticleTools",d.eventName="ArticleTool-"+n):d.eventName="Share-"+n,this.trackingTrigger("share-tools-click",d),o){case"email":this.isMobileSharetools()?this.openMailToLink():r.isLoggedIn()&&new s({dataUrl:this.settings.url});break;case"save":this.saveAction();break;case"popup":"twitter"===n?this.handleShortUrlShareAction(l.tools[n]):this.popupShareAction(n);break;case"embed":t.stopPropagation(),this.$(".show-all-sharetool a").trigger("click"),this.$body.find(".show-all-sharetool-modal #embed-input").select();break;case"show-all":new a(this.modalSettings,this.modalData)}},changeActiveState:function(){this.$(".show-all-sharetool").hasClass("active")?this.$(".show-all-sharetool").removeClass("active"):this.$(".show-all-sharetool").addClass("active")},isTemplateMinimal:function(){return this.$html.hasClass("template-minimal")?!0:void 0}}));return c}),define("shared/community/views/flag-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/community/api-mixin","shared/modal/views/modal","shared/community/templates"],function(e,t,i,n,s,a){var o=i.extend(t.extend({},n,{defaultSettings:{id:"flag-modal",addlClasses:"flag-modal",modalContent:"",binding:".comment-flag:not(.comment-reported)",tailDirection:"down-right",hasOverlay:!1,reasons:{Vulgar:"Vulgar",Spam:"Spam",Inflammatory:"Inflammatory","Off Topic":"Off-topic","Personal Attack":"Personal-attack"},openCallback:function(){this.flaggedComment=this.$target.parents(".comment").data("id"),this.$target.addClass("active"),this.subscribeOnce("nyt:page-scroll",this.close),this.subscribeOnce(this.comments,"nyt:community-scroll",this.close)}},events:{"click .flag-button":"submitFlag","click .cancel-button":"handleClose"},initialize:function(e){var i=this;this.defaultSettings.closeCallback=function(){i.resetReasons(),this.flaggedComment=0,this.$target.removeClass("active")},this.modalSettings=t.extend({},this.defaultSettings,e),this.modalSettings.modalContent=a.flag(this.modalSettings),this.render(),this.model=e.model,this.flagModal.comments=e.view},render:function(){this.flagModal=new s(this.modalSettings).addToPage(),this.setElement(this.flagModal.$modal)},getReasons:function(){var e=0,i="";return t.each(this.modalSettings.reasons,function(t){this.$("#flag-checkbox-"+t).is(":checked")&&(i+=e>0?","+t:t,e+=1)},this),i},resetReasons:function(){t.each(this.modalSettings.reasons,function(e){this.$("#flag-checkbox-"+e).attr("checked",!1)},this)},submitFlag:function(){var e=this;return this.apiPost({command:"flag",userID:this.model.getUser().getUserId(),commentID:this.flagModal.flaggedComment,asset:this.model.getAsset(),commentLabels:this.getReasons()}).always(function(){e.local(e.flagModal.comments,"nyt:community-comment-flagged",e.flagModal.flaggedComment),e.flagModal.close()}),!1},removeLinkFromReported:function(){e(".comment-reported").click(function(e){e.preventDefault()})},handleClose:function(){return this.flagModal.close(),!1}}));return o}),define("shared/community/views/verified-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","shared/community/templates"],function(e,t,i,n,s){var a=i.extend({defaultSettings:{id:"verified-modal",addlClasses:"verified-modal",modalContent:"",binding:".trusted-icon",tailDirection:"down",tailLeftOffset:7,canOpenOnHover:!0,hasOverlay:!1,closeOnMouseOut:!0,closeOnClick:!1,openCallback:function(){this.subscribeOnce("nyt:page-scroll",this.close),this.subscribeOnce("nyt:community-scroll",this.close)}},initialize:function(e){this.modalSettings=t.extend({},this.defaultSettings,e),this.modalSettings.modalContent=s.verified(this.modalSettings),this.render()},render:function(){this.verifiedModal=new n(this.modalSettings).addToPage(),this.setElement(this.verifiedModal.$modal)}});return a}),define("shared/community/views/comments",["jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/models/user-data","shared/community/views/utils-mixin","shared/sharetools/views/sharetools","shared/sharetools/helpers/sharetools-config","shared/community/views/flag-modal","shared/community/views/verified-modal","shared/community/templates","foundation/lib/polyfills/placeholder"],function(e,t,i,n,s,a,o,r,l,d,c){var h=i.extend(t.extend({},s,{template:d.comments,postTemplate:d.post,formTemplate:d.form,shareTools:null,events:{click:"toggleForm","click .comments-thread-expand":"loadMore","click .comments-subthread-expand":"loadReplies","click .comments-view-navigation li":"loadFilter","click .comments-sort-container":"loadSort","click .comments-view .comment .comment-time":"handlePermalinkClick","click .comments-view .comment .comment-parent":"handlePermalinkClick","click .comment-recommend":"recommend","click .sharetools span":"handleShare","click .comment-submit-button":"submitForm","click .comment-reply":"toggleReplyForm","click .view-all":"loadFilter","keypress .commenter-gateway-input":"toggleForm"},active:{0:{},permalink:{}},defaultSettings:{header:"Comments",maxPosts:25,filter:"all",sort:"newest",showDate:!0,dateFormat:"interval",showLocation:!0,showAvatar:!0,maxCharCount:1500,adPlacement:"Spon2",defaultPrompt:"Share your thoughts.",animateSpeed:250},initialize:function(i){this.settings=t.extend({},this.defaultSettings,i),this.shareTools=new a({el:e("<div>")}),this.subscribe(this,"nyt:community-loaded",this.getPosts),this.subscribe(this,"nyt:community-post-recommended",this.updateRecCount),this.subscribe(this,"nyt:community-comment-posted",this.confirmPost),this.subscribe("nyt:comments-panel-opened nyt:page-breakpoint nyt:page-resize",this.resizeHeaderContainer),this.subscribeOnce(this,"nyt:community-thread-loaded",this.render),this.subscribe("nyt:community-commentspanel-open",function(e){(t.isString(e)||t.isNumber(e))&&this.loadPermalink(""+e),this.$el.focus(),this.panelActive(!0)}),this.subscribe("nyt:comments-panel-closed",function(){this.resetForms(),this.panelActive(!1)}),this.request()},request:function(){this.broadcast("nyt:community-request",this.settings.asset,this,this.settings)},getPosts:function(e){var t;this.model=this.model||e,this.model.getDefaultQuery()?(t=this.model.getDefaultQuery(),this.settings.filter=t.filter||this.settings.filter,this.settings.sort=t.sort||this.settings.sort,this.model.load(this.settings,this)):this.subscribeOnce(this.model,"nyt:community-summary",this.getPosts)},render:function(e){var i=this,n=this.model.getPrompt(),s={all:"All",reader:"Readers&#8217; Picks",nytpicks:"NYT Picks",nytreplies:"NYT Replies"},a=t.extend({},this.settings,{filters:{},filterCount:this.model.getFilters().length,header:"Comment",view:this,isOpen:this.model.isOpen(),commentPrompt:n,commentPromptVisibility:n.toLowerCase()!==this.settings.defaultPrompt.toLowerCase()}),o=t.throttle(function(){i.toggleHeader(),i.broadcast(i.comments,"nyt:community-scroll")},500);return this.subscribe(this,"nyt:community-request",function(e){e.limit||"replies"===e.filter||i.toggleLoader(!0)}),this.subscribe(this,"nyt:community-thread-loaded",function(){i.toggleLoader(!1)}),this.subscribe(this,"nyt:community-comment-flagged",this.confirmFlagged),this.model.getNumberOfPosts()>0&&(a.header=this.model.getNumberOfPosts()+" "+a.header+(this.model.getNumberOfPosts()>1?"s":"")),this.settings.showDate&&this.formatDate(a.posts),t.each(this.model.getFilters(),function(e){a.filters[e]=s[e]},this),this.subscribe(this,"nyt:community-thread-loaded",this.updateView),this.$el.html(this.template(a)).show(),this.renderAd(),this.cacheElements(),this.updateView(e),this.updateNavigation(),this.toggleSortButtons(),this.toggleLoadButtons(),this.renderForm(),this.renderFlagModal(),this.renderVerifiedModal(),this.toggleEmpty(0===e.length),this.cloneHeader(),this.$comments.on("drag scroll touchend touchstart touchmove swipe",o),this.$clonedHeader.find(".section-heading").on("touchend click",function(){i.updateScrollPosition()}),this.broadcast("nyt:community-rendered",this.settings.asset,this),t.defer(function(){i.readHash()}),this.pageManager.setMeta("isCommentsOpen",this.model.isOpen()),this},cacheElements:function(){this.$comments=this.$(".comments"),this.$loader=this.$comments.find(".loader-container").hide(),this.$panelBody=this.$comments.find(".comments-view"),this.$loadMore=this.$comments.find(".comments-footer"),this.$permalink=this.$(".comment-permalink-view"),this.$viewAll=this.$(".view-all"),this.$header=this.$(".comments-header-container"),0===this.$loadMore.length&&this.subscribeOnce(this,"nyt:community-thread-loaded",this.cacheElements)},setActive:function(e,i,n){e=e||[],i&&(n?this.active.permalink={}:this.active={0:{},permalink:{}}),t.each(e,function(e){var t=n?"permalink":e.getParentId();this.active[t]||(this.active[t]={}),this.active[t][e.getId()]=e},this)},isActive:function(e,i){var n=!1;return i?n=e&&e.getId?this.active.permalink[e.getId()]:this.active.permalink[e]:"number"==typeof e?t.each(this.active,function(i){t.has(i,e)&&(n=i[e])}):n=e&&e.getParentId&&this.active[e.getParentId()]?this.active[e.getParentId()][e.getId()]:!1,n},configureProperties:function(e){return e=e||{},"undefined"==typeof e.isPermalink&&(e.isPermalink=!1),e.isPermalink?(e.container=this.$permalink,e.isSubThread=!1,"number"==typeof e.parent&&(e.container=this.$permalink.find("[data-id="+e.parent+"]").find(".thread"),e.isSubThread=!0)):"number"==typeof e.parent?(e.container=this.$panelBody.find("[data-id="+e.parent+"]").find(".thread"),e.isSubThread=!0):e.container&&e.container.attr?(e.container=e.container.find(".thread"),e.isSubThread=!0):(e.container=this.$panelBody,e.isSubThread=!1),e.isSubThread&&(e.clearView=!1),e.view=this,e},updateView:function(e,t,i){t=t||e,i=this.configureProperties(i),this.settings.showDate&&this.formatDate(t),i.clearView&&this.unload(),this.addPostsToView(t,i),this.setActive(t,i.clearView,i.isPermalink),i.isSubThread||(this.togglePermalink(i.isPermalink),this.toggleLoadButtons(),this.orderElements(),this.toggleSortButtons(),this.updateNavigation()),0===e&&this.updateNavigation(),this.toggleEmpty(0===t.length)},updateScrollPosition:function(){this.slideHeaderUp(),this.$comments.scrollTop(0),this.$(".thread-form").show()},resizeHeaderContainer:function(){var e;this.$comments&&(e=this.$comments.width()-15,this.$header.css({width:e}),this.$clonedHeader.css({width:e}))},orderElements:function(){this.$loader.appendTo(this.$panelBody),this.$loadMore.appendTo(this.$panelBody)},addPostsToView:function(e,i){var n=i.container.children("article"),s=this.model.isOpen(),a=this;t.each(e,function(e,o){var r;this.isActive(e,i.isPermalink)||(r=this.postTemplate(t.extend({},this.settings,i,{post:e,view:a,isOpen:s,index:o})),n[o]?this.$(n[o]).before(r):i.container.append(r))},this)},togglePermalink:function(e){this.$permalink[e?"show":"hide"]()},toQuery:function(e){return e=e||{},t.extend({},this.settings,e)},loadMore:function(){this.model.load(this.toQuery({limit:this.settings.maxPosts}),this),this.track("load-more-comments",{eventName:"More-coms-in-panel",module:"Comments",action:"Click",region:"Comments"})},loadReplies:function(e,i){var n;t.isObject(i)||(i={}),t.isObject(e)?(n=this.$(e.target).parents(".comment"),this.$(e.target).remove(),e=parseInt(n.data("sequence"),10)):n=this.$("[data-sequence="+e+"]"),this.model.load(this.toQuery({context:e,filter:"replies",sort:"oldest"}),this,t.extend({container:n},i)),this.track("load-replies",{eventName:"All-replies",module:"Comments",action:"Click",region:"Comments"})},loadFilter:function(e){var t=this.$(e.target).data("filter");this.settings.filter=t,this.settings.sort="reader"===t?t:"newest",this.toggleLoadButtons(),this.model.load(this.toQuery(),this,{clearView:!0}),this.updateScrollPosition()},loadSort:function(){this.settings.sort=this.$(".comments-sort").data("sort"),this.model.load(this.toQuery({sort:this.$(".comments-sort").data("sort")}),this,{clearView:!0}),this.updateScrollPosition()},handlePermalinkClick:function(t){var i,n;i=e(t.target),i.data("permid")||(i=i.parents(".comment")),n=i.data("permid"),this.loadPermalink(n),t.preventDefault()},loadPermalink:function(e){var t;e+="",t=e.split(":")[0],this.$permalink.empty(),this.setActive([],!0,!0),this.subscribeOnce(this,"nyt:community-thread-loaded",function(e){e[0]&&this.loadReplies(t,{isPermalink:!0,parent:e[0].getId()})}),this.model.load(this.toQuery({filter:"permalink",permID:t}),this,{isPermalink:!0}),this.updateScrollPosition(),this.pageManager.setUrlHash("permid="+e)},unload:function(){this.setActive([],!0),this.$loadMore.detach(),this.$loader.detach(),this.$panelBody.empty().append(this.$loadMore).append(this.$loader)},panelActive:function(e){this.pageManager.setMeta("commentspanel_isOpen",e)},toggleLoadButtons:function(){this.model.hasAdditionalPosts(this.settings)?this.$loadMore.find(".comments-expand").show():this.$loadMore.find(".comments-expand").hide(),"all"!==this.settings.filter?this.model.hasAdditionalPosts(this.settings)?this.$viewAll.hide():this.$viewAll.show():this.$viewAll.hide()},toggleSortButtons:function(){var e=this.$(".comments-sort-container"),t=this.$(".comments-sort");"all"===this.settings.filter?(this.settings.sort=this.settings.sort||"newest","newest"===this.settings.sort?t.text("Newest").data("sort","oldest"):t.text("Oldest").data("sort","newest"),e.show()):e.hide()},updateNavigation:function(){this.$(".tab").removeClass("selected").filter("[data-filter="+this.settings.filter+"]").addClass("selected")},recommend:function(e){var t,i=this.$(e.target).hasClass("comment-recommend")?this.$(e.target):this.$(e.target).parents(".comment-recommend:first"),n=i.parents(".comment:first"),s=this.isActive(parseInt(n.data("id"),10));s.recommend(t,this.model.getAsset(),this,i)},updateRecCount:function(e,t){var i,n="";e.getRecommendations()>0&&(n='<span class="recommend-count"><i class="icon"></i>'+e.getRecommendations()+"</span>"),e.isRecommended()?(t.html(n+"Recommended").addClass("recommended"),i="Rec"):(t.html(n+"Recommend").removeClass("recommended"),i="Un-Rec"),this.track("recommend-comment",{eventName:i,module:"Comments",action:"Click",region:"Comments"})},handleShare:function(e){var t=this.$(e.target).data("share")||this.$(e.target).parent().data("share"),i=this.$(e.target).parents(".comment:first").data("permid"),n=o.tools[t];"facebook"===t?this.shareTools.popupShareAction(t,{url:this.model.getAsset()+"#permid="+i}):this.shareTools.handleShortUrlShareAction(n,this.model.getAsset()+"#permid="+i),this.track("comments-share",{module:"ShareTools",action:"Click",version:"CommentsPanel",region:"Comments",eventName:"Share-"+(n.label||"").toLowerCase()})},renderAd:function(){this.settings.adPlacement&&this.broadcast("nyt:ads-new-placement",this.settings.adPlacement)},renderForm:function(){var e=this;this.model.isOpen()&&(this.$(".thread-form").html(this.formTemplate({user:this.model.getUser(),confirmPost:!1,gatewayLabel:this.model.getPrompt(),gatewayPlaceholder:this.settings.defaultPrompt})).on("change keyup cut paste",function(){e.updateCount(e.$(".thread-form")),e.toggleSubmitButton(e.$(".thread-form"))}),this.toggleForm(),c())},toggleForm:function(e){var t;e?(t=this.$(e.target),0===t.parents(".thread-form").length?this.toggleForm():n.isLoggedIn()?(this.$(".thread-form .primary-control").hide(),this.$(".thread-form .secondary-control").show(),t.hasClass(".thread-form")&&t.find("textarea").focus()):(t.blur(),e.preventDefault(),e.stopPropagation(),this.broadcast("nyt:loginmodal-open",{modalTitle:"Log in to add a comment"}))):(this.$(".thread-form .secondary-control").hide(),this.$(".thread-form .primary-control").show())},confirmPost:function(e,t){var i=t.$formControl||this.$(".thread-form");i.html(this.formTemplate({user:this.model.getUser(),confirmPost:!0,message:e,showAvatar:this.settings.showAvatar,showLocation:this.settings.showLocation,gatewayLabel:this.model.getPrompt(),gatewayPlaceholder:this.settings.defaultPrompt})),i.find("form").hide().parent().find(".comment-confirmation").show()},updateCount:function(e){var t=this.settings.maxCharCount-e.find(".comment-textarea").val().length;e.find(".comment-character-count").text(t)},checkUserInfo:function(e){var t=e.find(".commenter-input").length>0?e.find(".commenter-input").val():null,i=e.find(".commenter-location-input").length>0?e.find(".commenter-location-input").val():null,n=!1,s=new RegExp(/^([a-zA-Z0-9])+([a-zA-Z0-9\._\-])*@([a-zA-Z0-9_\-])+([a-zA-Z0-9\._\-]+)+$/);return null===t||0!==t.length&&!s.test(t)?null===i||0!==i.length&&!s.test(i)||(n=!0):n=!0,this.toggleFormError(e,n,"user-info"),!n},toggleFormError:function(e,t,i){var n,s;t?(n="removeClass",s="attr"):(n="addClass",s="removeAttr"),e.find("."+i+"-error")[n]("hidden")[s]("aria-live","assertive")[s]("role","alert")},checkCommentForm:function(e){var t=parseInt(e.find(".comment-character-count").text(),10),i=!1,n=!1;return 0>t?(i=!0,n=!0):t===this.settings.maxCharCount&&(n=!0),this.toggleFormError(e,i,"character"),!n},toggleSubmitButton:function(e){var t=!this.checkUserInfo(e),i=!this.checkCommentForm(e),n=t||i;n?e.find(".comment-submit-button").attr("disabled","disabled").addClass("disabled"):e.find(".comment-submit-button").removeAttr("disabled").removeClass("disabled")},toggleEmpty:function(e){n.isLoggedIn()&&("undefined"==typeof e&&0===this.model.totalPosts()?(this.$(".thread-form .primary-control").hide(),this.$(".thread-form .secondary-control").show()):e&&(this.$(".thread-form .primary-control").hide(),this.$(".thread-form .secondary-control").show()))},submitForm:function(e){var t=this.$(e.target),i=t.closest(".comment"),n=i.data("id"),s=i.data("parentid"),a=t.closest(".form-control"),o={$formControl:a,parentId:n,ancestorId:s};a.find(".commenter-input").length&&(this.model.getUser().setName(this.stripHtml(a.find(".commenter-input").val())),this.model.getUser().setLocation(this.stripHtml(a.find(".commenter-location-input").val()))),this.model.post(this,{commentBody:this.stripHtml(a.find(".comment-textarea").val()),commentNotify:a.find(".comment-notify").is(":checked")},o),e.preventDefault(),this.track("post-comment",{eventName:"Post",module:"Comments",action:"Click",region:"Comments"})},toggleReplyForm:function(e){var t=this.$(".thread-form"),i=this.$(e.target).closest(".comment"),n=i.find(".reply-form-control").first(),s=i.closest(".comments-view, .comment-permalink-view"),a=this;0===n.find(".secondary-control").length&&(n=n.append('<form class="comment-form comment-reply-form">').find("form"),s.find(".secondary-control").parents(".reply-form-control").empty(),t.find(".secondary-control").each(function(e,i){t.find(i).clone().show().appendTo(n.show().focus())}),n.on("change keyup cut paste",function(){a.updateCount(a.$(".reply-form-control")),a.toggleSubmitButton(a.$(".reply-form-control"))}),n.find(".comment-character-count").html(this.settings.maxCharCount),n.find(".comment-submit-button").attr("disabled","disabled").addClass("disabled"))},renderFlagModal:function(){n.isLoggedIn()&&(this.$flagModal=new r({model:this.model,view:this}))},renderVerifiedModal:function(){this.$verifiedModal=new l},cloneHeader:function(){this.$clonedHeader=this.$header.clone().find(".form-control").remove().end().hide(),this.$el.append(this.$clonedHeader)},toggleHeader:function(){this.$panelBody.position().top<0?this.$clonedHeader.isDown||this.slideHeaderDown():this.$clonedHeader.isDown&&this.slideHeaderUp()},toggleLoader:function(e){this.$loader[e?"show":"fadeOut"]()},confirmFlagged:function(e){this.$("[data-id="+e+"]").find(".comment-flag:first").addClass("comment-reported").html("Reported")},readHash:function(){var e=this.pageManager.getUrlHash(),t=!1;"commentsContainer"===e?(this.broadcast("nyt:community-commentspanel-open"),t=!0):e.indexOf("permid")>-1&&(this.broadcast("nyt:community-commentspanel-open",e.substr(7)),t=!0),t&&this.track("auto-open-comments-panel",{module:"Comments",version:"AutoOpen",action:"click",region:"FixedRight",eventName:"OpenCommentsPanel"})},resetForms:function(){this.$(".thread-form .comment-textarea").length>0&&(this.updateCount(this.$(".thread-form").find("textarea").val("").end()),this.toggleSubmitButton(this.$(".thread-form"))),this.$(".reply-form-control .comment-textarea").length>0&&(this.updateCount(this.$(".reply-form-control").find("textarea").val("").end()),this.toggleSubmitButton(this.$(".reply-form-control")))},track:function(e,i){this.trackingTrigger(e,t.extend(this.getTrackingParams(),i))},slideHeaderDown:function(){this.$header.addClass("invisible"),this.$clonedHeader.isDown=!0,this.$clonedHeader.stop(!0).show().css({position:"absolute",top:"-"+this.$clonedHeader.height()+"px"}).removeClass("hidden").animate({top:0,opacity:1},this.settings.animateSpeed)},slideHeaderUp:function(){this.$clonedHeader.isDown=!1,this.$clonedHeader.stop(!0).addClass("hidden"),this.$header.removeClass("invisible")}}));return h}),define("blogs/instances/community",["foundation/hosts","shared/community/collections/community-loader","shared/community/views/comments-panel","shared/community/views/comments-button","shared/community/views/comments-peek","shared/community/views/comments"],function(e,t,i,n,s,a){(new t).enabled(function(){new i,new a({el:".panel-content"}),new n({el:".button-masthead",showUnits:!1}),new n({el:".comments-button.theme-kicker",defaultText:"Comment"}),new n({el:".comments-button.theme-speech-bubble",defaultText:"Write A Comment"})})}),define("shared/sharetools/models/share-data",["foundation/models/base-model"],function(e){var t=e.extend({dataAttributes:{URL:"data-url",TITLE:"data-title",MEDIA:"data-media",DESCRIPTION:"data-description",PUBLICATION_DATE:"data-publish-date",CONTENT_TYPE:"data-content-type",VIA:"data-via"},initialize:function(e){this.$container=e},getUrl:function(){var e=this.$container.attr(this.dataAttributes.URL);return e?e:this.pageManager.getCanonical()},setUrl:function(e){this.$container.attr(this.dataAttributes.URL,e)},getTitle:function(){var e=this.$container.attr(this.dataAttributes.TITLE);return e?e:this.pageManager.getMeta("og:title")},setTitle:function(e){this.$container.attr(this.dataAttributes.TITLE,e)},getMedia:function(){var e=this.$container.attr(this.dataAttributes.MEDIA);return e?e:this.pageManager.getMeta("og:image")},setMedia:function(e){this.$container.attr(this.dataAttributes.MEDIA,e)},getDescription:function(){var e=this.$container.attr(this.dataAttributes.DESCRIPTION);return e?e:this.pageManager.getMeta("description")},setDescription:function(e){this.$container.attr(this.dataAttributes.DESCRIPTION,e)},getPublicationDate:function(){var e=this.$container.attr(this.dataAttributes.PUBLICATION_DATE);return e?e:this.pageManager.getMeta("DISPLAYDATE")},setPublicationDate:function(e){this.$container.attr(this.dataAttributes.PUBLICATION_DATE,e)},getVia:function(){var e=this.$container.attr(this.dataAttributes.VIA),t=this.pageManager.getMeta("twitter:site");return e?e:"upshot"===this.pageManager.getMeta("CG")?"UpshotNYT":t&&"@nytimes"!==t?t.replace("@",""):""},setVia:function(e){this.$container.attr(this.dataAttributes.VIA,e)},getContentType:function(){var e=this.$container.attr(this.dataAttributes.CONTENT_TYPE);return e?e:"Content"},setContentType:function(e){this.$container.attr(this.dataAttributes.CONTENT_TYPE,e)}});return t}),define("shared/sharetools/helpers/share-tools-config",["underscore/nyt"],function(e){var t=function(t){var n=e.extend({},i,t);return Object.freeze?Object.freeze(n):n},i={width:600,height:450,adPosition:"Frame4A",overlayAdPosition:"Frame6A",isModalMember:!0,isArticleTool:!1,isInDefaultSet:!1,isPopup:!0,usesShortUrl:!1,shareDataParameters:{},shareServiceParameters:{}},n={EMAIL:t({label:"Email",isInDefaultSet:!0,requiresLogin:!0,loginModalText:"Log in to Email",modalDisplayOrder:1}),FACEBOOK:t({label:"Share",isInDefaultSet:!0,url:"http://www.facebook.com/sharer.php",smid:"fb-share",modalDisplayOrder:3,shareDataParameters:{url:"u"}}),GOOGLE:t({label:"Google+",url:"https://plus.google.com/share",smid:"go-share",height:600,modalDisplayOrder:4,shareDataParameters:{url:"url"},shareServiceParameters:{hl:"en-US"}}),REDDIT:t({label:"Reddit",url:"http://www.reddit.com/submit",smid:"re-share",width:854,height:550,modalDisplayOrder:6,shareDataParameters:{url:"url",title:"title"}}),PINTEREST:t({label:"Pin",url:"https://www.pinterest.com/pin/create/button/",smid:"pin-share",width:750,height:330,modalDisplayOrder:7,shareDataParameters:{url:"url",media:"media",description:"description"}}),TWITTER:t({label:"Tweet",isInDefaultSet:!0,url:"https://twitter.com/share",smid:"tw-share",usesShortUrl:!0,modalDisplayOrder:5,shareDataParameters:{url:"url",title:"text"}}),LINKEDIN:t({label:"Linkedin",url:"http://www.linkedin.com/shareArticle",smid:"li-share",width:750,modalDisplayOrder:2,shareDataParameters:{url:"url",title:"title",description:"summary"},shareServiceParameters:{mini:"true",source:"The New York Times"}}),SAVE:t({label:"Save",isInDefaultSet:!0,isArticleTool:!0,modalDisplayOrder:1}),PRINT:t({label:"Print",isArticleTool:!0,modalDisplayOrder:3,shareServiceParameters:{pagewanted:"print"}}),REPRINTS:t({label:"Reprints",isArticleTool:!0,isModalMember:!0,url:"https://s100.copyright.com/AppDispatchServlet",modalDisplayOrder:2,shareDataParameters:{url:"contentID"},shareServiceParameters:{publisherName:"The New York Times",publication:"nytimes.com",token:"",orderBeanReset:"true",postType:"",wordCount:"",title:document.title,publicationDate:"",author:""}}),"SHOW-ALL":t({label:"More",isInDefaultSet:!0,isModalMember:!1,isModalTrigger:!0}),AD:t({label:"Advertisement",isInDefaultSet:!0,isModalMember:!1})};return Object.freeze?Object.freeze(n):n}),define("shared/sharetools/views/common-mixin",["jquery/nyt","underscore/nyt","foundation/hosts","foundation/models/user-data","foundation/models/page-storage","foundation/tracking/tracking-mixin","shared/modal/views/modal","shared/sharetools/templates","shared/sharetools/views/email","shared/sharetools/helpers/share-tools-config","shared/sharetools/instances/cross-platform-save","shared/sharetools/instances/short-url"],function(e,t,i,n,s,a,o,r,l,d,c,h){var u={handleShareAction:function(t,i){var s=e(t.target),a=s.attr("data-share")||s.parent().attr("data-share"),o=a&&d[a.toUpperCase()];o&&(i&&this.modal&&this.modal.close(),this.trackShareData(a,o,i),o.isModalTrigger?this.broadcast("nyt:open-share-modal",{instanceContainer:this.$instanceContainer}):o===d.EMAIL?this.isMobileShareTools()?this.openMailToLink():n.isLoggedIn()?new l({dataUrl:this.shareData.getUrl()}):this.triggerLoginModal(t,"Log in to Email"):o===d.PRINT?window.print():o===d.SAVE?n.isLoggedIn()?this.saveItem():this.triggerLoginModal(t,"Log in to Save"):o.isPopup&&this.popupShareWindow(o))},handleModalShareAction:function(e){this.handleShareAction(e,!0)},triggerLoginModal:function(e,t){e.preventDefault(),e.stopPropagation(),this.broadcast("nyt:loginmodal-open",{modalTitle:t})},popupShareWindow:function(e){e.usesShortUrl?this.handleShortUrlShareAction(e):window.open(this.buildShareServiceUrl(e),e.id+" Share",this.getPopupWindowFeatures(e))},getPopupWindowFeatures:function(e){return"toolbar=0,status=0,height="+e.height+",width="+e.width+",scrollbars=yes,resizable=yes"},buildShareServiceUrl:function(e){var t,i=[],n=e.smid,s=e.shareDataParameters,a=e.shareServiceParameters,o={url:this.shareData.getUrl(),title:this.shareData.getTitle(),description:this.shareData.getDescription(),media:this.shareData.getMedia()};if(n&&(o.url+=this.getQuerystringDelimiter(o.url),o.url+="smid="+n),s)for(t in s)s.hasOwnProperty(t)&&o.hasOwnProperty(t)&&i.push(s[t]+"="+encodeURIComponent(o[t]));if(a){a.hasOwnProperty("publicationDate")&&(a.publicationDate=this.shareData.getPublicationDate());for(t in a)a.hasOwnProperty(t)&&i.push(t+"="+encodeURIComponent(a[t]))}return e.url+"?"+i.join("&")},handleShortUrlShareAction:function(e){var t,i,n,s=this,a=this.shareData.getUrl(),o=e.smid;i=window.open("",e.label+" Share",this.getPopupWindowFeatures(e)),n=function(t){var n=s.shareData.getVia();t=e.url+"?url="+encodeURIComponent(t)+"&text="+encodeURIComponent(s.shareData.getTitle()),n&&(t+="&via="+encodeURIComponent(n)),i.location.href=t},o&&!this.pageManager.isMobile()&&(a+=this.getQuerystringDelimiter(a),a+="smid="+o),t=h.requestUrl(a)||"",t?n(t):this.listenToOnce(h,"add",function(){var e=h.findWhere({url:a});e&&n(e.get("shortUrl"))})},getQuerystringDelimiter:function(e){return-1===e.indexOf("?")?"?":"&"},saveItem:function(){var e,t,n,a,o=this,l=this.shareData.getUrl();t=function(){var e="sharetools_hasSaves";s.get(e)!==!0?(a(),s.set(e,!0)):n()},n=function(){o.showModal({id:"save-item-growl-modal",modalTitle:'<i class="icon"></i>Saved',tailDirection:"centered",openCallback:function(){window.setTimeout(this.removeFromPage,2e3)}})},a=function(){o.showModal({id:"save-item-modal",modalTitle:'<i class="icon"></i>Saved',modalContent:r.savemodal({link:i.www+"/saved"}),hasOverlay:!0,hasCloseButton:!0,tailDirection:"centered",closeCallback:function(){this.removeFromPage()}})},e=c.where({url:l}),e.length?n():(this.subscribeOnce(c,"nyt:xps-saved",t),c.save(l))},trackShareData:function(e,t,i){var n={};this.trackingBaseData={module:"ShareTools",action:"click",version:this.shareData.getContentType(),contentCollection:this.pageManager.getMeta("article:section")},i?(n.region="ToolsMenu",n.version="Content"):n.region=this.trackingRegion,t.isArticleTool?(n.module="ArticleTools",n.eventName="ArticleTool-"+e):n.eventName="show-all"===e?"Share-ShowAll":"Share-"+e,this.trackingTrigger("share-tools-click",n)
},showModal:function(e){var i=new o(e);i.addToPage(),t.defer(i.open)},isMobileShareTools:function(){return this.pageManager.getCurrentBreakpoint()<1e3},openMailToLink:function(){var e="%0A%0A",t=encodeURIComponent(this.shareData.getTitle()),i=encodeURIComponent(this.shareData.getDescription()),n=encodeURIComponent(this.shareData.getUrl()),s="NYTimes.com: "+t,a="From The New York Times:"+e+t+e+i+e+n;window.location="mailto:?subject="+s+"&body="+a}};return u}),define("shared/sharetools/views/share-tool",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/sharetools/views/common-mixin","shared/sharetools/templates","shared/sharetools/helpers/share-tools-config"],function(e,t,i,n,s){var a=i.extend(t.extend({},n,{tagName:"li",events:{click:"handleShareAction"},initialize:function(e){this.toolId=e.toolId,this.toolConfig=e.toolConfig,this.label=e.customLabel||this.toolConfig.label,this.$instanceContainer=e.instanceContainer,this.shareData=e.shareData,this.trackingRegion=e.trackingRegion,""===e.customLabel&&(this.isLabelHidden=!0)},render:function(){var e,t,i=this.toolId.toLowerCase();return this.isAdView()?(e=this.pageManager.getCurrentBreakpoint()<=1020?"Position1":"Frame4A",this.$instanceContainer.find(".sharetools-inline-article-ad").attr("id",e),this.broadcast("nyt:ads-new-placement",e)):(t=s.shareTool({id:i,label:this.label,config:this.toolConfig,isLabelHidden:this.isLabelHidden}),this.$el.addClass("sharetool "+i+"-sharetool"),this.$el.append(t)),this},isAdView:function(){return"AD"===this.toolId}}));return a}),define("shared/sharetools/views/containers-mixin",["jquery/nyt","underscore/nyt","shared/sharetools/models/share-data","shared/sharetools/views/share-tool","shared/sharetools/helpers/share-tools-config"],function(e,t,i,n,s){var a={getToolIdsAndCustomLabels:function(e){var t,i,n,a;if(this.toolIds=[],this.customLabels={},e)for(e=e.split(","),t=0,n=e.length;n>t;t++)i=e[t].toUpperCase(),a=i.indexOf("|"),-1!==a&&(i=i.substring(0,a),this.customLabels[i]=e[t].substr(a+1)),this.toolIds.push(i);else for(i in s)s.hasOwnProperty(i)&&s[i].isInDefaultSet===!0&&this.toolIds.push(i)},instantiateViews:function(e){var i,a,o,r,l,d=[];for(i=0,a=e.length;a>i;i++)o=e[i],r=this.customLabels&&this.customLabels[o],s.hasOwnProperty(o)&&(l={toolId:o,toolConfig:s[o],instanceContainer:this.$instanceContainer,shareData:this.shareData,trackingRegion:this.trackingRegion},t.isString(r)&&(l.customLabel=r),d.push(new n(l)));return d},renderToolViews:function(){var e,t,i;for(t=this.instantiateViews(this.toolIds),e=0,i=t.length;i>e;e++)t[e].isAdView()?t[e].render():this.$el.append(t[e].render().el)},getToolViewsMarkup:function(t){var i,n=document.createElement("div"),s=this.instantiateViews(t),a=s.length;for(i=0;a>i;i++)n.appendChild(s[i].render().el);return e(n).html()}};return a}),define("shared/sharetools/views/share-tools-modal-container",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","shared/ad/views/ads","shared/sharetools/helpers/share-tools-config","shared/sharetools/views/share-tool","shared/sharetools/views/common-mixin","shared/sharetools/views/containers-mixin","shared/sharetools/instances/short-url","shared/sharetools/templates"],function(e,t,i,n,s,a,o,r,l,d,c){var h=i.extend(t.extend({},r,l,{events:{click:"handleModalShareAction"},defaultModalSettings:{id:"show-all-sharetool-modal",modalTitle:"share",binding:".show-all-sharetool",tailDirection:"up",hasOverlay:!1,hasCloseButton:!1,positionTailSide:!1,autoPosition:!1,modalContent:"",tailLeftOffset:0,tailTopOffset:0,openCallback:function(){this.$target.addClass("active")},closeCallback:function(){this.$target.removeClass("active"),this.removeFromPage()}},initialize:function(i){this.$instanceContainer=i.instanceContainer,this.trackingRegion=i.trackingRegion,this.shareData=i.shareData,this.configIds=i.modalSettings.shares,this.modalSettings=t.extend({},this.defaultModalSettings,i.modalSettings),this.isMobileShareTools()&&(this.modalSettings=t.extend({},this.modalSettings,{tailDirection:"centered",hasCloseButton:!0,hasOverlay:!0,positionTailSide:!1,autoPosition:!1})),this.el=document.createElement("ul"),this.el.className="sharetools-menu",this.$el=e(this.el),this.urlWithSmid=this.shareData.getUrl(),this.urlWithSmid+=-1===this.urlWithSmid.indexOf("?")?"?":"&",this.urlWithSmid+="smid=pl-share",this.permalink=d.requestUrl(this.urlWithSmid),this.permalink||this.listenToOnce(d,"add",this.handleShortUrl),this.render()},render:function(){var e="Frame6A";this.modalSettings.modalContent=c.shareToolsModal(this.buildMarkup()),this.modal=new n(this.modalSettings),this.setElement(this.modal.$modal),this.modal.$modal.find(".show-all-sharetool-modal-ad").attr("id",e),this.modal.addToPage(),this.isMobileShareTools()||new s({positions:[e],scope:"modal",autoconfirm:0}),this.runABTest()},runABTest:function(){var e,t,i="sharetools",n=this.isUserVariant(i),s=["facebook","linkedin","twitter","reddit","pinterest","google","email"],a=this.$el.find(".share .sharetools-menu"),o=s.length;if("1"===n||"2"===n)for(e=0;o>e;e+=1)t=this.$el.find("."+s[e]+"-sharetool"),t.length>0&&a.append(t)},buildMarkup:function(){var e,i,n,s=this,o=[],r=[],l=function(e){var i;a.hasOwnProperty(e)&&(i=t.extend({},a[e],{id:e}),a[e].isArticleTool?"REPRINTS"===e?"article"!==s.pageManager.getMeta("PT")||/\/(?:aponline|reuters)\//.test(s.shareData.getUrl())||r.push(i):a[e].isArticleTool&&r.push(i):o.push(i))};if(this.configIds)for(this.getToolIdsAndCustomLabels(this.configIds),e=0,n=this.toolIds.length;n>e;e++)l(this.toolIds[e]);else{for(i in a)a[i].isModalMember&&l(i);o=t.sortBy(o,function(e){return e.modalDisplayOrder}),r=t.sortBy(r,function(e){return e.modalDisplayOrder})}return{shortUrl:this.permalink,standardToolsList:this.getToolViewsMarkup(t.pluck(o,"id")),articleToolsList:this.getToolViewsMarkup(t.pluck(r,"id"))}},handleShortUrl:function(){var e=d.findWhere({url:this.urlWithSmid});e&&this.modal.$modal.find(".short-url-input").val(e.get("shortUrl"))}}));return h}),define("shared/sharetools/views/share-tools-container",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/sharetools/models/share-data","shared/sharetools/views/containers-mixin","shared/sharetools/views/share-tools-modal-container"],function(e,t,i,n,s,a){var o=i.extend(t.extend({},s,{initializedAttribute:"data-share-tools-initialized",initialize:function(t){this.$instanceContainer=t.el,this.trackingRegion=t.trackingRegion||"",this.$instanceContainer&&!this.$instanceContainer.attr(this.initializedAttribute)&&(this.getToolIdsAndCustomLabels(this.$instanceContainer.data("shares")),this.shareData=new n(this.$instanceContainer),this.el=document.createElement("ul"),this.$el=e(this.el),t.modalSettings&&this.subscribe("nyt:open-share-modal",function(e){e.instanceContainer&&this.$instanceContainer.get(0)===e.instanceContainer.get(0)&&new a({instanceContainer:e.instanceContainer,modalSettings:t.modalSettings,trackingRegion:this.trackingRegion,shareData:this.shareData})}),this.render())},render:function(){var e=void 0!==t.find(this.toolIds,function(e){return"AD"===e}),i=this.$instanceContainer.find(".sharetools-inline-article-ad");this.renderToolViews(),this.$instanceContainer.attr(this.initializedAttribute,"1"),e&&i.length?this.$el.insertBefore(i):this.$instanceContainer.append(this.el),this.runABTest()},runABTest:function(){var t="sharetools",i=this.isUserVariant(t),n=this.$el.closest(".sharetools").attr("id"),s=this.$el.find(".email-sharetool"),a=this.$el.find(".save-sharetool"),o=this.$el.find(".show-all-sharetool"),r=e(".user-tools-button-group").find("button.comments-button");("1"===i||"2"===i)&&("sharetools-story"===n&&a.before(s),"sharetools-masthead"===n&&o.before(s).before(r)),"2"===i&&("sharetools-story"===n||"sharetools-masthead"===n)&&o.find(".sharetool-text").after(o.find(".icon"))}}));return o}),define("blogs/instances/sharetools",["jquery/nyt","shared/sharetools/views/share-tools-container"],function(e,t){var i,n=e("meta[name='twitter:site']").attr("content"),s={tailDirection:"left",tailLeftOffset:-8,tailTopOffset:2,positionTailSide:!0,autoPosition:!0,toggleSpeed:1,openCallback:function(){var e=this,t=this.pageManager.getViewport().top;i=function(){Math.abs(t-this.pageManager.getViewport().top)>300&&e.close()},this.listenTo(this.pageManager,"nyt:page-scroll",i),this.$target.addClass("active")},closeCallback:function(){this.stopListening(this.pageManager,"nyt:page-scroll",i),this.$target.removeClass("active"),this.removeFromPage()}};n="undefined"!=typeof n?n.replace("@",""):null,new t({el:e("#sharetools-story"),via:n,trackingRegion:"Body",modalSettings:{tailDirection:"left",tailLeftOffset:-8,tailTopOffset:2,positionTailSide:!0,autoPosition:!0,toggleSpeed:1,openCallback:function(){var e=this,t=this.pageManager.getViewport().top;i=function(){Math.abs(t-this.pageManager.getViewport().top)>300&&e.close()},this.listenTo(this.pageManager,"nyt:page-scroll",i),this.$target.addClass("active")},closeCallback:function(){this.stopListening(this.pageManager,"nyt:page-scroll",i),this.$target.removeClass("active"),this.removeFromPage()}}}),new t({el:e("#sharetools-masthead"),trackingRegion:"Masthead",modalSettings:{tailDirection:"up-right",tailLeftOffset:0,tailTopOffset:-10,fixedOverride:!0,positionTailSide:!1,toggleSpeed:1,openCallback:function(){this.listenToOnce(this.pageManager,"nyt:masthead-storytheme",function(){this.close()})}},showAllModalData:{via:n}}),e(".shareTools").not(".sharetools-init").each(function(){new t({el:e(this),via:n,modalSettings:s})}),new t({el:e("#sharetools-post-footer"),trackingRegion:"Body",modalSettings:s,showAllModalData:{via:n}})}),define("blogs/views/embedded-slideshow",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/collections/base-collection","foundation/views/base-view","blogs/templates"],function(e,t,i,n,s,a){var o=s.extend({speed:400,firstSlide:!0,hammerSettings:{tap_max_touchtime:400,swipe_velocity:.1,drag_min_distance:3},events:{"click .image":"openMediaViewer","click .arrow-navigation.previous":"prevAsset","click .arrow-navigation.next":"nextAsset","click .navigation-dot":"goToAssetFromDot","mouseenter .arrow-navigation":"showNavButton","mouseleave .arrow-navigation":"hideNavButton",drag:"handleDrag","swipeleft .image":"nextAsset","swiperight .image":"prevAsset"},nytEvents:{"nyt:page-resize":"adjustNavArrows"},initialize:function(e){this.assetIndex=0,t.bindAll(this,"openMediaViewer","prevAsset","nextAsset","goToAssetFromDot","showNavButton","hideNavButton"),e.showOnInit||this.$el.hide(),this.$body.off("click",".slideshow"),this.isMobile=this.pageManager.isMobile(),this.isLede=this.isSlideshowLede(),this.trackingBaseData={module:"Slideshow",action:"click",contentCollection:this.pageManager.getMeta("article:section"),version:"Embedded",region:"Body"},this.captionList=e.captionList,this.cropList=e.cropList,this.template=e.template||"embeddedSlideshow"},handleDomReady:function(){var e=a[this.template];this.getAssetsFromJSON(this.$el,this.captionList,this.cropList),this.$el.append(e({headline:this.headline,collection:this.collection,isMobile:this.isMobile,isLede:this.isLede})),this.render(),this.isCollectionLong()===!0&&this.setCounter(),this.$el.fadeIn(this.speed),this.trackingBaseData.contentID=this.assetID},findBasedOnList:function(e,t){for(var i=0;i<=t.length;i+=1)if(e.hasOwnProperty(t[i]))return e[t[i]];return{}},getAssetsFromJSON:function(i,s,a){var o,r,l=this,d=i.find("script").get(0).innerHTML,c=e.parseJSON(d);this.headline=c.headline||"",this.assetID=c.id;try{c=t.map(c.imageslideshow.slides,function(e){return o=l.findBasedOnList(e.image_crops,a),r=l.findBasedOnList(e.caption,s),o?{src:o.url,caption:r,credit:e.credit}:void console.error("Missing crop for image with caption "+r)})}catch(h){c=[]}c=t.filter(c,function(e){return!!e}),this.collection=new n,this.collection.reset(c)},render:function(){var i,n,s,o=new Image,r=this.$el.find(".image"),l=this.$el.find(".caption"),d=this.$el.find(".loader-container"),c=this;return i=this.collection.at(this.assetIndex),n=e(a.image({src:i.get("src")})),s=e(a.imageInfo({caption:i.get("caption"),credit:i.get("credit")})),r.html(n),d.css("margin-bottom",0),l.html(s),s.fadeIn(this.speed),o.onload=function(){c.isMobile||t.delay(function(){c.adjustNavArrows()},240),n.fadeIn(c.speed,function(){c.toggleLoader(!1)})},o.src=i.get("src"),this},adjustNavArrows:function(){var e=this.$(".arrow-navigation"),t=this.$(".arrow-navigation.next"),i=this.$(".arrow-background"),n=this.nextArrowOffset(),s=this.navArrowPlacement();e.css({height:s.arrowNavHeight,top:this.isLede===!1?s.arrowNavTop:""}),i.css("top",s.arrowBkgOffset),t.css("left",n),this.firstSlide&&(this.showArrow(t),this.firstSlide=!1)},hideArrow:function(t){var i=t instanceof e?t:e(t);i.find(".arrow-background").fadeOut(this.speed)},showArrow:function(t){var i=t instanceof e?t:e(t);i.find(".arrow-background").fadeIn(this.speed)},nextArrowOffset:function(){var e=this.$("img").width(),t=this.$(".arrow-navigation.next").width(),i=Math.round(e-t);return i},navArrowPlacement:function(){var e=this.$el.find("img").height(),t=Math.round(e/2-30),i={arrowNavHeight:e,arrowNavTop:30,arrowBkgOffset:t};return i},nextAsset:function(e){e.stopPropagation(),this.moveIndex(1),this.render(),this.isCollectionLong()===!0?this.setCounter():this.highlightNavDot(this.assetIndex);var t=this.assetIndex+1;this.trackingTrigger("embedded-slideshow-next-image",{eventName:"NextAsset-"+t+(t===this.collection.length?"-Finish":""),mdata:{currentSlide:t,totalSlides:this.collection.length}})},prevAsset:function(e){e.stopPropagation(),this.moveIndex(-1),this.render(),this.isCollectionLong()===!0?this.setCounter():this.highlightNavDot(this.assetIndex);var t=this.assetIndex+1;this.trackingTrigger("embedded-slideshow-prev-image",{eventName:"PrevAsset-"+t+(t===this.collection.length?"-Finish":""),mdata:{currentSlide:t,totalSlides:this.collection.length}})},goToAssetFromDot:function(t){var i=t.currentTarget,n=e(i).attr("dot-index"),s=parseInt(n,10);t.stopPropagation(),this.hideArrow(e(".arrow-navigation.next")),this.assetIndex=s,this.render(),this.highlightNavDot(s);var a=s+1;this.trackingTrigger("embedded-slideshow-dot",{eventName:"Dot-"+a+(a===this.collection.length?"-Finish":""),mdata:{currentSlide:a,totalSlides:this.collection.length}})},highlightNavDot:function(e){var t="active",i=this.$el.find(".navigation-dot");i.removeClass(t).eq(e).addClass(t)},setCounter:function(){var e;this.$counter=this.$el.find(".counter"),e=this.assetIndex,this.$counter.html(e+1+" of "+this.collection.length)},moveIndex:function(e){var t=this.assetIndex,i=this.collection.length;t+=e,t===i?t=0:-1===t&&(t=i-1),this.assetIndex=t},showNavButton:function(e){this.showArrow(e.currentTarget||e.srcElement)},hideNavButton:function(e){this.hideArrow(e.currentTarget||e.srcElement)},openMediaViewer:function(e){e.stopPropagation(),e.preventDefault(),this.broadcast("nyt:open-media-viewer",this.$el,this.assetIndex)},handleDrag:function(e){("right"===e.gesture.direction||"left"===e.gesture.direction)&&e.gesture.preventDefault()},isCollectionLong:function(){return this.collection.length>20},isSlideshowLede:function(){return this.$el.hasClass("lede")},toggleLoader:function(e){var t=this.$el.find(".loader-container");e?t.show():t.hide()}});return o}),define("blogs/instances/embedded-slideshow",["jquery/nyt","blogs/views/embedded-slideshow"],function(e,t){window.blogsSlideshowLoaded=0;var i=function(){window.blogsSlideshowLoaded++,e("#story").find(".slideshow").not(".done").addClass("done").each(function(i,n){if("inline"===e(this).data("media-action")){var s={el:n,captionList:["full","short"],cropList:["jumbo","tmagArticle","blog480"],showOnInit:!1,template:"embeddedSlideshow",truncateCaption:!0};new t(s)}}),e("body.chromeless-live-blogging").on("mousedown",".media.slideshow .image img",function(){var t=e(this).closest(".media.slideshow"),i=t.find(".dot-navigation .navigation-dot.active");i.next().length?i.next().click():t.find(".dot-navigation ol li:first").click()})};return 0===window.blogsSlideshowLoaded&&i(),{init:i}}),define("blogs/instances/learning-network-placeholder",["jquery/nyt","underscore/nyt","foundation/lib/polyfills/placeholder"],function(e,t,i){i()}),define("blogs/legacy/tab-set",["jquery/nyt"],function(e){function t(){l.each(function(){e(this).removeClass("selected")}),d.each(function(){e(this).removeClass("active")})}function i(t){if(t){var i=t.parents(".tabAutoLoad");i.find("ul.tabs li").each(function(){e(this).removeClass("selected")}),i.find(".tabContent").each(function(){e(this).removeClass("active")})}}function n(e){if(e){var t=e.parents(".tabAutoLoad"),i=t.find("ul.tabs li").index(e);s(e,t.find(".tabContent").eq(i))}}function s(e,t){e&&t&&(e.addClass("selected"),t.addClass("active"))}function a(){r.each(function(){e(this).find("ul.tabs li:first").addClass("selected"),e(this).find(".tabContent:first").addClass("active")})}function o(){r&&((0===r.find(".tabs.selected").length||0===r.find(".tabContent.active").length)&&(t(),a()),l.click(function(){i(e(this)),n(e(this))}))}var r=e(".tabAutoLoad"),l=r.find("ul.tabs li"),d=r.find(".tabContent");e(document).ready(o)}),define("blogs/legacy/comment-count",["jquery/nyt"],function(e){function t(){var t=[];if(!e('body[data-env="sandbox"]').length){if(e("a.commentCountLink").each(function(){t.push(e(this).attr("href").replace(/#/,""))}),0===t.length)return void(console&&console.log("no urls on the page with .commentCountLink class"));t=e.unique(t);var i="http://"+document.domain+'/svc/community/V2/requestHandler?requestData={"userContentSummary":{"request":{"requestType":"UserContentSummary","url":["'+t.join('","')+'"]}}}';e.ajax({type:"GET",url:i,dataType:"json"}).done(function(t){if(!t.userContentSummary)return void(console&&console.log("No response"));var i=t.userContentSummary.response.UserContentSummary,n=i.assets||[i];return n?void e.each(n,function(t,i){var n="",s=i.url,a=i.commentCount||0,o=e("a.commentCountLink[href='"+s+"']");0===a?(n="Comment",o.not(".commentCountNoPrompt").html(n).attr("href",s+"#commentsContainer").parent().removeClass("hidden")):(n=1===a?"1 Comment":a+" Comments",o.not(".commentCountNumberOnly").html(n).attr("href",s+"#commentsContainer").end().filter(".commentCountNumberOnly").html(a).attr("href",s+"#commentsContainer"),o.parent().removeClass("hidden"))}):void(console&&console.log("No assetsInResponse"))}).fail(function(e,t){console&&console.log("Comment Count Request failed: "+t)})}}e(document).ready(t)}),define("blogs/legacy/liveupdates",["jquery/nyt"],function(e){var t={newPostCheck:"",timeOfLastUpdate:"",liveUpdatesModule:e("#liveUpdatesModule"),$updatesContainer:e("#liveUpdates"),autoRefreshButton:e("#autoRefreshButton"),autoRefreshToggle:e("#autoRefreshToggle"),refreshNowButton:e("#refreshNowButton"),lastUpdatedTimestamp:e("#liveUpdatesModule").find(".lastUpdatedTimestamp"),apiUrl:e("meta[name=live_updates_json]").attr("content"),isMobile:!1,isPhone:!1,updateCheckInterval:3e4,autoRefreshOnMessage:"Auto-Refresh: ON",autoRefreshOffMessage:"Auto-Refresh: OFF",isProcessing:!1,totalNumberOfUpdates:0,numberOfNewUpdates:0,refreshCounter:0,refreshCounterLimit:6,initDone:!1,init:function(){t.initDone||"undefined"!=typeof t.apiUrl&&(t.isMobile=t.isPageMobile(),t.setEventHandlers(),t.getLiveUpdates(),t.checkHash(),t.isPhone?t.stopClock():t.startClock(),t.initDone=!0)},getParameterByName:function(e){var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=t.exec(window.location.href);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))},isPageMobile:function(){var i=t.getParameterByName("nytapp");return e.inArray(i,["iphone","android","mobile_web"])>-1&&(t.isPhone=!0),e.inArray(i,["iphone","android","mobile_web","ipad","android_tablet"])>-1},setEventHandlers:function(){t.isMobile?t.autoRefreshButton.click(function(){t.toggleAutoRefresh()}):t.autoRefreshToggle.click(function(){t.toggleAutoRefresh()}),t.refreshNowButton.click(function(){t.getLiveUpdates()})},getLiveUpdates:function(){t.isProcessing||(t.isProcessing=!0,t.isMobile?t.refreshNowButton.html("Updating...").addClass("isLoading"):t.refreshNowButton.html('<img src="http://graphics8.nytimes.com/images/blogs/firstlook/spinner.gif">Updating...').addClass("isLoading"),e.ajax({url:t.apiUrl,data:"hash-"+(new Date).getTime(),dataType:"json",type:"get"}).done(function(e){t.liveUpdateSuccess.call(t,e)}).fail(function(){t.liveUpdateFailure()}),t.isProcessing=!1)},updateRefreshCounter:function(){t.refreshCounter<t.refreshCounterLimit?t.refreshCounter=t.refreshCounter+1:(t.totalNumberOfUpdates=0,t.$updatesContainer.html(""),t.refreshCounter=0)},liveUpdateSuccess:function(i){var n=[],s="",a=i.updates,o="Refresh Now";t.numberOfNewUpdates=parseInt(i.post.total,10),t.totalNumberOfUpdates=t.totalNumberOfUpdates+t.numberOfNewUpdates,t.$updatesContainer.data("updates-total",t.totalNumberOfUpdates),t.isPhone&&(o="Refresh"),t.refreshNowButton.html(o).removeClass("isLoading"),t.isMobile&&t.lastUpdatedTimestamp.attr("datetime",i.post.modified_timestamp).attr("title",i.post.modified_timestamp_text).html(i.post.modified_timestamp_text);for(var r in a){var l=e("#"+a[r].permalink).length;if(l)break;n.push(t.updateTemplate(a[r]))}n.length&&(s=n.join(""),t.$updatesContainer.prepend(s)),0!==t.$updatesContainer.find(".update-error").length&&t.$updatesContainer.find(".update-error").html("")},liveUpdateFailure:function(){var e=['<div class="updated-entry-content update-error clearfix">',"<p>There was a problem with the live updates. The server may be busy or you may not have an internet connection. The last check for updates was ",t.timeOfLastUpdate,".</p>","</div>"].join("");0===t.$updatesContainer.find(".update-error").length&&t.$updatesContainer.prepend(e)},checkHash:function(){if(location.href.split("#")[1]&&!t.isMobile){var i="#"+location.href.split("#")[1],n=i.split("?");n[1]&&(i=n[0]),e(document).ready(function(){var t=e(i);0!==t.length&&window.scrollTo(0,t.offset().top-50)})}},startClock:function(){t.newPostCheck=setInterval(t.getLiveUpdates,t.updateCheckInterval),t.isMobile||t.autoRefreshToggle.html("Turn OFF"),t.autoRefreshButton.html(t.autoRefreshOnMessage).removeClass("autoRefreshDisabled").addClass("autoRefreshEnabled")},stopClock:function(){clearInterval(t.newPostCheck),t.isMobile||t.autoRefreshToggle.html("Turn ON"),t.autoRefreshButton.html(t.autoRefreshOffMessage).removeClass("autoRefreshEnabled").addClass("autoRefreshDisabled")},toggleAutoRefresh:function(){t.autoRefreshButton.hasClass("autoRefreshDisabled")?t.startClock():t.stopClock()},updateTemplate:function(e){var i=t.updateTimestamp(e),n=['<div class="',e.update_type_class,' update" data-update-id="',e.ID,'">','<div id="',e.permalink,'" class="updated-entry"><h5 class="updated-marker highlight">',i,"<strong>",e.title,"</strong></h5>","</div>",'<div class="updated-entry-content clearfix">',e.content,"</div>","</div>"].join("");return n},updateTimestamp:function(e){return['<span class="time">','<a href="#',e.permalink,'">',e.time,"</a></span>"].join("")}};return t}),require(["jquery/nyt","blogs/legacy/liveupdates"],function(e,t){e(".is-dashblog").length||t.init()}),define("blogs/views/tracking",["jquery/nyt","underscore/nyt","foundation/views/base-view"],function(e,t,i){var n=i.extend({el:"#shell",nytEvents:{"nyt:page-scroll-after":"handleScroll"},initialize:function(){this.lastScrollTop=0,this.maxScrollDepth=0,this.maxScrollTop=this.$body.height()-this.$window.height()},handleScroll:function(){var e=this.$window.scrollTop(),t=e-this.lastScrollTop;100>t||(this.lastScrollTop=e,this.updateScrollDepth())},updateScrollDepth:function(){var e=this.lastScrollTop/this.maxScrollTop*100,t=25*Math.floor(e/25);t>this.maxScrollDepth&&(this.maxScrollDepth=t,this.trackingTriggerRaw("scroll-depth",{module:"Page",depth:t},"interaction"))}});return n}),define("blogs/instances/tracking",["blogs/views/tracking"],function(e){new e}),define("blogs/legacy/nyt-video",["jquery/nyt","http://admin.brightcove.com/js/BrightcoveExperiences_All.js"],function(e){var t={init:function(){var t=e(document.body),i=e(".videoplayerContainer").not(".videoIsLoaded");if(i.length)return t.hasClass("chromeless-android_tablet-app")||t.hasClass("chromeless-android-app")||t.hasClass("single")&&e("body").hasClass("nyt-blog-lens")?void require(["http://js.nyt.com/video/vhs/build/vhs-latest.min.js"],function(t){i.each(function(){var i,n=e(this);try{i=t.player({container:n.attr("id"),id:n.data("video-id"),width:"100%",height:"100%",autoplay:n.data("autostart"),ads:-1===e.inArray(n.data("ads"),["tragedy","noads"]),skipAd:!0,mode:"flash",preload:"auto"}),i.loaded(function(){var t;(e("body").hasClass("chromeless-android_tablet-app")||e("body").hasClass("chromeless-android-app"))&&(t=this.controls,t.find(".nytd-player-controls-fullscreen").hide(),t.find(".nytd-player-controls-volume").css("right","0"),t.find(".nytd-player-controls-duration").css("right","40px"),t.find(".nytd-player-controls-progress").css("margin","8px 100px 0 100px")),this.on("play",function(){e(this.container).siblings(".caption").animate({opacity:0})})})}catch(s){console.log(s)}n.addClass("videoIsLoaded")})}):void i.each(function(){var t,i,n,s=e(this);try{require(["videoFactory"],function(a){n={container:"video-container-"+s.data("unique-id"),id:"embed_"+s.data("unique-id"),videoId:s.data("video-id"),publishId:"2128089001",width:"100%",height:"100%",autoStart:s.data("autostart"),adxPagename:s.data("adx-pagename"),adxAdPositions:s.data("adx-positions"),playerType:"blog",bigAdContainer:"",playerId:"760102458001",autoRender:!0,bgcolor:"#000000"},t=a.create(n),i=t.getSubscription(),i.subscribe("play",function(){e("#video-container-"+s.data("unique-id")).siblings(".caption").animate({opacity:0})}),s.addClass("videoIsLoaded")})}catch(a){console.log(a)}})}};return t}),define("blogs/instances/nyt-video",["blogs/legacy/nyt-video"],function(e){e.init()}),define("blogs/legacy/tabset-overlay-revealer",["jquery/nyt"],function(e){function t(){y.length<b.length&&m.find(".opposingFloatControl .element2 li:last-child").addClass(v),i(),m.mouseover(n),m.mouseout(a),p.mouseover(s)}function i(){m.unbind("click"),m.has("li").unbind("click")}function n(){s(),m.addClass(f),h=!0,p.removeClass(g)}function s(){window.clearTimeout(u),u=null,c=!1}function a(e){h&&(c=!0,u=window.setTimeout(function(){o(e)},750))}function o(e){l=e.target,d=e.relatedTarget||e.toElement,l!==m&&!m.has(l).length||m.has(d).length||c!==!0||(r(),p.addClass(g),m.removeClass(f),h=!1,c=!1)}function r(){u&&(window.clearTimeout(u),u=null)}var l,d,c,h=!1,u=0,m=e("#overlayTriggerController"),p=m.find(".opposingFloatControl"),g="hidden",f="tabSetOverlayHover",v="lastListItem",b=p.find(".element1 li"),y=p.find(".element2 li");e(document).ready(t)}),define("blogs/legacy/infinitescroll",["jquery/nyt","shared/sharetools/views/sharetools","blogs/legacy/nyt-video","blogs/instances/embedded-slideshow"],function(e,t,i,n){function s(t){var i=e(t);b=i.position(),i.fadeOut("fast",function(){r()})}function a(t){var i=e(t).data();i.category?"all"===i.category?(S="homepage",T=1):(S="category",T=i.category):i.author?(S="author",T=i.author):i.tag&&(S="tag",T=i.tag),x=S+"="+T,m(),o()}function o(){_&&4!==_.readyState&&_.abort(),f(),C.hide(),y.append(A),_=e.ajax({url:D,dataType:"json",data:x,success:l,error:p})}function r(){var t=e('meta[name="infinite_scroll_api"]').attr("content");t&&!P&&(P=!0,y.append(A),e.getJSON(t+"&apagenum="+M,function(t){A.detach(),e.each(t.posts,function(e,t){R.push(t.html)}),P=!1,$||($=!0,h()),t.more_posts_next_page===!1&&c(),d(),M++}))}function l(t){A.detach(),""===t.posts?v():(e.each(t.posts,function(e,t){R.push(t.html)}),C.show()),d()}function d(){R=R.join(""),w.append(R),e(document).trigger("infiniteScroll:itemsAdded"),k.next("article").addClass("firstArticle"),g(),e('.shareTools[data-share-tools-initialized!="1"]').each(function(){new t({el:this})}),i.init(),n.init()}function c(){e(window).unbind("scroll"),R.push('<article class="entry hentry"><div class="entry-summary"><p>There are no more posts to display.</p></div></article>'),A.detach()}function h(){e(window).scroll(function(){var t=e("body").hasClass("blog-one-col")?0:632;e(window).scrollTop()>=e(document).height()-(e(window).height()+t)&&r()})}function u(t){k.find("li").removeClass("selectedItem"),e(t).parent("li").addClass("selectedItem")}function m(){var t=D+"?"+x;e("meta[name=infinite_scroll_api]").attr("content",t)}function p(){f(),A.detach()}function g(){R=[]}function f(){w.children("article").remove()}function v(){R.push('<article class="entry hentry"><div class="entry-summary"><p>There are no posts to display.</p></div></article>'),A.detach()}var b,y,w,_,C,k,S,T,x,A=e('<div class="loader"></div>'),M=2,$=!1,P=!1,D="/more_posts_json",R=[];e(document).ready(function(e){y=e(e("body").hasClass("blog-one-col")?".previous-posts":"section.posts"),w=e(e("body").hasClass("blog-one-col")?".previous-posts-content":"section.posts .tabContent, section.posts .content"),e("body").hasClass("category-pictures-of-the-day")&&(w=e(".content .pictures-of-the-day")),C=e("#showMoreButton"),k=e(".tabbedPostsModuleHeader"),C.on("click",function(){s(this)}),k.find("a").on("click",function(){a(this),u(this)})})}),define("shared/whatsnext/templates",["underscore/nyt"],function(_){var templates={};return templates.loader=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="loader-container">\n<div class="loader"><span class="visually-hidden">Loading...</span></div>\n</div>';return __p},templates.section=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<section class="'+(null==(__t=className)?"":__t)+'"></section>';return __p},templates.topStories=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<header>\n<h2 class="section-heading"><a href="'+(null==(__t=sectionUrl)?"":__t)+'">'+(null==(__t=headingLabel)?"":__t)+'</a></h2>\n<p class="user-action"><a href="'+(null==(__t=sectionUrl)?"":__t)+'">'+(null==(__t=sectionLinkLabel)?"":__t)+' &raquo;</a></p>\n</header><ul class="menu layout-horizontal theme-story">',_.each(collection,function(e){__p+='\n<li>\n<a href="'+(null==(__t=e.getLink())?"":__t)+'" class="story-link">\n',e.getCrop("mediumThreeByTwo210")?(__p+='\n<article class="story theme-summary">\n<div class="wide-thumb">\n<img src="'+(null==(__t=e.getCrop("mediumThreeByTwo210").url||e.getCrop("mediumThreeByTwo210").content)?"":__t)+'" />\n</div>\n',__p+=e.get("kicker")?'\n<h3 class="kicker">'+(null==(__t=e.get("kicker"))?"":__t)+'</h3>\n<h2 class="story-heading">'+(null==(__t=e.get("headline"))?"":__t)+"</h2>\n":'\n<h2 class="story-heading">'+(null==(__t=e.get("headline"))?"":__t)+"</h2>\n",__p+="\n</article>\n"):(__p+='\n<article class="story theme-summary no-thumb">\n',e.get("kicker")&&(__p+='\n<h3 class="kicker">'+(null==(__t=e.get("kicker"))?"":__t)+"</h3>\n"),__p+='<h2 class="story-heading">'+(null==(__t=e.get("headline"))?"":__t)+"</h2>",(e.get("description")||e.get("summary"))&&(__p+='\n<p class="summary">'+(null==(__t=e.get("description")||e.get("summary"))?"":__t)+"</p>\n"),__p+="\n</article>\n"),__p+="\n</a>\n</li>\n"}),__p+="\n</ul>";return __p},templates}),define("shared/whatsnext/views/top-stories",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/whatsnext/templates"],function(e,t,i,n){var s=i.extend({template:n,initialize:function(e){this.settings=t.extend({},e),this.settings.items||(this.settings.items=3),this.collection.length>1?this.render():(this.$el.html(this.template.loader()),this.subscribeOnce(this.collection,"sync",this.render))},getNeatCollection:function(){var e=this.pageManager.getMeta("articleid"),t=this.pageManager.getCanonical();return this.collection.chain().uniq(!1,function(e){var t=e.attributes,i=t.data_id?t.data_id:t.id;return i?i:t.link}).reject(function(i){var n=i.attributes,s=n.data_id?n.data_id:n.id;return s&&s===e?!0:-1!==n.link.indexOf(t)?!0:!1}).first(this.settings.items).value()},render:function(){var t=this,i=this.template.topStories({headingLabel:this.settings.headingLabel,sectionLinkLabel:this.settings.sectionLinkLabel,sectionUrl:this.settings.sectionUrl||this.collection.getUrl(),collection:this.getNeatCollection()});
this.$el.html(i),this.$el.css("opacity",0),this.$el.animate({opacity:1},400),this.$el.hasClass("lda-context")&&0===this.collection.length&&e(".lda-context").remove(),this.$el.find(".whats-next h2").each(function(){var i=e(this).height();i>=81&&t.truncateText(e(this),80)}),this.$el.find(".summary").each(function(){t.truncateText(e(this),72)})}});return s}),define("shared/data/models/lda-article",["underscore/nyt","backbone/nyt","shared/data/models/article"],function(e,t,i){var n=i.extend({getCrop:function(e){for(var t,i=this.get("thumbs")?this.get("thumbs"):[],n=0;n<i.length;n+=1)if(t=i[n],t.type===e)return t;return null},getLink:function(){return this.get("id")}});return n}),define("shared/data/collections/lda-recommendations",["jquery/nyt","backbone/nyt","foundation/views/page-manager","foundation/collections/base-collection","shared/data/models/lda-article","foundation/hosts","underscore/nyt","shared/data/helpers/collection-mixin"],function(e,t,i,n,s,a,o,r){var l=n.extend(o.extend({},r,{model:s,url:a.du+"/svc/recommendations/v3/related.jsonp",sync:function(e,n,s){return s.dataType="jsonp",s.jsonpCallback="jsonLDA",s.jsonp="callback",s.cache=!0,s.data={access_key:"776ACB1E-6C7F-4702-9E18-CF329376F5A3",url:i.canonical},t.sync(e,n,s)},parse:function(e){return e&&e.payload&&e.payload.kw?e.payload.kw:null}}));return l}),define("shared/data/instances/lda-recommendations",["jquery/nyt","foundation/views/page-manager","shared/data/collections/lda-recommendations"],function(e,t,i){return new i}),define("shared/whatsnext/views/helpers/top-ranked-factory",["foundation/views/page-manager","foundation/hosts","shared/data/instances/most-emailed","shared/data/instances/recommendations","shared/data/instances/context","shared/data/instances/top-news","shared/data/instances/lda-recommendations"],function(e,t,i,n,s,a,o){var r=e.getMeta("article:section"),l=e.getMeta("CG"),d=r&&0===r.indexOf("The "),c=t.www,h={context:{el:".section-news",headingLabel:"More in "+r,sectionLinkLabel:"Go to "+(d?"":"the ")+r+" Section",collection:s},"top-news":{el:".top-news",headingLabel:"Top News",sectionLinkLabel:"Go to the Home Page",sectionUrl:c,collection:a},"most-emailed":{el:".most-emailed",headingLabel:"Most Emailed",sectionLinkLabel:"Go to the Most Emailed Section",sectionUrl:c+"/most-popular-emailed",collection:i},recommendations:{el:".recommendations",headingLabel:"Recommended for You",sectionLinkLabel:"Go to All Recommendations",sectionUrl:c+"/recommendations",collection:n},lda:{el:".lda-context",headingLabel:"More in "+r,sectionLinkLabel:"Go to "+(d?"":"the ")+r+" Section",collection:o,sectionUrl:c+"/pages/"+l}},u={createTemplate:function(e){return h[e]}};return u}),define("shared/whatsnext/views/whats-next",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/whatsnext/views/top-stories","shared/whatsnext/views/helpers/top-ranked-factory","shared/whatsnext/templates","foundation/models/user-data"],function(e,t,i,n,s,a,o){var r=i.registerView("whats-next").extend({el:"#whats-next",defaultSettings:{sections:"context,top-news"},events:{"click .section-news a":"handleMoreClick","click .top-news a":"handleTopNewsClick","click .recommendations a":"handleRecommendationsClick","click .lda-context a":"handleMoreClick"},initialize:function(e){t.bindAll(this,"render"),this.settings=t.extend({},this.defaultSettings,e),this.trackingBaseData={action:"click",contentCollection:this.pageManager.getMeta("article:section"),region:"Footer"}},handleDomReady:function(){this.pageManager.isComponentVisible(this.$el)?o.ready(this.render):this.subscribe("nyt:page-scroll",this.handleScrollCheck)},handleScrollCheck:function(){this.pageManager.isComponentVisible(this.$el)&&o.ready(this.render)},handleMoreClick:function(t){var i=e(t.currentTarget),n=this.trackingAppendParams(i.attr("href"),{module:"MoreInSection"});i.attr("href",n)},handleTopNewsClick:function(t){var i=e(t.currentTarget),n=this.trackingAppendParams(i.attr("href"),{module:"TopNews"});i.attr("href",n)},handleRecommendationsClick:function(t){var i=e(t.currentTarget),n=this.trackingAppendParams(i.attr("href"),{module:"Recommendation",src:"recg"});i.attr("href",n)},render:function(){var e,t,i,r="whatsNextAlgorithm",l=window.NYTABTEST.engine.findTest(r),d=this.pageManager.getMeta("author"),c=o.isLoggedIn(),h=c?this.settings.registered:this.settings.anonymous;h=h.split(","),this.stopSubscribing("nyt:page-scroll",this.handleScrollCheck),!l||"The Associated Press"!==d&&"Reuters"!==d||l.determine("0");var u=this.isUserVariant(r);for("1"===u&&(h[0]=c?"recommendations":"top-news",h[1]="context"),"2"===u&&(h[0]="lda",h[1]=c?"recommendations":"top-news"),"3"===u&&(h[0]=c?"recommendations":"top-news",h[1]="lda"),e=0,t=h.length;t>e;e+=1)i=s.createTemplate(h[e]),i.items=3,0===e&&(i.items=6),i.collection.loadData(),this.$el.append(a.section({className:i.el.replace(".","")})),new n(i)}});return r}),define("shared/whatsnext/instances/whats-next",["foundation/views/page-manager","shared/whatsnext/views/whats-next"],function(e,t){var i,n;e.getMeta("errorpage")?(i="most-emailed,top-news",n="most-emailed,top-news"):e.getMeta("article:section")?(i="context,recommendations",n="context,top-news"):(i="top-news,recommendations",n="top-news"),new t({registered:i,anonymous:n})}),define("blogs/views/legacy-comments",["jquery/nyt","underscore/nyt","foundation/views/base-view"],function(e,t,i){var n=i.extend({render:function(){var t=this,i=e(".legacy-commentform");i.find(".comment-submit-button").attr("disabled","disabled").addClass("disabled"),this.setElement(i),this.$textarea=i.find("textarea"),this.$author=i.find(".author-input"),this.$email=i.find(".email-input"),this.$textarea.on("change keyup cut paste",function(){t.buttonToggle(this.$textarea)}),this.$author.on("change keyup cut paste",function(){t.buttonToggle(this.$author)}),this.$email.on("change keyup cut paste",function(){t.buttonToggle(this.$email)})},handleDomReady:function(){this.render()},buttonToggle:function(){var t=e(".legacy-commentform"),i=t.find("textarea").val().length,n=t.find(".author-input").val().length,s=t.find(".email-input").val().length;if(i>0&&n>0&&s>0)t.find(".comment-submit-button").removeAttr("disabled").removeClass("disabled");else{if(0!==i&&0!==n&&0!==s)return;t.find(".comment-submit-button").attr("disabled","disabled").addClass("disabled")}}});return n}),define("blogs/instances/legacy-comments",["jquery/nyt","blogs/views/legacy-comments"],function(e,t){new t}),define("shared/fontsizer/views/font-sizer",["jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/models/page-storage"],function(e,t,i,n){var s=i.extend({events:{doubletap:"handleDoubleTap"},nytEvents:{"nyt:fontsizer-change":"handleFontChange"},typeSizes:["small","medium","large"],typePrefix:"type-size-",settingsKey:"fontsizer_typeSize",handleLocalStorageReady:function(){var e=n.get(this.settingsKey)||(this.pageManager.isMobile()?"medium":"small");this.broadcast("nyt:fontsizer-initialize",e),this.setSize(e)},getSize:function(){return this.typeSizes[this.sizeIndex]},setSize:function(e){var i=t.indexOf(this.typeSizes,e);0>i||(n.set(this.settingsKey,e),this.pageManager.setMeta(this.settingsKey,e),this.sizeIndex=i,this.adjustTypeSize())},cycle:function(){var e=this.sizeIndex;e+=1,e===this.typeSizes.length&&(e=0),this.broadcast("nyt:fontsizer-change",this.typeSizes[e])},adjustTypeSize:function(){this.$html.removeClass(function(e,t){return(t.match(/\btype-size\S+/g)||[]).join(" ")}).addClass(this.typePrefix+this.getSize())},handleFontChange:function(e){this.setSize(e)},handleDoubleTap:function(){Modernizr.touch&&this.cycle()}});return s}),define("blogs/instances/font-sizer",["shared/fontsizer/views/font-sizer"],function(e){new e({el:"#story"})}),define("blogs/legacy/aol-player",["jquery/nyt"],function(e){function t(e){window.console&&window.console.log(e)}window.PartnerVideo={pageUrl:null,videoId:null,videoTitle:null,videoCategory:null,videoDuration:null,isFirstVideo:null,playheadTime:null,videoComplete:null},window.nytVideoDataLoaded=function(i){var n={pageUrl:i.pageUrl,videoId:i.videoId,videoTitle:i.videoTitle.replace(/'/g,"'"),videoCategory:i.videoCategory[0],videoDuration:i.videoDuration,isFirstVideo:i.isFirstVideo,playheadTime:null,videoComplete:!1};window.PartnerVideo=n,i.isFirstVideo&&e("#partner-video").removeClass("visually-hidden"),t("VideoDataLoaded")},window.nytPartnerPlayerPlay=function(){t("Play")},window.nytPartnerPlayerVideoStartPlay=function(){var e=window.PartnerVideo;t("VideoStartPlay"),window.dcsMultiTrack("DCS.dcssip","nytimes.com","DCS.dcsuri","/external/aol/player/","WT.ti",e.pageUrl,"WT.videoCategory",e.videoCategory,"WT.videoEvent","play","WT.videoLoad","user","WT.videoName",e.videoTitle,"WT.z_gpst","Video","WT.z_vid",e.videoId,"WT.z_dcsm","1","WT.vpt","External_Player","WT.z_video_src","AOL")},window.nytPartnerPlayerPause=function(){t("Pause")},window.nytPartnerPlayerPrerollStarted=function(){window.PartnerVideo;t("PrerollStarted")},window.nytPartnerPlayerPrerollEnded=function(){window.PartnerVideo;t("prerollEnded")},window.nytPartnerPlayerTimeUpdate=function(e){var i=window.PartnerVideo;-1===e.playheadTime||e.isPlayComplete?(t("Video Complete"),i.videoComplete=!0,window.dcsMultiTrack("DCS.dcssip","nytimes.com","DCS.dcsuri","/external/aol/player/","WT.ti",i.pageUrl,"WT.videoCategory",i.videoCategory,"WT.videoEvent","finish","WT.videoLoad","user","WT.videoName",i.videoTitle,"WT.z_gpst","Video","WT.z_vid",i.videoId,"WT.z_dcsm","1","WT.vpt","External_Player","WT.z_video_src","AOL"),t(e)):i.playheadTime=e.playheadTime},e(".partner-player-container").append('<script src="http://pshared.5min.com/Scripts/PlayerSeed.js?sid=1652&width=600&height=502&relatedMode=4&fwCountdownDisable=1&hasCompanion=false&relatedButtonType=2&relatedTextType=2&onVideoDataLoaded=nytVideoDataLoaded&onPlay=nytPartnerPlayerPlay&onTimeUpdate=nytPartnerPlayerTimeUpdate&onPause=nytPartnerPlayerPause&onPrerollStarted=nytPartnerPlayerPrerollStarted&onPrerollEnded=nytPartnerPlayerPrerollEnded&onVideoStartPlay=nytPartnerPlayerVideoStartPlay"></script>')}),require.config({map:{"*":{jquery:"foundation/lib/jquery/2.1.1"}}}),require(["blogs/instances/blogs","shared/account/instances/account","blogs/legacy/common","blogs/legacy/video-poster","blogs/instances/ad-manager","shared/ribbon/instances/ribbon","shared/masthead/instances/masthead","shared/searchform/instances/search-form","shared/messaging/instances/messaging","shared/navigation/instances/navigation","blogs/instances/community","blogs/instances/sharetools","blogs/instances/embedded-slideshow","blogs/instances/learning-network-placeholder","blogs/legacy/tab-set","blogs/legacy/comment-count","blogs/instances/liveupdates","blogs/instances/tracking","blogs/instances/nyt-video","blogs/legacy/tabset-overlay-revealer","blogs/legacy/infinitescroll","shared/whatsnext/instances/whats-next","blogs/instances/legacy-comments","blogs/instances/font-sizer","blogs/legacy/aol-player"]);
//# sourceMappingURL=main.js.map