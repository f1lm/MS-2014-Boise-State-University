/*! Autogenerate CrowdChat 2014-11-07 */
function loadMoreTags(a,b){var c=encodeURIComponent(a.toLowerCase());return!tagsPage&&0>b?void $("#tagCloud .arrow-left").hide():(tagsPage+=b,void("explore"==c?$.post("/api/tags/"+tagsPage).done(function(a){var b=$("#tagCloud");b.fadeOut("slow",function(){b.replaceWith(a),$("#tagCloud").hide(),$("#tagCloud").fadeIn("slow")})}):$.get(c+"?tagsOnly=true&page="+tagsPage).done(function(a){var b=$("#tagCloud");b.fadeOut("slow",function(){b.replaceWith(a),$("#tagCloud").hide(),$("#tagCloud").fadeIn("slow")})}).error(function(a){"No Tags Found"==a.responseText&&(tagsPage-=b,$("#tagCloud .arrow-right").hide())})))}function loadMoreChats(a){if(""!=lastPage&&!loadingChats){var b=encodeURIComponent(a.toLowerCase());loadingChats=!0,chatsPage+=1,$.get(b+"?data=true&fetchNum=20&page="+chatsPage).done(function(a){lastPage=a,$("#spotlist").append(a),updateChatCardTimestamps(),loadingChats=!1})}}function handle_alert(a){$("#alertBox").removeClass("alert-danger alert-warning alert-success"),null!=a.error?($("#alertText").html(a.error),$("#alertBox").removeAttr("style"),$("#alertBox").addClass("alert-danger"),$("#alertBox").show(),-1!=last_e&&window.clearTimeout(last_e),last_e=window.setTimeout(function(){$("#alertBox").stop().fadeTo(500,0).slideUp(500,function(){$(this).stop().hide().removeClass("alert-danger")})},3e3)):null!=a.warning?($("#alertText").html(a.warning),$("#alertBox").removeAttr("style"),$("#alertBox").addClass("alert-warning"),$("#alertBox").show(),-1!=last_e&&window.clearTimeout(last_e),last_e=window.setTimeout(function(){$("#alertBox").stop().fadeTo(500,0).slideUp(500,function(){$(this).hide().removeClass("alert-warning")})},3e3)):null!=a.success?($("#alertText").html(a.success),$("#alertBox").removeAttr("style"),$("#alertBox").addClass("alert-success"),$("#alertBox").show(),-1!=last_e&&window.clearTimeout(last_e),last_e=window.setTimeout(function(){$("#alertBox").stop().fadeTo(500,0).slideUp(500,function(){$(this).hide().removeClass("alert-success")})},3e3)):a&&($("#alertText").html(a),$("#alertBox").removeAttr("style"),$("#alertBox").addClass("alert-success"),$("#alertBox").show(),-1!=last_e&&window.clearTimeout(last_e),last_e=window.setTimeout(function(){$("#alertBox").stop().fadeTo(500,0).slideUp(500,function(){$(this).hide().removeClass("alert-success")})},3e3))}function wide_alert(a){$("#wideAlertText").html(a),$("#wideAlertBox").removeAttr("style"),$("#wideAlertBox").show(),-1!=last_e2&&window.clearTimeout(last_e2),last_e2=window.setTimeout(function(){$("#wideAlertBox").stop().fadeTo(500,0).slideUp(500,function(){$(this).stop().hide()})},3e3)}function static_alert(a,b){clientcode.queueMessage("static alert",function(){$("#staticAlertText").html(a),b&&$("#staticAlertText").css("font-size",b),$("#staticAlertBox").removeAttr("style"),$("#staticAlertBox").show()})}function IsEmail(a){var b=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;return b.test(a)}function new_user_reload(a){window.location.href=get_redirect_url(a)}function signup(a){$("#wideAlertBox").hide();var b=$("#user_name").val(),c=$("#email").val();if(!IsEmail(c))return wide_alert("Please enter a valid email"),void $("#email").focus();if(!$("#terms").is(":checked"))return void wide_alert("Please agree to the terms.");var d=get_redirect_url(a);$.post("/user/update_user",{user_name:b,email:c}).done(function(a){if(a.valid)$(window).off("unload"),$("#user_form").hide(),$("#check_email").removeClass("hide"),setTimeout(function(){window.location.href=d},1e4);else if(a.profile_url){var b="You already have an account with us, do you want to add "+a.new_account+' to your profile (<a target="_self" data-dismiss="modal", aria-hidden="true", href="'+a.profile_url+"?ref="+d+"&cc_user="+a.cc_user+'" style="cursor:pointer">Add Network</a>) Or Please enter a new eMail ID';$("#wideAlertText").html(b),$("#wideAlertBox").removeAttr("style"),$("#wideAlertBox").css("display","inline-block")}else wide_alert(a+"<br/>Please try again.")}).fail(function(){wide_alert("We could not reach our servers. Please try again.")})}function record_cancel(){$("#wideAlertBox").hide(),$.post("/monitoring/cancel",{user_agent:navigator.userAgent,action:"Pressed Cancel"})}function isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function isIE(){return/msie/i.test(navigator.userAgent)}function flashBrowserUnsupported(){("msie"==navigator.browser_name.toLowerCase()||"chrome"==navigator.browser_name.toLowerCase()&&navigator.browser_version<=3||"firefox"==navigator.browser_name.toLowerCase()&&navigator.browser_version<=3||"safari"==navigator.browser_name.toLowerCase()&&navigator.browser_version<=3)&&($("#wideAlertText").html("CrowdChat is best supported on <b>latest</b> versions of Chrome, FireFox and Safari. <br/>Sorry, Internet Explorer does not support the latest UI elements needed by us."),$("#wideAlertBox").fadeIn("fast"))}function getParameterByName(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null==c?"":decodeURIComponent(c[1].replace(/\+/g," "))}function oUser(a){clear_modal("user_modal"),$("#user_modal").modal("show"),$.get("/modals/user/"+encodeURIComponent(a)).done(function(a){a.profileURL?($("#user_modal").modal("hide"),window.location.href=a.profileURL):($("#user_modal .modal-body").html(a),$("#user_modal").modal("show"))})}function showSpotEditDialog(a,b){var c="/chat/edit?spot="+$("#archive_id").val()+"&tab="+a+"&scroll="+b;$("iframe#spot_edit").attr("src",c)}function addHost(){var a='<div class="col-xs-12 well form-group editHostCard"><span class="removeHost"><a class="btn btn-link" title="Drop this host"><span class="fa fa-times"/></a></span><img name="display_pic" style="position:absolute;right:10px" class="hidden-xs"/><span class="loadingHost" style="display:none;position:absolute;right:10px"><i class="fa fa-spinner fa-spin fa-lg"></i></span><label for="host_hand'+labelCountId+'" class="control-label col-sm-3" style="padding-left:0px">Twitter Handle</label><div class="col-sm-7"><div class="input-group" ><span class="input-group-addon">@</span><input id="host_hand'+labelCountId+'" type="text" name="host_hand" class="form-control spot-form-input host-hand"  data-h5-errorid="missingHost'+labelCountId+'"/><input type="hidden" name="host_twitter_id" class="twitter-id"></div><div id="missingHost'+labelCountId+'" class="field-alert-message">Host handle is required </div></div><input id="host_pict'+labelCountId+'" type="hidden" name="host_pict"><label class="control-label col-sm-3" for="host_name'+labelCountId+'" class="control-label">Name</label><div class="col-sm-7"><input class="form-control spot-form-input host-name" id="host_name'+labelCountId+'" type="text" name="host_name" oninvalid="showEditChatTab(\'spot-optional\')" data-h5-errorid="missingHostName'+labelCountId+'"><div id="missingHostName'+labelCountId+'" class="field-alert-message">Host name is required</div></div><label class="control-label col-sm-3" for="host_desc'+labelCountId+'" class="control-label">Description</label><div class="col-sm-7"><input class="form-control spot-form-input host-desc" oninvalid="showEditChatTab(\'spot-optional\')" id="host_desc'+labelCountId+'" type="text" name="host_desc" data-h5-errorid="missingHostDesc'+labelCountId+'"><div id="missingHostDesc'+labelCountId+'" class="field-alert-message">Host description is required</div></div></div>';labelCountId++,$(".editHosts .hosts").append(a),$(".removeHost").click(function(){return $(this).closest(".editHostCard").remove(),!1}),$('input[name^="host_hand"]').blur(populate_host)}function addTag(){var a='<div class="form-group tagDiv row"><a class="btn btn-link col-sm-1 removeTag" title="Drop this tag"><i class="fa fa-times"/></a><label for="tag'+labelCountId+'" class="control-label col-sm-2">Tag</label><div class="col-sm-9"><input id="tag'+labelCountId+'" type="text" name="tag" maxlength=14 style="max-width:180px" class="form-control spot-form-input tag"></div></div>';$("#tags").append(a),labelCountId++,$(".removeTag").click(function(){return $(this).closest(".tagDiv").remove(),$(".addTagLink").show(),!1});var b=$(".tagDiv").length;b>=3&&$(".addTagLink").hide()}function populate_host(a){var b=$(a.target).closest(".editHostCard"),c=b.find('input[name^="host_hand"]').val(),d=b.find('input[name^="host_pict"]'),e=b.find('input[name^="host_name"]'),f=b.find('img[name^="display_pic"]'),g=b.find('input[name^="host_desc"]'),h=b.find('input[name^="host_twitter_id"]');return c?(c=c.trim(),b.find(".loadingHost").show(),void $.get("/auth/twitter/picture?screen_name="+c,function(a){b.find(".loadingHost").hide(),a.pic?(d.val(a.pic),f.attr("src",a.pic).show()):(d.val(""),f.attr("src","").hide()),e.val(a.name),g.val(a.bio),h.val(a.id),b.find(".field-alert-message").hide()}).fail(function(){b.find(".loadingHost").hide(),handle_alert({error:"Error with Twitter OAuth, Signing you out. Please sign in and try again."});var a=window.location.href;window.setTimeout(function(){window.location="/user/signout?referral="+a},2e3)})):(d.val(""),f.attr("src","").hide(),e.val(""),g.val(""),void h.val(""))}function init_edit_spot(){$("textarea[maxlength]").bind("input propertychange",function(){var a=$(this).attr("maxlength");$(this).val().length>a&&$(this).val($(this).val().substring(0,a))});var a=new Date(+new Date+6e5);$("#datepicker").datetimepicker({language:"en",startDate:new Date,defaultDate:a,pickTime:!1}),$("#dateSelect").focus(function(){$(".glyphicon-calendar").click()}),$("#timepicker").datetimepicker({language:"en",defaultDate:a,pickDate:!1}),$("#timeSelect").focus(function(){$(".glyphicon-time").click()}),$("#datepicker").on("change.dp",function(){var a=moment($("#dateSelect").val()+" "+$("#timeSelect").val(),"MM-DD-YYYY HH:mm A");$("#datetimelocale").val(a.toDate())}),$("#timepicker").on("change.dp",function(){var a=moment($("#dateSelect").val()+" "+$("#timeSelect").val(),"MM-DD-YYYY HH:mm A");$("#datetimelocale").val(a.toDate())}),$("#datetimelocale").val(a);var b=a.toTimeString().match(/\(.*?\)/gm);$("#zone").text(" "+b),$('input[name^="host_hand"]').blur(populate_host),$("#fileupload_logo").change(function(){$("#filename_logo").text(this.value.replace(/C:\\fakepath\\/i,""))}),$("#fileupload_wallpaper").change(function(){$("#filename_wallpaper").text(this.value.replace(/C:\\fakepath\\/i,""))}),$("[data-hide]").on("click",function(){$(this).closest("."+$(this).attr("data-hide")).hide()}),$("#next").off("click").click(function(){return $("#wideAlertBox").fadeOut("fast"),$("form").h5Validate("allValid")?!0:!1}),$("#next2").off("click").click(function(){var a=new Date($("#datetimelocale").val()).getTime();if(a<(new Date).getTime()&&$("input#definiteChat").is(":checked"))return handle_alert({error:"Chats should be scheduled in the future.<br/>Please select a different time."}),!1;$("input#definiteChat").is(":checked")||(a=(new Date).getTime());var b=60*parseInt($("#duration_hours").val(),10);b+=parseInt($("#duration_mins").val(),10),b*=6e4;var c=$("#hashtag").val(),d=!1;return $.ajax({type:"POST",url:"/a/check_time",data:{hash:c,time:a,duration:b},async:!1,success:function(a){a.err?handle_alert({error:a.err}):a.valid&&(d=!0)}}),d})}function resetForm(){$("#spotforsubmit").removeAttr("disabled"),$("#short_url_view").val(""),$("#copyButton").attr("data-clipboard-text",""),$("#short_url").val(""),$("#alertText").text(""),$("#alertBox").hide(),$("#wideAlertText").text(""),$("#wideAlertBox").hide(),$("img[name='old_logo']").hide().attr("src",""),$("img[name='old_wallpaper']").hide().attr("src",""),$("#spot_id").val(""),$("#title").val(""),$("#description").val(""),$("#ext_url").val(""),$("#ext_url_title").val("video"==getParameterByName("v")?"Pop out video":""),$("#old_logo").val("");for(var a=$(".tagDiv").length-1;a>=0;a-=1)0===a?$($(".tagDiv")[a]).find("input#tag").val(""):$($(".tagDiv")[a]).remove();var b=new Date(+new Date+6e5);$("#datetimelocale").val(b),$("#dateSelect").val(moment(new Date(b.getTime())).format("MM/DD/YYYY")),$("#timeSelect").val(moment(new Date(b.getTime())).format("hh:mm A")),$("#datepicker").data("DateTimePicker").setDate(moment(b).format("MM/DD/YYYY")),$("#timepicker").data("DateTimePicker").setDate(moment(b)),$("#duration_hours").val(1),$("#duration_mins").val(0),$("img[name='old_logo']").attr("src","").slideUp(),$("img[name='old_wallpaper']").attr("src","").slideUp();for(var a=$(".host").length-1;a>=0;a-=1)0===a?($($(".host")[a]).find('input[name^="host_name"]').val(""),$($(".host")[a]).find('input[name^="host_desc"]').val(""),$($(".host")[a]).find('input[name^="host_hand"]').val(""),$($(".host")[a]).find('input[name^="host_pict"]').val(""),$($(".host")[a]).find('img[name^="display_pic"]').attr("src","")):$($(".host")[a]).remove();$(".bg-alert").hide()}function getShortUrl(){$("span.loadingHash").show();var a=$("#server").val();$.ajax({type:"POST",url:a+"/tools/shorten",data:'{"url":"'+$("#server").val()+"/"+$("#hashtag").val()+'"}',dataType:"json",contentType:"application/json"}).done(function(a){$("#short_url_view").val(a.id),$("#copyButton").attr("data-clipboard-text",a.id),$("#short_url").val(a.id),privateHash==$("#hashtag").val()&&(privateURL=a.id),$("span.loadingHash").hide()}).fail(function(a){console.log(a),$("span.loadingHash").hide(),handle_alert({error:"Could not reach server, please try again."})})}function getUniquePrivateHash(){var a=(Math.random()+1).toString(36).substring(2);a="private"+a,a=a.substring(0,20),$("#hashtag").val(a),resetForm(),privateURL?($("#short_url_view").val(privateURL),$("#copyButton").attr("data-clipboard-text",privateURL),$("#short_url").val(privateURL)):(getShortUrl(),privateHash=a)}function showPrivateOptions(){$("#createNew").val()&&getUniquePrivateHash(),$("#privatePasscodeNotice").show(),$("#hashDiv").hide(),$("div#audiencePanel").hide(),$("div#pledge").hide(),$("input[name=host_pledge]").prop("checked",!0),$("input#spotforsubmit").val("Create Private Chat"),$("input#title").val("My Private Chat"),$("textarea#description").val("This is very private"),$('input[name="period"]').filter('[value="indefinite"]').click()}function showPublicOptions(a){a||($("#hashtag").val(""),$("#short_url_view").val(""),$("#short_url").val("")),$("#copyButton").attr("data-clipboard-text",""),$("#privatePasscodeNotice").hide(),$("#hashDiv").show(),$("div#audiencePanel").show(),$("div#pledge").show(),$("input[name=host_pledge]").click(),$("input#spotforsubmit").val("Create Chat"),$("input#title").val(""),$("textarea#description").val("")}function fill_spot_values(a,b){var c,d;a.isPrivate?showPrivateOptions():showPublicOptions(!0),$("input[name=host_pledge]").click(),$("#spot_id").val(a.id),$("#short_url_view").val(a.short_url),$("#short_url").val(a.short_url),$("#copyButton").attr("data-clipboard-text",a.short_url),$("#title").val(a.title),$("#description").val(a.description);var e=[];if(a.tags)for(c=0;c<a.tags.length;c+=1)"#"!=a.tags[c][0]&&"@"!=a.tags[c][0]&&e.push(a.tags[c]);if(e.length>0){var f=$(".tagDiv");for(c=1;c<f.length;c+=1)f[c].remove();for(c=0;c<e.length-1;c+=1)addTag();for(d=0;d<e.length;d+=1)$($('input[name^="tag"]')[d]).val(e[d])}var g,h;if("indefinite"==a.period?(g=new Date,h=36e5,$("#indefiniteChat").prop("checked","checked"),$(".schedule-chat").hide(),$(".indefinite-chat").show(),$('input[name="period"]').filter('[value="indefinite"]').click(),$("#chatPeriod").length&&$("#chatPeriod").val("indefinite")):(g=new Date(a.datetime),h=a.duration,$(".schedule-chat").show(),$(".indefinite-chat").hide(),$('input[name="period"]').filter('[value="definite"]').click(),$("#chatPeriod").length&&$("#chatPeriod").val("definite")),"withVideo"==a.chatType?($("#ext-link-title-div").hide(),$("#ext-link-title-div").val("Pop out video"),$("#ext-link-div").find("label").text("Link to video"),$("#ext-link-div").find("input#ext_url").attr("placeholder","Link to LIVE or recorded YouTube"),$("#ext_url_optional").hide(),$('input[name="chatType"]').filter('[value="withVideo"]').click()):($("#ext-link-title-div").show(),$("#ext-link-div").find("label").text("Link to article"),$("#ext-link-div").find("input#ext_url").attr("placeholder","Any website or blog link"),$("#ext_url_optional").show(),$('input[name="chatType"]').filter('[value="onlyChat"]').click()),$("#datetimelocale").val(g),$("#dateSelect").val(moment(g).format("MM/DD/YYYY")),$("#timeSelect").val(moment(g).format("hh:mm A")),$("#datepicker").data("DateTimePicker").setDate(moment(g).format("MM/DD/YYYY")),$("#timepicker").data("DateTimePicker").setDate(moment(g)),$("#duration_hours").val(Math.floor(h/36e5)),$("#duration_mins").val(h%36e5/1e3/60),$("#ext_url").val(a.ext_url),$("#ext_url_title").val(a.ext_url_title),$("#old_logo").val(a.logo),$("#old_wallpaper").val(a.wallpaper),a.logo&&$("img[name='old_logo']").attr("src",a.logo).slideDown(100),a.wallpaper&&$("img[name='old_wallpaper']").attr("src",a.wallpaper).slideDown(100),a.hosts.length>0){var i=$("#hosts .host");for(c=1;c<i.length;c+=1)i[c].remove();for(c=0;c<a.hosts.length-1;c+=1)addHost();for(d=0;d<a.hosts.length;d+=1)$($('input[name^="host_name"]')[d]).val(a.hosts[d].name),$($('input[name^="host_desc"]')[d]).val(a.hosts[d].description),$($('input[name^="host_hand"]')[d]).val(a.hosts[d].handle),$($('input[name^="host_pict"]')[d]).val(a.hosts[d].picture),$($('input[name^="host_twitter_id"]')[d]).val(a.hosts[d].twitter_id),$($('img[name^="display_pic"]')[d]).attr("src",a.hosts[d].picture);b&&setTimeout(function(){for(d=0;d<a.hosts.length;d+=1)populate_host({target:$('input[name^="host_name"]')[d]})},1)}}function open_beta_modal(a,b){var c=null;a&&(betaClickType=a,c=[{key:"beta_user",value:!0},{key:"beta_type",value:a}],b&&c.push({key:"action",value:"host_chat"})),$("a.twitter_login").attr("href",create_url("/auth/twitter",c)),$("a.linkedin_login").attr("href",create_url("/auth/linkedin",c)),$("a.facebook_login").attr("href",create_url("/auth/facebook",c)),$("#betamodal").modal("toggle")}function closeRememberModal(){var a=$("#rememberBox").is(":checked"),b=$("#hash").val().toLowerCase();$("#rememberModal").modal("toggle"),a&&$.get("/"+b+"/validatePrivate")}function sendBetaRequest(){$.post("/?beta_type="+betaClickType).done(function(a){return $("#betamodal").modal("hide"),a.error?void handle_alert({error:"Could not reach server, please try again."}):void handle_alert("Successfuly submitted your request")}).fail(function(){handle_alert({error:"Could not reach server, please try again."})})}function open_feedback_modal(){$("#feedbackmodal").modal("toggle")}function open_help_modal(){$("#helpmodal").appendTo("body").modal("toggle")}function numberWithCommas(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function initNotification(a){var b=$("#notif-container .unseen").length,c=$("#notif-container .seen").length+b;a&&b>0?($("#notif-clear").show(),$("#notif-empty").hide(),$("#notif-count").slideUp("fast",function(){$("#notif-count").text(b),$("#notif-count").slideDown("fast")})):c>0?($("#notif-clear").show(),$("#notif-empty").hide(),$("#notif-count").hide()):($("#notif-clear").hide(),$("#notif-empty").show(),$("#notif-count").hide())}function openNotification(a,b,c){a=a.trim(),$.post("",{operation:"markAsSeen",chatId:a,postId:b,predicate:c}).done(function(){return markAsSeen(a,b,c),initNotification(!1),openPost(b)})}function markAsSeen(a,b,c){$('.unseen[data-chatId="'+a+'"][data-postId="'+b+'"][data-predicate="'+c+'"]').addClass("seen").removeClass("unseen")}function clearAllNotifications(){$.post("",{operation:"clear_notifications",spot_id:$("#spot_id").val().toLowerCase()}).done(function(){$("#notif-container .seen").remove(),$("#notif-container .unseen").remove(),initNotification(!1)}).fail(function(){handle_alert({error:"Could not clear notifications, please try again."})})}function check_auth(){var a=$.ajax({type:"GET",async:!1,url:"/user/auth"});return a.responseText}function check_permissions(a,b){var c=$.ajax({type:"POST",async:!1,url:"/user/perm",data:{perm:a}});return"true"==c.responseText?!0:"not signed in"!=c.responseText||b?!1:(console.log("refreshing"),window.location.href=window.location.href,!1)}function createNewChat(){var a="";check_permissions("/admin/setupspot",!0)?($("iframe#spot_edit").attr("src","/a/create"+a),$("#edit_spot_modal").modal(),logAction("create-popup-open")):open_beta_modal("Free-host",!0)}function get_redirect_url(a){var b=$("#server").val();switch(a){case"host_chat":b+="/?action=create-chat";break;default:b=window.location.href.split("?")[0]}return b}function create_url(a,b){var c="";if(a){if(a=a.trim(),b&&b.length>0){c=a.indexOf("?")>0?a.indexOf("?")==base_urltrim.length-1?"":"&":"?",c+=encodeURIComponent(b[0].key)+"="+encodeURIComponent(b[0].value);for(var d=1;d<b.length;d++)c+="&"+encodeURIComponent(b[d].key)+"="+encodeURIComponent(b[d].value)}return a+c}}function clear_modal(a){$("#"+a+" .modal-body").html("<h3>Loading...</h3>")}function openHelpModal(){return clear_modal("help_modal"),$.get("/modals/faq").done(function(a){$("#help_modal .modal-body").html(a)}),$("#help_modal").modal("show"),!1}function openMessageModal(a,b){$("#message_modal").find("#to").text(b),$("#message_modal").find("#addr").val(a),$("#message_modal").modal(),$("#message_modal").toggle()}function closeMessageModal(){var a=$("#message_modal").find("#addr").val();oUser(a)}function sendMessage(){var a=$("#message_modal").find("#addr").val(),b=$("#message_modal").find("#message").val();$("#message_modal").find("#message").val("");var c=$("#hash").val().toLowerCase();$.post("/user/inbox/send",{id:a,message:b,spot_hash:c}).done(function(){handle_alert({success:"Message Successfully Sent"})}).fail(function(){handle_alert({error:"Failed to send, please try again."})})}function openLoginModal(a,b){var c=window!=window.parent;if(c)return void $("#embededModal").modal("toggle");logAction("open-login-modal",{queryParams:a,redirectURI:b});var d="/auth/twitter",e="/auth/linkedin",f="/auth/facebook";if(a){var g=check_auth();if("false"!=g)return window.location.href=b,!1;d=create_url(d,a),e=create_url(e,a),f=create_url(f,a)}$("#loginmodal a.twitter_login").attr("href",d),$("#loginmodal a.linkedin_login").attr("href",e),$("#loginmodal a.facebook_login").attr("href",f),$("#loginmodal").modal("toggle")}function initEmbdededContent(a){a&&YT&&$(a).find(".pExtCon a").each(function(a,b){var c=$(b).attr("href");if(c.match(youtubePatt)){var d=c.split("v=");contentID=d[1].split("&")[0];var e=$(b).closest(".pExtCon")[0];if($(e).closest(".extCnPrw").length)return void console.log("draft element?");if($(e).closest(".reply").length)return;if($(e).closest(".comment").length)return;var f=+$(e).width();f=f>640?640:f;{var g=.609375*f;new YT.Player(e,{height:g,width:f,videoId:contentID,playerVars:{wmode:"transparent"},events:{onStateChange:function(a){a.data==YT.PlayerState.PLAYING?(postPaused=!0,commentPaused=!0):resumeCommentVotes(),logAction("video",{video_id:contentID,state:a.data})}}})}}})}function scrollToVisibility(a,b,c,d){var e=$(a)[0];if(b||(b=100),e){e=$(e);var f=e.offset().top;$("html,body").animate({scrollTop:f-b},400,function(){if(c){e.finish();var a=e.css("backgroundColor");e.css("backgroundColor","#ffffca").animate({backgroundColor:a},2500)}})}return d&&$("button.navbar-toggle").is(":visible")&&$("#pageNav").collapse("hide"),!1}function parse_tweet(a){return a=twttr.txt.autoLinkEntities(a,twttr.txt.extractEntitiesWithIndices(a,{extractUrlsWithoutProtocol:!0}),{usernameIncludeSymbol:!0})}function loadPreview(a,b,c,d,e){var f=$("<div class='tweet' id='"+a+"'/>"),g=$("<div class='"+d+"'/>");g.append('<div class="pExtConThumb">'+c+"</div>");var h=stripHTML(b.title),h=h.length>150?h.substring(0,150)+"...":h,i=stripHTML(b.description);i=parse_tweet(i.length>250?i.substring(0,250)+"...":i);var j=$("<a target='_blank' href='"+b.href+"'/>");j.text(h);var k=$("<div class='pExtDetail'/>");k.html(i),k.prepend($("<br>")),k.prepend(j),g.append(k),f.append(g),e(null,f,b)}function processPreview(a,b,c){var d="",e="pExtCon",f=b.media&&b.media.length,g=f&&"photo"==b.media[0].type,h=g&&"/images/document_icon.png"!=b.media[0].src,i=a.match(youtubePatt)||h;if(!i&&b.description&&b.description.length<50)return void c("Desc is less than 50 chars",null,null);if(f)if(b.media[0].src){$("#testImage").attr("src",""),$("#testImage").error(function(){d="<img src='/images/document_icon.png'/>",loadPreview(a,b,d,e,c)}).attr("src",b.media[0].src),$("#testImage").off("load").load(function(){h&&(e="pExtConBig"),d="<img src='"+b.media[0].src+"'/>",loadPreview(a,b,d,e,c)})}else d="<img src='/images/document_icon.png'/>",loadPreview(a,b,d,e,c)}function getExtContentPreview(a,b){return a==lastURL?void processPreview(a,linkPreview,b):(lastURL=a,void $.ajax({url:"/url/preview",type:"GET",data:{url:a},dataType:"json",success:function(c){c.err||(linkPreview=c.preview,processPreview(a,linkPreview,b))}}).fail(function(a,c,d){b(d,null,null)}))}function sortDropDown(a){$("#"+a+" optgroup").each(function(){var a=$(this),b=a.children().toArray().sort(function(a,b){return $(a).text()<$(b).text()?1:-1});$.each(b,function(b,c){a.prepend(c)})})}function stripHTML(a){return $("<div>").html(a).text()}function loadChatUrlPreview(){var a=$("div.ext-url a").attr("href");if(a){if("true"==$("div.ext-url .external_content").attr("data-initialized"))return;getExtContentPreview(a,function(a,b){if(b){if("true"==$("div.ext-url .external_content").attr("data-initialized"))return void console.log("already initialized");$("div.ext-url .external_content").html(""),$("div.ext-url .external_content").append(b),initEmbdededContent("div.ext-url"),$("div.ext-url .external_content").attr("data-initialized","true")}})}}function showEditChatTab(a){$("#"+a).siblings().removeClass("active"),$("#"+a).addClass("active")}function dismissEditDialog(a,b){$("#edit_spot_modal").modal("hide"),a&&(window.location.href=b?b:window.location.href)}function logAction(a,b){$.post("/log/"+a,b||{})}function updateTimestamps(){$("#posts a.timestamp").each(function(a,b){var c=$(b);c.html(moment(+c.attr("timestamp")).fromNow())})}function updateChatCardTimestamps(){$("a.spot .datetime").each(function(a,b){var c=$(b),d=+c.attr("data-start"),e=+c.attr("data-end"),f=c.attr("data-period");f&&"indefinite"==f&&e>new Date?(date=moment(d).fromNow(),c.html("started "+date)):e<new Date?(date=moment(e).fromNow(),c.html("ended "+date)):d<new Date?(date=moment(e).fromNow(),c.html("ends "+date)):(date=moment(d).fromNow(),c.html("starts "+date))})}function logCreateTabChange(){$('a[data-toggle="tab"]').on("show.bs.tab",function(a){var b=$(a.target).attr("href");b&&logAction(b.split("#")[1])})}function selectEmbedCode(){setTimeout(function(){$("textarea#embedCode").select().focus()},500)}function followChat(a,b,c){return $.post("/"+b,{operation:"follow_chat",id:a,hash:b}).done(function(a){"success"==a?($(c).hide(),$(c).siblings(".unfollowChat").show()):handle_alert({error:"Could not reach server, please try again."})}).fail(function(){handle_alert({error:"Could not reach server, please try again."})}),!1}function unFollowChat(a,b,c){return $.post("/"+b,{operation:"unfollow_chat",id:a,hash:b}).done(function(a){"success"==a?($(c).hide(),$(c).siblings(".followChat").show()):handle_alert({error:"Could not reach server, please try again."})}).fail(function(){handle_alert({error:"Could not reach server, please try again."})}),!1}function initFollowUnfollow(){$("button.unfollowChat").on("click",function(a){if("false"==check_auth())return openLoginModal(),!1;var b=$(a.target),c=$(b).attr("data-id"),d=$(b).attr("data-hash");return unFollowChat(c,d,b),!1}),$("button.followChat").on("click",function(a){if("false"==check_auth())return openLoginModal(),!1;var b=$(a.target),c=$(b).attr("data-id"),d=$(b).attr("data-hash");return followChat(c,d,b),!1}),$("button.unfollowChat").on("mouseenter").mouseenter(function(){$(this).html("&nbsp;Unfollow&nbsp;")}),$("button.unfollowChat").on("mouseleave").mouseleave(function(){$(this).html("Following")})}function openSocialSettings(){check_permissions("test"),clear_modal("socialModal"),$("#socialModal").modal("toggle"),$.get("/user/social-settings",function(a){$("#socialModal .modal-body").html(a),$("a.handle").tooltip({container:".hndl-ttl"})}).error(function(a){console.error(a)})}function initSearchBar(){if(!searchBarInitialized){searchBarInitialized=!0;var a=new Bloodhound({datumTokenizer:function(a){return Bloodhound.tokenizers.whitespace(a.h)},queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{ttl:6e4,url:"/api/hash.json",filter:function(a){return $.map(a,function(a){return{h:a}})}}});a.initialize(),$("input.typeahead").typeahead(null,{displayKey:"h",source:a.ttAdapter()});var b=function(){$("input.typeahead")[0].form.submit()};$("input.typeahead").on("typeahead:selected",b);var c=window!=window.parent;c||setTimeout(function(){$('input[name="q"]').focus()},100)}}function createCookie(a,b,c){var d;if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toGMTString()}else d="";document.cookie=a+"="+b+d+"; path=/"}function getCookie(a){return document.cookie.length>0&&(c_start=document.cookie.indexOf(a+"="),-1!=c_start)?(c_start=c_start+a.length+1,c_end=document.cookie.indexOf(";",c_start),-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):""}function getBetaInvite(){var a=$.ajax({type:"POST",async:!1,url:"/user/perm",data:{perm:"/admin/setupspot"}});return"true"==a.responseText?(handle_alert({warning:"You already have beta permissions!<br/>Redirecting you to create chat..."}),window.setTimeout(function(){window.location.href="/#create-chat"},3e3)):open_beta_modal("Free-host",!0),!1}function imgError(a){return a&&(a.onerror="",a.src="/img/Unknown-person.gif"),!0}function featureTourLive(){$.get("/get/popularlivechat",function(a){return a&&a.hash?($("#help_modal").modal("hide"),$("#siteIntroGoToLive").modal("hide"),void(window.location.pathname==="/"+a.hash?$("#siteIntro").modal("show"):window.location.href=$("#server").val().toLowerCase()+"/"+a.hash+"#show-tour")):(handle_alert({warning:"There are no live chats right now. Try back later."}),$("#help_modal").modal("hide"),$("#siteIntroGoToLive").modal("hide"),void 0)})}var last_e=-1,last_e2=-1,tagsPage=0,chatsPage=0,youtubePatt=/http.*www.youtube.com\/watch.*$/i,lastPage="first",loadingChats=!1;$(document).ready(function(){$.h5Validate&&$("form").h5Validate({focusout:!1});var a=$("#launch_new_user").val();"true"==a&&clientcode.queueMessage("newUser",function(){$("#new_user_modal").modal({show:"true",backdrop:"static"})});var b=$("#rememberPrivate").val();"true"==b&&$("#rememberModal").appendTo("body").modal("toggle");var c=$("#alert_sign_in_fail").val();"true"==c&&wide_alert("Sign in failed.");var d=$("#alert_email").val();if("true"==d&&wide_alert("Your previous email address has not been verified."),$("#terms_modal").on("hide",function(a){a.target==this&&$("#new_user_modal").modal({show:"true",backdrop:"static"})}),$("#edit_spot_modal").on("hidden.bs.modal",function(){$("iframe#spot_edit").attr("src","about:blank")}),"true"==$("#beta_request_successful").val()&&handle_alert("Successfuly Submitted Beta Request"),window.location.hash&&"#_=_"==window.location.hash)if(window.history&&history.pushState)window.history.pushState("",document.title,window.location.pathname);else{var e={top:document.body.scrollTop,left:document.body.scrollLeft};window.location.hash="",document.body.scrollTop=e.top,document.body.scrollLeft=e.left}window.onscroll=function(){window.pageYOffset>800?$("a#back-to-top").show():$("a#back-to-top").hide()},navigator.browser_string=function(){var a,b=navigator.userAgent,c=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];return/trident/i.test(c[1])?(a=/\brv[ :]+(\d+(\.\d+)?)/g.exec(b)||[],"IE "+(a[1]||"")):(c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(a=b.match(/version\/([\.\d]+)/i))&&(c[2]=a[1]),c.join(" "))}();var f=navigator.browser_string.split(" ");
navigator.browser_name=f[0],navigator.browser_version=parseInt(f[1]),flashBrowserUnsupported(),$('input[name="q"]').focusin(function(){initSearchBar()});var g=window!=window.parent;g||$('input[name="q"]').focus(),$("#onlyChat").click(function(){$("#ext-link-title-div").show(),$("#ext-link-div").find("label").text("Link to article"),$("#ext-link-div").find("input#ext_url").attr("placeholder","Any website or blog link"),$("#ext_url_optional").show()}),$("#withVideo").click(function(){$("#ext-link-title-div").hide(),$("#ext-link-title-div").val("Pop out video"),$("#ext-link-div").find("label").text("Link to video"),$("#ext-link-div").find("input#ext_url").attr("placeholder","Link to LIVE or recorded YouTube"),$("#ext_url_optional").hide()})}),$(window).on("unload",function(){("false"==$("#new_user_modal").attr("aria-hidden")||"false"==$("#terms_modal").attr("aria-hidden"))&&$.ajax({type:"POST",async:!1,url:"/monitoring/cancel",data:{user_agent:navigator.userAgent,action:"Exited Modal"}})});var labelCountId=0,privateHash="",privateURL="",betaClickType="",lastURL="",linkPreview="",searchBarInitialized=!1;$.fn.serializeObject=function(){var a={},b=this.serializeArray();return $.each(b,function(){void 0!==a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):a[this.name]=this.value||""}),a};