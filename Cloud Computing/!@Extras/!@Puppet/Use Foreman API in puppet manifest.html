<!DOCTYPE html>
<!-- saved from url=(0068)http://maxoberberger.net/blog/2014/12/use-foreman-api-in-puppet.html -->
<html lang="en" class="js flexbox canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="">

  <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
       Remove this if you use the .htaccess -->
  <meta http-equiv="X-UA-Compatible" content="">

  <!-- encoding must be specified within the first 512 bytes
        www.whatwg.org/specs/web-apps/current-work/multipage/semantics.html#charset -->

  <!-- meta element for compatibility mode needs to be before
        all elements except title & meta
        msdn.microsoft.com/en-us/library/cc288325(VS.85).aspx -->
  <!-- Chrome Frame is only invoked if meta element for
        compatibility mode is within the first 1K bytes
        code.google.com/p/chromium/issues/detail?id=23003 -->

  <title>Use Foreman API in puppet manifest</title>
  <meta name="description" content="">
  <meta name="author" content="Max Oberberger">

  <!--  Mobile viewport optimized: j.mp/bplateviewport -->
  <meta name="viewport" content="">

    <!-- Place favicon.ico & apple-touch-icon.png
        in the root of your domain and delete these references -->
  <link rel="shortcut icon" href="http://maxoberberger.net/media/favicon.ico">
  
    <link rel="stylesheet" href="http://maxoberberger.net/media/css/site.css">
  <link rel="stylesheet" href="http://maxoberberger.net/media/css/syntax.css">
  <link rel="stylesheet" href="http://maxoberberger.net/media/css/obx.css">
  
    <!-- All JavaScript at the bottom, except for Modernizr which
        enables HTML5 elements & feature detects -->
    <script id="twitter-wjs" src="./Use Foreman API in puppet manifest_files/widgets.js"></script><script type="text/javascript" defer="" async="" src="./Use Foreman API in puppet manifest_files/piwik.js"></script><script type="text/javascript" async="" src="./Use Foreman API in puppet manifest_files/load.js"></script><script src="./Use Foreman API in puppet manifest_files/modernizr-1.7.min.js"></script>
    <script type="text/javascript">
        /* <![CDATA[ */
        (function() {
        var s = document.createElement('script');
        var t = document.getElementsByTagName('script')[0];

        s.type = 'text/javascript';
        s.async = true;
        s.src = '//api.flattr.com/js/0.6/load.js?mode=auto';

        t.parentNode.insertBefore(s, t);
        })();
        /* ]]> */
    </script>
    <!-- Piwik -->
    <script type="text/javascript"> 
      var _paq = _paq || [];
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
          var u=(("https:" == document.location.protocol) ? "https" : "http") + "://piwik.karoec.de//";
          _paq.push(['setTrackerUrl', u+'piwik.php']);
          _paq.push(['setSiteId', 3]);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.type='text/javascript';
          g.defer=true; g.async=true;
          g.src=u+'piwik.js';
          s.parentNode.insertBefore(g,s);
      })();

    </script>
    <style type="text/css"></style><script type="text/javascript" async="" src="./Use Foreman API in puppet manifest_files/embed.js"></script><style type="text/css">.fancybox-margin{margin-right:0px;}</style></head>
<body id="use-foreman-api-in-puppet" data-twttr-rendered="true" data-gclp-initialized="true" data-gistbox-initialized="true">
        <!-- github ribbon -->
        <a href="https://github.com/chiemseesurfer"><img style="position:
            absolute; margin-top: 30px; top: 0;
        left: 0; border: 0;" src="./Use Foreman API in puppet manifest_files/forkme_left_darkblue_121621.png" alt="Fork me on GitHub"></a>
    <div id="container">
            <div id="main" role="main">
          <header class="banner clearfix">
          <h1>max oberberger</h1>                              <nav class="main_nav">
    <ul>
                <li>
            <a title="Home Page" class="" href="http://maxoberberger.net/index.html">
                Home
            </a>
        </li>
        <li>
        -
        </li>        <li>
            <a title="Blog" class="" href="http://maxoberberger.net/blog">
                Blog
            </a>
        </li>
        <li>
        -
        </li>        <li>
            <a title="Projects" class="" href="http://maxoberberger.net/projects">
                Projects
            </a>
        </li>
        <li>
        -
        </li>        <li>
            <a title="About" class="" href="http://maxoberberger.net/about.html">
                About
            </a>
        </li>
        <li>
        -
        </li>        <li>
            <a title="" class="" href="http://feeds.feedburner.com/maxoberberger">
                Feed
            </a>
        </li>
            </ul>
</nav>
                    </header>
            <div class="hr">&nbsp;</div>
          <section class="content">
          <article class="post">
<nav class="post_nav">
<a class="backlink" href="http://maxoberberger.net/blog">Back to list</a>
<a class="prev" title="My configuration of Google Nexus 5" href="http://maxoberberger.net/blog/2015/01/configuration-of-nexus5.html">
    Previous
</a>

<a class="next" title="Change puppet environment in foreman" href="http://maxoberberger.net/blog/2014/09/change-puppet-environment-in-foreman.html">
    Next
</a>

<br>
<div id="twitter_share">
<iframe id="twitter-widget-0" scrolling="no" frameborder="0" allowtransparency="true" src="./Use Foreman API in puppet manifest_files/tweet_button.62da0a34306f5c17db7d290755ed1d7d.en.html" class="twitter-share-button twitter-tweet-button twitter-share-button twitter-count-vertical" title="Twitter Tweet Button" data-twttr-rendered="true" style="width: 55px; height: 62px;"></iframe>
    <script type="text/javascript" src="./Use Foreman API in puppet manifest_files/widgets.js"></script>
</div>
            <div class="flattr">
            <iframe src="./Use Foreman API in puppet manifest_files/saved_resource.html" class="FlattrButton" width="55" height="62" frameborder="0" scrolling="no" title="Flattr" border="0" marginheight="0" marginwidth="0" allowtransparency="true"></iframe>
        </div>

    <div id="facebook_like">
<iframe src="./Use Foreman API in puppet manifest_files/like.html" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:450px; height:65px;" allowtransparency="true"></iframe>
</div>
</nav>
<h1 class="title">
    <a href="./Use Foreman API in puppet manifest_files/Use Foreman API in puppet manifest.html">
        Use Foreman API in puppet manifest
    </a>
</h1>
<time datetime="2014-12-30">
    Posted: Tue, 30 Dec 2014
</time>

<ul class="tags clear">
<li>
    <a class="small" href="http://maxoberberger.net/blog/tags/foreman.html">
        foreman
    </a>
</li>
<li>
    <a class="small" href="http://maxoberberger.net/blog/tags/puppet.html">
        puppet
    </a>
</li>
</ul>
<p>At work we use foreman for system installation and environment management.
Sometimes it is necessary to get a list of hosts with a specific
puppet class installed. In puppet itself it is not really easy to get the
result, because you need to configure and setup your own exported resources to
do that.
Foreman itself has a much easier way. Its own puppet <a href="https://github.com/theforeman/puppet-foreman/blob/master/lib/puppet/parser/functions/foreman.rb">foreman
function</a> from <a href="https://github.com/theforeman/foreman-installer">Foreman Puppet
modules</a>.</p>
<p>Now it is quite easy to get hosts according their puppet&nbsp;classes:</p>
<pre class="codehilite" data-initialized="true" data-gclp-id="0"><code>
    $hosts = foreman({item =&gt; 'hosts', search =&gt; "class=exampleClass and domain=${domain}", foreman_url =&gt; "http://${foreman}"})
</code></pre>

<p>The variable hosts then looks&nbsp;like:</p>
<pre class="codehilite" data-initialized="true" data-gclp-id="1"><code>
    {"hostA":{"name": "XXXX", ... }, "hostB": {"name": "YYYY", ....} }
</code></pre>

<p>Now you have a dict of hosts and can iterate over it in your template like in the following&nbsp;example:</p>
<pre class="codehilite" data-initialized="true" data-gclp-id="2"><code>
    &lt;%=
    @hosts.each do |key|
      key["host"]["name"]
    end
    %&gt;
</code></pre></article>
 <div id="disqus_thread"><iframe id="dsq-2" data-disqus-uid="2" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./Use Foreman API in puppet manifest_files/saved_resource(1).html" style="width: 100% !important; border: none !important; overflow: hidden !important; height: 644px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'maxoberberger'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the &lt;a href="http://disqus.com/?ref_noscript"&gt;comments powered by Disqus.&lt;/a&gt;</noscript>
              </section>
      </div>
                <div class="hrb">&nbsp;</div>
  </div> <!--! end of #container -->
  <footer>
                <p>
                <iframe id="twitter-widget-1" scrolling="no" frameborder="0" allowtransparency="true" src="./Use Foreman API in puppet manifest_files/follow_button.a5bbbb7216610af1306d56b0f28a67d7.de.html" class="twitter-follow-button twitter-follow-button" title="Twitter Follow Button" data-twttr-rendered="true" style="width: 153px; height: 20px;"></iframe>
                <script>!function(d,s,id){var
                js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document,
                'script', 'twitter-wjs');</script>
                </p>
                <p>Copyright © 2012-2015 Max Oberberger - <a href="http://maxoberberger.net/impressum/">Impressum</a> - <a href="http://maxoberberger.net/privacy/">Privacy</a></p>
  </footer>
      <!-- Javascript at the bottom for fast page loading -->
    <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if necessary -->
  <script src="./Use Foreman API in puppet manifest_files/jquery.js"></script>
  <script>window.jQuery || document.write('<script src="js/libs/jquery-1.5.1.min.js">\x3C/script>')</script>
  
    

  <!--[if lt IE 7 ]>
    <script src="js/libs/dd_belatedpng.js"></script>
    <script>DD_belatedPNG.fix('img, .png_bg'); // Fix any <img> or .png_bg bg-images. Also, please read goo.gl/mZiyb </script>
  <![endif]-->

      
  
<iframe frameborder="0" scrolling="no" style="border: 0px; display: none; background-color: transparent;"></iframe><div id="GOOGLE_INPUT_CHEXT_FLAG" style="display: none;" input="null" input_stat="{&quot;tlang&quot;:true,&quot;tsbc&quot;:true,&quot;pun&quot;:true,&quot;mk&quot;:false,&quot;ss&quot;:true}"></div><form id="gclp-frame-form" target="gclp-frame" method="post" style="display: none;"></form><div class="gclp-code-grabber" data-gclp-id="0" data-hasqtip="true" style="left: 938.5px; top: 320px; display: none;"></div><div class="gclp-code-grabber" data-gclp-id="1" data-hasqtip="true" style="left: 786.5px; top: 424px; display: none;"></div><div class="gclp-code-grabber" data-gclp-id="2" data-hasqtip="true" style="left: 531.5px; top: 517px; display: none;"></div></body></html>