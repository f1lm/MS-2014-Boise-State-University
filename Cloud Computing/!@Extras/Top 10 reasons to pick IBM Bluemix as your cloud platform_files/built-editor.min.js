/*

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation
 Mihai Sucan (Mozilla Foundation) - fix for Bug#334583 Bug#348471 Bug#349485 Bug#350595 Bug#360726 Bug#361180 Bug#362835 Bug#362428 Bug#362286 Bug#354270 Bug#361474 Bug#363945 Bug#366312 Bug#370584

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
 Felipe Heidrich (IBM Corporation) - initial API and implementation
 Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2009, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 Copyright (c) 2012 VMware, Inc.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation
 Andrew Eisenberg - rename to jsTemplateContentAssist.js

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation
 Alex Lakatos - fix for bug#369781

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation
 RequireJS i18n 2.0.2 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/requirejs/i18n for details

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
 IBM Corporation - initial API and implementation
*/
var requirejs,require,define;
(function(l){function o(a,b){var d,k,t,x,c,e,m,h,f,g=b&&b.split("/"),j=p.map,r=j&&j["*"]||{};if(a&&a.charAt(0)===".")if(b){g=g.slice(0,g.length-1);a=g.concat(a.split("/"));for(h=0;h<a.length;h+=1)if(d=a[h],d===".")a.splice(h,1),h-=1;else if(d==="..")if(h===1&&(a[2]===".."||a[0]===".."))break;else h>0&&(a.splice(h-1,2),h-=2);a=a.join("/")}else a.indexOf("./")===0&&(a=a.substring(2));if((g||r)&&j){d=a.split("/");for(h=d.length;h>0;h-=1){k=d.slice(0,h).join("/");if(g)for(f=g.length;f>0;f-=1)if(t=j[g.slice(0,
f).join("/")])if(t=t[k]){x=t;c=h;break}if(x)break;!e&&r&&r[k]&&(e=r[k],m=h)}!x&&e&&(x=e,c=m);x&&(d.splice(0,c,x),a=d.join("/"))}return a}function n(a,d){return function(){return b.apply(l,q.call(arguments,0).concat([a,d]))}}function i(a){return function(b){return o(b,a)}}function c(a){return function(b){m[a]=b}}function f(a){if(r.call(h,a)){var b=h[a];delete h[a];s[a]=!0;j.apply(l,b)}if(!r.call(m,a)&&!r.call(s,a))throw Error("No "+a);return m[a]}function e(a){var b,d=a?a.indexOf("!"):-1;d>-1&&(b=
a.substring(0,d),a=a.substring(d+1,a.length));return[b,a]}function g(a){return function(){return p&&p.config&&p.config[a]||{}}}var j,b,a,d,m={},h={},p={},s={},r=Object.prototype.hasOwnProperty,q=[].slice;a=function(a,b){var d,k=e(a),t=k[0],a=k[1];t&&(t=o(t,b),d=f(t));t?a=d&&d.normalize?d.normalize(a,i(b)):o(a,b):(a=o(a,b),k=e(a),t=k[0],a=k[1],t&&(d=f(t)));return{f:t?t+"!"+a:a,n:a,pr:t,p:d}};d={require:function(a){return n(a)},exports:function(a){var b=m[a];return typeof b!=="undefined"?b:m[a]={}},
module:function(a){return{id:a,uri:"",exports:m[a],config:g(a)}}};j=function(b,e,g,k){var t,x,B,y,D=[],p,k=k||b;if(typeof g==="function"){e=!e.length&&g.length?["require","exports","module"]:e;for(y=0;y<e.length;y+=1)if(B=a(e[y],k),x=B.f,x==="require")D[y]=d.require(b);else if(x==="exports")D[y]=d.exports(b),p=!0;else if(x==="module")t=D[y]=d.module(b);else if(r.call(m,x)||r.call(h,x)||r.call(s,x))D[y]=f(x);else if(B.p)B.p.load(B.n,n(k,!0),c(x),{}),D[y]=m[x];else throw Error(b+" missing "+x);e=g.apply(m[b],
D);if(b)if(t&&t.exports!==l&&t.exports!==m[b])m[b]=t.exports;else if(e!==l||!p)m[b]=e}else b&&(m[b]=g)};requirejs=require=b=function(c,e,m,k,t){if(typeof c==="string")return d[c]?d[c](e):f(a(c,e).f);else c.splice||(p=c,e.splice?(c=e,e=m,m=null):c=l);e=e||function(){};typeof m==="function"&&(m=k,k=t);k?j(l,c,e,m):setTimeout(function(){j(l,c,e,m)},4);return b};b.config=function(a){p=a;return b};define=function(a,b,d){b.splice||(d=b,b=[]);!r.call(m,a)&&!r.call(h,a)&&(h[a]=[a,b,d])};define.amd={jQuery:!0}})();
define("almond",function(){});
define("orion/editor/shim",[],function(){if(!Object.create)Object.create=function(l,o){function n(){}n.prototype=l;var i=new n;if(o)for(var c in o)o.hasOwnProperty(c)&&(i[c]=o[c].hasOwnProperty("value")?o[c].value:function(){if(arguments.length>0)return o[c].get();else o[c].set(arguments)});return i};if(!Object.keys)Object.keys=function(l){var o=[],n;for(n in l)l.hasOwnProperty(n)&&o.push(n);return o};if(!Function.prototype.bind)Function.prototype.bind=function(l){var o=this,n=Array.prototype.slice.call(arguments,
1);return n.length?function(){return arguments.length?o.apply(l,n.concat(Array.prototype.slice.call(arguments))):o.apply(l,n)}:function(){return arguments.length?o.apply(l,arguments):o.call(l)}};if(!Array.isArray)Array.isArray=function(l){return Object.prototype.toString.call(l)==="[object Array]"};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(l){for(var o=0;o<this.length;o++)if(this[o]===l)return o;return-1};if(!Array.prototype.forEach)Array.prototype.forEach=function(l){for(var o=
0;o<this.length;o++)l(this[o],o)};if(!Array.prototype.map)Array.prototype.map=function(l){for(var o=Array(this.length),n=0;n<this.length;n++)o[n]=l(this[n]);return o};if(!Array.prototype.reduce)Array.prototype.reduce=function(l,o){var n,i=!1;1<arguments.length&&(n=o,i=!0);for(var c=0;this.length>c;++c)i?n=l(n,this[c],c,this):(n=this[c],i=!0);return n};if(!String.prototype.trim)String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};if(!String.prototype.trimLeft)String.prototype.trimLeft=
function(){return this.replace(/^\s+/g,"")};if(!String.prototype.trimRight)String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")};return{}});
(function(){function l(c,f,e,g,j,b){f[c]&&(e.push(c),(f[c]===!0||f[c]===1)&&g.push(j+c+"/"+b))}function o(c,f,e,g,j){f=g+f+"/"+j;require._fileExists(c.toUrl(f+".js"))&&e.push(f)}function n(c,f,e){for(var g in f)f.hasOwnProperty(g)&&(!c.hasOwnProperty(g)||e)?c[g]=f[g]:typeof f[g]==="object"&&n(c[g],f[g],e)}var i=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(c){var f=c.config?c.config():{};return{version:"2.0.1+",load:function(c,g,j,b){b=b||{};if(b.locale)f.locale=b.locale;
var a=i.exec(c),d=a[1],m=a[4],h=a[5],p=m.split("-"),s=[],r={},q,u="";if(a[5])d=a[1],c=d+h;else{h=a[4];m=f.locale;if(!m)m=f.locale=typeof navigator==="undefined"?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase();p=m.split("-")}if(b.isBuild){s.push(c);o(g,"root",s,d,h);for(q=0;q<p.length;q++)b=p[q],u+=(u?"-":"")+b,o(g,u,s,d,h);g(s,function(){j()})}else g([c],function(a){var b=[],k;l("root",a,b,s,d,h);for(q=0;q<p.length;q++)k=p[q],u+=(u?"-":"")+k,l(u,a,b,s,d,h);g(s,function(){var k,
x,c;for(k=b.length-1;k>-1&&b[k];k--){c=b[k];x=a[c];if(x===!0||x===1)x=g(d+c+"/"+h);n(r,x)}j(r)})})}}})})();define("orion/editor/i18n",{load:function(l,o,n){o.specified&&o.specified("orion/bootstrap")?o(["orion/i18n!"+l],function(i){n(i)}):n({})}});
define("orion/editor/nls/root/messages",{multipleAnnotations:"Multiple annotations:",line:"Line: ${0}",breakpoint:"Breakpoint",bookmark:"Bookmark",task:"Task",error:"Error",warning:"Warning",matchingSearch:"Matching Search",currentSearch:"Current Search",currentLine:"Current Line",matchingBracket:"Matching Bracket",currentBracket:"Current Bracket",lineUp:"Line Up",lineDown:"Line Down",lineStart:"Line Start",lineEnd:"Line End",charPrevious:"Previous Character",charNext:"Next Character",pageUp:"Page Up",
pageDown:"Page Down",scrollPageUp:"Scroll Page Up",scrollPageDown:"Scroll Page Down",scrollLineUp:"Scroll Line Up",scrollLineDown:"Scroll Line Down",wordPrevious:"Previous Word",wordNext:"Next Word",textStart:"Document Start",textEnd:"Document End",scrollTextStart:"Scroll Document Start",scrollTextEnd:"Scroll Document End",centerLine:"Center Line",selectLineUp:"Select Line Up",selectLineDown:"Select Line Down",selectWholeLineUp:" Select Whole Line Up",selectWholeLineDown:"Select Whole Line Down",
selectLineStart:"Select Line Start",selectLineEnd:"Select Line End",selectCharPrevious:"Select Previous Character",selectCharNext:"Select Next Character",selectPageUp:"Select Page Up",selectPageDown:"Select Page Down",selectWordPrevious:"Select Previous Word",selectWordNext:"Select Next Word",selectTextStart:"Select Document Start",selectTextEnd:"Select Document End",deletePrevious:"Delete Previous Character",deleteNext:"Delete Next Character",deleteWordPrevious:"Delete Previous Word",deleteWordNext:"Delete Next Word",
deleteLineStart:"Delete Line Start",deleteLineEnd:"Delete Line End",tab:"Insert Tab",enter:"Insert Line Delimiter",enterNoCursor:"Insert Line Delimiter",selectAll:"Select All",copy:"Copy",cut:"Cut",paste:"Paste",uppercase:"To Upper Case",lowercase:"To Lower Case",capitalize:"Capitalize",reversecase:"Reverse Case",toggleWrapMode:"Toggle Wrap Mode",toggleTabMode:"Toggle Tab Mode",toggleOverwriteMode:"Toggle Overwrite Mode",committerOnTime:"${0} on ${1}",emacs:"Emacs",exchangeMarkPoint:"Exchange Mark and Point",
setMarkCommand:"Set Mark",clearMark:"Clear Mark",digitArgument:"Digit Argument ${0}",negativeArgument:"Negative Argument",Comment:"Comment","Flat outline":"Flat outline",incrementalFindStr:"Incremental find: ${0}",incrementalFindStrNotFound:"Incremental find: ${0} (not found)",incrementalFindReverseStr:"Reverse Incremental find: ${0}",incrementalFindReverseStrNotFound:"Reverse Incremental find: ${0} (not found)",find:"Find...",undo:"Undo",redo:"Redo",cancelMode:"Cancel Current Mode",findNext:"Find Next Occurrence",
findPrevious:"Find Previous Occurrence",incrementalFind:"Incremental Find",incrementalFindReverse:"Incremental Find Reverse",indentLines:"Indent Lines",unindentLines:"Unindent Lines",moveLinesUp:"Move Lines Up",moveLinesDown:"Move Lines Down",copyLinesUp:"Copy Lines Up",copyLinesDown:"Copy Lines Down",deleteLines:"Delete Lines",gotoLine:"Goto Line...",gotoLinePrompty:"Goto Line:",nextAnnotation:"Next Annotation",prevAnnotation:"Previous Annotation",expand:"Expand",collapse:"Collapse",expandAll:"Expand All",
collapseAll:"Collapse All",lastEdit:"Last Edit Location",trimTrailingWhitespaces:"Trim Trailing Whitespaces",toggleLineComment:"Toggle Line Comment",addBlockComment:"Add Block Comment",removeBlockComment:"Remove Block Comment",linkedModeEntered:"Linked Mode entered",linkedModeExited:"Linked Mode exited",syntaxError:"Syntax Error",contentAssist:"Content Assist",lineColumn:"Line ${0} : Col ${1}",vi:"vi",vimove:"(Move)",viyank:"(Yank)",videlete:"(Delete)",vichange:"(Change)",viLeft:"${0} Left",viRight:"${0} Right",
viUp:"${0} Up",viDown:"${0} Down",viw:"${0} Next Word",vib:"${0} Beginning of Word",viW:"${0} Next Word (ws stop)",viB:"${0} Beginning of Word (ws stop)",vie:"${0} End of Word",viE:"${0} End of Word (ws stop)",vi$:"${0} End of the line","vi^_":"${0} First non-blank Char Current Line","vi+":"${0} First Char Next Line","vi-":"${0} First Char Previous Line","vi|":"${0} nth Column in Line",viH:"${0} Top of Page",viM:"${0} Middle of Page",viL:"${0} Bottom of Page","vi/":"${0} Search Forward","vi?":"${0} Search Backward",
vin:"${0} Next Search",viN:"${0} Previous Search",vif:"${0} Search Char Fwd",viF:"${0} Search Char Bckwd",vit:"${0} Search Before Char Fwd",viT:"${0} Search Before Char Bckwd","vi,":"${0} Repeat Reverse Char Search","vi;":"${0} Repeat Char Search",viG:"${0} Go to Line",viycd:"${0} Current Line",via:"Append After Cursor",viA:"Append to End of Line",vii:"Insert Before Cursor",viI:"Insert at Beginning of Line",viO:"Insert Line Above",vio:"Insert Line Below",viR:"Begin Overwriting Text",vis:"Substitute a Character",
viS:"Substitute Entire Line",viC:"Change Text Until Line End",vip:"Paste After Char or Line",viP:"Paste Before Char or Line",viStar:"Search Word Under Cursor",replaceAll:"Replacing all...",replacedMatches:"Replaced ${0} matches",nothingReplaced:"Nothing replaced",notFound:"Not found"});
define("orion/editor/nls/messages",["orion/editor/i18n!orion/editor/nls/messages","orion/editor/nls/root/messages"],function(l,o){var n={root:o},i;for(i in l)l.hasOwnProperty(i)&&typeof n[i]==="undefined"&&(n[i]=l[i]);return n});
define("orion/editor/eventTarget",[],function(){function l(){}l.addMixin=function(o){var n=l.prototype,i;for(i in n)n.hasOwnProperty(i)&&(o[i]=n[i])};l.prototype={addEventListener:function(l,n,i){if(!this._eventTypes)this._eventTypes={};var c=this._eventTypes[l];c||(c=this._eventTypes[l]={level:0,listeners:[]});c.listeners.push({listener:n,useCapture:i})},dispatchEvent:function(l){var n=l.type;this._dispatchEvent("pre"+n,l);this._dispatchEvent(n,l);this._dispatchEvent("post"+n,l)},_dispatchEvent:function(l,
n){var i=this._eventTypes?this._eventTypes[l]:null;if(i){var c=i.listeners;try{if(i.level++,c)for(var f=0,e=c.length;f<e;f++)if(c[f]){var g=c[f].listener;typeof g==="function"?g.call(this,n):g.handleEvent&&typeof g.handleEvent==="function"&&g.handleEvent(n)}}finally{if(i.level--,i.compact&&i.level===0){for(f=c.length-1;f>=0;f--)c[f]||c.splice(f,1);c.length===0&&delete this._eventTypes[l];i.compact=!1}}}},isListening:function(l){return!this._eventTypes?!1:this._eventTypes[l]!==void 0},removeEventListener:function(l,
n,i){if(this._eventTypes){var c=this._eventTypes[l];if(c){for(var f=c.listeners,e=0,g=f.length;e<g;e++){var j=f[e];if(j&&j.listener===n&&j.useCapture===i){c.level!==0?(f[e]=null,c.compact=!0):f.splice(e,1);break}}f.length===0&&delete this._eventTypes[l]}}}};return{EventTarget:l}});define("orion/regex",[],function(){return{escape:function(l){return l.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&")},parse:function(l){return(l=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(l))?{pattern:l[1],flags:l[2]}:null}}});
define("orion/util",[],function(){var l=navigator.userAgent,o=l.indexOf("MSIE")!==-1||l.indexOf("Trident")!==-1?document.documentMode:void 0,n=parseFloat(l.split("Firefox/")[1]||l.split("Minefield/")[1])||void 0,i=l.indexOf("Opera")!==-1?parseFloat(l.split("Version/")[1]):void 0,c=parseFloat(l.split("Chrome/")[1])||void 0,f=l.indexOf("Safari")!==-1&&!c,e=parseFloat(l.split("WebKit/")[1])||void 0,g=l.indexOf("Android")!==-1,j=l.indexOf("iPad")!==-1,l=l.indexOf("iPhone")!==-1,b=j||l,a=navigator.platform.indexOf("Mac")!==
-1,d=navigator.platform.indexOf("Win")!==-1,m=navigator.platform.indexOf("Linux")!==-1;return{formatMessage:function(a){var b=arguments;return a.replace(/\$\{([^\}]+)\}/g,function(a,d){return b[(d<<0)+1]})},createElement:function(a,b){return a.createElementNS?a.createElementNS("http://www.w3.org/1999/xhtml",b):a.createElement(b)},isIE:o,isFirefox:n,isOpera:i,isChrome:c,isSafari:f,isWebkit:e,isAndroid:g,isIPad:j,isIPhone:l,isIOS:b,isMac:a,isWindows:d,isLinux:m,platformDelimiter:d?"\r\n":"\n"}});
define("orion/editor/textModel",["orion/editor/eventTarget","orion/regex","orion/util"],function(l,o,n){function i(c,f){this._lastLineIndex=-1;this._text=[""];this._lineOffsets=[0];this.setText(c);this.setLineDelimiter(f)}i.prototype={find:function(c){if(this._text.length>1)this._text=[this._text.join("")];var f=c.string,e=c.regex,g=f,j="",b=c.caseInsensitive;if(g)if(e){if(f=o.parse(g))g=f.pattern,j=f.flags}else g=f.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&"),b&&(g=g.replace(/[iI\u0130\u0131]/g,
"[Ii\u0130\u0131]"));var a=null,d;if(g){var f=c.reverse,m=c.wrap,e=c.wholeWord,h=c.start||0,c=c.end,p=c!==null&&c!==void 0;j.indexOf("g")===-1&&(j+="g");j.indexOf("m")===-1&&(j+="m");b&&j.indexOf("i")===-1&&(j+="i");e&&(g="\\b"+g+"\\b");var i=this._text[0],r,q,u=0;p&&(b=h<c?h:c,i=i.substring(b,h<c?c:h),u=b);var l=RegExp(g,j);if(f)d=function(){var a=null;for(l.lastIndex=0;;){q=l.lastIndex;r=l.exec(i);if(q===l.lastIndex)return null;if(r){if(!(r.index+u<h)){if(!m||a)break;h=i.length+u}a={start:r.index+
u,end:l.lastIndex+u}}else break}if(a)h=a.start;return a};else{if(!p)l.lastIndex=h;d=function(){for(;;){q=l.lastIndex;r=l.exec(i);if(q===l.lastIndex)break;if(r)return{start:r.index+u,end:l.lastIndex+u};if(!(q!==0&&m))break}return null}}a=d()}return{next:function(){var b=a;b&&(a=d());return b},hasNext:function(){return a!==null}}},getCharCount:function(){for(var c=0,f=0;f<this._text.length;f++)c+=this._text[f].length;return c},getLine:function(c,f){var e=this.getLineCount();if(!(0<=c&&c<e))return null;
var g=this._lineOffsets[c];if(c+1<e){e=this.getText(g,this._lineOffsets[c+1]);if(f)return e;for(var g=e.length,j;(j=e.charCodeAt(g-1))===10||j===13;)g--;return e.substring(0,g)}else return this.getText(g)},getLineAtOffset:function(c){var f=this.getCharCount();if(!(0<=c&&c<=f))return-1;var e=this.getLineCount();if(c===f)return e-1;var g,j,b=this._lastLineIndex;if(0<=b&&b<e&&(g=this._lineOffsets[b],j=b+1<e?this._lineOffsets[b+1]:f,g<=c&&c<j))return b;for(var a=e,d=-1;a-d>1;)if(b=Math.floor((a+d)/2),
g=this._lineOffsets[b],j=b+1<e?this._lineOffsets[b+1]:f,c<=g)a=b;else if(c<j){a=b;break}else d=b;return this._lastLineIndex=a},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},getLineEnd:function(c,f){var e=this.getLineCount();if(!(0<=c&&c<e))return-1;if(c+1<e){e=this._lineOffsets[c+1];if(f)return e;for(var g=this.getText(Math.max(this._lineOffsets[c],e-2),e),j=g.length,b;(b=g.charCodeAt(j-1))===10||b===13;)j--;return e-(g.length-j)}else return this.getCharCount()},
getLineStart:function(c){return!(0<=c&&c<this.getLineCount())?-1:this._lineOffsets[c]},getText:function(c,f){c===void 0&&(c=0);f===void 0&&(f=this.getCharCount());if(c===f)return"";for(var e=0,g=0,j;g<this._text.length;){j=this._text[g].length;if(c<=e+j)break;e+=j;g++}for(var b=e,a=g;g<this._text.length;){j=this._text[g].length;if(f<=e+j)break;e+=j;g++}if(a===g)return this._text[a].substring(c-b,f-e);b=this._text[a].substring(c-b);e=this._text[g].substring(0,f-e);return b+this._text.slice(a+1,g).join("")+
e},onChanging:function(c){return this.dispatchEvent(c)},onChanged:function(c){return this.dispatchEvent(c)},setLineDelimiter:function(c,f){c==="auto"&&(c=void 0,this.getLineCount()>1&&(c=this.getText(this.getLineEnd(0),this.getLineEnd(0,!0))));this._lineDelimiter=c?c:n.platformDelimiter;if(f){var e=this.getLineCount();if(e>1){for(var g=Array(e),j=0;j<e;j++)g[j]=this.getLine(j);this.setText(g.join(this._lineDelimiter))}}},setText:function(c,f,e){c===void 0&&(c="");f===void 0&&(f=0);e===void 0&&(e=
this.getCharCount());if(!(f===e&&c==="")){for(var g=this.getLineAtOffset(f),j=this.getLineAtOffset(e),b=f,a=e-f,d=j-g,m=c.length,h=0,p=this.getLineCount(),i=0,r=0,q=0,u=[];;){i!==-1&&i<=q&&(i=c.indexOf("\r",q));r!==-1&&r<=q&&(r=c.indexOf("\n",q));if(r===-1&&i===-1)break;q=i!==-1&&r!==-1?i+1===r?r+1:(i<r?i:r)+1:i!==-1?i+1:r+1;u.push(f+q);h++}this.onChanging({type:"Changing",text:c,start:b,removedCharCount:a,addedCharCount:m,removedLineCount:d,addedLineCount:h});u.length===0&&(q=this.getLineStart(g),
j=j+1<p?this.getLineStart(j+1):this.getCharCount(),f!==q&&(c=this.getText(q,f)+c,f=q),e!==j&&(c+=this.getText(e,j),e=j));q=m-a;for(j=g+d+1;j<p;j++)this._lineOffsets[j]+=q;if(u.length<5E4)g=[g+1,d].concat(u),Array.prototype.splice.apply(this._lineOffsets,g);else{q=g+1;this._lineOffsets.splice(q,d);for(p=0;p<u.length;p+=5E4)g=[q,0].concat(u.slice(p,Math.min(u.length,p+5E4))),Array.prototype.splice.apply(this._lineOffsets,g),q+=5E4}for(q=p=0;q<this._text.length;){j=this._text[q].length;if(f<=p+j)break;
p+=j;q++}g=p;for(u=q;q<this._text.length;){j=this._text[q].length;if(e<=p+j)break;p+=j;q++}j=this._text[q];f=this._text[u].substring(0,f-g);e=j.substring(e-p);u=[u,q-u+1];f&&u.push(f);c&&u.push(c);e&&u.push(e);Array.prototype.splice.apply(this._text,u);if(this._text.length===0)this._text=[""];this.onChanged({type:"Changed",start:b,removedCharCount:a,addedCharCount:m,removedLineCount:d,addedLineCount:h})}}};l.EventTarget.addMixin(i.prototype);return{TextModel:i}});
define("orion/keyBinding",["orion/util"],function(l){function o(i,c,f,e,g,j){this.type=j||"keydown";this.keyCode=typeof i==="string"&&this.type==="keydown"?i.toUpperCase().charCodeAt(0):i;this.mod1=c!==void 0&&c!==null?c:!1;this.mod2=f!==void 0&&f!==null?f:!1;this.mod3=e!==void 0&&e!==null?e:!1;this.mod4=g!==void 0&&g!==null?g:!1}function n(i){this.keys=i}o.prototype={getKeys:function(){return[this]},match:function(i,c){if(c!==void 0){if(c!==0)return!1}else if(i instanceof Array){if(i.length>1)return!1;
i=i[0]}return i.type!==this.type?!1:this.keyCode===i.keyCode||this.keyCode===String.fromCharCode(l.isOpera?i.which:i.charCode!==void 0?i.charCode:i.keyCode)?this.mod1!==(l.isMac?i.metaKey:i.ctrlKey)?!1:this.type==="keydown"&&this.mod2!==i.shiftKey?!1:this.mod3!==i.altKey?!1:l.isMac&&this.mod4!==i.ctrlKey?!1:!0:!1},equals:function(i){return!i?!1:this.keyCode!==i.keyCode?!1:this.mod1!==i.mod1?!1:this.mod2!==i.mod2?!1:this.mod3!==i.mod3?!1:this.mod4!==i.mod4?!1:this.type!==i.type?!1:!0}};n.prototype=
{getKeys:function(){return this.keys.slice(0)},match:function(i,c){var f=this.keys;if(c!==void 0)return c>f.length?!1:f[c].match(i)?c===f.length-1?!0:c+1:!1;else{i instanceof Array||(i=[i]);if(i.length>f.length)return!1;var e;for(e=0;e<i.length;e++)if(!f[e].match(i[e]))return!1;return e===f.length?!0:e}},equals:function(i){if(!i.keys)return!1;if(i.keys.length!==this.keys.length)return!1;for(var c=0;c<i.keys.length;c++)if(!i.keys[c].equals(this.keys[c]))return!1;return!0}};return{KeyBinding:o,KeyStroke:o,
KeySequence:n}});
define("orion/editor/keyModes",["orion/keyBinding","orion/util"],function(l,o){function n(c){if(c)this._view=c,this._keyBindings=this.createKeyBindings(),this._keyBindingIndex=0}function i(c){n.call(this,c)}n.prototype={createKeyBindings:function(){return[]},getKeyBindings:function(c){for(var f=[],e=this._keyBindings,g=0;g<e.length;g++)e[g].actionID===c&&f.push(e[g].keyBinding);return f},getView:function(){return this._view},isActive:function(){return this._view.getKeyModes().indexOf(this)!==-1},
match:function(c){if(c.type==="keydown")switch(c.keyCode){case 16:case 17:case 18:case 91:return}for(var f=this._keyBindingIndex,e=this._matchingKeyBindings||this._keyBindings,g=[],j=0;j<e.length;j++){var b=e[j],a=b.keyBinding.match(c,f);if(a===!0)return this._keyBindingIndex=0,this._matchingKeyBindings=null,b.actionID;else typeof a==="number"&&g.push(b)}if(g.length===0)this._keyBindingIndex=0,this._matchingKeyBindings=null;else return this._keyBindingIndex++,this._matchingKeyBindings=g,"noop"},setKeyBinding:function(c,
f){for(var e=this._keyBindings,g=0;g<e.length;g++){var j=e[g];if(j.keyBinding.equals(c)){f?j.actionID=f:j.predefined?j.actionID="noop":e.splice(g,1);return}}f&&e.push({keyBinding:c,actionID:f})},setView:function(c){this._view=c}};i.prototype=new n;i.prototype.createKeyBindings=function(){var c=l.KeyBinding,f=[];f.push({actionID:"lineUp",keyBinding:new c(38),predefined:!0});f.push({actionID:"lineDown",keyBinding:new c(40),predefined:!0});f.push({actionID:"charPrevious",keyBinding:new c(37),predefined:!0});
f.push({actionID:"charNext",keyBinding:new c(39),predefined:!0});o.isMac?(f.push({actionID:"scrollPageUp",keyBinding:new c(33),predefined:!0}),f.push({actionID:"scrollPageDown",keyBinding:new c(34),predefined:!0}),f.push({actionID:"pageUp",keyBinding:new c(33,null,null,!0),predefined:!0}),f.push({actionID:"pageDown",keyBinding:new c(34,null,null,!0),predefined:!0}),f.push({actionID:"lineStart",keyBinding:new c(37,!0),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new c(39,!0),predefined:!0}),
f.push({actionID:"wordPrevious",keyBinding:new c(37,null,null,!0),predefined:!0}),f.push({actionID:"wordNext",keyBinding:new c(39,null,null,!0),predefined:!0}),f.push({actionID:"scrollTextStart",keyBinding:new c(36),predefined:!0}),f.push({actionID:"scrollTextEnd",keyBinding:new c(35),predefined:!0}),f.push({actionID:"textStart",keyBinding:new c(38,!0),predefined:!0}),f.push({actionID:"textEnd",keyBinding:new c(40,!0),predefined:!0}),f.push({actionID:"scrollPageUp",keyBinding:new c(38,null,null,null,
!0),predefined:!0}),f.push({actionID:"scrollPageDown",keyBinding:new c(40,null,null,null,!0),predefined:!0}),f.push({actionID:"lineStart",keyBinding:new c(37,null,null,null,!0),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new c(39,null,null,null,!0),predefined:!0}),f.push({actionID:"lineStart",keyBinding:new c(38,null,null,!0),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new c(40,null,null,!0),predefined:!0})):(f.push({actionID:"pageUp",keyBinding:new c(33),predefined:!0}),f.push({actionID:"pageDown",
keyBinding:new c(34),predefined:!0}),f.push({actionID:"lineStart",keyBinding:new c(36),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new c(35),predefined:!0}),f.push({actionID:"wordPrevious",keyBinding:new c(37,!0),predefined:!0}),f.push({actionID:"wordNext",keyBinding:new c(39,!0),predefined:!0}),f.push({actionID:"textStart",keyBinding:new c(36,!0),predefined:!0}),f.push({actionID:"textEnd",keyBinding:new c(35,!0),predefined:!0}));o.isFirefox&&o.isLinux&&(f.push({actionID:"lineUp",keyBinding:new c(38,
!0),predefined:!0}),f.push({actionID:"lineDown",keyBinding:new c(40,!0),predefined:!0}));o.isWindows&&(f.push({actionID:"scrollLineUp",keyBinding:new c(38,!0),predefined:!0}),f.push({actionID:"scrollLineDown",keyBinding:new c(40,!0),predefined:!0}));f.push({actionID:"selectLineUp",keyBinding:new c(38,null,!0),predefined:!0});f.push({actionID:"selectLineDown",keyBinding:new c(40,null,!0),predefined:!0});f.push({actionID:"selectCharPrevious",keyBinding:new c(37,null,!0),predefined:!0});f.push({actionID:"selectCharNext",
keyBinding:new c(39,null,!0),predefined:!0});f.push({actionID:"selectPageUp",keyBinding:new c(33,null,!0),predefined:!0});f.push({actionID:"selectPageDown",keyBinding:new c(34,null,!0),predefined:!0});o.isMac?(f.push({actionID:"selectLineStart",keyBinding:new c(37,!0,!0),predefined:!0}),f.push({actionID:"selectLineEnd",keyBinding:new c(39,!0,!0),predefined:!0}),f.push({actionID:"selectWordPrevious",keyBinding:new c(37,null,!0,!0),predefined:!0}),f.push({actionID:"selectWordNext",keyBinding:new c(39,
null,!0,!0),predefined:!0}),f.push({actionID:"selectTextStart",keyBinding:new c(36,null,!0),predefined:!0}),f.push({actionID:"selectTextEnd",keyBinding:new c(35,null,!0),predefined:!0}),f.push({actionID:"selectTextStart",keyBinding:new c(38,!0,!0),predefined:!0}),f.push({actionID:"selectTextEnd",keyBinding:new c(40,!0,!0),predefined:!0}),f.push({actionID:"selectLineStart",keyBinding:new c(37,null,!0,null,!0),predefined:!0}),f.push({actionID:"selectLineEnd",keyBinding:new c(39,null,!0,null,!0),predefined:!0}),
f.push({actionID:"selectLineStart",keyBinding:new c(38,null,!0,!0),predefined:!0}),f.push({actionID:"selectLineEnd",keyBinding:new c(40,null,!0,!0),predefined:!0})):(o.isLinux&&(f.push({actionID:"selectWholeLineUp",keyBinding:new c(38,!0,!0),predefined:!0}),f.push({actionID:"selectWholeLineDown",keyBinding:new c(40,!0,!0),predefined:!0})),f.push({actionID:"selectLineStart",keyBinding:new c(36,null,!0),predefined:!0}),f.push({actionID:"selectLineEnd",keyBinding:new c(35,null,!0),predefined:!0}),f.push({actionID:"selectWordPrevious",
keyBinding:new c(37,!0,!0),predefined:!0}),f.push({actionID:"selectWordNext",keyBinding:new c(39,!0,!0),predefined:!0}),f.push({actionID:"selectTextStart",keyBinding:new c(36,!0,!0),predefined:!0}),f.push({actionID:"selectTextEnd",keyBinding:new c(35,!0,!0),predefined:!0}));f.push({actionID:"undo",keyBinding:new l.KeyBinding("z",!0),predefined:!0});o.isMac?f.push({actionID:"redo",keyBinding:new l.KeyBinding("z",!0,!0),predefined:!0}):f.push({actionID:"redo",keyBinding:new l.KeyBinding("y",!0),predefined:!0});
f.push({actionID:"deletePrevious",keyBinding:new c(8),predefined:!0});f.push({actionID:"deletePrevious",keyBinding:new c(8,null,!0),predefined:!0});f.push({actionID:"deleteNext",keyBinding:new c(46),predefined:!0});f.push({actionID:"deleteWordPrevious",keyBinding:new c(8,!0),predefined:!0});f.push({actionID:"deleteWordPrevious",keyBinding:new c(8,!0,!0),predefined:!0});f.push({actionID:"deleteWordNext",keyBinding:new c(46,!0),predefined:!0});f.push({actionID:"tab",keyBinding:new c(9),predefined:!0});
f.push({actionID:"shiftTab",keyBinding:new c(9,null,!0),predefined:!0});f.push({actionID:"enter",keyBinding:new c(13),predefined:!0});f.push({actionID:"enter",keyBinding:new c(13,null,!0),predefined:!0});f.push({actionID:"selectAll",keyBinding:new c("a",!0),predefined:!0});f.push({actionID:"toggleTabMode",keyBinding:new c("m",!0),predefined:!0});o.isMac&&(f.push({actionID:"deleteNext",keyBinding:new c(46,null,!0),predefined:!0}),f.push({actionID:"deleteWordPrevious",keyBinding:new c(8,null,null,!0),
predefined:!0}),f.push({actionID:"deleteWordNext",keyBinding:new c(46,null,null,!0),predefined:!0}));f.push({actionID:"toggleWrapMode",keyBinding:new l.KeyBinding("w",!0,!1,!0)});f.push({actionID:"toggleOverwriteMode",keyBinding:new l.KeyBinding(45)});if(!o.isFirefox){var e=o.isMac&&o.isChrome;f.push({actionID:"noop",keyBinding:new c("u",!e,!1,!1,e),predefined:!0});f.push({actionID:"noop",keyBinding:new c("i",!e,!1,!1,e),predefined:!0});f.push({actionID:"noop",keyBinding:new c("b",!e,!1,!1,e),predefined:!0})}o.isFirefox&&
(f.push({actionID:"copy",keyBinding:new c(45,!0),predefined:!0}),f.push({actionID:"paste",keyBinding:new c(45,null,!0),predefined:!0}),f.push({actionID:"cut",keyBinding:new c(46,null,!0),predefined:!0}));o.isMac&&(f.push({actionID:"lineStart",keyBinding:new c("a",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"lineEnd",keyBinding:new c("e",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"lineUp",keyBinding:new c("p",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"lineDown",keyBinding:new c("n",!1,!1,
!1,!0),predefined:!0}),f.push({actionID:"charPrevious",keyBinding:new c("b",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"charNext",keyBinding:new c("f",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"deletePrevious",keyBinding:new c("h",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"deleteNext",keyBinding:new c("d",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"deleteLineEnd",keyBinding:new c("k",!1,!1,!1,!0),predefined:!0}),o.isFirefox?(f.push({actionID:"scrollPageDown",keyBinding:new c("v",!1,
!1,!1,!0),predefined:!0}),f.push({actionID:"deleteLineStart",keyBinding:new c("u",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"deleteWordPrevious",keyBinding:new c("w",!1,!1,!1,!0),predefined:!0})):(f.push({actionID:"pageDown",keyBinding:new c("v",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"centerLine",keyBinding:new c("l",!1,!1,!1,!0),predefined:!0}),f.push({actionID:"enterNoCursor",keyBinding:new c("o",!1,!1,!1,!0),predefined:!0})));return f};return{KeyMode:n,DefaultKeyMode:i}});
define("orion/editor/textTheme",["require","orion/editor/eventTarget","orion/util"],function(l,o,n){function i(c){c=c||{};this._document=c.document||document}var c={};i.getTheme=function(f){var f=f||"default",e=c[f];e||(e=c[f]=new i);return e};i.prototype={getThemeClass:function(){return this._themeClass},setThemeClass:function(c,e){var g=this,j=g._themeClass;g._themeClass=c;this._load(c,e,function(){g.onThemeChanged({type:"ThemeChanged",oldValue:j,newValue:g.getThemeClass()})})},onThemeChanged:function(c){return this.dispatchEvent(c)},
buildStyleSheet:function(c,e){function g(b,a,d){a&&(j.push("."+c+" ."+b+" {"),j.push("\t"+(d?"background-color":"color")+": "+a+";"),j.push("}"))}var j=[];j.push("");j.push("."+c+" {");e.fontFamily&&j.push("\tfont-family: "+e.fontFamily+";");e.fontSize&&j.push("\tfont-size: "+e.fontSize+";");e.fontSize&&j.push("\tcolor: "+e.text+";");j.push("}");j.push("."+c+".textview {");e.background&&j.push("\tbackground-color: "+e.background+";");j.push("}");g("ruler.annotations",e.annotationRuler,!0);g("ruler.lines",
e.annotationRuler,!0);g("ruler.folding",e.annotationRuler,!0);g("ruler.overview",e.overviewRuler,!0);g("rulerLines",e.lineNumber,!1);g("rulerLines.even",e.lineNumberEven,!1);g("rulerLines.odd",e.lineNumberOdd,!1);g("annotationLine.currentLine",e.currentLine,!0);g("entity-name-tag",e.keyword,!1);g("entity-other-attribute-name",e.attribute,!1);g("string-quoted",e.string,!1);g("line_caret",e.currentLine,!0);g("token_keyword",e.keyword,!1);g("token_string",e.string,!1);g("token_singleline_comment",e.comment,
!1);g("token_multiline_comment",e.comment,!1);g("token_doc_comment",e.comment,!1);g("token_doc_html_markup",e.comment,!1);return j.join("\n")},_createStyle:function(c,e,g,j){var b=this._document,c="orion-theme-"+c,a=b.getElementById(c);if(a){if(j||a.firstChild.data===e)return;a.removeChild(a.firstChild);a.appendChild(b.createTextNode(e))}else j?(a=n.createElement(b,"link"),a.rel="stylesheet",a.type="text/css",a.href=e,a.addEventListener("load",function(){g()})):(a=n.createElement(b,"style"),a.appendChild(b.createTextNode(e))),
a.id=c,(b.getElementsByTagName("head")[0]||b.documentElement).appendChild(a);j||g()},_load:function(c,e,g){if(c)if(typeof e==="string")this._createStyle(c,e,g);else if(e=e.href,e.substring(e.length-4)!==".css"&&(e+=".css"),/^\//.test(e)||/[a-zA-Z0-9]+:\/\//i.test(e)||!l.toUrl)this._createStyle(c,e,g,!0);else{var j=this;l(["text!"+e],function(b){j._createStyle(c,b,g,!1)})}else g()}};o.EventTarget.addMixin(i.prototype);return{TextTheme:i}});
define("orion/editor/util",[],function(){return{contains:function(l,o){if(!o)return!1;if(!l.compareDocumentPosition){for(var n=o;n;){if(l===n)return!0;n=n.parentNode}return!1}return l===o||(l.compareDocumentPosition(o)&16)!==0},addEventListener:function(l,o,n,i){typeof l.addEventListener==="function"?l.addEventListener(o,n,i===!0):l.attachEvent("on"+o,n)},removeEventListener:function(l,o,n,i){typeof l.removeEventListener==="function"?l.removeEventListener(o,n,i===!0):l.detachEvent("on"+o,n)}}});
define("orion/editor/textView","i18n!orion/editor/nls/messages,orion/editor/textModel,orion/editor/keyModes,orion/editor/eventTarget,orion/editor/textTheme,orion/editor/util,orion/util".split(","),function(l,o,n,i,c,f,e){function g(k,t,a){if(a){t.className="";for(var a=t.attributes,b=a.length;b-- >0;)(!e.isIE||e.isIE>=9||e.isIE<9&&a[b].specified)&&t.removeAttribute(a[b].name)}if(k){if(k.styleClass)t.className=k.styleClass;if(a=k.style)for(var d in a)a.hasOwnProperty(d)&&(t.style[d]=a[d]);if(k=k.attributes)for(var c in k)k.hasOwnProperty(c)&&
t.setAttribute(c,k[c])}}function j(k){return k instanceof Array?k.slice(0):k}function b(k,t){if(!k)return t;if(!t)return k;for(var a in t)t.hasOwnProperty(a)&&(k.hasOwnProperty(a)||(k[a]=t[a]));return k}function a(k,t){if(k===t)return!0;if(k&&!t||!k&&t)return!1;if(k&&k.constructor===String||t&&t.constructor===String)return!1;if(k instanceof Array||t instanceof Array){if(!(k instanceof Array&&t instanceof Array))return!1;if(k.length!==t.length)return!1;for(var x=0;x<k.length;x++)if(!a(k[x],t[x]))return!1;
return!0}if(!(k instanceof Object)||!(t instanceof Object))return!1;for(x in k)if(k.hasOwnProperty(x)){if(!t.hasOwnProperty(x))return!1;if(!a(k[x],t[x]))return!1}for(x in t)if(!k.hasOwnProperty(x))return!1;return!0}function d(k,t,a){for(var b=0,d=0,c=0,e=k.length;c<e;){b!==-1&&b<=c&&(b=k.indexOf("\r",c));d!==-1&&d<=c&&(d=k.indexOf("\n",c));var m=c,h;if(d===-1&&b===-1){t(k.substring(c));break}b!==-1&&d!==-1?b+1===d?(h=b,c=d+1):(h=b<d?b:d,c=(b<d?b:d)+1):b!==-1?(h=b,c=b+1):(h=d,c=d+1);t(k.substring(m,
h));a()}}function m(k){var t,a,b,d,c=k.ownerDocument.defaultView||k.ownerDocument.parentWindow;if(c.getComputedStyle)k=c.getComputedStyle(k,null),t=k.getPropertyValue("padding-left"),a=k.getPropertyValue("padding-top"),b=k.getPropertyValue("padding-right"),d=k.getPropertyValue("padding-bottom");else if(k.currentStyle)t=k.currentStyle.paddingLeft,a=k.currentStyle.paddingTop,b=k.currentStyle.paddingRight,d=k.currentStyle.paddingBottom;return{left:parseInt(t,10)||0,top:parseInt(a,10)||0,right:parseInt(b,
10)||0,bottom:parseInt(d,10)||0}}function h(k){var t,a,b,d,c=k._trim;if(!c){var c=m(k),e=k.ownerDocument.defaultView||k.ownerDocument.parentWindow;if(e.getComputedStyle)d=e.getComputedStyle(k,null),t=d.getPropertyValue("border-left-width"),a=d.getPropertyValue("border-top-width"),b=d.getPropertyValue("border-right-width"),d=d.getPropertyValue("border-bottom-width");else if(k.currentStyle)t=k.currentStyle.borderLeftWidth,a=k.currentStyle.borderTopWidth,b=k.currentStyle.borderRightWidth,d=k.currentStyle.borderBottomWidth;
t=parseInt(t,10)||0;a=parseInt(a,10)||0;b=parseInt(b,10)||0;d=parseInt(d,10)||0;c.left+=t;c.top+=a;c.right+=b;c.bottom+=d;k._trim=c}return c}function p(k,t,a){this.start=k;this.end=t;this.caret=a}function s(k){this.left=k.left;this.top=k.top;this.right=k.right;this.bottom=k.bottom}function r(k,t,a){this.view=k;this.lineIndex=t;this._lineDiv=a}function q(k){this._init(k||{})}var u=f.addEventListener,w=f.removeEventListener,v=function(){function k(k){this.options=k}k.prototype.play=function(){var k=
typeof this.options.duration==="number"?this.options.duration:350,a=this.options.easing||this.defaultEasing,b=this.options.onAnimate||function(){},d=this.options.curve[0],c=this.options.curve[1],e=c-d,m=-1,h,f=this;this.interval=this.options.window.setInterval(function(){m=m===-1?(new Date).getTime():m;var g=((new Date).getTime()-m)/k;g<1?(g=a(g),h=d+g*e,b(h)):(b(c),f.stop())},typeof this.options.rate==="number"?this.options.rate:20)};k.prototype.stop=function(){this.options.window.clearInterval(this.interval);
(this.options.onEnd||function(){})()};k.prototype.defaultEasing=function(k){return Math.sin(k*(Math.PI/2))};return k}();p.prototype={clone:function(){return new p(this.start,this.end,this.caret)},collapse:function(){this.caret?this.end=this.start:this.start=this.end},extend:function(k){this.caret?this.start=k:this.end=k;if(this.start>this.end)k=this.start,this.start=this.end,this.end=k,this.caret=!this.caret},setCaret:function(k){this.end=this.start=k;this.caret=!1},getCaret:function(){return this.caret?
this.start:this.end},toString:function(){return"start="+this.start+" end="+this.end+(this.caret?" caret is at start":" caret is at end")},isEmpty:function(){return this.start===this.end},equals:function(k){return this.caret===k.caret&&this.start===k.start&&this.end===k.end}};s.prototype={toString:function(){return"{l="+this.left+", t="+this.top+", r="+this.right+", b="+this.bottom+"}"}};r.prototype={create:function(k,t){if(!this._lineDiv){var a=this._lineDiv=this._createLine(k,t,this.lineIndex);a._line=
this;return a}},_createLine:function(k,t,b){var d=this.view,c=d._model,m=c.getLine(b),h=c.getLineStart(b),f={type:"LineStyle",textView:d,lineIndex:b,lineText:m,lineStart:h};if(m.length<2E3)d.onLineStyle(f);c=t||e.createElement(k.ownerDocument,"div");if(!t||!a(t.viewStyle,f.style)){g(f.style,c,t);if(t)t._trim=null;c.viewStyle=f.style;c.setAttribute("role","presentation")}c.lineIndex=b;b=[];this._createRanges(f.ranges,m,0,m.length,h,{tabOffset:0,ranges:b});m=" ";!d._fullSelection&&e.isIE<9&&(m="\ufeff");
e.isWebkit&&(m="\u200b");f={text:m,style:d._metrics.largestFontStyle,ignoreChars:1};b.length===0||!b[b.length-1].style||b[b.length-1].style.tagName!=="div"?b.push(f):b.splice(b.length-1,0,f);var p,j,i,r,s,m=d=0,q,u;if(t){if(j=t.modelChangedEvent)j.removedLineCount===0&&j.addedLineCount===0?(u=j.start-h,q=j.addedCharCount-j.removedCharCount):u=-1,t.modelChangedEvent=void 0;j=t.firstChild}for(h=0;h<b.length;h++){f=b[h];r=f.text;d+=r.length;p=f.style;if(j)if(s=j.firstChild.data,i=j.viewStyle,s===r&&
a(p,i)){m+=s.length;j._rectsCache=void 0;p=j=j.nextSibling;continue}else for(;j;){if(u!==-1){i=d;i>=u&&(i-=q);s=(s=j.firstChild.data)?s.length:0;if(m+s>i)break;m+=s}i=j.nextSibling;c.removeChild(j);j=i}p=this._createSpan(c,r,p,f.ignoreChars);j?c.insertBefore(p,j):c.appendChild(p);if(t)t.lineWidth=void 0}if(t)for(k=p?p.nextSibling:null;k;)i=k.nextSibling,t.removeChild(k),k=i;else k.appendChild(c);return c},_createRanges:function(k,t,b,d,c,m){if(!(b>d)){if(k)for(var e=0;e<k.length;e++){var h=k[e];if(!(h.end<
c+b)){var f=Math.max(c+b,h.start)-c;if(f>d)break;var g=Math.min(c+d,h.end)-c;if(f<=g){f=Math.max(b,f);g=Math.min(d,g);b<f&&this._createRange(t,b,f,null,m);if(!h.style||!h.style.unmergeable)for(;e+1<k.length&&k[e+1].start-c===g&&a(h.style,k[e+1].style);)h=k[e+1],g=Math.min(c+d,h.end)-c,e++;this._createRange(t,f,g,h.style,m);b=g}}}b<d&&this._createRange(t,b,d,null,m)}},_createRange:function(k,t,a,b,d){if(!(t>a)){var c=this.view._customTabSize;if(c&&c!==8)for(var e=k.indexOf("\t",t);e!==-1&&e<a;){t<
e&&(t={text:k.substring(t,e),style:b},d.ranges.push(t),d.tabOffset+=t.text.length);t=c-d.tabOffset%c;if(t>0){for(var m="\u00a0",h=1;h<t;h++)m+=" ";t={text:m,style:b,ignoreChars:t-1};d.ranges.push(t);d.tabOffset+=t.text.length}t=e+1;if(t===a)return;e=k.indexOf("\t",t)}t<=a&&(t={text:k.substring(t,a),style:b},d.ranges.push(t),d.tabOffset+=t.text.length)}},_createSpan:function(k,t,a,b){var d=this.view,c="span";a&&a.tagName&&(c=a.tagName.toLowerCase());var m=c==="a";if(m)k.hasLink=!0;m&&!d._linksVisible&&
(c="span");m=k.ownerDocument;k=e.createElement(k.ownerDocument,c);a&&a.html?(k.innerHTML=a.html,k.ignore=!0):a&&a.node?(k.appendChild(a.node),k.ignore=!0):k.appendChild(m.createTextNode(a&&a.text?a.text:t));g(a,k);if(c==="a"){var h=d._getWindow();u(k,"click",function(k){return d._handleLinkClick(k?k:h.event)},!1)}k.viewStyle=a;if(b)k.ignoreChars=b;return k},_ensureCreated:function(){return this._lineDiv?this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(k,
t){var a=this._ensureCreated(),b=this.view;if(k===void 0)return this._getLineBoundingClientRect(a,!0);var d=b._model,c=a.ownerDocument,m=this.lineIndex,h=null;if(k<d.getLineEnd(m)){m=d.getLineStart(m);for(d=a.firstChild;d;){if(!d.ignore){var f=d.firstChild,g=f.length;d.ignoreChars&&(g-=d.ignoreChars);if(m+g>k){h=k-m;if(f.length===1)h=new s(d.getBoundingClientRect());else if(b._isRangeRects)c=c.createRange(),c.setStart(f,h),c.setEnd(f,h+1),h=new s(c.getBoundingClientRect());else if(e.isIE){if(c=c.body.createTextRange(),
c.moveToElementText(d),c.collapse(),(m=h===0&&e.isIE===8)&&(h=1),c.moveEnd("character",h+1),c.moveStart("character",h),h=new s(c.getBoundingClientRect()),m)h.left=d.getClientRects()[0].left}else{var p=f.data;d.removeChild(f);d.appendChild(c.createTextNode(p.substring(0,h)));var j=e.createElement(c,"span");j.appendChild(c.createTextNode(p.substring(h,h+1)));d.appendChild(j);d.appendChild(c.createTextNode(p.substring(h+1)));h=new s(j.getBoundingClientRect());d.innerHTML="";d.appendChild(f);this._createdDiv||
(c=b._getSelection(),(m<=c.start&&c.start<m+g||m<=c.end&&c.end<m+g)&&b._updateDOMSelection())}e.isIE&&(c=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,a=c.screen.logicalXDPI/c.screen.deviceXDPI,c=c.screen.logicalYDPI/c.screen.deviceYDPI,h.left*=a,h.right*=a,h.top*=c,h.bottom*=c);break}m+=g}d=d.nextSibling}}a=this.getBoundingClientRect();if(!h)b._wrapMode?(b=this.getClientRects(),h=b[b.length-1],h.left=h.right,h.left+=a.left,h.top+=a.top,h.right+=a.left,h.bottom+=a.top):(h=new s(a),h.left=
h.right);if(t||t===void 0)h.left-=a.left,h.top-=a.top,h.right-=a.left,h.bottom-=a.top;return h},_getClientRects:function(k,t){var a,b,d,c;if(!k._rectsCache){a=k.getClientRects();b=Array(a.length);for(c=0;c<a.length;c++)d=b[c]=new s(a[c]),d.left-=t.left,d.top-=t.top,d.right-=t.left,d.bottom-=t.top;k._rectsCache=b}a=k._rectsCache;b=[a.length];for(c=0;c<a.length;c++)b[c]=new s(a[c]);return b},getClientRects:function(k){if(!this.view._wrapMode)return[this.getBoundingClientRect()];for(var t=this._ensureCreated(),
a=[],b=t.firstChild,d,c=t.getBoundingClientRect();b;){if(!b.ignore)for(var m=this._getClientRects(b,c),t=0;t<m.length;t++){var h=m[t],e;if(h.top!==h.bottom){var f=h.top+(h.bottom-h.top)/2;for(e=0;e<a.length;e++)if(d=a[e],d.top<=f&&f<d.bottom)break;if(e===a.length)a.push(h);else{if(h.left<d.left)d.left=h.left;if(h.top<d.top)d.top=h.top;if(h.right>d.right)d.right=h.right;if(h.bottom>d.bottom)d.bottom=h.bottom}}}b=b.nextSibling}return k!==void 0?a[k]:a},_getLineBoundingClientRect:function(k,t){var a=
new s(k.getBoundingClientRect());if(!this.view._wrapMode){a.right=a.left;for(var b=k.lastChild;b&&b.ignoreChars===b.firstChild.length;)b=b.previousSibling;if(b)b=b.getBoundingClientRect(),a.right=b.right+h(k).right}t&&(b=h(k),a.left+=b.left,a.right-=b.right);return a},getLineCount:function(){return!this.view._wrapMode?1:this.getClientRects().length},getLineIndex:function(k){if(!this.view._wrapMode)return 0;for(var a=this.getClientRects(),k=this.getBoundingClientRect(k),k=k.top+(k.bottom-k.top)/2,
b=0;b<a.length;b++)if(a[b].top<=k&&k<a[b].bottom)return b;return a.length-1},getLineStart:function(k){if(!this.view._wrapMode||k===0)return this.view._model.getLineStart(k);var a=this.getClientRects();return this.getOffset(a[k].left+1,a[k].top+1)},getOffset:function(k,a){var b=this.view,d=b._model,c=this.lineIndex,h=d.getLineStart(c),m=d.getLineEnd(c);if(h===m)return h;var f=this._ensureCreated(),g=this.getBoundingClientRect(),p,j;if(b._wrapMode){p=this.getClientRects();if(a<p[0].top)a=p[0].top;for(var i=
0;i<p.length;i++)if(j=p[i],j.top<=a&&a<j.bottom)break;if(k<j.left)k=j.left;k>j.right&&(k=j.right-1)}else k<0&&(k=0),k>g.right-g.left&&(k=g.right-g.left);var r=f.ownerDocument,i=r.defaultView||r.parentWindow,s=e.isIE?i.screen.logicalXDPI/i.screen.deviceXDPI:1,q=e.isIE?i.screen.logicalYDPI/i.screen.deviceYDPI:1,i=h,u=f.firstChild;a:for(;u;){if(!u.ignore){var l=u.firstChild,f=l.length;u.ignoreChars&&(f-=u.ignoreChars);var n,o,w;p=this._getClientRects(u,g);for(var v=0;v<p.length;v++)if(j=p[v],j.left<=
k&&k<j.right&&(!b._wrapMode||j.top<=a&&a<j.bottom)){var v=j.left+g.left,A;if(e.isIE||b._isRangeRects){for(var r=b._isRangeRects?r.createRange():r.body.createTextRange(),z=f,C=-1;z-C>1;){var G=Math.floor((z+C)/2);p=C+1;j=G===f-1&&u.ignoreChars?l.length:G+1;A=p===0&&e.isIE===8;b._isRangeRects?(r.setStart(l,p),r.setEnd(l,j)):(A&&(p=1),r.moveToElementText(u),r.move("character",p),r.moveEnd("character",j-p));p=r.getClientRects();for(var L=!1,I=0;I<p.length;I++)if(j=p[I],n=(A?v:j.left)*s-g.left,w=j.right*
s-g.left,o=j.top*q-g.top,j=j.bottom*q-g.top,n<=k&&k<w&&(!b._wrapMode||o<=a&&a<j)){L=!0;break}L?z=G:C=G}i+=z;p=z;j=z===f-1&&u.ignoreChars?l.length:Math.min(z+1,l.length);b._isRangeRects?(r.setStart(l,p),r.setEnd(l,j)):(r.moveToElementText(u),r.move("character",p),r.moveEnd("character",j-p));p=r.getClientRects();b=!1;p.length>0&&(j=p[0],n=(A?v:j.left)*s-g.left,w=j.right*s-g.left,b=k>n+(w-n)/2);g=i-h;d=d.getLine(c);c=d.charCodeAt(g);55296<=c&&c<=56319&&b?g<d.length&&(c=d.charCodeAt(g+1),56320<=c&&c<=
57343&&(i+=1)):56320<=c&&c<=57343&&!b&&g>0&&(c=d.charCodeAt(g-1),55296<=c&&c<=56319&&(i-=1));b&&i++}else{d=[];for(c=0;c<f;c++)d.push("<span>"),c===f-1?d.push(l.data.substring(c)):d.push(l.data.substring(c,c+1)),d.push("</span>");u.innerHTML=d.join("");for(d=u.firstChild;d;){j=d.getBoundingClientRect();n=j.left-g.left;w=j.right-g.left;if(n<=k&&k<w){k>n+(w-n)/2&&i++;break}i++;d=d.nextSibling}if(!this._createdDiv)u.innerHTML="",u.appendChild(l),g=b._getSelection(),(i<=g.start&&g.start<i+f||i<=g.end&&
g.end<i+f)&&b._updateDOMSelection()}break a}i+=f}u=u.nextSibling}return Math.min(m,Math.max(h,i))},getNextOffset:function(k,a){if(a.unit==="line"){var b=this.view._model,d=b.getLineAtOffset(k);if(a.count>0)return a.count--,b.getLineEnd(d);a.count++;return b.getLineStart(d)}return a.unit==="wordend"||a.unit==="wordWS"||a.unit==="wordendWS"?this._getNextOffset_W3C(k,a):e.isIE?this._getNextOffset_IE(k,a):this._getNextOffset_W3C(k,a)},_getNextOffset_W3C:function(k,a){function b(k){return 33<=k&&k<=47||
58<=k&&k<=64||91<=k&&k<=94||k===96||123<=k&&k<=126}function d(k){return k===32||k===9}var c=this.view._model,h=c.getLineAtOffset(k),m=c.getLine(h),e=c.getLineStart(h),c=c.getLineEnd(h),h=m.length,f=k-e,g,p=a.count<0?-1:1;if(a.unit==="word"||a.unit==="wordend"||a.unit==="wordWS"||a.unit==="wordendWS")for(var j,i,r;a.count!==0;){if(a.count>0){if(f===h)return c;g=m.charCodeAt(f);j=b(g);i=!j&&!d(g);for(f++;f<h;){g=m.charCodeAt(f);if(a.unit!=="wordWS"&&a.unit!=="wordendWS"){r=b(g);if(a.unit==="wordend"){if(!r&&
j)break}else if(r&&!j)break;g=!r&&!d(g)}else g=!d(g);if(a.unit==="wordend"||a.unit==="wordendWS"){if(!g&&i)break}else if(g&&!i)break;i=g;j=r;f++}}else{if(f===0)return e;f--;g=m.charCodeAt(f);j=b(g);for(i=!j&&!d(g);0<f;){g=m.charCodeAt(f-1);if(a.unit!=="wordWS"&&a.unit!=="wordendWS"){r=b(g);if(a.unit==="wordend"){if(r&&!j)break}else if(!r&&j)break;g=!r&&!d(g)}else g=!d(g);if(a.unit==="wordend"||a.unit==="wordendWS"){if(g&&!i)break}else if(!g&&i)break;i=g;j=r;f--}}a.count-=p}else for(;a.count!==0&&
0<=f+p&&f+p<=h;)f+=p,g=m.charCodeAt(f),56320<=g&&g<=57343&&f>0&&(g=m.charCodeAt(f-1),55296<=g&&g<=56319&&(f+=p)),a.count-=p;return e+f},_getNextOffset_IE:function(k,a){var b=this._ensureCreated(),d=this.view._model,c=this.lineIndex,h=0,m;m=d.getLineStart(c);var e=b.ownerDocument,f=a.count<0?-1:1;if(k===d.getLineEnd(c)){for(b=b.lastChild;b&&b.ignoreChars===b.firstChild.length;)b=b.previousSibling;if(!b)return m;h=e.body.createTextRange();h.moveToElementText(b);m=h.text.length;h.moveEnd(a.unit,f);h=
k+h.text.length-m}else if(k===m&&a.count<0)h=m;else for(b=b.firstChild;b;){d=b.firstChild.length;b.ignoreChars&&(d-=b.ignoreChars);if(m+d>k){h=e.body.createTextRange();k===m&&a.count<0?h.moveToElementText(b.previousSibling):(h.moveToElementText(b),h.collapse(),h.moveEnd("character",k-m));m=h.text.length;h.moveEnd(a.unit,f);h=k+h.text.length-m;break}m=d+m;b=b.nextSibling}a.count-=f;return h},destroy:function(){var k=this._createdDiv;if(k)k.parentNode.removeChild(k),this._createdDiv=null}};q.prototype=
{addKeyMode:function(k,a){var b=this._keyModes;a!==void 0?b.splice(a,0,k):b.push(k);k._modeAdded&&k._modeAdded()},addRuler:function(k,a){k.setView(this);var b=this._rulers;if(a!==void 0){var d,c;for(d=0,c=0;d<b.length&&c<a;d++)k.getLocation()===b[d].getLocation()&&c++;b.splice(c,0,k);a=c}else b.push(k);this._createRuler(k,a);this._update()},computeSize:function(){var k=0,a=0,b=this._model,d=this._clientDiv;if(!d)return{width:k,height:a};var c=d.style.width;if(e.isWebkit)d.style.width="0x7fffffffpx";
for(var b=b.getLineCount(),h=0;h<b;h++){var m=this._getLine(h),f=m.getBoundingClientRect(),k=Math.max(k,f.right-f.left);a+=f.bottom-f.top;m.destroy()}if(e.isWebkit)d.style.width=c;d=this._getViewPadding();k+=d.right+d.left+this._metrics.scrollWidth;a+=d.bottom+d.top+this._metrics.scrollWidth;return{width:k,height:a}},convert:function(k,a,b){if(this._clientDiv){var d=this._getScroll(),c=this._getViewPadding(),h=this._viewDiv.getBoundingClientRect();a==="document"&&(k.x!==void 0&&(k.x+=-d.x+h.left+
c.left),k.y!==void 0&&(k.y+=-d.y+h.top+c.top));b==="document"&&(k.x!==void 0&&(k.x+=d.x-h.left-c.left),k.y!==void 0&&(k.y+=d.y-h.top-c.top));return k}},destroy:function(){for(var k=0;k<this._rulers.length;k++)this._rulers[k].setView(null);this.rulers=null;this._destroyView();this.onDestroy({type:"Destroy"});this._actions=this._keyModes=this._doubleClickSelection=this._selection=this._theme=this._model=this._parent=null},focus:function(){this._clientDiv&&(this._updateDOMSelection(),this._clientDiv.focus(),
this._updateDOMSelection())},hasFocus:function(){return this._hasFocus},getActionDescription:function(k){if(k=this._actions[k])return k.actionDescription},getActions:function(k){var a=[],b=this._actions,d;for(d in b)b.hasOwnProperty(d)&&(k||!b[d].defaultHandler)&&a.push(d);return a},getBottomIndex:function(k){return!this._clientDiv?0:this._getBottomIndex(k)},getBottomPixel:function(){return!this._clientDiv?0:this._getScroll().y+this._getClientHeight()},getCaretOffset:function(){return this._getSelection().getCaret()},
getClientArea:function(){if(!this._clientDiv)return{x:0,y:0,width:0,height:0};var k=this._getScroll();return{x:k.x,y:k.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){return!this._clientDiv?0:this._getScroll().x},getKeyBindings:function(k){for(var a=[],b=this._keyModes,d=0;d<b.length;d++)a=a.concat(b[d].getKeyBindings(k));return a},getKeyModes:function(){return this._keyModes.slice(0)},getLineHeight:function(k){return!this._clientDiv?0:this._getLineHeight(k)},
getLineIndex:function(k){return!this._clientDiv?0:this._getLineIndex(k)},getLinePixel:function(k){return!this._clientDiv?0:this._getLinePixel(k)},getLocationAtOffset:function(k){if(!this._clientDiv)return{x:0,y:0};var a=this._model,k=Math.min(Math.max(0,k),a.getCharCount()),a=a.getLineAtOffset(k),b=this._getLine(a),k=b.getBoundingClientRect(k);b.destroy();b=k.left;a=this._getLinePixel(a)+k.top;return{x:b,y:a}},getNextOffset:function(k,a){var b=new p(k,k,!1);this._doMove(a,b);return b.getCaret()},
getOptions:function(){var k;if(arguments.length===0)k=this._defaultOptions();else if(arguments.length===1){if(k=arguments[0],typeof k==="string")return j(this["_"+k])}else{k={};for(var a in arguments)arguments.hasOwnProperty(a)&&(k[arguments[a]]=void 0)}for(var b in k)k.hasOwnProperty(b)&&(k[b]=j(this["_"+b]));return k},getModel:function(){return this._model},getOffsetAtLocation:function(k,a){if(!this._clientDiv)return 0;var b=this._getLineIndex(a),d=this._getLine(b),b=d.getOffset(k,a-this._getLinePixel(b));
d.destroy();return b},getLineAtOffset:function(k){this.getModel().getLineAtOffset(k)},getRulers:function(){return this._rulers.slice(0)},getSelection:function(){var k=this._getSelection();return{start:k.start,end:k.end}},getText:function(k,a){return this._model.getText(k,a)},getTopIndex:function(k){return!this._clientDiv?0:this._getTopIndex(k)},getTopPixel:function(){return!this._clientDiv?0:this._getScroll().y},invokeAction:function(k,a,b){if(this._clientDiv){if(k=this._actions[k]){if(!a&&k.handler&&
k.handler(b))return!0;if(k.defaultHandler)return typeof k.defaultHandler(b)==="boolean"}return!1}},isDestroyed:function(){return!this._clientDiv},onContextMenu:function(k){return this.dispatchEvent(k)},onDragStart:function(k){return this.dispatchEvent(k)},onDrag:function(k){return this.dispatchEvent(k)},onDragEnd:function(k){return this.dispatchEvent(k)},onDragEnter:function(k){return this.dispatchEvent(k)},onDragOver:function(k){return this.dispatchEvent(k)},onDragLeave:function(k){return this.dispatchEvent(k)},
onDrop:function(k){return this.dispatchEvent(k)},onDestroy:function(k){return this.dispatchEvent(k)},onLineStyle:function(k){return this.dispatchEvent(k)},onKeyDown:function(k){return this.dispatchEvent(k)},onKeyPress:function(k){return this.dispatchEvent(k)},onKeyUp:function(k){return this.dispatchEvent(k)},onModelChanged:function(k){return this.dispatchEvent(k)},onModelChanging:function(k){return this.dispatchEvent(k)},onModify:function(k){return this.dispatchEvent(k)},onMouseDown:function(k){return this.dispatchEvent(k)},
onMouseUp:function(k){return this.dispatchEvent(k)},onMouseMove:function(k){return this.dispatchEvent(k)},onMouseOver:function(k){return this.dispatchEvent(k)},onMouseOut:function(k){return this.dispatchEvent(k)},onSelection:function(k){return this.dispatchEvent(k)},onScroll:function(k){return this.dispatchEvent(k)},onVerify:function(k){return this.dispatchEvent(k)},onFocus:function(k){return this.dispatchEvent(k)},onBlur:function(k){return this.dispatchEvent(k)},redraw:function(){if(!(this._redrawCount>
0)){var k=this._model.getLineCount();this.redrawRulers(0,k);this.redrawLines(0,k)}},redrawRulers:function(k,a){if(!(this._redrawCount>0))for(var b=this.getRulers(),d=0;d<b.length;d++)this.redrawLines(k,a,b[d])},redrawLines:function(k,a,b){if(!(this._redrawCount>0)&&(k===void 0&&(k=0),a===void 0&&(a=this._model.getLineCount()),k!==a)){var d=this._clientDiv;if(d){if(b)for(d=this._getRulerParent(b).firstChild;d;){if(d._ruler===b)break;d=d.nextSibling}b?d.rulerChanged=!0:this._lineHeight&&this._resetLineHeight(k,
a);if(!b||b.getOverview()==="page")for(d=d.firstChild;d;){var c=d.lineIndex;if(k<=c&&c<a)d.lineChanged=!0;d=d.nextSibling}if(!b&&!this._wrapMode&&k<=this._maxLineIndex&&this._maxLineIndex<a)this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0;this._queueUpdate()}}},redrawRange:function(k,a){if(!(this._redrawCount>0)){var b=this._model;k===void 0&&(k=0);a===void 0&&(a=b.getCharCount());var d=b.getLineAtOffset(k),b=b.getLineAtOffset(Math.max(k,a-1))+1;this.redrawLines(d,
b)}},removeKeyMode:function(k){for(var a=this._keyModes,b=0;b<a.length;b++)if(a[b]===k){a.splice(b,1);break}k._modeRemoved&&k._modeRemoved()},removeRuler:function(k){for(var a=this._rulers,b=0;b<a.length;b++)if(a[b]===k){a.splice(b,1);k.setView(null);this._destroyRuler(k);this._update();break}},resize:function(){this._clientDiv&&this._handleResize(null)},setAction:function(k,a,b){if(k){var d=this._actions,c=d[k];c||(c=d[k]={});c.handler=a;if(b!==void 0)c.actionDescription=b}},setKeyBinding:function(k,
a){this._keyModes[0].setKeyBinding(k,a)},setCaretOffset:function(k,a,b){var d=this._model.getCharCount(),k=Math.max(0,Math.min(k,d));this._setSelection(new p(k,k,!1),a===void 0||a,!0,b)},setHorizontalPixel:function(k){this._clientDiv&&(k=Math.max(0,k),this._scrollView(k-this._getScroll().x,0))},setRedraw:function(k){k?--this._redrawCount===0&&this.redraw():this._redrawCount++},setModel:function(k){if(k&&k!==this._model){this._model.removeEventListener("preChanging",this._modelListener.onChanging);
this._model.removeEventListener("postChanged",this._modelListener.onChanged);var a=this._model.getLineCount(),b=this._model.getCharCount(),d=k.getLineCount(),c=k.getCharCount(),h={type:"ModelChanging",text:k.getText(),start:0,removedCharCount:b,addedCharCount:c,removedLineCount:a,addedLineCount:d};this.onModelChanging(h);this._model=k;h={type:"ModelChanged",start:0,removedCharCount:b,addedCharCount:c,removedLineCount:a,addedLineCount:d};this.onModelChanged(h);this._model.addEventListener("preChanging",
this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._reset();this._update()}},setOptions:function(k){var b=this._defaultOptions(),d;for(d in k)if(k.hasOwnProperty(d)){var c=k[d];if(!a(this["_"+d],c)){var h=b[d]?b[d].update:null;h?h.call(this,c):this["_"+d]=j(c)}}},setSelection:function(k,a,b,d){var c=k>a;if(c)var h=k,k=a,a=h;h=this._model.getCharCount();k=Math.max(0,Math.min(k,h));a=Math.max(0,Math.min(a,h));this._setSelection(new p(k,a,c),
b===void 0||b,!0,d)},setText:function(k,a,b){var d=a===void 0&&b===void 0;a===void 0&&(a=0);b===void 0&&(b=this._model.getCharCount());if(d)this._variableLineHeight=!1;this._modifyContent({text:k,start:a,end:b,_code:!0},!d);if(d)this._columnX=-1,this._setSelection(new p(0,0,!1),!0),e.isFirefox&&this._fixCaret()},setTopIndex:function(k){this._clientDiv&&this._scrollView(0,this._getLinePixel(Math.max(0,k))-this._getScroll().y)},setTopPixel:function(k){this._clientDiv&&this._scrollView(0,Math.max(0,
k)-this._getScroll().y)},showSelection:function(){return this._showCaret(!0)},update:function(k,a){this._clientDiv&&(k&&this._updateStyle(),a===void 0||a?this._update():this._queueUpdate())},_handleRootMouseDown:function(k){if(!this._ignoreEvent(k)){if(e.isFirefox&&k.which===1)this._clientDiv.contentEditable=!1,this._ignoreBlur=(this._overlayDiv||this._clientDiv).draggable=!0;var a=this._overlayDiv||this._clientDiv;if(e.isIE<9)a=this._viewDiv;for(var b=k.target?k.target:k.srcElement;b;){if(a===b)return;
b=b.parentNode}k.preventDefault&&k.preventDefault();k.stopPropagation&&k.stopPropagation();if(!this._isW3CEvents){var d=this;this._getWindow().setTimeout(function(){d._clientDiv.focus()},0)}}},_handleRootMouseUp:function(k){if(!this._ignoreEvent(k)&&e.isFirefox&&k.which===1)this._clientDiv.contentEditable=!0,(this._overlayDiv||this._clientDiv).draggable=!1,this._fixCaret(),this._ignoreBlur=!1},_handleBlur:function(){if(!this._ignoreBlur){this._hasFocus=!1;if(e.isIE<9&&!this._getSelection().isEmpty()){var k=
this._rootDiv,a=e.createElement(k.ownerDocument,"div");k.appendChild(a);k.removeChild(a)}if(this._cursorDiv)this._cursorDiv.style.display="none";if(this._selDiv1)if(this._selDiv1.style.background="lightgray",this._selDiv2.style.background="lightgray",this._selDiv3.style.background="lightgray",k=this._getWindow(),a=this._selDiv1.ownerDocument,k.getSelection){a=k.getSelection();for(k=a.anchorNode;k;){if(k===this._clientDiv){a.rangeCount>0&&a.removeAllRanges();break}k=k.parentNode}}else if(a.selection){this._ignoreSelect=
!1;for(k=a.selection.createRange().parentElement();k;){if(k===this._clientDiv){a.selection.empty();break}k=k.parentNode}this._ignoreSelect=!0}if(!this._ignoreFocus)this.onBlur({type:"Blur"})}},_handleContextMenu:function(k){if(!this._ignoreEvent(k)){e.isIE&&this._lastMouseButton===3&&this._updateDOMSelection();var a=!1;this.isListening("ContextMenu")?(a=this._createMouseEvent("ContextMenu",k),a.screenX=k.screenX,a.screenY=k.screenY,this.onContextMenu(a),a=a.defaultPrevented):e.isMac&&e.isFirefox&&
k.button===0&&(a=!0);if(a)return k.preventDefault&&k.preventDefault(),!1}},_handleCopy:function(k){if(!this._ignoreEvent(k)&&!this._ignoreCopy&&this._doCopy(k))return k.preventDefault&&k.preventDefault(),!1},_handleCut:function(k){if(!this._ignoreEvent(k)&&this._doCut(k))return k.preventDefault&&k.preventDefault(),!1},_handleDataModified:function(k){this._ignoreEvent(k)||this._startIME()},_handleDblclick:function(k){if(!this._ignoreEvent(k)&&(this._lastMouseTime=k.timeStamp?k.timeStamp:(new Date).getTime(),
this._clickCount!==2))this._clickCount=2,this._handleMouse(k)},_handleDragStart:function(k){if(!this._ignoreEvent(k)){if(e.isFirefox){var a=this;this._getWindow().setTimeout(function(){a._clientDiv.contentEditable=!0;a._clientDiv.draggable=!1;a._ignoreBlur=!1},0)}if(this.isListening("DragStart")&&this._dragOffset!==-1)this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",k)),this._dragOffset=-1;else return k.preventDefault&&k.preventDefault(),!1}},_handleDrag:function(k){if(!this._ignoreEvent(k)&&
this.isListening("Drag"))this.onDrag(this._createMouseEvent("Drag",k))},_handleDragEnd:function(k){if(!this._ignoreEvent(k)){this._dropTarget=!1;this._dragOffset=-1;if(this.isListening("DragEnd"))this.onDragEnd(this._createMouseEvent("DragEnd",k));e.isFirefox&&(this._fixCaret(),k.dataTransfer.dropEffect==="none"&&!k.dataTransfer.mozUserCancelled&&this._fixCaret())}},_handleDragEnter:function(k){if(!this._ignoreEvent(k)){var a=!0;this._dropTarget=!0;this.isListening("DragEnter")&&(a=!1,this.onDragEnter(this._createMouseEvent("DragEnter",
k)));if(e.isWebkit||a)return k.preventDefault&&k.preventDefault(),!1}},_handleDragOver:function(k){if(!this._ignoreEvent(k)){var a=!0;this.isListening("DragOver")&&(a=!1,this.onDragOver(this._createMouseEvent("DragOver",k)));if(e.isWebkit||a){if(a)k.dataTransfer.dropEffect="none";k.preventDefault&&k.preventDefault();return!1}}},_handleDragLeave:function(a){if(!this._ignoreEvent(a)&&(this._dropTarget=!1,this.isListening("DragLeave")))this.onDragLeave(this._createMouseEvent("DragLeave",a))},_handleDrop:function(a){if(!this._ignoreEvent(a)){this._dropTarget=
!1;if(this.isListening("Drop"))this.onDrop(this._createMouseEvent("Drop",a));a.preventDefault&&a.preventDefault();return!1}},_handleFocus:function(){this._hasFocus=!0;e.isIOS&&this._lastTouchOffset!==void 0?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=void 0):this._updateDOMSelection();if(this._cursorDiv)this._cursorDiv.style.display="block";if(this._selDiv1){var a=this._highlightRGB;this._selDiv1.style.background=a;this._selDiv2.style.background=a;this._selDiv3.style.background=
a}if(!this._ignoreFocus)this.onFocus({type:"Focus"})},_handleKeyDown:function(a){if(!this._ignoreEvent(a)){if(this.isListening("KeyDown")){var b=this._createKeyEvent("KeyDown",a);this.onKeyDown(b);if(b.defaultPrevented){if(e.isFirefox)this._keyDownPrevented=!0;a.preventDefault();return}}b=!1;switch(a.keyCode){case 16:case 17:case 18:case 91:b=!0;break;default:this._setLinksVisible(!1)}if(a.keyCode===229){if(this._readonly)return a.preventDefault&&a.preventDefault(),!1;b=!0;if(e.isSafari&&e.isMac&&
a.ctrlKey)b=!1,a.keyCode=129;b&&this._startIME()}else b||this._commitIME();if((e.isMac||e.isLinux)&&e.isFirefox<4||e.isOpera<12.16)return this._keyDownEvent=a,!0;if(this._doAction(a))return a.preventDefault?(a.preventDefault(),a.stopPropagation()):(a.cancelBubble=!0,a.returnValue=!1,a.keyCode=0),!1}},_handleKeyPress:function(a){if(!this._ignoreEvent(a))if(this._keyDownPrevented)a.preventDefault&&(a.preventDefault(),a.stopPropagation()),this._keyDownPrevented=void 0;else{if(e.isMac&&e.isWebkit&&(63232<=
a.keyCode&&a.keyCode<=63487||a.keyCode===13||a.keyCode===8))return a.preventDefault&&a.preventDefault(),!1;if(((e.isMac||e.isLinux)&&e.isFirefox<4||e.isOpera<12.16)&&this._doAction(this._keyDownEvent))return a.preventDefault&&a.preventDefault(),!1;var b=e.isMac?a.metaKey:a.ctrlKey;if(a.charCode!==void 0&&b)switch(a.charCode){case 99:case 118:case 120:return!0}if(this.isListening("KeyPress")&&(b=this._createKeyEvent("KeyPress",a),this.onKeyPress(b),b.defaultPrevented)){a.preventDefault();return}if(this._doAction(a))return a.preventDefault?
(a.preventDefault(),a.stopPropagation()):(a.cancelBubble=!0,a.returnValue=!1,a.keyCode=0),!1;b=!1;if(e.isMac){if(a.ctrlKey||a.metaKey)b=!0}else if(e.isFirefox){if(a.ctrlKey||a.altKey)b=!0}else a.ctrlKey^a.altKey&&(b=!0);if(!b&&(b=e.isOpera?a.which:a.charCode!==void 0?a.charCode:a.keyCode,b>31))return this._doContent(String.fromCharCode(b)),a.preventDefault&&a.preventDefault(),!1}},_handleDocKeyUp:function(a){(e.isMac?a.metaKey:a.ctrlKey)||this._setLinksVisible(!1)},_handleKeyUp:function(a){if(!this._ignoreEvent(a)){if(this.isListening("KeyUp")){var b=
this._createKeyEvent("KeyUp",a);this.onKeyUp(b);if(b.defaultPrevented){a.preventDefault();return}}this._handleDocKeyUp(a);a.keyCode===13&&this._commitIME()}},_handleLinkClick:function(a){if(!(e.isMac?a.metaKey:a.ctrlKey))return a.preventDefault&&a.preventDefault(),!1},_handleMouse:function(a){var b=this._getWindow(),d=!0,c=b;if(e.isIE||e.isFirefox&&!this._overlayDiv)c=this._clientDiv;if(this._overlayDiv){if(this._hasFocus)this._ignoreFocus=!0;var h=this;b.setTimeout(function(){h.focus();h._ignoreFocus=
!1},0)}this._clickCount===1?(d=this._setSelectionTo(a.clientX,a.clientY,a.shiftKey,(!e.isOpera||e.isOpera>=12.16)&&this._hasFocus&&this.isListening("DragStart")))&&this._setGrab(c):(this._isW3CEvents&&this._setGrab(c),this._doubleClickSelection=null,this._setSelectionTo(a.clientX,a.clientY,a.shiftKey),this._doubleClickSelection=this._getSelection());return d},_handleMouseDown:function(a){if(!this._ignoreEvent(a)){if(this._linksVisible)if((a.target||a.srcElement).tagName!=="A")this._setLinksVisible(!1);
else return;this._commitIME();var b=a.which;b||(a.button===4&&(b=2),a.button===2&&(b=3),a.button===1&&(b=1));var d=b!==2&&a.timeStamp?a.timeStamp:(new Date).getTime(),c=d-this._lastMouseTime,h=Math.abs(this._lastMouseX-a.clientX),m=Math.abs(this._lastMouseY-a.clientY),f=this._lastMouseButton===b;this._lastMouseX=a.clientX;this._lastMouseY=a.clientY;this._lastMouseTime=d;this._lastMouseButton=b;if(b===1)this._isMouseDown=!0,f&&c<=this._clickTime&&h<=this._clickDist&&m<=this._clickDist?this._clickCount++:
this._clickCount=1;if(this.isListening("MouseDown")&&(d=this._createMouseEvent("MouseDown",a),this.onMouseDown(d),d.defaultPrevented)){a.preventDefault();return}if(b===1&&this._handleMouse(a)&&(e.isIE>=9||e.isOpera||e.isChrome||e.isSafari||e.isFirefox&&!this._overlayDiv))this._hasFocus||this.focus(),a.preventDefault();e.isFirefox&&this._lastMouseButton===3&&this._updateDOMSelection()}},_handleMouseOver:function(a){if(!this._ignoreEvent(a)&&!this._animation&&this.isListening("MouseOver"))this.onMouseOver(this._createMouseEvent("MouseOver",
a))},_handleMouseOut:function(a){if(!this._ignoreEvent(a)&&!this._animation&&this.isListening("MouseOut"))this.onMouseOut(this._createMouseEvent("MouseOut",a))},_handleMouseMove:function(a){if(!this._animation){var b=this._isClientDiv(a);if(this.isListening("MouseMove")&&b)this.onMouseMove(this._createMouseEvent("MouseMove",a));if(!this._dropTarget){var d=this._linksVisible||this._lastMouseMoveX!==a.clientX||this._lastMouseMoveY!==a.clientY;this._lastMouseMoveX=a.clientX;this._lastMouseMoveY=a.clientY;
this._setLinksVisible(d&&!this._isMouseDown&&(e.isMac?a.metaKey:a.ctrlKey));if(!this._isW3CEvents){if(a.button===0)return this._setGrab(null),!0;if(!this._isMouseDown&&a.button===1&&(this._clickCount&1)!==0&&b)return this._clickCount=2,this._handleMouse(a,this._clickCount)}if(this._isMouseDown&&this._dragOffset===-1){var b=a.clientX,a=a.clientY,c=this._getViewPadding(),h=this._viewDiv.getBoundingClientRect(),m=this._getClientWidth(),f=this._getClientHeight(),d=h.left+c.left,g=h.top+c.top,m=h.left+
c.left+m,c=h.top+c.top+f;a<g?this._doAutoScroll("up",b,a-g):a>c?this._doAutoScroll("down",b,a-c):b<d&&!this._wrapMode?this._doAutoScroll("left",b-d,a):b>m&&!this._wrapMode?this._doAutoScroll("right",b-m,a):(this._endAutoScroll(),this._setSelectionTo(b,a,!0))}}}},_isClientDiv:function(a){for(var b=this._overlayDiv||this._clientDiv,a=a.target?a.target:a.srcElement;a;){if(b===a)return!0;a=a.parentNode}return!1},_createKeyEvent:function(a,b){return{type:a,event:b,preventDefault:function(){this.defaultPrevented=
!0}}},_createMouseEvent:function(a,b){var d=this.convert({x:b.clientX,y:b.clientY},"page","document");return{type:a,event:b,clickCount:this._clickCount,x:d.x,y:d.y,preventDefault:function(){this.defaultPrevented=!0}}},_handleMouseUp:function(a){var b=a.which?a.button===0:a.button===1;if(this.isListening("MouseUp")&&(this._isClientDiv(a)||b&&this._isMouseDown))this.onMouseUp(this._createMouseEvent("MouseUp",a));if(!this._linksVisible&&b&&this._isMouseDown){if(this._dragOffset!==-1)b=this._getSelection(),
b.extend(this._dragOffset),b.collapse(),this._setSelection(b,!0,!0),this._dragOffset=-1;this._isMouseDown=!1;this._endAutoScroll();this._isW3CEvents&&this._setGrab(null);e.isFirefox&&a.preventDefault()}},_handleMouseWheel:function(a){var b=this._getLineHeight(),d=0,c=0;e.isIE||e.isOpera?c=-a.wheelDelta/40*b:e.isFirefox?(b=e.isMac?a.detail*3:Math.max(-256,Math.min(256,a.detail))*b,a.axis===a.HORIZONTAL_AXIS?d=b:c=b):e.isMac?(c=a.timeStamp-this._wheelTimeStamp,this._wheelTimeStamp=a.timeStamp,d=a.wheelDeltaX%
120!==0?1:c<40?40/(40-c):40,c=a.wheelDeltaY%120!==0?1:c<40?40/(40-c):40,d=Math.ceil(-a.wheelDeltaX/d),-1<d&&d<0&&(d=-1),0<d&&d<1&&(d=1),c=Math.ceil(-a.wheelDeltaY/c),-1<c&&c<0&&(c=-1),0<c&&c<1&&(c=1)):(d=-a.wheelDeltaX,c=-a.wheelDeltaY/120*8*b);if(e.isSafari){for(b=a.target;b&&b.lineIndex===void 0;)b=b.parentNode;this._mouseWheelLine=b}b=this._getScroll();this._scrollView(d,c);d=this._getScroll();if(b.x!==d.x||b.y!==d.y)return a.preventDefault&&a.preventDefault(),!1},_handlePaste:function(a){if(!this._ignoreEvent(a)&&
!this._ignorePaste&&this._doPaste(a)){if(e.isIE){var b=this;this._ignoreFocus=!0;this._getWindow().setTimeout(function(){b._updateDOMSelection();b._ignoreFocus=!1},0)}a.preventDefault&&a.preventDefault();return!1}},_handleResize:function(){var k=this._rootDiv.clientWidth,b=this._rootDiv.clientHeight;if(this._rootWidth!==k||this._rootHeight!==b){this._rootWidth!==k&&this._wrapMode&&this._resetLineHeight();this._rootWidth=k;this._rootHeight=b;k=e.isIE<9;b=this._calculateMetrics();if(!a(b,this._metrics)){if(this._variableLineHeight)this._variableLineHeight=
!1,this._resetLineHeight();this._metrics=b;k=!0}k?this._queueUpdate():this._update()}},_handleRulerEvent:function(a){for(var b=a.target?a.target:a.srcElement,d=b.lineIndex;b&&!b._ruler;){if(d===void 0&&b.lineIndex!==void 0)d=b.lineIndex;b=b.parentNode}var c=b?b._ruler:null;if(d===void 0&&c&&c.getOverview()==="document"){var d=this._getClientHeight(),h=this._model.getLineCount(),m=this._getViewPadding(),e=this._viewDiv.getBoundingClientRect(),d=Math.floor((a.clientY-e.top-this._metrics.scrollWidth)*
h/(d+m.top+m.bottom-2*this._metrics.scrollWidth));0<=d&&d<h||(d=void 0)}if(c)switch(a.type){case "click":if(c.onClick)c.onClick(d,a);break;case "dblclick":if(c.onDblClick)c.onDblClick(d,a);break;case "mousemove":if(c.onMouseMove)c.onMouseMove(d,a);break;case "mouseover":if(c.onMouseOver)c.onMouseOver(d,a);break;case "mouseout":if(c.onMouseOut){for(h=a.relatedTarget;h&&h!==this._rootDiv;){if(h===b)return;h=h.parentNode}c.onMouseOut(d,a)}}},_handleScroll:function(){var a=this._getScroll(!1),b=this._hScroll,
d=this._vScroll;if(b!==a.x||d!==a.y)this._hScroll=a.x,this._vScroll=a.y,this._commitIME(),this._update(d===a.y),this.onScroll({type:"Scroll",oldValue:{x:b,y:d},newValue:a})},_handleSelectStart:function(a){if(this._ignoreSelect)return a&&a.preventDefault&&a.preventDefault(),!1},_getModelOffset:function(a,b){if(a){var d;d=a.tagName==="DIV"?a:a.parentNode.parentNode;var c=0,h=d.lineIndex;if(a.tagName!=="DIV")for(d=d.firstChild;d;){var m=d.firstChild;if(m===a){d.ignoreChars&&(c-=d.ignoreChars);c+=b;break}d.ignoreChars&&
(c-=d.ignoreChars);c+=m.data.length;d=d.nextSibling}return Math.max(0,c)+this._model.getLineStart(h)}},_updateSelectionFromDOM:function(){var a=this._getWindow().getSelection(),b=this._getModelOffset(a.anchorNode,a.anchorOffset),a=this._getModelOffset(a.focusNode,a.focusOffset);b===void 0||a===void 0||this._setSelection(new p(b,a),!1,!1)},_handleSelectionChange:function(){if(this._imeOffset===-1)if(e.isAndroid){var a=this._getWindow();this._selTimer&&a.clearTimeout(this._selTimer);var b=this;this._selTimer=
a.setTimeout(function(){if(b._clientDiv)b._selTimer=null,b._updateSelectionFromDOM()},250)}else this._updateSelectionFromDOM()},_handleTextInput:function(a){if(!this._ignoreEvent(a)){this._imeOffset=-1;var b=this._getWindow().getSelection();if(b.anchorNode!==this._anchorNode||b.focusNode!==this._focusNode||b.anchorOffset!==this._anchorOffset||b.focusOffset!==this._focusOffset){for(var d=b.anchorNode;d;){if(d.lineIndex!==void 0)break;d=d.parentNode}if(d){var c=this._model,h=d.lineIndex,m=c.getLine(h),
e=m,f=0,c=c.getLineStart(h);if(b.rangeCount>0)b.getRangeAt(0).deleteContents(),h=d.ownerDocument.createTextNode(a.data),b.getRangeAt(0).insertNode(h),f=this._getDOMText(d,h),e=f.text,f=f.offset,h.parentNode.removeChild(h);d.lineRemoved=!0;for(d=0;m.charCodeAt(d)===e.charCodeAt(d)&&d<f;)d++;b=m.length-1;for(h=e.length-m.length;m.charCodeAt(b)===e.charCodeAt(b+h)&&b+h>=f+a.data.length;)b--;b++;m=e.substring(d,b+h);d+=c;b+=c;this._modifyContent({text:m,start:d,end:b,_ignoreDOMSelection:!0},!0)}}else this._doContent(a.data);
a.preventDefault()}},_handleTouchStart:function(a){this._commitIME();var b=this._getWindow();if(this._touchScrollTimer)this._vScrollDiv.style.display="none",this._hScrollDiv.style.display="none",b.clearInterval(this._touchScrollTimer),this._touchScrollTimer=null;var d=a.touches;if(d.length===1){var d=d[0],c=d.clientX,h=d.clientY;this._touchStartX=c;this._touchStartY=h;if(e.isAndroid&&(h<d.pageY-b.pageYOffset||c<d.pageX-b.pageXOffset))c=d.pageX-b.pageXOffset,h=d.pageY-b.pageYOffset;b=this.convert({x:c,
y:h},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(b.x,b.y);this._touchStartTime=a.timeStamp;this._touching=!0}},_handleTouchMove:function(a){var b=a.touches;if(b.length===1){b=b[0];this._touchCurrentX=b.clientX;this._touchCurrentY=b.clientY;if(!this._touchScrollTimer&&a.timeStamp-this._touchStartTime<200){this._vScrollDiv.style.display="block";if(!this._wrapMode)this._hScrollDiv.style.display="block";var d=this,c=this._getWindow();this._touchScrollTimer=c.setInterval(function(){var a=
0,b=0;if(d._touching)a=d._touchStartX-d._touchCurrentX,b=d._touchStartY-d._touchCurrentY,d._touchSpeedX=a/10,d._touchSpeedY=b/10,d._touchStartX=d._touchCurrentX,d._touchStartY=d._touchCurrentY;else if(Math.abs(d._touchSpeedX)<0.1&&Math.abs(d._touchSpeedY)<0.1){d._vScrollDiv.style.display="none";d._hScrollDiv.style.display="none";c.clearInterval(d._touchScrollTimer);d._touchScrollTimer=null;return}else a=d._touchSpeedX*10,b=d._touchSpeedY*10,d._touchSpeedX*=0.95,d._touchSpeedY*=0.95;d._scrollView(a,
b)},10)}this._touchScrollTimer&&a.preventDefault()}},_handleTouchEnd:function(a){if(a.touches.length===0)this._touching=!1},_doAction:function(a){var b,d,c=this._keyModes;for(d=c.length-1;d>=0;d--)if(b=c[d],typeof b.match==="function"&&(b=b.match(a),b!==void 0))return this.invokeAction(b);return!1},_doMove:function(a,b){var d=this._model,c=b.getCaret(),h=d.getLineAtOffset(c);if(!a.count)a.count=1;for(;a.count!==0;){var m=d.getLineStart(h);if(a.count<0&&c===m)if(h>0)a.unit==="character"&&a.count++,
h--,b.extend(d.getLineEnd(h));else break;else if(a.count>0&&c===d.getLineEnd(h))if(h+1<d.getLineCount())a.unit==="character"&&a.count--,h++,b.extend(d.getLineStart(h));else break;else{var e=!1;a.expandTab&&a.unit==="character"&&(c-m)%this._tabSize===0&&(e=!/[^ ]/.test(d.getText(m,c)));e?(b.extend(c-this._tabSize),a.count+=a.count<0?1:-1):(m=this._getLine(h),b.extend(m.getNextOffset(c,a)),m.destroy())}c=b.getCaret()}return b},_doBackspace:function(a){var b=this._getSelection();if(b.isEmpty()){if(!a.count)a.count=
1;a.count*=-1;a.expandTab=this._expandTab;this._doMove(a,b)}this._modifyContent({text:"",start:b.start,end:b.end},!0);return!0},_doCase:function(a){var b=this._getSelection();this._doMove(a,b);var d=this.getText(b.start,b.end);this._setSelection(b,!0);switch(a.type){case "lower":d=d.toLowerCase();break;case "capitalize":d=d.replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()});break;case "reverse":a="";for(b=0;b<d.length;b++){var c=d[b],h=c.toLowerCase(),c=h!==c?h:c.toUpperCase();a+=c}d=a;break;
default:d=d.toUpperCase()}this._doContent(d);return!0},_doContent:function(a){var b=this._getSelection();if(this._overwriteMode&&b.isEmpty()){var d=this._model,c=d.getLineAtOffset(b.end);b.end<d.getLineEnd(c)&&(d=this._getLine(c),b.extend(d.getNextOffset(b.getCaret(),{unit:"character",count:1})),d.destroy())}this._modifyContent({text:a,start:b.start,end:b.end,_ignoreDOMSelection:!0},!0)},_doCopy:function(a){var b=this._getSelection();return!b.isEmpty()?this._setClipboardText(this._getBaseText(b.start,
b.end),a):!0},_doCursorNext:function(a){var b=this._getSelection();!b.isEmpty()&&!a.select?b.start=b.end:this._doMove(a,b);a.select||b.collapse();this._setSelection(b,!0);return!0},_doCursorPrevious:function(a){var b=this._getSelection();if(!b.isEmpty()&&!a.select)b.end=b.start;else{if(!a.count)a.count=1;a.count*=-1;this._doMove(a,b)}a.select||b.collapse();this._setSelection(b,!0);return!0},_doCut:function(a){var b=this._getSelection();return!b.isEmpty()?(b=this._getBaseText(b.start,b.end),this._doContent(""),
this._setClipboardText(b,a)):!0},_doDelete:function(a){var b=this._getSelection();b.isEmpty()&&this._doMove(a,b);this._modifyContent({text:"",start:b.start,end:b.end},!0);return!0},_doEnd:function(a){var b=this._getSelection(),d=this._model,c;if(a.ctrl)b.extend(d.getCharCount()),c=function(){};else{var h=b.getCaret(),m=d.getLineAtOffset(h);if(this._wrapMode){var e=this._getLine(m),h=e.getLineIndex(h),h=h===e.getLineCount()-1?d.getLineEnd(m):e.getLineStart(h+1)-1;e.destroy()}else a.count&&a.count>
0&&(m=Math.min(m+a.count-1,d.getLineCount()-1)),h=d.getLineEnd(m);b.extend(h)}a.select||b.collapse();this._setSelection(b,!0,!0,c);return!0},_doEnter:function(a){var b=this._model,d=this._getSelection();this._doContent(b.getLineDelimiter());if(a&&a.noCursor)d.end=d.start,this._setSelection(d,!0);return!0},_doHome:function(a){var b=this._getSelection(),d=this._model,c;if(a.ctrl)b.extend(0),c=function(){};else{var h=b.getCaret(),m=d.getLineAtOffset(h);this._wrapMode?(d=this._getLine(m),h=d.getLineIndex(h),
h=d.getLineStart(h),d.destroy()):h=d.getLineStart(m);b.extend(h)}a.select||b.collapse();this._setSelection(b,!0,!0,c);return!0},_doLineDown:function(a){var b=this._model,d=this._getSelection(),c=d.getCaret(),h=b.getLineAtOffset(c),m=this._getLine(h),f=this._columnX,g=1,j=!1;if(f===-1||a.wholeLine||a.select&&e.isIE)f=a.wholeLine?b.getLineEnd(h+1):c,f=m.getBoundingClientRect(f).left;(c=m.getLineIndex(c))<m.getLineCount()-1?g=m.getClientRects(c+1).top+1:(c=b.getLineCount()-1,j=h===c,a.count&&a.count>
0?h=Math.min(h+a.count,c):h++);c=!1;if(j){if(a.select||e.isMac||e.isLinux)d.extend(b.getCharCount()),c=!0}else m.lineIndex!==h&&(m.destroy(),m=this._getLine(h)),d.extend(m.getOffset(f,g)),c=!0;c&&(a.select||d.collapse(),this._setSelection(d,!0,!0));this._columnX=f;m.destroy();return!0},_doLineUp:function(a){var b=this._model,d=this._getSelection(),c=d.getCaret(),h=b.getLineAtOffset(c),m=this._getLine(h),f=this._columnX,g=!1,j;if(f===-1||a.wholeLine||a.select&&e.isIE)f=a.wholeLine?b.getLineStart(h-
1):c,f=m.getBoundingClientRect(f).left;(c=m.getLineIndex(c))>0?j=m.getClientRects(c-1).top+1:(g=h===0,g||(a.count&&a.count>0?h=Math.max(h-a.count,0):h--,j=this._getLineHeight(h)-1));c=!1;if(g){if(a.select||e.isMac||e.isLinux)d.extend(0),c=!0}else m.lineIndex!==h&&(m.destroy(),m=this._getLine(h)),d.extend(m.getOffset(f,j)),c=!0;c&&(a.select||d.collapse(),this._setSelection(d,!0,!0));this._columnX=f;m.destroy();return!0},_doNoop:function(){return!0},_doPageDown:function(a){var b=this,d=this._model,
c=this._getSelection(),h=c.getCaret(),m=d.getLineAtOffset(h),f=d.getLineCount(),g=this._getScroll(),d=this._getClientHeight(),j,p;if(this._lineHeight){j=this._columnX;g=this._getBoundsAtOffset(h);if(j===-1||a.select&&e.isIE)j=g.left;h=this._getLineIndex(g.top+d);p=this._getLine(h);m=this._getLinePixel(h);h=p.getOffset(j,g.top+d-m);d=p.getBoundingClientRect(h);p.destroy();c.extend(h);a.select||c.collapse();this._setSelection(c,!0,!0,function(){b._columnX=j},d.top+m-g.top);return!0}if(m<f-1){var i=
this._getLineHeight(),r=Math.min(f-m-1,Math.floor(d/i)),r=Math.max(1,r);j=this._columnX;if(j===-1||a.select&&e.isIE)p=this._getLine(m),j=p.getBoundingClientRect(h).left,p.destroy();p=this._getLine(m+r);c.extend(p.getOffset(j,0));p.destroy();a.select||c.collapse();a=f*i;h=g.y+r*i;h+d>a&&(h=a-d);this._setSelection(c,!0,!0,function(){b._columnX=j},h-g.y)}return!0},_doPageUp:function(a){var b=this,d=this._model,c=this._getSelection(),h=c.getCaret(),m=d.getLineAtOffset(h),f=this._getScroll(),g=this._getClientHeight(),
j;if(this._lineHeight){j=this._columnX;f=this._getBoundsAtOffset(h);if(j===-1||a.select&&e.isIE)j=f.left;h=this._getLineIndex(f.bottom-g);d=this._getLine(h);m=this._getLinePixel(h);h=d.getOffset(j,f.bottom-g-m);g=d.getBoundingClientRect(h);d.destroy();c.extend(h);a.select||c.collapse();this._setSelection(c,!0,!0,function(){b._columnX=j},g.top+m-f.top);return!0}if(m>0){var p=this._getLineHeight(),g=Math.max(1,Math.min(m,Math.floor(g/p)));j=this._columnX;if(j===-1||a.select&&e.isIE)d=this._getLine(m),
j=d.getBoundingClientRect(h).left,d.destroy();d=this._getLine(m-g);c.extend(d.getOffset(j,this._getLineHeight(m-g)-1));d.destroy();a.select||c.collapse();a=Math.max(0,f.y-g*p);this._setSelection(c,!0,!0,function(){b._columnX=j},a-f.y)}return!0},_doPaste:function(a){var b=this;return this._getClipboardText(a,function(a){a&&(e.isLinux&&b._lastMouseButton===2&&(new Date).getTime()-b._lastMouseTime<=b._clickTime&&b._setSelectionTo(b._lastMouseX,b._lastMouseY),b._doContent(a))})!==null},_doScroll:function(a){var b=
a.type,d=this._model,c=d.getLineCount(),a=this._getClientHeight(),h=this._getLineHeight();c*=h;var m=this._getScroll().y,e;switch(b){case "textStart":e=0;break;case "textEnd":e=c-a;break;case "pageDown":e=m+a;break;case "pageUp":e=m-a;break;case "lineDown":e=m+h;break;case "lineUp":e=m-h;break;case "centerLine":b=this._getSelection(),e=d.getLineAtOffset(b.start),d=(d.getLineAtOffset(b.end)-e+1)*h,e=e*h-a/2+d/2}e!==void 0&&(e=Math.min(Math.max(0,e),c-a),this._scrollViewAnimated(0,e-m,function(){}));
return!0},_doSelectAll:function(){var a=this._model,b=this._getSelection();b.setCaret(0);b.extend(a.getCharCount());this._setSelection(b,!1);return!0},_doTab:function(){if(this._tabMode&&!this._readonly){var a="\t";if(this._expandTab)var b=this._model,a=this._getSelection().getCaret(),d=b.getLineAtOffset(a),b=b.getLineStart(d),a=Array(this._tabSize-(a-b)%this._tabSize+1).join(" ");this._doContent(a);return!0}},_doShiftTab:function(){return!this._tabMode||this._readonly?void 0:!0},_doOverwriteMode:function(){if(!this._readonly)return this.setOptions({overwriteMode:!this.getOptions("overwriteMode")}),
!0},_doTabMode:function(){this._tabMode=!this._tabMode;return!0},_doWrapMode:function(){this.setOptions({wrapMode:!this.getOptions("wrapMode")});return!0},_autoScroll:function(){var a=this._model,b=this._getSelection(),d=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document"),c=b.getCaret(),h=a.getLineCount(),m=a.getLineAtOffset(c),f;if(this._autoScrollDir==="up"||this._autoScrollDir==="down")c=this._autoScrollY/this._getLineHeight(),c=c<0?Math.floor(c):Math.ceil(c),f=Math.max(0,
Math.min(h-1,m+c));else if(this._autoScrollDir==="left"||this._autoScrollDir==="right")f=this._getLineIndex(d.y),m=this._getLine(m),d.x+=m.getBoundingClientRect(c,!1).left,m.destroy();f===0&&(e.isMac||e.isLinux)?b.extend(0):f===h-1&&(e.isMac||e.isLinux)?b.extend(a.getCharCount()):(m=this._getLine(f),b.extend(m.getOffset(d.x,d.y-this._getLinePixel(f))),m.destroy());this._setSelection(b,!0)},_autoScrollTimer:function(){this._autoScroll();var a=this;this._autoScrollTimerID=this._getWindow().setTimeout(function(){a._autoScrollTimer()},
this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(a){if(this._lineHeight&&!this._calculateLHTimer){var b=this._model.getLineCount(),d=0;if(a){for(var a=0,c=(new Date).getTime(),h=0;d<b;)if(this._lineHeight[d]||(a++,h||(h=d),this._lineHeight[d]=this._calculateLineHeight(d)),d++,(new Date).getTime()-c>100)break;this.redrawRulers(0,b);this._queueUpdate()}a=this._getWindow();if(d!==b){var m=this;this._calculateLHTimer=a.setTimeout(function(){m._calculateLHTimer=null;m._calculateLineHeightTimer(!0)},
0)}else if(this._calculateLHTimer)a.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=void 0}},_calculateLineHeight:function(a){var a=this._getLine(a),b=a.getBoundingClientRect();a.destroy();return Math.max(1,b.bottom-b.top)},_calculateMetrics:function(){var a=this._clientDiv,b=a.ownerDocument,d=e.createElement(b,"div");d.style.lineHeight="normal";var c={type:"LineStyle",textView:this,0:0,lineText:this._model.getLine(0),lineStart:0};this.onLineStyle(c);g(c.style,d);d.style.position="fixed";
d.style.left="-1000px";var f=e.createElement(b,"span");f.appendChild(b.createTextNode(" "));d.appendChild(f);var j=e.createElement(b,"span");j.style.fontStyle="italic";j.appendChild(b.createTextNode(" "));d.appendChild(j);var p=e.createElement(b,"span");p.style.fontWeight="bold";p.appendChild(b.createTextNode(" "));d.appendChild(p);c=e.createElement(b,"span");c.style.fontWeight="bold";c.style.fontStyle="italic";c.appendChild(b.createTextNode(" "));d.appendChild(c);a.appendChild(d);var i=d.getBoundingClientRect(),
f=f.getBoundingClientRect(),j=j.getBoundingClientRect(),p=p.getBoundingClientRect(),c=c.getBoundingClientRect(),f=f.bottom-f.top,j=j.bottom-j.top,p=p.bottom-p.top,r=c.bottom-c.top,s=0,c=i.bottom-i.top<=0,i=Math.max(1,i.bottom-i.top);j>f&&(s=1);p>j&&(s=2);r>p&&(s=3);var q;if(s!==0){q={style:{}};if((s&1)!==0)q.style.fontStyle="italic";if((s&2)!==0)q.style.fontWeight="bold"}f=h(d);a.removeChild(d);r=m(this._viewDiv);d=e.createElement(b,"div");d.style.position="fixed";d.style.left="-1000px";d.style.paddingLeft=
r.left+"px";d.style.paddingTop=r.top+"px";d.style.paddingRight=r.right+"px";d.style.paddingBottom=r.bottom+"px";d.style.width="100px";d.style.height="100px";r=e.createElement(b,"div");r.style.width="100%";r.style.height="100%";d.appendChild(r);a.appendChild(d);s=d.getBoundingClientRect();j=r.getBoundingClientRect();p=0;if(!this._singleMode)d.style.overflow="hidden",r.style.height="200px",p=d.clientWidth,d.style.overflow="scroll",p-=d.clientWidth;a.removeChild(d);r={left:j.left-s.left,top:j.top-s.top,
right:s.right-j.right,bottom:s.bottom-j.bottom};j=s=0;if(!c&&(this._wrapOffset||this._marginOffset))d=e.createElement(b,"div"),d.style.position="fixed",d.style.left="-1000px",d.innerHTML=Array(this._wrapOffset+1).join(" "),a.appendChild(d),s=d.getBoundingClientRect(),s=Math.ceil(s.right-s.left),d.innerHTML=Array(this._marginOffset+1).join(" "),j=d.getBoundingClientRect(),j=Math.ceil(j.right-j.left),a.removeChild(d);return{lineHeight:i,largestFontStyle:q,lineTrim:f,viewPadding:r,scrollWidth:p,wrapWidth:s,
marginWidth:j,invalid:c}},_cancelAnimation:function(){if(this._animation)this._animation.stop(),this._animation=null},_clearSelection:function(a){var b=this._getSelection();if(b.isEmpty())return!1;a==="next"?b.start=b.end:b.end=b.start;this._setSelection(b,!0);return!0},_commitIME:function(){if(this._imeOffset!==-1){this._scrollDiv.focus();this._clientDiv.focus();var a=this._model,b=a.getLineAtOffset(this._imeOffset),d=a.getLineStart(b),c=this._getDOMText(this._getLineNode(b)).text,a=a.getLine(b),
d=this._imeOffset-d,a=d+c.length-a.length;d!==a&&this._doContent(c.substring(d,a));this._imeOffset=-1}},_createActions:function(){this.addKeyMode(new n.DefaultKeyMode(this));var a=this;this._actions={noop:{defaultHandler:function(){return a._doNoop()}},lineUp:{defaultHandler:function(d){return a._doLineUp(b(d,{select:!1}))},actionDescription:{name:l.lineUp}},lineDown:{defaultHandler:function(d){return a._doLineDown(b(d,{select:!1}))},actionDescription:{name:l.lineDown}},lineStart:{defaultHandler:function(d){return a._doHome(b(d,
{select:!1,ctrl:!1}))},actionDescription:{name:l.lineStart}},lineEnd:{defaultHandler:function(d){return a._doEnd(b(d,{select:!1,ctrl:!1}))},actionDescription:{name:l.lineEnd}},charPrevious:{defaultHandler:function(d){return a._doCursorPrevious(b(d,{select:!1,unit:"character"}))},actionDescription:{name:l.charPrevious}},charNext:{defaultHandler:function(d){return a._doCursorNext(b(d,{select:!1,unit:"character"}))},actionDescription:{name:l.charNext}},pageUp:{defaultHandler:function(d){return a._doPageUp(b(d,
{select:!1}))},actionDescription:{name:l.pageUp}},pageDown:{defaultHandler:function(d){return a._doPageDown(b(d,{select:!1}))},actionDescription:{name:l.pageDown}},scrollPageUp:{defaultHandler:function(d){return a._doScroll(b(d,{type:"pageUp"}))},actionDescription:{name:l.scrollPageUp}},scrollPageDown:{defaultHandler:function(d){return a._doScroll(b(d,{type:"pageDown"}))},actionDescription:{name:l.scrollPageDown}},scrollLineUp:{defaultHandler:function(d){return a._doScroll(b(d,{type:"lineUp"}))},
actionDescription:{name:l.scrollLineUp}},scrollLineDown:{defaultHandler:function(d){return a._doScroll(b(d,{type:"lineDown"}))},actionDescription:{name:l.scrollLineDown}},wordPrevious:{defaultHandler:function(d){return a._doCursorPrevious(b(d,{select:!1,unit:"word"}))},actionDescription:{name:l.wordPrevious}},wordNext:{defaultHandler:function(d){return a._doCursorNext(b(d,{select:!1,unit:"word"}))},actionDescription:{name:l.wordNext}},textStart:{defaultHandler:function(d){return a._doHome(b(d,{select:!1,
ctrl:!0}))},actionDescription:{name:l.textStart}},textEnd:{defaultHandler:function(d){return a._doEnd(b(d,{select:!1,ctrl:!0}))},actionDescription:{name:l.textEnd}},scrollTextStart:{defaultHandler:function(d){return a._doScroll(b(d,{type:"textStart"}))},actionDescription:{name:l.scrollTextStart}},scrollTextEnd:{defaultHandler:function(d){return a._doScroll(b(d,{type:"textEnd"}))},actionDescription:{name:l.scrollTextEnd}},centerLine:{defaultHandler:function(d){return a._doScroll(b(d,{type:"centerLine"}))},
actionDescription:{name:l.centerLine}},selectLineUp:{defaultHandler:function(d){return a._doLineUp(b(d,{select:!0}))},actionDescription:{name:l.selectLineUp}},selectLineDown:{defaultHandler:function(d){return a._doLineDown(b(d,{select:!0}))},actionDescription:{name:l.selectLineDown}},selectWholeLineUp:{defaultHandler:function(d){return a._doLineUp(b(d,{select:!0,wholeLine:!0}))},actionDescription:{name:l.selectWholeLineUp}},selectWholeLineDown:{defaultHandler:function(d){return a._doLineDown(b(d,
{select:!0,wholeLine:!0}))},actionDescription:{name:l.selectWholeLineDown}},selectLineStart:{defaultHandler:function(d){return a._doHome(b(d,{select:!0,ctrl:!1}))},actionDescription:{name:l.selectLineStart}},selectLineEnd:{defaultHandler:function(d){return a._doEnd(b(d,{select:!0,ctrl:!1}))},actionDescription:{name:l.selectLineEnd}},selectCharPrevious:{defaultHandler:function(d){return a._doCursorPrevious(b(d,{select:!0,unit:"character"}))},actionDescription:{name:l.selectCharPrevious}},selectCharNext:{defaultHandler:function(d){return a._doCursorNext(b(d,
{select:!0,unit:"character"}))},actionDescription:{name:l.selectCharNext}},selectPageUp:{defaultHandler:function(d){return a._doPageUp(b(d,{select:!0}))},actionDescription:{name:l.selectPageUp}},selectPageDown:{defaultHandler:function(d){return a._doPageDown(b(d,{select:!0}))},actionDescription:{name:l.selectPageDown}},selectWordPrevious:{defaultHandler:function(d){return a._doCursorPrevious(b(d,{select:!0,unit:"word"}))},actionDescription:{name:l.selectWordPrevious}},selectWordNext:{defaultHandler:function(d){return a._doCursorNext(b(d,
{select:!0,unit:"word"}))},actionDescription:{name:l.selectWordNext}},selectTextStart:{defaultHandler:function(d){return a._doHome(b(d,{select:!0,ctrl:!0}))},actionDescription:{name:l.selectTextStart}},selectTextEnd:{defaultHandler:function(d){return a._doEnd(b(d,{select:!0,ctrl:!0}))},actionDescription:{name:l.selectTextEnd}},deletePrevious:{defaultHandler:function(d){return a._doBackspace(b(d,{unit:"character"}))},actionDescription:{name:l.deletePrevious}},deleteNext:{defaultHandler:function(d){return a._doDelete(b(d,
{unit:"character"}))},actionDescription:{name:l.deleteNext}},deleteWordPrevious:{defaultHandler:function(d){return a._doBackspace(b(d,{unit:"word"}))},actionDescription:{name:l.deleteWordPrevious}},deleteWordNext:{defaultHandler:function(d){return a._doDelete(b(d,{unit:"word"}))},actionDescription:{name:l.deleteWordNext}},deleteLineStart:{defaultHandler:function(d){return a._doBackspace(b(d,{unit:"line"}))},actionDescription:{name:l.deleteLineStart}},deleteLineEnd:{defaultHandler:function(d){return a._doDelete(b(d,
{unit:"line"}))},actionDescription:{name:l.deleteLineEnd}},tab:{defaultHandler:function(){return a._doTab()},actionDescription:{name:l.tab}},shiftTab:{defaultHandler:function(){return a._doShiftTab()},actionDescription:{name:l.shiftTab}},enter:{defaultHandler:function(){return a._doEnter()},actionDescription:{name:l.enter}},enterNoCursor:{defaultHandler:function(d){return a._doEnter(b(d,{noCursor:!0}))},actionDescription:{name:l.enterNoCursor}},selectAll:{defaultHandler:function(){return a._doSelectAll()},
actionDescription:{name:l.selectAll}},copy:{defaultHandler:function(){return a._doCopy()},actionDescription:{name:l.copy}},cut:{defaultHandler:function(){return a._doCut()},actionDescription:{name:l.cut}},paste:{defaultHandler:function(){return a._doPaste()},actionDescription:{name:l.paste}},uppercase:{defaultHandler:function(d){return a._doCase(b(d,{type:"upper"}))},actionDescription:{name:l.uppercase}},lowercase:{defaultHandler:function(d){return a._doCase(b(d,{type:"lower"}))},actionDescription:{name:l.lowercase}},
capitalize:{defaultHandler:function(d){return a._doCase(b(d,{unit:"word",type:"capitalize"}))},actionDescription:{name:l.capitalize}},reversecase:{defaultHandler:function(d){return a._doCase(b(d,{type:"reverse"}))},actionDescription:{name:l.reversecase}},toggleOverwriteMode:{defaultHandler:function(){return a._doOverwriteMode()},actionDescription:{name:l.toggleOverwriteMode}},toggleTabMode:{defaultHandler:function(){return a._doTabMode()},actionDescription:{name:l.toggleTabMode}},toggleWrapMode:{defaultHandler:function(){return a._doWrapMode()},
actionDescription:{name:l.toggleWrapMode}}}},_createRulerParent:function(a){var b=e.createElement(document,"div");b.className=a;b.tabIndex=-1;b.style.overflow="hidden";b.style.MozUserSelect="none";b.style.WebkitUserSelect="none";b.style.position="absolute";b.style.top="0px";b.style.bottom="0px";b.style.cursor="default";b.style.display="none";b.setAttribute("aria-hidden","true");this._rootDiv.appendChild(b);return b},_createRuler:function(a,b){if(this._clientDiv){var d=this._getRulerParent(a);if(d){if(d!==
this._marginDiv||this._marginOffset)d.style.display="block";var c=e.createElement(d.ownerDocument,"div");c._ruler=a;c.rulerChanged=!0;c.style.position="relative";c.style.cssFloat="left";c.style.styleFloat="left";c.style.outline="none";if(b===void 0||b<0||b>=d.children.length)d.appendChild(c);else{for(var h=d.firstChild;h&&b-- >0;)h=h.nextSibling;d.insertBefore(c,h)}}}},_createView:function(){if(!this._clientDiv){for(var a=this._parent;a.hasChildNodes();)a.removeChild(a.lastChild);var b=a.ownerDocument,
d=e.createElement(b,"div");this._rootDiv=d;d.tabIndex=-1;d.style.position="relative";d.style.overflow="hidden";d.style.width="100%";d.style.height="100%";d.style.overflow="hidden";d.style.WebkitTextSizeAdjust="100%";d.setAttribute("role","application");a.appendChild(d);this._leftDiv=this._createRulerParent("textviewLeftRuler");a=e.createElement(b,"div");a.className="textviewScroll";this._viewDiv=a;a.tabIndex=-1;a.style.position="absolute";a.style.top="0px";a.style.bottom="0px";a.style.borderWidth=
"0px";a.style.margin="0px";a.style.outline="none";a.style.background="transparent";if(e.isMac&&e.isWebkit)a.style.pointerEvents="none",a.style.zIndex="2";d.appendChild(a);var c=this._createRulerParent("textviewRightRuler");this._rightDiv=c;c.style.right="0px";this._scrollDiv=c=e.createElement(b,"div");c.style.margin="0px";c.style.borderWidth="0px";c.style.padding="0px";a.appendChild(c);(this._marginDiv=this._createRulerParent("textviewMarginRuler")).style.zIndex="4";if(!e.isIE&&!e.isIOS)this._clipDiv=
a=e.createElement(b,"div"),a.style.position="absolute",a.style.overflow="hidden",a.style.margin="0px",a.style.borderWidth="0px",a.style.padding="0px",a.style.background="transparent",d.appendChild(a),this._clipScrollDiv=c=e.createElement(b,"div"),c.style.position="absolute",c.style.height="1px",c.style.top="-1000px",c.style.background="transparent",a.appendChild(c);this._setFullSelection(this._fullSelection,!0);a=e.createElement(b,"div");a.className="textviewContent";this._clientDiv=a;a.tabIndex=
0;a.style.position="absolute";a.style.borderWidth="0px";a.style.margin="0px";a.style.padding="0px";a.style.outline="none";a.style.zIndex="1";a.style.WebkitUserSelect="text";a.setAttribute("spellcheck","false");if(e.isIOS||e.isAndroid)a.style.WebkitTapHighlightColor="transparent";(this._clipDiv||d).appendChild(a);if(e.isIOS||e.isAndroid)this._vScrollDiv=c=e.createElement(b,"div"),c.style.position="absolute",c.style.borderWidth="1px",c.style.borderColor="white",c.style.borderStyle="solid",c.style.borderRadius=
"4px",c.style.backgroundColor="black",c.style.opacity="0.5",c.style.margin="0px",c.style.padding="0px",c.style.outline="none",c.style.zIndex="3",c.style.width="8px",c.style.display="none",d.appendChild(c),this._hScrollDiv=c=e.createElement(b,"div"),c.style.position="absolute",c.style.borderWidth="1px",c.style.borderColor="white",c.style.borderStyle="solid",c.style.borderRadius="4px",c.style.backgroundColor="black",c.style.opacity="0.5",c.style.margin="0px",c.style.padding="0px",c.style.outline="none",
c.style.zIndex="3",c.style.height="8px",c.style.display="none",d.appendChild(c);if(e.isFirefox&&!a.setCapture)this._overlayDiv=b=e.createElement(b,"div"),b.style.position=a.style.position,b.style.borderWidth=a.style.borderWidth,b.style.margin=a.style.margin,b.style.padding=a.style.padding,b.style.cursor="text",b.style.zIndex="2",(this._clipDiv||d).appendChild(b);a.contentEditable="true";a.setAttribute("role","textbox");a.setAttribute("aria-multiline","true");this._setWrapMode(this._wrapMode,!0);this._setReadOnly(this._readonly);
this._setThemeClass(this._themeClass,!0);this._setTabSize(this._tabSize,!0);this._setMarginOffset(this._marginOffset,!0);this._hookEvents();d=this._rulers;for(b=0;b<d.length;b++)this._createRuler(d[b]);this._update()}},_defaultOptions:function(){return{parent:{value:void 0,update:null},model:{value:void 0,update:this.setModel},scrollAnimation:{value:0,update:null},readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},tabMode:{value:!0,update:null},tabSize:{value:8,
update:this._setTabSize},expandTab:{value:!1,update:null},singleMode:{value:!1,update:this._setSingleMode},overwriteMode:{value:!1,update:this._setOverwriteMode},blockCursorVisible:{value:!1,update:this._setBlockCursor},marginOffset:{value:0,update:this._setMarginOffset},wrapOffset:{value:0,update:this._setWrapOffset},wrapMode:{value:!1,update:this._setWrapMode},wrappable:{value:!1,update:null},theme:{value:c.TextTheme.getTheme(),update:this._setTheme},themeClass:{value:void 0,update:this._setThemeClass}}},
_destroyRuler:function(a){var b=this._getRulerParent(a);if(b)for(var d=b.firstChild;d;){if(d._ruler===a){d._ruler=void 0;b.removeChild(d);if(b.children.length===0&&(b!==this._marginDiv||!this._marginOffset))b.style.display="none";break}d=d.nextSibling}},_destroyView:function(){if(this._clientDiv){this._setGrab(null);this._unhookEvents();var a=this._getWindow();if(this._autoScrollTimerID)a.clearTimeout(this._autoScrollTimerID),this._autoScrollTimerID=null;if(this._updateTimer)a.clearTimeout(this._updateTimer),
this._updateTimer=null;a=this._rootDiv;a.parentNode.removeChild(a);this._hScrollDiv=this._vScrollDiv=this._cursorDiv=this._marginDiv=this._rightDiv=this._leftDiv=this._overlayDiv=this._clientDiv=this._clipScrollDiv=this._clipDiv=this._viewDiv=this._scrollDiv=this._rootDiv=this._clipboardDiv=this._selDiv3=this._selDiv2=this._selDiv1=null}},_doAutoScroll:function(a,b,d){this._autoScrollDir=a;this._autoScrollX=b;this._autoScrollY=d;this._autoScrollTimerID||this._autoScrollTimer()},_endAutoScroll:function(){this._autoScrollTimerID&&
this._getWindow().clearTimeout(this._autoScrollTimerID);this._autoScrollTimerID=this._autoScrollDir=void 0},_fixCaret:function(){var a=this._clientDiv;if(a){var b=this._hasFocus;this._ignoreFocus=!0;b&&a.blur();a.contentEditable=!1;a.contentEditable=!0;b&&a.focus();this._ignoreFocus=!1}},_getBaseText:function(a,b){var d=this._model;d.getBaseModel&&(a=d.mapOffset(a),b=d.mapOffset(b),d=d.getBaseModel());return d.getText(a,b)},_getBottomIndex:function(a){var b=this._bottomChild;if(a&&this._getClientHeight()>
this._getLineHeight()){var a=b.getBoundingClientRect(),d=this._clientDiv.getBoundingClientRect();a.bottom>d.bottom&&(b=this._getLinePrevious(b)||b)}return b.lineIndex},_getBoundsAtOffset:function(a){var b=this._getLine(this._model.getLineAtOffset(a)),a=b.getBoundingClientRect(a),d=this._getLinePixel(b.lineIndex);a.top+=d;a.bottom+=d;b.destroy();return a},_getClientHeight:function(){var a=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-a.top-a.bottom)},_getClientWidth:function(){var a=
this._getViewPadding();return Math.max(0,this._viewDiv.clientWidth-a.left-a.right)},_getClipboardText:function(a,b){var c=this._model.getLineDelimiter(),h,m,f=this._getWindow(),g=f.clipboardData;if(!g&&a)g=a.clipboardData;if(g)return h=[],m=g.getData(e.isIE?"Text":"text/plain"),d(m,function(a){h.push(a)},function(){h.push(c)}),m=h.join(""),b&&b(m),m;if(e.isFirefox){this._ignoreFocus=!0;var j=this._clipboardDiv,g=this._rootDiv.ownerDocument;if(!j)this._clipboardDiv=j=e.createElement(g,"div"),j.style.position=
"fixed",j.style.whiteSpace="pre",j.style.left="-1000px",this._rootDiv.appendChild(j);j.innerHTML="<pre contenteditable=''></pre>";j.firstChild.focus();var p=this,i=function(){var a=p._getTextFromElement(j);j.innerHTML="";h=[];d(a,function(a){h.push(a)},function(){h.push(c)});return h.join("")},r=!1;this._ignorePaste=!0;if(!e.isLinux||this._lastMouseButton!==2)try{r=g.execCommand("paste",!1,null)}catch(s){r=j.childNodes.length>1||j.firstChild&&j.firstChild.childNodes.length>0}this._ignorePaste=!1;
if(!r)return a?(f.setTimeout(function(){p.focus();(m=i())&&b&&b(m);p._ignoreFocus=!1},0),null):(this.focus(),this._ignoreFocus=!1,"");this.focus();this._ignoreFocus=!1;(m=i())&&b&&b(m);return m}return""},_getDOMText:function(a,b){for(var d=a.firstChild,c="",h=0;d;){var m;if(!d.ignore)if(d.ignoreChars){m=d.lastChild;for(var e=0,f=[],g=-1;m;){var j=m.data;if(j)for(var p=j.length-1;p>=0;p--){var i=j.substring(p,p+1);e<d.ignoreChars&&(i===" "||i==="\u200b"||i==="\ufeff")?e++:f.push(i==="\u00a0"?"\t":
i)}if(b===m)g=f.length;m=m.previousSibling}f=f.reverse().join("");g!==-1&&(h=c.length+f.length-g);c+=f}else for(m=d.firstChild;m;){if(b===m)h=c.length;c+=m.data;m=m.nextSibling}d=d.nextSibling}return{text:c,offset:h}},_getTextFromElement:function(a){var b=a.ownerDocument,d=b.defaultView;if(!d.getSelection)return a.innerText||a.textContent;b=b.createRange();b.selectNode(a);var a=d.getSelection(),d=[],c;for(c=0;c<a.rangeCount;c++)d.push(a.getRangeAt(c));this._ignoreSelect=!0;a.removeAllRanges();a.addRange(b);
b=a.toString();a.removeAllRanges();for(c=0;c<d.length;c++)a.addRange(d[c]);this._ignoreSelect=!1;return b},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(a){var b=this._getLineNode(a);return b&&!b.lineChanged&&!b.lineRemoved?b._line:new r(this,a)},_getLineHeight:function(a,b){if(a!==void 0&&this._lineHeight){var d=this._lineHeight[a];if(d)return d;if(b||b===void 0)return this._lineHeight[a]=this._calculateLineHeight(a)}return this._metrics.lineHeight},_getLineNode:function(a){for(var b=
this._clientDiv.firstChild;b;){if(a===b.lineIndex)return b;b=b.nextSibling}},_getLineNext:function(a){for(a=a?a.nextSibling:this._clientDiv.firstChild;a&&a.lineIndex===-1;)a=a.nextSibling;return a},_getLinePrevious:function(a){for(a=a?a.previousSibling:this._clientDiv.lastChild;a&&a.lineIndex===-1;)a=a.previousSibling;return a},_getLinePixel:function(a){a=Math.min(Math.max(0,a),this._model.getLineCount());if(this._lineHeight){var b=this._getTopIndex(),d=-this._topIndexY+this._getScroll().y;if(a>b)for(;b<
a;b++)d+=this._getLineHeight(b);else for(b-=1;b>=a;b--)d-=this._getLineHeight(b);return d}return this._getLineHeight()*a},_getLineIndex:function(a){var b,d=0,c=this._model.getLineCount();if(this._lineHeight){var d=this._getTopIndex(),h=-this._topIndexY+this._getScroll().y;if(a!==h)if(a<h)for(;a<h&&d>0;)a+=this._getLineHeight(--d);else for(b=this._getLineHeight(d);a-b>=h&&d<c-1;)a-=b,b=this._getLineHeight(++d)}else b=this._getLineHeight(),d=Math.floor(a/b);return Math.max(0,Math.min(c-1,d))},_getRulerParent:function(a){switch(a.getLocation()){case "left":return this._leftDiv;
case "right":return this._rightDiv;case "margin":return this._marginDiv}return null},_getScroll:function(a){(a===void 0||a)&&this._cancelAnimation();a=this._viewDiv;return{x:a.scrollLeft,y:a.scrollTop}},_getSelection:function(){return this._selection.clone()},_getTopIndex:function(a){var b=this._topChild;if(a&&this._getClientHeight()>this._getLineHeight()){var a=b.getBoundingClientRect(),d=this._getViewPadding(),c=this._viewDiv.getBoundingClientRect();a.top<c.top+d.top&&(b=this._getLineNext(b)||b)}return b.lineIndex},
_hookEvents:function(){var a=this;this._modelListener={onChanging:function(b){a._onModelChanging(b)},onChanged:function(b){a._onModelChanged(b)}};this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._themeListener={onChanged:function(){a._setThemeClass(a._themeClass)}};this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);var b=this._handlers=[],d=this._clientDiv,c=this._viewDiv,
h=this._rootDiv,m=this._overlayDiv||d,f=d.ownerDocument,g=this._getWindow(),j=e.isIE?f:g;b.push({target:g,type:"resize",handler:function(b){return a._handleResize(b?b:g.event)}});b.push({target:d,type:"blur",handler:function(b){return a._handleBlur(b?b:g.event)}});b.push({target:d,type:"focus",handler:function(b){return a._handleFocus(b?b:g.event)}});b.push({target:c,type:"focus",handler:function(){d.focus()}});b.push({target:c,type:"scroll",handler:function(b){return a._handleScroll(b?b:g.event)}});
b.push({target:d,type:"textInput",handler:function(b){return a._handleTextInput(b?b:g.event)}});b.push({target:d,type:"keydown",handler:function(b){return a._handleKeyDown(b?b:g.event)}});b.push({target:d,type:"keypress",handler:function(b){return a._handleKeyPress(b?b:g.event)}});b.push({target:d,type:"keyup",handler:function(b){return a._handleKeyUp(b?b:g.event)}});e.isIE&&b.push({target:f,type:"keyup",handler:function(b){return a._handleDocKeyUp(b?b:g.event)}});b.push({target:d,type:"contextmenu",
handler:function(b){return a._handleContextMenu(b?b:g.event)}});b.push({target:d,type:"copy",handler:function(b){return a._handleCopy(b?b:g.event)}});b.push({target:d,type:"cut",handler:function(b){return a._handleCut(b?b:g.event)}});b.push({target:d,type:"paste",handler:function(b){return a._handlePaste(b?b:g.event)}});if(e.isIOS||e.isAndroid)b.push({target:f,type:"selectionchange",handler:function(b){return a._handleSelectionChange(b?b:g.event)}}),b.push({target:d,type:"touchstart",handler:function(b){return a._handleTouchStart(b?
b:g.event)}}),b.push({target:d,type:"touchmove",handler:function(b){return a._handleTouchMove(b?b:g.event)}}),b.push({target:d,type:"touchend",handler:function(b){return a._handleTouchEnd(b?b:g.event)}});else{b.push({target:d,type:"selectstart",handler:function(b){return a._handleSelectStart(b?b:g.event)}});b.push({target:d,type:"mousedown",handler:function(b){return a._handleMouseDown(b?b:g.event)}});b.push({target:d,type:"mouseover",handler:function(b){return a._handleMouseOver(b?b:g.event)}});
b.push({target:d,type:"mouseout",handler:function(b){return a._handleMouseOut(b?b:g.event)}});b.push({target:j,type:"mouseup",handler:function(b){return a._handleMouseUp(b?b:g.event)}});b.push({target:j,type:"mousemove",handler:function(b){return a._handleMouseMove(b?b:g.event)}});b.push({target:h,type:"mousedown",handler:function(b){return a._handleRootMouseDown(b?b:g.event)}});b.push({target:h,type:"mouseup",handler:function(b){return a._handleRootMouseUp(b?b:g.event)}});b.push({target:m,type:"dragstart",
handler:function(b){return a._handleDragStart(b?b:g.event)}});b.push({target:m,type:"drag",handler:function(b){return a._handleDrag(b?b:g.event)}});b.push({target:m,type:"dragend",handler:function(b){return a._handleDragEnd(b?b:g.event)}});b.push({target:m,type:"dragenter",handler:function(b){return a._handleDragEnter(b?b:g.event)}});b.push({target:m,type:"dragover",handler:function(b){return a._handleDragOver(b?b:g.event)}});b.push({target:m,type:"dragleave",handler:function(b){return a._handleDragLeave(b?
b:g.event)}});b.push({target:m,type:"drop",handler:function(b){return a._handleDrop(b?b:g.event)}});b.push({target:this._clientDiv,type:e.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(b){return a._handleMouseWheel(b?b:g.event)}});this._clipDiv&&b.push({target:this._clipDiv,type:e.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(b){return a._handleMouseWheel(b?b:g.event)}});if(e.isFirefox&&(!e.isWindows||e.isFirefox>=15))(c=g.MutationObserver||g.MozMutationObserver)?(this._mutationObserver=
new c(function(b){a._handleDataModified(b)}),this._mutationObserver.observe(d,{subtree:!0,characterData:!0})):b.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(b){return a._handleDataModified(b?b:g.event)}});this._overlayDiv&&(b.push({target:this._overlayDiv,type:"mousedown",handler:function(b){return a._handleMouseDown(b?b:g.event)}}),b.push({target:this._overlayDiv,type:"mouseover",handler:function(b){return a._handleMouseOver(b?b:g.event)}}),b.push({target:this._overlayDiv,
type:"mouseout",handler:function(b){return a._handleMouseOut(b?b:g.event)}}),b.push({target:this._overlayDiv,type:"contextmenu",handler:function(b){return a._handleContextMenu(b?b:g.event)}}));this._isW3CEvents||b.push({target:this._clientDiv,type:"dblclick",handler:function(b){return a._handleDblclick(b?b:g.event)}})}this._hookRulerEvents(this._leftDiv,b);this._hookRulerEvents(this._rightDiv,b);this._hookRulerEvents(this._marginDiv,b);for(c=0;c<b.length;c++)h=b[c],u(h.target,h.type,h.handler,h.capture)},
_hookRulerEvents:function(a,b){if(a){var d=this,c=this._getWindow();e.isIE&&b.push({target:a,type:"selectstart",handler:function(){return!1}});b.push({target:a,type:e.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(a){return d._handleMouseWheel(a?a:c.event)}});b.push({target:a,type:"click",handler:function(a){d._handleRulerEvent(a?a:c.event)}});b.push({target:a,type:"dblclick",handler:function(a){d._handleRulerEvent(a?a:c.event)}});b.push({target:a,type:"mousemove",handler:function(a){d._handleRulerEvent(a?
a:c.event)}});b.push({target:a,type:"mouseover",handler:function(a){d._handleRulerEvent(a?a:c.event)}});b.push({target:a,type:"mouseout",handler:function(a){d._handleRulerEvent(a?a:c.event)}})}},_getWindow:function(){return this._parent.ownerDocument.defaultView||this._parent.ownerDocument.parentWindow},_ignoreEvent:function(a){for(a=a.target;a&&a!==this._clientDiv;){if(a.ignore)return!0;a=a.parentNode}return!1},_init:function(a){var b=a.parent;typeof b==="string"&&(b=(a.document||document).getElementById(b));
if(!b)throw"no parent";a.parent=b;a.model=a.model||new o.TextModel;var d=this._defaultOptions(),c;for(c in d)d.hasOwnProperty(c)&&(this["_"+c]=a[c]!==void 0?a[c]:d[c].value);this._keyModes=[];this._rulers=[];this._selection=new p(0,0,!1);this._linksVisible=!1;this._maxLineWidth=this._redrawCount=0;this._maxLineIndex=-1;this._ignoreSelect=!0;this._hasFocus=this._ignoreFocus=!1;this._dragOffset=this._columnX=-1;this._isRangeRects=(!e.isIE||e.isIE>=9)&&typeof b.ownerDocument.createRange().getBoundingClientRect===
"function";this._isW3CEvents=b.addEventListener;this._autoScrollTimerID=this._autoScrollY=this._autoScrollX=null;this._AUTO_SCROLL_RATE=50;this._mouseUpClosure=this._moseMoveClosure=this._grabControl=null;this._clickCount=this._lastMouseTime=this._lastMouseY=this._lastMouseX=0;this._clickTime=250;this._clickDist=5;this._isMouseDown=!1;this._doubleClickSelection=null;this._vScroll=this._hScroll=0;this._imeOffset=-1;this._createActions();this._createView()},_modifyContent:function(a,b){if(!this._readonly||
a._code)if(a.type="Verify",this.onVerify(a),!(a.text===null||a.text===void 0)){var d=this._model;try{if(a._ignoreDOMSelection)this._ignoreDOMSelection=!0;d.setText(a.text,a.start,a.end)}finally{if(a._ignoreDOMSelection)this._ignoreDOMSelection=!1}b&&(d=this._getSelection(),d.setCaret(a.start+a.text.length),this._setSelection(d,!0));this.onModify({type:"Modify"})}},_onModelChanged:function(a){a.type="ModelChanged";this.onModelChanged(a);a.type="Changed";var b=a.start,d=a.addedCharCount,c=a.removedCharCount,
h=a.addedLineCount,m=a.removedLineCount,e=this._getSelection();e.end>b&&(e.end>b&&e.start<b+c?e.setCaret(b+d):(e.start+=d-c,e.end+=d-c),this._setSelection(e,!1,!1));b=this._model.getLineAtOffset(b);for(d=this._getLineNext();d;){c=d.lineIndex;if(b<=c&&c<=b+m)b===c&&!d.modelChangedEvent&&!d.lineRemoved?(d.modelChangedEvent=a,d.lineChanged=!0):(d.lineRemoved=!0,d.lineChanged=!1,d.modelChangedEvent=null);if(c>b+m)d.lineIndex=c+h-m,d._line.lineIndex=d.lineIndex;d=this._getLineNext(d)}this._lineHeight&&
(a=[b,m].concat(Array(h)),Array.prototype.splice.apply(this._lineHeight,a));if(!this._wrapMode&&b<=this._maxLineIndex&&this._maxLineIndex<=b+m)this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0;this._update()},_onModelChanging:function(a){a.type="ModelChanging";this.onModelChanging(a);a.type="Changing"},_queueUpdate:function(){if(!this._updateTimer&&!this._ignoreQueueUpdate){var a=this;this._updateTimer=this._getWindow().setTimeout(function(){a._updateTimer=null;
a._update()},0)}},_resetLineHeight:function(a,b){if(this._wrapMode||this._variableLineHeight){if(a!==void 0&&b!==void 0)for(var d=a;d<b;d++)this._lineHeight[d]=void 0;else this._lineHeight=Array(this._model.getLineCount());this._calculateLineHeightTimer()}else this._lineHeight=null},_resetLineWidth:function(){var a=this._clientDiv;if(a)for(a=a.firstChild;a;)a.lineWidth=void 0,a=a.nextSibling},_reset:function(){this._maxLineIndex=-1;this._maxLineWidth=0;this._columnX=-1;this._bottomChild=this._topChild=
null;this._topIndexY=0;this._variableLineHeight=!1;this._resetLineHeight();this._setSelection(new p(0,0,!1),!1,!1);if(this._viewDiv)this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0;var a=this._clientDiv;if(a){for(var b=a.firstChild;b;)b.lineRemoved=!0,b=b.nextSibling;if(e.isFirefox)this._ignoreFocus=!1,(b=this._hasFocus)&&a.blur(),a.contentEditable=!1,a.contentEditable=!0,b&&a.focus(),this._ignoreFocus=!1}},_scrollViewAnimated:function(a,b,d){var c=this._getWindow();if(d&&this._scrollAnimation){var h=
this;this._animation=new v({window:c,duration:this._scrollAnimation,curve:[b,0],onAnimate:function(a){a=b-Math.floor(a);h._scrollView(0,a);b-=a},onEnd:function(){h._animation=null;h._scrollView(a,b);d&&c.setTimeout(d,0)}});this._animation.play()}else this._scrollView(a,b),d&&c.setTimeout(d,0)},_scrollView:function(a,b){this._ensureCaretVisible=!1;var d=this._viewDiv;a&&(d.scrollLeft+=a);b&&(d.scrollTop+=b)},_setClipboardText:function(a,b){var c,h=this._getWindow(),m=h.clipboardData;if(!m&&b)m=b.clipboardData;
if(m&&(c=[],d(a,function(a){c.push(a)},function(){c.push(e.platformDelimiter)}),m.setData(e.isIE?"Text":"text/plain",c.join(""))))return!0;var f=this._parent.ownerDocument,g=e.createElement(f,"pre");g.style.position="fixed";g.style.left="-1000px";d(a,function(a){g.appendChild(f.createTextNode(a))},function(){g.appendChild(e.createElement(f,"br"))});g.appendChild(f.createTextNode(" "));this._clientDiv.appendChild(g);m=f.createRange();m.setStart(g.firstChild,0);m.setEndBefore(g.lastChild);var j=h.getSelection();
j.rangeCount>0&&j.removeAllRanges();j.addRange(m);var p=this,m=function(){g&&g.parentNode===p._clientDiv&&p._clientDiv.removeChild(g);p._updateDOMSelection()},j=!1;this._ignoreCopy=!0;try{j=f.execCommand("copy",!1,null)}catch(i){}this._ignoreCopy=!1;if(!j&&b)return h.setTimeout(m,0),!1;m();return!0},_setDOMSelection:function(a,b,d,c,h){for(var m,f,g,j,p=0,i=a.firstChild,r,s,q=this._model.getLine(a.lineIndex).length;i;){if(!i.ignore){r=i.firstChild;s=r.length;i.ignoreChars&&(s-=i.ignoreChars);if(p+
s>b||p+s>=q){m=r;f=b-p;i.ignoreChars&&s>0&&f===s&&(f+=i.ignoreChars);break}p+=s}i=i.nextSibling}for(var p=0,i=d.firstChild,u=this._model.getLine(d.lineIndex).length;i;){if(!i.ignore){r=i.firstChild;s=r.length;i.ignoreChars&&(s-=i.ignoreChars);if(s+p>c||p+s>=u){g=r;j=c-p;i.ignoreChars&&s>0&&j===s&&(j+=i.ignoreChars);break}p+=s}i=i.nextSibling}this._setDOMFullSelection(a,b,q,d,c,u);a=this._getWindow();b=this._parent.ownerDocument;if(a.getSelection){d=a.getSelection();a=b.createRange();a.setStart(m,
f);a.setEnd(g,j);if(this._hasFocus&&(d.anchorNode!==m||d.anchorOffset!==f||d.focusNode!==g||d.focusOffset!==j||d.anchorNode!==g||d.anchorOffset!==j||d.focusNode!==m||d.focusOffset!==f))this._anchorNode=m,this._anchorOffset=f,this._focusNode=g,this._focusOffset=j,this._ignoreSelect=!1,d.rangeCount>0&&d.removeAllRanges(),d.addRange(a),this._ignoreSelect=!0;if(this._cursorDiv&&(a=b.createRange(),h?(a.setStart(m,f),a.setEnd(m,f)):(a.setStart(g,j),a.setEnd(g,j)),g=a.getClientRects()[0],j=this._cursorDiv.parentNode,
m=j.getBoundingClientRect(),g&&m))this._cursorDiv.style.top=g.top-m.top+j.scrollTop+"px",this._cursorDiv.style.left=g.left-m.left+j.scrollLeft+"px"}else if(b.selection&&this._hasFocus)h=b.body,a=e.createElement(b,"div"),h.appendChild(a),h.removeChild(a),a=h.createTextRange(),a.moveToElementText(m.parentNode),a.moveStart("character",f),m=h.createTextRange(),m.moveToElementText(g.parentNode),m.moveStart("character",j),a.setEndPoint("EndToStart",m),this._ignoreSelect=!1,a.select(),this._ignoreSelect=
!0},_setDOMFullSelection:function(a,b,d,c,h){if(this._selDiv1&&(d=this._selDiv1,d.style.width="0px",d.style.height="0px",d=this._selDiv2,d.style.width="0px",d.style.height="0px",d=this._selDiv3,d.style.width="0px",d.style.height="0px",!(a===c&&b===h))){var m=this._model,e=this._getViewPadding(),f=this._clientDiv.getBoundingClientRect(),g=this._viewDiv.getBoundingClientRect(),d=g.left+e.left,j=f.right,e=g.top+e.top,p=f.bottom,g=f=0;this._clipDiv?(g=this._clipDiv.getBoundingClientRect(),f=g.left-this._clipDiv.scrollLeft):
(g=this._rootDiv.getBoundingClientRect(),f=g.left);g=g.top;this._ignoreDOMSelection=!0;var i=(new r(this,a.lineIndex,a)).getBoundingClientRect(m.getLineStart(a.lineIndex)+b,!1),s=i.left,b=(new r(this,c.lineIndex,c)).getBoundingClientRect(m.getLineStart(c.lineIndex)+h,!1),m=b.left;this._ignoreDOMSelection=!1;var q=this._selDiv1,s=Math.min(j,Math.max(d,s)),u=Math.min(p,Math.max(e,i.top)),l=j,h=Math.min(p,Math.max(e,i.bottom));q.style.left=s-f+"px";q.style.top=u-g+"px";q.style.width=Math.max(0,l-s)+
"px";q.style.height=Math.max(0,h-u)+"px";if(a.lineIndex===c.lineIndex)l=Math.min(m,j),q.style.width=Math.max(0,l-s)+"px";else if(i=Math.min(p,Math.max(e,b.top)),m=Math.min(j,Math.max(d,m)),e=Math.min(p,Math.max(e,b.bottom)),p=this._selDiv3,p.style.left=d-f+"px",p.style.top=i-g+"px",p.style.width=Math.max(0,m-d)+"px",p.style.height=Math.max(0,e-i)+"px",Math.abs(a.lineIndex-c.lineIndex)>1)a=this._selDiv2,a.style.left=d-f+"px",a.style.top=h-g+"px",a.style.width=Math.max(0,j-d)+"px",a.style.height=Math.max(0,
i-h)+"px"}},_setGrab:function(a){if(a!==this._grabControl)a?(a.setCapture&&a.setCapture(),this._grabControl=a):(this._grabControl.releaseCapture&&this._grabControl.releaseCapture(),this._grabControl=null)},_setLinksVisible:function(a){if(this._linksVisible!==a){this._linksVisible=a;if(e.isIE&&a)this._hadFocus=this._hasFocus;var b=this._clientDiv;b.contentEditable=!a;this._hadFocus&&!a&&b.focus();if(this._overlayDiv)this._overlayDiv.style.zIndex=a?"-1":"1";for(a=this._getLineNext();a;){if(a.hasLink)for(b=
a.firstChild;b;)if(b.ignore)b=b.nextSibling;else{var d=b.nextSibling,c=b.viewStyle;c&&c.tagName&&c.tagName.toLowerCase()==="a"&&a.replaceChild(a._line._createSpan(a,b.firstChild.data,c),b);b=d}a=this._getLineNext(a)}this._updateDOMSelection()}},_setSelection:function(a,b,d,c,h){if(a){this._columnX=-1;d===void 0&&(d=!0);var m=this._selection;this._selection=a;b!==!1&&this._showCaret(!1,c,b,h);d&&this._updateDOMSelection();if(!m.equals(a))this.onSelection({type:"Selection",oldValue:{start:m.start,end:m.end},
newValue:{start:a.start,end:a.end}})}},_setSelectionTo:function(a,b,d,c){var h=this._model,m=this._getSelection(),b=this.convert({x:a,y:b},"page","document"),a=this._getLineIndex(b.y);if(this._clickCount===1){h=this._getLine(a);a=h.getOffset(b.x,b.y-this._getLinePixel(a));h.destroy();if(c&&!d&&m.start<=a&&a<m.end)return this._dragOffset=a,!1;m.extend(a);d||m.collapse()}else(this._clickCount&1)===0?(h=this._getLine(a),a=h.getOffset(b.x,b.y-this._getLinePixel(a)),this._doubleClickSelection?a>=this._doubleClickSelection.start?
(d=this._doubleClickSelection.start,c=h.getNextOffset(a,{unit:"wordend",count:1})):(d=h.getNextOffset(a,{unit:"word",count:-1}),c=this._doubleClickSelection.end):(d=h.getNextOffset(a,{unit:"word",count:-1}),c=h.getNextOffset(d,{unit:"wordend",count:1})),h.destroy()):this._doubleClickSelection?(c=h.getLineAtOffset(this._doubleClickSelection.start),a>=c?(d=h.getLineStart(c),c=h.getLineEnd(a)):(d=h.getLineStart(a),c=h.getLineEnd(c))):(d=h.getLineStart(a),c=h.getLineEnd(a)),m.setCaret(d),m.extend(c);
this._setSelection(m,!0,!0);return!0},_setFullSelection:function(a,b){this._fullSelection=a;if(e.isWebkit)this._fullSelection=!0;var d=this._clipDiv||this._rootDiv;if(d)if(this._fullSelection){if(!this._selDiv1&&this._fullSelection&&!e.isIOS){var c=d.ownerDocument;this._highlightRGB=e.isWebkit?"transparent":"Highlight";var h=e.createElement(c,"div");this._selDiv1=h;h.style.position="absolute";h.style.borderWidth="0px";h.style.margin="0px";h.style.padding="0px";h.style.outline="none";h.style.background=
this._highlightRGB;h.style.width="0px";h.style.height="0px";h.style.zIndex="0";d.appendChild(h);var m=e.createElement(c,"div");this._selDiv2=m;m.style.position="absolute";m.style.borderWidth="0px";m.style.margin="0px";m.style.padding="0px";m.style.outline="none";m.style.background=this._highlightRGB;m.style.width="0px";m.style.height="0px";m.style.zIndex="0";d.appendChild(m);this._selDiv3=c=e.createElement(c,"div");c.style.position="absolute";c.style.borderWidth="0px";c.style.margin="0px";c.style.padding=
"0px";c.style.outline="none";c.style.background=this._highlightRGB;c.style.width="0px";c.style.height="0px";c.style.zIndex="0";d.appendChild(c);if(e.isFirefox&&e.isMac){d=this._getWindow().getComputedStyle(c,null).getPropertyValue("background-color");switch(d){case "rgb(119, 141, 168)":d="rgb(199, 208, 218)";break;case "rgb(127, 127, 127)":d="rgb(198, 198, 198)";break;case "rgb(255, 193, 31)":d="rgb(250, 236, 115)";break;case "rgb(243, 70, 72)":d="rgb(255, 176, 139)";break;case "rgb(255, 138, 34)":d=
"rgb(255, 209, 129)";break;case "rgb(102, 197, 71)":d="rgb(194, 249, 144)";break;case "rgb(140, 78, 184)":d="rgb(232, 184, 255)";break;default:d="rgb(180, 213, 255)"}this._highlightRGB=d;h.style.background=d;m.style.background=d;c.style.background=d}b||this._updateDOMSelection()}}else{if(this._selDiv1)d.removeChild(this._selDiv1),this._selDiv1=null;if(this._selDiv2)d.removeChild(this._selDiv2),this._selDiv2=null;if(this._selDiv3)d.removeChild(this._selDiv3),this._selDiv3=null}},_setBlockCursor:function(a){this._blockCursorVisible=
a;this._updateBlockCursorVisible()},_setOverwriteMode:function(a){this._overwriteMode=a;this._updateBlockCursorVisible()},_updateBlockCursorVisible:function(){if(this._blockCursorVisible||this._overwriteMode){if(!this._cursorDiv){var a=e.createElement(document,"div");a.className="textviewBlockCursor";this._cursorDiv=a;a.tabIndex=-1;a.style.zIndex="2";a.style.color="transparent";a.style.position="absolute";a.style.pointerEvents="none";a.innerHTML="&nbsp;";this._viewDiv.appendChild(a);this._updateDOMSelection()}}else if(this._cursorDiv)this._cursorDiv.parentNode.removeChild(this._cursorDiv),
this._cursorDiv=null},_setMarginOffset:function(a,b){this._marginOffset=a;this._marginDiv.style.display=a?"block":"none";if(!b)this._metrics=this._calculateMetrics(),this._queueUpdate()},_setWrapOffset:function(a,b){this._wrapOffset=a;if(!b)this._metrics=this._calculateMetrics(),this._queueUpdate()},_setReadOnly:function(a){this._readonly=a;this._clientDiv.setAttribute("aria-readonly",a?"true":"false")},_setSingleMode:function(a,b){this._singleMode=a;this._updateOverflow();this._updateStyle(b)},_setTabSize:function(a,
b){this._tabSize=a;this._customTabSize=void 0;var d=this._clientDiv;if(e.isOpera){if(d)d.style.OTabSize=this._tabSize+""}else if(e.isWebkit>=537.1){if(d)d.style.tabSize=this._tabSize+""}else if(e.isFirefox>=4){if(d)d.style.MozTabSize=this._tabSize+""}else if(this._tabSize!==8)this._customTabSize=this._tabSize;b||(this.redrawLines(),this._resetLineWidth())},_setTheme:function(a){this._theme&&this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);(this._theme=a)&&this._theme.addEventListener("ThemeChanged",
this._themeListener.onChanged);this._setThemeClass(this._themeClass)},_setThemeClass:function(a,b){this._themeClass=a;var d="textview",c=this._theme.getThemeClass();c&&(d+=" "+c);this._themeClass&&c!==this._themeClass&&(d+=" "+this._themeClass);this._rootDiv.className=d;this._updateStyle(b)},_setWrapMode:function(a,b){this._wrapMode=a&&this._wrappable;var d=this._clientDiv;this._wrapMode?(d.style.whiteSpace="pre-wrap",d.style.wordWrap="break-word"):(d.style.whiteSpace="pre",d.style.wordWrap="normal");
this._updateOverflow();b||(this.redraw(),this._resetLineWidth());this._resetLineHeight()},_showCaret:function(a,b,d,c){if(this._clientDiv){var h=this._model,m=this._getSelection(),e=this._getScroll(),f=m.getCaret(),g=m.start,j=m.end,p=h.getLineAtOffset(j),i=Math.max(Math.max(g,h.getLineStart(p)),j-1),h=this._getClientWidth(),p=this._getClientHeight(),r=h/4,s=this._getBoundsAtOffset(f===g?g:i),q=s.left,u=s.right,l=s.top,n=s.bottom;a&&!m.isEmpty()&&(s=this._getBoundsAtOffset(f===j?g:i),s.top===l?f===
g?u=q+Math.min(s.right-q,h):q=u-Math.min(u-s.left,h):f===g?n=l+Math.min(s.bottom-l,p):l=n-Math.min(n-s.top,p));a=0;q<e.x&&(a=Math.min(q-e.x,-r));u>e.x+h&&(a=Math.max(u-e.x-h,r));m=0;l<e.y?m=l-e.y:n>e.y+p&&(m=n-e.y-p);c&&(c>0?m>0&&(m=Math.max(m,c)):m<0&&(m=Math.min(m,c)));if(a!==0||m!==0)return m!==0&&typeof d==="number"&&(d<0&&(d=0),d>1&&(d=1),m+=Math.floor(m>0?d*p:-d*p)),this._scrollViewAnimated(a,m,b),p!==this._getClientHeight()||h!==this._getClientWidth()?this._showCaret():this._ensureCaretVisible=
!0,!0;else b&&b();return!1}},_startIME:function(){if(this._imeOffset===-1){var a=this._getSelection();a.isEmpty()||this._modifyContent({text:"",start:a.start,end:a.end},!0);this._imeOffset=a.start}},_unhookEvents:function(){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);this._modelListener=null;for(var a=0;a<this._handlers.length;a++){var b=
this._handlers[a];w(b.target,b.type,b.handler)}this._handlers=null;if(this._mutationObserver)this._mutationObserver.disconnect(),this._mutationObserver=null},_updateDOMSelection:function(){if(!(this._redrawCount>0)&&!this._ignoreDOMSelection&&this._clientDiv){var a=this._getSelection(),b=this._model,d=b.getLineAtOffset(a.start),c=b.getLineAtOffset(a.end),h=this._getLineNext();if(h){var m=this._getLinePrevious(),e;d<h.lineIndex?(e=h,d=0):d>m.lineIndex?(e=m,d=0):(e=this._getLineNode(d),d=a.start-b.getLineStart(d));
c<h.lineIndex?b=0:c>m.lineIndex?(h=m,b=0):(h=this._getLineNode(c),b=a.end-b.getLineStart(c));this._setDOMSelection(e,d,h,b,a.caret)}}},_update:function(a){if(!(this._redrawCount>0)){if(this._updateTimer)this._getWindow().clearTimeout(this._updateTimer),this._updateTimer=null,a=!1;var b=this._clientDiv,d=this._viewDiv;if(b){if(this._metrics.invalid)this._ignoreQueueUpdate=!0,this._updateStyle(),this._ignoreQueueUpdate=!1;var c=this._model,h=this._getScroll(!1),m=this._getViewPadding(),f=c.getLineCount(),
g=this._getLineHeight(),j=!1,p=!1,i=!1,s=this._metrics.scrollWidth;if(this._wrapMode)b.style.width=(this._metrics.wrapWidth||this._getClientWidth())+"px";var q,u,l,n,o=0,w=0,v;if(this._lineHeight){for(;w<f;){v=this._getLineHeight(w);if(o+v>h.y)break;o+=v;w++}q=w;u=Math.max(0,q-1);l=c=h.y-o;q>0&&(c+=this._getLineHeight(q-1))}else n=Math.max(0,h.y)/g,q=Math.floor(n),u=Math.max(0,q-1),c=Math.round((n-u)*g),l=Math.round((n-q)*g);this._topIndexY=l;n=this._rootDiv;var F=n.clientWidth,E=n.clientHeight;if(a){g=
0;this._leftDiv&&(q=this._leftDiv.getBoundingClientRect(),g=q.right-q.left);q=this._getClientWidth();n=this._getClientHeight();p=q;if(this._wrapMode){if(this._metrics.wrapWidth)p=this._metrics.wrapWidth}else p=Math.max(this._maxLineWidth,p);for(;w<f;)v=this._getLineHeight(w,!1),o+=v,w++;f=o}else{n=this._getClientHeight();l=Math.min(q+Math.floor((n+l)/g),f-1);var h=Math.min(l+1,f-1),A;for(v=b.firstChild;v;){A=v.lineIndex;var z=v.nextSibling;if(!(u<=A&&A<=h)||v.lineRemoved||v.lineIndex===-1)this._mouseWheelLine===
v?(v.style.display="none",v.lineIndex=-1):b.removeChild(v);v=z}v=this._getLineNext();var z=d.ownerDocument,C=z.createDocumentFragment();for(A=u;A<=h;A++)if(!v||v.lineIndex>A)(new r(this,A)).create(C,null);else{C.firstChild&&(b.insertBefore(C,v),C=z.createDocumentFragment());if(v&&v.lineChanged)v=(new r(this,A)).create(C,v),v.lineChanged=!1;v=this._getLineNext(v)}C.firstChild&&b.insertBefore(C,v);if(e.isWebkit&&!this._wrapMode)b.style.width="0x7fffffffpx";v=this._getLineNext();A=n+c;for(C=!1;v;){u=
v.lineWidth;if(u===void 0)if(z=v._line.getBoundingClientRect(),u=v.lineWidth=Math.ceil(z.right-z.left),z=z.bottom-z.top,this._lineHeight)this._lineHeight[v.lineIndex]=z;else if(g!==0&&z!==0&&Math.ceil(g)!==Math.ceil(z))this._variableLineHeight=!0,this._lineHeight=[],this._lineHeight[v.lineIndex]=z;if(this._lineHeight&&!C&&(A-=this._lineHeight[v.lineIndex],A<0))l=v.lineIndex,C=!0;if(!this._wrapMode){if(u>=this._maxLineWidth)this._maxLineWidth=u,this._maxLineIndex=v.lineIndex;if(this._checkMaxLineIndex===
v.lineIndex)this._checkMaxLineIndex=-1}if(v.lineIndex===q)this._topChild=v;if(v.lineIndex===l)this._bottomChild=v;v=this._getLineNext(v)}if(this._checkMaxLineIndex!==-1&&(A=this._checkMaxLineIndex,this._checkMaxLineIndex=-1,0<=A&&A<f)){g=new r(this,A);z=g.getBoundingClientRect();u=z.right-z.left;if(u>=this._maxLineWidth)this._maxLineWidth=u,this._maxLineIndex=A;g.destroy()}for(;w<f;)v=this._getLineHeight(w,w<=l),o+=v,w++;f=o;this._updateRuler(this._leftDiv,q,h,E);this._updateRuler(this._rightDiv,
q,h,E);this._updateRuler(this._marginDiv,q,h,E);g=0;this._leftDiv&&(q=this._leftDiv.getBoundingClientRect(),g=q.right-q.left);h=0;this._rightDiv&&(h=this._rightDiv.getBoundingClientRect(),h=h.right-h.left);d.style.left=g+"px";d.style.right=h+"px";h=this._scrollDiv;h.style.height=f+"px";q=this._getClientWidth();if(!this._singleMode&&!this._wrapMode){o=j=n;(w=d.style.overflowX==="scroll")?j+=s:o-=s;v=l=q;(u=d.style.overflowY==="scroll")?l+=s:v-=s;n=j;q=l;f>n&&(i=!0,q=v);this._maxLineWidth>q&&(p=!0,
n=o,f>n&&(i=!0,q=v));if(w!==p)d.style.overflowX=p?"scroll":"hidden";if(u!==i)d.style.overflowY=i?"scroll":"hidden";j=w!==p||u!==i}i=q;if(this._wrapMode){if(this._metrics.wrapWidth)i=this._metrics.wrapWidth}else i=Math.max(this._maxLineWidth,i);p=i;if((!e.isIE||e.isIE>=9)&&this._maxLineWidth>q)i+=m.right+m.left;h.style.width=i+"px";if(this._clipScrollDiv)this._clipScrollDiv.style.width=i+"px";h=this._getScroll(!1)}if(this._vScrollDiv)i=n-8,o=Math.max(15,Math.ceil(Math.min(1,i/(f+m.top+m.bottom))*i)),
this._vScrollDiv.style.left=g+q-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,h.y*i/f))+"px",this._vScrollDiv.style.height=o+"px";if(!this._wrapMode&&this._hScrollDiv)i=q-8,o=Math.max(15,Math.ceil(Math.min(1,i/(this._maxLineWidth+m.left+m.right))*i)),this._hScrollDiv.style.left=g+Math.floor(Math.max(0,Math.floor(h.x*i/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=n-9+"px",this._hScrollDiv.style.width=o+"px";w=h.x;o=this._clipDiv;i=this._overlayDiv;if(l=this._marginDiv)l.style.left=
-w+g+this._metrics.marginWidth+m.left+"px",l.style.bottom=(d.style.overflowX==="scroll"?s:0)+"px";if(o){o.scrollLeft=w;o.scrollTop=0;d=g+m.left;s=m.top;a=q;g=n;w=0;l=-c;if(h.x===0)d-=m.left,a+=m.left,w=m.left;h.x+q===p&&(a+=m.right);h.y===0&&(s-=m.top,g+=m.top,l+=m.top);h.y+n===f&&(g+=m.bottom);o.style.left=d+"px";o.style.top=s+"px";o.style.right=F-a-d+"px";o.style.bottom=E-g-s+"px";b.style.left=w+"px";b.style.top=l+"px";b.style.width=p+"px";b.style.height=n+c+"px";if(i)i.style.left=b.style.left,
i.style.top=b.style.top,i.style.width=b.style.width,i.style.height=b.style.height}else{d=w;s=c;F=w+q;E=c+n;d===0&&(d-=m.left);s===0&&(s-=m.top);F===p&&(F+=m.right);h.y+n===f&&(E+=m.bottom);b.style.clip="rect("+s+"px,"+F+"px,"+E+"px,"+d+"px)";b.style.left=-w+g+m.left+"px";b.style.width=(this._wrapMode||e.isWebkit?p:q+w)+"px";if(!a)b.style.top=-c+m.top+"px",b.style.height=n+c+"px";if(i&&(i.style.clip=b.style.clip,i.style.left=b.style.left,i.style.width=b.style.width,!a))i.style.top=b.style.top,i.style.height=
b.style.height}this._updateDOMSelection();if(j)b=this._ensureCaretVisible,this._ensureCaretVisible=!1,b&&this._showCaret(),this._queueUpdate()}}},_updateOverflow:function(){var a=this._viewDiv;this._wrapMode?(a.style.overflowX="hidden",a.style.overflowY="scroll"):a.style.overflow="hidden"},_updateRuler:function(a,b,d,c){if(a)for(var h=this._parent.ownerDocument,m=this._getLineHeight(),f=this._getViewPadding(),a=a.firstChild;a;){var j=a._ruler,p=m,i=j.getOverview();i==="page"&&(p+=this._topIndexY);
a.style.top=-p+"px";a.style.height=c+p+"px";a.rulerChanged&&g(j.getRulerStyle(),a);var r,s=a.firstChild;s?(r=s,s=s.nextSibling):(r=e.createElement(h,"div"),r.style.visibility="hidden",a.appendChild(r));var q;if(a.rulerChanged&&r){p=-1;if(q=j.getWidestAnnotation())if(g(q.style,r),q.html)r.innerHTML=q.html;r.lineIndex=p;r.style.height=m+f.top+"px"}var u;if(i==="page"){for(j=j.getAnnotations(b,d+1);s;)p=s.lineIndex,q=s.nextSibling,(!(b<=p&&p<=d)||s.lineChanged)&&a.removeChild(s),s=q;s=a.firstChild.nextSibling;
u=h.createDocumentFragment();for(p=b;p<=d;p++)if(!s||s.lineIndex>p){r=e.createElement(h,"div");if(q=j[p]){g(q.style,r);if(q.html)r.innerHTML=q.html;r.annotation=q}r.lineIndex=p;r.style.height=this._getLineHeight(p)+"px";u.appendChild(r)}else if(u.firstChild&&(a.insertBefore(u,s),u=h.createDocumentFragment()),s)s=s.nextSibling;u.firstChild&&a.insertBefore(u,s)}else{q=this._getClientHeight();p=this._model.getLineCount();s=q+f.top+f.bottom-2*this._metrics.scrollWidth;i=m*p<s?m:s/p;if(a.rulerChanged){for(q=
a.childNodes.length;q>1;)a.removeChild(a.lastChild),q--;j=j.getAnnotations(0,p);u=h.createDocumentFragment();for(var l in j)if(p=l>>>0,!(p<0)){r=e.createElement(h,"div");q=j[l];g(q.style,r);r.style.position="absolute";r.style.top=this._metrics.scrollWidth+m+Math.floor(p*i)+"px";if(q.html)r.innerHTML=q.html;r.annotation=q;r.lineIndex=p;u.appendChild(r)}a.appendChild(u)}else if(a._oldTrackHeight!==s)for(r=a.firstChild?a.firstChild.nextSibling:null;r;)r.style.top=this._metrics.scrollWidth+m+Math.floor(r.lineIndex*
i)+"px",r=r.nextSibling;a._oldTrackHeight=s}a.rulerChanged=!1;a=a.nextSibling}},_updateStyleSheet:function(){var a="";e.isWebkit&&this._metrics.scrollWidth>0&&(a+="\n.textview ::-webkit-scrollbar-corner {background: #eeeeee;}");e.isFirefox&&e.isMac&&this._highlightRGB&&this._highlightRGB!=="Highlight"&&(a+="\n.textview ::-moz-selection {background: "+this._highlightRGB+";}");if(a){var b=document.getElementById("_textviewStyle");if(b)b.removeChild(b.firstChild),b.appendChild(document.createTextNode(a));
else{b=e.createElement(document,"style");b.id="_textviewStyle";var d=document.getElementsByTagName("head")[0]||document.documentElement;b.appendChild(document.createTextNode(a));d.insertBefore(b,d.firstChild)}}},_updateStyle:function(a){if(!a&&e.isIE)this._rootDiv.style.lineHeight="normal";var b=this._metrics=this._calculateMetrics();this._rootDiv.style.lineHeight=e.isIE?b.lineHeight-(b.lineTrim.top+b.lineTrim.bottom)+"px":"normal";this._updateStyleSheet();a||(this.redraw(),this._resetLineWidth())}};
i.EventTarget.addMixin(q.prototype);return{TextView:q}});
define("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(l,o){function n(i){this._model=i;this._projections=[]}n.prototype={addProjection:function(i){if(i){var c=this._model,f=this._projections;i._lineIndex=c.getLineAtOffset(i.start);i._lineCount=c.getLineAtOffset(i.end)-i._lineIndex;var e=i.text;e||(e="");i._model=typeof e==="string"?new l.TextModel(e,c.getLineDelimiter()):e;var c=this.mapOffset(i.start,!0),e=i.end-i.start,g=i._lineCount,j=i._model.getCharCount(),
b=i._model.getLineCount()-1;this.onChanging({type:"Changing",text:i._model.getText(),start:c,removedCharCount:e,addedCharCount:j,removedLineCount:g,addedLineCount:b});var a=this._binarySearch(f,i.start);f.splice(a,0,i);this.onChanged({type:"Changed",start:c,removedCharCount:e,addedCharCount:j,removedLineCount:g,addedLineCount:b})}},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(i,c){var f=this._projections,e=0,g,j;if(c){for(g=
0;g<f.length;g++){j=f[g];if(j.start>i)break;if(j.end>i)return-1;e+=j._model.getCharCount()-(j.end-j.start)}return i+e}for(g=0;g<f.length;g++){j=f[g];if(j.start>i-e)break;var b=j._model.getCharCount();if(j.start+b>i-e)return-1;e+=b-(j.end-j.start)}return i-e},removeProjection:function(i){var c,f=0;for(c=0;c<this._projections.length;c++){var e=this._projections[c];if(e===i){i=e;break}f+=e._model.getCharCount()-(e.end-e.start)}if(c<this._projections.length){var e=this._model,f=i.start+f,g=i.end-i.start,
j=i._lineCount,b=i._model.getCharCount(),a=i._model.getLineCount()-1;this.onChanging({type:"Changing",text:e.getText(i.start,i.end),start:f,removedCharCount:b,addedCharCount:g,removedLineCount:a,addedLineCount:j});this._projections.splice(c,1);this.onChanged({type:"Changed",start:f,removedCharCount:b,addedCharCount:g,removedLineCount:a,addedLineCount:j})}},_binarySearch:function(i,c){for(var f=i.length,e=-1,g;f-e>1;)g=Math.floor((f+e)/2),c<=i[g].start?f=g:e=g;return f},getCharCount:function(){for(var i=
this._model.getCharCount(),c=this._projections,f=0;f<c.length;f++){var e=c[f];i+=e._model.getCharCount()-(e.end-e.start)}return i},getLine:function(i,c){if(i<0)return null;var f=this._model,e=this._projections,g=0,j=[],b=0,a,d,m;for(a=0;a<e.length;a++){m=e[a];if(m._lineIndex>=i-g)break;d=m._model.getLineCount()-1;if(m._lineIndex+d>=i-g)if(b=i-(m._lineIndex+g),b<d)return m._model.getLine(b,c);else j.push(m._model.getLine(d));b=m.end;g+=d-m._lineCount}for(b=Math.max(b,f.getLineStart(i-g));a<e.length;a++){m=
e[a];if(m._lineIndex>i-g)break;j.push(f.getText(b,m.start));d=m._model.getLineCount()-1;if(m._lineIndex+d>i-g)return j.push(m._model.getLine(0,c)),j.join("");j.push(m._model.getText());b=m.end;g+=d-m._lineCount}e=f.getLineEnd(i-g,c);b<e&&j.push(f.getText(b,e));return j.join("")},getLineAtOffset:function(i){for(var c=this._model,f=this._projections,e=0,g=0,j=0;j<f.length;j++){var b=f[j];if(b.start>i-e)break;var a=b._model.getCharCount();if(b.start+a>i-e){f=i-(b.start+e);g+=b._model.getLineAtOffset(f);
e+=f;break}g+=b._model.getLineCount()-1-b._lineCount;e+=a-(b.end-b.start)}return c.getLineAtOffset(i-e)+g},getLineCount:function(){for(var i=this._projections,c=this._model.getLineCount(),f=0;f<i.length;f++){var e=i[f];c+=e._model.getLineCount()-1-e._lineCount}return c},getLineDelimiter:function(){return this._model.getLineDelimiter()},getLineEnd:function(i,c){if(i<0)return-1;for(var f=this._model,e=this._projections,g=0,j=0,b=0;b<e.length;b++){var a=e[b];if(a._lineIndex>i-g)break;var d=a._model.getLineCount()-
1;if(a._lineIndex+d>i-g)return a._model.getLineEnd(i-(a._lineIndex+g),c)+a.start+j;j+=a._model.getCharCount()-(a.end-a.start);g+=d-a._lineCount}return f.getLineEnd(i-g,c)+j},getLineStart:function(i){if(i<0)return-1;for(var c=this._model,f=this._projections,e=0,g=0,j=0;j<f.length;j++){var b=f[j];if(b._lineIndex>=i-e)break;var a=b._model.getLineCount()-1;if(b._lineIndex+a>=i-e)return b._model.getLineStart(i-(b._lineIndex+e))+b.start+g;g+=b._model.getCharCount()-(b.end-b.start);e+=a-b._lineCount}return c.getLineStart(i-
e)+g},getText:function(i,c){i===void 0&&(i=0);var f=this._model,e=this._projections,g=0,j=[],b,a,d;for(b=0;b<e.length;b++){a=e[b];if(a.start>i-g)break;d=a._model.getCharCount();if(a.start+d>i-g)if(c!==void 0&&a.start+d>c-g)return a._model.getText(i-(a.start+g),c-(a.start+g));else j.push(a._model.getText(i-(a.start+g))),i=a.end+g+d-(a.end-a.start);g+=d-(a.end-a.start)}var m=i-g;if(c!==void 0){for(;b<e.length;b++){a=e[b];if(a.start>c-g)break;j.push(f.getText(m,a.start));d=a._model.getCharCount();if(a.start+
d>c-g)return j.push(a._model.getText(0,c-(a.start+g))),j.join("");j.push(a._model.getText());m=a.end;g+=d-(a.end-a.start)}j.push(f.getText(m,c-g))}else{for(;b<e.length;b++)a=e[b],j.push(f.getText(m,a.start)),j.push(a._model.getText()),m=a.end;j.push(f.getText(m))}return j.join("")},_onChanging:function(i,c,f,e,g,j){for(var b=this._model,a=this._projections,d,m=0,h,p=c+f;d<a.length;d++){f=a[d];if(f.start>c)break;m+=f._model.getCharCount()-(f.end-f.start)}c+=m;for(var s=d;d<a.length;d++){f=a[d];if(f.start>
p)break;m+=f._model.getCharCount()-(f.end-f.start);h+=f._model.getLineCount()-1-f._lineCount}f=p+m;m=d;this.onChanging(c,f-c,e,g+h,j);a.splice(a,m-s);for(i=i.length-(f-c);d<a.length;d++)f=a[d],f.start+=i,f.end+=i,f._lineIndex=b.getLineAtOffset(f.start)},onChanging:function(i){return this.dispatchEvent(i)},onChanged:function(i){return this.dispatchEvent(i)},setLineDelimiter:function(i){this._model.setLineDelimiter(i)},setText:function(i,c,f){i===void 0&&(i="");c===void 0&&(c=0);var e=c,g=f,j=this._model,
b=this._projections,a=0,d=0,m,h,p,s,r,q=0;for(m=0;m<b.length;m++){h=b[m];if(h.start>c-a)break;p=h._model.getCharCount();if(h.start+p>c-a)if(f!==void 0&&h.start+p>f-a){h._model.setText(i,c-(h.start+a),f-(h.start+a));return}else q=h._model.getLineCount()-1-h._model.getLineAtOffset(c-(h.start+a)),s={projection:h,start:c-(h.start+a)},c=h.end+a+p-(h.end-h.start);d+=h._model.getLineCount()-1-h._lineCount;a+=p-(h.end-h.start)}c-=a;var u=m,q=j.getLineAtOffset(c)+d-q;if(f!==void 0)for(;m<b.length;m++){h=b[m];
if(h.start>f-a)break;p=h._model.getCharCount();if(h.start+p>f-a){d+=h._model.getLineAtOffset(f-(h.start+a));p=f-(h.start+a);f=h.end+a;r={projection:h,end:p};break}d+=h._model.getLineCount()-1-h._lineCount;a+=p-(h.end-h.start)}else{for(;m<b.length;m++)h=b[m],d+=h._model.getLineCount()-1-h._lineCount,a+=h._model.getCharCount()-(h.end-h.start);f=g=j.getCharCount()+a}f-=a;h=j.getLineAtOffset(f)+d;g-=e;for(var d=h-q,q=i.length,l=p=h=a=0;;){h!==-1&&h<=l&&(h=i.indexOf("\r",l));p!==-1&&p<=l&&(p=i.indexOf("\n",
l));if(p===-1&&h===-1)break;l=h!==-1&&p!==-1?h+1===p?p+1:(h<p?h:p)+1:h!==-1?h+1:p+1;a++}this.onChanging({type:"Changing",text:i,start:e,removedCharCount:g,addedCharCount:q,removedLineCount:d,addedLineCount:a});j.setText(i,c,f);if(s)h=s.projection,h._model.setText("",s.start);if(r)h=r.projection,h._model.setText("",0,r.end),h.start=h.end,h._lineCount=0;b.splice(u,m-u);for(i=i.length-(f-c);m<b.length;m++)h=b[m],h.start+=i,h.end+=i,h._lineIndex=j.getLineAtOffset(h.start);this.onChanged({type:"Changed",
start:e,removedCharCount:g,addedCharCount:q,removedLineCount:d,addedLineCount:a})}};o.EventTarget.addMixin(n.prototype);return{ProjectionTextModel:n}});
define("orion/editor/annotations",["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],function(l,o){function n(b,a,d){this.start=b;this.end=a;this._projectionModel=d;this.html=this._expandedHTML;this.style=this._expandedStyle;this.expanded=!0}function i(){}function c(b,a){var d=b.lastIndexOf("."),d=b.substring(d+1),c={title:l[d],style:{styleClass:"annotation "+d},html:"<div class='annotationHTML "+d+"'></div>",overviewStyle:{styleClass:"annotationOverview "+d}};a?c.lineStyle={styleClass:"annotationLine "+
d}:c.rangeStyle={styleClass:"annotationRange "+d};i.registerType(b,c)}function f(){}function e(b){this._annotations=[];var a=this;this._listener={onChanged:function(b){a._onChanged(b)}};this.setTextModel(b)}function g(b,a){this._view=b;this._annotationModel=a;var d=this;this._listener={onDestroy:function(a){d._onDestroy(a)},onLineStyle:function(a){d._onLineStyle(a)},onChanged:function(a){d._onAnnotationModelChanged(a)}};b.addEventListener("Destroy",this._listener.onDestroy);b.addEventListener("postLineStyle",
this._listener.onLineStyle);a.addEventListener("Changed",this._listener.onChanged)}n.prototype={_expandedHTML:"<div class='annotationHTML expanded'></div>",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"<div class='annotationHTML collapsed'></div>",_collapsedStyle:{styleClass:"annotation collapsed"},collapse:function(){if(this.expanded){this.expanded=!1;this.html=this._collapsedHTML;this.style=this._collapsedStyle;var b=this._projectionModel,a=b.getBaseModel();this._projection=
{start:a.getLineStart(a.getLineAtOffset(this.start)+1),end:a.getLineEnd(a.getLineAtOffset(this.end),!0)};b.addProjection(this._projection)}},expand:function(){if(!this.expanded)this.expanded=!0,this.html=this._expandedHTML,this.style=this._expandedStyle,this._projectionModel.removeProjection(this._projection)}};i.ANNOTATION_ERROR="orion.annotation.error";i.ANNOTATION_WARNING="orion.annotation.warning";i.ANNOTATION_TASK="orion.annotation.task";i.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint";
i.ANNOTATION_BOOKMARK="orion.annotation.bookmark";i.ANNOTATION_FOLDING="orion.annotation.folding";i.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket";i.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket";i.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine";i.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch";i.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch";i.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence";i.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence";
i.ANNOTATION_SELECTED_LINKED_GROUP="orion.annotation.selectedLinkedGroup";i.ANNOTATION_CURRENT_LINKED_GROUP="orion.annotation.currentLinkedGroup";i.ANNOTATION_LINKED_GROUP="orion.annotation.linkedGroup";i.ANNOTATION_BLAME="orion.annotation.blame";i.ANNOTATION_CURRENT_BLAME="orion.annotation.currentBlame";var j={};i.registerType=function(b,a){var d=a;if(typeof d!=="function")d=function(a,b,d){this.start=a;this.end=b;if(d!==void 0)this.title=d},d.prototype=a;d.prototype.type=b;j[b]=d;return b};i.createAnnotation=
function(b,a,d,c){return new (this.getType(b))(a,d,c)};i.getType=function(b){return j[b]};c(i.ANNOTATION_ERROR);c(i.ANNOTATION_WARNING);c(i.ANNOTATION_TASK);c(i.ANNOTATION_BREAKPOINT);c(i.ANNOTATION_BOOKMARK);c(i.ANNOTATION_CURRENT_BRACKET);c(i.ANNOTATION_MATCHING_BRACKET);c(i.ANNOTATION_CURRENT_SEARCH);c(i.ANNOTATION_MATCHING_SEARCH);c(i.ANNOTATION_READ_OCCURRENCE);c(i.ANNOTATION_WRITE_OCCURRENCE);c(i.ANNOTATION_SELECTED_LINKED_GROUP);c(i.ANNOTATION_CURRENT_LINKED_GROUP);c(i.ANNOTATION_LINKED_GROUP);
c(i.ANNOTATION_CURRENT_LINE,!0);c(i.ANNOTATION_BLAME,!0);c(i.ANNOTATION_CURRENT_BLAME,!0);i.registerType(i.ANNOTATION_FOLDING,n);f.addMixin=function(b){var a=f.prototype,d;for(d in a)a.hasOwnProperty(d)&&(b[d]=a[d])};f.prototype={addAnnotationType:function(b){if(!this._annotationTypes)this._annotationTypes=[];this._annotationTypes.push(b)},getAnnotationTypePriority:function(b){if(this._annotationTypes)for(var a=0;a<this._annotationTypes.length;a++)if(this._annotationTypes[a]===b)return a+1;return 0},
getAnnotationsByType:function(b,a,d){b=b.getAnnotations(a,d);for(d=[];b.hasNext();)a=b.next(),this.getAnnotationTypePriority(a.type)!==0&&d.push(a);var c=this;d.sort(function(a,b){return c.getAnnotationTypePriority(a.type)-c.getAnnotationTypePriority(b.type)});return d},isAnnotationTypeVisible:function(b){return this.getAnnotationTypePriority(b)!==0},removeAnnotationType:function(b){if(this._annotationTypes)for(var a=0;a<this._annotationTypes.length;a++)if(this._annotationTypes[a]===b){this._annotationTypes.splice(a,
1);break}}};e.prototype={addAnnotation:function(b){if(b){var a=this._annotations,d=this._binarySearch(a,b.start);a.splice(d,0,b);this.onChanged({type:"Changed",added:[b],removed:[],changed:[]})}},getTextModel:function(){return this._model},getAnnotations:function(b,a){var d=this._annotations,c,h=0,e=function(){for(;h<d.length;){var c=d[h++];if(b===c.start||(b>c.start?b<c.end:c.start<a))return c;if(c.start>=a)break}return null};c=e();return{next:function(){var a=c;a&&(c=e());return a},hasNext:function(){return c!==
null}}},modifyAnnotation:function(b){if(b&&!(this._getAnnotationIndex(b)<0))this.onChanged({type:"Changed",added:[],removed:[],changed:[b]})},onChanged:function(b){return this.dispatchEvent(b)},removeAnnotations:function(b){var a=this._annotations,d,c;if(b){d=[];for(c=a.length-1;c>=0;c--){var h=a[c];h.type===b&&(a.splice(c,1),d.splice(0,0,h))}}else d=a;this.onChanged({type:"Changed",removed:d,added:[],changed:[]})},removeAnnotation:function(b){if(b&&(b=this._getAnnotationIndex(b),!(b<0)))this.onChanged({type:"Changed",
removed:this._annotations.splice(b,1),added:[],changed:[]})},replaceAnnotations:function(b,a){var d=this._annotations,c,h,e,f=[];if(b)for(c=b.length-1;c>=0;c--)e=b[c],h=this._getAnnotationIndex(e),h<0||(d.splice(h,1),f.splice(0,0,e));a||(a=[]);for(c=0;c<a.length;c++)e=a[c],h=this._binarySearch(d,e.start),d.splice(h,0,e);this.onChanged({type:"Changed",removed:f,added:a,changed:[]})},setTextModel:function(b){this._model&&this._model.removeEventListener("Changed",this._listener.onChanged);(this._model=
b)&&this._model.addEventListener("Changed",this._listener.onChanged)},_binarySearch:function(b,a){for(var d=b.length,c=-1,h;d-c>1;)h=Math.floor((d+c)/2),a<=b[h].start?d=h:c=h;return d},_getAnnotationIndex:function(b){for(var a=this._annotations,d=this._binarySearch(a,b.start);d<a.length&&a[d].start===b.start;){if(a[d]===b)return d;d++}return-1},_onChanged:function(b){var a=b.start,d=b.removedCharCount,c=this._annotations,h=a+d;if(0<c.length){for(var e={type:"Changed",added:[],removed:[],changed:[],
textModelChangedEvent:b},b=b.addedCharCount-d,d=0;d<c.length;d++){var f=c[d];f.start>=h?(f.start+=b,f.end+=b,e.changed.push(f)):f.end<=a||(f.start<a&&h<f.end?(f.end+=b,e.changed.push(f)):(c.splice(d,1),e.removed.push(f),d--))}if(e.added.length>0||e.removed.length>0||e.changed.length>0)this.onChanged(e)}}};o.EventTarget.addMixin(e.prototype);g.prototype={destroy:function(){var b=this._view;if(b)b.removeEventListener("Destroy",this._listener.onDestroy),b.removeEventListener("LineStyle",this._listener.onLineStyle),
this.view=null;(b=this._annotationModel)&&b.removeEventListener("Changed",this._listener.onChanged)},_mergeStyle:function(b,a){if(a){b||(b={});b.styleClass&&a.styleClass&&b.styleClass!==a.styleClass?b.styleClass+=" "+a.styleClass:b.styleClass=a.styleClass;var d;if(a.tagName&&!b.tagName)b.tagName=a.tagName;if(a.style){if(!b.style)b.style={};for(d in a.style)b.style[d]||(b.style[d]=a.style[d])}if(a.attributes){if(!b.attributes)b.attributes={};for(d in a.attributes)b.attributes[d]||(b.attributes[d]=
a.attributes[d])}}return b},_mergeStyleRanges:function(b,a){b||(b=[]);var d,c;for(c=0;c<b.length&&a;c++){var h=b[c];if(a.end<=h.start)break;if(!(a.start>=h.end)){d=this._mergeStyle({},h.style);d=this._mergeStyle(d,a.style);var e=[];e.push(c,1);a.start<h.start&&e.push({start:a.start,end:h.start,style:a.style});a.start>h.start&&e.push({start:h.start,end:a.start,style:h.style});e.push({start:Math.max(h.start,a.start),end:Math.min(h.end,a.end),style:d});a.end<h.end&&e.push({start:a.end,end:h.end,style:h.style});
a=a.end>h.end?{start:h.end,end:a.end,style:a.style}:null;Array.prototype.splice.apply(b,e)}}a&&(d=this._mergeStyle({},a.style),b.splice(c,0,{start:a.start,end:a.end,style:d}));return b},_onAnnotationModelChanged:function(b){function a(a){for(var b=0;b<a.length;b++)if(c.isAnnotationTypeVisible(a[b].type)){var e=a[b].start,f=a[b].end;h.getBaseModel&&(e=h.mapOffset(e,!0),f=h.mapOffset(f,!0));e!==-1&&f!==-1&&d.redrawRange(e,f)}}if(!b.textModelChangedEvent){var d=this._view;if(d){var c=this,h=d.getModel();
a(b.added);a(b.removed);a(b.changed)}}},_onDestroy:function(){this.destroy()},_onLineStyle:function(b){var a=this._annotationModel,d=b.textView.getModel(),c=a.getTextModel(),h=b.lineStart,e=b.lineStart+b.lineText.length;c!==d&&(h=d.mapOffset(h),e=d.mapOffset(e));for(a=a.getAnnotations(h,e);a.hasNext();)if(h=a.next(),this.isAnnotationTypeVisible(h.type)){if(h.rangeStyle){var e=h.start,f=h.end;c!==d&&(e=d.mapOffset(e,!0),f=d.mapOffset(f,!0));b.ranges=this._mergeStyleRanges(b.ranges,{start:e,end:f,style:h.rangeStyle})}if(h.lineStyle)b.style=
this._mergeStyle({},b.style),b.style=this._mergeStyle(b.style,h.lineStyle)}}};f.addMixin(g.prototype);return{FoldingAnnotation:n,AnnotationType:i,AnnotationTypeList:f,AnnotationModel:e,AnnotationStyler:g}});
define("orion/editor/tooltip","i18n!orion/editor/nls/messages,orion/editor/textView,orion/editor/textModel,orion/editor/projectionTextModel,orion/editor/util,orion/util".split(","),function(l,o,n,i,c,f){function e(c){this._view=c;this._fadeDelay=500;this._hideDelay=200;this._showDelay=500;this._autoHideDelay=5E3;this._create(c.getOptions("parent").ownerDocument)}e.getTooltip=function(c){if(!c._tooltip)c._tooltip=new e(c);return c._tooltip};e.prototype={_create:function(e){if(!this._tooltipDiv){var j=
this._tooltipDiv=f.createElement(e,"div");j.tabIndex=0;j.className="textviewTooltip";j.setAttribute("aria-live","assertive");j.setAttribute("aria-atomic","true");var b=this._tooltipContents=f.createElement(e,"div");j.appendChild(b);e.body.appendChild(j);var a=this;c.addEventListener(j,"mouseover",function(){if(a._hideDelay){var b=a._getWindow();if(a._delayedHideTimeout)b.clearTimeout(a._delayedHideTimeout),a._delayedHideTimeout=null;if(a._hideTimeout)b.clearTimeout(a._hideTimeout),a._hideTimeout=
null;a._nextTarget=null}},!1);c.addEventListener(j,"mouseout",function(b){b=b.relatedTarget||b.toElement;b===j||a._hasFocus()||(!b||!c.contains(j,b))&&a._hide()},!1);c.addEventListener(j,"keydown",function(b){b.keyCode===27&&a._hide()},!1);c.addEventListener(e,"mousedown",this._mouseDownHandler=function(b){a.isVisible()&&(c.contains(j,b.target||b.srcElement)||a._hide())},!0);this._view.addEventListener("Destroy",function(){a.destroy()});this._hide()}},_getWindow:function(){var c=this._tooltipDiv.ownerDocument;
return c.defaultView||c.parentWindow},destroy:function(){if(this._tooltipDiv){this._hide();var e=this._tooltipDiv.parentNode;e&&e.removeChild(this._tooltipDiv);c.removeEventListener(this._tooltipDiv.ownerDocument,"mousedown",this._mouseDownHandler,!0);this._tooltipDiv=null}},_hasFocus:function(){var e=this._tooltipDiv;return!e?!1:c.contains(e,e.ownerDocument.activeElement)},hide:function(c){if(c===void 0)c=this._hideDelay;var e=this._getWindow();if(this._delayedHideTimeout)e.clearTimeout(this._delayedHideTimeout),
this._delayedHideTimeout=null;var b=this;c?b._delayedHideTimeout=e.setTimeout(function(){b._delayedHideTimeout=null;b._hide();b.setTarget(b._nextTarget,0)},c):(b._hide(),b.setTarget(b._nextTarget,0))},_hide:function(){var c=this._tooltipDiv;if(c){this._hasFocus()&&this._view.focus();if(this._contentsView)this._contentsView.destroy(),this._contentsView=null;if(this._tooltipContents)this._tooltipContents.innerHTML="";c.style.visibility="hidden";c=this._getWindow();if(this._showTimeout)c.clearTimeout(this._showTimeout),
this._showTimeout=null;if(this._delayedHideTimeout)c.clearTimeout(this._delayedHideTimeout),this._delayedHideTimeout=null;if(this._hideTimeout)c.clearTimeout(this._hideTimeout),this._hideTimeout=null;if(this._fadeTimeout)c.clearInterval(this._fadeTimeout),this._fadeTimeout=null}},isVisible:function(){return this._tooltipDiv&&this._tooltipDiv.style.visibility==="visible"},setTarget:function(c,e,b){if(this.isVisible()){if(!this._hasFocus())this._nextTarget=c,this.hide(b)}else if(this._target=c){var a=
this,c=a._getWindow();if(a._showTimeout)c.clearTimeout(a._showTimeout),a._showTimeout=null;e===0?a.show(!0):a._showTimeout=c.setTimeout(function(){a._showTimeout=null;a.show(!0)},e?e:a._showDelay)}},show:function(c){if(this._target){var e=this._target.getTooltipInfo();if(e){var b=this._tooltipDiv,a=this._tooltipContents;b.style.left=b.style.right=b.style.width=b.style.height=a.style.width=a.style.height="auto";var d=e.contents;d instanceof Array&&(d=this._getAnnotationContents(d));if(typeof d==="string")a.innerHTML=
d;else if(this._isNode(d))a.appendChild(d);else if(d instanceof i.ProjectionTextModel){var m=this._view,h=m.getOptions();h.wrapMode=!1;h.parent=a;var f=h.themeClass;f?((f=f.replace("tooltipTheme",""))&&(f=" "+f),f="tooltipTheme"+f):f="tooltipTheme";h.themeClass=f;h=this._contentsView=new o.TextView(h);h.addEventListener("LineStyle",function(a){m.onLineStyle(a)});h.setModel(d);d=h.computeSize();a.style.width=d.width+"px";a.style.height=d.height+"px";h.resize()}else return;a=b.ownerDocument.documentElement;
e.anchor==="right"?(d=a.clientWidth-e.x,b.style.right=d+"px"):(d=parseInt(this._getNodeStyle(b,"padding-left","0"),10),d+=parseInt(this._getNodeStyle(b,"border-left-width","0"),10),d=e.x-d,b.style.left=d+"px");b.style.maxWidth=a.clientWidth-d-10+"px";d=parseInt(this._getNodeStyle(b,"padding-top","0"),10);d+=parseInt(this._getNodeStyle(b,"border-top-width","0"),10);d=e.y-d;b.style.top=d+"px";b.style.maxHeight=a.clientHeight-d-10+"px";b.style.opacity="1";b.style.visibility="visible";if(c){var s=this,
r=this._getWindow();s._hideTimeout=r.setTimeout(function(){s._hideTimeout=null;var a=parseFloat(s._getNodeStyle(b,"opacity","1"));s._fadeTimeout=r.setInterval(function(){b.style.visibility==="visible"&&a>0?(a-=0.1,b.style.opacity=a):s._hide()},s._fadeDelay/10)},s._autoHideDelay)}}}},_getAnnotationContents:function(e){function j(a,b){var d=q.getLineStart(q.getLineAtOffset(a)),c=q.getLineEnd(q.getLineAtOffset(b),!0);return q.getText(d,c)}function b(a){var b=a.title,d=f.createElement(p,"div");d.className=
"tooltipRow";if(a.html)d.innerHTML=a.html,d.lastChild&&c.addEventListener(d.lastChild,"click",function(){var b=a.start,d=a.end;r.getBaseModel&&(b=r.mapOffset(b,!0),d=r.mapOffset(d,!0));s.setSelection(b,d,1/3,function(){h._hide()})},!1),d.appendChild(p.createTextNode("\u00a0"));b||(b=j(a.start,a.end));typeof b==="function"&&(b=a.title());if(typeof b==="string"){var m=f.createElement(p,"span");m.appendChild(p.createTextNode(b));b=m}d.appendChild(b);return d}for(var a,d=[],m=0;m<e.length;m++)a=e[m],
a.title!==""&&!a.groupAnnotation&&d.push(a);e=d;if(e.length===0)return null;var h=this,p=this._tooltipDiv.ownerDocument,s=this._view,r=s.getModel(),q=r.getBaseModel?r.getBaseModel():r;if(e.length===1)if(a=e[0],a.title!==void 0){a=b(a);if(a.firstChild)(e=a.firstChild.className)&&(e+=" "),e+="single",a.firstChild.className=e;return a}else return e=new i.ProjectionTextModel(q),d=q.getLineStart(q.getLineAtOffset(a.start)),m=q.getCharCount(),a.end!==m&&e.addProjection({start:a.end,end:m}),d>0&&e.addProjection({start:0,
end:d}),e;else{d=f.createElement(p,"div");a=f.createElement(p,"em");a.appendChild(p.createTextNode(l.multipleAnnotations));d.appendChild(a);for(m=0;m<e.length;m++)a=e[m],(a=b(a))&&d.appendChild(a);return d}},_getNodeStyle:function(c,e,b){var a;if(c&&(a=c.style[e],!a))if(c.currentStyle){for(a=0;(a=e.indexOf("-",a))!==-1;)e=e.substring(0,a)+e.substring(a+1,a+2).toUpperCase()+e.substring(a+2);a=c.currentStyle[e]}else a=(c=c.ownerDocument.defaultView.getComputedStyle(c,null))?c.getPropertyValue(e):null;
return a||b},_isNode:function(c){return typeof Node==="object"?c instanceof Node:c&&typeof c==="object"&&typeof c.nodeType==="number"&&typeof c.nodeName==="string"}};return{Tooltip:e}});
define("orion/editor/rulers",["i18n!orion/editor/nls/messages","orion/editor/annotations","orion/editor/tooltip","orion/util"],function(l,o,n,i){function c(b,a,d,c){this._location=a||"left";this._overview=d||"page";this._rulerStyle=c;this._view=null;var h=this;this._listener={onTextModelChanged:function(a){h._onTextModelChanged(a)},onAnnotationModelChanged:function(a){h._onAnnotationModelChanged(a)}};this.setAnnotationModel(b)}function f(b,a,d,m,h){c.call(this,b,a,"page",d);this._oddStyle=m||{style:{backgroundColor:"white"}};
this._evenStyle=h||{style:{backgroundColor:"white"}};this._numOfDigits=0;this._firstLine=1}function e(b,a,d){c.call(this,b,a,"page",d)}function g(b,a,d){c.call(this,b,a,"document",d)}function j(b,a,d){e.call(this,b,a,d)}c.prototype={getAnnotations:function(b,a){var d=this._annotationModel;if(!d)return[];var c=this._view.getModel(),h=c.getLineStart(b),e=c.getLineEnd(a-1),f=c;c.getBaseModel&&(f=c.getBaseModel(),h=c.mapOffset(h),e=c.mapOffset(e));for(var g=[],d=this.getAnnotationsByType(d,h,e),h=0;h<
d.length;h++)for(var e=d[h],j=f.getLineAtOffset(e.start),i=f.getLineAtOffset(Math.max(e.start,e.end-1)),l=j;l<=i;l++){var n=l;if(c!==f){n=f.getLineStart(l);n=c.mapOffset(n,!0);if(n===-1)continue;n=c.getLineAtOffset(n)}if(b<=n&&n<a){var k=this._mergeAnnotation(g[n],e,l-j,i-j+1);k&&(g[n]=k)}}if(!this._multiAnnotation&&this._multiAnnotationOverlay)for(var t in g)g[t]._multiple&&(g[t].html+=this._multiAnnotationOverlay.html);return g},getAnnotationModel:function(){return this._annotationModel},getLocation:function(){return this._location},
getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},getView:function(){return this._view},getWidestAnnotation:function(){return null},setAnnotationModel:function(b){this._annotationModel&&this._annotationModel.removEventListener("Changed",this._listener.onAnnotationModelChanged);(this._annotationModel=b)&&this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)},setMultiAnnotation:function(b){this._multiAnnotation=b},setMultiAnnotationOverlay:function(b){this._multiAnnotationOverlay=
b},setView:function(b){this._onTextModelChanged&&this._view&&this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged);this._view=b;this._onTextModelChanged&&this._view&&this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)},onClick:function(b){if(b!==void 0){var a=this._view,d=a.getModel(),c=d,h=d.getLineStart(b),e=h,f=h,g=this._annotationModel;if(g){a=a.getSelection();f=d.getLineEnd(b,!0);if(h<=a.start&&a.start<f)h=a.start;d.getBaseModel&&(h=d.mapOffset(h),
f=d.mapOffset(f),c=d.getBaseModel());for(var j,f=g.getAnnotations(h,f),g=null;!j&&f.hasNext();)a=f.next(),this.isAnnotationTypeVisible(a.type)&&(g=a,a.start<=h||(j=a));if(g&&g.groupId!==void 0)this._currentClickGroup=this._currentClickGroup===g.groupId?null:g.groupId,this._setCurrentGroup(b);j&&c.getLineAtOffset(j.start)===c.getLineAtOffset(h)?(h=j.start,f=j.end):f=h=e;d.getBaseModel&&(h=d.mapOffset(h,!0),f=d.mapOffset(f,!0))}(b=n.Tooltip.getTooltip(this._view))&&b.setTarget(null);this._view.setSelection(f,
h,1/3,function(){})}},onDblClick:function(){},onMouseMove:function(b,a){var d=n.Tooltip.getTooltip(this._view);if(d&&!(d.isVisible()&&this._tooltipLineIndex===b)){this._tooltipLineIndex=b;var c=this;d.setTarget({y:a.clientY,getTooltipInfo:function(){return c._getTooltipInfo(c._tooltipLineIndex,this.y)}})}},onMouseOver:function(b,a){this.onMouseMove(b,a);this._currentClickGroup||this._setCurrentGroup(b)},onMouseOut:function(){this._currentClickGroup||this._setCurrentGroup(-1);var b=n.Tooltip.getTooltip(this._view);
b&&b.setTarget(null)},_getTooltipInfo:function(b,a){if(b!==void 0){var d=this._view,c=d.getModel(),h=this._annotationModel,e=[];if(h){var e=c.getLineStart(b),f=c.getLineEnd(b);c.getBaseModel&&(e=c.mapOffset(e),f=c.mapOffset(f));e=this.getAnnotationsByType(h,e,f)}h=this._getTooltipContents(b,e);if(!h)return null;h={contents:h,anchor:this.getLocation()};e=d.getClientArea();e.y=this.getOverview()==="document"?d.convert({y:a},"view","document").y:d.getLocationAtOffset(c.getLineStart(b)).y;d.convert(e,
"document","page");h.x=e.x;h.y=e.y;h.anchor==="right"&&(h.x+=e.width);return h}},_getTooltipContents:function(b,a){return a},_onAnnotationModelChanged:function(b){function a(a){for(var b=0;b<a.length;b++)if(h.isAnnotationTypeVisible(a[b].type)){var e=a[b].start,f=a[b].end;c.getBaseModel&&(e=c.mapOffset(e,!0),f=c.mapOffset(f,!0));e!==-1&&f!==-1&&d.redrawLines(c.getLineAtOffset(e),c.getLineAtOffset(Math.max(e,f-1))+1,h)}}var d=this._view;if(d){var c=d.getModel(),h=this,e=c.getLineCount();b.textModelChangedEvent?
(b=b.textModelChangedEvent.start,c.getBaseModel&&(b=c.mapOffset(b,!0)),b=c.getLineAtOffset(b),d.redrawLines(b,e,h)):(a(b.added),a(b.removed),a(b.changed))}},_mergeAnnotation:function(b,a,d){b||(b={});if(d===0)if(b.html&&a.html){if(a.html!==b.html&&!b._multiple&&this._multiAnnotation)b.html=this._multiAnnotation.html;b._multiple=!0}else b.html=a.html;b.style=this._mergeStyle(b.style,a.style);return b},_mergeStyle:function(b,a){if(a){b||(b={});b.styleClass&&a.styleClass&&b.styleClass!==a.styleClass?
b.styleClass+=" "+a.styleClass:b.styleClass=a.styleClass;var d;if(a.style){if(!b.style)b.style={};for(d in a.style)b.style[d]===void 0&&(b.style[d]=a.style[d])}if(a.attributes){if(!b.attributes)b.attributes={};for(d in a.attributes)b.attributes[d]===void 0&&(b.attributes[d]=a.attributes[d])}}return b},_setCurrentGroup:function(b){var a=this._annotationModel,d=null,c=a.getTextModel(),h,e,f=this._currentGroupAnnotation;if(b!==-1){var g=c.getLineStart(b),j=c.getLineEnd(b);c.getBaseModel&&(g=c.mapOffset(g),
j=c.mapOffset(j));for(e=a.getAnnotations(g,j);e.hasNext();)if(h=e.next(),this.isAnnotationTypeVisible(h.type)&&h.start<=g&&h.end>=j&&h.groupId!==void 0){d=h;break}if(f&&d&&f.groupId===d.groupId)return}this._currentGroupAnnotation=null;f&&a.removeAnnotations(f.groupType);if(d&&b!==-1){this._currentGroupAnnotation=d;e=a.getAnnotations(0,c.getCharCount());for(b=[];e.hasNext();)h=e.next(),delete h.groupAnnotation,h.groupId===d.groupId&&(h=h.createGroupAnnotation(),b.push(h));a.replaceAnnotations(null,
b)}}};o.AnnotationTypeList.addMixin(c.prototype);f.prototype=new c;f.prototype.getAnnotations=function(b,a){for(var d=c.prototype.getAnnotations.call(this,b,a),e=this._view.getModel(),h=b;h<a;h++){var f=h&1?this._oddStyle:this._evenStyle,g=h;e.getBaseModel&&(g=e.getLineStart(g),g=e.getBaseModel().getLineAtOffset(e.mapOffset(g)));d[h]||(d[h]={});d[h].html=this._firstLine+g+"";if(!d[h].style)d[h].style=f}return d};f.prototype.getWidestAnnotation=function(){var b=this._view.getModel().getLineCount();
return this.getAnnotations(b-1,b)[b-1]};f.prototype.setFirstLine=function(b){this._firstLine=b!==void 0?b:1};f.prototype._onTextModelChanged=function(b){var b=b.start,a=this._view.getModel(),d=(this._firstLine+(a.getBaseModel?a.getBaseModel().getLineCount():a.getLineCount())-1+"").length;if(this._numOfDigits!==d)this._numOfDigits=d,this._view.redrawLines(a.getLineAtOffset(b),a.getLineCount(),this)};e.prototype=new c;g.prototype=new c;g.prototype.getRulerStyle=function(){var b={style:{lineHeight:"1px",
fontSize:"1px"}};return b=this._mergeStyle(b,this._rulerStyle)};g.prototype._getTooltipContents=function(b,a){if(a.length===0){var d=this._view.getModel(),e=b;d.getBaseModel&&(e=d.getLineStart(e),e=d.getBaseModel().getLineAtOffset(d.mapOffset(e)));return i.formatMessage(l.line,e+1)}return c.prototype._getTooltipContents.call(this,b,a)};g.prototype._mergeAnnotation=function(b,a,d,c){if(d===0){if(!b)b={html:"&nbsp;",style:{style:{height:3*c+"px"}}},b.style=this._mergeStyle(b.style,a.overviewStyle);
return b}};j.prototype=new e;j.prototype.onClick=function(b){if(b!==void 0){var a=this._annotationModel;if(a){var d=this._view.getModel(),c=d.getLineStart(b),b=d.getLineEnd(b,!0);d.getBaseModel&&(c=d.mapOffset(c),b=d.mapOffset(b),d=d.getBaseModel());for(var h,a=a.getAnnotations(c,b);!h&&a.hasNext();)b=a.next(),this.isAnnotationTypeVisible(b.type)&&(h=b);h&&d.getLineAtOffset(h.start)===d.getLineAtOffset(c)&&((d=n.Tooltip.getTooltip(this._view))&&d.setTarget(null),h.expanded?h.collapse():h.expand(),
this._annotationModel.modifyAnnotation(h))}}};j.prototype._getTooltipContents=function(b,a){return a.length===1&&a[0].expanded?null:e.prototype._getTooltipContents.call(this,b,a)};j.prototype._onAnnotationModelChanged=function(b){function a(a){for(f=0;f<a.length;f++)if(h.isAnnotationTypeVisible(a[f].type)){var b=a[f].start;c.getBaseModel&&(b=c.mapOffset(b,!0));b!==-1&&(j=Math.min(j,c.getLineAtOffset(b)))}}if(b.textModelChangedEvent)e.prototype._onAnnotationModelChanged.call(this,b);else{var d=this._view;
if(d){var c=d.getModel(),h=this,f,g=c.getLineCount(),j=g;a(b.added);a(b.removed);a(b.changed);b=d.getRulers();for(f=0;f<b.length;f++)d.redrawLines(j,g,b[f])}}};return{Ruler:c,AnnotationRuler:e,LineNumberRuler:f,OverviewRuler:g,FoldingRuler:j}});
define("orion/editor/undoStack",[],function(){function l(i,c,f,e){this.offset=i;this.text=c;this.previousText=f;this.type=e}function o(i){this.owner=i;this.changes=[]}function n(i,c){this.view=i;this.size=c!==void 0?c:100;this.reset();var f=i.getModel();f.getBaseModel&&(f=f.getBaseModel());this.model=f;var e=this;this._listener={onChanging:function(c){e._onChanging(c)},onDestroy:function(c){e._onDestroy(c)}};f.addEventListener("Changing",this._listener.onChanging);i.addEventListener("Destroy",this._listener.onDestroy)}
l.prototype={getRedoChanges:function(){return[{start:this.offset,end:this.offset+this.previousText.length,text:this.text}]},getUndoChanges:function(){return[{start:this.offset,end:this.offset+this.text.length,text:this.previousText}]},undo:function(i,c){this._doUndoRedo(this.offset,this.previousText,this.text,i,c);return!0},redo:function(i,c){this._doUndoRedo(this.offset,this.text,this.previousText,i,c);return!0},merge:function(i,c,f,e,g){if(e===this.type)if(e===1&&i===this.offset+this.text.length)return this.text+=
c,!0;else if(e===-1&&g===this.offset)return this.offset=i,this.previousText=f+this.previousText,!0;else if(e===-1&&i===this.offset)return this.previousText+=f,!0;return!1},_doUndoRedo:function(i,c,f,e,g){var j=e.getModel();if(j.mapOffset&&e.annotationModel){var b=j.mapOffset(i,!0);if(b<0)for(var a=e.annotationModel.getAnnotations(i,i+1);a.hasNext();){var d=a.next();if(d.type==="orion.annotation.folding"){d.expand();b=j.mapOffset(i,!0);break}}if(b<0)return;i=b}j.setText(c,i,i+f.length);g&&e.setSelection(i,
i+c.length)}};o.prototype={getRedoChanges:function(){for(var i=[],c=0;c<this.changes.length;c++)i=i.concat(this.changes[c].getRedoChanges());return i},getUndoChanges:function(){for(var i=[],c=this.changes.length-1;c>=0;c--)i=i.concat(this.changes[c].getUndoChanges());return i},add:function(i){this.changes.push(i)},end:function(i){this.endSelection=i.getSelection();this.endCaret=i.getCaretOffset();(i=this.owner)&&i.end&&i.end()},undo:function(i,c){this.changes.length>1&&i.setRedraw(!1);for(var f=this.changes.length-
1;f>=0;f--)this.changes[f].undo(i,!1);this.changes.length>1&&i.setRedraw(!0);if(c){var f=this.startSelection.start,e=this.startSelection.end;i.setSelection(this.startCaret?f:e,this.startCaret?e:f)}(f=this.owner)&&f.undo&&f.undo();return this.changes.length>0},redo:function(i,c){this.changes.length>1&&i.setRedraw(!1);for(var f=0;f<this.changes.length;f++)this.changes[f].redo(i,!1);this.changes.length>1&&i.setRedraw(!0);if(c){var f=this.endSelection.start,e=this.endSelection.end;i.setSelection(this.endCaret?
f:e,this.endCaret?e:f)}(f=this.owner)&&f.redo&&f.redo();return this.changes.length>0},merge:function(i,c,f,e,g){var j=this.changes.length;return j>0?this.changes[j-1].merge(i,c,f,e,g):!1},start:function(i){this.startSelection=i.getSelection();this.startCaret=i.getCaretOffset();(i=this.owner)&&i.start&&i.start()}};n.prototype={add:function(i){this.compoundChange?this.compoundChange.add(i):(this.stack.splice(this.index,this.stack.length-this.index,i),this.index++,this.stack.length>this.size&&(this.stack.shift(),
this.index--))},markClean:function(){this._commitUndo();if(this.cleanChange=this.stack[this.index-1])this.cleanChange.type=2},isClean:function(){return this.cleanChange===this.stack[this.index-1]},canUndo:function(){return this.index>0},canRedo:function(){return this.stack.length-this.index>0},endCompoundChange:function(){this.compoundChange&&this.compoundChange.end(this.view);this.compoundChange=void 0},getSize:function(){return{undo:this.index,redo:this.stack.length-this.index}},getRedoChanges:function(){this._commitUndo();
for(var i=[],c=this.index;c<this.stack.length;c++)i=i.concat(this.stack[c].getRedoChanges());return i},getUndoChanges:function(){this._commitUndo();for(var i=[],c=this.index;c>=0;c--)i=i.concat(this.stack[c].getUndoChanges());return i},undo:function(){this._commitUndo();var i;i=!1;this._ignoreUndo=!0;do{if(this.index<=0)break;i=this.stack[--this.index]}while(!(i=i.undo(this.view,!0)));this._ignoreUndo=!1;return i},redo:function(){this._commitUndo();var i;this._ignoreUndo=!0;do{if(this.index>=this.stack.length)break;
i=this.stack[this.index++]}while(!i.redo(this.view,!0));this._ignoreUndo=!1;return!0},reset:function(){this.index=0;this.cleanChange=void 0;this.stack=[];this._ignoreUndo=!1;this._compoundChange=void 0},startCompoundChange:function(i){this._commitUndo();i=new o(i);this.add(i);this.compoundChange=i;this.compoundChange.start(this.view);return this.compoundChange},_commitUndo:function(){this.endCompoundChange()},_onDestroy:function(){this.model.removeEventListener("Changing",this._listener.onChanging);
this.view.removeEventListener("Destroy",this._listener.onDestroy)},_onChanging:function(i){if(!this._ignoreUndo){var c=i.text,f=i.start,e=i.addedCharCount,g=i.removedCharCount,i=f+g,j=0;e===0&&g===1?j=-1:e===1&&g===0&&(j=1);e=this.stack.length;g=this.model.getText(f,i);(!(e>0&&this.index===e)||!this.stack[e-1].merge(f,c,g,j,i))&&this.add(new l(f,c,g,j))}}};return{UndoStack:n}});
define("orion/editor/textDND",["orion/util"],function(l){function o(l,i){this._view=l;this._undoStack=i;this._dragSelection=null;this._dropOffset=-1;this._dropText=null;var c=this;this._listener={onDragStart:function(f){c._onDragStart(f)},onDragEnd:function(f){c._onDragEnd(f)},onDragEnter:function(f){c._onDragEnter(f)},onDragOver:function(f){c._onDragOver(f)},onDrop:function(f){c._onDrop(f)},onDestroy:function(f){c._onDestroy(f)}};l.addEventListener("DragStart",this._listener.onDragStart);l.addEventListener("DragEnd",
this._listener.onDragEnd);l.addEventListener("DragEnter",this._listener.onDragEnter);l.addEventListener("DragOver",this._listener.onDragOver);l.addEventListener("Drop",this._listener.onDrop);l.addEventListener("Destroy",this._listener.onDestroy)}o.prototype={destroy:function(){var l=this._view;if(l)l.removeEventListener("DragStart",this._listener.onDragStart),l.removeEventListener("DragEnd",this._listener.onDragEnd),l.removeEventListener("DragEnter",this._listener.onDragEnter),l.removeEventListener("DragOver",
this._listener.onDragOver),l.removeEventListener("Drop",this._listener.onDrop),l.removeEventListener("Destroy",this._listener.onDestroy),this._view=null},_onDestroy:function(){this.destroy()},_onDragStart:function(l){var i=this._view,c=i.getSelection(),i=i.getModel();if(i.getBaseModel)c.start=i.mapOffset(c.start),c.end=i.mapOffset(c.end),i=i.getBaseModel();if(i=i.getText(c.start,c.end))this._dragSelection=c,l.event.dataTransfer.effectAllowed="copyMove",l.event.dataTransfer.setData("Text",i)},_onDragEnd:function(n){if(this._dragSelection){var i=
this._view,c=n.event.dataTransfer.dropEffect;if(!l.isFirefox&&(c!=="none"||this._dropText))c=n.event.dataTransfer.dropEffect=this._dropEffect;this._undoStack&&this._undoStack.startCompoundChange();(n=c==="move")&&i.setText("",this._dragSelection.start,this._dragSelection.end);if(this._dropText){var c=this._dropText,f=this._dropOffset;if(n)if(f>=this._dragSelection.end)f-=this._dragSelection.end-this._dragSelection.start;else if(f>=this._dragSelection.start)f=this._dragSelection.start;i.setText(c,
f,f);i.setSelection(f,f+c.length);this._dropText=null;this._dropOffset=-1}this._undoStack&&this._undoStack.endCompoundChange()}this._dragSelection=null},_onDragEnter:function(l){this._onDragOver(l)},_onDragOver:function(n){var i=n.event.dataTransfer.types,c=!this._view.getOptions("readonly");c&&i&&(c=i.contains?i.contains("text/plain")||i.contains("Text"):i.indexOf("text/plain")!==-1||i.indexOf("Text")!==-1);if(c){if(!l.isFirefox)this._dropEffect=n.event.dataTransfer.dropEffect=(l.isMac?n.event.altKey:
n.event.ctrlKey)?"copy":"move"}else n.event.dataTransfer.dropEffect="none"},_onDrop:function(n){var i=this._view,c=n.event.dataTransfer.getData("Text");if(c){if(!l.isFirefox)n.event.dataTransfer.dropEffect=this._dropEffect;n=i.getOffsetAtLocation(n.x,n.y);this._dragSelection?(this._dropOffset=n,this._dropText=c):(i.setText(c,n,n),i.setSelection(n,n+c.length))}}};return{TextDND:o}});
define("orion/objects",[],function(){function l(l){for(var n=1;n<arguments.length;n++){var i=arguments[n],c;for(c in i)Object.prototype.hasOwnProperty.call(i,c)&&(l[c]=i[c])}return l}return{clone:function(o){if(Array.isArray(o))return Array.prototype.slice.call(o);var n=Object.create(Object.getPrototypeOf(o));l(n,o);return n},mixin:l,toArray:function(l){return Array.isArray(l)?l:[l]}}});
define("orion/editor/editor","i18n!orion/editor/nls/messages,orion/editor/eventTarget,orion/editor/tooltip,orion/editor/annotations,orion/objects,orion/util".split(","),function(l,o,n,i,c,f){function e(b){b=b||{};this._domNode=b.domNode;this._statusReporter=b.statusReporter;this._dirty=!1;this._title=null}function g(b){b=b||{};e.call(this,b);this._textViewFactory=b.textViewFactory;this._undoStackFactory=b.undoStackFactory;this._textDNDFactory=b.textDNDFactory;this._annotationFactory=b.annotationFactory;
this._foldingRulerFactory=b.foldingRulerFactory;this._lineNumberRulerFactory=b.lineNumberRulerFactory;this._contentAssistFactory=b.contentAssistFactory;this._keyBindingFactory=b.keyBindingFactory;this._contentAssist=this._foldingRuler=this._overviewRuler=this._lineNumberRuler=this._annotationRuler=this._annotationModel=this._annotationStyler=null}var j=i.AnnotationType;e.prototype={destroy:function(){this.uninstall();this._statusReporter=this._domNode=null},focus:function(){},getModel:function(){return this._model},
getText:function(b,a){return this.getModel().getText(b,a)},getTitle:function(){return this._title},install:function(){},isDirty:function(){return this._dirty},markClean:function(){this.setDirty(!1)},onDirtyChanged:function(b){return this.dispatchEvent(b)},onInputChanged:function(b){return this.dispatchEvent(b)},reportStatus:function(b,a,d){this._statusReporter&&this._statusReporter(b,a,d)},resize:function(){},setDirty:function(b){if(this._dirty!==b)this._dirty=b,this.onDirtyChanged({type:"DirtyChanged"})},
setInput:function(b,a,d,c){this._title=b;this.onInputChanged({type:"InputChanged",title:b,message:a,contents:d,contentsSaved:c})},uninstall:function(){}};o.EventTarget.addMixin(e.prototype);g.prototype=new e;c.mixin(g.prototype,{destroy:function(){e.prototype.destroy.call(this);this._textViewFactory=this._undoStackFactory=this._textDNDFactory=this._annotationFactory=this._foldingRulerFactory=this._lineNumberRulerFactory=this._contentAssistFactory=this._keyBindingFactory=null},getAnnotationModel:function(){return this._annotationModel},
getAnnotationRuler:function(){return this._annotationRuler},getAnnotationStyler:function(){return this._annotationStyler},getContentAssist:function(){return this._contentAssist},getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},getModel:function(){var b=this._textView.getModel();b.getBaseModel&&(b=b.getBaseModel());return b},getOverviewRuler:function(){return this._overviewRuler},getTextView:function(){return this._textView},getUndoStack:function(){return this._undoStack},
getKeyModes:function(){return this._textView.getKeyModes()},getSourceCodeActions:function(){return this._sourceCodeActions},getLinkedMode:function(){return this._linkedMode},getTextActions:function(){return this._textActions},focus:function(){this._textView&&this._textView.focus()},markClean:function(){this.getUndoStack().markClean()},resize:function(){this._textView&&this._textView.resize()},setAnnotationRulerVisible:function(b,a){if(this._annotationRulerVisible!==b||a)if(this._annotationRulerVisible=
b,this._annotationRuler){var d=this._textView;b?d.addRuler(this._annotationRuler,0):d.removeRuler(this._annotationRuler)}},setFoldingRulerVisible:function(b,a){if(this._foldingRulerVisible!==b||a)if(this._foldingRulerVisible=b,this._foldingRuler){var d=this._textView;d.getModel().getBaseModel&&(b?d.addRuler(this._foldingRuler):d.removeRuler(this._foldingRuler))}},setLineNumberRulerVisible:function(b,a){if(this._lineNumberRulerVisible!==b||a)if(this._lineNumberRulerVisible=b,this._lineNumberRuler){var d=
this._textView;b?d.addRuler(this._lineNumberRuler,!this._annotationRulerVisible?0:1):d.removeRuler(this._lineNumberRuler)}},setOverviewRulerVisible:function(b,a){if(this._overviewRulerVisible!==b||a)if(this._overviewRulerVisible=b,this._overviewRuler){var d=this._textView;b?d.addRuler(this._overviewRuler):d.removeRuler(this._overviewRuler)}},mapOffset:function(b,a){var d=this._textView.getModel();d.getBaseModel&&(b=d.mapOffset(b,a));return b},getLineAtOffset:function(b){return this.getModel().getLineAtOffset(this.mapOffset(b))},
getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},getSelection:function(){var b=this._textView,a=b.getSelection(),b=b.getModel();if(b.getBaseModel)a.start=b.mapOffset(a.start),a.end=b.mapOffset(a.end);return a},_expandOffset:function(b){var a=this._textView.getModel(),d=this._annotationModel;if(d&&a.getBaseModel)for(b=d.getAnnotations(b,b+1);b.hasNext();)a=b.next(),a.type===j.ANNOTATION_FOLDING&&a.expand&&(a.expand(),d.modifyAnnotation(a))},setCaretOffset:function(b,
a,d){var c=this._textView,h=c.getModel();h.getBaseModel&&(this._expandOffset(b),b=h.mapOffset(b,!0));c.setCaretOffset(b,a,d)},setText:function(b,a,d){var c=this._textView,h=c.getModel();h.getBaseModel&&(a!==void 0&&(this._expandOffset(a),a=h.mapOffset(a,!0)),d!==void 0&&(this._expandOffset(d),d=h.mapOffset(d,!0)));c.setText(b,a,d)},setSelection:function(b,a,d,c){var h=this._textView,e=h.getModel();e.getBaseModel&&(this._expandOffset(b),this._expandOffset(a),b=e.mapOffset(b,!0),a=e.mapOffset(a,!0));
h.setSelection(b,a,d,c)},moveSelection:function(b,a,d,c){var h=this._textView;this.setSelection(b,a||b,1/3,function(){(c===void 0||c)&&h.focus();d&&d()})},checkDirty:function(){this.setDirty(!this._undoStack.isClean())},_getTooltipInfo:function(b,a){var d=this._textView,c=this.getAnnotationModel();if(!c)return null;var h=this._annotationStyler;if(!h)return null;var e=d.getOffsetAtLocation(b,a);if(e===-1)return null;e=this.mapOffset(e);h=h.getAnnotationsByType(c,e,e+1);c=[];for(e=0;e<h.length;e++)h[e].rangeStyle&&
c.push(h[e]);if(c.length===0)return null;d=d.convert({x:b,y:a},"document","page");return{contents:c,anchor:"left",x:d.x+10,y:d.y+20}},_highlightCurrentLine:function(b,a){var d=this._annotationModel;if(d){var c=this._textView;if(!c.getOptions("singleMode")){var h=c.getModel(),e=a?h.getLineAtOffset(a.start):-1,f=h.getLineAtOffset(b.start),c=b.start===b.end,g=!a||a.start===a.end,i=h.getLineStart(f),l=h.getLineEnd(f);h.getBaseModel&&(i=h.mapOffset(i),l=h.mapOffset(l));h=this._currentLineAnnotation;if(!(e===
f&&g&&c&&h&&h.start===i&&h.end===l)){var e=h?[h]:null,n;c&&(h=j.createAnnotation(j.ANNOTATION_CURRENT_LINE,i,l),n=[h]);this._currentLineAnnotation=h;d.replaceAnnotations(e,n)}}}},install:function(){this.installTextView()},installTextView:function(){if(!this._textView){this._textView=this._textViewFactory();if(this._undoStackFactory)this._undoStack=this._undoStackFactory.createUndoStack(this);if(this._textDNDFactory)this._textDND=this._textDNDFactory.createTextDND(this,this._undoStack);if(this._contentAssistFactory)this._contentAssist=
this._contentAssistFactory.createContentAssistMode(this).getContentAssist();var b=this,a=this._textView,d=this;this._listener={onModelChanged:function(){d.checkDirty()},onMouseOver:function(a){d._listener.onMouseMove(a)},onMouseMove:function(b){var c=n.Tooltip.getTooltip(a);if(c&&!(d._listener.lastMouseX===b.event.clientX&&d._listener.lastMouseY===b.event.clientY))d._listener.lastMouseX=b.event.clientX,d._listener.lastMouseY=b.event.clientY,c.setTarget({x:b.x,y:b.y,getTooltipInfo:function(){return d._getTooltipInfo(this.x,
this.y)}})},onMouseOut:function(b){var c=n.Tooltip.getTooltip(a);if(c&&!(d._listener.lastMouseX===b.event.clientX&&d._listener.lastMouseY===b.event.clientY))d._listener.lastMouseX=b.event.clientX,d._listener.lastMouseY=b.event.clientY,c.setTarget(null)},onScroll:function(){var b=n.Tooltip.getTooltip(a);b&&b.setTarget(null,0,0)},onSelection:function(a){d._updateCursorStatus();d._highlightCurrentLine(a.newValue,a.oldValue)}};a.addEventListener("ModelChanged",this._listener.onModelChanged);a.addEventListener("Selection",
this._listener.onSelection);a.addEventListener("MouseOver",this._listener.onMouseOver);a.addEventListener("MouseOut",this._listener.onMouseOut);a.addEventListener("MouseMove",this._listener.onMouseMove);a.addEventListener("Scroll",this._listener.onScroll);if(this._keyBindingFactory){var c;if(c=typeof this._keyBindingFactory==="function"?this._keyBindingFactory(this,this.getKeyModes(),this._undoStack,this._contentAssist):this._keyBindingFactory.createKeyBindings(b,this._undoStack,this._contentAssist))this._textActions=
c.textActions,this._linkedMode=c.linkedMode,this._sourceCodeActions=c.sourceCodeActions}c=function(a){if(a!==void 0&&a!==-1){for(var d=this.getView().getModel(),c=this.getAnnotationModel(),h=b.mapOffset(d.getLineStart(a)),a=b.mapOffset(d.getLineEnd(a)),d=c.getAnnotations(h,a),e=null;d.hasNext();){var f=d.next();if(f.type===j.ANNOTATION_BOOKMARK){e=f;break}}e?c.removeAnnotation(e):(e=j.createAnnotation(j.ANNOTATION_BOOKMARK,h,a),e.title=void 0,c.addAnnotation(e))}};if(this._annotationFactory){var h=
a.getModel();h.getBaseModel&&(h=h.getBaseModel());if(this._annotationModel=this._annotationFactory.createAnnotationModel(h))if(h=this._annotationStyler=this._annotationFactory.createAnnotationStyler(a,this._annotationModel))h.addAnnotationType(j.ANNOTATION_CURRENT_SEARCH),h.addAnnotationType(j.ANNOTATION_MATCHING_SEARCH),h.addAnnotationType(j.ANNOTATION_ERROR),h.addAnnotationType(j.ANNOTATION_WARNING),h.addAnnotationType(j.ANNOTATION_MATCHING_BRACKET),h.addAnnotationType(j.ANNOTATION_CURRENT_BRACKET),
h.addAnnotationType(j.ANNOTATION_CURRENT_LINE),h.addAnnotationType(j.ANNOTATION_READ_OCCURRENCE),h.addAnnotationType(j.ANNOTATION_WRITE_OCCURRENCE),h.addAnnotationType(j.ANNOTATION_SELECTED_LINKED_GROUP),h.addAnnotationType(j.ANNOTATION_CURRENT_LINKED_GROUP),h.addAnnotationType(j.ANNOTATION_LINKED_GROUP),h.addAnnotationType("orion.annotation.highlightError");a.annotationModel=this._annotationModel;var h=this._annotationFactory.createAnnotationRulers(this._annotationModel),e=this._annotationRuler=
h.annotationRuler;if(e)e.onDblClick=c,e.setMultiAnnotationOverlay({html:"<div class='annotationHTML overlay'></div>"}),e.addAnnotationType(j.ANNOTATION_ERROR),e.addAnnotationType(j.ANNOTATION_WARNING),e.addAnnotationType(j.ANNOTATION_TASK),e.addAnnotationType(j.ANNOTATION_BOOKMARK);this.setAnnotationRulerVisible(this._annotationRulerVisible||this._annotationRulerVisible===void 0,!0);if(e=this._overviewRuler=h.overviewRuler)e.addAnnotationType(j.ANNOTATION_CURRENT_SEARCH),e.addAnnotationType(j.ANNOTATION_MATCHING_SEARCH),
e.addAnnotationType(j.ANNOTATION_READ_OCCURRENCE),e.addAnnotationType(j.ANNOTATION_WRITE_OCCURRENCE),e.addAnnotationType(j.ANNOTATION_CURRENT_BLAME),e.addAnnotationType(j.ANNOTATION_ERROR),e.addAnnotationType(j.ANNOTATION_WARNING),e.addAnnotationType(j.ANNOTATION_TASK),e.addAnnotationType(j.ANNOTATION_BOOKMARK),e.addAnnotationType(j.ANNOTATION_MATCHING_BRACKET),e.addAnnotationType(j.ANNOTATION_CURRENT_BRACKET),e.addAnnotationType(j.ANNOTATION_CURRENT_LINE);this.setOverviewRulerVisible(this._overviewRulerVisible||
this._overviewRulerVisible===void 0,!0)}if(this._lineNumberRulerFactory)this._lineNumberRuler=this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel),this._lineNumberRuler.addAnnotationType(j.ANNOTATION_CURRENT_BLAME),this._lineNumberRuler.addAnnotationType(j.ANNOTATION_BLAME),this._lineNumberRuler.onDblClick=c,this.setLineNumberRulerVisible(this._lineNumberRulerVisible||this._lineNumberRulerVisible===void 0,!0);if(this._foldingRulerFactory)this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel),
this._foldingRuler.addAnnotationType(j.ANNOTATION_FOLDING),this.setFoldingRulerVisible(this._foldingRulerVisible||this._foldingRulerVisible===void 0,!0);this.dispatchEvent({type:"TextViewInstalled",textView:a})}},uninstall:function(){this.uninstallTextView()},uninstallTextView:function(){var b=this._textView;if(b)b.destroy(),this._textView=this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=this._annotationStyler=this._annotationRuler=this._overviewRuler=this._lineNumberRuler=
this._foldingRuler=this._currentLineAnnotation=this._title=null,this._dirty=!1,this._foldingRulerVisible=this._overviewRulerVisible=this._lineNumberRulerVisible=this._annotationRulerVisible=void 0,this.dispatchEvent({type:"TextViewUninstalled",textView:b})},_updateCursorStatus:function(){var b=this.getModel(),a=this.getCaretOffset(),d=b.getLineAtOffset(a),b=b.getLineStart(d);a-=b;for(var b=this.getKeyModes(),c=0;c<b.length;c++){var h=b[c];if(h.isActive()&&h.isStatusActive&&h.isStatusActive())return}this.reportStatus(f.formatMessage(l.lineColumn,
d+1,a+1))},showAnnotations:function(b,a,d,c){var h=this._annotationModel;if(h){for(var e=[],f=[],g=h.getTextModel(),i=h.getAnnotations(0,g.getCharCount()),l;i.hasNext();)l=i.next(),a.indexOf(l.type)!==-1&&l.creatorID===this&&e.push(l);if(b)for(a=0;a<b.length;a++)if(l=b[a]){if(d)l=d(l);else{var n;typeof l.line==="number"?(n=g.getLineStart(l.line-1),i=n+l.start-1,n=n+l.end-1):(i=l.start,n=l.end);var o=c(l);if(!o)continue;l=j.createAnnotation(o,i,n,l.description)}l.creatorID=this;f.push(l)}h.replaceAnnotations(e,
f)}},showProblems:function(b){this.showAnnotations(b,[j.ANNOTATION_ERROR,j.ANNOTATION_WARNING,j.ANNOTATION_TASK],null,function(a){switch(a.severity){case "error":return j.ANNOTATION_ERROR;case "warning":return j.ANNOTATION_WARNING;case "task":return j.ANNOTATION_TASK}return null})},showOccurrences:function(b){this.showAnnotations(b,[j.ANNOTATION_READ_OCCURRENCE,j.ANNOTATION_WRITE_OCCURRENCE],null,function(a){return a.readAccess?j.ANNOTATION_READ_OCCURRENCE:j.ANNOTATION_WRITE_OCCURRENCE})},showBlame:function(b){var a=
this._blameRGB,d=this.getTextView().getOptions("parent").ownerDocument;if(!a){var e=f.createElement(d,"div");e.className="annotation blame";d.body.appendChild(e);var h=(d.defaultView||d.parentWindow).getComputedStyle(e).getPropertyValue("background-color");e.parentNode.removeChild(e);var e=h.indexOf("("),g=h.indexOf(")"),h=h.substring(e+1,g);this._blameRGB=a=h.split(",").slice(0,3)}var s=function(){var a=i.AnnotationType.createAnnotation(this.groupType,this.start,this.end,this.title);a.style=c.mixin({},
a.style);a.style.style=c.mixin({},a.style.style);a.style.style.backgroundColor="";this.groupAnnotation=a;a.blame=this.blame;a.html=this.html;a.creatorID=this.creatorID;return a},r=function(){var a=f.createElement(d,"div");a.className="tooltipTitle";var b=this.blame.Message.indexOf("\n");if(b===-1)b=this.blame.Message.length;var c=f.createElement(d,"a");c.href=this.blame.CommitLink;c.appendChild(d.createTextNode(this.blame.Message.substring(0,b)));a.appendChild(c);a.appendChild(f.createElement(d,"br"));
a.appendChild(d.createTextNode(f.formatMessage(l.committerOnTime,this.blame.AuthorName,this.blame.Time)));return a},q=this.getModel();this.showAnnotations(b,[j.ANNOTATION_BLAME,j.ANNOTATION_CURRENT_BLAME],function(b){var d=q.getLineStart(b.Start-1),h=q.getLineEnd(b.End-1,!0),d=i.AnnotationType.createAnnotation(j.ANNOTATION_BLAME,d,h,r),h=a.slice(0);h.push(b.Shade);d.style=c.mixin({},d.style);d.style.style=c.mixin({},d.style.style);d.style.style.backgroundColor="rgba("+h.join()+")";d.groupId=b.Name;
d.groupType=j.ANNOTATION_CURRENT_BLAME;d.createGroupAnnotation=s;d.html='<img class="annotationHTML blame" src="'+b.AuthorImage+'"/>';d.blame=b;return d})},showSelection:function(b,a,d,c,h){typeof b==="number"?(typeof a!=="number"&&(a=b),this.moveSelection(b,a)):typeof d==="number"&&(b=this.getModel().getLineStart(d-1),typeof c==="number"&&(b+=c),typeof h!=="number"&&(h=0),this.moveSelection(b,b+h))},setInput:function(b,a,d,c,h){this._textView&&(c||(a?this._textView.setText(a):d!==null&&d!==void 0&&
(this._textView.setText(d),this._textView.getModel().setLineDelimiter("auto"),this._highlightCurrentLine(this._textView.getSelection())),this._undoStack.reset(),h||this._textView.focus()),this.checkDirty());e.prototype.setInput.call(this,b,a,d,c)},onGotoLine:function(b,a,d,c){if(this._textView){var h=this.getModel(),b=Math.max(0,Math.min(b,h.getLineCount()-1)),e=h.getLineStart(b),f=0;d===void 0&&(d=0);typeof a==="string"?(b=h.getLine(b).indexOf(a),b!==-1&&(f=b,d=f+a.length)):(f=a,a=h.getLineEnd(b)-
e,f=Math.min(f,a),d=Math.min(d,a));this.moveSelection(e+f,e+d,c)}}});return{BaseEditor:e,Editor:g}});
define("orion/editor/find","i18n!orion/editor/nls/messages,orion/keyBinding,orion/editor/keyModes,orion/editor/annotations,orion/regex,orion/objects,orion/util".split(","),function(l,o,n,i,c,f,e){function g(a){var b=a.getTextView();n.KeyMode.call(this,b);this.editor=a;this._active=!1;this._success=!0;this._ignoreSelection=!1;this._prefix="";b.setAction("incrementalFindCancel",function(){this.setActive(!1);return!0}.bind(this));b.setAction("incrementalFindBackspace",function(){return this._backspace()}.bind(this));
var e=this;this._listener={onVerify:function(a){var b=e.editor,d=b.getModel(),f=b.mapOffset(a.start),b=b.mapOffset(a.end),d=d.getText(f,b);if((d=e._prefix.match(RegExp("^"+c.escape(d),"i")))&&d.length>0)e._prefix+=a.text,e._success=!0,e._status(),e.find(e._forward,!0),a.text=null},onSelection:function(){e._ignoreSelection||e.setActive(!1)}}}function j(a,b,c){if(a){this._editor=a;this._undoStack=b;this._showAll=!0;this._visible=!1;this._wrap=this._caseInsensitive=!0;this._wholeWord=!1;this._incremental=
!0;this._regex=!1;this._findAfterReplace=!0;this._reverse=this._hideAfterFind=!1;this._timer=this._end=this._start=void 0;this._lastString="";var h=this;this._listeners={onEditorFocus:function(a){h._removeCurrentAnnotation(a)}};this.setOptions(c)}}var b={};g.prototype=new n.KeyMode;f.mixin(g.prototype,{createKeyBindings:function(){var a=o.KeyBinding,b=[];b.push({actionID:"incrementalFindBackspace",keyBinding:new a(8)});b.push({actionID:"incrementalFindCancel",keyBinding:new a(13)});b.push({actionID:"incrementalFindCancel",
keyBinding:new a(27)});b.push({actionID:"incrementalFindReverse",keyBinding:new a(38)});b.push({actionID:"incrementalFind",keyBinding:new a(40)});b.push({actionID:"incrementalFindReverse",keyBinding:new a("k",!0,!0)});b.push({actionID:"incrementalFind",keyBinding:new a("k",!0)});return b},find:function(a,b){this._forward=a;if(!this.isActive())return this.setActive(!0),!1;var c=this._prefix;if(c.length===0)return!1;var h=this.editor,e=h.getModel(),e=a?this._success?b?this._start:h.getCaretOffset()+
1:0:this._success?b?this._start:h.getCaretOffset():e.getCharCount()-1;if(c=h.getModel().find({string:c,start:e,reverse:!a,caseInsensitive:c.toLowerCase()===c}).next()){if(!b)this._start=e;this._ignoreSelection=this._success=!0;h.moveSelection(a?c.start:c.end,a?c.end:c.start);this._ignoreSelection=!1}else this._success=!1;this._status();return!0},isActive:function(){return this._active},isStatusActive:function(){return this.isActive()},setActive:function(a){if(this._active!==a)this._active=a,this._prefix=
"",this._success=!0,a=this.editor.getTextView(),this._start=this.editor.getCaretOffset(),this.editor.setCaretOffset(this._start),this._active?(a.addEventListener("Verify",this._listener.onVerify),a.addEventListener("Selection",this._listener.onSelection),a.addKeyMode(this)):(a.removeEventListener("Verify",this._listener.onVerify),a.removeEventListener("Selection",this._listener.onSelection),a.removeKeyMode(this)),this._status()},_backspace:function(){var a=this._prefix,a=this._prefix=a.substring(0,
a.length-1);return a.length===0?(this._ignoreSelection=this._success=!0,this.editor.setCaretOffset(this.editor.getSelection().start),this._ignoreSelection=!1,this._status(),!0):this.find(this._forward,!0)},_status:function(){if(this.isActive()){var a;a=this._forward?this._success?l.incrementalFindStr:l.incrementalFindStrNotFound:this._success?l.incrementalFindReverseStr:l.incrementalFindReverseStrNotFound;a=e.formatMessage(a,this._prefix);this.editor.reportStatus(a,this._success?"":"error")}else this.editor.reportStatus("")}});
b.IncrementalFind=g;j.prototype={find:function(a,b,c){this.setOptions({reverse:!a});var h=this.getFindString(),e;if(b)h=b.findString||h,e=b.count;a=this.getOptions();this.setOptions(b);b=c?this._startOffset:this.getStartOffset();if((e=this._doFind(h,b,e))&&!c)this._startOffset=e.start;this.setOptions(a);this._hideAfterFind&&this.hide();return e},getStartOffset:function(){return this._start!==void 0?this._start:this._reverse?this._editor.getSelection().start-1:this._editor.getCaretOffset()},getFindString:function(){var a=
this._editor.getSelection(),a=this._editor.getText(a.start,a.end);this._regex&&(a=c.escape(a));return a||this._lastString},getOptions:function(){return{showAll:this._showAll,caseInsensitive:this._caseInsensitive,wrap:this._wrap,wholeWord:this._wholeWord,incremental:this._incremental,regex:this._regex,findAfterReplace:this._findAfterReplace,hideAfterFind:this._hideAfterFind,reverse:this._reverse,findCallback:this._findCallback,start:this._start,end:this._end}},getReplaceString:function(){return""},
hide:function(){this._visible=!1;if(this._savedOptions&&(this.setOptions(this._savedOptions.pop()),this._savedOptions.length===0))this._savedOptions=null;this._removeAllAnnotations();var a=this._editor.getTextView();a&&(a.removeEventListener("Focus",this._listeners.onEditorFocus),a.focus())},_processReplaceString:function(a){var b=a;if(this._regex){for(var b="",c=!1,h=this._editor.getModel().getLineDelimiter(),e=0;e<a.length;e++){var f=a.substring(e,e+1);if(c){switch(f){case "R":b+=h;break;case "r":b+=
"\r";break;case "n":b+="\n";break;case "t":b+="\t";break;case "\\":b+="\\";break;default:b+="\\"+f}c=!1}else f==="\\"?c=!0:b+=f}c&&(b+="\\")}return b},isVisible:function(){return this._visible},replace:function(){var a=this.getFindString();if(a){var b=this._editor,c=this._processReplaceString(this.getReplaceString()),h=b.getSelection().start;if(b=b.getModel().find({string:a,start:h,reverse:!1,wrap:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive}).next())this.startUndo(),
this._doReplace(b.start,b.end,a,c),this.endUndo()}this._findAfterReplace&&a&&this._doFind(a,this.getStartOffset())},replaceAll:function(){var a=this.getFindString();if(a){this._replacingAll=!0;var b=this._editor,c=b.getTextView();b.reportStatus(l.replaceAll);var h=this._processReplaceString(this.getReplaceString()),f=this;window.setTimeout(function(){for(var g=0,j=0;;){var i=f._doFind(a,g,null,!0);if(!i)break;j++;j===1&&(c.setRedraw(!1),f.startUndo());f._doReplace(i.start,i.end,a,h);g=f.getStartOffset()}j>
0&&(f.endUndo(),c.setRedraw(!0));g>0?b.reportStatus(e.formatMessage(l.replacedMatches,j)):b.reportStatus(l.nothingReplaced,"error");f._replacingAll=!1},100)}},setOptions:function(a){if(a){if((a.showAll===!0||a.showAll===!1)&&this._showAll!==a.showAll)if(this._showAll=a.showAll,this.isVisible())if(this._showAll)this._markAllOccurrences();else{var b=this._editor.getAnnotationModel();b&&b.removeAnnotations(i.AnnotationType.ANNOTATION_MATCHING_SEARCH)}if(a.caseInsensitive===!0||a.caseInsensitive===!1)this._caseInsensitive=
a.caseInsensitive;if(a.wrap===!0||a.wrap===!1)this._wrap=a.wrap;if(a.wholeWord===!0||a.wholeWord===!1)this._wholeWord=a.wholeWord;if(a.incremental===!0||a.incremental===!1)this._incremental=a.incremental;if(a.regex===!0||a.regex===!1)this._regex=a.regex;if(a.findAfterReplace===!0||a.findAfterReplace===!1)this._findAfterReplace=a.findAfterReplace;if(a.hideAfterFind===!0||a.hideAfterFind===!1)this._hideAfterFind=a.hideAfterFind;if(a.reverse===!0||a.reverse===!1)this._reverse=a.reverse;if(a.hasOwnProperty("findCallback"))this._findCallback=
a.findCallback;if(a.hasOwnProperty("start"))this._start=a.start;if(a.hasOwnProperty("end"))this._end=a.end}},show:function(a){this._visible=!0;if(a){if(!this._savedOptions)this._savedOptions=[];this._savedOptions.push(this.getOptions());this.setOptions(a)}this._startOffset=this._editor.getSelection().start;this._editor.getTextView().addEventListener("Focus",this._listeners.onEditorFocus);var b=this;window.setTimeout(function(){b._incremental&&b.find(!0,null,!0)},0)},startUndo:function(){this._undoStack&&
this._undoStack.startCompoundChange()},endUndo:function(){this._undoStack&&this._undoStack.endCompoundChange()},_find:function(a,b,c){return this._editor.getModel().find({string:a,start:b,end:this._end,reverse:this._reverse,wrap:c?!1:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive})},_doFind:function(a,b,c,h){var c=c||1,e=this._editor;if(!a)return this._removeAllAnnotations(),null;this._lastString=a;var f,g;if(this._regex)try{g=this._find(a,b,h)}catch(j){e.reportStatus(j.message,
"error");return}else g=this._find(a,b,h);for(a=0;a<c&&g.hasNext();a++)f=g.next();if(!this._replacingAll){f?this._editor.reportStatus(""):this._editor.reportStatus(l.notFound,"error");if(this.isVisible()){c=i.AnnotationType.ANNOTATION_CURRENT_SEARCH;if(g=e.getAnnotationModel())g.removeAnnotations(c),f&&g.addAnnotation(i.AnnotationType.createAnnotation(c,f.start,f.end));if(this._showAll){this._timer&&window.clearTimeout(this._timer);var n=this;this._timer=window.setTimeout(function(){n._markAllOccurrences();
n._timer=null},500)}}this._findCallback?this._findCallback(f):f&&e.moveSelection(f.start,f.end,null,!1)}return f},_doReplace:function(a,b,c,h){var e=this._editor;if(this._regex&&(h=e.getText(a,b).replace(RegExp(c,this._caseInsensitive?"i":""),h),!h))return;e.setText(h,a,b);e.setSelection(a,a+h.length,!0)},_markAllOccurrences:function(){var a=this._editor.getAnnotationModel();if(a){for(var b=i.AnnotationType.ANNOTATION_MATCHING_SEARCH,c=a.getAnnotations(0,a.getTextModel().getCharCount()),h=[],e;c.hasNext();){var f=
c.next();f.type===b&&h.push(f)}if(this.isVisible()){c=this.getFindString();c=this._editor.getModel().find({string:c,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive});for(e=[];c.hasNext();)f=c.next(),e.push(i.AnnotationType.createAnnotation(b,f.start,f.end))}a.replaceAnnotations(h,e)}},_removeAllAnnotations:function(){var a=this._editor.getAnnotationModel();a&&(a.removeAnnotations(i.AnnotationType.ANNOTATION_CURRENT_SEARCH),a.removeAnnotations(i.AnnotationType.ANNOTATION_MATCHING_SEARCH))},
_removeCurrentAnnotation:function(){var a=this._editor.getAnnotationModel();a&&a.removeAnnotations(i.AnnotationType.ANNOTATION_CURRENT_SEARCH)}};b.Find=j;return b});
define("orion/editor/actions","i18n!orion/editor/nls/messages,orion/keyBinding,orion/editor/annotations,orion/editor/tooltip,orion/editor/find,orion/util".split(","),function(l,o,n,i,c,f){function e(a,b,e){this.editor=a;this.undoStack=b;this._incrementalFind=new c.IncrementalFind(a);this._find=e?e:new c.Find(a,b);this._lastEditLocation=null;this.init()}function g(a,b,c,h){this.editor=a;this.undoStack=b;this.contentAssist=c;this.linkedMode=h;this.contentAssist&&this.contentAssist.addEventListener("ProposalApplied",
this.contentAssistProposalApplied.bind(this));this.init()}var j=n.AnnotationType,b={};e.prototype={init:function(){var a=this.editor.getTextView();this._lastEditListener={onModelChanged:function(a){if(this.editor.isDirty())this._lastEditLocation=a.start+a.addedCharCount}.bind(this)};a.addEventListener("ModelChanged",this._lastEditListener.onModelChanged);a.setAction("undo",function(a){if(this.undoStack){var b=1;if(a&&a.count)b=a.count;for(;b>0;)this.undoStack.undo(),--b;return!0}return!1}.bind(this),
{name:l.undo});a.setAction("redo",function(a){if(this.undoStack){var b=1;if(a&&a.count)b=a.count;for(;b>0;)this.undoStack.redo(),--b;return!0}return!1}.bind(this),{name:l.redo});a.setKeyBinding(new o.KeyBinding("f",!0),"find");a.setAction("find",function(){if(this._find){var a=this.editor.getSelection();(a=prompt(l.find,this.editor.getText(a.start,a.end)))&&this._find.find(!0,{findString:a})}}.bind(this),{name:l.find});a.setKeyBinding(new o.KeyBinding("k",!0),"findNext");a.setAction("findNext",function(a){return this._find?
(this._find.find(!0,a),!0):!1}.bind(this),{name:l.findNext});a.setKeyBinding(new o.KeyBinding("k",!0,!0),"findPrevious");a.setAction("findPrevious",function(a){return this._find?(this._find.find(!1,a),!0):!1}.bind(this),{name:l.findPrevious});a.setKeyBinding(new o.KeyBinding("j",!0),"incrementalFind");a.setAction("incrementalFind",function(){this._incrementalFind&&this._incrementalFind.find(!0);return!0}.bind(this),{name:l.incrementalFind});a.setKeyBinding(new o.KeyBinding("j",!0,!0),"incrementalFindReverse");
a.setAction("incrementalFindReverse",function(){this._incrementalFind&&this._incrementalFind.find(!1);return!0}.bind(this),{name:l.incrementalFindReverse});a.setAction("tab",function(){return this.indentLines()}.bind(this));a.setAction("shiftTab",function(){return this.unindentLines()}.bind(this),{name:l.unindentLines});a.setKeyBinding(new o.KeyBinding(38,!1,!1,!0),"moveLinesUp");a.setAction("moveLinesUp",function(){return this.moveLinesUp()}.bind(this),{name:l.moveLinesUp});a.setKeyBinding(new o.KeyBinding(40,
!1,!1,!0),"moveLinesDown");a.setAction("moveLinesDown",function(){return this.moveLinesDown()}.bind(this),{name:l.moveLinesDown});a.setKeyBinding(new o.KeyBinding(38,!0,!1,!0),"copyLinesUp");a.setAction("copyLinesUp",function(){return this.copyLinesUp()}.bind(this),{name:l.copyLinesUp});a.setKeyBinding(new o.KeyBinding(40,!0,!1,!0),"copyLinesDown");a.setAction("copyLinesDown",function(){return this.copyLinesDown()}.bind(this),{name:l.copyLinesDown});a.setKeyBinding(new o.KeyBinding("d",!0,!1,!1),
"deleteLines");a.setAction("deleteLines",function(a){return this.deleteLines(a)}.bind(this),{name:l.deleteLines});a.setKeyBinding(new o.KeyBinding("l",!f.isMac,!1,!1,f.isMac),"gotoLine");a.setAction("gotoLine",function(){return this.gotoLine()}.bind(this),{name:l.gotoLine});a.setKeyBinding(new o.KeyBinding(190,!0),"nextAnnotation");a.setAction("nextAnnotation",function(){return this.nextAnnotation(!0)}.bind(this),{name:l.nextAnnotation});a.setKeyBinding(new o.KeyBinding(188,!0),"previousAnnotation");
a.setAction("previousAnnotation",function(){return this.nextAnnotation(!1)}.bind(this),{name:l.prevAnnotation});a.setKeyBinding(new o.KeyBinding("e",!0,!1,!0,!1),"expand");a.setAction("expand",function(){return this.expandAnnotation(!0)}.bind(this),{name:l.expand});a.setKeyBinding(new o.KeyBinding("c",!0,!1,!0,!1),"collapse");a.setAction("collapse",function(){return this.expandAnnotation(!1)}.bind(this),{name:l.collapse});a.setKeyBinding(new o.KeyBinding("e",!0,!0,!0,!1),"expandAll");a.setAction("expandAll",
function(){return this.expandAnnotations(!0)}.bind(this),{name:l.expandAll});a.setKeyBinding(new o.KeyBinding("c",!0,!0,!0,!1),"collapseAll");a.setAction("collapseAll",function(){return this.expandAnnotations(!1)}.bind(this),{name:l.collapseAll});a.setKeyBinding(new o.KeyBinding("q",!f.isMac,!1,!1,f.isMac),"lastEdit");a.setAction("lastEdit",function(){return this.gotoLastEdit()}.bind(this),{name:l.lastEdit})},copyLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;
var b=a.getModel(),c=a.getSelection(),h=b.getLineAtOffset(c.start),c=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),e=b.getLineStart(h),h=b.getLineEnd(c,!0),f=b.getLineCount(),g="",e=b.getText(e,h);c===f-1&&(e=(g=b.getLineDelimiter())+e);a.setText(e,h,h);a.setSelection(h+g.length,h+e.length);return!0},copyLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),c=a.getSelection(),h=b.getLineAtOffset(c.start),c=b.getLineAtOffset(c.end>c.start?c.end-
1:c.end),h=b.getLineStart(h),e=b.getLineEnd(c,!0),f=b.getLineCount(),g="",e=b.getText(h,e);c===f-1&&(e+=g=b.getLineDelimiter());a.setText(e,h,h);a.setSelection(h,h+e.length-g.length);return!0},deleteLines:function(a){var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;var c=1;if(a&&a.count)c=a.count;var h=b.getSelection(),e=b.getModel(),f=e.getLineAtOffset(h.start),a=e.getLineStart(f),c=h.start!==h.end||c===1?e.getLineAtOffset(h.end>h.start?h.end-1:h.end):Math.min(f+c-1,e.getLineCount()-
1),c=e.getLineEnd(c,!0);b.setText("",a,c);return!0},expandAnnotation:function(a){var b=this.editor,c=b.getAnnotationModel();if(!c)return!0;var e=b.getModel(),f=b.getCaretOffset(),g=e.getLineAtOffset(f),f=e.getLineStart(g),g=e.getLineEnd(g,!0);e.getBaseModel&&(f=e.mapOffset(f),g=e.mapOffset(g),e.getBaseModel());for(var j,e=c.getAnnotations(f,g);!j&&e.hasNext();)f=e.next(),f.type===n.AnnotationType.ANNOTATION_FOLDING&&(j=f);j&&a!==j.expanded&&(a?j.expand():(b.setCaretOffset(j.start),j.collapse()),c.modifyAnnotation(j));
return!0},expandAnnotations:function(a){var b=this.editor,c=b.getTextView(),e=b.getAnnotationModel();if(!e)return!0;var b=b.getModel(),f=e.getAnnotations(0,b.getCharCount());for(c.setRedraw(!1);f.hasNext();)b=f.next(),b.type===n.AnnotationType.ANNOTATION_FOLDING&&a!==b.expanded&&(a?b.expand():b.collapse(),e.modifyAnnotation(b));c.setRedraw(!0);return!0},indentLines:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;if(b.getOptions("tabMode")){var c=a.getModel(),e=
a.getSelection(),f=c.getLineAtOffset(e.start),g=c.getLineAtOffset(e.end>e.start?e.end-1:e.end);if(f!==g){var j=[];j.push("");for(var i=f;i<=g;i++)j.push(c.getLine(i,!0));i=c.getLineStart(f);c=c.getLineEnd(g,!0);b=b.getOptions("tabSize","expandTab");b=b.expandTab?Array(b.tabSize+1).join(" "):"\t";a.setText(j.join(b),i,c);a.setSelection(i===e.start?e.start:e.start+b.length,e.end+(g-f+1)*b.length);return!0}return!1}},gotoLastEdit:function(){typeof this._lastEditLocation==="number"&&this.editor.showSelection(this._lastEditLocation);
return!0},gotoLine:function(){var a=this.editor,b=a.getModel().getLineAtOffset(a.getCaretOffset());if(b=prompt(l.gotoLinePrompty,b+1))b=parseInt(b,10),a.onGotoLine(b-1,0);return!0},moveLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),c=a.getSelection(),e=b.getLineAtOffset(c.start),f=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),g=b.getLineCount();if(f===g-1)return!0;var e=b.getLineStart(e),c=b.getLineEnd(f,!0),j=b.getLineEnd(f+1,!0)-(c-
e),i=0;f!==g-2?b=b.getText(e,c):(f=b.getLineEnd(f),b=b.getText(f,c)+b.getText(e,f),i+=c-f);this.startUndo();a.setText("",e,c);a.setText(b,j,j);a.setSelection(j+i,j+i+b.length);this.endUndo();return!0},moveLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),c=a.getSelection(),e=b.getLineAtOffset(c.start);if(e===0)return!0;var f=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),g=b.getLineCount(),c=b.getLineStart(e-1),j=b.getLineStart(e),i=b.getLineEnd(f,
!0),l=b.getText(j,i),n=0;f===g-1&&(f=b.getLineEnd(e-1),e=b.getLineEnd(e-1,!0),l+=b.getText(f,e),j=f,n=e-f);this.startUndo();a.setText("",j,i);a.setText(l,c,c);a.setSelection(c,c+l.length-n);this.endUndo();return!0},nextAnnotation:function(a){var b=this.editor,c=b.getAnnotationModel();if(!c)return!0;var e=b.getOverviewRuler()||b.getAnnotationStyler();if(!e)return!0;for(var f=b.getModel(),g=b.getCaretOffset(),c=c.getAnnotations(a?g:0,a?f.getCharCount():g),r=null;c.hasNext();){var l=c.next();if(a){if(l.start<=
g)continue}else if(l.start>=g)continue;if(!l.lineStyle&&!(l.type===j.ANNOTATION_MATCHING_BRACKET||l.type===j.ANNOTATION_CURRENT_BRACKET||!e.isAnnotationTypeVisible(l.type)))if(r=l,a)break}if(r){var n=b.getTextView(),o=f.getLineAtOffset(r.start),v=i.Tooltip.getTooltip(n);if(!v)return b.moveSelection(r.start),!0;b.moveSelection(r.start,r.start,function(){v.setTarget({getTooltipInfo:function(){var a=n.convert({x:n.getLocationAtOffset(r.start).x,y:n.getLocationAtOffset(f.getLineStart(o)).y},"document",
"page");return{contents:[r],x:a.x,y:a.y+Math.floor(n.getLineHeight(o)*1.33)}}},0)})}return!0},unindentLines:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;if(b.getOptions("tabMode")){for(var c=a.getModel(),e=a.getSelection(),f=c.getLineAtOffset(e.start),g=c.getLineAtOffset(e.end>e.start?e.end-1:e.end),j=b.getOptions("tabSize"),i=Array(j+1).join(" "),l=[],n=b=0,o=f;o<=g;o++){var k=c.getLine(o,!0);if(c.getLineStart(o)!==c.getLineEnd(o))if(k.indexOf("\t")===0)k=k.substring(1),
b++;else if(k.indexOf(i)===0)k=k.substring(j),b+=j;else return!0;o===f&&(n=b);l.push(k)}f=c.getLineStart(f);j=c.getLineEnd(g,!0);c=c.getLineStart(g);a.setText(l.join(""),f,j);g=f===e.start?e.start:e.start-n;e=Math.max(g,e.end-b+(e.end===c+1&&e.start!==e.end?1:0));a.setSelection(g,e);return!0}},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()}};b.TextActions=e;g.prototype={init:function(){var a=this.editor.getTextView();
a.setAction("lineStart",function(){return this.lineStart()}.bind(this));a.setAction("enter",function(){return this.autoIndent()}.bind(this));a.setKeyBinding(new o.KeyBinding("t",!0,!1,!0),"trimTrailingWhitespaces");a.setAction("trimTrailingWhitespaces",function(){return this.trimTrailingWhitespaces()}.bind(this),{name:l.trimTrailingWhitespaces});a.setKeyBinding(new o.KeyBinding(191,!0),"toggleLineComment");a.setAction("toggleLineComment",function(){return this.toggleLineComment()}.bind(this),{name:l.toggleLineComment});
a.setKeyBinding(new o.KeyBinding(191,!0,!f.isMac,!1,f.isMac),"addBlockComment");a.setAction("addBlockComment",function(){return this.addBlockComment()}.bind(this),{name:l.addBlockComment});a.setKeyBinding(new o.KeyBinding(220,!0,!f.isMac,!1,f.isMac),"removeBlockComment");a.setAction("removeBlockComment",function(){return this.removeBlockComment()}.bind(this),{name:l.removeBlockComment});a.setKeyBinding(new o.KeyBinding("[",!1,!1,!1,!1,"keypress"),"autoPairSquareBracket");a.setAction("autoPairSquareBracket",
function(){return this.autoPairBrackets("[","]")}.bind(this));a.setKeyBinding(new o.KeyBinding("]",!1,!1,!1,!1,"keypress"),"skipClosingSquareBracket");a.setAction("skipClosingSquareBracket",function(){return this.skipClosingBracket("]")}.bind(this));a.setKeyBinding(new o.KeyBinding("<",!1,!1,!1,!1,"keypress"),"autoPairAngleBracket");a.setAction("autoPairAngleBracket",function(){return this.autoPairBrackets("<",">")}.bind(this));a.setKeyBinding(new o.KeyBinding(">",!1,!1,!1,!1,"keypress"),"skipClosingAngleBracket");
a.setAction("skipClosingAngleBracket",function(){return this.skipClosingBracket(">")}.bind(this));a.setKeyBinding(new o.KeyBinding("(",!1,!1,!1,!1,"keypress"),"autoPairParentheses");a.setAction("autoPairParentheses",function(){return this.autoPairBrackets("(",")")}.bind(this));a.setKeyBinding(new o.KeyBinding(")",!1,!1,!1,!1,"keypress"),"skipClosingParenthesis");a.setAction("skipClosingParenthesis",function(){return this.skipClosingBracket(")")}.bind(this));a.setKeyBinding(new o.KeyBinding("{",!1,
!1,!1,!1,"keypress"),"autoPairBraces");a.setAction("autoPairBraces",function(){return this.autoPairBrackets("{","}")}.bind(this));a.setKeyBinding(new o.KeyBinding("}",!1,!1,!1,!1,"keypress"),"skipClosingBrace");a.setAction("skipClosingBrace",function(){return this.skipClosingBracket("}")}.bind(this));a.setKeyBinding(new o.KeyBinding("'",!1,!1,!1,!1,"keypress"),"autoPairSingleQuotation");a.setAction("autoPairSingleQuotation",function(){return this.autoPairQuotations("'")}.bind(this));a.setKeyBinding(new o.KeyBinding('"',
!1,!1,!1,!1,"keypress"),"autoPairDblQuotation");a.setAction("autoPairDblQuotation",function(){return this.autoPairQuotations('"')}.bind(this));a.setAction("deletePrevious",function(){return this.deletePrevious()}.bind(this))},autoIndent:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;var c=a.getSelection();if(c.start===c.end){for(var e=a.getModel(),f=e.getLineAtOffset(c.start),g=e.getLine(f,!1),j=e.getLineStart(f),i=0,l=c.start-j,n;i<l&&((n=g.charCodeAt(i))===32||
n===9);)i++;var j=g.substring(0,i),b=b.getOptions("tabSize","expandTab"),o=b.expandTab?Array(b.tabSize+1).join(" "):"\t",b=e.getLineDelimiter(),k=/^[\s]*\/\*[\*]*[\s]*$/,t=/^[\s]*\*/,x=/\*\/[\s]*$/,B=g.substring(0,l),y=g.substring(l),D;if(this.smartIndentation&&g.charCodeAt(D=B.trimRight().length-1)===123)return e=l-D-1,y=y.length-y.trimLeft().length,g=g.charCodeAt(l+y)===125?b+j+o+b+j:b+j+o,a.setText(g,c.start-e,c.end+y),a.setCaretOffset(c.start+b.length+j.length+o.length-e),!0;else if(this.autoCompleteComments&&
!x.test(B)&&(k.test(B)||t.test(B))){if(i=k.exec(B)){g=b+j+" * ";g+=x.test(y)?y.substring(0,y.length-2).trim():y.trim();if(e.getLineCount()===f+1||!t.test(e.getLine(f+1)))g+=b+j+" */";a.setText(g,c.start,c.end+y.length);a.setCaretOffset(c.start+b.length+j.length+3);return!0}if(i=t.exec(B))for(f-=1;f>=0;f--)if(i=e.getLine(f,!1),k.test(i))return x.test(y)||g.charCodeAt(l)===47?(g=b+j+"*"+y,j=c.start+b.length+j.length+1):(g=b+j+"* "+y,j=c.start+b.length+j.length+2),a.setText(g,c.start,c.end+y.length),
a.setCaretOffset(j),!0;else if(!t.test(i))break}else if(x.test(B))return g=g.substring(c.start)+b+j.substring(0,j.length-1),a.setText(g,c.start,c.end),a.setCaretOffset(c.start+g.length),!0;else if(i>0){for(i=l;i<g.length&&((n=g.charCodeAt(i++))===32||n===9);)c.end++;a.setText(e.getLineDelimiter()+j,c.start,c.end);return!0}}return!1},addBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),c=a.getSelection(),e=this._findEnclosingComment(b,c.start,
c.end);if(e.commentStart!==void 0&&e.commentEnd!==void 0)return!0;b=b.getText(c.start,c.end);if(b.length===0)return!0;var e=b.length,b=b.replace(/\/\*|\*\//g,""),f=b.length;a.setText("/*"+b+"*/",c.start,c.end);a.setSelection(c.start+2,c.end+2+(f-e));return!0},autoPairBrackets:function(a,b){if(a==="["&&!this.autoPairSquareBrackets)return!1;else if(a==="{"&&!this.autoPairBraces)return!1;else if(a==="("&&!this.autoPairParentheses)return!1;else if(a==="<"&&!this.autoPairAngleBrackets)return!1;var c=this.editor;
if(c.getTextView().getOptions("readonly"))return!1;var e=c.getSelection(),f=c.getModel(),g=c.getCaretOffset()===f.getCharCount()?"":f.getText(e.start,e.start+1).trim(),j=/^$|[)}\]>]/;if(e.start===e.end&&j.test(g))return c.setText(a+b,e.start,e.start),c.setCaretOffset(e.start+1),!0;else if(e.start!==e.end)return f=f.getText(e.start,e.end),c.setText(a+f+b,e.start,e.end),c.setSelection(e.start+1,e.end+1),!0;return!1},autoPairQuotations:function(a){if(!this.autoPairQuotation)return!1;var b=this.editor;
if(b.getTextView().getOptions("readonly"))return!1;var c=b.getSelection(),e=b.getModel(),f=b.getCaretOffset(),g=f===0?"":e.getText(c.start-1,c.start).trim(),j=f===e.getCharCount()?"":e.getText(c.start,c.start+1).trim(),f=/^"$|^'$/,i=/\w/,l=/^$|[)}\]>]/;if(c.start!==c.end){e=e.getText(c.start,c.end);if(f.test(e))return!1;b.setText(a+e+a,c.start,c.end);b.setSelection(c.start+1,c.end+1)}else if(j===a)b.setCaretOffset(c.start+1);else if(g===a||f.test(j)||i.test(g)||!l.test(j))return!1;else b.setText(a+
a,c.start,c.start),b.setCaretOffset(c.start+1);return!0},contentAssistProposalApplied:function(a){a=a.data.proposal;if(a.positions&&a.positions.length>0&&this.linkedMode){for(var b=[],c=0;c<a.positions.length;++c)b[c]={positions:[{offset:a.positions[c].offset,length:a.positions[c].length}]};this.linkedMode.enterLinkedMode({groups:b,escapePosition:a.escapePosition})}else a.groups&&a.groups.length>0&&this.linkedMode?this.linkedMode.enterLinkedMode({groups:a.groups,escapePosition:a.escapePosition}):
a.escapePosition&&this.editor.getTextView().setCaretOffset(a.escapePosition);return!0},deletePrevious:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getSelection(),c=a.getModel(),e=a.getCaretOffset(),f=e===0?"":c.getText(b.start-1,b.start),c=e===c.getCharCount()?"":c.getText(b.start,b.start+1);(f==="("&&c===")"||f==="["&&c==="]"||f==="{"&&c==="}"||f==="<"&&c===">"||f==='"'&&c==='"'||f==="'"&&c==="'")&&a.setText("",b.start,b.start+1);return!1},_findEnclosingComment:function(a,
b,c){var e=a.getLineAtOffset(b),f=a.getLineAtOffset(c),g,j,i,l,n,o;for(g=e;g>=0;g--)if(j=a.getLine(g),i=g===e?b-a.getLineStart(e):j.length,l=j.lastIndexOf("/*",i),j=j.lastIndexOf("*/",i),j>l)break;else if(l!==-1){n=a.getLineStart(g)+l;break}for(g=f;g<a.getLineCount();g++)if(j=a.getLine(g),i=g===f?c-a.getLineStart(f):0,l=j.indexOf("/*",i),j=j.indexOf("*/",i),l!==-1&&l<j)break;else if(j!==-1){o=a.getLineStart(g)+j;break}return{commentStart:n,commentEnd:o}},lineStart:function(){for(var a=this.editor,
b=a.getModel(),c=a.getCaretOffset(),e=b.getLineAtOffset(c),f=b.getLineStart(e),b=b.getLine(e),e=0;e<b.length;e++){var g=b.charCodeAt(e);if(!(g===32||g===9))break}e+=f;return c!==e?(a.setSelection(e,e),!0):!1},removeBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),c=a.getSelection(),e=b.getText(c.start,c.end),f,g,j;for(j=0;j<e.length;j++)if(e.substring(j,j+2)==="/*"){f=c.start+j;break}for(;j<e.length;j++)if(e.substring(j,j+2)==="*/"){g=
c.start+j;break}if(f!==void 0&&g!==void 0)a.setText(b.getText(f+2,g),f,g+2),a.setSelection(f,g);else{e=this._findEnclosingComment(b,c.start,c.end);if(e.commentStart===void 0||e.commentEnd===void 0)return!0;b=b.getText(e.commentStart+2,e.commentEnd);a.setText(b,e.commentStart,e.commentEnd+2);a.setSelection(c.start-2,c.end-2)}return!0},toggleLineComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;for(var b=a.getModel(),c=a.getSelection(),e=b.getLineAtOffset(c.start),
f=b.getLineAtOffset(c.end>c.start?c.end-1:c.end),g=!0,j=[],i,l,n=e;n<=f;n++)if(i=b.getLine(n,!0),j.push(i),!g||(l=i.indexOf("//"))===-1)g=!1;else if(l!==0){var o;for(o=0;o<l;o++)if(g=i.charCodeAt(o),!(g===32||g===9))break;g=o===l}n=b.getLineStart(e);o=b.getLineEnd(f,!0);if(g){for(g=0;g<j.length;g++)i=j[g],l=i.indexOf("//"),j[g]=i.substring(0,l)+i.substring(l+2);j=j.join("");i=b.getLineStart(f);b=n===c.start?c.start:c.start-2;c=c.end-2*(f-e+1)+(c.end===i+1?2:0)}else j.splice(0,0,""),j=j.join("//"),
b=n===c.start?c.start:c.start+2,c=c.end+2*(f-e+1);a.setText(j,n,o);a.setSelection(b,c);return!0},trimTrailingWhitespaces:function(){var a=this.editor,b=a.getModel(),c=a.getSelection();a.getTextView().setRedraw(!1);a.getUndoStack().startCompoundChange();for(var e=/(\s+$)/,f=b.getLineCount(),g=0;g<f;g++){var j=b.getLine(g),i=e.exec(j);if(i){var l=b.getLineStart(g),j=i[0].length,i=l+i.index;b.setText("",i,i+j);if(c.start>i)c.start=Math.max(i,c.start-j);if(c.start!==c.end&&c.end>i)c.end=Math.max(i,c.end-
j)}}a.getUndoStack().endCompoundChange();a.getTextView().setRedraw(!0);a.setSelection(c.start,c.end,!1)},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},skipClosingBracket:function(a){var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;var c=b.getSelection(),e=b.getModel();return(b.getCaretOffset()===e.getCharCount()?"":e.getText(c.start,c.start+1))===a?(b.setCaretOffset(c.start+1),!0):!1},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},
setAutoPairParentheses:function(a){this.autoPairParentheses=a},setAutoPairBraces:function(a){this.autoPairBraces=a},setAutoPairSquareBrackets:function(a){this.autoPairSquareBrackets=a},setAutoPairAngleBrackets:function(a){this.autoPairAngleBrackets=a},setAutoPairQuotations:function(a){this.autoPairQuotation=a},setAutoCompleteComments:function(a){this.autoCompleteComments=a},setSmartIndentation:function(a){this.smartIndentation=a}};b.SourceCodeActions=g;if(!String.prototype.trimLeft)String.prototype.trimLeft=
function(){return this.replace(/^\s+/g,"")};if(!String.prototype.trimRight)String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")};return b});
define("orion/editor/templates",[],function(){function l(l,i,c){this.prefix=l;this.description=i;this.template=c;this._parse()}function o(l,i){this._keywords=l||[];this._templates=[];this.addTemplates(i||[])}l.prototype={getProposal:function(l,i,c){var l=i-l.length,i={},f,e=c.delimiter!==void 0?c.delimiter:"\n";c.indentation&&(e+=c.indentation);for(var g=c.tab!==void 0?c.tab:"\t",j=0,b=this.variables,a=this.segments,c=[],d=0;d<a.length;d++){var m=a[d],h=b[m];if(h!==void 0)switch(m){case "${tab}":m=
g;break;case "${delimiter}":m=e;break;case "${cursor}":m="";f=j;break;default:var p=i[m];p||(p=i[m]={data:h.data,positions:[]});m=h.substitution;p.data&&p.data.values&&(m=p.data.values[0]);p.positions.push({offset:l+j,length:m.length})}c.push(m);j+=m.length}var e=[],s;for(s in i)i.hasOwnProperty(s)&&e.push(i[s]);c=c.join("");if(f===void 0)f=c.length;return{proposal:c,description:this.description,groups:e,escapePosition:l+f}},match:function(l){return this.prefix.indexOf(l)===0},_parse:function(){var l=
this.template,i=[],c={},f,e=0,l=l.replace(/\n/g,"${delimiter}"),l=l.replace(/\t/g,"${tab}");l.replace(/\$\{((?:[^\\}]+|\\.))*\}/g,function(g,j,b){var a=g.substring(2,g.length-1),j=g,d=a,m=null,h=d.indexOf(":");h!==-1&&(d=d.substring(0,h),j="${"+d+"}",m=JSON.parse(a.substring(h+1).replace("\\}","}").trim()));(a=c[j])||(a=c[j]={});a.substitution=d;if(m)a.data=m;(f=l.substring(e,b))&&i.push(f);i.push(j);e=b+g.length;return d});(f=l.substring(e,l.length))&&i.push(f);this.segments=i;this.variables=c}};
o.prototype={addTemplates:function(n){for(var i=this.getTemplates(),c=0;c<n.length;c++)i.push(new l(n[c].prefix,n[c].description,n[c].template))},computeProposals:function(l,i,c){var f=this.getPrefix(l,i,c),e=[];if(!this.isValid(f,l,i,c))return e;e=e.concat(this.getTemplateProposals(f,i,c));return e=e.concat(this.getKeywordProposals(f))},getKeywords:function(){return this._keywords},getKeywordProposals:function(l){var i=[],c=this.getKeywords();if(c)for(var f=0;f<c.length;f++)c[f].indexOf(l)===0&&
i.push({proposal:c[f].substring(l.length),description:c[f]});return i},getPrefix:function(l,i,c){return c.prefix},getTemplates:function(){return this._templates},getTemplateProposals:function(l,i,c){for(var f=[],e=this.getTemplates(),g=0;g<e.length;g++){var j=e[g];j.match(l)&&(j=j.getProposal(l,i,c),this.removePrefix(l,j),f.push(j))}return f},removePrefix:function(l,i){if(!(i.overwrite=i.proposal.substring(0,l.length)!==l))i.proposal=i.proposal.substring(l.length)},isValid:function(){return!0}};return{Template:l,
TemplateContentAssist:o}});
define("orion/editor/linkedMode","i18n!orion/editor/nls/messages,orion/keyBinding,orion/editor/keyModes,orion/editor/annotations,orion/editor/templates,orion/objects,orion/util".split(","),function(l,o,n,i,c,f){function e(c,b,a){var d=c.getTextView();n.KeyMode.call(this,d);this.editor=c;this.undoStack=b;this.contentAssist=a;this.linkedModeModel=null;d.setAction("linkedModeEnter",function(){this.exitLinkedMode(!0);return!0}.bind(this));d.setAction("linkedModeCancel",function(){this.exitLinkedMode(!1);return!0}.bind(this));
d.setAction("linkedModeNextGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup((a.selectedGroupIndex+1)%a.groups.length);return!0}.bind(this));d.setAction("linkedModePreviousGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup(a.selectedGroupIndex>0?a.selectedGroupIndex-1:a.groups.length-1);return!0}.bind(this));this.linkedModeListener={onActivating:function(){this._groupContentAssistProvider&&(this.contentAssist.setProviders([this._groupContentAssistProvider]),this.contentAssist.setProgress(null))}.bind(this),
onModelChanged:function(a){if(!this.ignoreVerify){for(var b=this.editor.mapOffset(a.start),c=this.linkedModeModel,d,e;c;)if(d=this._getPositionChanged(c,b,b+a.removedCharCount),e=d.position,e===void 0||e.model!==c)this.exitLinkedMode(!1),c=this.linkedModeModel;else break;if(c){c=0;a=a.addedCharCount-a.removedCharCount;d=d.positions;for(var f,g=0;g<d.length;++g){f=d[g];e=f.position;var j=e.offset<=b&&b<=e.offset+e.length;j&&!f.ansestor?(e.offset+=c,e.length+=a,c+=a):(e.offset+=c,f.ansestor&&j&&(e.length+=
a));if(f.escape)f.model.escapePosition=e.offset}this._updateAnnotations(d)}}}.bind(this),onVerify:function(a){if(!this.ignoreVerify){for(var b=this.editor,c=b.mapOffset(a.start),d=this.editor.mapOffset(a.end),e=this.linkedModeModel,f,g;e;)if(f=this._getPositionChanged(e,c,d),g=f.position,g===void 0||g.model!==e)this.exitLinkedMode(!1),e=this.linkedModeModel;else break;if(e){var j=this._compoundChange;j?j.owner.model===e&&j.owner.group===g.group||(this.endUndo(),this.startUndo()):this.startUndo();
e.selectedGroupIndex=g.group;var j=0,i=a.text.length-(d-c);f=f.positions;var k;c-=g.position.offset;for(var l=d-g.position.offset,n=0;n<f.length;++n)if(k=f[n],d=k.position,k.oldOffset=d.offset,k.model===e&&k.group===g.group?(d.offset+=j,d.length+=i,j+=i):(d.offset+=j,k.ansestor&&(d.length+=g.count*i)),k.escape)k.model.escapePosition=d.offset;this.ignoreVerify=!0;for(n=f.length-1;n>=0;n--)k=f[n],k.model===e&&k.group===g.group&&b.setText(a.text,k.oldOffset+c,k.oldOffset+l);this.ignoreVerify=!1;a.text=
null;this._updateAnnotations(f)}}}.bind(this)}}var g={};e.prototype=new n.KeyMode;f.mixin(e.prototype,{createKeyBindings:function(){var c=o.KeyBinding,b=[];b.push({actionID:"linkedModeEnter",keyBinding:new c(13)});b.push({actionID:"linkedModeCancel",keyBinding:new c(27)});b.push({actionID:"linkedModeNextGroup",keyBinding:new c(9)});b.push({actionID:"linkedModePreviousGroup",keyBinding:new c(9,!1,!0)});return b},enterLinkedMode:function(c){if(!this.linkedModeModel){var b=this.editor.getTextView();
b.addKeyMode(this);b.addEventListener("Verify",this.linkedModeListener.onVerify);b.addEventListener("ModelChanged",this.linkedModeListener.onModelChanged);this.contentAssist.addEventListener("Activating",this.linkedModeListener.onActivating);this.editor.reportStatus(l.linkedModeEntered,null,!0)}this._sortedPositions=null;if(this.linkedModeModel)c.previousModel=this.linkedModeModel,c.parentGroup=this.linkedModeModel.selectedGroupIndex,this.linkedModeModel.nextModel=c;this.linkedModeModel=c;this.selectLinkedGroup(0)},
exitLinkedMode:function(c){if(this.isActive()){if(this._compoundChange)this.endUndo(),this._compoundChange=null;this._sortedPositions=null;var b=this.linkedModeModel;this.linkedModeModel=b.previousModel;b.parentGroup=b.previousModel=void 0;if(this.linkedModeModel)this.linkedModeModel.nextModel=void 0;if(!this.linkedModeModel){var a=this.editor,d=a.getTextView();d.removeKeyMode(this);d.removeEventListener("Verify",this.linkedModeListener.onVerify);d.removeEventListener("ModelChanged",this.linkedModeListener.onModelChanged);
d=this.contentAssist;d.removeEventListener("Activating",this.linkedModeListener.onActivating);d.offset=void 0;this.editor.reportStatus(l.linkedModeExited,null,!0);c&&a.setCaretOffset(b.escapePosition,!1)}this.selectLinkedGroup(0)}},startUndo:function(){if(this.undoStack){var c=this,b=this.linkedModeModel;this._compoundChange=this.undoStack.startCompoundChange({model:b,group:b.selectedGroupIndex,end:function(){c._compoundChange=null}})}},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},
isActive:function(){return!!this.linkedModeModel},isStatusActive:function(){return!!this.linkedModeModel},selectLinkedGroup:function(e){var b=this.linkedModeModel;if(b){b.selectedGroupIndex=e;var e=b.groups[e],a=e.positions[0],d=this.editor;d.setSelection(a.offset,a.offset+a.length);if(b=this.contentAssist)if(b.offset=void 0,e.data&&e.data.type==="link"&&e.data.values)(this._groupContentAssistProvider=new c.TemplateContentAssist(e.data.values)).getPrefix=function(){var b=d.getSelection();return b.start===
b.end&&(b=d.getCaretOffset(),a.offset<=b&&b<=a.offset+a.length)?d.getText(a.offset,b):""},b.offset=a.offset,b.deactivate(),b.activate();else if(this._groupContentAssistProvider)this._groupContentAssistProvider=null,b.deactivate()}this._updateAnnotations()},_getModelPositions:function(c,b,a){for(var d=b.groups,e=0;e<d.length;e++)for(var f=d[e].positions,g=0;g<f.length;g++){var i=f[g];a&&(i={offset:i.offset+a,length:i.length});i={index:g,group:e,count:f.length,model:b,position:i};c.push(i);if(b.nextModel&&
b.nextModel.parentGroup===e)i.ansestor=!0,this._getModelPositions(c,b.nextModel,(a||0)+f[g].offset-f[0].offset)}},_getSortedPositions:function(c){var b=this._sortedPositions;if(!b){for(b=[];c.previousModel;)c=c.previousModel;for(this._getModelPositions(b,c);c;)c.escapePosition!==void 0&&b.push({escape:!0,model:c,position:{offset:c.escapePosition,length:0}}),c=c.nextModel;b.sort(function(a,b){return a.position.offset-b.position.offset});this._sortedPositions=b}return b},_getPositionChanged:function(c,
b,a){for(var d,c=this._getSortedPositions(c),e=c.length-1;e>=0;e--){var f=c[e].position;if(f.offset<=b&&a<=f.offset+f.length){d=c[e];break}}return{position:d,positions:c}},_updateAnnotations:function(c){var b=this.editor.getAnnotationModel();if(b){for(var a=[],d=[],e=b.getTextModel(),e=b.getAnnotations(0,e.getCharCount()),f;e.hasNext();)switch(f=e.next(),f.type){case i.AnnotationType.ANNOTATION_LINKED_GROUP:case i.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP:case i.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:a.push(f)}if(e=
this.linkedModeModel)for(var c=c||this._getSortedPositions(e),g=0;g<c.length;g++)if(f=c[g],f.model===e){var l=i.AnnotationType.ANNOTATION_LINKED_GROUP;f.group===e.selectedGroupIndex&&(l=f.index===0?i.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:i.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP);f=f.position;f=i.AnnotationType.createAnnotation(l,f.offset,f.offset+f.length,"");d.push(f)}b.replaceAnnotations(a,d)}}});g.LinkedMode=e;return g});
define("orion/editor/factories","orion/editor/actions,orion/editor/undoStack,orion/editor/rulers,orion/editor/annotations,orion/editor/textDND,orion/editor/linkedMode".split(","),function(l,o,n,i,c,f){function e(){}function g(){}function j(){}function b(){}function a(){}function d(){}var m={};e.prototype={createKeyBindings:function(a,b,c,d){var d=new l.TextActions(a,b,d),e=new f.LinkedMode(a,b,c),a=new l.SourceCodeActions(a,b,c,e);return{textActions:d,linkedMode:e,sourceCodeActions:a}}};m.KeyBindingsFactory=
e;g.prototype={createUndoStack:function(a){a=a.getTextView();return new o.UndoStack(a,200)}};m.UndoFactory=g;j.prototype={createLineNumberRuler:function(a){return new n.LineNumberRuler(a,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"})}};m.LineNumberRulerFactory=j;b.prototype={createFoldingRuler:function(a){return new n.FoldingRuler(a,"left",{styleClass:"ruler folding"})}};m.FoldingRulerFactory=b;a.prototype={createAnnotationModel:function(a){return new i.AnnotationModel(a)},
createAnnotationStyler:function(a,b){return new i.AnnotationStyler(a,b)},createAnnotationRulers:function(a){var b=new n.AnnotationRuler(a,"left",{styleClass:"ruler annotations"}),a=new n.OverviewRuler(a,"right",{styleClass:"ruler overview"});return{annotationRuler:b,overviewRuler:a}}};m.AnnotationFactory=a;d.prototype={createTextDND:function(a,b){return new c.TextDND(a.getTextView(),b)}};m.TextDNDFactory=d;return m});
define("orion/editor/editorFeatures",["orion/editor/factories","orion/editor/actions","orion/editor/linkedMode","orion/objects"],function(l,o,n,i){return i.mixin({},l,o,n)});
(function(l,o){typeof define==="function"&&define.amd?define("orion/Deferred",o):typeof exports==="object"?module.exports=o():(l.orion=l.orion||{},l.orion.Deferred=o())})(this,function(){function l(){for(var e;e=c.shift();)e();f=!1}function o(e){c.push(e);f||(f=!0,setTimeout(l,0))}function n(c){return function(){c.apply(void 0,arguments)}}function i(){function e(){for(var b;b=m.shift();){var e=b.deferred,f=d==="fulfilled"?"resolve":"reject";if(typeof b[f]==="function")try{var h=(0,b[f])(a),g=h&&(typeof h===
"object"||typeof h==="function")&&h.then;if(typeof g==="function")if(h===e.promise)e.reject(new TypeError);else{var j=h.cancel;typeof j==="function"?e._protected(c).parentCancel=j.bind(h):delete e._protected(c).parentCancel;g.call(h,n(e.resolve),n(e.reject),n(e.progress))}else e.resolve(h)}catch(i){e.reject(i)}else e[f](a)}}function f(b){delete l.parentCancel;d="rejected";a=b;m.length&&o(e)}function j(b){function c(a){return function(b){q||(q=!0,a(b))}}var q=!1;delete l.parentCancel;try{var n=b&&
(typeof b==="object"||typeof b==="function")&&b.then;if(typeof n==="function")if(b===h)f(new TypeError);else{d="assumed";var w=b&&b.cancel;if(typeof w!=="function"){var v=new i,b=v.promise;try{n(v.resolve,v.reject,v.progress)}catch(k){v.reject(k)}w=b.cancel;n=b.then}a=b;n.call(b,c(j),c(f));l.parentCancel=w.bind(b)}else d="fulfilled",a=b,m.length&&o(e)}catch(t){c(f)(t)}}function b(){var a=l.parentCancel;if(a)delete l.parentCancel,a();else if(!d)a=Error("Cancel"),a.name="Cancel",f(a)}var a,d,m=[],h=
this,l={};Object.defineProperty(this,"_protected",{value:function(a){if(a!==c)throw Error("protected");return l}});this.resolve=function(a){d||j(a);return h};this.reject=function(a){d||f(a);return h};this.progress=function(a){d||m.forEach(function(b){if(b.progress)try{b.progress(a)}catch(c){}});return h.promise};this.cancel=function(){l.parentCancel?setTimeout(b,0):b();return h};this.then=function(a,b,f){a={resolve:a,reject:b,progress:f,deferred:new i};m.push(a);a.deferred._protected(c).parentCancel=
h.promise.cancel.bind(h);(d==="fulfilled"||d==="rejected")&&o(e);return a.deferred.promise};this.promise={then:h.then,cancel:h.cancel}}var c=[],f=!1;i.all=function(c,f){function j(b,c){m||(d[b]=c,--a===0&&h.resolve(d))}function b(a,b){if(!m){if(f)try{j(a,f(b));return}catch(c){b=c}h.reject(b)}}var a=c.length,d=[],m=!1,h=new i;h.then(void 0,function(){m=!0;c.forEach(function(a){a.cancel&&a.cancel()})});a===0?h.resolve(d):c.forEach(function(a,c){a.then(j.bind(void 0,c),b.bind(void 0,c))});return h.promise};
i.when=function(c,f,j,b){var a;if(!(c&&typeof c.then==="function"))a=new i,a.resolve(c),c=a.promise;return c.then(f,j,b)};return i});
define("orion/editor/contentAssist","i18n!orion/editor/nls/messages,orion/keyBinding,orion/editor/keyModes,orion/editor/eventTarget,orion/Deferred,orion/objects,orion/editor/util,orion/util".split(","),function(l,o,n,i,c,f,e,g){var j,b,a;function d(a){return a.reduce(function(a,b){return Array.isArray(b)?a.concat(b):a},[])}function m(c){this.textView=c;this.state=j;this.providers=[];var d=this;this.contentAssistListener={onModelChanging:function(c){d.isDeactivatingChange(c)?d.setState(j):d.state===
b&&d.setState(a)},onScroll:function(){d.setState(j)},onSelection:function(){var c=d.state;if(c===b||c===a)d.computeProposals(),d.setState(a)}};c.setKeyBinding(g.isMac?new o.KeyBinding(" ",!1,!1,!1,!0):new o.KeyBinding(" ",!0),"contentAssist");c.setKeyBinding(g.isMac?new o.KeyBinding(" ",!1,!1,!0,!0):new o.KeyBinding(" ",!0,!1,!0),"contentAssist");c.setAction("contentAssist",function(){c.getOptions("readonly")||d.activate();return!0},{name:l.contentAssist})}function h(a,b){var c=a.textView;n.KeyMode.call(this,
c);this.contentAssist=a;this.widget=b;this.proposals=[];var d=this;this.contentAssist.addEventListener("ProposalsComputed",function(a){d.proposals=a.data.proposals;d.proposals.length===0?(d.selectedIndex=-1,d.cancel()):d.selectedIndex=0});c.setAction("contentAssistApply",function(){return this.enter()}.bind(this));c.setAction("contentAssistCancel",function(){return this.cancel()}.bind(this));c.setAction("contentAssistNextProposal",function(){return this.lineDown()}.bind(this));c.setAction("contentAssistPreviousProposal",
function(){return this.lineUp()}.bind(this));c.setAction("contentAssistNextPage",function(){return this.pageDown()}.bind(this));c.setAction("contentAssistPreviousPage",function(){return this.pageUp()}.bind(this));c.setAction("contentAssistTab",function(){return this.tab()}.bind(this))}function p(a,b){this.contentAssist=a;this.textView=this.contentAssist.getTextView();this.isShowing=this.textViewListenerAdded=!1;var c=this.textView.getOptions("parent").ownerDocument;this.parentNode=typeof b==="string"?
c.getElementById(b):b;if(!this.parentNode){this.parentNode=g.createElement(c,"div");this.parentNode.className="contentassist";var d=c.getElementsByTagName("body")[0];if(d)d.appendChild(this.parentNode);else throw Error("parentNode is required");}var f=this;this.textViewListener={onMouseDown:function(a){(a.event.target||a.event.srcElement).parentElement!==f.parentNode&&f.contentAssist.deactivate()}};this.contentAssist.addEventListener("ProposalsComputed",function(a){f.setProposals(a.data.proposals);
f.show();if(!f.textViewListenerAdded)f.textView.addEventListener("MouseDown",f.textViewListener.onMouseDown),f.textViewListenerAdded=!0});this.contentAssist.addEventListener("Deactivating",function(){f.setProposals([]);f.hide();if(f.textViewListenerAdded)f.textView.removeEventListener("MouseDown",f.textViewListener.onMouseDown),f.textViewListenerAdded=!1;f.textViewListenerAdded=!1});this.scrollListener=function(){f.isShowing&&f.position()};e.addEventListener(c,"scroll",this.scrollListener)}j=1;b=
2;a=3;var s={selected:" selected",hr:"proposal-hr",emphasis:"proposal-emphasis",noemphasis:"proposal-noemphasis",dfault:"proposal-default"};m.prototype={apply:function(a){if(!a)return!1;var b=this.textView,c=b.getSelection(),d=Math.min(c.start,c.end),e=d,f=c=Math.max(c.start,c.end),h=b.getModel();h.getBaseModel&&(e=h.mapOffset(e),f=h.mapOffset(f),h=h.getBaseModel());a.overwrite&&(d=this.getPrefixStart(h,e));e={proposal:a,start:e,end:f};this.setState(j);b.setText(typeof a==="string"?a:a.proposal,d,
c);this.dispatchEvent({type:"ProposalApplied",data:e});return!0},activate:function(){this.state===j&&this.setState(b)},deactivate:function(){this.setState(j)},getTextView:function(){return this.textView},isActive:function(){return this.state===b||this.state===a},isDeactivatingChange:function(a){var b=a.removedCharCount>0&&a.addedCharCount===0,c=this.textView,c=a.start+1<=c.getModel().getCharCount()&&/^\s*$/.test(c.getText(a.start,a.start+1));return a.removedLineCount>0||a.addedLineCount>0||b&&c},
setState:function(a){var c;a===b?(c="Activating",this._mode&&this._mode.setActive(!0)):a===j&&(c="Deactivating",this._mode&&this._mode.setActive(!1));c&&this.dispatchEvent({type:c});this.state=a;this.onStateChange(a)},setMode:function(a){this._mode=a},onStateChange:function(a){if(a===j){if(this.listenerAdded)this.textView.removeEventListener("ModelChanging",this.contentAssistListener.onModelChanging),this.textView.removeEventListener("Scroll",this.contentAssistListener.onScroll),this.textView.removeEventListener("Selection",
this.contentAssistListener.onSelection),this.listenerAdded=!1}else if(a===b){if(!this.listenerAdded)this.textView.addEventListener("ModelChanging",this.contentAssistListener.onModelChanging),this.textView.addEventListener("Scroll",this.contentAssistListener.onScroll),this.textView.addEventListener("Selection",this.contentAssistListener.onSelection),this.listenerAdded=!0;this.computeProposals()}},computeProposals:function(){var a=this;this._computeProposals(this.textView.getCaretOffset()).then(function(b){a.isActive()&&
a.dispatchEvent({type:"ProposalsComputed",data:{proposals:b}})})},getPrefixStart:function(a,b){for(var c=b;c>0&&/[A-Za-z0-9_]/.test(a.getText(c-1,c));)c--;return c},handleError:function(a){typeof console!=="undefined"&&(console.log("Error retrieving content assist proposals"),console.log(a&&a.stack))},_computeProposals:function(a){var b=this.providers,e=this.textView,f=e.getSelection(),h=e.getModel(),g=a;if(h.getBaseModel)g=h.mapOffset(g),f.start=h.mapOffset(f.start),f.end=h.mapOffset(f.end),h=h.getBaseModel();
for(var a=h.getLine(h.getLineAtOffset(g)),j=0;j<a.length&&/\s/.test(a.charAt(j));)j++;var j=a.substring(0,j),e=e.getOptions("tabSize","expandTab"),e=e.expandTab?Array(e.tabSize+1).join(" "):"\t",i={line:a,offset:g,prefix:h.getText(this.getPrefixStart(h,g),g),selection:f,delimiter:h.getLineDelimiter(),tab:e,indentation:j},m=this,b=b.map(function(a){var b;try{var d,e;if(d=a.computeContentAssist){var f=m.editorContextProvider&&m.editorContextProvider();e=d.apply(a,[f,i])}else if(d=a.getProposals||a.computeProposals)e=
d.apply(a,[h.getText(),g,i]);b=m.progress?m.progress.progress(e,"Generating content assist proposal"):e}catch(j){m.handleError(j)}return c.when(b)});return c.all(b,this.handleError).then(d)},setEditorContextFactory:function(a){this.editorContextProvider=a},setProviders:function(a){this.providers=a.slice(0)},setProgress:function(a){this.progress=a}};i.EventTarget.addMixin(m.prototype);h.prototype=new n.KeyMode;f.mixin(h.prototype,{createKeyBindings:function(){var a=o.KeyBinding,b=[];b.push({actionID:"contentAssistApply",
keyBinding:new a(13)});b.push({actionID:"contentAssistCancel",keyBinding:new a(27)});b.push({actionID:"contentAssistNextProposal",keyBinding:new a(40)});b.push({actionID:"contentAssistPreviousProposal",keyBinding:new a(38)});b.push({actionID:"contentAssistNextPage",keyBinding:new a(34)});b.push({actionID:"contentAssistPreviousPage",keyBinding:new a(33)});b.push({actionID:"contentAssistTab",keyBinding:new a(9)});return b},cancel:function(){this.getContentAssist().deactivate()},getContentAssist:function(){return this.contentAssist},
isActive:function(){return this.getContentAssist().isActive()},setActive:function(a){a?this.contentAssist.textView.addKeyMode(this):this.contentAssist.textView.removeKeyMode(this)},lineUp:function(){return this._lineUp(this.selectedIndex===0?this.proposals.length-1:this.selectedIndex-1)},_lineUp:function(a){for(;this.proposals[a].unselectable&&a>0;)a--;this.selectedIndex=a;this.widget&&this.widget.setSelectedIndex(this.selectedIndex);return!0},lineDown:function(){return this._lineDown(this.selectedIndex===
this.proposals.length-1?0:this.selectedIndex+1)},_lineDown:function(a){for(;this.proposals[a].unselectable&&a<this.proposals.length-1;)a++;this.selectedIndex=a;this.widget&&this.widget.setSelectedIndex(this.selectedIndex);return!0},pageUp:function(){if(this.widget){var a=this.widget.getTopIndex();a===this.selectedIndex&&(this.widget.scrollIndex(a,!1),a=this.widget.getTopIndex());return this._lineUp(a)}else return this.lineUp()},pageDown:function(){if(this.widget){var a=this.widget.getBottomIndex();
a===this.selectedIndex&&(this.widget.scrollIndex(a,!0),a=this.widget.getBottomIndex());return this._lineDown(a)}else return this.lineDown()},enter:function(){return this.contentAssist.apply(this.proposals[this.selectedIndex]||null)},tab:function(){return this.widget?(this.widget.createAccessible(this),this.widget.parentNode.focus(),!0):!1}});p.prototype={onClick:function(a){if(!a)a=window.event;this.contentAssist.apply(this.getProposal(a.target||a.srcElement));this.textView.focus()},createDiv:function(a,
b,c,d){var e=c.ownerDocument,f=g.createElement(e,"div");f.id="contentoption"+d;f.setAttribute("role","option");a.style==="hr"?a=g.createElement(e,"hr"):(f.className=this.calculateClasses(a.style,b),a=e.createTextNode(this.getDisplayString(a)),b&&this.parentNode.setAttribute("aria-activedescendant",f.id));f.appendChild(a,f);c.appendChild(f)},createAccessible:function(a){this._isAccessible||e.addEventListener(this.parentNode,"keydown",function(b){if(!b)b=window.event;if(b.keyCode===27)return a.cancel();
else if(b.keyCode===38)return a.lineUp();else if(b.keyCode===40)return a.lineDown();else if(b.keyCode===13)return a.enter();b.preventDefault?b.preventDefault():(b.cancelBubble=!0,b.returnValue=!1,b.keyCode=0);return!1});this._isAccessible=!0},calculateClasses:function(a,b){var c=s[a];if(!c)c=s.dfault;return b?c+s.selected:c},getDisplayString:function(a){return typeof a==="string"?a:a.description&&typeof a.description==="string"?a.description:a.proposal},getProposal:function(a){for(var b=0,c=this.parentNode.firstChild;c!==
null;c=c.nextSibling){if(c===a)return this.proposals[b]||null;b++}return null},getTopIndex:function(){for(var a=this.parentNode.childNodes,b=0;b<a.length;b++)if(a[b].offsetTop>=this.parentNode.scrollTop)return b;return 0},getBottomIndex:function(){for(var a=this.parentNode.childNodes,b=0;b<a.length;b++){var c=a[b];if(c.offsetTop+c.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight)return Math.max(0,b-1)}return a.length-1},scrollIndex:function(a,b){this.parentNode.childNodes[a].scrollIntoView(b)},
setSelectedIndex:function(a){this.selectedIndex=a;this.selectNode(this.parentNode.childNodes[this.selectedIndex])},selectNode:function(a){for(var b=this.parentNode.childNodes,c=0;c<b.length;c++){var d=b[c],e=d.className.indexOf(s.selected);if(e>=0)d.className=d.className.substring(0,e)+d.className.substring(e+s.selected.length);d===a&&(d.className+=s.selected,this.parentNode.setAttribute("aria-activedescendant",d.id),d.focus(),d.offsetTop<this.parentNode.scrollTop?d.scrollIntoView(!0):d.offsetTop+
d.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight&&d.scrollIntoView(!1))}},setProposals:function(a){this.proposals=a},show:function(){if(this.proposals.length===0)this.hide();else{this.parentNode.innerHTML="";for(var a=0;a<this.proposals.length;a++)this.createDiv(this.proposals[a],a===0,this.parentNode,a);this.position();this.parentNode.onclick=this.onClick.bind(this);this.isShowing=!0}},hide:function(){this.parentNode.ownerDocument.activeElement===this.parentNode&&this.textView.focus();
this.parentNode.style.display="none";this.parentNode.onclick=null;this.isShowing=!1},position:function(){var a=this.contentAssist,b=this.textView;if(a.offset!==void 0){var a=a.offset,c=b.getModel();c.getBaseModel&&(a=c.mapOffset(a,!0))}else a=this.textView.getCaretOffset();a=b.getLocationAtOffset(a);a.y+=b.getLineHeight();this.textView.convert(a,"document","page");this.parentNode.style.position="fixed";this.parentNode.style.left=a.x+"px";this.parentNode.style.top=a.y+"px";this.parentNode.style.display=
"block";this.parentNode.scrollTop=0;b=this.parentNode.ownerDocument;c=b.documentElement.clientWidth;if(a.y+this.parentNode.offsetHeight>b.documentElement.clientHeight)this.parentNode.style.top=a.y-this.parentNode.offsetHeight-this.textView.getLineHeight()+"px";if(a.x+this.parentNode.offsetWidth>c)this.parentNode.style.left=c-this.parentNode.offsetWidth+"px"}};return{ContentAssist:m,ContentAssistMode:h,ContentAssistWidget:p}});
define("orion/editor/keywords",[],function(){return{JSKeywords:"break,case,class,catch,continue,const,debugger,default,delete,do,else,enum,export,extends,false,finally,for,function,if,implements,import,in,instanceof,interface,let,new,null,package,private,protected,public,return,static,super,switch,this,throw,true,try,typeof,undefined,var,void,while,with,yield".split(","),CSSKeywords:"alignment-adjust,alignment-baseline,animation,animation-delay,animation-direction,animation-duration,animation-iteration-count,animation-name,animation-play-state,animation-timing-function,appearance,azimuth,backface-visibility,background,background-attachment,background-clip,background-color,background-image,background-origin,background-position,background-repeat,background-size,baseline-shift,binding,bleed,bookmark-label,bookmark-level,bookmark-state,bookmark-target,border,border-bottom,border-bottom-color,border-bottom-left-radius,border-bottom-right-radius,border-bottom-style,border-bottom-width,border-collapse,border-color,border-image,border-image-outset,border-image-repeat,border-image-slice,border-image-source,border-image-width,border-left,border-left-color,border-left-style,border-left-width,border-radius,border-right,border-right-color,border-right-style,border-right-width,border-spacing,border-style,border-top,border-top-color,border-top-left-radius,border-top-right-radius,border-top-style,border-top-width,border-width,bottom,box-align,box-decoration-break,box-direction,box-flex,box-flex-group,box-lines,box-ordinal-group,box-orient,box-pack,box-shadow,box-sizing,break-after,break-before,break-inside,caption-side,clear,clip,color,color-profile,column-count,column-fill,column-gap,column-rule,column-rule-color,column-rule-style,column-rule-width,column-span,column-width,columns,content,counter-increment,counter-reset,crop,cue,cue-after,cue-before,cursor,direction,display,dominant-baseline,drop-initial-after-adjust,drop-initial-after-align,drop-initial-before-adjust,drop-initial-before-align,drop-initial-size,drop-initial-value,elevation,empty-cells,fit,fit-position,flex-align,flex-flow,flex-inline-pack,flex-order,flex-pack,float,float-offset,font,font-family,font-size,font-size-adjust,font-stretch,font-style,font-variant,font-weight,grid-columns,grid-rows,hanging-punctuation,height,hyphenate-after,hyphenate-before,hyphenate-character,hyphenate-lines,hyphenate-resource,hyphens,icon,image-orientation,image-rendering,image-resolution,inline-box-align,left,letter-spacing,line-height,line-stacking,line-stacking-ruby,line-stacking-shift,line-stacking-strategy,list-style,list-style-image,list-style-position,list-style-type,margin,margin-bottom,margin-left,margin-right,margin-top,mark,mark-after,mark-before,marker-offset,marks,marquee-direction,marquee-loop,marquee-play-count,marquee-speed,marquee-style,max-height,max-width,min-height,min-width,move-to,nav-down,nav-index,nav-left,nav-right,nav-up,opacity,orphans,outline,outline-color,outline-offset,outline-style,outline-width,overflow,overflow-style,overflow-x,overflow-y,padding,padding-bottom,padding-left,padding-right,padding-top,page,page-break-after,page-break-before,page-break-inside,page-policy,pause,pause-after,pause-before,perspective,perspective-origin,phonemes,pitch,pitch-range,play-during,position,presentation-level,punctuation-trim,quotes,rendering-intent,resize,rest,rest-after,rest-before,richness,right,rotation,rotation-point,ruby-align,ruby-overhang,ruby-position,ruby-span,size,speak,speak-header,speak-numeral,speak-punctuation,speech-rate,stress,string-set,table-layout,target,target-name,target-new,target-position,text-align,text-align-last,text-decoration,text-emphasis,text-height,text-indent,text-justify,text-outline,text-shadow,text-transform,text-wrap,top,transform,transform-origin,transform-style,transition,transition-delay,transition-duration,transition-property,transition-timing-function,unicode-bidi,vertical-align,visibility,voice-balance,voice-duration,voice-family,voice-pitch,voice-pitch-range,voice-rate,voice-stress,voice-volume,volume,white-space,white-space-collapse,widows,width,word-break,word-spacing,word-wrap,z-index".split(","),
JAVAKeywords:"abstract,boolean,break,byte,case,catch,char,class,continue,default,do,double,else,extends,false,final,finally,float,for,if,implements,import,instanceof,int,interface,long,native,new,null,package,private,protected,public,return,short,static,super,switch,synchronized,this,throw,throws,transient,true,try,void,volatile,while".split(",")}});
define("orion/editor/cssContentAssist",["orion/editor/templates","orion/editor/keywords"],function(l,o){function n(a){return JSON.stringify(a).replace("}","\\}")}function i(){}for(var c={type:"link",values:"visible,hidden,scroll,auto,no-display,no-content".split(",")},f={type:"link",values:"solid,dashed,dotted,double,groove,ridge,inset,outset".split(",")},e={type:"link",values:[]},g=0;g<10;g++)e.values.push(g.toString());for(var j={type:"link",values:"black,white,red,green,blue,magenta,yellow,cyan,grey,darkred,darkgreen,darkblue,darkmagenta,darkcyan,darkyellow,darkgray,lightgray".split(",")},
b=[{prefix:"rule",description:"rule - class selector rule",template:".${class} {\n\t${cursor}\n}"},{prefix:"rule",description:"rule - id selector rule",template:"#${id} {\n\t${cursor}\n}"},{prefix:"outline",description:"outline - outline style",template:"outline: ${color:"+n(j)+"} ${style:"+n(f)+"} ${width:"+n(e)+"}px;"},{prefix:"background-image",description:"background-image - image style",template:'background-image: url("${uri}");'},{prefix:"url",description:"url - url image",template:'url("${uri}");'},
{prefix:"rgb",description:"rgb - rgb color",template:"rgb(${red},${green},${blue});"},{prefix:"@",description:"import - import style sheet",template:'@import "${uri}";'}],a=[{prop:"display",values:{type:"link",values:"none,block,box,flex,inline,inline-block,inline-flex,inline-table,list-item,table,table-caption,table-cell,table-column,table-column-group,table-footer-group,table-header-group,table-row,table-row-group,inherit".split(",")}},{prop:"overflow",values:c},{prop:"overflow-x",values:c},{prop:"overflow-y",
values:c},{prop:"float",values:{type:"link",values:["left","right","none","inherit"]}},{prop:"position",values:{type:"link",values:["absolute","fixed","relative","static","inherit"]}},{prop:"cursor",values:{type:"link",values:"auto,crosshair,default,e-resize,help,move,n-resize,ne-resize,nw-resize,pointer,progress,s-resize,se-resize,sw-resize,text,w-resize,wait,inherit".split(",")}},{prop:"color",values:j},{prop:"border-top-color",values:j},{prop:"border-bottom-color",values:j},{prop:"border-right-color",
values:j},{prop:"border-left-color",values:j},{prop:"background-color",values:j},{prop:"font-style",values:{type:"link",values:["italic","normal","oblique","inherit"]}},{prop:"font-weight",values:{type:"link",values:"bold,normal,bolder,lighter,100,200,300,400,500,600,700,800,900,inherit".split(",")}},{prop:"white-space",values:{type:"link",values:"pre,pre-line,pre-wrap,nowrap,normal,inherit".split(",")}},{prop:"word-wrap",values:{type:"link",values:["normal","break-word"]}},{prop:"visibility",values:{type:"link",
values:["hidden","visible","collapse","inherit"]}}],g=0;g<a.length;g++)c=a[g],b.push({prefix:c.prop,description:c.prop+" - "+c.prop+" style",template:c.prop+": ${value:"+n(c.values)+"};"});a="width,height,top,bottom,left,right,min-width,min-height,max-width,max-height,margin,padding,padding-left,padding-right,padding-top,padding-bottom,margin-left,margin-top,margin-bottom,margin-right".split(",");for(g=0;g<a.length;g++)c=a[g],b.push({prefix:c,description:c+" - "+c+" pixel style",template:c+": ${value}px;"});
a=["padding","margin"];for(g=0;g<a.length;g++)c=a[g],b.push({prefix:c,description:c+" - "+c+" top right bottom left style",template:c+": ${top}px ${left}px ${bottom}px ${right}px;"}),b.push({prefix:c,description:c+" - "+c+" top right,left bottom style",template:c+": ${top}px ${right_left}px ${bottom}px;"}),b.push({prefix:c,description:c+" - "+c+" top,bottom right,left style",template:c+": ${top_bottom}px ${right_left}px"});a=["border","border-top","border-bottom","border-left","border-right"];for(g=
0;g<a.length;g++)c=a[g],b.push({prefix:c,description:c+" - "+c+" style",template:c+": ${width:"+n(e)+"}px ${style:"+n(f)+"} ${color:"+n(j)+"};"});i.prototype=new l.TemplateContentAssist(o.CSSKeywords,b);i.prototype.getPrefix=function(a,b){for(var c=b;c&&/[A-Za-z\-\@]/.test(a.charAt(c-1));)c--;return c?a.substring(c,b):""};return{CssContentAssistProvider:i}});
define("orion/editor/htmlContentAssist",["orion/editor/templates"],function(l){function o(){}var n=new l.Template("","Simple HTML document",'<!DOCTYPE html>\n<html lang="en">\n\t<head>\n\t\t<meta charset=utf-8>\n\t\t<title>${title}</title>\n\t</head>\n\t<body>\n\t\t<h1>${header}</h1>\n\t\t<p>\n\t\t\t${cursor}\n\t\t</p>\n\t</body>\n</html>'),i=[{prefix:"<img",description:"<img> - HTML image element",template:'<img src="${cursor}" alt="${Image}"/>'},{prefix:"<a",description:"<a> - HTML anchor element",
template:'<a href="${cursor}"></a>'},{prefix:"<ul",description:"<ul> - HTML unordered list",template:"<ul>\n\t<li>${cursor}</li>\n</ul>"},{prefix:"<ol",description:"<ol> - HTML ordered list",template:"<ol>\n\t<li>${cursor}</li>\n</ol>"},{prefix:"<dl",description:"<dl> - HTML definition list",template:"<dl>\n\t<dt>${cursor}</dt>\n\t<dd></dd>\n</dl>"},{prefix:"<table",description:"<table> - basic HTML table",template:"<table>\n\t<tr>\n\t\t<td>${cursor}</td>\n\t</tr>\n</table>"}],c,f,e,g,j="abbr,b,button,canvas,cite,command,dd,del,dfn,dt,em,embed,font,h1,h2,h3,h4,h5,h6,i,ins,kbd,label,li,mark,meter,object,option,output,progress,q,rp,rt,samp,small,strong,sub,sup,td,time,title,tt,u,var".split(",");
for(g=0;g<j.length;g++)c=j[g],e="<"+c+"></"+c+">",f="<"+c+">${cursor}</"+c+">",i.push({prefix:"<"+c,description:e,template:f});j="address,article,aside,audio,bdo,blockquote,body,caption,code,colgroup,datalist,details,div,fieldset,figure,footer,form,head,header,hgroup,iframe,legend,map,menu,nav,noframes,noscript,optgroup,p,pre,ruby,script,section,select,span,style,tbody,textarea,tfoot,th,thead,tr,video".split(",");for(g=0;g<j.length;g++)c=j[g],e="<"+c+"></"+c+">",f="<"+c+">\n\t${cursor}\n</"+c+">",
i.push({prefix:"<"+c,description:e,template:f});j="area,base,br,col,hr,input,link,meta,param,keygen,source".split(",");for(g=0;g<j.length;g++)c=j[g],f=e="<"+c+"/>",i.push({prefix:"<"+c,description:e,template:f});o.prototype=new l.TemplateContentAssist([],i);o.prototype.getPrefix=function(b,a){for(var c=a;c&&/[A-Za-z0-9<]/.test(b.charAt(c-1));)if(c--,b.charAt(c)==="<")break;return c?b.substring(c,a):""};o.prototype.computeProposals=function(b,a,c){return b.length===0?[n.getProposal("",a,c)]:l.TemplateContentAssist.prototype.computeProposals.call(this,
b,a,c)};return{HTMLContentAssistProvider:o}});
define("orion/editor/jsTemplateContentAssist",["orion/editor/templates","orion/editor/keywords"],function(l,o){function n(){}var i=[{prefix:"if",description:"if - if statement",template:"if (${condition}) {\n\t${cursor}\n}"},{prefix:"if",description:"if - if else statement",template:"if (${condition}) {\n\t${cursor}\n} else {\n\t\n}"},{prefix:"for",description:"for - iterate over array",template:"for (var ${i}=0; ${i}<${array}.length; ${i}++) {\n\t${cursor}\n}"},{prefix:"for",description:"for - iterate over array with local var",
template:"for (var ${i}=0; ${i}<${array}.length; ${i}++) {\n\tvar ${value} = ${array}[${i}];\n\t${cursor}\n}"},{prefix:"for",description:"for..in - iterate over properties of an object",template:"for (var ${property} in ${object}) {\n\tif (${object}.hasOwnProperty(${property})) {\n\t\t${cursor}\n\t}\n}"},{prefix:"while",description:"while - while loop with condition",template:"while (${condition}) {\n\t${cursor}\n}"},{prefix:"do",description:"do - do while loop with condition",template:"do {\n\t${cursor}\n} while (${condition});"},
{prefix:"switch",description:"switch - switch case statement",template:"switch (${expression}) {\n\tcase ${value1}:\n\t\t${cursor}\n\t\tbreak;\n\tdefault:\n}"},{prefix:"case",description:"case - case statement",template:"case ${value}:\n\t${cursor}\n\tbreak;"},{prefix:"try",description:"try - try..catch statement",template:"try {\n\t${cursor}\n} catch (${err}) {\n}"},{prefix:"try",description:"try - try..catch statement with finally block",template:"try {\n\t${cursor}\n} catch (${err}) {\n} finally {\n}"},
{prefix:"var",description:"var - variable declaration",template:"var ${name};"},{prefix:"var",description:"var - variable declaration with value",template:"var ${name} = ${value};"},{prefix:"let",description:"let - local scope variable declaration",template:"let ${name};"},{prefix:"let",description:"let - local scope variable declaration with value",template:"let ${name} = ${value};"},{prefix:"return",description:"return - return result",template:"return ${result};"},{prefix:"typeof",description:"typeof - typeof statement",
template:'typeof ${object} === "${type:'+JSON.stringify({type:"link",values:"undefined,object,boolean,number,string,function,xml".split(",")}).replace("}","\\}")+'}"'},{prefix:"instanceof",description:"instanceof - instanceof statement",template:"${object} instanceof ${type}"},{prefix:"with",description:"with - with statement",template:"with (${object}) {\n\t${cursor}\n}"},{prefix:"function",description:"function - function declaration",template:"function ${name} (${parameter}) {\n\t${cursor}\n}"},
{prefix:"nls",description:"string - non NLS",template:"${cursor} //$NON-NLS-${0}$"},{prefix:"log",description:"log - console log",template:"console.log(${object});"}];n.prototype=new l.TemplateContentAssist(o.JSKeywords,i);n.prototype.isValid=function(c,f,e){c=e-c.length-1;for(e="";c>=0;)if(e=f[c],e==="\n"||e==="\r")break;else if(/\s/.test(e))c--;else break;f=e;return!f||":!@#$^&*.?<>".indexOf(f)===-1};return{JSTemplateContentAssistProvider:n}});
define("orion/editor/AsyncStyler",["i18n!orion/editor/nls/messages","orion/editor/annotations"],function(l,o){function n(e){return e.getProperty("objectClass").indexOf(c)!==-1&&e.getProperty("type")==="highlighter"}function i(c,f,j){this.initialize(c,f,j);this.lineStyles=[]}var c="orion.edit.highlighter",f=c+" service must be an event emitter";o.AnnotationType.registerType("orion.annotation.highlightError",{title:l.syntaxError,html:"<div class='annotationHTML error'></div>",rangeStyle:{styleClass:"annotationRange error"}});
i.prototype={initialize:function(e,f,j){this.textView=e;this.serviceRegistry=f;this.annotationModel=j;this.services=[];var b=this;this.listener={onModelChanging:function(a){b.onModelChanging(a)},onModelChanged:function(a){b.onModelChanged(a)},onDestroy:function(a){b.onDestroy(a)},onLineStyle:function(a){b.onLineStyle(a)},onStyleReady:function(a){b.onStyleReady(a)},onServiceAdded:function(a){b.onServiceAdded(a.serviceReference,b.serviceRegistry.getService(a.serviceReference))},onServiceRemoved:function(a){b.onServiceRemoved(a.serviceReference,
b.serviceRegistry.getService(a.serviceReference))}};e.addEventListener("ModelChanging",this.listener.onModelChanging);e.addEventListener("ModelChanged",this.listener.onModelChanged);e.addEventListener("Destroy",this.listener.onDestroy);e.addEventListener("LineStyle",this.listener.onLineStyle);f.addEventListener("registered",this.listener.onServiceAdded);f.addEventListener("unregistering",this.listener.onServiceRemoved);e=f.getServiceReferences(c);for(j=0;j<e.length;j++){var a=e[j];n(a)&&this.addServiceListener(f.getService(a))}},
onDestroy:function(){this.destroy()},destroy:function(){if(this.textView)this.textView.removeEventListener("ModelChanging",this.listener.onModelChanging),this.textView.removeEventListener("ModelChanged",this.listener.onModelChanged),this.textView.removeEventListener("Destroy",this.listener.onDestroy),this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView=null;if(this.services){for(var c=0;c<this.services.length;c++)this.removeServiceListener(this.services[c]);this.services=
null}if(this.serviceRegistry)this.serviceRegistry.removeEventListener("registered",this.listener.onServiceAdded),this.serviceRegistry.removeEventListener("unregistering",this.listener.onServiceRemoved),this.serviceRegistry=null;this.lineStyles=this.listener=null},onModelChanging:function(c){this.startLine=this.textView.getModel().getLineAtOffset(c.start)},onModelChanged:function(c){var f=this.startLine;(c.addedLineCount||c.removedLineCount)&&Array.prototype.splice.apply(this.lineStyles,[f,c.removedLineCount].concat(this._getEmptyStyle(c.addedLineCount)))},
onStyleReady:function(c){var f=c.lineStyles||c.style,c=Number.MAX_VALUE,j=-1,b=this.textView.getModel(),a;for(a in f)Object.prototype.hasOwnProperty.call(f,a)&&(this.lineStyles[a]=f[a],c=Math.min(c,a),j=Math.max(j,a));c=Math.max(c,0);j=Math.min(j,b.getLineCount());if(f=this.annotationModel){for(var d=f.getAnnotations(b.getLineStart(c),b.getLineEnd(j)),i=[];d.hasNext();){var h=d.next();h.type==="orion.annotation.highlightError"&&i.push(h)}d=[];for(h=c;h<=j;h++){a=h;var l=this.lineStyles[a],l=l&&l.errors;
a=b.getLineStart(a);if(l)for(var n=0;n<l.length;n++){var r=l[n];d.push(o.AnnotationType.createAnnotation("orion.annotation.highlightError",r.start+a,r.end+a))}}f.replaceAnnotations(i,d)}this.textView.redrawLines(c,j+1)},onLineStyle:function(c){function f(b,a){for(var c=b.length,e=[],h=0;h<c;h++){var g=b[h];e.push({start:g.start+a,end:g.end+a,style:g.style})}return e}var j=this.lineStyles[c.lineIndex];if(j)if(j.ranges)c.ranges=f(j.ranges,c.lineStart);else if(j.style)c.style=j.style},_getEmptyStyle:function(c){for(var f=
[],j=0;j<c;j++)f.push(null);return f},setContentType:function(c){this.contentType=c;if(this.services)for(c=0;c<this.services.length;c++){var f=this.services[c];if(f.setContentType){var j=this.serviceRegistry.getService("orion.page.progress");j?j.progress(f.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):f.setContentType(this.contentType)}}},onServiceAdded:function(c,f){n(c)&&this.addServiceListener(f)},onServiceRemoved:function(c,
f){this.services.indexOf(f)!==-1&&this.removeServiceListener(f)},addServiceListener:function(c){if(typeof c.addEventListener==="function"){if(c.addEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),this.services.push(c),c.setContentType&&this.contentType){var g=this.serviceRegistry.getService("orion.page.progress");g?g.progress(c.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):c.setContentType(this.contentType)}}else typeof console!==
"undefined"&&console.log(Error(f))},removeServiceListener:function(c){typeof c.removeEventListener==="function"?(c.removeEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),c=this.services.indexOf(c),c!==-1&&this.services.splice(c,1)):typeof console!=="undefined"&&console.log(Error(f))}};return i});
define("orion/editor/mirror",["i18n!orion/editor/nls/messages","orion/editor/eventTarget","orion/editor/annotations"],function(l,o,n){function i(b){this.string=b;this.tokenStart=this.pos=0}function c(){return{token:function(b){return b.skipToEnd()}}}function f(){this._modes={};this.mimeModes={};this.options={};this.StringStream=i;this.defineMode("null",c);this.defineMIME("text/plain","null")}function e(b){var a=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&a.push(c);return a}function g(b,
a,c){c=c||{};this.model=b;this.codeMirror=a;this.isWhitespaceVisible=typeof c.whitespacesVisible==="undefined"?!1:c.whitespacesVisible;this.mode=null;this.isModeLoaded=!1;this.lines=[];this.dirtyLines=[];this.startLine=Number.MAX_VALUE;this.endLine=-1;this.timer=null;this.initialize(b)}function j(b,a,c){this.init(b,a,c)}i.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos===0},peek:function(){return this.string[this.pos]},next:function(){return this.string[this.pos++]},
eat:function(b){var a=this.string[this.pos];return typeof a==="string"&&(a===b||b.test&&b.test(a)||typeof b==="function"&&b(a))?this.string[this.pos++]:void 0},eatWhile:function(b){for(var a=!1;this.eat(b)!==void 0;)a=!0;return a},eatSpace:function(){return this.eatWhile(/\s/)},skipToEnd:function(){this.pos=this.string.length},skipTo:function(b){b=this.string.indexOf(b,this.pos);return b!==-1?(this.pos=b,!0):!1},match:function(b,a,c){a=a===!0||typeof a==="undefined";if(typeof b==="string"){var e=
c?this.string.toLowerCase():this.string,b=c?b.toLowerCase():b,c=e.indexOf(b,this.pos);if(c!==-1&&a)this.pos=c+b.length;return c!==-1}else return(b=this.string.substring(this.pos).match(b))&&a&&typeof b[0]==="string"&&(this.pos+=b.index+b[0].length),b},backUp:function(b){this.pos-=b},column:function(){for(var b=0,a=0;a<this.tokenStart;)b+=this.string[a++]==="\t"?4:1;return b},indentation:function(){for(var b=this.string.search(/\S/),a=0,c=0;c<b;)a+=this.string[c++]==="\t"?4:1;return a},current:function(){return this.string.substring(this.tokenStart,
this.pos)},advance:function(){this.tokenStart=this.pos}};f.prototype={options:{},setOption:function(b,a){this.options[b]=a},getOption:function(b){return this.options[b]},copyState:function(b,a){if(typeof b.copyState==="function")return b.copyState(a);var c={},e;for(e in a){var f=a[e];c[e]=f instanceof Array?f.slice():f}return c},startState:function(b,a){return b.startState(a)},defineMode:function(b,a){this._modes[b]=a},defineMIME:function(b,a){this.mimeModes[b]=a},getMode:function(b,a){var c={},e;
typeof a==="string"&&this.mimeModes[a]&&(a=this.mimeModes[a]);typeof a==="object"&&(c=a,e=this._modes[a.name]);e=e||this._modes[a];return typeof e!=="function"?(typeof console!=="undefined"&&console&&console.log("Mode not found: "+a),this.getMode(b,"null")):e(b,c)},listModes:function(){return e(this._modes)},listMIMEs:function(){return e(this.mimeModes)},_getModeName:function(b){b=this.mimeModes[b];if(typeof b==="object")b=b.name;return b}};g.prototype={initialize:function(){var b=this;this.listener=
{onModelChanging:function(a){b._onModelChanging(a)},onModelChanged:function(a){b._onModelChanged(a)},onDestroy:function(a){b._onDestroy(a)}};this.model.addEventListener("Changing",this.listener.onModelChanging);this.model.addEventListener("Changed",this.listener.onModelChanged);this.model.addEventListener("Destroy",this.listener.onDestroy)},destroy:function(){this.model&&(this.model.removeEventListener("Changing",this.listener.onModelChanging),this.model.removeEventListener("Changed",this.listener.onModelChanged),
this.model.removeEventListener("Destroy",this.listener.onDestroy));this.dirtyLines=this.lines=this.mode=this.codeMirror=this.model=null;clearTimeout(this.timer);this.timer=null},_onModelChanging:function(b){this.startLine=this.model.getLineAtOffset(b.start)},_onModelChanged:function(b){this._dbgEvent(b);var a=this.startLine;(b.removedLineCount||b.addedLineCount)&&Array.prototype.splice.apply(this.lines,[a+1,b.removedLineCount].concat(this._newLines(b.addedLineCount)));this.mode&&(b=Math.max(b.addedLineCount,
b.removedLineCount),b=a+Math.min(b,500),this.highlight(a,b),this.highlightLater(b+1))},_onDestroy:function(){this.destroy()},setViewportIndex:function(b){this.viewportIndex=b},_dbgEvent:function(){},_dbgStyle:function(){},_newLines:function(b){for(var a=[],c=0;c<b;c++)a.push({style:null,eolState:null});return a},setMode:function(b,a){if(b)this.mode=this.codeMirror.getMode(this.codeMirror.options,b),this.lines=this._newLines(this.model.getLineCount()),a&&this.highlight()},highlight:function(b,a,c){if(this.mode){for(var e=
this.model.getLineCount(),b=typeof b==="undefined"?0:b,a=typeof a==="undefined"?e-1:Math.min(a,e-1),e=this.mode,f=this.getState(b),g=b;g<=a;g++){var j=this.lines[g];this.highlightLine(g,j,f);j.eolState=this.codeMirror.copyState(e,f)}this._expandRange(b,a);if(!c)this.onHighlightDone()}},highlightLater:function(b){this.dirtyLines.push(b);var a=this;this.timer=setTimeout(function(){a._highlightJob()},50)},_highlightJob:function(){for(var b=+new Date+30,a=this.mode.compareStates,c=this.model.getLineCount();this.dirtyLines.length;){var e=
this.viewportIndex,f=this.lines[e],e=f&&!f.eolState?e:this.dirtyLines.pop();if(e>=c)break;this._expandRange(e,e);for(var f=this._getResumeLineIndex(e),e=f+1,f=(f=f>=0&&this.lines[f].eolState)?this.codeMirror.copyState(this.mode,f):this.mode.startState(),g=0,j=e;j<c;j++){var i=this.lines[j],l=i.eolState,n=this.highlightLine(j,i,f);i.eolState=this.codeMirror.copyState(this.mode,f);n&&this._expandRange(e,j+1);var i=a&&l&&a(l,i.eolState),o=!a&&!n&&g++>3;if(i||o)break;else if(!l||n)g=0;l=j<c||this.dirtyLines.length;
if(+new Date>b&&l){this.highlightLater(j+1);this.onHighlightDone();return}}}this.onHighlightDone()},onHighlightDone:function(){this.startLine!==Number.MAX_VALUE&&this.endLine!==-1&&this.dispatchEvent({type:"Highlight",start:this.startLine,end:this.endLine});this.startLine=Number.MAX_VALUE;this.endLine=-1},_getResumeLineIndex:function(b){for(var a=this.lines,c=b-1;c>=0;c--)if(a[c].eolState||b-c>40)return c;return-1},getState:function(b){var a=this.mode,c=this.lines,e,f;for(e=b-1;e>=0;e--)if(f=c[e],
f.eolState||b-e>40)break;var g=e>=0&&c[e].eolState;if(g){g=this.codeMirror.copyState(a,g);for(e=Math.max(0,e);e<b-1;e++)f=c[e],this.highlightLine(e,f,g),f.eolState=this.codeMirror.copyState(a,g);return g}else return a.startState()},highlightLine:function(b,a,c){if(this.mode){var e=this.model;e.getLineStart(b)===e.getLineEnd(b)&&this.mode.blankLine&&this.mode.blankLine(c);for(var f=a.style||[],b=e.getLine(b),b=new i(b),e=!a.style,g=[],j=0;!b.eol();j++){var l=this.mode.token(b,c)||null,n=b.current();
this._whitespaceStyle(l,n,b.tokenStart);l=[b.tokenStart,b.pos,l];n=f[j];g.push(l);e=e||!n||n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2];b.advance()}if(e=e||g.length!==f.length)a.style=g.length?g:null;return e}},_whitespaceStyle:function(b,a,c){if(!b&&this.isWhitespaceVisible&&/\s+/.test(a)){for(var b=[],e,f,g=0;g<a.length;g++){var j=a[g];j!==f&&(f&&b.push([c+e,c+g,f==="\t"?"token_tab":"token_space"]),e=g,f=j)}b.push([c+e,c+g,f==="\t"?"token_tab":"token_space"]);return b}return null},_expandRange:function(b,
a){this.startLine=Math.min(this.startLine,b);this.endLine=Math.max(this.endLine,a)},toStyleRangesAndErrors:function(b,a){var c=b.style;if(!c)return null;for(var e=[],f=[],g=typeof a==="undefined"?0:this.model.getLineStart(a),j=0;j<c.length;j++){var i=c[j],l=!i[2]?null:i[2]==="token_tab"||i[2]==="token_space"?i[2]:"cm-"+i[2];l&&(i={start:g+i[0],end:g+i[1],style:{styleClass:l}},e.push(i),l==="cm-error"&&f.push(i))}return[e,f]},getLineStyle:function(b){return this.lines[b]},getLineStyles:function(){return this.lines}};
o.EventTarget.addMixin(g.prototype);n.AnnotationType.registerType("orion.annotation.highlightError",{title:l.syntaxError,html:"<div class='annotationHTML error'></div>",rangeStyle:{styleClass:"annotationRange error"}});j.prototype={init:function(b,a,c){this.textView=b;this.annotationModel=c;this.modeApplier=new g(b.getModel(),a);var e=this;this.listener={onLineStyle:function(a){e.onLineStyle(a)},onDestroy:function(a){e.onDestroy(a)},onHighlight:function(a){e.onHighlight(a)}};b.addEventListener("LineStyle",
this.listener.onLineStyle);b.addEventListener("Destroy",this.listener.onDestroy);this.modeApplier.addEventListener("Highlight",this.listener.onHighlight)},destroy:function(){this.modeApplier&&(this.modeApplier.removeEventListener("Highlight",this.listener.onHighlight),this.modeApplier.destroy());this.textView&&(this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView.removeEventListener("Destroy",this.listener.onDestroy));this.listener=this.modeApplier=this.annotationModel=
this.textView=null},setMode:function(b){this.modeApplier.setMode(b)},onLineStyle:function(b){var a=b.lineIndex,c=this.modeApplier,e=c.getLineStyle(a);if(!e||!e.eolState){var f=this.textView.getModel().getLineCount();c.highlight(a,Math.min(a+20,f-1),!0);e=c.getLineStyle(a)}f=this.textView.getModel();if(e){var g=c.toStyleRangesAndErrors(e,a);if(g&&(b.ranges=g[0],b=this.annotationModel)){c=[];e=[];if(g=g[1])for(var j=0;j<g.length;j++){var i=g[j];i.style.styleClass==="cm-error"&&e.push(n.AnnotationType.createAnnotation("orion.annotation.highlightError",
i.start,i.end))}for(a=b.getAnnotations(f.getLineStart(a),f.getLineEnd(a));a.hasNext();)f=a.next(),f.type==="orion.annotation.highlightError"&&c.push(f);b.replaceAnnotations(c,e)}}},onHighlight:function(b){this.textView.redrawLines(b.start,b.end)},onDestroy:function(){this.destroy()}};return{Mirror:f,ModeApplier:g,CodeMirrorStyler:j}});
define("orion/editor/textMateStyler",["orion/regex"],function(l){function o(c){var f;if(c instanceof Array){f=Array(c.length);for(var e=0;e<c.length;e++)f[e]=o(c[e])}else for(e in f={},c)if(Object.prototype.hasOwnProperty.call(c,e)){var g=c[e];f[e]=typeof g==="object"&&g!==null?o(g):g}return f}function n(c,f,e){this.initialize(c);this.grammar=o(f);this.externalGrammars=e?o(e):[];this._styles={};this._tree=null;this._allGrammars={};this.preprocess(this.grammar)}var i={unsupported:[{regex:/\(\?[ims\-]:/,
func:function(){return"option on/off for subexp"}},{regex:/\(\?<([=!])/,func:function(c){return c[1]==="="?"lookbehind":"negative lookbehind"}},{regex:/\(\?>/,func:function(){return"atomic group"}}],toRegExp:function(c){function f(b,a){throw Error('Unsupported regex feature "'+b+'": "'+a[0]+'" at index: '+a.index+" in "+a.input);}var e="",g,c=i.processGlobalFlag("x",c,function(b){for(var a="",c=!1,e=b.length,f=0;f<e;){var g=b.charAt(f);if(!c&&g==="#")for(;f<e&&g!=="\r"&&g!=="\n";)g=b.charAt(++f);
else if(!c&&/\s/.test(g))for(;f<e&&/\s/.test(g);)g=b.charAt(++f);else g==="\\"?(a+=g,/\s/.test(b.charAt(f+1))||(a+=b.charAt(f+1),f+=1)):(g==="["?c=!0:g==="]"&&(c=!1),a+=g),f+=1}return a}),c=i.processGlobalFlag("i",c,function(b){e+="i";return b});for(g=0;g<this.unsupported.length;g++){var j;(j=this.unsupported[g].regex.exec(c))&&f(this.unsupported[g].func(j),j)}return RegExp(c,e)},processGlobalFlag:function(c,f,e){function g(b,a){for(var c=0,e=b.length,f=-1,g=a;g<e&&f===-1;g++)switch(b.charAt(g)){case "\\":g++;
break;case "(":c++;break;case ")":c--,c===0&&(f=g)}return f}var j="(?"+c+")",c="(?"+c+":";if(f.substring(0,j.length)===j)return e(f.substring(j.length));else if(f.substring(0,c.length)===c){j=g(f,0);if(j<f.length-1)throw Error("Only a "+c+") group that encloses the entire regex is supported in: "+f);return e(f.substring(c.length,j))}return f},hasBackReference:function(c){return/\\\d+/.test(c.source)},getSubstitutedRegex:function(c,f,e){for(var e=typeof e==="undefined"?!0:!1,c=c.source.split(/(\\\d+)/g),
g=[],j=0;j<c.length;j++){var b=c[j],a=/\\(\d+)/.exec(b);a?(b=f[a[1]]||"",g.push(e?l.escape(b):b)):g.push(b)}return RegExp(g.join(""))},groupify:function(c,f){for(var e=c.source,g=e.length,j=[],b=0,a=[],d=1,i=1,h=[],l={},n={},o=0;o<g;o++){var q=j[j.length-1],u=e.charAt(o);switch(u){case "(":if(q===4)j.pop(),h.push(")"),a[a.length-1].end=o;var w=o+2<g?e.charAt(o+1)+""+e.charAt(o+2):null;if(w==="?:"||w==="?="||w==="?!"){var v;w==="?:"?v=1:(v=3,b++);j.push(v);a.push({start:o,end:-1,type:v});h.push(u);
h.push(w);o+=w.length}else j.push(2),a.push({start:o,end:-1,type:2,oldNum:d,num:i}),h.push(u),b===0&&(n[i]=null),l[d]=i,d++,i++;break;case ")":q=j.pop();q===3&&b--;a[a.length-1].end=o;h.push(u);break;case "*":case "+":case "?":case "}":var k=u,t=e.charAt(o-1),w=o-1;if(u==="}"){for(v=o-1;e.charAt(v)!=="{"&&v>=0;v--);t=e.charAt(v-1);w=v-1;k=e.substring(v,o+1)}v=a[a.length-1];if(t===")"&&(v.type===2||v.type===4)){h.splice(v.start,0,"(");h.push(k);h.push(")");u={start:v.start,end:h.length-1,type:4,num:v.num};
for(t=0;t<a.length;t++)if(q=a[t],(q.type===2||q.type===4)&&q.start>=v.start&&q.end<=w)if(q.start+=1,q.end+=1,q.num+=1,q.type===2)l[q.oldNum]=q.num;a.push(u);i++;break}default:u!=="|"&&q!==2&&q!==4&&b===0&&(j.push(4),a.push({start:o,end:-1,type:4,num:i}),h.push("("),n[i]=null,i++),h.push(u),u==="\\"&&(u=e.charAt(o+1),h.push(u),o+=1)}}for(;j.length;)j.pop(),h.push(")");var e=RegExp(h.join("")),g={},f=f||l,x;for(x in f)f.hasOwnProperty(x)&&(g[x]="\\"+f[x]);e=this.getSubstitutedRegex(e,g,!1);return[e,
l,n]},complexCaptures:function(c){if(!c)return!1;for(var f in c)if(c.hasOwnProperty(f)&&f!=="0")return!0;return!1}};n.prototype={initialize:function(c){this.textView=c;this.textView.stylerOptions=this;var f=this;this._listener={onModelChanged:function(c){f.onModelChanged(c)},onDestroy:function(c){f.onDestroy(c)},onLineStyle:function(c){f.onLineStyle(c)},onStorage:function(c){f.onStorage(c)}};c.addEventListener("ModelChanged",this._listener.onModelChanged);c.addEventListener("Destroy",this._listener.onDestroy);
c.addEventListener("LineStyle",this._listener.onLineStyle);c.redrawLines()},onDestroy:function(){this.destroy()},destroy:function(){if(this.textView)this.textView.removeEventListener("ModelChanged",this._listener.onModelChanged),this.textView.removeEventListener("Destroy",this._listener.onDestroy),this.textView.removeEventListener("LineStyle",this._listener.onLineStyle),this.textView=null;this._listener=this._tree=this._styles=this.grammar=null},preprocess:function(c){for(c=[c];c.length!==0;){var f=
c.pop();if(!f._resolvedRule||!f._typedRule)if(f._resolvedRule=this._resolve(f),f._typedRule=this._createTypedRule(f),this.addStyles(f.name),this.addStyles(f.contentName),this.addStylesForCaptures(f.captures),this.addStylesForCaptures(f.beginCaptures),this.addStylesForCaptures(f.endCaptures),f._resolvedRule!==f&&c.push(f._resolvedRule),f.patterns)for(var e=0;e<f.patterns.length;e++)c.push(f.patterns[e])}},addStyles:function(c){if(c&&!this._styles[c]){this._styles[c]=[];for(var f=c.split("."),e=0;e<
f.length;e++)this._styles[c].push(f.slice(0,e+1).join("-"))}},addStylesForCaptures:function(c){for(var f in c)c.hasOwnProperty(f)&&this.addStyles(c[f].name)},ContainerRule:function(){function c(c){this.rule=c;this.subrules=c.patterns}c.prototype.valueOf=function(){return"aa"};return c}(),BeginEndRule:function(){function c(c){this.rule=c;this.beginRegex=i.toRegExp(c.begin);this.endRegex=i.toRegExp(c.end);this.subrules=c.patterns||[];this.endRegexHasBackRef=i.hasBackReference(this.endRegex);var e=i.complexCaptures(c.captures),
c=i.complexCaptures(c.beginCaptures)||i.complexCaptures(c.endCaptures);if(this.isComplex=e||c)e=i.groupify(this.beginRegex),this.beginRegex=e[0],this.beginOld2New=e[1],this.beginConsuming=e[2],e=i.groupify(this.endRegex,this.beginOld2New),this.endRegex=e[0],this.endOld2New=e[1],this.endConsuming=e[2]}c.prototype.valueOf=function(){return this.beginRegex};return c}(),MatchRule:function(){function c(c){this.rule=c;this.matchRegex=i.toRegExp(c.match);if(this.isComplex=i.complexCaptures(c.captures))c=
i.groupify(this.matchRegex),this.matchRegex=c[0],this.matchOld2New=c[1],this.matchConsuming=c[2]}c.prototype.valueOf=function(){return this.matchRegex};return c}(),_createTypedRule:function(c){return c.match?new this.MatchRule(c):c.begin?new this.BeginEndRule(c):new this.ContainerRule(c)},_resolve:function(c){var f=c;if(c.include){if(c.begin||c.end||c.match)throw Error('Unexpected regex pattern in "include" rule '+c.include);c=c.include;if(c.charAt(0)==="#"){if(f=this.grammar.repository&&this.grammar.repository[c.substring(1)],
!f)throw Error("Couldn't find included rule "+c+" in grammar repository");}else if(c==="$self")f=this.grammar;else if(c==="$base")throw Error('Include "$base" is not supported');else if(f=this._allGrammars[c],!f)for(var e=0;e<this.externalGrammars.length;e++){var g=this.externalGrammars[e];if(g.scopeName===c){this.preprocess(g);f=this._allGrammars[c]=g;break}}}return f},ContainerNode:function(){function c(c,e){this.parent=c;this.rule=e;this.children=[];this.end=this.start=null}c.prototype.addChild=
function(c){this.children.push(c)};c.prototype.valueOf=function(){var c=this.rule;return"ContainerNode { "+(c.include||"")+" "+(c.name||"")+(c.comment||"")+"}"};return c}(),BeginEndNode:function(){function c(c,e,g){this.parent=c;this.rule=e;this.children=[];this.setStart(g);this.endMatch=this.end=null;this.endRegexSubstituted=e.endRegexHasBackRef?i.getSubstitutedRegex(e.endRegex,g):null}c.prototype.addChild=function(c){this.children.push(c)};c.prototype.getIndexInParent=function(){return this.parent?
this.parent.children.indexOf(this):-1};c.prototype.setStart=function(c){this.start=c.index;this.beginMatch=c};c.prototype.setEnd=function(c){c&&typeof c==="object"?(this.endMatch=c,this.end=c.index+c[0].length):(this.endMatch=null,this.end=c)};c.prototype.shiftStart=function(c){this.start+=c;this.beginMatch.index+=c};c.prototype.shiftEnd=function(c){this.end+=c;this.endMatch&&(this.endMatch.index+=c)};c.prototype.valueOf=function(){return"{"+this.rule.beginRegex+" range="+this.start+".."+this.end+
"}"};return c}(),push:function(c,f){if(f)for(var e=f.length;e>0;)c.push(f[--e])},exec:function(c,f,e){(f=c.exec(f))&&(f.index+=e);c.lastIndex=0;return f},afterMatch:function(c){return c.index+c[0].length},getEndMatch:function(c,f,e){if(c instanceof this.BeginEndNode){var g=c.rule,c=c.endRegexSubstituted||g.endRegex;return!c?null:this.exec(c,f,e)}return null},initialParse:function(){this.textView.getModel().getCharCount();this._tree=new this.ContainerNode(null,this.grammar._typedRule);this.parse(this._tree,
!1,0)},onModelChanged:function(c){var f=c.addedCharCount,e=c.removedCharCount,c=c.start;if(this._tree){var g=this.textView.getModel(),j=g.getCharCount(),g=g.getLineEnd(g.getLineAtOffset(c)-1),b=this.getFirstDamaged(g,g),g=g===-1?0:g,f=b?this.parse(b,!0,g,c,f,e):j;this.textView.redrawRange(g,f)}else this.initialParse()},getFirstDamaged:function(c,f){if(c<0)return this._tree;for(var e=[this._tree],g=null;e.length;){var j=e.pop();if(!j.parent||this.isDamaged(j,c,f)){j instanceof this.BeginEndNode&&(g=
j);for(var b=0;b<j.children.length;b++)e.push(j.children[b])}}return g||this._tree},isDamaged:function(c,f,e){return c.start<=e&&c.end>f},parse:function(c,f,e,g,j,b){var a=this.textView.getModel(),d=a.getLineStart(a.getLineCount()-1),i=a.getCharCount(),h=this.getInitialExpected(c,e),l=-1;if(f)c.repaired=!0,c.endNeedsUpdate=!0,l=(l=c.children[c.children.length-1])?a.getLineEnd(a.getLineAtOffset(l.end+(j-b))):-1,g=a.getLineEnd(a.getLineAtOffset(g+b)),l=Math.max(l,g);for(var l=l===-1?i:l,g=h,n=c,o=!1,
q=e,u=-1;n&&(!f||q<l);){var w=this.getNextMatch(a,n,q);w||(q=q>=d?i:a.getLineStart(a.getLineAtOffset(q)+1));var v=w&&w.match,k=w&&w.rule,t=w&&w.isEnd;if(w&&w.isSub){if(q=this.afterMatch(v),k instanceof this.BeginEndRule)o=!0,f&&k===g.rule&&n===g.parent?(n=g,n.setStart(v),n.repaired=!0,n.endNeedsUpdate=!0,g=this.getNextExpected(g,"begin")):(f&&(this.prune(n,g),f=!1),v=new this.BeginEndNode(n,k,v),n.addChild(v),n=v)}else if(t||q===i){if(n instanceof this.BeginEndNode)v?(o=!0,u=Math.max(u,n.end),n.setEnd(v),
q=this.afterMatch(v),f&&n===g&&n.parent===g.parent?(n.repaired=!0,delete n.endNeedsUpdate,g=this.getNextExpected(g,"end")):f&&(this.prune(n,g),f=!1)):(n.setEnd(i),delete n.endNeedsUpdate);n=n.parent}f&&q>=l&&!o&&(this.prune(c,h),f=!1)}this.removeUnrepairedChildren(c,f,e);this.cleanup(f,c,e,l,i,j,b);return f?Math.max(u,q):q},removeUnrepairedChildren:function(c,f,e){if(f){for(var f=c.children,g=-1,j=0;j<f.length;j++){var b=f[j];if(!b.repaired&&this.isDamaged(b,e,Number.MAX_VALUE)){g=j;break}}if(g!==
-1)c.children.length=g}},cleanup:function(c,f,e,g,j,b,a){if(c){c=b-a;j=this.getIntersecting(g-c+1,j);f=this.getIntersecting(e,g);for(e=0;e<j.length;e++)g=j[e],!g.repaired&&g instanceof this.BeginEndNode&&(g.shiftEnd(c),g.shiftStart(c));for(e=0;e<f.length;e++)g=f[e],g.repaired&&g.endNeedsUpdate&&g.shiftEnd(c),delete g.endNeedsUpdate,delete g.repaired}else{f=this.getIntersecting(e,g);for(e=0;e<f.length;e++)delete f[e].repaired}},getNextMatch:function(c,f,e,g){var j=c.getLineAtOffset(e),j=c.getLineEnd(j),
b=c.getText(e,j),a=[],d=[],c=[],j=[];for(this.push(a,f.rule.subrules);a.length;){var i=a.length?a.pop():null,i=i&&i._resolvedRule._typedRule;if(i instanceof this.ContainerRule&&d.indexOf(i)===-1)d.push(i),this.push(a,i.subrules);else if(!i||!g||i.matchRegex){var h=i&&this.exec(i.matchRegex||i.beginRegex,b,e);h&&(c.push(h),j.push(i))}}a=Number.MAX_VALUE;d=-1;for(i=0;i<c.length;i++)if(h=c[i],h.index<a)a=h.index,d=i;if(!g&&(e=this.getEndMatch(f,b,e)))if(g=f.rule.applyEndPatternLast,d===-1||e.index<a||
!g&&e.index===a)return{isEnd:!0,rule:f.rule,match:e};return d===-1?null:{isSub:!0,rule:j[d],match:c[d]}},getInitialExpected:function(c,f){var e,g;if(c===this._tree)for(e=0;e<c.children.length;e++){if(g=c.children[e],g.start>=f)return g}else if(c instanceof this.BeginEndNode&&c.endMatch){var j=c.endMatch.index;for(e=0;e<c.children.length;e++)if(g=c.children[e],g.start>=f)break;if(g&&g.start<j)return g}return c},getNextExpected:function(c,f){if(f==="begin"){var e=c.children[0];return e?e:c}else if(f===
"end"&&(e=c.parent)){var g=e.children[e.children.indexOf(c)+1];return g?g:e}return null},prune:function(c,f){if(f.parent===c)c.children.length=f.getIndexInParent();else if(c instanceof this.BeginEndNode)c.endMatch=null,c.end=null;if(c.parent)c.parent.children.length=c.getIndexInParent()+1},onLineStyle:function(c){this._tree||this.initialParse();var f=c.lineStart,e=this.textView.getModel(),g=e.getLineEnd(c.lineIndex),j=e.getLineEnd(e.getLineAtOffset(f)-1),j=this.getFirstDamaged(j,j),f=this.getLineScope(e,
j,f,g);c.ranges=this.toStyleRanges(f);c.ranges.sort(function(b,a){return b.start-a.start})},getLineScope:function(c,f,e,g){for(var j=e,b=this.getInitialExpected(f,e),a=[],d=[];f&&j<g;){var i=this.getNextMatch(c,f,j);if(!i)break;var h=i&&i.match,l=i&&i.rule,n=i&&i.isSub,i=i&&i.isEnd;h.index!==j&&d.push({start:j,end:h.index,node:f});if(n)j=this.afterMatch(h),l instanceof this.BeginEndRule?(this.addBeginScope(a,h,l),f=b,b=this.getNextExpected(b,"begin")):this.addMatchScope(a,h,l);else if(i)j=this.afterMatch(h),
this.addEndScope(a,h,l),b=this.getNextExpected(b,"end"),f=f.parent}j<g&&d.push({start:j,end:g,node:f});c=this.getInheritedLineScope(d,e,g);return a.concat(c)},getInheritedLineScope:function(c){for(var f=[],e=0;e<c.length;e++)for(var g=c[e],i=g.node;i;){var b=i.rule.rule,a=b.name;if(b=b.contentName||a){this.addScopeRange(f,g.start,g.end,b);break}i=i.parent}return f},addBeginScope:function(c,f,e){var g=e.rule;this.addCapturesScope(c,f,g.beginCaptures||g.captures,e.isComplex,e.beginOld2New,e.beginConsuming)},
addEndScope:function(c,f,e){var g=e.rule;this.addCapturesScope(c,f,g.endCaptures||g.captures,e.isComplex,e.endOld2New,e.endConsuming)},addMatchScope:function(c,f,e){var g=e.rule,i=g.name;(g=g.captures)?this.addCapturesScope(c,f,g,e.isComplex,e.matchOld2New,e.matchConsuming):this.addScope(c,f,i)},addScope:function(c,f,e){e&&c.push({start:f.index,end:this.afterMatch(f),scope:e})},addScopeRange:function(c,f,e,g){g&&c.push({start:f,end:e,scope:g})},addCapturesScope:function(c,f,e,g,i,b){if(e)if(g){for(var g=
{1:0},a=0,d=1;f[d]!==void 0;d++)b[d]!==void 0&&(a+=f[d].length),f[d+1]!==void 0&&(g[d+1]=a);b=f.index;for(a=1;e[a];a++){var d=e[a].name,l=i[a],h=b+g[l];typeof f[l]!=="undefined"&&this.addScopeRange(c,h,h+f[l].length,d)}}else this.addScope(c,f,e[0]&&e[0].name)},getIntersecting:function(c,f){for(var e=[],g=this._tree?[this._tree]:[];g.length;){var i=g.pop(),b=!1;i instanceof this.ContainerNode?b=!0:this.isDamaged(i,c,f)&&(b=!0,e.push(i));if(b)for(var b=i.children.length,a=0;a<b;a++)g.push(i.children[a])}return e.reverse()},
toStyleRanges:function(c){for(var f=[],e=0;e<c.length;e++){var g=c[e],i=this._styles[g.scope];if(!i)throw Error("styles not found for "+g.scope);i=i.join(" ");f.push({start:g.start,end:g.end,style:{styleClass:i}})}return f}};return{RegexUtil:i,TextMateStyler:n}});
define("orion/editor/htmlGrammar",[],function(){return{HtmlGrammar:function(){return{scopeName:"source.html",uuid:"3B5C76FB-EBB5-D930-F40C-047D082CE99B",patterns:[{begin:"<!(doctype|DOCTYPE)",end:">",contentName:"entity.name.tag.doctype.html",beginCaptures:{0:{name:"entity.name.tag.doctype.html"}},endCaptures:{0:{name:"entity.name.tag.doctype.html"}}},{begin:"<\!--",end:"--\>",beginCaptures:{0:{name:"punctuation.definition.comment.html"}},endCaptures:{0:{name:"punctuation.definition.comment.html"}},
patterns:[{match:"--",name:"invalid.illegal.badcomment.html"}],contentName:"comment.block.html"},{match:"<[A-Za-z0-9_\\-:]+(?= ?)",name:"entity.name.tag.html"},{include:"#attrName"},{include:"#qString"},{include:"#qqString"},{include:"#entity"},{match:"</[A-Za-z0-9_\\-:]+>",name:"entity.name.tag.html"},{match:">",name:"entity.name.tag.html"}],repository:{attrName:{match:"[A-Za-z\\-:]+(?=\\s*=\\s*['\"])",name:"entity.other.attribute.name.html"},qqString:{match:'(")[^"]+(")',name:"string.quoted.double.html"},
qString:{match:"(')[^']+(')",name:"string.quoted.single.html"},entity:{match:"&[A-Za-z0-9]+;",name:"constant.character.entity.html"}}}}}});
define("examples/editor/textStyler",["orion/editor/annotations","orion/editor/keywords"],function(l,o){function n(a,b){this.keywords=a;this.whitespacesVisible=b;this.setText("")}function i(){n.call(this,null,!0)}function c(a){n.call(this,null,a)}function f(){n.call(this,null,!1)}function e(a,d,e){this.commentStart="/*";this.commentEnd="*/";var h=[];switch(d){case "java":h=j;break;case "js":h=g;break;case "css":h=b}this.whitespacesVisible=this.spacesVisible=this.tabsVisible=!1;this.detectHyperlinks=
!0;this.highlightCaretLine=!1;this.detectTasks=this.foldingEnabled=!0;this._scanner=new n(h,this.whitespacesVisible);this._firstScanner=new f;this._commentScanner=new c(this.whitespacesVisible);this._whitespaceScanner=new i;if(d==="css")this._scanner.isCSS=!0,this._firstScanner.isCSS=!0;this.view=a;this.annotationModel=e;this._bracketAnnotations=void 0;var k=this;this._listener={onChanged:function(a){k._onModelChanged(a)},onDestroy:function(a){k._onDestroy(a)},onLineStyle:function(a){k._onLineStyle(a)},
onMouseDown:function(a){k._onMouseDown(a)},onSelection:function(a){k._onSelection(a)}};d=a.getModel();d.getBaseModel&&(d=d.getBaseModel());d.addEventListener("Changed",this._listener.onChanged);a.addEventListener("MouseDown",this._listener.onMouseDown);a.addEventListener("Selection",this._listener.onSelection);a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("LineStyle",this._listener.onLineStyle);this._computeComments();this._computeFolding();a.redrawLines()}var g=o.JSKeywords,
j=o.JAVAKeywords,b=o.CSSKeywords,a={styleClass:"token_singleline_comment"},d={styleClass:"token_multiline_comment"},m={styleClass:"token_doc_comment"},h={styleClass:"token_doc_html_markup"},p={styleClass:"token_task_tag"},s={styleClass:"token_doc_tag"},r={styleClass:"token_string"},q={styleClass:"token_number"},u={styleClass:"token_keyword"},w={styleClass:"token_space",unmergeable:!0},v={styleClass:"token_tab",unmergeable:!0},k={styleClass:"line_caret"};n.prototype={getOffset:function(){return this.offset},
getStartOffset:function(){return this.startOffset},getData:function(){return this.text.substring(this.startOffset,this.offset)},getDataLength:function(){return this.offset-this.startOffset},_default:function(a){switch(a){case 32:case 9:if(this.whitespacesVisible)return a===32?11:10;do a=this._read();while(a===32||a===9);this._unread(a);return 9;case 123:case 125:case 40:case 41:case 91:case 93:case 60:case 62:return a;default:var b=this.isCSS,c=this.offset-1;if(!b&&48<=a&&a<=57){var d=b=!1,e=!1,f=
a;do if(a=this._read(),a===46&&!b)b=!0;else if(a===101&&!d)b=d=!0,a=this._read(),a!==45&&this._unread(a);else if(a===120&&f===48&&this.offset-c===2)b=d=e=!0;else if(!(48<=a&&a<=57||e&&(65<=a&&a<=70||97<=a&&a<=102)))break;while(1);this._unread(a);return 3}if(97<=a&&a<=122||65<=a&&a<=90||a===95||45===a&&b){do a=this._read();while(97<=a&&a<=122||65<=a&&a<=90||a===95||48<=a&&a<=57||45===a&&b);this._unread(a);a=this.keywords;if(a.length>0){c=this.text.substring(c,this.offset);for(b=0;b<a.length;b++)if(this.keywords[b]===
c)return 2}}return 1}},_read:function(){return this.offset<this.text.length?this.text.charCodeAt(this.offset++):-1},_unread:function(a){a!==-1&&this.offset--},nextToken:function(){for(this.startOffset=this.offset;;){var a=this._read(),b;switch(a){case -1:return null;case 47:a=this._read();if(!this.isCSS&&a===47)for(;;)if(a=this._read(),a===-1||a===10||a===13)return this._unread(a),6;if(a===42){a=this._read();b=7;for(a===42&&(b=8);;){for(;a===42;)if(a=this._read(),a===47)return b;if(a===-1)return this._unread(a),
b;a=this._read()}}this._unread(a);return 1;case 39:for(b=4;;)switch(a=this._read(),a){case 39:return b;case 13:case 10:case -1:return this._unread(a),b;case 92:switch(a=this._read(),a){case 10:b=5;break;case 13:b=5,a=this._read(),a!==10&&this._unread(a)}}break;case 34:for(b=4;;)switch(a=this._read(),a){case 34:return b;case 13:case 10:case -1:return this._unread(a),b;case 92:switch(a=this._read(),a){case 10:b=5;break;case 13:b=5,a=this._read(),a!==10&&this._unread(a)}}break;default:return this._default(a)}}},
setText:function(a){this.text=a;this.startOffset=this.offset=0}};i.prototype=new n(null);i.prototype.nextToken=function(){for(this.startOffset=this.offset;;){var a=this._read();switch(a){case -1:return null;case 32:return 11;case 9:return 10;default:do a=this._read();while(!(a===32||a===9||a===-1));this._unread(a);return 1}}};c.prototype=new n(null);c.prototype.setType=function(a){this._type=a};c.prototype.nextToken=function(){for(this.startOffset=this.offset;;){var a=this._read();switch(a){case -1:return null;
case 32:case 9:if(this.whitespacesVisible)return a===32?11:10;do a=this._read();while(a===32||a===9);this._unread(a);return 9;case 60:if(this._type===8){do a=this._read();while(!(a===62||a===-1));if(a===62)return 12}return 1;case 64:if(this._type===8){do a=this._read();while(97<=a&&a<=122||65<=a&&a<=90||a===95||48<=a&&a<=57);this._unread(a);return 13}return 1;case 84:if((a=this._read())===79)if((a=this._read())===68)if((a=this._read())===79)if(a=this._read(),!(97<=a&&a<=122||65<=a&&a<=90||a===95||
48<=a&&a<=57))return this._unread(a),14;this._unread(a);default:do a=this._read();while(!(a===32||a===9||a===-1||a===60||a===64||a===84));this._unread(a);return 1}}};f.prototype=new n(null);f.prototype._default=function(a){for(;;)switch(a=this._read(),a){case 47:case 34:case 39:case -1:return this._unread(a),1}};e.prototype={destroy:function(){var a=this.view;if(a){var b=a.getModel();b.getBaseModel&&(b=b.getBaseModel());b.removeEventListener("Changed",this._listener.onChanged);a.removeEventListener("MouseDown",
this._listener.onMouseDown);a.removeEventListener("Selection",this._listener.onSelection);a.removeEventListener("Destroy",this._listener.onDestroy);a.removeEventListener("LineStyle",this._listener.onLineStyle);this.view=null}},setHighlightCaretLine:function(a){this.highlightCaretLine=a},setWhitespacesVisible:function(a,b){if(this.whitespacesVisible!==a)this.whitespacesVisible=a,this._scanner.whitespacesVisible=a,this._commentScanner.whitespacesVisible=a,b&&this.view.redraw()},setTabsVisible:function(a){if(this.tabsVisible!==
a)this.tabsVisible=a,this.setWhitespacesVisible(this.tabsVisible||this.spacesVisible,!1),this.view.redraw()},setSpacesVisible:function(a){if(this.spacesVisible!==a)this.spacesVisible=a,this.setWhitespacesVisible(this.tabsVisible||this.spacesVisible,!1),this.view.redraw()},setDetectHyperlinks:function(a){this.detectHyperlinks=a},setFoldingEnabled:function(a){this.foldingEnabled=a},setDetectTasks:function(a){this.detectTasks=a},_binarySearch:function(a,b,c,d,e){var f;d===void 0&&(d=-1);if(e===void 0)e=
a.length;for(;e-d>1;)if(f=Math.floor((e+d)/2),b<=a[f].start)e=f;else if(c&&b<a[f].end){e=f;break}else d=f;return e},_computeComments:function(){var a=this.view.getModel();a.getBaseModel&&(a=a.getBaseModel());this.comments=this._findComments(a.getText())},_computeFolding:function(){if(this.foldingEnabled){var a=this.view.getModel();if(a.getBaseModel){var b=this.annotationModel;if(b){b.removeAnnotations(l.AnnotationType.ANNOTATION_FOLDING);for(var c=[],d=a.getBaseModel(),e=this.comments,f=0;f<e.length;f++){var g=
e[f];(g=this._createFoldingAnnotation(a,d,g.start,g.end))&&c.push(g)}b.replaceAnnotations(null,c)}}}},_createFoldingAnnotation:function(a,b,c,d){var e=b.getLineAtOffset(c),b=b.getLineAtOffset(d);return e===b?null:new (l.AnnotationType.getType(l.AnnotationType.ANNOTATION_FOLDING))(c,d,a)},_computeTasks:function(a,b,c){if(this.detectTasks){var d=this.annotationModel;if(d){var e=this.view.getModel(),f=e;e.getBaseModel&&(f=e.getBaseModel());for(var g=d.getAnnotations(b,c),e=[],h=l.AnnotationType.ANNOTATION_TASK;g.hasNext();){var i=
g.next();i.type===h&&e.push(i)}g=[];i=this._commentScanner;i.setText(f.getText(b,c));for(var j;j=i.nextToken();){var k=i.getStartOffset()+b;j===14&&(j=f.getLineEnd(f.getLineAtOffset(k)),a!==6&&(j=Math.min(j,c-this.commentEnd.length)),g.push(l.AnnotationType.createAnnotation(h,k,j,f.getText(k,j))))}d.replaceAnnotations(e,g)}}},_getLineStyle:function(a){if(this.highlightCaretLine){var b=this.view,c=b.getModel(),b=b.getSelection();if(b.start===b.end&&c.getLineAtOffset(b.start)===a)return k}return null},
_getStyles:function(a,b,c){a.getBaseModel&&(c=a.mapOffset(c));for(var e=c+b.length,f=[],g=c,h=this.comments,i=this._binarySearch(h,c,!0);i<h.length;i++){if(h[i].start>=e)break;var j=h[i].start,k=h[i].end;g<j&&this._parse(b.substring(g-c,j-c),g,f);var l=h[i].type,n;switch(l){case 8:n=m;break;case 7:n=d;break;case 5:n=r}g=Math.max(g,j);j=Math.min(e,k);(l===8||l===7)&&(this.whitespacesVisible||this.detectHyperlinks)?this._parseComment(b.substring(g-c,j-c),g,f,n,l):l===5&&this.whitespacesVisible?this._parseString(b.substring(g-
c,j-c),g,f,r):f.push({start:g,end:j,style:n});g=k}g<e&&this._parse(b.substring(g-c,e-c),g,f);if(a.getBaseModel)for(b=0;b<f.length;b++)c=f[b].end-f[b].start,f[b].start=a.mapOffset(f[b].start,!0),f[b].end=f[b].start+c;return f},_parse:function(b,c,e){var f=this._scanner;for(f.setText(b);b=f.nextToken();){var g=f.getStartOffset()+c,h=null;switch(b){case 2:h=u;break;case 3:h=q;break;case 5:case 4:if(this.whitespacesVisible){this._parseString(f.getData(),g,e,r);continue}else h=r;break;case 8:this._parseComment(f.getData(),
g,e,m,b);continue;case 6:this._parseComment(f.getData(),g,e,a,b);continue;case 7:this._parseComment(f.getData(),g,e,d,b);continue;case 10:this.whitespacesVisible&&this.tabsVisible&&(h=v);break;case 11:this.whitespacesVisible&&this.spacesVisible&&(h=w)}e.push({start:g,end:f.getOffset()+c,style:h})}},_parseComment:function(a,b,c,d,e){var f=this._commentScanner;f.setText(a);for(f.setType(e);a=f.nextToken();){var e=f.getStartOffset()+b,g=d;switch(a){case 10:this.whitespacesVisible&&this.tabsVisible&&
(g=v);break;case 11:this.whitespacesVisible&&this.spacesVisible&&(g=w);break;case 12:g=h;break;case 13:g=s;break;case 14:g=p;break;default:this.detectHyperlinks&&(g=this._detectHyperlinks(f.getData(),e,c,g))}g&&c.push({start:e,end:f.getOffset()+b,style:g})}},_parseString:function(a,b,c,d){var e=this._whitespaceScanner;for(e.setText(a);a=e.nextToken();){var f=e.getStartOffset()+b,g=d;switch(a){case 10:this.whitespacesVisible&&this.tabsVisible&&(g=v);break;case 11:this.whitespacesVisible&&this.spacesVisible&&
(g=w)}g&&c.push({start:f,end:e.getOffset()+b,style:g})}},_detectHyperlinks:function(a,b,c,d){var e=null,f;if((f=a.indexOf("://"))>0){for(var e=a,g=f;g>0;){f=e.charCodeAt(g-1);if(!(97<=f&&f<=122||65<=f&&f<=90||45===f||48<=f&&f<=57))break;g--}if(g>0&&(f="\"\"''(){}[]<>".indexOf(e.substring(g-1,g)),f!==-1&&(f&1)===0&&(f=e.lastIndexOf("\"\"''(){}[]<>".substring(f+1,f+2)))!==-1)){var h=f;f=this._clone(d);f.tagName="a";f.attributes={href:e.substring(g,h)};c.push({start:b,end:b+g,style:d});c.push({start:b+
g,end:b+h,style:f});c.push({start:b+h,end:b+a.length,style:d});return null}}else a.toLowerCase().indexOf("bug#")===0&&(e="https://bugs.eclipse.org/bugs/show_bug.cgi?id="+parseInt(a.substring(4),10));return e?(f=this._clone(d),f.tagName="a",f.attributes={href:e},f):d},_clone:function(a){if(!a)return a;var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},_findComments:function(a,b){var b=b||0,c=this._firstScanner,d;c.setText(a);for(var e=[];d=c.nextToken();)(d===7||d===8||d===5)&&e.push({start:c.getStartOffset()+
b,end:c.getOffset()+b,type:d}),(d===6||d===7||d===8)&&this._computeTasks(d,c.getStartOffset()+b,c.getOffset()+b);return e},_findMatchingBracket:function(a,b){var c="{}()[]<>",d=a.getText(b,b+1),e=c.indexOf(d,0);if(e===-1)return-1;var f;f=e&1?c.substring(e-1,e):c.substring(e+1,e+2);for(var g=a.getLineAtOffset(b),c=a.getLine(g),h=a.getLineStart(g),i=a.getLineEnd(g),c=this._findBrackets(d,f,c,h,h,i),i=0;i<c.length;i++)if(h=c[i]>=0?1:-1,c[i]*h-1===b){var j=1;if(e&1){for(i--;i>=0;i--)if(h=c[i]>=0?1:-1,
j+=h,j===0)return c[i]*h-1;for(g-=1;g>=0;){c=a.getLine(g);h=a.getLineStart(g);i=a.getLineEnd(g);c=this._findBrackets(d,f,c,h,h,i);for(e=c.length-1;e>=0;e--)if(h=c[e]>=0?1:-1,j+=h,j===0)return c[e]*h-1;g--}}else{for(i++;i<c.length;i++)if(h=c[i]>=0?1:-1,j+=h,j===0)return c[i]*h-1;g+=1;for(e=a.getLineCount();g<e;){c=a.getLine(g);h=a.getLineStart(g);i=a.getLineEnd(g);c=this._findBrackets(d,f,c,h,h,i);for(i=0;i<c.length;i++)if(h=c[i]>=0?1:-1,j+=h,j===0)return c[i]*h-1;g++}}break}return-1},_findBrackets:function(a,
b,c,d,e,f){for(var g=[],a=a.charCodeAt(0),b=b.charCodeAt(0),h=e,i=this._scanner,j,k=this.comments,l=this._binarySearch(k,e,!0);l<k.length;l++){if(k[l].start>=f)break;j=k[l].start;var m=k[l].end;if(h<j)for(i.setText(c.substring(h-e,j-e));j=i.nextToken();)j===a?g.push(i.getStartOffset()+h-e+d+1):j===b&&g.push(-(i.getStartOffset()+h-e+d+1));h=m}if(h<f)for(i.setText(c.substring(h-e,f-e));j=i.nextToken();)j===a?g.push(i.getStartOffset()+h-e+d+1):j===b&&g.push(-(i.getStartOffset()+h-e+d+1));return g},_onDestroy:function(){this.destroy()},
_onLineStyle:function(a){if(a.textView===this.view)a.style=this._getLineStyle(a.lineIndex);a.ranges=this._getStyles(a.textView.getModel(),a.lineText,a.lineStart)},_onSelection:function(a){var b=a.oldValue,c=a.newValue,d=this.view,a=d.getModel(),e;if(this.highlightCaretLine){var f=a.getLineAtOffset(b.start);e=a.getLineAtOffset(c.start);var g=c.start===c.end,b=b.start===b.end;f===e&&b&&g||(b&&d.redrawLines(f,f+1),(f!==e||!b)&&g&&d.redrawLines(e,e+1))}if(this.annotationModel){var b=this._bracketAnnotations,
h,i;if(c.start===c.end&&(i=d.getCaretOffset())>0)i-=1,a.getBaseModel&&(i=a.mapOffset(i),a=a.getBaseModel()),a=this._findMatchingBracket(a,i),a!==-1&&(h=[l.AnnotationType.createAnnotation(l.AnnotationType.ANNOTATION_MATCHING_BRACKET,a,a+1),l.AnnotationType.createAnnotation(l.AnnotationType.ANNOTATION_CURRENT_BRACKET,i,i+1)]);this._bracketAnnotations=h;this.annotationModel.replaceAnnotations(b,h)}},_onMouseDown:function(a){if(a.clickCount===2){var b=this.view,c=b.getModel(),d=b.getOffsetAtLocation(a.x,
a.y);if(d>0){var e=d-1,f=c;c.getBaseModel&&(e=c.mapOffset(e),f=c.getBaseModel());e=this._findMatchingBracket(f,e);e!==-1&&(a.preventDefault(),a=e,c.getBaseModel&&(a=c.mapOffset(a,!0)),d>a&&(d--,a++),b.setSelection(a,d))}}},_onModelChanged:function(a){var b=a.start,c=a.removedCharCount,d=a.addedCharCount-c,e=this.view,a=e.getModel(),f=a.getBaseModel?a.getBaseModel():a,c=b+c,g=f.getCharCount(),h=this.comments.length,i=f.getLineStart(f.getLineAtOffset(b)),j=this._binarySearch(this.comments,i,!0),k=this._binarySearch(this.comments,
c,!1,j-1,h);j<h&&this.comments[j].start<=i&&i<this.comments[j].end?(i=this.comments[j].start,i>b&&(i+=d)):i=j===h&&h>0&&g-d===this.comments[h-1].end?this.comments[h-1].start:i;var m;k<h?(m=this.comments[k].end,m>b&&(m+=d),k+=1):(k=h,m=g);for(var n,g=this._findComments(f.getText(i,m),i),h=j;h<this.comments.length;h++)n=this.comments[h],n.start>b&&(n.start+=d),n.start>b&&(n.end+=d);var o=k-j!==g.length;if(!o)for(h=0;h<g.length;h++){n=this.comments[j+h];var p=g[h];if(n.start!==p.start||n.end!==p.end||
n.type!==p.type){o=!0;break}}h=[j,k-j].concat(g);Array.prototype.splice.apply(this.comments,h);o&&(h=i,n=m,a!==f&&(h=a.mapOffset(h,!0),n=a.mapOffset(n,!0)),e.redrawRange(h,n));if(this.foldingEnabled&&f!==a&&this.annotationModel){e=this.annotationModel;j=e.getAnnotations(i,m);i=[];for(m=[];j.hasNext();)if(n=j.next(),n.type===l.AnnotationType.ANNOTATION_FOLDING){m.push(n);for(h=0;h<g.length;h++)if(n.start===g[h].start&&n.end===g[h].end)break;h===g.length?(i.push(n),n.expand()):(h=n.start,k=n.end,h>
b&&(h-=d),k>b&&(k-=d),h<=b&&b<k&&h<=c&&c<k&&(h=f.getLineAtOffset(n.start),k=f.getLineAtOffset(n.end),h!==k?n.expanded||(n.expand(),e.modifyAnnotation(n)):e.removeAnnotation(n)))}b=[];for(h=0;h<g.length;h++){n=g[h];for(d=0;d<m.length;d++)if(m[d].start===n.start&&m[d].end===n.end)break;d===m.length&&(n=this._createFoldingAnnotation(a,f,n.start,n.end))&&b.push(n)}e.replaceAnnotations(i,b)}}};return{TextStyler:e}});
define("orion/editor/edit","orion/editor/shim,orion/editor/textView,orion/editor/textModel,orion/editor/textTheme,orion/editor/projectionTextModel,orion/editor/eventTarget,orion/keyBinding,orion/editor/rulers,orion/editor/annotations,orion/editor/tooltip,orion/editor/undoStack,orion/editor/textDND,orion/editor/editor,orion/editor/editorFeatures,orion/editor/contentAssist,orion/editor/cssContentAssist,orion/editor/htmlContentAssist,orion/editor/jsTemplateContentAssist,orion/editor/AsyncStyler,orion/editor/mirror,orion/editor/textMateStyler,orion/editor/htmlGrammar,examples/editor/textStyler".split(","),function(l,
o,n,i,c,f,e,g,j,b,a,d,m,h,p,s,r,q,u,w,v,k,t){function x(a){var b=a.firstChild;if(b&&b.tagName==="TEXTAREA")return b.value;var c=a.ownerDocument,d=c.defaultView||c.parentWindow,e;if(!(e=!d.getSelection)){if(!(b=a.childNodes.length===1&&b.nodeType===Node.TEXT_NODE)){for(var f,b=a;b&&b!==c&&f!=="none";)f=d.getComputedStyle?d.getComputedStyle(b,null).getPropertyValue("display"):b.currentStyle.display,b=b.parentNode;b=f==="none"}e=b}if(e)return a.innerText||a.textContent;c=c.createRange();c.selectNode(a);
a=d.getSelection();d=[];for(f=0;f<a.rangeCount;f++)d.push(a.getRangeAt(f));a.removeAllRanges();a.addRange(c);c=a.toString();a.removeAllRanges();for(f=0;f<d.length;f++)a.addRange(d[f]);return c}function B(a){if(a.substring(0,12)==="data-editor-")return a=a.substring(12),a=a.replace(/-([a-z])/ig,function(a,b){return b.toUpperCase()})}function y(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function D(a,b){var c={};y(c,b);for(var d,e=0,f=a.attributes,g=f.length;e<g;e++){d=f.item(e);var h=B(d.nodeName);
if(h){d=d.nodeValue;if(d==="true"||d==="false")d=d==="true";c[h]=d}}return c}function M(a,b){if(a.getElementsByClassName)return a.getElementsByClassName(b);b=b.replace(/ *$/,"");return a.querySelectorAll?a.querySelectorAll((" "+b).replace(/ +/g,".")):null}function J(a){var b=a.document||document,d=a.parent;d||(d="editor");typeof d==="string"&&(d=b.getElementById(d));if(!d&&a.className&&(b=M(b,a.className))){a.className=void 0;if(b.length>1&&a.noFocus===void 0)a.noFocus=!0;for(var e=[],f=b.length-
1;f>=0;f--)a.parent=b[f],e.push(J(a));return e}if(!d)throw"no parent";a=D(d,a);if(typeof a.theme==="string"){var b=i.TextTheme.getTheme(a.theme),f=a.theme.lastIndexOf("/"),g=a.theme;f!==-1&&(g=g.substring(f+1));g.substring(g.length-4)===".css"&&(g=g.substring(0,g.length-4));b.setThemeClass(g,{href:a.theme});a.theme=b}var j;a.readonly||(e={createContentAssistMode:function(a){j=new p.ContentAssist(a.getTextView());a=new p.ContentAssistWidget(j);a=new p.ContentAssistMode(j,a);j.setMode(a);return a}});
var l=new m.Editor({textViewFactory:function(){return new o.TextView({parent:d,model:new c.ProjectionTextModel(new n.TextModel("")),tabSize:a.tabSize?a.tabSize:4,readonly:a.readonly,fullSelection:a.fullSelection,tabMode:a.tabMode,expandTab:a.expandTab,singleMode:a.singleMode,themeClass:a.themeClass,theme:a.theme,wrapMode:a.wrapMode,wrappable:a.wrappable})},undoStackFactory:new h.UndoFactory,annotationFactory:new h.AnnotationFactory,lineNumberRulerFactory:new h.LineNumberRulerFactory,foldingRulerFactory:new h.FoldingRulerFactory,
textDNDFactory:new h.TextDNDFactory,contentAssistFactory:e,keyBindingFactory:new h.KeyBindingsFactory,statusReporter:a.statusReporter,domNode:d});l.addEventListener("TextViewInstalled",function(){var b=l.getLineNumberRuler();b&&a.firstLineIndex!==void 0&&b.setFirstLine(a.firstLineIndex);if(b=l.getSourceCodeActions())b.setAutoPairParentheses(a.autoPairParentheses),b.setAutoPairBraces(a.autoPairBraces),b.setAutoPairSquareBrackets(a.autoPairSquareBrackets),b.setAutoPairAngleBrackets(a.autoPairAngleBrackets),
b.setAutoPairQuotations(a.autoPairQuotations),b.setAutoCompleteComments(a.autoCompleteComments),b.setSmartIndentation(a.smartIndentation)});e=a.contents;e===void 0&&(e=x(d));e||(e="");l.installTextView();l.setLineNumberRulerVisible(a.showLinesRuler===void 0||a.showLinesRuler);l.setAnnotationRulerVisible(a.showAnnotationRuler===void 0||a.showFoldingRuler);l.setOverviewRulerVisible(a.showOverviewRuler===void 0||a.showOverviewRuler);l.setFoldingRulerVisible(a.showFoldingRuler===void 0||a.showFoldingRuler);
l.setInput(a.title,null,e,!1,a.noFocus);({styler:null,highlight:function(b,c){if(this.styler)this.styler.destroy(),this.styler=null;if(b){var d=c.getTextView(),e=c.getAnnotationModel();switch(b){case "js":case "java":case "css":this.styler=new t.TextStyler(d,b,e);c.setFoldingRulerVisible(a.showFoldingRuler===void 0||a.showFoldingRuler);break;case "html":this.styler=new v.TextMateStyler(d,new k.HtmlGrammar)}}}}).highlight(a.lang,l);if(j){var u=new s.CssContentAssistProvider,w=new r.HTMLContentAssistProvider,
y=new q.JSTemplateContentAssistProvider;j.addEventListener("Activating",function(){/css$/.test(a.lang)?j.setProviders([u]):/js$/.test(a.lang)?j.setProviders([y]):/html$/.test(a.lang)&&j.setProviders([w])})}if(d.clientHeight<=50)e=l.getTextView().computeSize().height,d.style.height=e+"px";return l}var K=this.orion?this.orion.editor:void 0;if(K)for(var H=0;H<arguments.length;H++)y(K,arguments[H]);return J});var orion=this.orion||(this.orion={}),editor=orion.editor||(orion.editor={});editor.edit=require("orion/editor/edit");