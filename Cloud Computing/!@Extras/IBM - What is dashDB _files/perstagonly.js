/*! $Id: userinfo.source.js,v 1.8 2014/12/01 14:58:45 santelia Exp $ */
;ibmweb=ibmweb||{};ibmweb.comusr=(function(){var f=["annual_sales","company_name","country","employee_count","industry","information_level","primary_sic","sub_industry"],j={cryptKey:"yxsdpqmouenictjarzvkbfhwlg",decode:function(o){var s=o,p,r="",q=/[a-z]/;for(p=0;p<s.length;p++){if(q.test(s.charAt(p))){r+=String.fromCharCode(j.cryptKey.indexOf(s.charAt(p))+97)}else{r+=s.charAt(p)}}return decodeURIComponent(r)},encode:function(s){var r=s.toLowerCase(),q="",o,p=/[a-z]/;for(o=0;o<r.length;o++){if(p.test(r.charAt(o))){q+=j.cryptKey.charAt(r.charCodeAt(o)-97)}else{q+=r.charAt(o)}}return encodeURIComponent(q)}},k=function(){if(ibmweb&&ibmweb.comusr&&!ibmweb.comusr.isLoaded()){ibmStats.event({ibmEV:"common user tag",ibmEvAction:c.company_name,ibmEvGroup:c.employee_count,ibmEvLinkTitle:c.industry,ibmEvModule:c.sub_industry,ibmEvName:c.primary_sic,ibmEvFileSize:c.annual_sales,ibmEvSection:"n/a",ibmEvTarget:"n/a"})}},n=e("ip"),d=false,h={expireDaysBasic:7,expireDaysDetailed:7,key:"comusrtag",isSupported:function(){try{return window.localStorage&&typeof window.localStorage==="object"&&typeof JSON!=="undefined"}catch(o){return false}},getItem:function(q){var r=null,o=0,p=new Date().getTime();if(!h.isSupported()){return null}if(localStorage.getItem(q)!==null){o=JSON.parse(localStorage.getItem(q)).expires;if(o!==0&&o<p){h.removeItem(q)}else{r=JSON.parse(localStorage.getItem(q)).value}}return r},removeItem:function(o){if(!h.isSupported()){return false}localStorage.removeItem(o)},setItem:function(r,t,o){var s=0,q={},p=new Date().getTime();if(!h.isSupported()){return false}h.removeItem(r);if(o){s=o*1000;s+=p}q={value:t,expires:s};localStorage.setItem(r,JSON.stringify(q));return true}},c={nodata:true};function l(){dojo.io.script.get({url:"//www.ibm.com/webmaster/dbip/ip/"+(n!==""?"?query="+n:""),callbackParamName:"callback",load:function(o){c={};g(o);m();d=true;dojo.ready(function(){k()})},error:function(){console.log("Error calling db service")}})}function b(){return c}function i(){var o,p={},q=h.getItem(h.key);if(typeof q==="object"){for(o in q){if(q.hasOwnProperty(o)){p[(j.decode(o))]=j.decode(q[o])}}}return p}function e(p,s){p=p.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");s=s!==undefined?s:window.location.href;var o="[\\?&]"+p+"=([^&#]*)",r=new RegExp(o,"i"),q=r.exec(s),t="";if(q!==null){t=q[1]}return t}function a(){return d}function g(p){var o;dojo.forEach(f,function(q){o=!p[q]?"n/a":p[q].toString();c[q]=o.toLowerCase()});c.information_level=p.information_level.toLowerCase()}function m(){var o,p={};for(o in c){if(c.hasOwnProperty(o)){p[(j.encode(o))]=j.encode(c[o])}}h.setItem(h.key,p,3600*24*(c.information_level==="basic"?h.expireDaysBasic:h.expireDaysDetailed))}c=i();if(n!==""||!c||!c.information_level){l()}else{d=true;dojo.ready(function(){k()})}return{isLoaded:a,getInfo:b}})();