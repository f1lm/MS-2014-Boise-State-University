/*! $Id: uigetdynoffers.source.js,v 1.36 2014/12/02 00:52:16 santelia Exp $ */
;var igo=(function(){return;if(typeof window.igo==="object"){return window.igo}dojo.cookie("uicet","yes");if(!(dojo.cookie("uicet")=="yes")){return{status:"Cookies not enabled"}}dojo.cookie("uicet",null,{expires:-1});if(typeof ibmweb==="undefined"){return{status:"ibmweb not defined"}}var s=new Date().getTime(),x={performance:{},status:["loading"]},w={isIE:dojo.isIE==undefined?false:true,isTabPage:true,wsrBase:"//www-01.ibm.com/marketing/campaigns/interactmodule/ibmwebchannel/",wsrOfferClicked:"click",wsrOfferGet:"target",wsrOfferGetQueryString:"",wsrOfferJson:{}},g={isLoaded:false,pageCanonicalUrl:"NV",pageCountry:"NV",pageIndustry:"NV",pageLanguage:"NV",pageSegment:"NV",pageSubject:"NV"},z={isLoaded:false,unicaNiodId:"NV",visitorId:dojo.cookie("webInteractVisitorId")!=undefined?dojo.cookie("webInteractVisitorId"):"NV",wiId:dojo.cookie("IBMISP")!=undefined?dojo.cookie("IBMISP"):"NV",visitorLanguage:"NV",visitorReferral:"NV",visitorSearch:"NV"},f={isLoaded:false,FEATURE:{appliedSetting:"",configName:"zoneFeature",defSetting:"1",divId:"unica-interact-feature",exists:false,numOffers:2,numOffersMax:2,offersReturned:0,styleCode:"NV",userSetting:"",widthCol:0,widthImg:0,wsrParamName:"pageZoneFeature"},BODY:{appliedSetting:"",configName:"zoneBody",defSetting:"portrait",divId:"unica-interact-body",exists:false,numOffers:6,numOffersMax:20,offersReturned:0,styleCode:"NV",userSetting:"",widthCol:0,wsrParamName:"pageZoneBody"},BTOM:{appliedSetting:"",configName:"zoneBottom",defSetting:"6",divId:"unica-interact-bottom",exists:false,numOffers:6,numOffersMax:6,offersReturned:0,styleCode:"NV",userSetting:"",widthCol:0,widthImg:0,wsrParamName:"pageZoneBtom"},RNAV1:{appliedSetting:"",configName:"zoneRnav1",defSetting:"feature",divId:"unica-interact-rnav-1",exists:false,numOffers:4,numOffersMax:6,offersReturned:0,styleCode:"NV",userSetting:"",widthCol:0,widthImg:0,wsrParamName:"pageZoneRnav1"},RNAV2:{appliedSetting:"",configName:"zoneRnav2",defSetting:"portrait",divId:"unica-interact-rnav-2",exists:false,numOffers:4,numOffersMax:6,offersReturned:0,styleCode:"NV",userSetting:"",widthCol:0,widthImg:0,wsrParamName:"pageZoneRnav2"},RNAV3:{appliedSetting:"",configName:"zoneRnav3",defSetting:"icon",divId:"unica-interact-rnav-3",exists:false,numOffers:4,numOffersMax:6,offersReturned:0,styleCode:"NV",userSetting:"",widthCol:0,widthImg:0,wsrParamName:"pageZoneRnav3"}},y={APDF:"ibm-pdf-link",FWD:"ibm-forward-link",NONE:"ibm-forward-link",YOUTB:"ibm-youtube-link"},h={feature:"FE",portrait:"PO",icon:"IC"},p={"620":"I6","556":"I5","300":"I3","268":"I2","172":"I1","152":"I1","140":"I0","120":"I0","0":"NV"};function u(C,B){if((C!="sessionId"&&C!="unicaNiodId"&&C!="visitorId"&&C!="wiId")){B=B.toUpperCase()}w.wsrOfferGetQueryString+="&"+encodeURIComponent(C)+"="+encodeURIComponent(B)}function A(){dojo.query("a.uint-dyn-offer").onclick(function(D){dojo.stopEvent(D);var G=D.currentTarget,C=G.getAttribute("data-oc"),H=G.getAttribute("data-otc"),F=G.getAttribute("data-odof"),B="?sessionId="+z.sessionId+"&trackingCode="+H+"&offerCode="+C+"&defaultOffersFlag="+F,E=G.href;dojo.io.script.get({url:w.wsrBase+w.wsrOfferClicked+B,handleAs:"json",callbackParamName:"callback",load:function(){var I=new Date();I.setTime(I.getTime()+(4.75*60*1000));dojo.cookie("unintofc",z.sessionId+"^"+C+"^"+H+"^"+F,{expires:I.toUTCString(),path:"/",domain:".ibm.com"});window.location.href=E}})})}function o(B){return p[B]}function v(B){return'<a href="'+B.url+'" class="'+B.lc+' uint-dyn-offer" data-oc="'+B.oc+'" data-otc="'+B.otc+'" data-odof="'+B.odof+'">'+B.item+"</a>"}function q(){var F=new Date().getTime(),C=w.wsrOfferJson.zones,E="",B="",D=w.isTabPage?"6-2":"2-1";if(typeof C!=="object"){return}x.status.push("creating offers");if(C.FEATURE_IP01&&C.FEATURE_IP01.length>0&&C.FEATURE_IP01[0].offers!="NO_OFFER"){f.FEATURE.offersReturned=C.FEATURE_IP01.length;if(f.FEATURE.appliedSetting=="1"){E=l(C.FEATURE_IP01[0])}else{if(f.FEATURE.appliedSetting=="2"){E='<div class="ibm-columns"><div class="ibm-col-'+D+'">'+l(C.FEATURE_IP01[0])+'</div><div class="ibm-col-'+D+'">'+l(C.FEATURE_IP01[1])+"</div></div>"}}dojo.query("#"+f.FEATURE.divId).html(E);x.status.push("feature zone offers on the glass")}if(C.BODY_IP01&&C.BODY_IP01.length>0&&C.BODY_IP01[0].offers!="NO_OFFER"){f.BODY.offersReturned=C.BODY_IP01.length;E="";dojo.forEach(C.BODY_IP01,function(G){G.appliedSetting=f.BODY.appliedSetting;E+=e(G)});E=m(E,f.BODY.appliedSetting);dojo.query("#"+f.BODY.divId).html('<div class="ibm-alternate-rule-2"><hr /></div>'+E);x.status.push("body zone offers on the glass")}if(C.BTOM_IP01&&C.BTOM_IP01.length>0&&C.BTOM_IP01[0].offers!="NO_OFFER"){f.BTOM.offersReturned=C.BTOM_IP01.length;E="";dojo.forEach(C.BTOM_IP01,function(G){E+='<div class="ibm-col-'+f.BTOM.appliedSetting+'-1">'+d(G)+"</div>"});dojo.query("#"+f.BTOM.divId).html('<div class="ibm-columns">'+E+"</div>");x.status.push("bottom zone offers on the glass")}dojo.forEach(["RNAV1","RNAV2","RNAV3"],function(G){B=G;G=G+"_IP01";E="";if(C[G]&&C[G].length>0&&C[G][0].offers!="NO_OFFER"){f[B].offersReturned=C[G].length;dojo.forEach(C[G],function(H){H.appliedSetting=f[B].appliedSetting;H.widthImg=f[B].widthImg;E+=e(H)});if(E!=""&&f[B].appliedSetting!="FE"){E='<div class="ibm-alternate-rule-2"><hr /></div>'+m(E,f[B].appliedSetting)}dojo.query("#"+f[B].divId).html(E);x.status.push(B+" zone offers on the glass")}});x.performance.createOffersRunTime=new Date().getTime()-F}function d(F){var E=F.offerTitle!=""?"<h2>"+F.offerTitle+"</h2>":"",D=F.offerDescription!=""&&F.offerDescription.length>3?"<p>"+F.offerDescription+"</p>":"",B=F.offerUrlClass!=undefined&&y[F.offerUrlClass]!=undefined?y[F.offerUrlClass]:"ibm-forward-link",G=v({item:F.offerUrlText,url:F.offerUrl,oc:F.offerCode,otc:F.trackingCode,odof:F.defaultOffersFlag,lc:B}),C='<p><img src="'+F.imageUrl+'" width="'+f.BTOM.widthImg+'" alt="'+F.imageDescription+'" /></p>'+E+D+'<p class="ibm-ind-link">'+G+"</p>";return C}function l(B){var C=v({item:'<img src="'+B.imageUrl+'" width="'+f.FEATURE.widthImg+'" alt="'+B.imageDescription+'" />',url:B.offerUrl,oc:B.offerCode,otc:B.trackingCode,odof:B.defaultOffersFlag,lc:""});return"<p>"+C+"</p>"}function e(B){var K=B.offerTitle,G=B.offerDescription!=""&&B.offerDescription.length>3?"<p>"+B.offerDescription+"</p>":"",D=B.offerUrlText,H=B.offerUrl,J=B.offerUrlClass!=undefined&&y[B.offerUrlClass]!=undefined?y[B.offerUrlClass]:"ibm-forward-link",L=B.imageUrl,E=B.imageDescription,I=B.widthImg,F="",C="";switch(B.appliedSetting){case"icon":F='<li class="ibm-link-description">'+v({item:K,url:H,oc:B.offerCode,otc:B.trackingCode,odof:B.defaultOffersFlag,lc:J})+G+"</li>";break;case"portrait":F="<li>"+v({item:'<img src="'+L+'" width="60" alt="'+E+'" />',url:H,oc:B.offerCode,otc:B.trackingCode,odof:B.defaultOffersFlag,lc:""})+"<h3>"+v({item:K,url:H,oc:B.offerCode,otc:B.trackingCode,odof:B.defaultOffersFlag,lc:""})+"</h3>"+G+"</li>";break;case"NV":F="";break;default:C='<p><img src="'+L+'" width="'+I+'" alt="'+E+'" /></p>'+G+'<p class="ibm-ind-link">'+v({item:D,url:H,oc:B.offerCode,otc:B.trackingCode,odof:B.defaultOffersFlag,lc:J})+"</p>";if(!w.isTabPage){F='<div class="ibm-container"><div class="ibm-container-body"><h2>'+K+"</h2>"+C+"</div></div>"}else{F='<h2 class="ibm-rule-alternate">'+K+"</h2>"+C}break}return F}function m(B,C){var D=C=="portrait"?"ibm-portrait-module-list":"ibm-link-list";return'<ul class="'+D+'">'+B+"</ul>"}function j(C,F){C=C.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");F=F!==undefined?F:window.location.href;var B="[\\?&]"+C+"=([^&#]*)",E=new RegExp(B,"i"),D=E.exec(F),G="";if(D!==null){G=D[1]}return G}function a(){z.sessionId=w.wsrOfferJson.info.sessionId;if(z.visitorId=="NV"){z.visitorId=dojo.cookie("webInteractVisitorId")}q();A()}function b(){var D=new Date().getTime(),B="",E,C=0;for(E in g){if(E!="isLoaded"){B=g[E];u(E,B)}}for(E in z){if(E!="isLoaded"){B=z[E];u(E,B)}}for(E in f){if(E!="isLoaded"){B=f[E].styleCode;if(B!="NV"){B+="-"+f[E].numOffers}u(f[E].wsrParamName,B)}}w.wsrOfferGetQueryString=w.wsrOfferGetQueryString.substr(1);x.status.push("offer request sent");C=new Date().getTime();dojo.io.script.get({url:w.wsrBase+w.wsrOfferGet+"?"+w.wsrOfferGetQueryString,handleAs:"json",callbackParamName:"callback",load:function(F){x.status.push("offers received");w.wsrOfferJson=F;x.performance.JsonDataResponseTime=new Date().getTime()-C;a();x.performance.overallRunTime=new Date().getTime()-s}});x.performance.requestOffersRunTime=new Date().getTime()-D}function k(){var B=new Date().getTime();g.pageCanonicalUrl=ibmweb.util.getUrl();g.pageCountry=ibmweb.meta.cc;g.pageLanguage=ibmweb.meta.lc;if(ibmweb.meta.ibm_industry!=undefined){g.pageIndustry=ibmweb.meta.ibm_industry.indexOf(",")>0?ibmweb.meta.ibm_industry.substr(0,ibmweb.meta.ibm_industry.indexOf(",")):ibmweb.meta.ibm_industry;if(g.pageIndustry.length>3){g.pageIndustry="NV"}}if(ibmweb.meta.ibm_wtmcategory!=undefined){g.pageSegment=ibmweb.meta.ibm_wtmcategory.indexOf(",")>0?ibmweb.meta.ibm_wtmcategory.substr(0,ibmweb.meta.ibm_wtmcategory.indexOf(",")):ibmweb.meta.ibm_wtmcategory}if(ibmweb.meta.dc_subject!=undefined){g.pageSubject=ibmweb.meta.dc_subject.indexOf(",")>0?ibmweb.meta.dc_subject.substr(0,ibmweb.meta.dc_subject.indexOf(",")):ibmweb.meta.dc_subject}g.isLoaded=true;x.performance.setPageDataRunTime=new Date().getTime()-B}function t(B){var C=dojo.query("div#"+B.divId).closest("div[class^='ibm-col-']").attr("class")[0];B.appliedSetting=B.userSetting=="feature"||B.userSetting=="portrait"||B.userSetting=="icon"?B.userSetting:B.defSetting;B.styleCode=h[B.appliedSetting];if(w.isTabPage&&B.appliedSetting=="feature"){if(C&&C.indexOf("col-6-1")<0&&C.indexOf("col-5-1")<0){B.appliedSetting="invalid";B.styleCode="NV"}}if(!w.isTabPage&&B.appliedSetting=="portrait"){B.appliedSetting="invalid";B.styleCode="NV"}if(B.appliedSetting=="feature"){B.styleCode=o(B.widthCol-20)}}function n(){var E=new Date().getTime(),D=document.referrer,C="",B="";if(D!=""){C=D.substr(D.indexOf("//")+2);B=D.indexOf("q=")>0?"q":D.indexOf("q1=")>0?"q1":"";C=C.substr(0,C.indexOf("/"));C=C.substr(0,C.lastIndexOf("."));C=C.substr(C.lastIndexOf(".")+1);z.visitorReferral=C;if(B!=""){z.visitorSearch=j(B,D)}}if(!w.isIE){z.visitorLanguage=navigator.language.indexOf("-")>-1?navigator.language.substr(0,navigator.language.indexOf("-")):navigator.language}else{z.visitorLanguage=navigator.userLanguage.indexOf("-")>-1?navigator.userLanguage.substr(0,navigator.userLanguage.indexOf("-")):navigator.userLanguage}if(dojo.cookie("UnicaNIODID")!==undefined){z.unicaNiodId=dojo.cookie("UnicaNIODID");z.isLoaded=true;x.performance.setVisitorDataRunTime=new Date().getTime()-E}else{ibmweb.queue.push(function(){return dojo.cookie("UnicaNIODID")!==undefined},function(){z.unicaNiodId=dojo.cookie("UnicaNIODID");z.isLoaded=true;x.performance.setVisitorDataRunTime=new Date().getTime()-E})}}function i(){var E=new Date().getTime(),D=(typeof unicaInteract==="object"&&typeof unicaInteract.config==="object"),C=false,F={},B;for(B in f){F=f[B];if(dojo.query("div#"+F.divId).length==1){C=true;F.exists=true;F.widthCol=dojo.query("div#"+F.divId).position()[0].w;if(D&&unicaInteract.config[F.configName]!==undefined&&unicaInteract.config[F.configName].style!==undefined){F.userSetting=unicaInteract.config[F.configName].style}if(D&&unicaInteract.config[F.configName]!==undefined&&unicaInteract.config[F.configName].offers!==undefined){if(unicaInteract.config[F.configName].offers<=F.numOffersMax){F.numOffers=unicaInteract.config[F.configName].offers}}switch(B){case"FEATURE":F.appliedSetting=F.defSetting;F.widthImg=w.isTabPage?"620":"556";F.numOffers=1;if(F.userSetting=="2"){F.appliedSetting=F.userSetting;F.widthImg=((F.widthImg/2)-10);F.numOffers=1}F.styleCode=o(F.widthImg);break;case"BODY":F.appliedSetting=F.userSetting=="icon"?F.userSetting:F.defSetting;F.styleCode=h[F.appliedSetting];break;case"BTOM":F.widthImg=140;F.appliedSetting=F.defSetting;if(F.userSetting=="5"){F.widthImg=172;F.appliedSetting=F.userSetting;if(F.numOffers>5){F.numOffers=5}}F.styleCode=o(F.widthImg);break;case"RNAV1":t(F);break;case"RNAV2":t(F);break;case"RNAV3":t(F);break;default:break}}}x.performance.setZoneDataRunTime=new Date().getTime()-E;if(!C){x.status.push("No zones on this page");return}f.isLoaded=true}n();dojo.ready(function(){if(dojo.query("div#ibm-top.ibm-landing-page").length==0){w.isTabPage=false}x.performance.onloadSetZoneDelayTime=new Date().getTime()-s;i()});ibmweb.queue.push(function(){return ibmweb.meta.isLoaded},function(){k()});var r=new Date().getTime(),c=ibmweb.queue.push(function(){return g.isLoaded==true&&z.isLoaded==true&&f.isLoaded==true},function(){x.performance.requestOffersQueueDelay=new Date().getTime()-r;b()});x.status.push("Setting page data timeout");setTimeout("ibmweb.queue.remove("+c+")",4000);x.status.push("File executed completely");return{info:x}})();
