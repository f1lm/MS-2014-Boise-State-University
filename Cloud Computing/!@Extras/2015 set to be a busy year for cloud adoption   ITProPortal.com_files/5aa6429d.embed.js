var dateFormat=function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,b=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,c=/[^-+\dA-Z]/g,d=function(a,b){for(a=String(a),b=b||2;a.length<b;)a="0"+a;return a};return function(e,f,g){var h=dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(e)||/\d/.test(e)||(f=e,e=void 0),e=e?new Date(e):new Date,isNaN(e))throw SyntaxError("invalid date");f=String(h.masks[f]||f||h.masks["default"]),"UTC:"==f.slice(0,4)&&(f=f.slice(4),g=!0);var i=g?"getUTC":"get",j=e[i+"Date"](),k=e[i+"Day"](),l=e[i+"Month"](),m=e[i+"FullYear"](),n=e[i+"Hours"](),o=e[i+"Minutes"](),p=e[i+"Seconds"](),q=e[i+"Milliseconds"](),r=g?0:e.getTimezoneOffset(),s={d:j,dd:d(j),ddd:h.i18n.dayNames[k],dddd:h.i18n.dayNames[k+7],m:l+1,mm:d(l+1),mmm:h.i18n.monthNames[l],mmmm:h.i18n.monthNames[l+12],yy:String(m).slice(2),yyyy:m,h:n%12||12,hh:d(n%12||12),H:n,HH:d(n),M:o,MM:d(o),s:p,ss:d(p),l:d(q,3),L:d(q>99?Math.round(q/10):q),t:12>n?"a":"p",tt:12>n?"am":"pm",T:12>n?"A":"P",TT:12>n?"AM":"PM",Z:g?"UTC":(String(e).match(b)||[""]).pop().replace(c,""),o:(r>0?"-":"+")+d(100*Math.floor(Math.abs(r)/60)+Math.abs(r)%60,4),S:["th","st","nd","rd"][j%10>3?0:(j%100-j%10!=10)*j%10]};return f.replace(a,function(a){return a in s?s[a]:a.slice(1,a.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},function(a){function b(b){var c=b||window.event,d=[].slice.call(arguments,1),e=0,f=0,g=0;return b=a.event.fix(c),b.type="mousewheel",c.wheelDelta&&(e=c.wheelDelta/120),c.detail&&(e=-c.detail/3),g=e,void 0!==c.axis&&c.axis===c.HORIZONTAL_AXIS&&(g=0,f=-1*e),void 0!==c.wheelDeltaY&&(g=c.wheelDeltaY/120),void 0!==c.wheelDeltaX&&(f=-1*c.wheelDeltaX/120),d.unshift(b,e,f,g),(a.event.dispatch||a.event.handle).apply(this,d)}var c=["DOMMouseScroll","mousewheel"];if(a.event.fixHooks)for(var d=c.length;d;)a.event.fixHooks[c[--d]]=a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=c.length;a;)this.addEventListener(c[--a],b,!1);else this.onmousewheel=b},teardown:function(){if(this.removeEventListener)for(var a=c.length;a;)this.removeEventListener(c[--a],b,!1);else this.onmousewheel=null}},a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}(jQuery),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){var b={wheelSpeed:navigator.platform.toUpperCase().indexOf("MAC")>=0?10:100,wheelPropagation:!1,minScrollbarLength:null,useBothWheelAxes:!1,useKeyboard:!0,suppressScrollX:!1,suppressScrollY:!1,scrollXMarginOffset:0,scrollYMarginOffset:0,readyCallback:function(){}};a.fn.perfectScrollbar=function(c){var d=this.each(function(){var d=a.extend(!0,{},b),e=a(this);if("object"==typeof c&&a.extend(!0,d,c),e.data("perfect-scrollbar-api"))return e;e.addClass("ps-container");var f,g,h,i,j,k,l,m,n,o,p=a("<div class='ps-scrollbar-x-rail'></div>").appendTo(e),q=a("<div class='ps-scrollbar-y-rail'></div>").appendTo(e),r=a("<div class='ps-scrollbar-x'></div>").appendTo(p),s=a("<div class='ps-scrollbar-y'></div>").appendTo(q),t=parseInt(p.css("bottom"),10),u=parseInt(q.css("right"),10),v=function(){var a=parseInt(o*(k-i)/(i-n),10);e.scrollTop(a),p.css({bottom:t-a})},w=function(){var a=parseInt(m*(j-h)/(h-l),10);e.scrollLeft(a),q.css({right:u-a})},x=function(a){return d.minScrollbarLength&&(a=Math.max(a,d.minScrollbarLength)),a},y=function(){p.css({left:e.scrollLeft(),bottom:t-e.scrollTop(),width:h,display:d.suppressScrollX?"none":"inherit"}),q.css({top:e.scrollTop(),right:u-e.scrollLeft(),height:i,display:d.suppressScrollY?"none":"inherit"}),r.css({left:m,width:l}),s.css({top:o,height:n})},z=function(){var a=e.children(":not(.ps-scrollbar-x, .ps-scrollbar-y, .ps-scrollbar-y-rail, .ps-scrollbar-x-rail):last");if(a.length){var b=a.position().top+a.height(),c=e.height();if(c>b){var p=c-b,q=e.scrollTop();q-p>0&&e.scrollTop(q-p)}}h=e.width(),i=e.height(),j=e.prop("scrollWidth"),k=e.prop("scrollHeight"),!d.suppressScrollX&&h+d.scrollXMarginOffset<j?(f=!0,l=x(parseInt(h*h/j,10)),m=parseInt(e.scrollLeft()*(h-l)/(j-h),10)):(f=!1,l=0,m=0,e.scrollLeft(0)),!d.suppressScrollY&&i+d.scrollYMarginOffset<k?(g=!0,n=x(parseInt(i*i/k,10)),o=parseInt(e.scrollTop()*(i-n)/(k-i),10)):(g=!1,n=0,o=0,e.scrollTop(0)),o>=i-n&&(o=i-n),m>=h-l&&(m=h-l),y()},A=function(a,b){var c=a+b,d=h-l;m=0>c?0:c>d?d:c,p.css({left:e.scrollLeft()}),r.css({left:m})},B=function(a,b){var c=a+b,d=i-n;o=0>c?0:c>d?d:c,q.css({top:e.scrollTop()}),s.css({top:o})},C=function(){var b,c;r.bind("mousedown.perfect-scrollbar",function(a){c=a.pageX,b=r.position().left,p.addClass("in-scrolling"),a.stopPropagation(),a.preventDefault()}),a(document).bind("mousemove.perfect-scrollbar",function(a){p.hasClass("in-scrolling")&&(w(),A(b,a.pageX-c),a.stopPropagation(),a.preventDefault())}),a(document).bind("mouseup.perfect-scrollbar",function(){p.hasClass("in-scrolling")&&p.removeClass("in-scrolling")}),b=c=null},D=function(){var b,c;s.bind("mousedown.perfect-scrollbar",function(a){c=a.pageY,b=s.position().top,q.addClass("in-scrolling"),a.stopPropagation(),a.preventDefault()}),a(document).bind("mousemove.perfect-scrollbar",function(a){q.hasClass("in-scrolling")&&(v(),B(b,a.pageY-c),a.stopPropagation(),a.preventDefault())}),a(document).bind("mouseup.perfect-scrollbar",function(){q.hasClass("in-scrolling")&&q.removeClass("in-scrolling")}),b=c=null},E=function(a,b){var c=e.scrollTop();if(0===a){if(!g)return!1;if(0===c&&b>0||c>=k-i&&0>b)return!d.wheelPropagation}var l=e.scrollLeft();if(0===b){if(!f)return!1;if(0===l&&0>a||l>=j-h&&a>0)return!d.wheelPropagation}return!0},F=function(){var a=!1;e.bind("mousewheel.perfect-scrollbar",function(b,c,h,i){d.useBothWheelAxes?g&&!f?e.scrollTop(i?e.scrollTop()-i*d.wheelSpeed:e.scrollTop()+h*d.wheelSpeed):f&&!g&&e.scrollLeft(h?e.scrollLeft()+h*d.wheelSpeed:e.scrollLeft()-i*d.wheelSpeed):(e.scrollTop(e.scrollTop()-i*d.wheelSpeed),e.scrollLeft(e.scrollLeft()+h*d.wheelSpeed)),z(),a=E(h,i),a&&b.preventDefault()}),e.bind("MozMousePixelScroll.perfect-scrollbar",function(b){a&&b.preventDefault()})},G=function(){var b=!1;e.bind("mouseenter.perfect-scrollbar",function(){b=!0}),e.bind("mouseleave.perfect-scrollbar",function(){b=!1});var c=!1;a(document).bind("keydown.perfect-scrollbar",function(a){if(b){var f=0,g=0;switch(a.which){case 37:f=-3;break;case 38:g=3;break;case 39:f=3;break;case 40:g=-3;break;default:return}e.scrollTop(e.scrollTop()-g*d.wheelSpeed),e.scrollLeft(e.scrollLeft()+f*d.wheelSpeed),z(),c=E(f,g),c&&a.preventDefault()}})},H=function(){var a=function(a){a.stopPropagation()};s.bind("click.perfect-scrollbar",a),q.bind("click.perfect-scrollbar",function(a){var b=parseInt(n/2,10),c=a.pageY-q.offset().top-b,d=i-n,f=c/d;0>f?f=0:f>1&&(f=1),e.scrollTop((k-i)*f),z()}),r.bind("click.perfect-scrollbar",a),p.bind("click.perfect-scrollbar",function(a){var b=parseInt(l/2,10),c=a.pageX-p.offset().left-b,d=h-l,f=c/d;0>f?f=0:f>1&&(f=1),e.scrollLeft((j-h)*f),z()})},I=function(){var b=function(a,b){e.scrollTop(e.scrollTop()-b),e.scrollLeft(e.scrollLeft()-a),z()},c={},d=0,f={},g=null,h=!1;a(window).bind("touchstart.perfect-scrollbar",function(){h=!0}),a(window).bind("touchend.perfect-scrollbar",function(){h=!1}),e.bind("touchstart.perfect-scrollbar",function(a){var b=a.originalEvent.targetTouches[0];c.pageX=b.pageX,c.pageY=b.pageY,d=(new Date).getTime(),null!==g&&clearInterval(g),a.stopPropagation()}),e.bind("touchmove.perfect-scrollbar",function(a){if(!h&&1===a.originalEvent.targetTouches.length){var e=a.originalEvent.targetTouches[0],g={};g.pageX=e.pageX,g.pageY=e.pageY;var i=g.pageX-c.pageX,j=g.pageY-c.pageY;b(i,j),c=g;var k=(new Date).getTime();f.x=i/(k-d),f.y=j/(k-d),d=k,a.preventDefault()}}),e.bind("touchend.perfect-scrollbar",function(){clearInterval(g),g=setInterval(function(){return Math.abs(f.x)<.01&&Math.abs(f.y)<.01?void clearInterval(g):(b(30*f.x,30*f.y),f.x*=.8,void(f.y*=.8))},10)})},J=function(){e.unbind(".perfect-scrollbar"),a(window).unbind(".perfect-scrollbar"),a(document).unbind(".perfect-scrollbar"),e.data("perfect-scrollbar-api",null),r.remove(),s.remove(),p.remove(),q.remove(),r=s=h=i=j=k=l=m=t=n=o=u=null},K=function(b){e.addClass("ie").addClass("ie"+b);var c=function(){var b=function(){a(this).addClass("hover")},c=function(){a(this).removeClass("hover")};e.bind("mouseenter.perfect-scrollbar",b).bind("mouseleave.perfect-scrollbar",c),p.bind("mouseenter.perfect-scrollbar",b).bind("mouseleave.perfect-scrollbar",c),q.bind("mouseenter.perfect-scrollbar",b).bind("mouseleave.perfect-scrollbar",c),r.bind("mouseenter.perfect-scrollbar",b).bind("mouseleave.perfect-scrollbar",c),s.bind("mouseenter.perfect-scrollbar",b).bind("mouseleave.perfect-scrollbar",c)},d=function(){y=function(){r.css({left:m+e.scrollLeft(),bottom:t,width:l}),s.css({top:o+e.scrollTop(),right:u,height:n}),r.hide().show(),s.hide().show()},v=function(){var a=parseInt(o*k/i,10);e.scrollTop(a),r.css({bottom:t}),r.hide().show()},w=function(){var a=parseInt(m*j/h,10);e.scrollLeft(a),s.hide().show()}};6===b&&(c(),d())},L="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,M=function(a){a||(a=0),o=q.height()-s.height()-a,v(),y()},N=function(){return g},O=function(){return f},P=function(){var a=navigator.userAgent.toLowerCase().match(/(msie) ([\w.]+)/);a&&"msie"===a[1]&&K(parseInt(a[2],10)),z(),C(),D(),H(),L&&I(),e.mousewheel&&F(),d.useKeyboard&&G();var b={update:z,destroy:J,scrollBottom:M,isXActive:O,isYActive:N};e.data("perfect-scrollbar-api",b),d.readyCallback(b)};return P(),e});return d}}),function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){"use strict";var b={wheelSpeed:100,wheelPropagation:!1,minScrollbarLength:null,maxScrollbarLength:null,useBothWheelAxes:!1,useKeyboard:!0,suppressScrollX:!1,suppressScrollY:!1,scrollXMarginOffset:0,scrollYMarginOffset:0,includePadding:!1},c=function(){var a=0;return function(){var b=a;return a+=1,".perfect-scrollbar-"+b}}();a.fn.perfectScrollbar2=function(d,e){return this.each(function(){var f=a.extend(!0,{},b),g=a(this);if("object"==typeof d?a.extend(!0,f,d):e=d,"update"===e)return g.data("perfect-scrollbar-update")&&g.data("perfect-scrollbar-update")(),g;if("destroy"===e)return g.data("perfect-scrollbar-destroy")&&g.data("perfect-scrollbar-destroy")(),g;if(g.data("perfect-scrollbar"))return g.data("perfect-scrollbar");g.addClass("ps-container");var h,i,j,k,l,m,n,o,p,q,r=a("<div class='ps-scrollbar-x-rail'></div>").appendTo(g),s=a("<div class='ps-scrollbar-y-rail'></div>").appendTo(g),t=a("<div class='ps-scrollbar-x'></div>").appendTo(r),u=a("<div class='ps-scrollbar-y'></div>").appendTo(s),v=parseInt(r.css("bottom"),10),w=v===v,x=w?null:parseInt(r.css("top"),10),y=parseInt(s.css("right"),10),z=y===y,A=z?null:parseInt(s.css("left"),10),B="rtl"===g.css("direction"),C=c(),D=(parseInt(r.css("borderLeftWidth"),10)||0)+(parseInt(r.css("borderRightWidth"),10)||0),E=(parseInt(r.css("borderTopWidth"),10)||0)+(parseInt(r.css("borderBottomWidth"),10)||0),F=function(a,b){var c=a+b,d=k-p;q=0>c?0:c>d?d:c;var e=parseInt(q*(m-k)/(k-p),10);g.scrollTop(e),r.css(w?{bottom:v-e}:{top:x+e})},G=function(a,b){var c=a+b,d=j-n;o=0>c?0:c>d?d:c;var e=parseInt(o*(l-j)/(j-n),10);g.scrollLeft(e),s.css(z?{right:y-e}:{left:A+e})},H=function(a){return f.minScrollbarLength&&(a=Math.max(a,f.minScrollbarLength)),f.maxScrollbarLength&&(a=Math.min(a,f.maxScrollbarLength)),a},I=function(){var a={width:j,display:h?"inherit":"none"};a.left=B?g.scrollLeft()+j-l:g.scrollLeft(),w?a.bottom=v-g.scrollTop():a.top=x+g.scrollTop(),r.css(a);var b={top:g.scrollTop(),height:k,display:i?"inherit":"none"};z?b.right=B?l-g.scrollLeft()-y-u.outerWidth():y-g.scrollLeft():b.left=B?g.scrollLeft()+2*j-l-A-u.outerWidth():A+g.scrollLeft(),s.css(b),t.css({left:o,width:n-D}),u.css({top:q,height:p-E}),h?g.addClass("ps-active-x"):g.removeClass("ps-active-x"),i?g.addClass("ps-active-y"):g.removeClass("ps-active-y")},J=function(){j=f.includePadding?g.innerWidth():g.width(),k=f.includePadding?g.innerHeight():g.height(),l=g.prop("scrollWidth"),m=g.prop("scrollHeight"),!f.suppressScrollX&&j+f.scrollXMarginOffset<l?(h=!0,n=H(parseInt(j*j/l,10)),o=parseInt(g.scrollLeft()*(j-n)/(l-j),10)):(h=!1,n=0,o=0,g.scrollLeft(0)),!f.suppressScrollY&&k+f.scrollYMarginOffset<m?(i=!0,p=H(parseInt(k*k/m,10)),q=parseInt(g.scrollTop()*(k-p)/(m-k),10)):(i=!1,p=0,q=0,g.scrollTop(0)),q>=k-p&&(q=k-p),o>=j-n&&(o=j-n),I()},K=function(){var b,c;t.bind("mousedown"+C,function(a){c=a.pageX,b=t.position().left,r.addClass("in-scrolling"),a.stopPropagation(),a.preventDefault()}),a(document).bind("mousemove"+C,function(a){r.hasClass("in-scrolling")&&(G(b,a.pageX-c),a.stopPropagation(),a.preventDefault())}),a(document).bind("mouseup"+C,function(){r.hasClass("in-scrolling")&&r.removeClass("in-scrolling")}),b=c=null},L=function(){var b,c;u.bind("mousedown"+C,function(a){c=a.pageY,b=u.position().top,s.addClass("in-scrolling"),a.stopPropagation(),a.preventDefault()}),a(document).bind("mousemove"+C,function(a){s.hasClass("in-scrolling")&&(F(b,a.pageY-c),a.stopPropagation(),a.preventDefault())}),a(document).bind("mouseup"+C,function(){s.hasClass("in-scrolling")&&s.removeClass("in-scrolling")}),b=c=null},M=function(a,b){var c=g.scrollTop();if(0===a){if(!i)return!1;if(0===c&&b>0||c>=m-k&&0>b)return!f.wheelPropagation}var d=g.scrollLeft();if(0===b){if(!h)return!1;if(0===d&&0>a||d>=l-j&&a>0)return!f.wheelPropagation}return!0},N=function(){f.wheelSpeed/=10;var a=!1;g.bind("mousewheel"+C,function(b,c,d,e){var j=b.deltaX*b.deltaFactor||d,k=b.deltaY*b.deltaFactor||e;a=!1,f.useBothWheelAxes?i&&!h?(g.scrollTop(k?g.scrollTop()-k*f.wheelSpeed:g.scrollTop()+j*f.wheelSpeed),a=!0):h&&!i&&(g.scrollLeft(j?g.scrollLeft()+j*f.wheelSpeed:g.scrollLeft()-k*f.wheelSpeed),a=!0):(g.scrollTop(g.scrollTop()-k*f.wheelSpeed),g.scrollLeft(g.scrollLeft()+j*f.wheelSpeed)),J(),a=a||M(j,k),a&&(b.stopPropagation(),b.preventDefault())}),g.bind("MozMousePixelScroll"+C,function(b){a&&b.preventDefault()})},O=function(){var b=!1;g.bind("mouseenter"+C,function(){b=!0}),g.bind("mouseleave"+C,function(){b=!1});var c=!1;a(document).bind("keydown"+C,function(d){if(!(d.isDefaultPrevented&&d.isDefaultPrevented()||!b||a(document.activeElement).is(":input,[contenteditable]"))){var e=0,f=0;switch(d.which){case 37:e=-30;break;case 38:f=30;break;case 39:e=30;break;case 40:f=-30;break;case 33:f=90;break;case 32:case 34:f=-90;break;case 35:f=-k;break;case 36:f=k;break;default:return}g.scrollTop(g.scrollTop()-f),g.scrollLeft(g.scrollLeft()+e),c=M(e,f),c&&d.preventDefault()}})},P=function(){var a=function(a){a.stopPropagation()};u.bind("click"+C,a),s.bind("click"+C,function(a){var b=parseInt(p/2,10),c=a.pageY-s.offset().top-b,d=k-p,e=c/d;0>e?e=0:e>1&&(e=1),g.scrollTop((m-k)*e)}),t.bind("click"+C,a),r.bind("click"+C,function(a){var b=parseInt(n/2,10),c=a.pageX-r.offset().left-b,d=j-n,e=c/d;0>e?e=0:e>1&&(e=1),g.scrollLeft((l-j)*e)})},Q=function(){var b=function(a,b){g.scrollTop(g.scrollTop()-b),g.scrollLeft(g.scrollLeft()-a),J()},c={},d=0,e={},f=null,h=!1;a(window).bind("touchstart"+C,function(){h=!0}),a(window).bind("touchend"+C,function(){h=!1}),g.bind("touchstart"+C,function(a){var b=a.originalEvent.targetTouches[0];c.pageX=b.pageX,c.pageY=b.pageY,d=(new Date).getTime(),null!==f&&clearInterval(f),a.stopPropagation()}),g.bind("touchmove"+C,function(a){if(!h&&1===a.originalEvent.targetTouches.length){var f=a.originalEvent.targetTouches[0],g={};g.pageX=f.pageX,g.pageY=f.pageY;var i=g.pageX-c.pageX,j=g.pageY-c.pageY;b(i,j),c=g;var k=(new Date).getTime(),l=k-d;l>0&&(e.x=i/l,e.y=j/l,d=k),a.preventDefault()}}),g.bind("touchend"+C,function(){clearInterval(f),f=setInterval(function(){return Math.abs(e.x)<.01&&Math.abs(e.y)<.01?void clearInterval(f):(b(30*e.x,30*e.y),e.x*=.8,void(e.y*=.8))},10)})},R=function(){g.bind("scroll"+C,function(){J()})},S=function(){g.unbind(C),a(window).unbind(C),a(document).unbind(C),g.data("perfect-scrollbar",null),g.data("perfect-scrollbar-update",null),g.data("perfect-scrollbar-destroy",null),t.remove(),u.remove(),r.remove(),s.remove(),r=s=t=u=h=i=j=k=l=m=n=o=v=w=x=p=q=y=z=A=B=C=null},T=function(b){g.addClass("ie").addClass("ie"+b);var c=function(){var b=function(){a(this).addClass("hover")},c=function(){a(this).removeClass("hover")};g.bind("mouseenter"+C,b).bind("mouseleave"+C,c),r.bind("mouseenter"+C,b).bind("mouseleave"+C,c),s.bind("mouseenter"+C,b).bind("mouseleave"+C,c),t.bind("mouseenter"+C,b).bind("mouseleave"+C,c),u.bind("mouseenter"+C,b).bind("mouseleave"+C,c)},d=function(){I=function(){var a={left:o+g.scrollLeft(),width:n};w?a.bottom=v:a.top=x,t.css(a);var b={top:q+g.scrollTop(),height:p};z?b.right=y:b.left=A,u.css(b),t.hide().show(),u.hide().show()}};6===b&&(c(),d())},U="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,V=function(){var a=navigator.userAgent.toLowerCase().match(/(msie) ([\w.]+)/);a&&"msie"===a[1]&&T(parseInt(a[2],10)),J(),R(),K(),L(),P(),U&&Q(),g.mousewheel&&N(),f.useKeyboard&&O(),g.data("perfect-scrollbar",g),g.data("perfect-scrollbar-update",J),g.data("perfect-scrollbar-destroy",S)};return V(),g})}}),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){function b(a){return h.raw?a:encodeURIComponent(a)}function c(a){return h.raw?a:decodeURIComponent(a)}function d(a){return b(h.json?JSON.stringify(a):String(a))}function e(a){0===a.indexOf('"')&&(a=a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return a=decodeURIComponent(a.replace(g," ")),h.json?JSON.parse(a):a}catch(b){}}function f(b,c){var d=h.raw?b:e(b);return a.isFunction(c)?c(d):d}var g=/\+/g,h=a.cookie=function(e,g,i){if(void 0!==g&&!a.isFunction(g)){if(i=a.extend({},h.defaults,i),"number"==typeof i.expires){var j=i.expires,k=i.expires=new Date;k.setTime(+k+864e5*j)}return document.cookie=[b(e),"=",d(g),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}for(var l=e?void 0:{},m=document.cookie?document.cookie.split("; "):[],n=0,o=m.length;o>n;n++){var p=m[n].split("="),q=c(p.shift()),r=p.join("=");if(e&&e===q){l=f(r,g);break}e||void 0===(r=f(r))||(l[q]=r)}return l};h.defaults={},a.removeCookie=function(b,c){return void 0===a.cookie(b)?!1:(a.cookie(b,"",a.extend({},c,{expires:-1})),!a.cookie(b))}}),function(){function a(c,d){b(c),d=d||{};var e=this;this.key=c,this.config=a.Util.extend(a.getGlobalConfig(),d.cluster?a.getClusterConfig(d.cluster):{},d),this.channels=new a.Channels,this.global_emitter=new a.EventsDispatcher,this.sessionID=Math.floor(1e9*Math.random()),this.timeline=new a.Timeline(this.key,this.sessionID,{cluster:this.config.cluster,features:a.Util.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:a.Timeline.INFO,version:a.VERSION}),this.config.disableStats||(this.timelineSender=new a.TimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/jsonp"}));var f=function(b){var c=a.Util.extend({},e.config,b);return a.StrategyBuilder.build(a.getDefaultStrategy(c),c)};this.connection=new a.ConnectionManager(this.key,a.Util.extend({getStrategy:f,timeline:this.timeline,activityTimeout:this.config.activity_timeout,pongTimeout:this.config.pong_timeout,unavailableTimeout:this.config.unavailable_timeout},this.config,{encrypted:this.isEncrypted()})),this.connection.bind("connected",function(){e.subscribeAll(),e.timelineSender&&e.timelineSender.send(e.connection.isEncrypted())}),this.connection.bind("message",function(a){var b=0===a.event.indexOf("pusher_internal:");if(a.channel){var c=e.channel(a.channel);c&&c.handleEvent(a.event,a.data)}b||e.global_emitter.emit(a.event,a.data)}),this.connection.bind("disconnected",function(){e.channels.disconnect()}),this.connection.bind("error",function(b){a.warn("Error",b)}),a.instances.push(this),this.timeline.info({instances:a.instances.length}),a.isReady&&e.connect()}function b(b){(null===b||void 0===b)&&a.warn("Warning","You must pass your app key when you instantiate Pusher.")}var c=a.prototype;a.instances=[],a.isReady=!1,a.debug=function(){a.log&&a.log(a.Util.stringify.apply(this,arguments))},a.warn=function(){var b=a.Util.stringify.apply(this,arguments);window.console&&(window.console.warn?window.console.warn(b):window.console.log&&window.console.log(b)),a.log&&a.log(b)},a.ready=function(){a.isReady=!0;for(var b=0,c=a.instances.length;c>b;b++)a.instances[b].connect()},c.channel=function(a){return this.channels.find(a)},c.allChannels=function(){return this.channels.all()},c.connect=function(){if(this.connection.connect(),this.timelineSender&&!this.timelineSenderTimer){var b=this.connection.isEncrypted(),c=this.timelineSender;this.timelineSenderTimer=new a.PeriodicTimer(6e4,function(){c.send(b)})}},c.disconnect=function(){this.connection.disconnect(),this.timelineSenderTimer&&(this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null)},c.bind=function(a,b){return this.global_emitter.bind(a,b),this},c.bind_all=function(a){return this.global_emitter.bind_all(a),this},c.subscribeAll=function(){var a;for(a in this.channels.channels)this.channels.channels.hasOwnProperty(a)&&this.subscribe(a)},c.subscribe=function(a){var b=this.channels.add(a,this);return"connected"===this.connection.state&&b.subscribe(),b},c.unsubscribe=function(a){var b=this.channels.remove(a);"connected"===this.connection.state&&b.unsubscribe()},c.send_event=function(a,b,c){return this.connection.send_event(a,b,c)},c.isEncrypted=function(){return"https:"===a.Util.getDocument().location.protocol?!0:Boolean(this.config.encrypted)},a.HTTP={},this.Pusher=a}.call(this),function(){function a(a){window.clearTimeout(a)}function b(a){window.clearInterval(a)}function c(a,b,c,d){var e=this;this.clear=b,this.timer=a(function(){null!==e.timer&&(e.timer=d(e.timer))},c)}var d=c.prototype;d.isRunning=function(){return null!==this.timer},d.ensureAborted=function(){this.timer&&(this.clear(this.timer),this.timer=null)},Pusher.Timer=function(b,d){return new c(setTimeout,a,b,function(){return d(),null})},Pusher.PeriodicTimer=function(a,d){return new c(setInterval,b,a,function(a){return d(),a})}}.call(this),function(){Pusher.Util={now:function(){return Date.now?Date.now():(new Date).valueOf()},defer:function(a){return new Pusher.Timer(0,a)},extend:function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)a[d]=c[d]&&c[d].constructor&&c[d].constructor===Object?Pusher.Util.extend(a[d]||{},c[d]):c[d]}return a},stringify:function(){for(var a=["Pusher"],b=0;b<arguments.length;b++)a.push("string"==typeof arguments[b]?arguments[b]:void 0===window.JSON?arguments[b].toString():JSON.stringify(arguments[b]));return a.join(" : ")},arrayIndexOf:function(a,b){var c=Array.prototype.indexOf;if(null===a)return-1;if(c&&a.indexOf===c)return a.indexOf(b);for(var d=0,e=a.length;e>d;d++)if(a[d]===b)return d;return-1},objectApply:function(a,b){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b(a[c],c,a)},keys:function(a){var b=[];return Pusher.Util.objectApply(a,function(a,c){b.push(c)}),b},values:function(a){var b=[];return Pusher.Util.objectApply(a,function(a){b.push(a)}),b},apply:function(a,b,c){for(var d=0;d<a.length;d++)b.call(c||window,a[d],d,a)},map:function(a,b){for(var c=[],d=0;d<a.length;d++)c.push(b(a[d],d,a,c));return c},mapObject:function(a,b){var c={};return Pusher.Util.objectApply(a,function(a,d){c[d]=b(a)}),c},filter:function(a,b){b=b||function(a){return!!a};for(var c=[],d=0;d<a.length;d++)b(a[d],d,a,c)&&c.push(a[d]);return c},filterObject:function(a,b){var c={};return Pusher.Util.objectApply(a,function(d,e){(b&&b(d,e,a,c)||Boolean(d))&&(c[e]=d)}),c},flatten:function(a){var b=[];return Pusher.Util.objectApply(a,function(a,c){b.push([c,a])}),b},any:function(a,b){for(var c=0;c<a.length;c++)if(b(a[c],c,a))return!0;return!1},all:function(a,b){for(var c=0;c<a.length;c++)if(!b(a[c],c,a))return!1;return!0},method:function(a){var b=Array.prototype.slice.call(arguments,1);return function(c){return c[a].apply(c,b.concat(arguments))}},getWindow:function(){return window},getDocument:function(){return document},getNavigator:function(){return navigator},getLocalStorage:function(){try{return window.localStorage}catch(a){return void 0}},getClientFeatures:function(){return Pusher.Util.keys(Pusher.Util.filterObject({ws:Pusher.WSTransport,flash:Pusher.FlashTransport},function(a){return a.isSupported({})}))},addWindowListener:function(a,b){var c=Pusher.Util.getWindow();void 0!==c.addEventListener?c.addEventListener(a,b,!1):c.attachEvent("on"+a,b)},removeWindowListener:function(a,b){var c=Pusher.Util.getWindow();void 0!==c.addEventListener?c.removeEventListener(a,b,!1):c.detachEvent("on"+a,b)},isXHRSupported:function(){var a=window.XMLHttpRequest;return Boolean(a)&&void 0!==(new a).withCredentials},isXDRSupported:function(a){var b=a?"https:":"http:",c=Pusher.Util.getDocument().location.protocol;return Boolean(window.XDomainRequest)&&c===b}}}.call(this),function(){Pusher.VERSION="2.2.0",Pusher.PROTOCOL=7,Pusher.host="ws.pusherapp.com",Pusher.ws_port=80,Pusher.wss_port=443,Pusher.sockjs_host="sockjs.pusher.com",Pusher.sockjs_http_port=80,Pusher.sockjs_https_port=443,Pusher.sockjs_path="/pusher",Pusher.stats_host="stats.pusher.com",Pusher.channel_auth_endpoint="/pusher/auth",Pusher.channel_auth_transport="ajax",Pusher.activity_timeout=12e4,Pusher.pong_timeout=3e4,Pusher.unavailable_timeout=1e4,Pusher.cdn_http="http://js.pusher.com/",Pusher.cdn_https="https://d3dy5gmtp8yhk7.cloudfront.net/",Pusher.dependency_suffix="",Pusher.getDefaultStrategy=function(a){var b;return b=a.encrypted?[":best_connected_ever",":ws_loop",[":delayed",2e3,[":http_fallback_loop"]]]:[":best_connected_ever",":ws_loop",[":delayed",2e3,[":wss_loop"]],[":delayed",5e3,[":http_fallback_loop"]]],[[":def","ws_options",{hostUnencrypted:a.wsHost+":"+a.wsPort,hostEncrypted:a.wsHost+":"+a.wssPort}],[":def","wss_options",[":extend",":ws_options",{encrypted:!0}]],[":def","sockjs_options",{hostUnencrypted:a.httpHost+":"+a.httpPort,hostEncrypted:a.httpHost+":"+a.httpsPort}],[":def","timeouts",{loop:!0,timeout:15e3,timeoutLimit:6e4}],[":def","ws_manager",[":transport_manager",{lives:2,minPingDelay:1e4,maxPingDelay:a.activity_timeout}]],[":def","streaming_manager",[":transport_manager",{lives:2,minPingDelay:1e4,maxPingDelay:a.activity_timeout}]],[":def_transport","ws","ws",3,":ws_options",":ws_manager"],[":def_transport","wss","ws",3,":wss_options",":ws_manager"],[":def_transport","flash","flash",2,":ws_options",":ws_manager"],[":def_transport","sockjs","sockjs",1,":sockjs_options"],[":def_transport","xhr_streaming","xhr_streaming",1,":sockjs_options",":streaming_manager"],[":def_transport","xdr_streaming","xdr_streaming",1,":sockjs_options",":streaming_manager"],[":def_transport","xhr_polling","xhr_polling",1,":sockjs_options"],[":def_transport","xdr_polling","xdr_polling",1,":sockjs_options"],[":def","ws_loop",[":sequential",":timeouts",":ws"]],[":def","wss_loop",[":sequential",":timeouts",":wss"]],[":def","flash_loop",[":sequential",":timeouts",":flash"]],[":def","sockjs_loop",[":sequential",":timeouts",":sockjs"]],[":def","streaming_loop",[":sequential",":timeouts",[":if",[":is_supported",":xhr_streaming"],":xhr_streaming",":xdr_streaming"]]],[":def","polling_loop",[":sequential",":timeouts",[":if",[":is_supported",":xhr_polling"],":xhr_polling",":xdr_polling"]]],[":def","http_loop",[":if",[":is_supported",":streaming_loop"],[":best_connected_ever",":streaming_loop",[":delayed",4e3,[":polling_loop"]]],[":polling_loop"]]],[":def","http_fallback_loop",[":if",[":is_supported",":http_loop"],[":http_loop"],[":sockjs_loop"]]],[":def","strategy",[":cached",18e5,[":first_connected",[":if",[":is_supported",":ws"],b,[":if",[":is_supported",":flash"],[":best_connected_ever",":flash_loop",[":delayed",2e3,[":http_fallback_loop"]]],[":http_fallback_loop"]]]]]]]}}.call(this),function(){Pusher.getGlobalConfig=function(){return{wsHost:Pusher.host,wsPort:Pusher.ws_port,wssPort:Pusher.wss_port,httpHost:Pusher.sockjs_host,httpPort:Pusher.sockjs_http_port,httpsPort:Pusher.sockjs_https_port,httpPath:Pusher.sockjs_path,statsHost:Pusher.stats_host,authEndpoint:Pusher.channel_auth_endpoint,authTransport:Pusher.channel_auth_transport,activity_timeout:Pusher.activity_timeout,pong_timeout:Pusher.pong_timeout,unavailable_timeout:Pusher.unavailable_timeout}},Pusher.getClusterConfig=function(a){return{wsHost:"ws-"+a+".pusher.com",httpHost:"sockjs-"+a+".pusher.com"}}}.call(this),function(){function a(a){var b=function(b){Error.call(this,b),this.name=a};return Pusher.Util.extend(b.prototype,Error.prototype),b}Pusher.Errors={BadEventName:a("BadEventName"),RequestTimedOut:a("RequestTimedOut"),TransportPriorityTooLow:a("TransportPriorityTooLow"),TransportClosed:a("TransportClosed"),UnsupportedTransport:a("UnsupportedTransport"),UnsupportedStrategy:a("UnsupportedStrategy")}}.call(this),function(){function a(a){this.callbacks=new b,this.global_callbacks=[],this.failThrough=a}function b(){this._callbacks={}}function c(a){return"_"+a}var d=a.prototype;d.bind=function(a,b,c){return this.callbacks.add(a,b,c),this},d.bind_all=function(a){return this.global_callbacks.push(a),this},d.unbind=function(a,b,c){return this.callbacks.remove(a,b,c),this},d.unbind_all=function(a,b){return this.callbacks.remove(a,b),this},d.emit=function(a,b){var c;for(c=0;c<this.global_callbacks.length;c++)this.global_callbacks[c](a,b);var d=this.callbacks.get(a);if(d&&d.length>0)for(c=0;c<d.length;c++)d[c].fn.call(d[c].context||window,b);else this.failThrough&&this.failThrough(a,b);return this},b.prototype.get=function(a){return this._callbacks[c(a)]},b.prototype.add=function(a,b,d){var e=c(a);this._callbacks[e]=this._callbacks[e]||[],this._callbacks[e].push({fn:b,context:d})},b.prototype.remove=function(a,b,d){if(!a&&!b&&!d)return void(this._callbacks={});var e=a?[c(a)]:Pusher.Util.keys(this._callbacks);b||d?Pusher.Util.apply(e,function(a){this._callbacks[a]=Pusher.Util.filter(this._callbacks[a]||[],function(a){return b&&b!==a.fn||d&&d!==a.context}),0===this._callbacks[a].length&&delete this._callbacks[a]},this):Pusher.Util.apply(e,function(a){delete this._callbacks[a]},this)},Pusher.EventsDispatcher=a}.call(this),function(){function a(a,b){this.lastId=0,this.prefix=a,this.name=b}var b=a.prototype;b.create=function(a){this.lastId++;var b=this.lastId,c=this.prefix+b,d=this.name+"["+b+"]",e=!1,f=function(){e||(a.apply(null,arguments),e=!0)};return this[b]=f,{number:b,id:c,name:d,callback:f}},b.remove=function(a){delete this[a.number]},Pusher.ScriptReceiverFactory=a,Pusher.ScriptReceivers=new a("_pusher_script_","Pusher.ScriptReceivers")}.call(this),function(){function a(a){this.src=a}var b=a.prototype;b.send=function(a){var b=this,c="Error loading "+b.src;b.script=document.createElement("script"),b.script.id=a.id,b.script.src=b.src,b.script.type="text/javascript",b.script.charset="UTF-8",b.script.addEventListener?(b.script.onerror=function(){a.callback(c)},b.script.onload=function(){a.callback(null)}):b.script.onreadystatechange=function(){("loaded"===b.script.readyState||"complete"===b.script.readyState)&&a.callback(null)},void 0===b.script.async&&document.attachEvent&&/opera/i.test(navigator.userAgent)?(b.errorScript=document.createElement("script"),b.errorScript.id=a.id+"_error",b.errorScript.text=a.name+"('"+c+"');",b.script.async=b.errorScript.async=!1):b.script.async=!0;
var d=document.getElementsByTagName("head")[0];d.insertBefore(b.script,d.firstChild),b.errorScript&&d.insertBefore(b.errorScript,b.script.nextSibling)},b.cleanup=function(){this.script&&(this.script.onload=this.script.onerror=null,this.script.onreadystatechange=null),this.script&&this.script.parentNode&&this.script.parentNode.removeChild(this.script),this.errorScript&&this.errorScript.parentNode&&this.errorScript.parentNode.removeChild(this.errorScript),this.script=null,this.errorScript=null},Pusher.ScriptRequest=a}.call(this),function(){function a(a){this.options=a,this.receivers=a.receivers||Pusher.ScriptReceivers,this.loading={}}var b=a.prototype;b.load=function(a,b){var c=this;if(c.loading[a]&&c.loading[a].length>0)c.loading[a].push(b);else{c.loading[a]=[b];var d=new Pusher.ScriptRequest(c.getPath(a)),e=c.receivers.create(function(b){if(c.receivers.remove(e),c.loading[a]){var f=c.loading[a];delete c.loading[a];for(var g=function(a){a||d.cleanup()},h=0;h<f.length;h++)f[h](b,g)}});d.send(e)}},b.getRoot=function(a){var b,c=Pusher.Util.getDocument().location.protocol;return b=a&&a.encrypted||"https:"===c?this.options.cdn_https:this.options.cdn_http,b.replace(/\/*$/,"")+"/"+this.options.version},b.getPath=function(a,b){return this.getRoot(b)+"/"+a+this.options.suffix+".js"},Pusher.DependencyLoader=a}.call(this),function(){function a(){Pusher.ready()}function b(a){document.body?a():setTimeout(function(){b(a)},0)}function c(){b(a)}Pusher.DependenciesReceivers=new Pusher.ScriptReceiverFactory("_pusher_dependencies","Pusher.DependenciesReceivers"),Pusher.Dependencies=new Pusher.DependencyLoader({cdn_http:Pusher.cdn_http,cdn_https:Pusher.cdn_https,version:Pusher.VERSION,suffix:Pusher.dependency_suffix,receivers:Pusher.DependenciesReceivers}),window.JSON?c():Pusher.Dependencies.load("json2",c)}(),function(){for(var a={encode:function(a){return j(h(a))}},b=String.fromCharCode,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d={},e=0,f=c.length;f>e;e++)d[c.charAt(e)]=e;var g=function(a){var c=a.charCodeAt(0);return 128>c?a:2048>c?b(192|c>>>6)+b(128|63&c):b(224|c>>>12&15)+b(128|c>>>6&63)+b(128|63&c)},h=function(a){return a.replace(/[^\x00-\x7F]/g,g)},i=function(a){var b=[0,2,1][a.length%3],d=a.charCodeAt(0)<<16|(a.length>1?a.charCodeAt(1):0)<<8|(a.length>2?a.charCodeAt(2):0),e=[c.charAt(d>>>18),c.charAt(d>>>12&63),b>=2?"=":c.charAt(d>>>6&63),b>=1?"=":c.charAt(63&d)];return e.join("")},j=window.btoa||function(a){return a.replace(/[\s\S]{1,3}/g,i)};Pusher.Base64=a}.call(this),function(){function a(a,b){this.url=a,this.data=b}function b(a){return Pusher.Util.mapObject(a,function(a){return"object"==typeof a&&(a=JSON.stringify(a)),encodeURIComponent(Pusher.Base64.encode(a.toString()))})}var c=a.prototype;c.send=function(a){if(!this.request){var c=Pusher.Util.filterObject(this.data,function(a){return void 0!==a}),d=Pusher.Util.map(Pusher.Util.flatten(b(c)),Pusher.Util.method("join","=")).join("&"),e=this.url+"/"+a.number+"?"+d;this.request=new Pusher.ScriptRequest(e),this.request.send(a)}},c.cleanup=function(){this.request&&this.request.cleanup()},Pusher.JSONPRequest=a}.call(this),function(){function a(a,b,c){this.key=a,this.session=b,this.events=[],this.options=c||{},this.sent=0,this.uniqueID=0}var b=a.prototype;a.ERROR=3,a.INFO=6,a.DEBUG=7,b.log=function(a,b){a<=this.options.level&&(this.events.push(Pusher.Util.extend({},b,{timestamp:Pusher.Util.now()})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift())},b.error=function(b){this.log(a.ERROR,b)},b.info=function(b){this.log(a.INFO,b)},b.debug=function(b){this.log(a.DEBUG,b)},b.isEmpty=function(){return 0===this.events.length},b.send=function(a,b){var c=this,d=Pusher.Util.extend({session:c.session,bundle:c.sent+1,key:c.key,lib:"js",version:c.options.version,cluster:c.options.cluster,features:c.options.features,timeline:c.events},c.options.params);return c.events=[],a(d,function(a,d){a||c.sent++,b&&b(a,d)}),!0},b.generateUniqueID=function(){return this.uniqueID++,this.uniqueID},Pusher.Timeline=a}.call(this),function(){function a(a,b){this.timeline=a,this.options=b||{}}var b=a.prototype;b.send=function(a,b){var c=this;if(!c.timeline.isEmpty()){var d=function(b,d){var e="http"+(a?"s":"")+"://",f=e+(c.host||c.options.host)+c.options.path,g=new Pusher.JSONPRequest(f,b),h=Pusher.ScriptReceivers.create(function(a,b){Pusher.ScriptReceivers.remove(h),g.cleanup(),b&&b.host&&(c.host=b.host),d&&d(a,b)});g.send(h)};c.timeline.send(d,b)}},Pusher.TimelineSender=a}.call(this),function(){function a(a){this.strategies=a}function b(a,b,c){var e=Pusher.Util.map(a,function(a,d,e,f){return a.connect(b,c(d,f))});return{abort:function(){Pusher.Util.apply(e,d)},forceMinPriority:function(a){Pusher.Util.apply(e,function(b){b.forceMinPriority(a)})}}}function c(a){return Pusher.Util.all(a,function(a){return Boolean(a.error)})}function d(a){a.error||a.aborted||(a.abort(),a.aborted=!0)}var e=a.prototype;e.isSupported=function(){return Pusher.Util.any(this.strategies,Pusher.Util.method("isSupported"))},e.connect=function(a,d){return b(this.strategies,a,function(a,b){return function(e,f){return b[a].error=e,e?void(c(b)&&d(!0)):(Pusher.Util.apply(b,function(a){a.forceMinPriority(f.transport.priority)}),void d(null,f))}})},Pusher.BestConnectedEverStrategy=a}.call(this),function(){function a(a,b,c){this.strategy=a,this.transports=b,this.ttl=c.ttl||18e5,this.encrypted=c.encrypted,this.timeline=c.timeline}function b(a){return"pusherTransport"+(a?"Encrypted":"Unencrypted")}function c(a){var c=Pusher.Util.getLocalStorage();if(c)try{var d=c[b(a)];if(d)return JSON.parse(d)}catch(f){e(a)}return null}function d(a,c,d){var e=Pusher.Util.getLocalStorage();if(e)try{e[b(a)]=JSON.stringify({timestamp:Pusher.Util.now(),transport:c,latency:d})}catch(f){}}function e(a){var c=Pusher.Util.getLocalStorage();if(c)try{delete c[b(a)]}catch(d){}}var f=a.prototype;f.isSupported=function(){return this.strategy.isSupported()},f.connect=function(a,b){var f=this.encrypted,g=c(f),h=[this.strategy];if(g&&g.timestamp+this.ttl>=Pusher.Util.now()){var i=this.transports[g.transport];i&&(this.timeline.info({cached:!0,transport:g.transport,latency:g.latency}),h.push(new Pusher.SequentialStrategy([i],{timeout:2*g.latency+1e3,failFast:!0})))}var j=Pusher.Util.now(),k=h.pop().connect(a,function l(c,g){c?(e(f),h.length>0?(j=Pusher.Util.now(),k=h.pop().connect(a,l)):b(c)):(d(f,g.transport.name,Pusher.Util.now()-j),b(null,g))});return{abort:function(){k.abort()},forceMinPriority:function(b){a=b,k&&k.forceMinPriority(b)}}},Pusher.CachedStrategy=a}.call(this),function(){function a(a,b){this.strategy=a,this.options={delay:b.delay}}var b=a.prototype;b.isSupported=function(){return this.strategy.isSupported()},b.connect=function(a,b){var c,d=this.strategy,e=new Pusher.Timer(this.options.delay,function(){c=d.connect(a,b)});return{abort:function(){e.ensureAborted(),c&&c.abort()},forceMinPriority:function(b){a=b,c&&c.forceMinPriority(b)}}},Pusher.DelayedStrategy=a}.call(this),function(){function a(a){this.strategy=a}var b=a.prototype;b.isSupported=function(){return this.strategy.isSupported()},b.connect=function(a,b){var c=this.strategy.connect(a,function(a,d){d&&c.abort(),b(a,d)});return c},Pusher.FirstConnectedStrategy=a}.call(this),function(){function a(a,b,c){this.test=a,this.trueBranch=b,this.falseBranch=c}var b=a.prototype;b.isSupported=function(){var a=this.test()?this.trueBranch:this.falseBranch;return a.isSupported()},b.connect=function(a,b){var c=this.test()?this.trueBranch:this.falseBranch;return c.connect(a,b)},Pusher.IfStrategy=a}.call(this),function(){function a(a,b){this.strategies=a,this.loop=Boolean(b.loop),this.failFast=Boolean(b.failFast),this.timeout=b.timeout,this.timeoutLimit=b.timeoutLimit}var b=a.prototype;b.isSupported=function(){return Pusher.Util.any(this.strategies,Pusher.Util.method("isSupported"))},b.connect=function(a,b){var c=this,d=this.strategies,e=0,f=this.timeout,g=null,h=function(i,j){j?b(null,j):(e+=1,c.loop&&(e%=d.length),e<d.length?(f&&(f=2*f,c.timeoutLimit&&(f=Math.min(f,c.timeoutLimit))),g=c.tryStrategy(d[e],a,{timeout:f,failFast:c.failFast},h)):b(!0))};return g=this.tryStrategy(d[e],a,{timeout:f,failFast:this.failFast},h),{abort:function(){g.abort()},forceMinPriority:function(b){a=b,g&&g.forceMinPriority(b)}}},b.tryStrategy=function(a,b,c,d){var e=null,f=null;return c.timeout>0&&(e=new Pusher.Timer(c.timeout,function(){f.abort(),d(!0)})),f=a.connect(b,function(a,b){a&&e&&e.isRunning()&&!c.failFast||(e&&e.ensureAborted(),d(a,b))}),{abort:function(){e&&e.ensureAborted(),f.abort()},forceMinPriority:function(a){f.forceMinPriority(a)}}},Pusher.SequentialStrategy=a}.call(this),function(){function a(a,b,c,d){this.name=a,this.priority=b,this.transport=c,this.options=d||{}}function b(a,b){return Pusher.Util.defer(function(){b(a)}),{abort:function(){},forceMinPriority:function(){}}}var c=a.prototype;c.isSupported=function(){return this.transport.isSupported({encrypted:this.options.encrypted})},c.connect=function(a,c){if(!this.isSupported())return b(new Pusher.Errors.UnsupportedStrategy,c);if(this.priority<a)return b(new Pusher.Errors.TransportPriorityTooLow,c);var d=this,e=!1,f=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),g=null,h=function(){f.unbind("initialized",h),f.connect()},i=function(){g=new Pusher.Handshake(f,function(a){e=!0,l(),c(null,a)})},j=function(a){l(),c(a)},k=function(){l(),c(new Pusher.Errors.TransportClosed(f))},l=function(){f.unbind("initialized",h),f.unbind("open",i),f.unbind("error",j),f.unbind("closed",k)};return f.bind("initialized",h),f.bind("open",i),f.bind("error",j),f.bind("closed",k),f.initialize(),{abort:function(){e||(l(),g?g.close():f.close())},forceMinPriority:function(a){e||d.priority<a&&(g?g.close():f.close())}}},Pusher.TransportStrategy=a}.call(this),function(){function a(a,b,c){var d=a+(b.encrypted?"s":""),e=b.encrypted?b.hostEncrypted:b.hostUnencrypted;return d+"://"+e+c}function b(a,b){var c="/app/"+a,d="?protocol="+Pusher.PROTOCOL+"&client=js&version="+Pusher.VERSION+(b?"&"+b:"");return c+d}Pusher.URLSchemes={ws:{getInitial:function(c,d){return a("ws",d,b(c,"flash=false"))}},flash:{getInitial:function(c,d){return a("ws",d,b(c,"flash=true"))}},sockjs:{getInitial:function(b,c){return a("http",c,c.httpPath||"/pusher","")},getPath:function(a){return b(a)}},http:{getInitial:function(c,d){var e=(d.httpPath||"/pusher")+b(c);return a("http",d,e)}}}}.call(this),function(){function a(a,b,c,d,e){Pusher.EventsDispatcher.call(this),this.hooks=a,this.name=b,this.priority=c,this.key=d,this.options=e,this.state="new",this.timeline=e.timeline,this.activityTimeout=e.activityTimeout,this.id=this.timeline.generateUniqueID()}var b=a.prototype;Pusher.Util.extend(b,Pusher.EventsDispatcher.prototype),b.handlesActivityChecks=function(){return Boolean(this.hooks.handlesActivityChecks)},b.supportsPing=function(){return Boolean(this.hooks.supportsPing)},b.initialize=function(){var a=this;a.timeline.info(a.buildTimelineMessage({transport:a.name+(a.options.encrypted?"s":"")})),a.hooks.beforeInitialize&&a.hooks.beforeInitialize(),a.hooks.isInitialized()?a.changeState("initialized"):a.hooks.file?(a.changeState("initializing"),Pusher.Dependencies.load(a.hooks.file,function(b,c){a.hooks.isInitialized()?(a.changeState("initialized"),c(!0)):(b&&a.onError(b),a.onClose(),c(!1))})):a.onClose()},b.connect=function(){var a=this;if(a.socket||"initialized"!==a.state)return!1;var b=a.hooks.urls.getInitial(a.key,a.options);try{a.socket=a.hooks.getSocket(b,a.options)}catch(c){return Pusher.Util.defer(function(){a.onError(c),a.changeState("closed")}),!1}return a.bindListeners(),Pusher.debug("Connecting",{transport:a.name,url:b}),a.changeState("connecting"),!0},b.close=function(){return this.socket?(this.socket.close(),!0):!1},b.send=function(a){var b=this;return"open"===b.state?(Pusher.Util.defer(function(){b.socket&&b.socket.send(a)}),!0):!1},b.ping=function(){"open"===this.state&&this.supportsPing()&&this.socket.ping()},b.onOpen=function(){this.hooks.beforeOpen&&this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options)),this.changeState("open"),this.socket.onopen=void 0},b.onError=function(a){this.emit("error",{type:"WebSocketError",error:a}),this.timeline.error(this.buildTimelineMessage({error:a.toString()}))},b.onClose=function(a){a?this.changeState("closed",{code:a.code,reason:a.reason,wasClean:a.wasClean}):this.changeState("closed"),this.unbindListeners(),this.socket=void 0},b.onMessage=function(a){this.emit("message",a)},b.onActivity=function(){this.emit("activity")},b.bindListeners=function(){var a=this;a.socket.onopen=function(){a.onOpen()},a.socket.onerror=function(b){a.onError(b)},a.socket.onclose=function(b){a.onClose(b)},a.socket.onmessage=function(b){a.onMessage(b)},a.supportsPing()&&(a.socket.onactivity=function(){a.onActivity()})},b.unbindListeners=function(){this.socket&&(this.socket.onopen=void 0,this.socket.onerror=void 0,this.socket.onclose=void 0,this.socket.onmessage=void 0,this.supportsPing()&&(this.socket.onactivity=void 0))},b.changeState=function(a,b){this.state=a,this.timeline.info(this.buildTimelineMessage({state:a,params:b})),this.emit(a,b)},b.buildTimelineMessage=function(a){return Pusher.Util.extend({cid:this.id},a)},Pusher.TransportConnection=a}.call(this),function(){function a(a){this.hooks=a}var b=a.prototype;b.isSupported=function(a){return this.hooks.isSupported(a)},b.createConnection=function(a,b,c,d){return new Pusher.TransportConnection(this.hooks,a,b,c,d)},Pusher.Transport=a}.call(this),function(){Pusher.WSTransport=new Pusher.Transport({urls:Pusher.URLSchemes.ws,handlesActivityChecks:!1,supportsPing:!1,isInitialized:function(){return Boolean(window.WebSocket||window.MozWebSocket)},isSupported:function(){return Boolean(window.WebSocket||window.MozWebSocket)},getSocket:function(a){var b=window.WebSocket||window.MozWebSocket;return new b(a)}}),Pusher.FlashTransport=new Pusher.Transport({file:"flashfallback",urls:Pusher.URLSchemes.flash,handlesActivityChecks:!1,supportsPing:!1,isSupported:function(){try{return Boolean(new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(a){try{var b=Pusher.Util.getNavigator();return Boolean(b&&b.mimeTypes&&void 0!==b.mimeTypes["application/x-shockwave-flash"])}catch(c){return!1}}},beforeInitialize:function(){void 0===window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR&&(window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR=!0),window.WEB_SOCKET_SWF_LOCATION=Pusher.Dependencies.getRoot()+"/WebSocketMain.swf"},isInitialized:function(){return void 0!==window.FlashWebSocket},getSocket:function(a){return new FlashWebSocket(a)}}),Pusher.SockJSTransport=new Pusher.Transport({file:"sockjs",urls:Pusher.URLSchemes.sockjs,handlesActivityChecks:!0,supportsPing:!1,isSupported:function(){return!0},isInitialized:function(){return void 0!==window.SockJS},getSocket:function(a,b){return new SockJS(a,null,{js_path:Pusher.Dependencies.getPath("sockjs",{encrypted:b.encrypted}),ignore_null_origin:b.ignoreNullOrigin})},beforeOpen:function(a,b){a.send(JSON.stringify({path:b}))}});var a={urls:Pusher.URLSchemes.http,handlesActivityChecks:!1,supportsPing:!0,isInitialized:function(){return Boolean(Pusher.HTTP.Socket)}},b=Pusher.Util.extend({getSocket:function(a){return Pusher.HTTP.getStreamingSocket(a)}},a),c=Pusher.Util.extend({getSocket:function(a){return Pusher.HTTP.getPollingSocket(a)}},a),d={file:"xhr",isSupported:Pusher.Util.isXHRSupported},e={file:"xdr",isSupported:function(a){return Pusher.Util.isXDRSupported(a.encrypted)}};Pusher.XHRStreamingTransport=new Pusher.Transport(Pusher.Util.extend({},b,d)),Pusher.XDRStreamingTransport=new Pusher.Transport(Pusher.Util.extend({},b,e)),Pusher.XHRPollingTransport=new Pusher.Transport(Pusher.Util.extend({},c,d)),Pusher.XDRPollingTransport=new Pusher.Transport(Pusher.Util.extend({},c,e))}.call(this),function(){function a(a,b,c){this.manager=a,this.transport=b,this.minPingDelay=c.minPingDelay,this.maxPingDelay=c.maxPingDelay,this.pingDelay=void 0}var b=a.prototype;b.createConnection=function(a,b,c,d){var e=this;d=Pusher.Util.extend({},d,{activityTimeout:e.pingDelay});var f=e.transport.createConnection(a,b,c,d),g=null,h=function(){f.unbind("open",h),f.bind("closed",i),g=Pusher.Util.now()},i=function(a){if(f.unbind("closed",i),1002===a.code||1003===a.code)e.manager.reportDeath();else if(!a.wasClean&&g){var b=Pusher.Util.now()-g;b<2*e.maxPingDelay&&(e.manager.reportDeath(),e.pingDelay=Math.max(b/2,e.minPingDelay))}};return f.bind("open",h),f},b.isSupported=function(a){return this.manager.isAlive()&&this.transport.isSupported(a)},Pusher.AssistantToTheTransportManager=a}.call(this),function(){function a(a){this.options=a||{},this.livesLeft=this.options.lives||1/0}var b=a.prototype;b.getAssistant=function(a){return new Pusher.AssistantToTheTransportManager(this,a,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})},b.isAlive=function(){return this.livesLeft>0},b.reportDeath=function(){this.livesLeft-=1},Pusher.TransportManager=a}.call(this),function(){function a(a){return function(b){return[a.apply(this,arguments),b]}}function b(a){return"string"==typeof a&&":"===a.charAt(0)}function c(a,b){return b[a.slice(1)]}function d(a,b){if(0===a.length)return[[],b];var c=g(a[0],b),e=d(a.slice(1),c[1]);return[[c[0]].concat(e[0]),e[1]]}function e(a,d){if(!b(a))return[a,d];var e=c(a,d);if(void 0===e)throw"Undefined symbol "+a;return[e,d]}function f(a,e){if(b(a[0])){var f=c(a[0],e);if(a.length>1){if("function"!=typeof f)throw"Calling non-function "+a[0];var h=[Pusher.Util.extend({},e)].concat(Pusher.Util.map(a.slice(1),function(a){return g(a,Pusher.Util.extend({},e))[0]}));return f.apply(this,h)}return[f,e]}return d(a,e)}function g(a,b){return"string"==typeof a?e(a,b):"object"==typeof a&&a instanceof Array&&a.length>0?f(a,b):[a,b]}var h={build:function(a,b){var c=Pusher.Util.extend({},k,b);return g(a,c)[1].strategy}},i={ws:Pusher.WSTransport,flash:Pusher.FlashTransport,sockjs:Pusher.SockJSTransport,xhr_streaming:Pusher.XHRStreamingTransport,xdr_streaming:Pusher.XDRStreamingTransport,xhr_polling:Pusher.XHRPollingTransport,xdr_polling:Pusher.XDRPollingTransport},j={isSupported:function(){return!1},connect:function(a,b){var c=Pusher.Util.defer(function(){b(new Pusher.Errors.UnsupportedStrategy)});return{abort:function(){c.ensureAborted()},forceMinPriority:function(){}}}},k={extend:function(a,b,c){return[Pusher.Util.extend({},b,c),a]},def:function(a,b,c){if(void 0!==a[b])throw"Redefining symbol "+b;return a[b]=c,[void 0,a]},def_transport:function(a,b,c,d,e,f){var g=i[c];if(!g)throw new Pusher.Errors.UnsupportedTransport(c);var h,k=!(a.enabledTransports&&-1===Pusher.Util.arrayIndexOf(a.enabledTransports,b)||a.disabledTransports&&-1!==Pusher.Util.arrayIndexOf(a.disabledTransports,b)||"flash"===b&&a.disableFlash===!0);h=k?new Pusher.TransportStrategy(b,d,f?f.getAssistant(g):g,Pusher.Util.extend({key:a.key,encrypted:a.encrypted,timeline:a.timeline,ignoreNullOrigin:a.ignoreNullOrigin},e)):j;var l=a.def(a,b,h)[1];return l.transports=a.transports||{},l.transports[b]=h,[void 0,l]},transport_manager:a(function(a,b){return new Pusher.TransportManager(b)}),sequential:a(function(a,b){var c=Array.prototype.slice.call(arguments,2);return new Pusher.SequentialStrategy(c,b)}),cached:a(function(a,b,c){return new Pusher.CachedStrategy(c,a.transports,{ttl:b,timeline:a.timeline,encrypted:a.encrypted})}),first_connected:a(function(a,b){return new Pusher.FirstConnectedStrategy(b)}),best_connected_ever:a(function(){var a=Array.prototype.slice.call(arguments,1);return new Pusher.BestConnectedEverStrategy(a)}),delayed:a(function(a,b,c){return new Pusher.DelayedStrategy(c,{delay:b})}),"if":a(function(a,b,c,d){return new Pusher.IfStrategy(b,c,d)}),is_supported:a(function(a,b){return function(){return b.isSupported()}})};Pusher.StrategyBuilder=h}.call(this),function(){var a={};a.decodeMessage=function(a){try{var b=JSON.parse(a.data);if("string"==typeof b.data)try{b.data=JSON.parse(b.data)}catch(c){if(!(c instanceof SyntaxError))throw c}return b}catch(c){throw{type:"MessageParseError",error:c,data:a.data}}},a.encodeMessage=function(a){return JSON.stringify(a)},a.processHandshake=function(a){if(a=this.decodeMessage(a),"pusher:connection_established"===a.event){if(!a.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:a.data.socket_id,activityTimeout:1e3*a.data.activity_timeout}}if("pusher:error"===a.event)return{action:this.getCloseAction(a.data),error:this.getCloseError(a.data)};throw"Invalid handshake"},a.getCloseAction=function(a){return a.code<4e3?a.code>=1002&&a.code<=1004?"backoff":null:4e3===a.code?"ssl_only":a.code<4100?"refused":a.code<4200?"backoff":a.code<4300?"retry":"refused"},a.getCloseError=function(a){return 1e3!==a.code&&1001!==a.code?{type:"PusherError",data:{code:a.code,message:a.reason||a.message}}:null},Pusher.Protocol=a}.call(this),function(){function a(a,b){Pusher.EventsDispatcher.call(this),this.id=a,this.transport=b,this.activityTimeout=b.activityTimeout,this.bindListeners()}var b=a.prototype;Pusher.Util.extend(b,Pusher.EventsDispatcher.prototype),b.handlesActivityChecks=function(){return this.transport.handlesActivityChecks()},b.send=function(a){return this.transport.send(a)},b.send_event=function(a,b,c){var d={event:a,data:b};return c&&(d.channel=c),Pusher.debug("Event sent",d),this.send(Pusher.Protocol.encodeMessage(d))},b.ping=function(){this.transport.supportsPing()?this.transport.ping():this.send_event("pusher:ping",{})},b.close=function(){this.transport.close()},b.bindListeners=function(){var a=this,b={message:function(b){var c;try{c=Pusher.Protocol.decodeMessage(b)}catch(d){a.emit("error",{type:"MessageParseError",error:d,data:b.data})}if(void 0!==c){switch(Pusher.debug("Event recd",c),c.event){case"pusher:error":a.emit("error",{type:"PusherError",data:c.data});break;case"pusher:ping":a.emit("ping");break;case"pusher:pong":a.emit("pong")}a.emit("message",c)}},activity:function(){a.emit("activity")},error:function(b){a.emit("error",{type:"WebSocketError",error:b})},closed:function(b){c(),b&&b.code&&a.handleCloseEvent(b),a.transport=null,a.emit("closed")}},c=function(){Pusher.Util.objectApply(b,function(b,c){a.transport.unbind(c,b)})};Pusher.Util.objectApply(b,function(b,c){a.transport.bind(c,b)})},b.handleCloseEvent=function(a){var b=Pusher.Protocol.getCloseAction(a),c=Pusher.Protocol.getCloseError(a);c&&this.emit("error",c),b&&this.emit(b)},Pusher.Connection=a}.call(this),function(){function a(a,b){this.transport=a,this.callback=b,this.bindListeners()}var b=a.prototype;b.close=function(){this.unbindListeners(),this.transport.close()},b.bindListeners=function(){var a=this;a.onMessage=function(b){a.unbindListeners();try{var c=Pusher.Protocol.processHandshake(b);"connected"===c.action?a.finish("connected",{connection:new Pusher.Connection(c.id,a.transport),activityTimeout:c.activityTimeout}):(a.finish(c.action,{error:c.error}),a.transport.close())}catch(d){a.finish("error",{error:d}),a.transport.close()}},a.onClosed=function(b){a.unbindListeners();var c=Pusher.Protocol.getCloseAction(b)||"backoff",d=Pusher.Protocol.getCloseError(b);a.finish(c,{error:d})},a.transport.bind("message",a.onMessage),a.transport.bind("closed",a.onClosed)},b.unbindListeners=function(){this.transport.unbind("message",this.onMessage),this.transport.unbind("closed",this.onClosed)},b.finish=function(a,b){this.callback(Pusher.Util.extend({transport:this.transport,action:a},b))},Pusher.Handshake=a}.call(this),function(){function a(a,b){Pusher.EventsDispatcher.call(this),this.key=a,this.options=b||{},this.state="initialized",this.connection=null,this.encrypted=!!b.encrypted,this.timeline=this.options.timeline,this.connectionCallbacks=this.buildConnectionCallbacks(),this.errorCallbacks=this.buildErrorCallbacks(),this.handshakeCallbacks=this.buildHandshakeCallbacks(this.errorCallbacks);var c=this;Pusher.Network.bind("online",function(){c.timeline.info({netinfo:"online"}),("connecting"===c.state||"unavailable"===c.state)&&c.retryIn(0)}),Pusher.Network.bind("offline",function(){c.timeline.info({netinfo:"offline"}),"connected"===c.state&&c.sendActivityCheck()}),this.updateStrategy()}var b=a.prototype;Pusher.Util.extend(b,Pusher.EventsDispatcher.prototype),b.connect=function(){if(!this.connection&&!this.runner){if(!this.strategy.isSupported())return void this.updateState("failed");this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()}},b.send=function(a){return this.connection?this.connection.send(a):!1},b.send_event=function(a,b,c){return this.connection?this.connection.send_event(a,b,c):!1},b.disconnect=function(){this.disconnectInternally(),this.updateState("disconnected")},b.isEncrypted=function(){return this.encrypted},b.startConnecting=function(){var a=this,b=function(c,d){c?a.runner=a.strategy.connect(0,b):"error"===d.action?(a.emit("error",{type:"HandshakeError",error:d.error}),a.timeline.error({handshakeError:d.error})):(a.abortConnecting(),a.handshakeCallbacks[d.action](d))};a.runner=a.strategy.connect(0,b)},b.abortConnecting=function(){this.runner&&(this.runner.abort(),this.runner=null)},b.disconnectInternally=function(){if(this.abortConnecting(),this.clearRetryTimer(),this.clearUnavailableTimer(),this.stopActivityCheck(),this.connection){var a=this.abandonConnection();a.close()}},b.updateStrategy=function(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,encrypted:this.encrypted})},b.retryIn=function(a){var b=this;b.timeline.info({action:"retry",delay:a}),a>0&&b.emit("connecting_in",Math.round(a/1e3)),b.retryTimer=new Pusher.Timer(a||0,function(){b.disconnectInternally(),b.connect()})},b.clearRetryTimer=function(){this.retryTimer&&(this.retryTimer.ensureAborted(),this.retryTimer=null)},b.setUnavailableTimer=function(){var a=this;a.unavailableTimer=new Pusher.Timer(a.options.unavailableTimeout,function(){a.updateState("unavailable")})},b.clearUnavailableTimer=function(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()},b.sendActivityCheck=function(){var a=this;a.stopActivityCheck(),a.connection.ping(),a.activityTimer=new Pusher.Timer(a.options.pongTimeout,function(){a.timeline.error({pong_timed_out:a.options.pongTimeout}),a.retryIn(0)})},b.resetActivityCheck=function(){var a=this;a.stopActivityCheck(),a.connection.handlesActivityChecks()||(a.activityTimer=new Pusher.Timer(a.activityTimeout,function(){a.sendActivityCheck()}))},b.stopActivityCheck=function(){this.activityTimer&&this.activityTimer.ensureAborted()},b.buildConnectionCallbacks=function(){var a=this;return{message:function(b){a.resetActivityCheck(),a.emit("message",b)},ping:function(){a.send_event("pusher:pong",{})},activity:function(){a.resetActivityCheck()},error:function(b){a.emit("error",{type:"WebSocketError",error:b})},closed:function(){a.abandonConnection(),a.shouldRetry()&&a.retryIn(1e3)}}},b.buildHandshakeCallbacks=function(a){var b=this;return Pusher.Util.extend({},a,{connected:function(a){b.activityTimeout=Math.min(b.options.activityTimeout,a.activityTimeout,a.connection.activityTimeout||1/0),b.clearUnavailableTimer(),b.setConnection(a.connection),b.socket_id=b.connection.id,b.updateState("connected",{socket_id:b.socket_id})}})},b.buildErrorCallbacks=function(){function a(a){return function(c){c.error&&b.emit("error",{type:"WebSocketError",error:c.error}),a(c)}}var b=this;return{ssl_only:a(function(){b.encrypted=!0,b.updateStrategy(),b.retryIn(0)}),refused:a(function(){b.disconnect()}),backoff:a(function(){b.retryIn(1e3)}),retry:a(function(){b.retryIn(0)})}},b.setConnection=function(a){this.connection=a;for(var b in this.connectionCallbacks)this.connection.bind(b,this.connectionCallbacks[b]);this.resetActivityCheck()},b.abandonConnection=function(){if(this.connection){for(var a in this.connectionCallbacks)this.connection.unbind(a,this.connectionCallbacks[a]);var b=this.connection;return this.connection=null,b}},b.updateState=function(a,b){var c=this.state;this.state=a,c!==a&&(Pusher.debug("State changed",c+" -> "+a),this.timeline.info({state:a,params:b}),this.emit("state_change",{previous:c,current:a}),this.emit(a,b))},b.shouldRetry=function(){return"connecting"===this.state||"connected"===this.state},Pusher.ConnectionManager=a}.call(this),function(){function a(){Pusher.EventsDispatcher.call(this);var a=this;void 0!==window.addEventListener&&(window.addEventListener("online",function(){a.emit("online")},!1),window.addEventListener("offline",function(){a.emit("offline")},!1))}Pusher.Util.extend(a.prototype,Pusher.EventsDispatcher.prototype);var b=a.prototype;b.isOnline=function(){return void 0===window.navigator.onLine?!0:window.navigator.onLine},Pusher.NetInfo=a,Pusher.Network=new a}.call(this),function(){function a(){this.reset()}var b=a.prototype;b.get=function(a){return Object.prototype.hasOwnProperty.call(this.members,a)?{id:a,info:this.members[a]}:null},b.each=function(a){var b=this;Pusher.Util.objectApply(b.members,function(c,d){a(b.get(d))})},b.setMyID=function(a){this.myID=a},b.onSubscription=function(a){this.members=a.presence.hash,this.count=a.presence.count,this.me=this.get(this.myID)},b.addMember=function(a){return null===this.get(a.user_id)&&this.count++,this.members[a.user_id]=a.user_info,this.get(a.user_id)},b.removeMember=function(a){var b=this.get(a.user_id);return b&&(delete this.members[a.user_id],this.count--),b},b.reset=function(){this.members={},this.count=0,this.myID=null,this.me=null},Pusher.Members=a}.call(this),function(){function a(a,b){Pusher.EventsDispatcher.call(this,function(b){Pusher.debug("No callbacks on "+a+" for "+b)}),this.name=a,this.pusher=b,this.subscribed=!1}var b=a.prototype;Pusher.Util.extend(b,Pusher.EventsDispatcher.prototype),b.authorize=function(a,b){return b(!1,{})},b.trigger=function(a,b){if(0!==a.indexOf("client-"))throw new Pusher.Errors.BadEventName("Event '"+a+"' does not start with 'client-'");return this.pusher.send_event(a,b,this.name)},b.disconnect=function(){this.subscribed=!1},b.handleEvent=function(a,b){0===a.indexOf("pusher_internal:")?"pusher_internal:subscription_succeeded"===a&&(this.subscribed=!0,this.emit("pusher:subscription_succeeded",b)):this.emit(a,b)},b.subscribe=function(){var a=this;a.authorize(a.pusher.connection.socket_id,function(b,c){b?a.handleEvent("pusher:subscription_error",c):a.pusher.send_event("pusher:subscribe",{auth:c.auth,channel_data:c.channel_data,channel:a.name})})},b.unsubscribe=function(){this.pusher.send_event("pusher:unsubscribe",{channel:this.name})},Pusher.Channel=a}.call(this),function(){function a(a,b){Pusher.Channel.call(this,a,b)}var b=a.prototype;Pusher.Util.extend(b,Pusher.Channel.prototype),b.authorize=function(a,b){var c=new Pusher.Channel.Authorizer(this,this.pusher.config);return c.authorize(a,b)},Pusher.PrivateChannel=a}.call(this),function(){function a(a,b){Pusher.PrivateChannel.call(this,a,b),this.members=new Pusher.Members}var b=a.prototype;Pusher.Util.extend(b,Pusher.PrivateChannel.prototype),b.authorize=function(a,b){var c=Pusher.PrivateChannel.prototype.authorize,d=this;c.call(d,a,function(a,c){if(!a){if(void 0===c.channel_data)return Pusher.warn("Invalid auth response for channel '"+d.name+"', expected 'channel_data' field"),void b("Invalid auth response");var e=JSON.parse(c.channel_data);d.members.setMyID(e.user_id)}b(a,c)})},b.handleEvent=function(a,b){switch(a){case"pusher_internal:subscription_succeeded":this.members.onSubscription(b),this.subscribed=!0,this.emit("pusher:subscription_succeeded",this.members);break;case"pusher_internal:member_added":var c=this.members.addMember(b);this.emit("pusher:member_added",c);break;case"pusher_internal:member_removed":var d=this.members.removeMember(b);d&&this.emit("pusher:member_removed",d);break;default:Pusher.PrivateChannel.prototype.handleEvent.call(this,a,b)}},b.disconnect=function(){this.members.reset(),Pusher.PrivateChannel.prototype.disconnect.call(this)},Pusher.PresenceChannel=a}.call(this),function(){function a(){this.channels={}
}function b(a,b){return 0===a.indexOf("private-")?new Pusher.PrivateChannel(a,b):0===a.indexOf("presence-")?new Pusher.PresenceChannel(a,b):new Pusher.Channel(a,b)}var c=a.prototype;c.add=function(a,c){return this.channels[a]||(this.channels[a]=b(a,c)),this.channels[a]},c.all=function(){return Pusher.Util.values(this.channels)},c.find=function(a){return this.channels[a]},c.remove=function(a){var b=this.channels[a];return delete this.channels[a],b},c.disconnect=function(){Pusher.Util.objectApply(this.channels,function(a){a.disconnect()})},Pusher.Channels=a}.call(this),function(){Pusher.Channel.Authorizer=function(a,b){this.channel=a,this.type=b.authTransport,this.options=b,this.authOptions=(b||{}).auth||{}},Pusher.Channel.Authorizer.prototype={composeQuery:function(a){var b="&socket_id="+encodeURIComponent(a)+"&channel_name="+encodeURIComponent(this.channel.name);for(var c in this.authOptions.params)b+="&"+encodeURIComponent(c)+"="+encodeURIComponent(this.authOptions.params[c]);return b},authorize:function(a,b){return Pusher.authorizers[this.type].call(this,a,b)}};var a=1;Pusher.auth_callbacks={},Pusher.authorizers={ajax:function(a,b){var c,d=this;c=Pusher.XHR?new Pusher.XHR:window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),c.open("POST",d.options.authEndpoint,!0),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var e in this.authOptions.headers)c.setRequestHeader(e,this.authOptions.headers[e]);return c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){var a,d=!1;try{a=JSON.parse(c.responseText),d=!0}catch(e){b(!0,"JSON returned from webapp was invalid, yet status code was 200. Data was: "+c.responseText)}d&&b(!1,a)}else Pusher.warn("Couldn't get auth info from your webapp",c.status),b(!0,c.status)},c.send(this.composeQuery(a)),c},jsonp:function(b,c){void 0!==this.authOptions.headers&&Pusher.warn("Warn","To send headers with the auth request, you must use AJAX, rather than JSONP.");var d=a.toString();a++;var e=Pusher.Util.getDocument(),f=e.createElement("script");Pusher.auth_callbacks[d]=function(a){c(!1,a)};var g="Pusher.auth_callbacks['"+d+"']";f.src=this.options.authEndpoint+"?callback="+encodeURIComponent(g)+this.composeQuery(b);var h=e.getElementsByTagName("head")[0]||e.documentElement;h.insertBefore(f,h.firstChild)}}}.call(this),"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="ui.router"),function(a,b,c){"use strict";function d(a,b){return I(new(I(function(){},{prototype:a})),b)}function e(a){return H(arguments,function(b){b!==a&&H(b,function(b,c){a.hasOwnProperty(c)||(a[c]=b)})}),a}function f(a,b){var c=[];for(var d in a.path){if(a.path[d]!==b.path[d])break;c.push(a.path[d])}return c}function g(a,b){if(Array.prototype.indexOf)return a.indexOf(b,Number(arguments[2])||0);var c=a.length>>>0,d=Number(arguments[2])||0;for(d=0>d?Math.ceil(d):Math.floor(d),0>d&&(d+=c);c>d;d++)if(d in a&&a[d]===b)return d;return-1}function h(a,b,c,d){var e,h=f(c,d),i={},j=[];for(var k in h)if(h[k].params&&h[k].params.length){e=h[k].params;for(var l in e)g(j,e[l])>=0||(j.push(e[l]),i[e[l]]=a[e[l]])}return I({},i,b)}function i(a,b){var c={};return H(a,function(a){var d=b[a];c[a]=null!=d?String(d):null}),c}function j(a,b,c){if(!c){c=[];for(var d in a)c.push(d)}for(var e=0;e<c.length;e++){var f=c[e];if(a[f]!=b[f])return!1}return!0}function k(a,b){var c={};return H(a,function(a){c[a]=b[a]}),c}function l(a,b){var d=1,f=2,g={},h=[],i=g,j=I(a.when(g),{$$promises:g,$$values:g});this.study=function(g){function k(a,c){if(o[c]!==f){if(n.push(c),o[c]===d)throw n.splice(0,n.indexOf(c)),new Error("Cyclic dependency: "+n.join(" -> "));if(o[c]=d,E(a))m.push(c,[function(){return b.get(a)}],h);else{var e=b.annotate(a);H(e,function(a){a!==c&&g.hasOwnProperty(a)&&k(g[a],a)}),m.push(c,a,e)}n.pop(),o[c]=f}}function l(a){return F(a)&&a.then&&a.$$promises}if(!F(g))throw new Error("'invocables' must be an object");var m=[],n=[],o={};return H(g,k),g=n=o=null,function(d,f,g){function h(){--s||(t||e(r,f.$$values),p.$$values=r,p.$$promises=!0,o.resolve(r))}function k(a){p.$$failure=a,o.reject(a)}function n(c,e,f){function i(a){l.reject(a),k(a)}function j(){if(!C(p.$$failure))try{l.resolve(b.invoke(e,g,r)),l.promise.then(function(a){r[c]=a,h()},i)}catch(a){i(a)}}var l=a.defer(),m=0;H(f,function(a){q.hasOwnProperty(a)&&!d.hasOwnProperty(a)&&(m++,q[a].then(function(b){r[a]=b,--m||j()},i))}),m||j(),q[c]=l.promise}if(l(d)&&g===c&&(g=f,f=d,d=null),d){if(!F(d))throw new Error("'locals' must be an object")}else d=i;if(f){if(!l(f))throw new Error("'parent' must be a promise returned by $resolve.resolve()")}else f=j;var o=a.defer(),p=o.promise,q=p.$$promises={},r=I({},d),s=1+m.length/3,t=!1;if(C(f.$$failure))return k(f.$$failure),p;f.$$values?(t=e(r,f.$$values),h()):(I(q,f.$$promises),f.then(h,k));for(var u=0,v=m.length;v>u;u+=3)d.hasOwnProperty(m[u])?h():n(m[u],m[u+1],m[u+2]);return p}},this.resolve=function(a,b,c,d){return this.study(a)(b,c,d)}}function m(a,b,c){this.fromConfig=function(a,b,c){return C(a.template)?this.fromString(a.template,b):C(a.templateUrl)?this.fromUrl(a.templateUrl,b):C(a.templateProvider)?this.fromProvider(a.templateProvider,b,c):null},this.fromString=function(a,b){return D(a)?a(b):a},this.fromUrl=function(c,d){return D(c)&&(c=c(d)),null==c?null:a.get(c,{cache:b}).then(function(a){return a.data})},this.fromProvider=function(a,b,d){return c.invoke(a,null,d||{params:b})}}function n(a){function b(b){if(!/^\w+(-+\w+)*$/.test(b))throw new Error("Invalid parameter name '"+b+"' in pattern '"+a+"'");if(f[b])throw new Error("Duplicate parameter name '"+b+"' in pattern '"+a+"'");f[b]=!0,j.push(b)}function c(a){return a.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&")}var d,e=/([:*])(\w+)|\{(\w+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,f={},g="^",h=0,i=this.segments=[],j=this.params=[];this.source=a;for(var k,l,m;(d=e.exec(a))&&(k=d[2]||d[3],l=d[4]||("*"==d[1]?".*":"[^/]*"),m=a.substring(h,d.index),!(m.indexOf("?")>=0));)g+=c(m)+"("+l+")",b(k),i.push(m),h=e.lastIndex;m=a.substring(h);var n=m.indexOf("?");if(n>=0){var o=this.sourceSearch=m.substring(n);m=m.substring(0,n),this.sourcePath=a.substring(0,h+n),H(o.substring(1).split(/[&?]/),b)}else this.sourcePath=a,this.sourceSearch="";g+=c(m)+"$",i.push(m),this.regexp=new RegExp(g),this.prefix=i[0]}function o(){this.compile=function(a){return new n(a)},this.isMatcher=function(a){return F(a)&&D(a.exec)&&D(a.format)&&D(a.concat)},this.$get=function(){return this}}function p(a){function b(a){var b=/^\^((?:\\[^a-zA-Z0-9]|[^\\\[\]\^$*+?.()|{}]+)*)/.exec(a.source);return null!=b?b[1].replace(/\\(.)/g,"$1"):""}function c(a,b){return a.replace(/\$(\$|\d{1,2})/,function(a,c){return b["$"===c?0:Number(c)]})}function d(a,b,c){if(!c)return!1;var d=a.invoke(b,b,{$match:c});return C(d)?d:!0}var e=[],f=null;this.rule=function(a){if(!D(a))throw new Error("'rule' must be a function");return e.push(a),this},this.otherwise=function(a){if(E(a)){var b=a;a=function(){return b}}else if(!D(a))throw new Error("'rule' must be a function");return f=a,this},this.when=function(e,f){var g,h=E(f);if(E(e)&&(e=a.compile(e)),!h&&!D(f)&&!G(f))throw new Error("invalid 'handler' in when()");var i={matcher:function(b,c){return h&&(g=a.compile(c),c=["$match",function(a){return g.format(a)}]),I(function(a,e){return d(a,c,b.exec(e.path(),e.search()))},{prefix:E(b.prefix)?b.prefix:""})},regex:function(a,e){if(a.global||a.sticky)throw new Error("when() RegExp must not be global or sticky");return h&&(g=e,e=["$match",function(a){return c(g,a)}]),I(function(b,c){return d(b,e,a.exec(c.path()))},{prefix:b(a)})}},j={matcher:a.isMatcher(e),regex:e instanceof RegExp};for(var k in j)if(j[k])return this.rule(i[k](e,f));throw new Error("invalid 'what' in when()")},this.$get=["$location","$rootScope","$injector",function(a,b,c){function d(b){function d(b){var d=b(c,a);return d?(E(d)&&a.replace().url(d),!0):!1}if(!b||!b.defaultPrevented){var g,h=e.length;for(g=0;h>g;g++)if(d(e[g]))return;f&&d(f)}}return b.$on("$locationChangeSuccess",d),{sync:function(){d()}}}]}function q(a,e,f){function g(a){return 0===a.indexOf(".")||0===a.indexOf("^")}function l(a,b){var d=E(a),e=d?a:a.name,f=g(e);if(f){if(!b)throw new Error("No reference point given for path '"+e+"'");for(var h=e.split("."),i=0,j=h.length,k=b;j>i;i++)if(""!==h[i]||0!==i){if("^"!==h[i])break;if(!k.parent)throw new Error("Path '"+e+"' not valid for state '"+b.name+"'");k=k.parent}else k=b;h=h.slice(i).join("."),e=k.name+(k.name&&h?".":"")+h}var l=w[e];return!l||!d&&(d||l!==a&&l.self!==a)?c:l}function m(a,b){x[a]||(x[a]=[]),x[a].push(b)}function n(b){b=d(b,{self:b,resolve:b.resolve||{},toString:function(){return this.name}});var c=b.name;if(!E(c)||c.indexOf("@")>=0)throw new Error("State must have a valid name");if(w.hasOwnProperty(c))throw new Error("State '"+c+"'' is already defined");var e=-1!==c.indexOf(".")?c.substring(0,c.lastIndexOf(".")):E(b.parent)?b.parent:"";if(e&&!w[e])return m(e,b.self);for(var f in z)D(z[f])&&(b[f]=z[f](b,z.$delegates[f]));if(w[c]=b,!b[y]&&b.url&&a.when(b.url,["$match","$stateParams",function(a,c){v.$current.navigable==b&&j(a,c)||v.transitionTo(b,a,{location:!1})}]),x[c])for(var g=0;g<x[c].length;g++)n(x[c][g]);return b}function o(a){return a.indexOf("*")>-1}function p(a){var b=a.split("."),c=v.$current.name.split(".");if("**"===b[0]&&(c=c.slice(c.indexOf(b[1])),c.unshift("**")),"**"===b[b.length-1]&&(c.splice(c.indexOf(b[b.length-2])+1,Number.MAX_VALUE),c.push("**")),b.length!=c.length)return!1;for(var d=0,e=b.length;e>d;d++)"*"===b[d]&&(c[d]="*");return c.join("")===b.join("")}function q(a,b){return E(a)&&!C(b)?z[a]:D(b)&&E(a)?(z[a]&&!z.$delegates[a]&&(z.$delegates[a]=z[a]),z[a]=b,this):this}function r(a,b){return F(a)?b=a:b.name=a,n(b),this}function s(a,e,g,m,n,q,r,s,x){function z(){r.url()!==M&&(r.url(M),r.replace())}function A(a,c,d,f,h){var i=d?c:k(a.params,c),j={$stateParams:i};h.resolve=n.resolve(a.resolve,j,h.resolve,a);var l=[h.resolve.then(function(a){h.globals=a})];return f&&l.push(f),H(a.views,function(c,d){var e=c.resolve&&c.resolve!==a.resolve?c.resolve:{};e.$template=[function(){return g.load(d,{view:c,locals:j,params:i,notify:!1})||""}],l.push(n.resolve(e,j,h.resolve,a).then(function(f){if(D(c.controllerProvider)||G(c.controllerProvider)){var g=b.extend({},e,j);f.$$controller=m.invoke(c.controllerProvider,null,g)}else f.$$controller=c.controller;f.$$state=a,f.$$controllerAs=c.controllerAs,h[d]=f}))}),e.all(l).then(function(){return h})}var B=e.reject(new Error("transition superseded")),F=e.reject(new Error("transition prevented")),K=e.reject(new Error("transition aborted")),L=e.reject(new Error("transition failed")),M=r.url(),N=x.baseHref();return u.locals={resolve:null,globals:{$stateParams:{}}},v={params:{},current:u.self,$current:u,transition:null},v.reload=function(){v.transitionTo(v.current,q,{reload:!0,inherit:!1,notify:!1})},v.go=function(a,b,c){return this.transitionTo(a,b,I({inherit:!0,relative:v.$current},c))},v.transitionTo=function(b,c,f){c=c||{},f=I({location:!0,inherit:!1,relative:null,notify:!0,reload:!1,$retry:!1},f||{});var g,k=v.$current,n=v.params,o=k.path,p=l(b,f.relative);if(!C(p)){var s={to:b,toParams:c,options:f};if(g=a.$broadcast("$stateNotFound",s,k.self,n),g.defaultPrevented)return z(),K;if(g.retry){if(f.$retry)return z(),L;var w=v.transition=e.when(g.retry);return w.then(function(){return w!==v.transition?B:(s.options.$retry=!0,v.transitionTo(s.to,s.toParams,s.options))},function(){return K}),z(),w}if(b=s.to,c=s.toParams,f=s.options,p=l(b,f.relative),!C(p)){if(f.relative)throw new Error("Could not resolve '"+b+"' from state '"+f.relative+"'");throw new Error("No such state '"+b+"'")}}if(p[y])throw new Error("Cannot transition to abstract state '"+b+"'");f.inherit&&(c=h(q,c||{},v.$current,p)),b=p;var x,D,E=b.path,G=u.locals,H=[];for(x=0,D=E[x];D&&D===o[x]&&j(c,n,D.ownParams)&&!f.reload;x++,D=E[x])G=H[x]=D.locals;if(t(b,k,G,f))return b.self.reloadOnSearch!==!1&&z(),v.transition=null,e.when(v.current);if(c=i(b.params,c||{}),f.notify&&(g=a.$broadcast("$stateChangeStart",b.self,c,k.self,n),g.defaultPrevented))return z(),F;for(var N=e.when(G),O=x;O<E.length;O++,D=E[O])G=H[O]=d(G),N=A(D,c,D===b,N,G);var P=v.transition=N.then(function(){var d,e,g;if(v.transition!==P)return B;for(d=o.length-1;d>=x;d--)g=o[d],g.self.onExit&&m.invoke(g.self.onExit,g.self,g.locals.globals),g.locals=null;for(d=x;d<E.length;d++)e=E[d],e.locals=H[d],e.self.onEnter&&m.invoke(e.self.onEnter,e.self,e.locals.globals);if(v.transition!==P)return B;v.$current=b,v.current=b.self,v.params=c,J(v.params,q),v.transition=null;var h=b.navigable;return f.location&&h&&(r.url(h.url.format(h.locals.globals.$stateParams)),"replace"===f.location&&r.replace()),f.notify&&a.$broadcast("$stateChangeSuccess",b.self,c,k.self,n),M=r.url(),v.current},function(d){return v.transition!==P?B:(v.transition=null,a.$broadcast("$stateChangeError",b.self,c,k.self,n,d),z(),e.reject(d))});return P},v.is=function(a,d){var e=l(a);return C(e)?v.$current!==e?!1:C(d)&&null!==d?b.equals(q,d):!0:c},v.includes=function(a,d){if(E(a)&&o(a)){if(!p(a))return!1;a=v.$current.name}var e=l(a);if(!C(e))return c;if(!C(v.$current.includes[e.name]))return!1;var f=!0;return b.forEach(d,function(a,b){C(q[b])&&q[b]===a||(f=!1)}),f},v.href=function(a,b,c){c=I({lossy:!0,inherit:!1,absolute:!1,relative:v.$current},c||{});var d=l(a,c.relative);if(!C(d))return null;b=h(q,b||{},v.$current,d);var e=d&&c.lossy?d.navigable:d,g=e&&e.url?e.url.format(i(d.params,b||{})):null;return!f.html5Mode()&&g&&(g="#"+f.hashPrefix()+g),"/"!==N&&(f.html5Mode()?g=N.slice(0,-1)+g:c.absolute&&(g=N.slice(1)+g)),c.absolute&&g&&(g=r.protocol()+"://"+r.host()+(80==r.port()||443==r.port()?"":":"+r.port())+(!f.html5Mode()&&g?"/":"")+g),g},v.get=function(a,b){if(!C(a)){var c=[];return H(w,function(a){c.push(a.self)}),c}var d=l(a,b);return d&&d.self?d.self:null},v}function t(a,b,c,d){return a!==b||(c!==b.locals||d.reload)&&a.self.reloadOnSearch!==!1?void 0:!0}var u,v,w={},x={},y="abstract",z={parent:function(a){if(C(a.parent)&&a.parent)return l(a.parent);var b=/^(.+)\.[^.]+$/.exec(a.name);return b?l(b[1]):u},data:function(a){return a.parent&&a.parent.data&&(a.data=a.self.data=I({},a.parent.data,a.data)),a.data},url:function(a){var b=a.url;if(E(b))return"^"==b.charAt(0)?e.compile(b.substring(1)):(a.parent.navigable||u).url.concat(b);if(e.isMatcher(b)||null==b)return b;throw new Error("Invalid url '"+b+"' in state '"+a+"'")},navigable:function(a){return a.url?a:a.parent?a.parent.navigable:null},params:function(a){if(!a.params)return a.url?a.url.parameters():a.parent.params;if(!G(a.params))throw new Error("Invalid params in state '"+a+"'");if(a.url)throw new Error("Both params and url specicified in state '"+a+"'");return a.params},views:function(a){var b={};return H(C(a.views)?a.views:{"":a},function(c,d){d.indexOf("@")<0&&(d+="@"+a.parent.name),b[d]=c}),b},ownParams:function(a){if(!a.parent)return a.params;var b={};H(a.params,function(a){b[a]=!0}),H(a.parent.params,function(c){if(!b[c])throw new Error("Missing required parameter '"+c+"' in state '"+a.name+"'");b[c]=!1});var c=[];return H(b,function(a,b){a&&c.push(b)}),c},path:function(a){return a.parent?a.parent.path.concat(a):[]},includes:function(a){var b=a.parent?I({},a.parent.includes):{};return b[a.name]=!0,b},$delegates:{}};u=n({name:"",url:"^",views:null,"abstract":!0}),u.navigable=null,this.decorator=q,this.state=r,this.$get=s,s.$inject=["$rootScope","$q","$view","$injector","$resolve","$stateParams","$location","$urlRouter","$browser"]}function r(){function a(a,b){return{load:function(c,d){var e,f={template:null,controller:null,view:null,locals:null,notify:!0,async:!0,params:{}};return d=I(f,d),d.view&&(e=b.fromConfig(d.view,d.params,d.locals)),e&&d.notify&&a.$broadcast("$viewContentLoading",d),e}}}this.$get=a,a.$inject=["$rootScope","$templateFactory"]}function s(){var a=!1;this.useAnchorScroll=function(){a=!0},this.$get=["$anchorScroll","$timeout",function(b,c){return a?b:function(a){c(function(){a[0].scrollIntoView()},0,!1)}}]}function t(a,c,d){function e(){return c.has?function(a){return c.has(a)?c.get(a):null}:function(a){try{return c.get(a)}catch(b){return null}}}function f(a,b){var c=function(){return{enter:function(a,b,c){b.after(a),c()},leave:function(a,b){a.remove(),b()}}};if(i)return{enter:function(a,b,c){i.enter(a,null,b,c)},leave:function(a,b){i.leave(a,b)}};if(h){var d=h&&h(b,a);return{enter:function(a,b,c){d.enter(a,null,b),c()},leave:function(a,b){d.leave(a),b()}}}return c()}var g=e(),h=g("$animator"),i=g("$animate"),j={restrict:"ECA",terminal:!0,priority:400,transclude:"element",compile:function(c,e,g){return function(c,e,h){function i(){k&&(k.remove(),k=null),m&&(m.$destroy(),m=null),l&&(q.leave(l,function(){k=null}),k=l,l=null)}function j(f){var h=c.$new(),j=l&&l.data("$uiViewName"),k=j&&a.$current&&a.$current.locals[j];if(f||k!==n){var r=g(h,function(a){q.enter(a,e,function(){(b.isDefined(p)&&!p||c.$eval(p))&&d(a)}),i()});n=a.$current.locals[r.data("$uiViewName")],l=r,m=h,m.$emit("$viewContentLoaded"),m.$eval(o)}}var k,l,m,n,o=h.onload||"",p=h.autoscroll,q=f(h,c);c.$on("$stateChangeSuccess",function(){j(!1)}),c.$on("$viewContentLoading",function(){j(!1)}),j(!0)}}};return j}function u(a,b,c){return{restrict:"ECA",priority:-400,compile:function(d){var e=d.html();return function(d,f,g){var h=g.uiView||g.name||"",i=f.inheritedData("$uiView");h.indexOf("@")<0&&(h=h+"@"+(i?i.state.name:"")),f.data("$uiViewName",h);var j=c.$current,k=j&&j.locals[h];if(k){f.data("$uiView",{name:h,state:k.$$state}),f.html(k.$template?k.$template:e);var l=a(f.contents());if(k.$$controller){k.$scope=d;var m=b(k.$$controller,k);k.$$controllerAs&&(d[k.$$controllerAs]=m),f.data("$ngControllerController",m),f.children().data("$ngControllerController",m)}l(d)}}}}}function v(a){var b=a.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/);if(!b||4!==b.length)throw new Error("Invalid state ref '"+a+"'");return{state:b[1],paramExpr:b[3]||null}}function w(a){var b=a.parent().inheritedData("$uiView");return b&&b.state&&b.state.name?b.state:void 0}function x(a,c){var d=["location","inherit","reload"];return{restrict:"A",require:"?^uiSrefActive",link:function(e,f,g,h){var i=v(g.uiSref),j=null,k=w(f)||a.$current,l="FORM"===f[0].nodeName,m=l?"action":"href",n=!0,o={relative:k},p=e.$eval(g.uiSrefOpts)||{};b.forEach(d,function(a){a in p&&(o[a]=p[a])});var q=function(b){if(b&&(j=b),n){var c=a.href(i.state,j,o);return h&&h.$$setStateInfo(i.state,j),c?void(f[0][m]=c):(n=!1,!1)}};i.paramExpr&&(e.$watch(i.paramExpr,function(a){a!==j&&q(a)},!0),j=e.$eval(i.paramExpr)),q(),l||f.bind("click",function(b){var d=b.which||b.button;d>1||b.ctrlKey||b.metaKey||b.shiftKey||f.attr("target")||(c(function(){a.go(i.state,j,o)}),b.preventDefault())})}}}function y(a,b,c){return{restrict:"A",controller:["$scope","$element","$attrs",function(d,e,f){function g(){a.$current.self===i&&h()?e.addClass(l):e.removeClass(l)}function h(){return!k||j(k,b)}var i,k,l;l=c(f.uiSrefActive||"",!1)(d),this.$$setStateInfo=function(b,c){i=a.get(b,w(e)),k=c,g()},d.$on("$stateChangeSuccess",g)}]}}function z(a){return function(b){return a.is(b)}}function A(a){return function(b){return a.includes(b)}}function B(a,b){function e(a){this.locals=a.locals.globals,this.params=this.locals.$stateParams}function f(){this.locals=null,this.params=null}function g(c,g){if(null!=g.redirectTo){var h,j=g.redirectTo;if(E(j))h=j;else{if(!D(j))throw new Error("Invalid 'redirectTo' in when()");h=function(a,b){return j(a,b.path(),b.search())}}b.when(c,h)}else a.state(d(g,{parent:null,name:"route:"+encodeURIComponent(c),url:c,onEnter:e,onExit:f}));return i.push(g),this}function h(a,b,d){function e(a){return""!==a.name?a:c}var f={routes:i,params:d,current:c};return b.$on("$stateChangeStart",function(a,c,d,f){b.$broadcast("$routeChangeStart",e(c),e(f))}),b.$on("$stateChangeSuccess",function(a,c,d,g){f.current=e(c),b.$broadcast("$routeChangeSuccess",e(c),e(g)),J(d,f.params)}),b.$on("$stateChangeError",function(a,c,d,f,g,h){b.$broadcast("$routeChangeError",e(c),e(f),h)}),f}var i=[];e.$inject=["$$state"],this.when=g,this.$get=h,h.$inject=["$state","$rootScope","$routeParams"]}var C=b.isDefined,D=b.isFunction,E=b.isString,F=b.isObject,G=b.isArray,H=b.forEach,I=b.extend,J=b.copy;b.module("ui.router.util",["ng"]),b.module("ui.router.router",["ui.router.util"]),b.module("ui.router.state",["ui.router.router","ui.router.util"]),b.module("ui.router",["ui.router.state"]),b.module("ui.router.compat",["ui.router"]),l.$inject=["$q","$injector"],b.module("ui.router.util").service("$resolve",l),m.$inject=["$http","$templateCache","$injector"],b.module("ui.router.util").service("$templateFactory",m),n.prototype.concat=function(a){return new n(this.sourcePath+a+this.sourceSearch)},n.prototype.toString=function(){return this.source},n.prototype.exec=function(a,b){var c=this.regexp.exec(a);if(!c)return null;var d,e=this.params,f=e.length,g=this.segments.length-1,h={};if(g!==c.length-1)throw new Error("Unbalanced capture group in route '"+this.source+"'");for(d=0;g>d;d++)h[e[d]]=c[d+1];for(;f>d;d++)h[e[d]]=b[e[d]];return h},n.prototype.parameters=function(){return this.params},n.prototype.format=function(a){var b=this.segments,c=this.params;if(!a)return b.join("");var d,e,f,g=b.length-1,h=c.length,i=b[0];for(d=0;g>d;d++)f=a[c[d]],null!=f&&(i+=encodeURIComponent(f)),i+=b[d+1];for(;h>d;d++)f=a[c[d]],null!=f&&(i+=(e?"&":"?")+c[d]+"="+encodeURIComponent(f),e=!0);return i},b.module("ui.router.util").provider("$urlMatcherFactory",o),p.$inject=["$urlMatcherFactoryProvider"],b.module("ui.router.router").provider("$urlRouter",p),q.$inject=["$urlRouterProvider","$urlMatcherFactoryProvider","$locationProvider"],b.module("ui.router.state").value("$stateParams",{}).provider("$state",q),r.$inject=[],b.module("ui.router.state").provider("$view",r),b.module("ui.router.state").provider("$uiViewScroll",s),t.$inject=["$state","$injector","$uiViewScroll"],u.$inject=["$compile","$controller","$state"],b.module("ui.router.state").directive("uiView",t),b.module("ui.router.state").directive("uiView",u),x.$inject=["$state","$timeout"],y.$inject=["$state","$stateParams","$interpolate"],b.module("ui.router.state").directive("uiSref",x).directive("uiSrefActive",y),z.$inject=["$state"],A.$inject=["$state"],b.module("ui.router.state").filter("isState",z).filter("includedByState",A),B.$inject=["$stateProvider","$urlRouterProvider"],b.module("ui.router.compat").provider("$route",B).directive("ngView",t)}(window,window.angular),angular.module("ui.alias",[]).config(["$compileProvider","uiAliasConfig",function(a,b){b=b||{},angular.forEach(b,function(b,c){angular.isString(b)&&(b={replace:!0,template:b}),a.directive(c,function(){return b})})}]),angular.module("ui.event",[]).directive("uiEvent",["$parse",function(a){return function(b,c,d){var e=b.$eval(d.uiEvent);angular.forEach(e,function(d,e){var f=a(d);c.bind(e,function(a){var c=Array.prototype.slice.call(arguments);c=c.splice(1),f(b,{$event:a,$params:c}),b.$$phase||b.$apply()})})}}]),angular.module("ui.format",[]).filter("format",function(){return function(a,b){var c=a;if(angular.isString(c)&&void 0!==b)if(angular.isArray(b)||angular.isObject(b)||(b=[b]),angular.isArray(b)){var d=b.length,e=function(a,c){return c=parseInt(c,10),c>=0&&d>c?b[c]:a};c=c.replace(/\$([0-9]+)/g,e)}else angular.forEach(b,function(a,b){c=c.split(":"+b).join(a)});return c}}),angular.module("ui.highlight",[]).filter("highlight",function(){return function(a,b,c){return b||angular.isNumber(b)?(a=a.toString(),b=b.toString(),c?a.split(b).join('<span class="ui-match">'+b+"</span>"):a.replace(new RegExp(b,"gi"),'<span class="ui-match">$&</span>')):a}}),angular.module("ui.include",[]).directive("uiInclude",["$http","$templateCache","$anchorScroll","$compile",function(a,b,c,d){return{restrict:"ECA",terminal:!0,compile:function(e,f){var g=f.uiInclude||f.src,h=f.fragment||"",i=f.onload||"",j=f.autoscroll;return function(e,f){function k(){var k=++m,o=e.$eval(g),p=e.$eval(h);o?a.get(o,{cache:b}).success(function(a){if(k===m){l&&l.$destroy(),l=e.$new();var b;b=p?angular.element("<div/>").html(a).find(p):angular.element("<div/>").html(a).contents(),f.html(b),d(b)(l),!angular.isDefined(j)||j&&!e.$eval(j)||c(),l.$emit("$includeContentLoaded"),e.$eval(i)}}).error(function(){k===m&&n()}):n()}var l,m=0,n=function(){l&&(l.$destroy(),l=null),f.html("")};e.$watch(h,k),e.$watch(g,k)}}}}]),angular.module("ui.indeterminate",[]).directive("uiIndeterminate",[function(){return{compile:function(a,b){return b.type&&"checkbox"===b.type.toLowerCase()?function(a,b,c){a.$watch(c.uiIndeterminate,function(a){b[0].indeterminate=!!a})}:angular.noop}}}]),angular.module("ui.inflector",[]).filter("inflector",function(){function a(a){return a.replace(/^([a-z])|\s+([a-z])/g,function(a){return a.toUpperCase()})}function b(a,b){return a.replace(/[A-Z]/g,function(a){return b+a})}var c={humanize:function(c){return a(b(c," ").split("_").join(" "))},underscore:function(a){return a.substr(0,1).toLowerCase()+b(a.substr(1),"_").toLowerCase().split(" ").join("_")},variable:function(b){return b=b.substr(0,1).toLowerCase()+a(b.split("_").join(" ")).substr(1).split(" ").join("")}};return function(a,b){return b!==!1&&angular.isString(a)?(b=b||"humanize",c[b](a)):a}}),angular.module("ui.jq",[]).value("uiJqConfig",{}).directive("uiJq",["uiJqConfig","$timeout",function(a,b){return{restrict:"A",compile:function(c,d){if(!angular.isFunction(c[d.uiJq]))throw new Error('ui-jq: The "'+d.uiJq+'" function does not exist');var e=a&&a[d.uiJq];return function(a,c,d){function f(){b(function(){c[d.uiJq].apply(c,g)},0,!1)}var g=[];d.uiOptions?(g=a.$eval("["+d.uiOptions+"]"),angular.isObject(e)&&angular.isObject(g[0])&&(g[0]=angular.extend({},e,g[0]))):e&&(g=[e]),d.ngModel&&c.is("select,input,textarea")&&c.bind("change",function(){c.trigger("input")}),d.uiRefresh&&a.$watch(d.uiRefresh,function(){f()}),f()}}}}]),angular.module("ui.keypress",[]).factory("keypressHelper",["$parse",function(a){var b={8:"backspace",9:"tab",13:"enter",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete"},c=function(a){return a.charAt(0).toUpperCase()+a.slice(1)};return function(d,e,f,g){var h,i=[];h=e.$eval(g["ui"+c(d)]),angular.forEach(h,function(b,c){var d,e;e=a(b),angular.forEach(c.split(" "),function(a){d={expression:e,keys:{}},angular.forEach(a.split("-"),function(a){d.keys[a]=!0}),i.push(d)})}),f.bind(d,function(a){var c=!(!a.metaKey||a.ctrlKey),f=!!a.altKey,g=!!a.ctrlKey,h=!!a.shiftKey,j=a.keyCode;"keypress"===d&&!h&&j>=97&&122>=j&&(j-=32),angular.forEach(i,function(d){var i=d.keys[b[j]]||d.keys[j.toString()],k=!!d.keys.meta,l=!!d.keys.alt,m=!!d.keys.ctrl,n=!!d.keys.shift;i&&k===c&&l===f&&m===g&&n===h&&e.$apply(function(){d.expression(e,{$event:a})})})})}}]),angular.module("ui.keypress").directive("uiKeydown",["keypressHelper",function(a){return{link:function(b,c,d){a("keydown",b,c,d)}}}]),angular.module("ui.keypress").directive("uiKeypress",["keypressHelper",function(a){return{link:function(b,c,d){a("keypress",b,c,d)}}}]),angular.module("ui.keypress").directive("uiKeyup",["keypressHelper",function(a){return{link:function(b,c,d){a("keyup",b,c,d)}}}]),angular.module("ui.mask",[]).value("uiMaskConfig",{maskDefinitions:{9:/\d/,A:/[a-zA-Z]/,"*":/[a-zA-Z0-9]/}}).directive("uiMask",["uiMaskConfig",function(a){return{priority:100,require:"ngModel",restrict:"A",compile:function(){var b=a;return function(a,c,d,e){function f(a){return angular.isDefined(a)?(s(a),N?(k(),l(),!0):j()):j()}function g(a){angular.isDefined(a)&&(D=a,N&&w())}function h(a){return N?(G=o(a||""),I=n(G),e.$setValidity("mask",I),I&&G.length?p(G):void 0):a}function i(a){return N?(G=o(a||""),I=n(G),e.$viewValue=G.length?p(G):"",e.$setValidity("mask",I),""===G&&void 0!==e.$error.required&&e.$setValidity("required",!1),I?G:void 0):a}function j(){return N=!1,m(),angular.isDefined(P)?c.attr("placeholder",P):c.removeAttr("placeholder"),angular.isDefined(Q)?c.attr("maxlength",Q):c.removeAttr("maxlength"),c.val(e.$modelValue),e.$viewValue=e.$modelValue,!1}function k(){G=K=o(e.$modelValue||""),H=J=p(G),I=n(G);var a=I&&G.length?H:"";d.maxlength&&c.attr("maxlength",2*B[B.length-1]),c.attr("placeholder",D),c.val(a),e.$viewValue=a}function l(){O||(c.bind("blur",t),c.bind("mousedown mouseup",u),c.bind("input keyup click focus",w),O=!0)}function m(){O&&(c.unbind("blur",t),c.unbind("mousedown",u),c.unbind("mouseup",u),c.unbind("input",w),c.unbind("keyup",w),c.unbind("click",w),c.unbind("focus",w),O=!1)}function n(a){return a.length?a.length>=F:!0}function o(a){var b="",c=C.slice();return a=a.toString(),angular.forEach(E,function(b){a=a.replace(b,"")}),angular.forEach(a.split(""),function(a){c.length&&c[0].test(a)&&(b+=a,c.shift())}),b}function p(a){var b="",c=B.slice();return angular.forEach(D.split(""),function(d,e){a.length&&e===c[0]?(b+=a.charAt(0)||"_",a=a.substr(1),c.shift()):b+=d}),b}function q(a){var b=d.placeholder;return"undefined"!=typeof b&&b[a]?b[a]:"_"}function r(){return D.replace(/[_]+/g,"_").replace(/([^_]+)([a-zA-Z0-9])([^_])/g,"$1$2_$3").split("_")}function s(a){var b=0;if(B=[],C=[],D="","string"==typeof a){F=0;var c=!1,d=a.split("");angular.forEach(d,function(a,d){R.maskDefinitions[a]?(B.push(b),D+=q(d),C.push(R.maskDefinitions[a]),b++,c||F++):"?"===a?c=!0:(D+=a,b++)})}B.push(B.slice().pop()+1),E=r(),N=B.length>1?!0:!1}function t(){L=0,M=0,I&&0!==G.length||(H="",c.val(""),a.$apply(function(){e.$setViewValue("")}))}function u(a){"mousedown"===a.type?c.bind("mouseout",v):c.unbind("mouseout",v)}function v(){M=A(this),c.unbind("mouseout",v)}function w(b){b=b||{};var d=b.which,f=b.type;if(16!==d&&91!==d){var g,h=c.val(),i=J,j=o(h),k=K,l=!1,m=y(this)||0,n=L||0,q=m-n,r=B[0],s=B[j.length]||B.slice().shift(),t=M||0,u=A(this)>0,v=t>0,w=h.length>i.length||t&&h.length>i.length-t,C=h.length<i.length||t&&h.length===i.length-t,D=d>=37&&40>=d&&b.shiftKey,E=37===d,F=8===d||"keyup"!==f&&C&&-1===q,G=46===d||"keyup"!==f&&C&&0===q&&!v,H=(E||F||"click"===f)&&m>r;if(M=A(this),!D&&(!u||"click"!==f&&"keyup"!==f)){if("input"===f&&C&&!v&&j===k){for(;F&&m>r&&!x(m);)m--;for(;G&&s>m&&-1===B.indexOf(m);)m++;var I=B.indexOf(m);j=j.substring(0,I)+j.substring(I+1),l=!0}for(g=p(j),J=g,K=j,c.val(g),l&&a.$apply(function(){e.$setViewValue(j)}),w&&r>=m&&(m=r+1),H&&m--,m=m>s?s:r>m?r:m;!x(m)&&m>r&&s>m;)m+=H?-1:1;(H&&s>m||w&&!x(n))&&m++,L=m,z(this,m)}}}function x(a){return B.indexOf(a)>-1}function y(a){if(void 0!==a.selectionStart)return a.selectionStart;if(document.selection){a.focus();var b=document.selection.createRange();return b.moveStart("character",-a.value.length),b.text.length}return 0}function z(a,b){if(0!==a.offsetWidth&&0!==a.offsetHeight)if(a.setSelectionRange)a.focus(),a.setSelectionRange(b,b);else if(a.createTextRange){var c=a.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",b),c.select()}}function A(a){return void 0!==a.selectionStart?a.selectionEnd-a.selectionStart:document.selection?document.selection.createRange().text.length:0}var B,C,D,E,F,G,H,I,J,K,L,M,N=!1,O=!1,P=d.placeholder,Q=d.maxlength,R={};d.uiOptions?(R=a.$eval("["+d.uiOptions+"]"),angular.isObject(R[0])&&(R=function(a,b){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]?angular.extend(b[c],a[c]):b[c]=angular.copy(a[c]));return b}(b,R[0]))):R=b,d.$observe("uiMask",f),d.$observe("placeholder",g),e.$formatters.push(h),e.$parsers.push(i),c.bind("mousedown mouseup",u),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){"use strict";if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>1&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&1/0!==d&&d!==-1/0&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1})}}}}]),angular.module("ui.reset",[]).value("uiResetConfig",null).directive("uiReset",["uiResetConfig",function(a){var b=null;
return void 0!==a&&(b=a),{require:"ngModel",link:function(a,c,d,e){var f;f=angular.element('<a class="ui-reset" />'),c.wrap('<span class="ui-resetwrap" />').after(f),f.bind("click",function(c){c.preventDefault(),a.$apply(function(){e.$setViewValue(d.uiReset?a.$eval(d.uiReset):b),e.$render()})})}}}]),angular.module("ui.route",[]).directive("uiRoute",["$location","$parse",function(a,b){return{restrict:"AC",scope:!0,compile:function(c,d){var e;if(d.uiRoute)e="uiRoute";else if(d.ngHref)e="ngHref";else{if(!d.href)throw new Error("uiRoute missing a route or href property on "+c[0]);e="href"}return function(c,d,f){function g(b){var d=b.indexOf("#");d>-1&&(b=b.substr(d+1)),(j=function(){i(c,a.path().indexOf(b)>-1)})()}function h(b){var d=b.indexOf("#");d>-1&&(b=b.substr(d+1)),(j=function(){var d=new RegExp("^"+b+"$",["i"]);i(c,d.test(a.path()))})()}var i=b(f.ngModel||f.routeModel||"$uiRoute").assign,j=angular.noop;switch(e){case"uiRoute":f.uiRoute?h(f.uiRoute):f.$observe("uiRoute",h);break;case"ngHref":f.ngHref?g(f.ngHref):f.$observe("ngHref",g);break;case"href":g(f.href)}c.$on("$routeChangeSuccess",function(){j()}),c.$on("$stateChangeSuccess",function(){j()})}}}}]),angular.module("ui.scroll.jqlite",["ui.scroll"]).service("jqLiteExtras",["$log","$window",function(a,b){return{registerFor:function(a){var c,d,e,f,g,h,i;return d=angular.element.prototype.css,a.prototype.css=function(a,b){var c,e;return e=this,c=e[0],c&&3!==c.nodeType&&8!==c.nodeType&&c.style?d.call(e,a,b):void 0},h=function(a){return a&&a.document&&a.location&&a.alert&&a.setInterval},i=function(a,b,c){var d,e,f,g,i;return d=a[0],i={top:["scrollTop","pageYOffset","scrollLeft"],left:["scrollLeft","pageXOffset","scrollTop"]}[b],e=i[0],g=i[1],f=i[2],h(d)?angular.isDefined(c)?d.scrollTo(a[f].call(a),c):g in d?d[g]:d.document.documentElement[e]:angular.isDefined(c)?d[e]=c:d[e]},b.getComputedStyle?(f=function(a){return b.getComputedStyle(a,null)},c=function(a,b){return parseFloat(b)}):(f=function(a){return a.currentStyle},c=function(a,b){var c,d,e,f,g,h,i;return c=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,f=new RegExp("^("+c+")(?!px)[a-z%]+$","i"),f.test(b)?(i=a.style,d=i.left,g=a.runtimeStyle,h=g&&g.left,g&&(g.left=i.left),i.left=b,e=i.pixelLeft,i.left=d,h&&(g.left=h),e):parseFloat(b)}),e=function(a,b){var d,e,g,i,j,k,l,m,n,o,p,q,r;return h(a)?(d=document.documentElement[{height:"clientHeight",width:"clientWidth"}[b]],{base:d,padding:0,border:0,margin:0}):(r={width:[a.offsetWidth,"Left","Right"],height:[a.offsetHeight,"Top","Bottom"]}[b],d=r[0],l=r[1],m=r[2],k=f(a),p=c(a,k["padding"+l])||0,q=c(a,k["padding"+m])||0,e=c(a,k["border"+l+"Width"])||0,g=c(a,k["border"+m+"Width"])||0,i=k["margin"+l],j=k["margin"+m],n=c(a,i)||0,o=c(a,j)||0,{base:d,padding:p+q,border:e+g,margin:n+o})},g=function(a,b,c){var d,g,h;return g=e(a,b),g.base>0?{base:g.base-g.padding-g.border,outer:g.base,outerfull:g.base+g.margin}[c]:(d=f(a),h=d[b],(0>h||null===h)&&(h=a.style[b]||0),h=parseFloat(h)||0,{base:h-g.padding-g.border,outer:h,outerfull:h+g.padding+g.border+g.margin}[c])},angular.forEach({before:function(a){var b,c,d,e,f,g,h;if(f=this,c=f[0],e=f.parent(),b=e.contents(),b[0]===c)return e.prepend(a);for(d=g=1,h=b.length-1;h>=1?h>=g:g>=h;d=h>=1?++g:--g)if(b[d]===c)return void angular.element(b[d-1]).after(a);throw new Error("invalid DOM structure "+c.outerHTML)},height:function(a){var b;return b=this,angular.isDefined(a)?(angular.isNumber(a)&&(a+="px"),d.call(b,"height",a)):g(this[0],"height","base")},outerHeight:function(a){return g(this[0],"height",a?"outerfull":"outer")},offset:function(a){var b,c,d,e,f,g;return f=this,arguments.length?void 0===a?f:setOffset:(b={top:0,left:0},e=f[0],(c=e&&e.ownerDocument)?(d=c.documentElement,null!=e.getBoundingClientRect&&(b=e.getBoundingClientRect()),g=c.defaultView||c.parentWindow,{top:b.top+(g.pageYOffset||d.scrollTop)-(d.clientTop||0),left:b.left+(g.pageXOffset||d.scrollLeft)-(d.clientLeft||0)}):void 0)},scrollTop:function(a){return i(this,"top",a)},scrollLeft:function(a){return i(this,"left",a)}},function(b,c){return a.prototype[c]?void 0:a.prototype[c]=b})}}}]).run(["$log","$window","jqLiteExtras",function(a,b,c){return b.jQuery?void 0:c.registerFor(angular.element)}]),angular.module("ui.scroll",[]).directive("ngScrollViewport",["$log",function(){return{controller:["$scope","$element",function(a,b){return b}]}}]).directive("ngScroll",["$log","$injector","$rootScope","$timeout",function(a,b,c,d){return{require:["?^ngScrollViewport"],transclude:"element",priority:1e3,terminal:!0,compile:function(e,f,g){return function(f,h,i,j){var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T;if(H=i.ngScroll.match(/^\s*(\w+)\s+in\s+(\w+)\s*$/),!H)throw new Error("Expected ngScroll in form of '_item_ in _datasource_' but got '"+i.ngScroll+"'");if(F=H[1],v=H[2],D=function(a){return angular.isObject(a)&&a.get&&angular.isFunction(a.get)},u=f[v],!D(u)&&(u=b.get(v),!D(u)))throw new Error(""+v+" is not a valid datasource");return r=Math.max(3,+i.bufferSize||10),q=function(){return T.height()*Math.max(.1,+i.padding||.1)},O=function(a){var b;return null!=(b=a[0].scrollHeight)?b:a[0].document.documentElement.scrollHeight},k=null,g(R=f.$new(),function(a){var b,c,d,f,g,h;if(f=a[0].localName,"dl"===f)throw new Error("ng-scroll directive does not support <"+a[0].localName+"> as a repeating tag: "+a[0].outerHTML);return"li"!==f&&"tr"!==f&&(f="div"),h=j[0]||angular.element(window),h.css({"overflow-y":"auto",display:"block"}),d=function(a){var b,c,d;switch(a){case"tr":return d=angular.element("<table><tr><td><div></div></td></tr></table>"),b=d.find("div"),c=d.find("tr"),c.paddingHeight=function(){return b.height.apply(b,arguments)},c;default:return c=angular.element("<"+a+"></"+a+">"),c.paddingHeight=c.height,c}},c=function(a,b,c){return b[{top:"before",bottom:"after"}[c]](a),{paddingHeight:function(){return a.paddingHeight.apply(a,arguments)},insert:function(b){return a[{top:"after",bottom:"before"}[c]](b)}}},g=c(d(f),e,"top"),b=c(d(f),e,"bottom"),R.$destroy(),k={viewport:h,topPadding:g.paddingHeight,bottomPadding:b.paddingHeight,append:b.insert,prepend:g.insert,bottomDataPos:function(){return O(h)-b.paddingHeight()},topDataPos:function(){return g.paddingHeight()}}}),T=k.viewport,B=1,I=1,p=[],J=[],x=!1,n=!1,G=u.loading||function(){},E=!1,L=function(a,b){var c,d;for(c=d=a;b>=a?b>d:d>b;c=b>=a?++d:--d)p[c].scope.$destroy(),p[c].element.remove();return p.splice(a,b-a)},K=function(){return B=1,I=1,L(0,p.length),k.topPadding(0),k.bottomPadding(0),J=[],x=!1,n=!1,l(!1)},o=function(){return T.scrollTop()+T.height()},S=function(){return T.scrollTop()},P=function(){return!x&&k.bottomDataPos()<o()+q()},s=function(){var b,c,d,e,f,g;for(b=0,e=0,c=f=g=p.length-1;(0>=g?0>=f:f>=0)&&(d=p[c].element.outerHeight(!0),k.bottomDataPos()-b-d>o()+q());c=0>=g?++f:--f)b+=d,e++,x=!1;return e>0?(k.bottomPadding(k.bottomPadding()+b),L(p.length-e,p.length),I-=e,a.log("clipped off bottom "+e+" bottom padding "+k.bottomPadding())):void 0},Q=function(){return!n&&k.topDataPos()>S()-q()},t=function(){var b,c,d,e,f,g;for(e=0,d=0,f=0,g=p.length;g>f&&(b=p[f],c=b.element.outerHeight(!0),k.topDataPos()+e+c<S()-q());f++)e+=c,d++,n=!1;return d>0?(k.topPadding(k.topPadding()+e),L(0,d),B+=d,a.log("clipped off top "+d+" top padding "+k.topPadding())):void 0},w=function(a,b){return E||(E=!0,G(!0)),1===J.push(a)?z(b):void 0},C=function(a,b){var c,d,e;return c=f.$new(),c[F]=b,d=a>B,c.$index=a,d&&c.$index--,e={scope:c},g(c,function(b){return e.element=b,d?a===I?(k.append(b),p.push(e)):(p[a-B].element.after(b),p.splice(a-B+1,0,e)):(k.prepend(b),p.unshift(e))}),{appended:d,wrapper:e}},m=function(a,b){var c;return a?k.bottomPadding(Math.max(0,k.bottomPadding()-b.element.outerHeight(!0))):(c=k.topPadding()-b.element.outerHeight(!0),c>=0?k.topPadding(c):T.scrollTop(T.scrollTop()+b.element.outerHeight(!0)))},l=function(b,c,e){var f;return f=function(){return a.log("top {actual="+k.topDataPos()+" visible from="+S()+" bottom {visible through="+o()+" actual="+k.bottomDataPos()+"}"),P()?w(!0,b):Q()&&w(!1,b),e?e():void 0},c?d(function(){var a,b,d;for(b=0,d=c.length;d>b;b++)a=c[b],m(a.appended,a.wrapper);return f()}):f()},A=function(a,b){return l(a,b,function(){return J.shift(),0===J.length?(E=!1,G(!1)):z(a)})},z=function(b){var c;return c=J[0],c?p.length&&!P()?A(b):u.get(I,r,function(c){var d,e,f,g;if(e=[],0===c.length)x=!0,k.bottomPadding(0),a.log("appended: requested "+r+" records starting from "+I+" recieved: eof");else{for(t(),f=0,g=c.length;g>f;f++)d=c[f],e.push(C(++I,d));a.log("appended: requested "+r+" received "+c.length+" buffer size "+p.length+" first "+B+" next "+I)}return A(b,e)}):p.length&&!Q()?A(b):u.get(B-r,r,function(c){var d,e,f,g;if(e=[],0===c.length)n=!0,k.topPadding(0),a.log("prepended: requested "+r+" records starting from "+(B-r)+" recieved: bof");else{for(s(),d=f=g=c.length-1;0>=g?0>=f:f>=0;d=0>=g?++f:--f)e.unshift(C(--B,c[d]));a.log("prepended: requested "+r+" received "+c.length+" buffer size "+p.length+" first "+B+" next "+I)}return A(b,e)})},M=function(){return c.$$phase||E?void 0:(l(!1),f.$apply())},T.bind("resize",M),N=function(){return c.$$phase||E?void 0:(l(!0),f.$apply())},T.bind("scroll",N),f.$watch(u.revision,function(){return K()}),y=u.scope?u.scope.$new():f.$new(),f.$on("$destroy",function(){return y.$destroy(),T.unbind("resize",M),T.unbind("scroll",N)}),y.$on("update.items",function(a,b,c){var d,e,f,g,h;if(angular.isFunction(b))for(e=function(a){return b(a.scope)},f=0,g=p.length;g>f;f++)d=p[f],e(d);else 0<=(h=b-B-1)&&h<p.length&&(p[b-B-1].scope[F]=c);return null}),y.$on("delete.items",function(a,b){var c,d,e,f,g,h,i,j,k,m,n,o;if(angular.isFunction(b)){for(e=[],h=0,k=p.length;k>h;h++)d=p[h],e.unshift(d);for(g=function(a){return b(a.scope)?(L(e.length-1-c,e.length-c),I--):void 0},c=i=0,m=e.length;m>i;c=++i)f=e[c],g(f)}else 0<=(o=b-B-1)&&o<p.length&&(L(b-B-1,b-B),I--);for(c=j=0,n=p.length;n>j;c=++j)d=p[c],d.scope.$index=B+c;return l(!1)}),y.$on("insert.item",function(a,b,c){var d,e,f,g,h,i,j,k,m,n,o,q;if(e=[],angular.isFunction(b)){for(f=[],i=0,m=p.length;m>i;i++)c=p[i],f.unshift(c);for(h=function(a){var f,g,h,i,j;if(g=b(a.scope)){if(C=function(a){return C(a,c),I++},isArray(g)){for(j=[],f=h=0,i=newitems.length;i>h;f=++h)c=newitems[f],j.push(e.push(C(d+f,c)));return j}return e.push(C(d,g))}},d=j=0,n=f.length;n>j;d=++j)g=f[d],h(g)}else 0<=(q=b-B-1)&&q<p.length&&(e.push(C(b,c)),I++);for(d=k=0,o=p.length;o>k;d=++k)c=p[d],c.scope.$index=B+d;return l(!1,e)})}}}}]),angular.module("ui.scrollfix",[]).directive("uiScrollfix",["$window",function(a){"use strict";return{require:"^?uiScrollfixTarget",link:function(b,c,d,e){function f(){var b;if(angular.isDefined(a.pageYOffset))b=a.pageYOffset;else{var e=document.compatMode&&"BackCompat"!==document.compatMode?document.documentElement:document.body;b=e.scrollTop}!c.hasClass("ui-scrollfix")&&b>d.uiScrollfix?c.addClass("ui-scrollfix"):c.hasClass("ui-scrollfix")&&b<d.uiScrollfix&&c.removeClass("ui-scrollfix")}var g=c[0].offsetTop,h=e&&e.$element||angular.element(a);d.uiScrollfix?"string"==typeof d.uiScrollfix&&("-"===d.uiScrollfix.charAt(0)?d.uiScrollfix=g-parseFloat(d.uiScrollfix.substr(1)):"+"===d.uiScrollfix.charAt(0)&&(d.uiScrollfix=g+parseFloat(d.uiScrollfix.substr(1)))):d.uiScrollfix=g,h.on("scroll",f),b.$on("$destroy",function(){h.off("scroll",f)})}}}]).directive("uiScrollfixTarget",[function(){"use strict";return{controller:["$element",function(a){this.$element=a}]}}]),angular.module("ui.showhide",[]).directive("uiShow",[function(){return function(a,b,c){a.$watch(c.uiShow,function(a){a?b.addClass("ui-show"):b.removeClass("ui-show")})}}]).directive("uiHide",[function(){return function(a,b,c){a.$watch(c.uiHide,function(a){a?b.addClass("ui-hide"):b.removeClass("ui-hide")})}}]).directive("uiToggle",[function(){return function(a,b,c){a.$watch(c.uiToggle,function(a){a?b.removeClass("ui-hide").addClass("ui-show"):b.removeClass("ui-show").addClass("ui-hide")})}}]),angular.module("ui.unique",[]).filter("unique",["$parse",function(a){return function(b,c){if(c===!1)return b;if((c||angular.isUndefined(c))&&angular.isArray(b)){var d=[],e=angular.isString(c)?a(c):function(a){return a},f=function(a){return angular.isObject(a)?e(a):a};angular.forEach(b,function(a){for(var b=!1,c=0;c<d.length;c++)if(angular.equals(f(d[c]),f(a))){b=!0;break}b||d.push(a)}),b=d}return b}}]),angular.module("ui.validate",[]).directive("uiValidate",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){function e(b){return angular.isString(b)?void a.$watch(b,function(){angular.forEach(g,function(a){a(d.$modelValue)})}):angular.isArray(b)?void angular.forEach(b,function(b){a.$watch(b,function(){angular.forEach(g,function(a){a(d.$modelValue)})})}):void(angular.isObject(b)&&angular.forEach(b,function(b,c){angular.isString(b)&&a.$watch(b,function(){g[c](d.$modelValue)}),angular.isArray(b)&&angular.forEach(b,function(b){a.$watch(b,function(){g[c](d.$modelValue)})})}))}var f,g={},h=a.$eval(c.uiValidate);h&&(angular.isString(h)&&(h={validator:h}),angular.forEach(h,function(b,c){f=function(e){var f=a.$eval(b,{$value:e});return angular.isObject(f)&&angular.isFunction(f.then)?(f.then(function(){d.$setValidity(c,!0)},function(){d.$setValidity(c,!1)}),e):f?(d.$setValidity(c,!0),e):void d.$setValidity(c,!1)},g[c]=f,d.$formatters.push(f),d.$parsers.push(f)}),c.uiValidateWatch&&e(a.$eval(c.uiValidateWatch)))}}}),angular.module("ui.utils",["ui.event","ui.format","ui.highlight","ui.include","ui.indeterminate","ui.inflector","ui.jq","ui.keypress","ui.mask","ui.reset","ui.route","ui.scrollfix","ui.scroll","ui.scroll.jqlite","ui.showhide","ui.unique","ui.validate"]),angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.modal"]),angular.module("ui.bootstrap.tpls",["template/modal/backdrop.html","template/modal/window.html"]),angular.module("ui.bootstrap.modal",[]).factory("$$stackedMap",function(){return{createNew:function(){var a=[];return{add:function(b,c){a.push({key:b,value:c})},get:function(b){for(var c=0;c<a.length;c++)if(b==a[c].key)return a[c]},keys:function(){for(var b=[],c=0;c<a.length;c++)b.push(a[c].key);return b},top:function(){return a[a.length-1]},remove:function(b){for(var c=-1,d=0;d<a.length;d++)if(b==a[d].key){c=d;break}return a.splice(c,1)[0]},removeTop:function(){return a.splice(a.length-1,1)[0]},length:function(){return a.length}}}}}).directive("modalBackdrop",["$modalStack","$timeout",function(a,b){return{restrict:"EA",replace:!0,templateUrl:"template/modal/backdrop.html",link:function(c){b(function(){c.animate=!0}),c.close=function(b){var c=a.getTop();c&&c.value.backdrop&&"static"!=c.value.backdrop&&(b.preventDefault(),b.stopPropagation(),a.dismiss(c.key,"backdrop click"))}}}}]).directive("modalWindow",["$timeout",function(a){return{restrict:"EA",scope:{index:"@"},replace:!0,transclude:!0,templateUrl:"template/modal/window.html",link:function(b,c,d){b.windowClass=d.windowClass||"",a(function(){b.animate=!0})}}}]).factory("$modalStack",["$document","$compile","$rootScope","$$stackedMap",function(a,b,c,d){function e(){for(var a=-1,b=k.keys(),c=0;c<b.length;c++)k.get(b[c]).value.backdrop&&(a=c);return a}function f(a){var b=k.get(a).value;k.remove(a),b.modalDomEl.remove(),h&&-1==e()&&(h.remove(),h=void 0),b.modalScope.$destroy()}var g,h,i=c.$new(!0),j=a.find("body").eq(0),k=d.createNew(),l={};return c.$watch(e,function(a){i.index=a}),a.bind("keydown",function(a){var b;27===a.which&&(b=k.top(),b&&b.value.keyboard&&c.$apply(function(){l.dismiss(b.key)}))}),l.open=function(a,c){k.add(a,{deferred:c.deferred,modalScope:c.scope,backdrop:c.backdrop,keyboard:c.keyboard});var d=angular.element("<div modal-window></div>");d.attr("window-class",c.windowClass),d.attr("index",k.length()-1),d.html(c.content);var f=b(d)(c.scope);k.top().value.modalDomEl=f,j.append(f),e()>=0&&!h&&(g=angular.element("<div modal-backdrop></div>"),h=b(g)(i),j.append(h))},l.close=function(a,b){var c=k.get(a);c&&(c.value.deferred.resolve(b),f(a))},l.dismiss=function(a,b){var c=k.get(a).value;c&&(c.deferred.reject(b),f(a))},l.getTop=function(){return k.top()},l}]).provider("$modal",function(){var a={options:{backdrop:!0,keyboard:!0},$get:["$injector","$rootScope","$q","$http","$templateCache","$controller","$modalStack",function(b,c,d,e,f,g,h){function i(a){return a.template?d.when(a.template):e.get(a.templateUrl,{cache:f}).then(function(a){return a.data})}function j(a){var c=[];return angular.forEach(a,function(a){(angular.isFunction(a)||angular.isArray(a))&&c.push(d.when(b.invoke(a)))}),c}var k={};return k.open=function(b){var e=d.defer(),f=d.defer(),k={result:e.promise,opened:f.promise,close:function(a){h.close(k,a)},dismiss:function(a){h.dismiss(k,a)}};if(b=angular.extend({},a.options,b),b.resolve=b.resolve||{},!b.template&&!b.templateUrl)throw new Error("One of template or templateUrl options is required.");var l=d.all([i(b)].concat(j(b.resolve)));return l.then(function(a){var d=(b.scope||c).$new();d.$close=k.close,d.$dismiss=k.dismiss;var f,i={},j=1;b.controller&&(i.$scope=d,i.$modalInstance=k,angular.forEach(b.resolve,function(b,c){i[c]=a[j++]}),f=g(b.controller,i)),h.open(k,{scope:d,deferred:e,content:a[0],backdrop:b.backdrop,keyboard:b.keyboard,windowClass:b.windowClass})},function(a){e.reject(a)}),l.then(function(){f.resolve(!0)},function(){f.reject(!1)}),k},k}]};return a}),angular.module("template/modal/backdrop.html",[]).run(["$templateCache",function(a){a.put("template/modal/backdrop.html",'<div class="modal-backdrop fade" ng-class="{in: animate}" ng-style="{\'z-index\': 1040 + index*10}" ng-click="close($event)"></div>')}]),angular.module("template/modal/window.html",[]).run(["$templateCache",function(a){a.put("template/modal/window.html",'<div class="modal fade {{ windowClass }}" ng-class="{in: animate}" ng-style="{\'z-index\': 1050 + index*10}" ng-transclude></div>')}]),function(){"use strict";var a=angular.module("pasvaz.bindonce",[]);a.directive("bindonce",function(){var a=function(a){if(a&&0!==a.length){var b=angular.lowercase(""+a);a=!("f"===b||"0"===b||"false"===b||"no"===b||"n"===b||"[]"===b)}else a=!1;return a},b=parseInt((/msie (\d+)/.exec(angular.lowercase(navigator.userAgent))||[])[1],10);isNaN(b)&&(b=parseInt((/trident\/.*; rv:(\d+)/.exec(angular.lowercase(navigator.userAgent))||[])[1],10));var c={restrict:"AM",controller:["$scope","$element","$attrs","$interpolate","$sce",function(c,d,e,f,g){var h=function(b,c,d){var e="show"===c?"":"none",f="hide"===c?"":"none";b.css("display",a(d)?e:f)},i=function(a,b){if(angular.isObject(b)&&!angular.isArray(b)){var c=[];angular.forEach(b,function(a,b){a&&c.push(b)}),b=c}b&&a.addClass(angular.isArray(b)?b.join(" "):b)},j=function(a,b){a.transclude(b,function(b){var c=a.element.parent(),d=a.element&&a.element[a.element.length-1],e=c&&c[0]||d&&d.parentNode,f=d&&d.nextSibling||null;angular.forEach(b,function(a){e.insertBefore(a,f)})})},k={watcherRemover:void 0,binders:[],group:e.boName,element:d,ran:!1,addBinder:function(a){this.binders.push(a),this.ran&&this.runBinders()},setupWatcher:function(a){var b=this;this.watcherRemover=c.$watch(a,function(a){void 0!==a&&(b.removeWatcher(),b.checkBindonce(a))},!0)},checkBindonce:function(a){var b=this,c=a.$promise?a.$promise.then:a.then;"function"==typeof c?c(function(){b.runBinders()}):b.runBinders()},removeWatcher:function(){void 0!==this.watcherRemover&&(this.watcherRemover(),this.watcherRemover=void 0)},runBinders:function(){for(;this.binders.length>0;){var c=this.binders.shift();if(!this.group||this.group==c.group){var d=c.scope.$eval(c.interpolate?f(c.value):c.value);switch(c.attr){case"boIf":a(d)&&j(c,c.scope.$new());break;case"boSwitch":var e,k=c.controller[0];(e=k.cases["!"+d]||k.cases["?"])&&(c.scope.$eval(c.attrs.change),angular.forEach(e,function(a){j(a,c.scope.$new())}));break;case"boSwitchWhen":var l=c.controller[0];l.cases["!"+c.attrs.boSwitchWhen]=l.cases["!"+c.attrs.boSwitchWhen]||[],l.cases["!"+c.attrs.boSwitchWhen].push({transclude:c.transclude,element:c.element});break;case"boSwitchDefault":var l=c.controller[0];l.cases["?"]=l.cases["?"]||[],l.cases["?"].push({transclude:c.transclude,element:c.element});break;case"hide":case"show":h(c.element,c.attr,d);break;case"class":i(c.element,d);break;case"text":c.element.text(d);break;case"html":c.element.html(g.getTrustedHtml(d));break;case"style":c.element.css(d);break;case"src":c.element.attr(c.attr,d),b&&c.element.prop("src",d);break;case"attr":angular.forEach(c.attrs,function(a,b){var d,e;b.match(/^boAttr./)&&c.attrs[b]&&(d=b.replace(/^boAttr/,"").replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),e=c.scope.$eval(c.attrs[b]),c.element.attr(d,e))});break;case"href":case"alt":case"title":case"id":case"value":c.element.attr(c.attr,d)}}}this.ran=!0}};return k}],link:function(a,b,c,d){var e=c.bindonce&&a.$eval(c.bindonce);void 0!==e?d.checkBindonce(e):(d.setupWatcher(c.bindonce),b.bind("$destroy",d.removeWatcher))}};return c}),angular.forEach([{directiveName:"boShow",attribute:"show"},{directiveName:"boHide",attribute:"hide"},{directiveName:"boClass",attribute:"class"},{directiveName:"boText",attribute:"text"},{directiveName:"boBind",attribute:"text"},{directiveName:"boHtml",attribute:"html"},{directiveName:"boSrcI",attribute:"src",interpolate:!0},{directiveName:"boSrc",attribute:"src"},{directiveName:"boHrefI",attribute:"href",interpolate:!0},{directiveName:"boHref",attribute:"href"},{directiveName:"boAlt",attribute:"alt"},{directiveName:"boTitle",attribute:"title"},{directiveName:"boId",attribute:"id"},{directiveName:"boStyle",attribute:"style"},{directiveName:"boValue",attribute:"value"},{directiveName:"boAttr",attribute:"attr"},{directiveName:"boIf",transclude:"element",terminal:!0,priority:1e3},{directiveName:"boSwitch",require:"boSwitch",controller:function(){this.cases={}}},{directiveName:"boSwitchWhen",transclude:"element",priority:800,require:"^boSwitch"},{directiveName:"boSwitchDefault",transclude:"element",priority:800,require:"^boSwitch"}],function(b){var c=200;return a.directive(b.directiveName,function(){var a={priority:b.priority||c,transclude:b.transclude||!1,terminal:b.terminal||!1,require:["^bindonce"].concat(b.require||[]),controller:b.controller,compile:function(a,c,d){return function(a,c,e,f){var g=f[0],h=e.boParent;if(h&&g.group!==h){var i=g.element.parent();g=void 0;for(var j;9!==i[0].nodeType&&i.length;){if((j=i.data("$bindonceController"))&&j.group===h){g=j;break}i=i.parent()}if(!g)throw new Error("No bindonce controller: "+h)}g.addBinder({element:c,attr:b.attribute||b.directiveName,attrs:e,value:e[b.directiveName],interpolate:b.interpolate,group:h,transclude:d,controller:f.slice(1),scope:a})}}};return a})})}(),angular.module("monospaced.elastic",[]).constant("msdElasticConfig",{append:""}).directive("msdElastic",["$timeout","$window","msdElasticConfig",function(a,b,c){"use strict";return{require:"ngModel",restrict:"A, C",link:function(d,e,f,g){function h(){var a=r;n=k,u=getComputedStyle(k),angular.forEach(C,function(b){a+=b+":"+u.getPropertyValue(b)+";"}),t.setAttribute("style",a)}function i(){var b,c,e,f,g;n!==k&&h(),o||(o=!0,t.value=k.value+p,t.style.overflowY=k.style.overflowY,b=""===k.style.height?"auto":parseInt(k.style.height,10),c=getComputedStyle(k).getPropertyValue("width"),"px"===c.substr(c.length-2,2)&&(f=parseInt(c,10)-x.width,t.style.width=f+"px"),e=t.scrollHeight,e>B?(e=B,g="scroll"):A>e&&(e=A),e+=x.height,k.style.overflowY=g||"hidden",b!==e&&(k.style.height=e+"px",d.$emit("elastic:resize",l)),a(function(){o=!1},1))}function j(){o=!1,i()}var k=e[0],l=e;if("TEXTAREA"===k.nodeName&&b.getComputedStyle){l.css({overflow:"hidden","overflow-y":"hidden","word-wrap":"break-word"});var m=k.value;k.value="",k.value=m;var n,o,p=f.msdElastic?f.msdElastic.replace(/\\n/g,"\n"):c.append,q=angular.element(b),r="position: absolute; top: -999px; right: auto; bottom: auto;left: 0; overflow: hidden; -webkit-box-sizing: content-box;-moz-box-sizing: content-box; box-sizing: content-box;min-height: 0 !important; height: 0 !important; padding: 0;word-wrap: break-word; border: 0;",s=angular.element('<textarea tabindex="-1" style="'+r+'"/>').data("elastic",!0),t=s[0],u=getComputedStyle(k),v=u.getPropertyValue("resize"),w="border-box"===u.getPropertyValue("box-sizing")||"border-box"===u.getPropertyValue("-moz-box-sizing")||"border-box"===u.getPropertyValue("-webkit-box-sizing"),x=w?{width:parseInt(u.getPropertyValue("border-right-width"),10)+parseInt(u.getPropertyValue("padding-right"),10)+parseInt(u.getPropertyValue("padding-left"),10)+parseInt(u.getPropertyValue("border-left-width"),10),height:parseInt(u.getPropertyValue("border-top-width"),10)+parseInt(u.getPropertyValue("padding-top"),10)+parseInt(u.getPropertyValue("padding-bottom"),10)+parseInt(u.getPropertyValue("border-bottom-width"),10)}:{width:0,height:0},y=parseInt(u.getPropertyValue("min-height"),10),z=parseInt(u.getPropertyValue("height"),10),A=Math.max(y,z)-x.height,B=parseInt(u.getPropertyValue("max-height"),10),C=["font-family","font-size","font-weight","font-style","letter-spacing","line-height","text-transform","word-spacing","text-indent"];l.data("elastic")||(B=B&&B>0?B:9e4,t.parentNode!==document.body&&angular.element(document.body).append(t),l.css({resize:"none"===v||"vertical"===v?"none":"horizontal"}).data("elastic",!0),k.oninput="onpropertychange"in k&&"oninput"in k?k.onkeyup=i:i,q.bind("resize",j),d.$watch(function(){return g.$modelValue},function(){j()}),d.$on("elastic:adjust",function(){h(),j()}),a(i),d.$on("$destroy",function(){s.remove(),q.unbind("resize",j)}))}}}}]);var duScrollDefaultEasing=function(a){"use strict";return.5>a?Math.pow(2*a,2)/2:1-Math.pow(2*(1-a),2)/2};angular.module("duScroll",["duScroll.scrollspy","duScroll.smoothScroll","duScroll.scrollContainer","duScroll.spyContext","duScroll.scrollHelpers"]).value("duScrollDuration",350).value("duScrollSpyWait",100).value("duScrollGreedy",!1).value("duScrollOffset",0).value("duScrollEasing",duScrollDefaultEasing),angular.module("duScroll.scrollHelpers",["duScroll.requestAnimation"]).run(["$window","$q","cancelAnimation","requestAnimation","duScrollEasing","duScrollDuration","duScrollOffset",function(a,b,c,d,e,f,g){"use strict";var h=angular.element.prototype,i=function(a){return"undefined"!=typeof HTMLDocument&&a instanceof HTMLDocument||a.nodeType&&a.nodeType===a.DOCUMENT_NODE},j=function(a){return"undefined"!=typeof HTMLElement&&a instanceof HTMLElement||a.nodeType&&a.nodeType===a.ELEMENT_NODE},k=function(a){return j(a)||i(a)?a:a[0]};h.scrollTo=function(b,c,d){var e;if(angular.isElement(b)?e=this.scrollToElement:d&&(e=this.scrollToAnimated),e)return e.apply(this,arguments);var f=k(this);return i(f)?a.scrollTo(b,c):(f.scrollLeft=b,void(f.scrollTop=c))};var l,m;h.scrollToAnimated=function(a,f,g,h){g&&!h&&(h=e);var i=this.scrollLeft(),j=this.scrollTop(),k=Math.round(a-i),n=Math.round(f-j),o=null,p=this,q="scroll mousedown mousewheel touchmove keydown",r=function(a){(!a||a.which>0)&&(p.unbind(q,r),c(l),m.reject(),l=null)};if(l&&r(),m=b.defer(),!k&&!n)return m.resolve(),m.promise;var s=function(a){null===o&&(o=a);var b=a-o,c=b>=g?1:h(b/g);p.scrollTo(i+Math.ceil(k*c),j+Math.ceil(n*c)),1>c?l=d(s):(p.unbind(q,r),l=null,m.resolve())};return p.scrollTo(i,j),p.bind(q,r),l=d(s),m.promise},h.scrollToElement=function(a,b,c,d){var e=k(this);(!angular.isNumber(b)||isNaN(b))&&(b=g);var f=this.scrollTop()+k(a).getBoundingClientRect().top-b;return j(e)&&(f-=e.getBoundingClientRect().top),this.scrollTo(0,f,c,d)};var n={scrollLeft:function(b,c,d){if(angular.isNumber(b))return this.scrollTo(b,this.scrollTop(),c,d);var e=k(this);return i(e)?a.scrollX||document.documentElement.scrollLeft||document.body.scrollLeft:e.scrollLeft},scrollTop:function(b,c,d){if(angular.isNumber(b))return this.scrollTo(this.scrollTop(),b,c,d);var e=k(this);return i(e)?a.scrollY||document.documentElement.scrollTop||document.body.scrollTop:e.scrollTop}};h.scrollToElementAnimated=function(a,b,c,d){return this.scrollToElement(a,b,c||f,d)},h.scrollTopAnimated=function(a,b,c){return this.scrollTop(a,b||f,c)},h.scrollLeftAnimated=function(a,b,c){return this.scrollLeft(a,b||f,c)};var o=function(a,b){return function(c,d){return d?b.apply(this,arguments):a.apply(this,arguments)}};for(var p in n)h[p]=h[p]?o(h[p],n[p]):n[p]}]),angular.module("duScroll.polyfill",[]).factory("polyfill",["$window",function(a){"use strict";var b=["webkit","moz","o","ms"];return function(c,d){if(a[c])return a[c];for(var e,f=c.substr(0,1).toUpperCase()+c.substr(1),g=0;g<b.length;g++)if(e=b[g]+f,a[e])return a[e];return d}}]),angular.module("duScroll.requestAnimation",["duScroll.polyfill"]).factory("requestAnimation",["polyfill","$timeout",function(a,b){"use strict";var c=0,d=function(a){var d=(new Date).getTime(),e=Math.max(0,16-(d-c)),f=b(function(){a(d+e)},e);return c=d+e,f};return a("requestAnimationFrame",d)}]).factory("cancelAnimation",["polyfill","$timeout",function(a,b){"use strict";var c=function(a){b.cancel(a)};return a("cancelAnimationFrame",c)}]),angular.module("duScroll.spyAPI",["duScroll.scrollContainerAPI"]).factory("spyAPI",["$rootScope","$timeout","scrollContainerAPI","duScrollGreedy","duScrollSpyWait",function(a,b,c,d,e){"use strict";var f=function(c){var f=!1,g=!1,h=function(){g=!1;var b=c.container,e=b[0],f=0;("undefined"!=typeof HTMLElement&&e instanceof HTMLElement||e.nodeType&&e.nodeType===e.ELEMENT_NODE)&&(f=e.getBoundingClientRect().top);var h,i,j,k,l,m;for(k=c.spies,i=c.currentlyActive,j=void 0,h=0;h<k.length;h++)l=k[h],m=l.getTargetPosition(),m&&m.top+l.offset-f<20&&-1*m.top+f<m.height&&(!j||j.top<m.top)&&(j={top:m.top,spy:l});j&&(j=j.spy),i===j||d&&!j||(i&&(i.$element.removeClass("active"),a.$broadcast("duScrollspy:becameInactive",i.$element)),j&&(j.$element.addClass("active"),a.$broadcast("duScrollspy:becameActive",j.$element)),c.currentlyActive=j)};return e?function(){f?g=!0:(h(),f=b(function(){f=!1,g&&h()},e,!1))}:h},g={},h=function(a){var b=a.$id,c={spies:[]};return c.handler=f(c),g[b]=c,a.$on("$destroy",function(){i(a)}),b},i=function(a){var b=a.$id,c=g[b],d=c.container;d&&d.off("scroll",c.handler),delete g[b]},j=h(a),k=function(a){return g[a.$id]?g[a.$id]:a.$parent?k(a.$parent):g[j]},l=function(a){var b,c,d=a.$element.scope();if(d)return k(d);for(c in g)if(b=g[c],-1!==b.spies.indexOf(a))return b},m=function(a){for(;a.parentNode;)if(a=a.parentNode,a===document)return!0;return!1},n=function(a){var b=l(a);b&&(b.spies.push(a),b.container&&m(b.container)||(b.container&&b.container.off("scroll",b.handler),b.container=c.getContainer(a.$element.scope()),b.container.on("scroll",b.handler).triggerHandler("scroll")))},o=function(a){var b=l(a);a===b.currentlyActive&&(b.currentlyActive=null);var c=b.spies.indexOf(a);-1!==c&&b.spies.splice(c,1)};return{addSpy:n,removeSpy:o,createContext:h,destroyContext:i,getContextForScope:k}}]),angular.module("duScroll.scrollContainerAPI",[]).factory("scrollContainerAPI",["$document",function(a){"use strict";var b={},c=function(a,c){var d=a.$id;return b[d]=c,d},d=function(a){return b[a.$id]?a.$id:a.$parent?d(a.$parent):void 0},e=function(c){var e=d(c);return e?b[e]:a},f=function(a){var c=d(a);c&&delete b[c]};return{getContainerId:d,getContainer:e,setContainer:c,removeContainer:f}}]),angular.module("duScroll.smoothScroll",["duScroll.scrollHelpers","duScroll.scrollContainerAPI"]).directive("duSmoothScroll",["duScrollDuration","duScrollOffset","scrollContainerAPI",function(a,b,c){"use strict";return{link:function(d,e,f){e.on("click",function(e){if(f.href&&-1!==f.href.indexOf("#")){var g=document.getElementById(f.href.replace(/.*(?=#[^\s]+$)/,"").substring(1));if(g&&g.getBoundingClientRect){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault();var h=f.offset?parseInt(f.offset,10):b,i=f.duration?parseInt(f.duration,10):a,j=c.getContainer(d);j.scrollToElement(angular.element(g),isNaN(h)?0:h,isNaN(i)?0:i)}}})}}}]),angular.module("duScroll.spyContext",["duScroll.spyAPI"]).directive("duSpyContext",["spyAPI",function(a){"use strict";return{restrict:"A",scope:!0,compile:function(){return{pre:function(b){a.createContext(b)
}}}}}]),angular.module("duScroll.scrollContainer",["duScroll.scrollContainerAPI"]).directive("duScrollContainer",["scrollContainerAPI",function(a){"use strict";return{restrict:"A",scope:!0,compile:function(){return{pre:function(b,c,d){d.$observe("duScrollContainer",function(d){angular.isString(d)&&(d=document.getElementById(d)),d=angular.isElement(d)?angular.element(d):c,a.setContainer(b,d),b.$on("$destroy",function(){a.removeContainer(b)})})}}}}}]),angular.module("duScroll.scrollspy",["duScroll.spyAPI"]).directive("duScrollspy",["spyAPI","duScrollOffset","$timeout","$rootScope",function(a,b,c,d){"use strict";var e=function(a,b,c){angular.isElement(a)?this.target=a:angular.isString(a)&&(this.targetId=a),this.$element=b,this.offset=c};return e.prototype.getTargetElement=function(){return!this.target&&this.targetId&&(this.target=document.getElementById(this.targetId)),this.target},e.prototype.getTargetPosition=function(){var a=this.getTargetElement();return a?a.getBoundingClientRect():void 0},e.prototype.flushTargetCache=function(){this.targetId&&(this.target=void 0)},{link:function(f,g,h){var i,j=h.ngHref||h.href;j&&-1!==j.indexOf("#")?i=j.replace(/.*(?=#[^\s]+$)/,"").substring(1):h.duScrollspy&&(i=h.duScrollspy),i&&c(function(){var c=new e(i,g,-(h.offset?parseInt(h.offset,10):b));a.addSpy(c),f.$on("$destroy",function(){a.removeSpy(c)}),f.$on("$locationChangeSuccess",c.flushTargetCache.bind(c)),d.$on("$stateChangeSuccess",c.flushTargetCache.bind(c))},0,!1)}}}]),!function(a,b,c){"undefined"!=typeof module&&module.exports?module.exports=c():"function"==typeof define&&define.amd?define(c):b[a]=c()}("reqwest",this,function(){function handleReadyState(a,b,c){return function(){return a._aborted?c(a.request):void(a.request&&4==a.request[readyState]&&(a.request.onreadystatechange=noop,twoHundo.test(a.request.status)?b(a.request):c(a.request)))}}function setHeaders(a,b){var c,d=b.headers||{};d.Accept=d.Accept||defaultHeaders.accept[b.type]||defaultHeaders.accept["*"],b.crossOrigin||d[requestedWith]||(d[requestedWith]=defaultHeaders.requestedWith),d[contentType]||(d[contentType]=b.contentType||defaultHeaders.contentType);for(c in d)d.hasOwnProperty(c)&&"setRequestHeader"in a&&a.setRequestHeader(c,d[c])}function setCredentials(a,b){"undefined"!=typeof b.withCredentials&&"undefined"!=typeof a.withCredentials&&(a.withCredentials=!!b.withCredentials)}function generalCallback(a){lastValue=a}function urlappend(a,b){return a+(/\?/.test(a)?"&":"?")+b}function handleJsonp(a,b,c,d){var e=uniqid++,f=a.jsonpCallback||"callback",g=a.jsonpCallbackName||reqwest.getcallbackPrefix(e),h=new RegExp("((^|\\?|&)"+f+")=([^&]+)"),i=d.match(h),j=doc.createElement("script"),k=0,l=-1!==navigator.userAgent.indexOf("MSIE 10.0");return i?"?"===i[3]?d=d.replace(h,"$1="+g):g=i[3]:d=urlappend(d,f+"="+g),win[g]=generalCallback,j.type="text/javascript",j.src=d,j.async=!0,"undefined"==typeof j.onreadystatechange||l||(j.htmlFor=j.id="_reqwest_"+e),j.onload=j.onreadystatechange=function(){return j[readyState]&&"complete"!==j[readyState]&&"loaded"!==j[readyState]||k?!1:(j.onload=j.onreadystatechange=null,j.onclick&&j.onclick(),b(lastValue),lastValue=void 0,head.removeChild(j),void(k=1))},head.appendChild(j),{abort:function(){j.onload=j.onreadystatechange=null,c({},"Request is aborted: timeout",{}),lastValue=void 0,head.removeChild(j),k=1}}}function getRequest(a,b){var c,d=this.o,e=(d.method||"GET").toUpperCase(),f="string"==typeof d?d:d.url,g=d.processData!==!1&&d.data&&"string"!=typeof d.data?reqwest.toQueryString(d.data):d.data||null,h=!1;return"jsonp"!=d.type&&"GET"!=e||!g||(f=urlappend(f,g),g=null),"jsonp"==d.type?handleJsonp(d,a,b,f):(c=d.xhr&&d.xhr(d)||xhr(d),c.open(e,f,d.async===!1?!1:!0),setHeaders(c,d),setCredentials(c,d),win[xDomainRequest]&&c instanceof win[xDomainRequest]?(c.onload=a,c.onerror=b,c.onprogress=function(){},h=!0):c.onreadystatechange=handleReadyState(this,a,b),d.before&&d.before(c),h?setTimeout(function(){c.send(g)},200):c.send(g),c)}function Reqwest(a,b){this.o=a,this.fn=b,init.apply(this,arguments)}function setType(a){return a.match("json")?"json":a.match("javascript")?"js":a.match("text")?"html":a.match("xml")?"xml":void 0}function init(o,fn){function complete(a){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(a)}function success(resp){var type=o.type||setType(resp.getResponseHeader("Content-Type"));resp="jsonp"!==type?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);self._fulfillmentHandlers.length>0;)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function error(a,b,c){for(a=self.request,self._responseArgs.resp=a,self._responseArgs.msg=b,self._responseArgs.t=c,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(a,b,c);complete(a)}this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(a,b){return new Reqwest(a,b)}function normalize(a){return a?a.replace(/\r?\n/g,"\r\n"):""}function serial(a,b){var c,d,e,f,g=a.name,h=a.tagName.toLowerCase(),i=function(a){a&&!a.disabled&&b(g,normalize(a.attributes.value&&a.attributes.value.specified?a.value:a.text))};if(!a.disabled&&g)switch(h){case"input":/reset|button|image|file/i.test(a.type)||(c=/checkbox/i.test(a.type),d=/radio/i.test(a.type),e=a.value,(!(c||d)||a.checked)&&b(g,normalize(c&&""===e?"on":e)));break;case"textarea":b(g,normalize(a.value));break;case"select":if("select-one"===a.type.toLowerCase())i(a.selectedIndex>=0?a.options[a.selectedIndex]:null);else for(f=0;a.length&&f<a.length;f++)a.options[f].selected&&i(a.options[f])}}function eachFormElement(){var a,b,c=this,d=function(a,b){var d,e,f;for(d=0;d<b.length;d++)for(f=a[byTag](b[d]),e=0;e<f.length;e++)serial(f[e],c)};for(b=0;b<arguments.length;b++)a=arguments[b],/input|select|textarea/i.test(a.tagName)&&serial(a,c),d(a,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var a={};return eachFormElement.apply(function(b,c){b in a?(a[b]&&!isArray(a[b])&&(a[b]=[a[b]]),a[b].push(c)):a[b]=c},arguments),a}function buildParams(a,b,c,d){var e,f,g,h=/\[\]$/;if(isArray(b))for(f=0;b&&f<b.length;f++)g=b[f],c||h.test(a)?d(a,g):buildParams(a+"["+("object"==typeof g?f:"")+"]",g,c,d);else if(b&&"[object Object]"===b.toString())for(e in b)buildParams(a+"["+e+"]",b[e],c,d);else d(a,b)}var win=window,doc=document,twoHundo=/^(20\d|1223)$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray="function"==typeof Array.isArray?Array.isArray:function(a){return a instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(a){if(a.crossOrigin===!0){var b=win[xmlHttpRequest]?new XMLHttpRequest:null;if(b&&"withCredentials"in b)return b;if(win[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return win[xmlHttpRequest]?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(a){return a}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(a,b){return a=a||function(){},b=b||function(){},this._fulfilled?this._responseArgs.resp=a(this._responseArgs.resp):this._erred?b(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(a),this._errorHandlers.push(b)),this},always:function(a){return this._fulfilled||this._erred?a(this._responseArgs.resp):this._completeHandlers.push(a),this},fail:function(a){return this._erred?a(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(a),this}},reqwest.serializeArray=function(){var a=[];return eachFormElement.apply(function(b,c){a.push({name:b,value:c})},arguments),a},reqwest.serialize=function(){if(0===arguments.length)return"";var a,b,c=Array.prototype.slice.call(arguments,0);return a=c.pop(),a&&a.nodeType&&c.push(a)&&(a=null),a&&(a=a.type),b="map"==a?serializeHash:"array"==a?reqwest.serializeArray:serializeQueryString,b.apply(null,c)},reqwest.toQueryString=function(a,b){var c,d,e=b||!1,f=[],g=encodeURIComponent,h=function(a,b){b="function"==typeof b?b():null==b?"":b,f[f.length]=g(a)+"="+g(b)};if(isArray(a))for(d=0;a&&d<a.length;d++)h(a[d].name,a[d].value);else for(c in a)a.hasOwnProperty(c)&&buildParams(c,a[c],e,h);return f.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(a,b){return a&&(a.type&&(a.method=a.type)&&delete a.type,a.dataType&&(a.type=a.dataType),a.jsonpCallback&&(a.jsonpCallbackName=a.jsonpCallback)&&delete a.jsonpCallback,a.jsonp&&(a.jsonpCallback=a.jsonp)),new Reqwest(a,b)},reqwest.ajaxSetup=function(a){a=a||{};for(var b in a)globalSetupOptions[b]=a[b]},reqwest}),function(a){if("function"==typeof bootstrap)bootstrap("promise",a);else if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makePromise=a}else"undefined"!=typeof window?window.Promise=a():global.Promise=a()}(function(){return function(a,b,c){function d(c,f){if(!b[c]){if(!a[c]){var g="function"==typeof require&&require;if(!f&&g)return g(c,!0);if(e)return e(c,!0);throw new Error("Cannot find module '"+c+"'")}var h=b[c]={exports:{}};a[c][0].call(h.exports,function(b){var e=a[c][1][b];return d(e?e:b)},h,h.exports)}return b[c].exports}for(var e="function"==typeof require&&require,f=0;f<c.length;f++)d(c[f]);return d}({1:[function(a,b){var c=b.exports={};c.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){if(a.source===window&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var b=c.shift();b()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),c.title="browser",c.browser=!0,c.env={},c.argv=[],c.binding=function(){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(){throw new Error("process.chdir is not supported")}},{}],2:[function(a,b){"use strict";function c(a){function b(a){return null===k?void n.push(a):void e(function(){var b=k?a.onFulfilled:a.onRejected;if(null===b)return void(k?a.resolve:a.reject)(m);var c;try{c=b(m)}catch(d){return void a.reject(d)}a.resolve(c)})}function f(a){l||g(a)}function g(a){if(null===k)try{if(a===o)throw new TypeError("A promise cannot be resolved with itself.");if(a&&("object"==typeof a||"function"==typeof a)){var b=a.then;if("function"==typeof b)return l=!0,void b.call(a,g,i)}k=!0,m=a,j()}catch(c){i(c)}}function h(a){l||i(a)}function i(a){null===k&&(k=!1,m=a,j())}function j(){for(var a=0,c=n.length;c>a;a++)b(n[a]);n=null}if(!(this instanceof c))return new c(a);if("function"!=typeof a)throw new TypeError("not a function");var k=null,l=!1,m=null,n=[],o=this;this.then=function(a,e){return new c(function(c,f){b(new d(a,e,c,f))})};try{a(f,h)}catch(p){h(p)}}function d(a,b,c,d){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.resolve=c,this.reject=d}var e=a("./lib/next-tick");b.exports=c},{"./lib/next-tick":4}],3:[function(a,b){"use strict";var c=a("./core.js"),d=a("./lib/next-tick");b.exports=c,c.from=function(a){return a instanceof c?a:new c(function(b){b(a)})},c.denodeify=function(a){return function(){var b=this,d=Array.prototype.slice.call(arguments);return new c(function(c,e){d.push(function(a,b){a?e(a):c(b)}),a.apply(b,d)})}},c.nodeify=function(a){return function(){var b=Array.prototype.slice.call(arguments),e="function"==typeof b[b.length-1]?b.pop():null;try{return a.apply(this,arguments).nodeify(e)}catch(f){if(null==e)return new c(function(a,b){b(f)});d(function(){e(f)})}}},c.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&Array.isArray(arguments[0])?arguments[0]:arguments);return new c(function(b,c){function d(f,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(a){d(f,a)},c)}a[f]=g,0===--e&&b(a)}catch(i){c(i)}}if(0===a.length)return b([]);for(var e=a.length,f=0;f<a.length;f++)d(f,a[f])})},c.prototype.done=function(){var a=arguments.length?this.then.apply(this,arguments):this;a.then(null,function(a){d(function(){throw a})})},c.prototype.nodeify=function(a){return null==a?this:void this.then(function(b){d(function(){a(null,b)})},function(b){d(function(){a(b)})})}},{"./core.js":2,"./lib/next-tick":4}],4:[function(a,b){!function(a){"use strict";b.exports="function"==typeof setImmediate?function(a){setImmediate(a)}:"undefined"!=typeof a&&a&&"function"==typeof a.nextTick?function(b){a.nextTick(b)}:function(a){setTimeout(a,0)}}(a("__browserify_process"))},{__browserify_process:1}]},{},[3])(3)}),function(){var a,b=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};window.InfluxDB=a=function(){function a(a){var c;a||(a={}),this.host=a.host||"localhost",this.hosts=a.hosts||[this.host],this.port=a.port||8086,this.username=a.username||"root",this.password=a.password||"root",this.database=a.database,this.ssl=a.ssl||!1,this.max_retries=a.max_retries||20,this.isCrossOrigin=(c=window.location.host,b.call(this.hosts,c)<0),this.username=encodeURIComponent(this.username),this.password=encodeURIComponent(this.password)}return a.prototype.getDatabases=function(){return this.get(this.path("db"))},a.prototype.createDatabase=function(a,b){var c;return c={name:a},this.post(this.path("db"),c,b)},a.prototype.deleteDatabase=function(a){return this["delete"](this.path("db/"+a))},a.prototype.getClusterConfiguration=function(){return this.get(this.path("cluster/configuration"))},a.prototype.createDatabaseConfig=function(a,b,c){return this.post(this.path("cluster/database_configs/"+a),b,c)},a.prototype.getDatabaseUsers=function(a){return this.get(this.path("db/"+a+"/users"))},a.prototype.createUser=function(a,b,c,d){var e;return e={name:b,password:c},this.post(this.path("db/"+a+"/users"),e,d)},a.prototype.deleteDatabaseUser=function(a,b){return this["delete"](this.path("db/"+a+"/users/"+b))},a.prototype.getDatabaseUser=function(a,b){return this.get(this.path("db/"+a+"/users/"+b))},a.prototype.updateDatabaseUser=function(a,b,c,d){return this.post(this.path("db/"+a+"/users/"+b),c,d)},a.prototype.authenticateDatabaseUser=function(){return this.get(this.path("db/"+this.database+"/authenticate"))},a.prototype.getClusterAdmins=function(){return this.get(this.path("cluster_admins"))},a.prototype.deleteClusterAdmin=function(a){return this["delete"](this.path("cluster_admins/"+a))},a.prototype.createClusterAdmin=function(a,b){var c;return c={name:a,password:b},this.post(this.path("cluster_admins"),c)},a.prototype.updateClusterAdmin=function(a,b,c){return this.post(this.path("cluster_admins/"+a),b,c)},a.prototype.authenticateClusterAdmin=function(){return this.get(this.path("cluster_admins/authenticate"))},a.prototype.getContinuousQueries=function(a){return this.get(this.path("db/"+a+"/continuous_queries"))},a.prototype.deleteContinuousQuery=function(a,b){return this["delete"](this.path("db/"+a+"/continuous_queries/"+b))},a.prototype.getClusterServers=function(){return this.get(this.path("cluster/servers"))},a.prototype.getClusterShardSpaces=function(){return this.get(this.path("cluster/shard_spaces"))},a.prototype.getClusterShards=function(){return this.get(this.path("cluster/shards"))},a.prototype.createClusterShard=function(a,b,c,d,e,f){var g;return g={database:c,spaceName:d,startTime:a,endTime:b,longTerm:longTerm,shards:[{serverIds:e}]},this.post(this.path("cluster/shards"),g,f)},a.prototype.deleteClusterShard=function(a,b){var c;return c={serverIds:b},this["delete"](this.path("cluster/shards/"+a),c)},a.prototype.getInterfaces=function(){return this.get(this.path("interfaces"))},a.prototype.readPoint=function(a,b,c){var d;return d="SELECT "+a+" FROM "+b+";",this.get(this.path("db/"+this.database+"/series",{q:d}),c)},a.prototype._readPoint=function(a,b){return this.get(this.path("db/"+this.database+"/series",{q:a}),b)},a.prototype.query=function(a,b){return this.get(this.path("db/"+this.database+"/series",{q:a}),b)},a.prototype.get=function(a,b){var c=this;return new Promise(function(d,e){return c.retry(d,e,function(){return reqwest({method:"get",type:"json",url:c.url(a),crossOrigin:c.isCrossOrigin,success:function(a){return d(a),b?b(c.formatPoints(a)):void 0}})})})},a.prototype.post=function(a,b){var c=this;return new Promise(function(d,e){return c.retry(d,e,function(){return reqwest({method:"post",type:"json",url:c.url(a),crossOrigin:c.isCrossOrigin,contentType:"application/json",data:JSON.stringify(b),success:function(a){return d(a)}})})})},a.prototype["delete"]=function(a,b){var c=this;return new Promise(function(d,e){return c.retry(d,e,function(){return reqwest({method:"delete",type:"json",url:c.url(a),crossOrigin:c.isCrossOrigin,data:JSON.stringify(b),success:function(a){return d(a),"undefined"!=typeof callback&&null!==callback?callback(a):void 0}})})})},a.prototype.formatPoints=function(a){return a.map(function(a){var b;return b={name:a.name,points:a.points.map(function(b){var c,d;return c={},a.columns.forEach(function(a,d){return c[a]=b[d]}),d=new Date(0),d.setUTCSeconds(Math.round(c.time/1e3)),c.time=d,c})}})},a.prototype.writePoint=function(a,b,c,d){var e,f,g,h,i;null==c&&(c={}),f={points:[],name:a,columns:[]},h=[];for(g in b)i=b[g],h.push(i),f.columns.push(g);return f.points.push(h),e=[f],this.post(this.path("db/"+this.database+"/series"),e,d)},a.prototype.writeSeries=function(a,b){return this.post(this.path("db/"+this.database+"/series"),a,b)},a.prototype.path=function(a,b){var c;return c=""+a+"?u="+this.username+"&p="+this.password,null!=b&&b.q&&(c+="&q="+encodeURIComponent(b.q)),c},a.prototype.url=function(a){var b;return b=this.hosts.shift(),this.hosts.push(b),""+(this.ssl?"https":"http")+"://"+b+":"+this.port+"/"+a},a.prototype.retry=function(a,b,c,d,e){var f=this;return null==d&&(d=10),null==e&&(e=this.max_retries),c().then(void 0,function(g){return 0===g.status?setTimeout(function(){return f.retry(a,b,c,Math.min(2*d,3e4),e-1)},d):b(g)})},a}()}.call(this),window.InfluxDB.VERSION="0.0.16",function(){}.call(this),angular.module("spot.im.utils",[]),angular.module("spot.im.utils").config([function(){function a(){this.pusherInstance=null,this.callbacks={}}function b(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}a.prototype.setPusherInstance=function(a){this.pusherInstance=a},a.prototype.addAuthRequest=function(a,b,c){this.callbacks[a]||(this.callbacks[a]={}),this.callbacks[a][b]=c},a.prototype.sendChunk=function(a,b,c){var d=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");d.open("POST",this.pusherInstance.options.authEndpoint,!0),d.setRequestHeader("Content-Type","application/json;charset=UTF-8");var e={socket_id:b};for(var f in a)e.channels_names||(e.channels_names=[]),e.channels_names.push(f);for(var g in this.pusherInstance.authOptions.params)e[g]=this.pusherInstance.authOptions.params[g];return d.onreadystatechange=function(){if(4===d.readyState)if(200===d.status){var b,e=!1;try{b=JSON.parse(d.responseText),e=!0}catch(f){c(!0,"JSON returned from webapp was invalid, yet status code was 200. Data was: "+d.responseText)}if(e)for(var g in b)a[g]&&a[g](!1,b[g])}else Pusher.warn("Couldn't get auth info from your webapp",d.status),c(!0,d.status)},d.send(JSON.stringify(e)),d},a.prototype.sendAll=function(a){var b=this.callbacks;this.callbacks={};for(var c in b)this.sendChunk(b[c],c,a)};var c=new a,d=b(function(){c.sendAll(function(){console.log("Pusher BufferedAuthorizer Error",arguments)})},1e3);Pusher.authorizers.buffered=function(a,b){c.setPusherInstance(this),c.addAuthRequest(a,this.channel.name,b),d()}}]),angular.module("spot.im.utils").config(["$provide",function(a){a.decorator("$q",["$delegate",function(a){function b(a){a.state="pending",a.then(function(b){a.state="fulfilled",a.resolveValue=b},function(b){a.state="rejected",a.rejectReason=b})}var c=a.defer;return a.defer=function(){var d=c.apply(a,arguments),e=d.promise,f=e.then;return e.then=function(){var a=f.apply(e,arguments);return b(a),a},b(e),d},a}])}]),angular.module("spot.im.utils").directive("absoluteConverter",["$timeout",function(a){return function(b,c,d){a(function(){var a=c.position(),b=c.offsetParent(),e={position:"absolute"},f=d.absoluteConverter.split(",");f.forEach(function(d){switch(d=d.trim()){case"top":e.top=a.top;break;case"left":e.left=a.left;break;case"bottom":e.bottom=b.outerHeight()-a.top-c.outerHeight(!0);break;case"right":e.right=b.outerWidth()-a.left-c.outerWidth(!0)}}),c.css("transition","none"),c.css(e),requestAnimationFrame(function(){c.css("transition","")})})}}]),angular.module("spot.im.utils").directive("accordion",["jquery","$window","$parse",function(a,b,c){var d=function(b,c){this.options=a.extend({},this.defaults,c),this.element=b,this.elementClass=null,this.changeStep(this.options.initStep)};return d.prototype={defaults:{steps:[],initStep:null,direction:"vertical"},_getValue:function(b){var c=b.attr("class")||"",d=b.attr("style")||"",e=a('<div class="'+c+'" style="'+d+'"></div>').insertAfter(b);e.css("transition","none");var f=null;switch(this.options.direction){case"vertical":f=e.height();break;case"horizontal":f=e.width()}return e.remove(),f},_setValue:function(a,b){switch(this.options.direction){case"vertical":a.height(b);break;case"horizontal":a.width(b)}},changeStep:function(b){!b&&this.options.steps.length>0&&(b=this.options.steps[0].name);var c=this.options.steps.filter(function(a){return a.name===b});if(0!==c.length){c=c[0];var d=this;this.element.removeClass(this.elementClass),this.elementClass=b,this.element.addClass(this.elementClass);var e=this._getValue(this.element),f=c.values,g=[];if(this.element.children().each(function(b,c){var h=a(c);"*"===f[b]?g.push(h):null===f[b]?(d._setValue(h,""),e-=d._getValue(h)):(d._setValue(h,f[b]),e-=d._getValue(h))}),g.length>0){var h=e/g.length;g.forEach(function(a){d._setValue(a,h)})}}}},a.fn.accordion=function(b){this.each(function(c,e){var f=a(e),g=new d(f,b);f.data("accordion",a.proxy(g.changeStep,g))})},function(a,b,d){var e=d.accordion?a.$eval(d.accordion):{};b.accordion(e);var f=c(d.changeStep),g=f.assign;g(a,b.data("accordion"))}}]),angular.module("spot.im.utils").directive("anchorClickRoot",["anchorClick",function(a){return{restrict:"A",link:function(b,c){a.setRootElement(c)}}}]).factory("anchorClick",function(){function a(){b.forEach(function(a){a()})}var b=[];return{on:function(a){a&&"function"==typeof a&&b.push(a)},off:function(a){var c=b.indexOf(a);c>=0&&b.splice(c,1)},setRootElement:function(b){b.on("click","a[href]",function(){a()})}}}),angular.module("spot.im.utils").directive("autoDirection",["direction",function(a){return{restrict:"A",link:{post:function(b,c,d){function e(b){var d=!!b&&a.isTextRTL(b);d>0&&c.addClass("right-to-left")}b.$watch(d.autoDirection,function(a){e(a)})}}}}]),angular.module("spot.im.utils").directive("autoSelect",function(){return{restrict:"A",link:function(a,b,c){a.$watch(c.autoSelect,function(){b.select()}),b.on("click",function(){this.select()})}}}),angular.module("spot.im.utils").directive("title",[function(){return{restrict:"A",link:{post:function(a,b,c){function d(a){a?b.attr("data-title",a):b.removeAttr("data-title")}c.$observe("title",d)}}}}]),angular.module("spot.im.utils").directive("onEvent",["$parse",function(a){return{link:function(b,c,d){var e=a(d["do"]);c.bind(d.onEvent,function(a){var c=Array.prototype.slice.call(arguments);c=c.splice(1),e(b,{$event:a,$params:c})})}}}]),angular.module("spot.im.utils").directive("onKeyup",["$parse",function(a){return{link:function(b,c,d){var e=a(d.onKeyup);c.bind("keyup",function(a){var c=Array.prototype.slice.call(arguments);c=c.splice(1),e(b,{$event:a,$params:c})})}}}]),angular.module("spot.im.utils").directive("fileInput",["$parse",function(a){return{restrict:"EA",template:'<input type="file" />',replace:!0,link:function(b,c,d){var e=angular.element(d.triggerButton);e.length&&(e.click(function(){c.click()}),c.hide());var f=a(d.fileInput),g=f.assign,h=a(d.onChange),i=function(){b.$safeApply(function(){g(b,c[0].files[0]),h(b)})};c.bind("change",i)}}}]),function(a){var b=function(a,b){b||(b={}),this.items=b.items||"",this.valueName=b.valueName||"value",this.textName=b.textName||"text",this.mustMatch=b.mustMatch!==!1,this.useOnlyHandle=b.useOnlyHandle===!0,this.selectedCallback=b.selectedCallback||function(){},this.elem=a,this.className=b.className||"",this.initialize()};a.extend(b.prototype,{initialize:function(){this.createDropDown(),this.elem.on("blur",this.triggerDropDownClose.bind(this)).on("keyup",this.matchQuery.bind(this)).on("keydown",this.keydownHandler.bind(this)),this.dropDown.on("focus",this.disableDropDownClose.bind(this)).on("click",this.selectDropDownItem.bind(this)).on("blur",this.closeDropDown.bind(this)),this.handle.on("click",this.toggleOpen.bind(this)).on("blur",this.triggerDropDownClose.bind(this)),this.useOnlyHandle||this.elem.on("click",this.toggleOpen.bind(this))},destroy:function(){this.elem.off("focus blur keyup click"),this.handle.remove(),this.dropDown.remove()},disabled:function(a){a?this.destroy():this.initialize()},update:function(b){var c=this;this.items=b.sort(function(a,b){return a[c.textName].localeCompare(b[c.textName])}),this.dropDown.find(".item").remove();var d=this.dropDown.find(".items");this.items&&this.items.length>0&&this.items.forEach(function(b){a('<li class="item" data-value="'+b[c.valueName]+'"></li>').text(b[c.textName]).appendTo(d)}),a('<li class="item unselectable empty">No results found</li>').appendTo(d)},triggerDropDownClose:function(){this.dropDownCloseTimeoutId=window.setTimeout(a.proxy(this.closeDropDown,this),200)},disableDropDownClose:function(){window.clearTimeout(this.dropDownCloseTimeoutId)},positionDropDown:function(){var a=this.elem.position();this.dropDown.css({top:a.top+this.elem.outerHeight(!1),left:a.left,width:this.elem.outerWidth(!1)})},positionHandle:function(){var a=this.elem.position();this.handle.css({top:a.top,left:a.left+this.elem.outerWidth(!1)-this.handle.outerWidth(!1),height:this.elem.outerHeight(!1)})},createDropDown:function(){var b='<a class="input-drop-down-handle" tabindex="1"></a>';this.handle=a(b).insertAfter(this.elem),requestAnimationFrame(function(){this.positionHandle()}.bind(this));var c='<div class="input-drop-down '+this.className+'"><ul class="items"></ul></div>';this.dropDown=a(c).insertAfter(this.handle).hide(),this.update(this.items)},keydownHandler:function(b){var c=b.keyCode||b.which;if(13===c){var d=a(this.dropDown.find(".item:visible").eq(this.currentIndex));d.length&&this.elem.val(d.text()).data("value",d.data("value")),b.preventDefault(),b.stopPropagation(),this.closeDropDown()}},toggleOpen:function(){this.isOpen?this.closeDropDown():this.openDropDown()},matchQuery:function(b){var c;if(b){var d=b.keyCode||b.which;if(d&&(38===d||40===d)){var e=this.dropDown.find(".item:visible"),f=this.currentIndex;this.currentIndex+=38===d?-1:1,this.currentIndex=(this.currentIndex+e.length)%e.length,this.dropDown.find(".item.active").removeClass("active"),c=e.eq(this.currentIndex).show().addClass("active");var g=c.parent().height(),h=c.outerHeight(),i=c.position().top,j=c.parent().scrollTop(),k=0;return 0>i?k=this.currentIndex-f+1||-1:i+h>g&&(k=this.currentIndex-f-1||1),void c.parent().scrollTop(j+k*h)}}{var l=this.elem.val().toLowerCase();this.dropDown}l?this.dropDown.find(".item").each(function(b,c){c=a(c);var d=c.text().toLowerCase();0===d.indexOf(l)?c.show():c.hide()}):(this.currentIndex=0,this.dropDown.find(".item").show())},getValue:function(){for(var b=this.elem.val(),c=null,d=this.dropDown.find(".item:contains("+b+")"),e=0;e<d.length&&null===c;e++){var f=a(d[e]).text();f===b&&(c=a(d[e]).data("value"))}return c},setText:function(a){var b=this;this.mustMatch&&b.elem.val(""),this.items.forEach(function(c){c[b.valueName]===a&&b.elem.val(c[b.textName])})},setValue:function(a){var b=this;b.elem.data("value",""),this.items.forEach(function(c){c[b.textName]===a&&b.elem.data("value",c[b.valueName])})},openDropDown:function(){return 0===this.items.length?!1:(this.elem.addClass("open"),this.positionDropDown(),this.dropDown.show(),this.currentIndex=-1,void(this.isOpen=!0))},closeDropDown:function(){var b=this.elem.val(),c=this.elem.val().toLowerCase(),d=null,e=this,f="",g=!1;this.isOpen=!1,c&&this.dropDown.find(".item").each(function(h,i){i=a(i),f=i.text().toLowerCase(),0===f.indexOf(c)&&f.length===c.length&&(e.elem.val(i.text()),d=i.data("value"),b=i.text(),g=!0)}),(!c||!g&&this.mustMatch)&&(this.elem.val("").data("value",""),d="",b=""),this.selectedCallback(d,b),this.elem.removeClass("open"),this.dropDown.hide()},selectDropDownItem:function(b){this.disableDropDownClose();var c=a(b.target);if(!c.hasClass("unselectable")){var d=c.data("value"),e=c.text();this.elem.val(e).data("value",d),this.currentIndex=c.index()}this.closeDropDown()},currentIndex:0}),a.fn.inputDropDown=function(c){this.each(function(){var d=a(this);d.data("inputDropDown",new b(d,c))})}}(jQuery),angular.module("spot.im.utils").directive("inputDropDown",["jquery","$q","$window","$parse",function(a,b,c,d){return function(a,c,e){function f(b){a.$watchCollection(function(){return b},function(a){c.data("inputDropDown").update(a)}),e.ngModel&&a.$watch(e.ngModel,function(a){c.data("inputDropDown").setValue(a)}),e.ngValueModel&&a.$watch(e.ngValueModel,function(a){c.data("inputDropDown").setText(a)})}var g=e.inputDropDown?a.$eval(e.inputDropDown):{},h=null,i=null,j=null,k=null,l=g.selectedCallback;g.selectedCallback=function(b,c){var d=arguments;a.$safeApply(function(){i&&i(a,b),k&&k(a,c),l&&l.apply(this,d)})};var m=g.items;angular.isArray(m)?(c.inputDropDown(g),f(m)):b.when(m).then(function(a){c.inputDropDown(angular.extend(g,{items:a})),f(a)}),e.ngValueModel&&(h=d(e.ngValueModel),i=h.assign),e.ngModel&&(j=d(e.ngModel),k=j.assign),a.$watch(function(){return g.disabled},function(a,b){a!==b&&c.data("inputDropDown").disabled(a)
}),a.$on("$destroy",function(){var a=c.data("inputDropDown");a&&a.destroy()})}}]),function(a,b,c,d){"use strict";var e,f,g,h={},i=!1,j=!1,k=0,l=0,m=1,n="",o="http://developers.facebook.com/docs/reference/javascript/",p=function(){return FB===d?(alert("Facebook integration is not defined. View "+o),!1):(h=c.extend(!0,{},H,h),h.max>0&&null!==h.max&&(h.showSelectedCount=!0,h.showButtonSelectAll=!1),s(),void h.onStart())},q=function(){f.fadeOut(400,function(){e.empty(),f.remove(),x(),g.fadeOut(400,function(){g.remove()})}),i=!1,j=!1,h.onClose()},r=function(){var a=[];if(c("input.fs-friends:checked").each(function(){var b=c(this).data();b&&a.push(b)}),h.facebookInvite===!0){for(var b="",d=0;d<a.length;d++)b+=a[d]+",";b=b.substr(0,b.length-1),FB.ui({method:"apprequests",message:h.lang.facebookInviteMessage,to:b},function(b){null!==b&&(h.onSubmit(a),h.closeOnSubmit===!0&&q())})}else h.onSubmit(a),h.closeOnSubmit===!0&&q()},s=function(){if(i!==!0){i=!0,c("body").append(g=c('<div id="fs-overlay"></div>'),f=c('<div id="fs-dialog-box-wrap"></div>')),f.append('<div class="fs-dialog-box-bg" id="fs-dialog-box-bg-n"></div><div class="fs-dialog-box-bg" id="fs-dialog-box-bg-ne"></div><div class="fs-dialog-box-bg" id="fs-dialog-box-bg-e"></div><div class="fs-dialog-box-bg" id="fs-dialog-box-bg-se"></div><div class="fs-dialog-box-bg" id="fs-dialog-box-bg-s"></div><div class="fs-dialog-box-bg" id="fs-dialog-box-bg-sw"></div><div class="fs-dialog-box-bg" id="fs-dialog-box-bg-w"></div><div class="fs-dialog-box-bg" id="fs-dialog-box-bg-nw"></div>'),f.append(e=c('<div id="fs-dialog-box-content"></div>'));var b='<div id="fs-dialog" class="fs-color-'+h.color+'"><h2 id="fs-dialog-title"><span>'+h.lang.title+'</span></h2><div id="fs-filter-box"><div id="fs-input-wrap"><input type="text" id="fs-input-text" title="'+h.lang.searchText+'" /><a href="javascript:{}" id="fs-reset">Reset</a></div></div><div id="fs-user-list"><ul></ul></div><div id="fs-filters-buttons"><div id="fs-filters"><a href="javascript:{}" id="fs-show-selected"><span>'+h.lang.buttonShowSelected+'</span></a></div><div id="fs-dialog-buttons"><a href="javascript:{}" id="fs-submit-button" class="fs-button"><span>'+h.lang.buttonSubmit+'</span></a><a href="javascript:{}" id="fs-cancel-button" class="fs-button"><span>'+h.lang.buttonCancel+"</span></a></div></div></div>";e.html(b),t(),A(!0),v(),F(),c(a).resize(function(){A(!1)})}},t=function(){c("#fs-user-list").append('<div id="fs-loading"></div>'),c.get("https://graph.facebook.com/me/friends?limit=5000&access_token="+h.fbToken).done(function(a){var b=a.data,d=h.profileImageSize;a.data.forEach(function(a){a.imageUrl="https://graph.facebook.com/"+a.id+"/picture?width="+d.width+"&height="+d.height});var e=null!==h.maxFriendsCount&&h.maxFriendsCount>0;(h.showRandom===!0||e===!0)&&(b=B(a.data));for(var f=0,g=0;f<b.length&&!(e&&h.maxFriendsCount<=g);f++)c.inArray(parseInt(b[f].id,10),h.getStoredFriends)>=0&&(u(f,b,!0),g++);for(var i=0;i<b.length&&!(e&&h.maxFriendsCount<=i+h.getStoredFriends.length);i++)c.inArray(parseInt(b[i].id,10),h.excludeIds)>=0||c.inArray(parseInt(b[i].id,10),h.getStoredFriends)<=-1&&u(i,b,!1);c("#fs-loading").remove()}).error(function(a){a.responseJSON.error&&(alert(h.lang.fbConnectError),q())})},u=function(a,b,d){var e=c("<li/>"),f=c('<a class="fs-anchor" href="javascript://"><input class="fs-fullname" type="hidden" name="fullname[]" value="'+b[a].name.toLowerCase().replace(/\s/gi,"+")+'" /><input class="fs-friends" type="checkbox" name="friend[]" value="fs-'+b[a].id+'" /><img class="fs-thumb" src="'+b[a].imageUrl+'" /><span class="fs-name">'+y(b[a].name,15)+"</span></a>");e.append(f),f.find(".fs-friends").data(b[a]),c("#fs-user-list ul").append(e),d&&w(e)},v=function(){f.delegate("#fs-cancel-button","click.fs",function(){q()}),f.delegate("#fs-submit-button","click.fs",function(){r()}),c("#fs-dialog input").focus(function(){c(this).val()===c(this)[0].title&&c(this).val("")}).blur(function(){""===c(this).val()&&c(this).val(c(this)[0].title)}).blur(),c("#fs-dialog input").keyup(function(){z(c(this))}),f.delegate("#fs-reset","click.fs",function(){c("#fs-input-text").val(""),z(c("#fs-dialog input")),c("#fs-input-text").blur()}),f.delegate("#fs-user-list li","click.fs",function(){w(c(this))}),c("#fs-show-selected").click(function(){G(c(this))}),c(b).keyup(function(a){27===a.which&&h.enableEscapeButton===!0&&q()}),h.closeOverlayClick===!0&&(g.css({cursor:"pointer"}),g.bind("click.fs",q))},w=function(a){var b=a;if(b.hasClass("checked"))b.removeClass("checked"),b.find("input.fs-friends").attr("checked",!1),m--,m-1!==c("#fs-user-list li").length&&c("#fs-select-all").text(h.lang.buttonSelectAll);else{var d=C();if(d===!1)return!1;m++,b.addClass("checked"),b.find("input.fs-friends").attr("checked",!0)}D()},x=function(){c("#fs-reset").undelegate("click.fs"),c("#fs-user-list li").undelegate("click.fs"),m=1,c("#fs-select-all").undelegate("click.fs")},y=function(a,b){var c=a.length;return b>=c?a:a.substr(0,b)+"..."},z=function(a){var b=c("#fs-dialog");n=c.trim(a.val());var d=n.toLowerCase().replace(/\s/gi,"+"),e=c("#fs-user-list .fs-fullname[value*="+d+"]"),f=c("#fs-user-list ul");f.children().hide(),c.each(e,function(){c(this).parents("li").show()});var g="";e.length>0&&n>""?(g=h.lang.summaryBoxResult.replace("{0}",'"'+a.val()+'"'),g=g.replace("{1}",e.length)):g=h.lang.summaryBoxNoResult.replace("{0}",'"'+a.val()+'"'),b.has("#fs-summary-box").length?b.has("#fs-result-text").length?c("#fs-result-text").text(g):c("#fs-summary-box").prepend('<span id="fs-result-text">'+g+"</span>"):c("#fs-filter-box").after('<div id="fs-summary-box"><span id="fs-result-text">'+g+"</span></div>"),""===n&&b.has("#fs-summary-box").length&&(1===m?c("#fs-summary-box").remove():c("#fs-result-text").remove())},A=function(d){k=a.screen.width,l=a.screen.height;var e=c(b).height(),i=f.width(),j=f.height(),m=k/2-i/2,n=l/2-j/2;d===!0?g.css({"background-color":h.overlayColor,opacity:h.overlayOpacity,height:e}).fadeIn("fast",function(){f.css({left:m,top:n}).fadeIn()}):(f.stop().animate({left:m,top:n},200),g.css({height:e}))},B=function(a){for(var b,c,d=a.length;d;b=parseInt(Math.random()*d,10),c=a[--d],a[d]=a[b],a[b]=c);return a},C=function(){if(m>h.max&&null!==h.max){var a=h.lang.selectedLimitResult.replace("{0}",h.max);return c(".fs-limit").html('<span class="fs-limit fs-full">'+a+"</span>"),!1}},D=function(){if(m>1&&h.showSelectedCount===!0){var a=h.lang.selectedCountResult.replace("{0}",m-1);c("#fs-dialog").has("#fs-summary-box").length?c("#fs-dialog").has(".fs-limit.fs-count").length?c(".fs-limit").text(a):c("#fs-summary-box").append('<span class="fs-limit fs-count">'+a+"</span>"):c("#fs-filter-box").after('<div id="fs-summary-box"><span class="fs-limit fs-count">'+a+"</span></div>")}else""===n?c("#fs-summary-box").remove():c(".fs-limit").remove()},E=function(){c("#fs-user-list li").removeClass("checked"),c("#fs-user-list input.fs-friends").attr("checked",!1),m=1},F=function(){h.showButtonSelectAll===!0&&null===h.max&&(c("#fs-show-selected").before('<a href="javascript:{}" id="fs-select-all"><span>'+h.lang.buttonSelectAll+"</span></a> - "),f.delegate("#fs-select-all","click.fs",function(){m-1!==c("#fs-user-list li").length?(c("#fs-user-list li:hidden").show(),E(),c("#fs-user-list li").each(function(){w(c(this))}),c("#fs-select-all").text(h.lang.buttonDeselectAll),j===!0&&(j=!1,c("#fs-show-selected").text(h.lang.buttonShowSelected))):(E(),D(),c("#fs-select-all").text(h.lang.buttonSelectAll))}))},G=function(a){var b=c("#fs-user-list ul"),d=b.find("li"),e=b.find("li.checked");(0!==e.length&&e.length!==d.length||j===!0)&&(j===!0?(a.removeClass("active").text(h.lang.buttonShowSelected),b.children().show(),j=!1):(a.addClass("active").text(h.lang.buttonShowAll),b.children().hide(),c.each(e,function(){c(this).show()}),j=!0))},H={max:null,excludeIds:[],getStoredFriends:[],closeOverlayClick:!0,enableEscapeButton:!0,overlayOpacity:"0.3",overlayColor:"#000",closeOnSubmit:!1,showSelectedCount:!0,showButtonSelectAll:!0,color:"default",profileImageSize:{width:30,height:30},lang:{title:"Friend Selector",buttonSubmit:"Send",buttonCancel:"Cancel",buttonSelectAll:"Select All",buttonDeselectAll:"Deselect All",buttonShowSelected:"Show Selected",buttonShowAll:"Show All",summaryBoxResult:"{1} best results for {0}",summaryBoxNoResult:"No results for {0}",searchText:"Enter a friend's name",fbConnectError:"You must connect to Facebook to see this.",selectedCountResult:"You have choosen {0} people.",selectedLimitResult:"Limit is {0} people.",facebookInviteMessage:"Invite message"},maxFriendsCount:null,showRandom:!1,facebookInvite:!1,onStart:function(){return null},onClose:function(){return null},onSubmit:function(){return null}};c.fn.fSelector=function(a){return this.unbind("click.fs"),this.bind("click.fs",function(){h=a,p()}),this}}(window,document,jQuery),angular.module("spot.im.utils").directive("friendsSelector",["$timeout",function(a){return{restrict:"EA",link:function(b,c,d){var e=angular.extend({},b.$eval(d.options));a(function(){c.fSelector(e)},0)}}}]),function(a,b){function c(a,b,c){var d=a.children(),e=!1;a.empty();for(var g=0,h=d.length;h>g;g++){var i=d.eq(g);if(a.append(i),c&&a.append(c),f(a,b)){i.remove(),e=!0;break}c&&c.detach()}return e}function d(b,c,g,h,i){var j=b.contents(),k=!1;b.empty();for(var l="table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, blockquote, select, optgroup, option, textarea, script, style",m=0,n=j.length;n>m&&!k;m++){var o=j[m],p=a(o);"undefined"==typeof o||3==o.nodeType&&0==a.trim(o.data).length||(b.append(p),i&&b[b.is(l)?"after":"append"](i),f(g,h)&&(k=3==o.nodeType?e(p,c,g,h,i):d(p,c,g,h,i),k||(p.remove(),k=!0)),k||i&&i.detach())}return k}function e(b,c,d,e,h){var k=b[0];if(!k)return!1;var m=j(k),n=-1!==m.indexOf(" ")?" ":"",o="letter"==e.wrap?"":n,p=m.split(o),q=-1,r=-1,s=0,t=p.length-1;for(e.fallbackToLetter&&0==t&&t==s&&(o="",p=m.split(o),t=p.length-1);t>=s&&(0!=s||0!=t);){var u=Math.floor((s+t)/2);if(u==r)break;r=u,i(k,p.slice(0,r+1).join(o)+e.ellipsis),f(d,e)?t=r:(q=r,s=r)}if(-1==q||1==p.length&&0==p[0].length){var v=b.parent();b.remove();var w=h&&h.closest(v).length?h.length:0;v.contents().length>w?k=l(v.contents().eq(-1-w),c):(k=l(v,c,!0),w||v.remove()),k&&(m=g(j(k),e),i(k,m),w&&h&&a(k).parent().append(h))}else m=g(p.slice(0,q+1).join(o),e),i(k,m);return!0}function f(a,b){return a.innerHeight()>b.maxHeight}function g(b,c){for(;a.inArray(b.slice(-1),c.lastCharacter.remove)>-1;)b=b.slice(0,-1);return a.inArray(b.slice(-1),c.lastCharacter.noEllipsis)<0&&(b+=c.ellipsis),b}function h(a){return{width:a.innerWidth(),height:a.innerHeight()}}function i(a,b){a.innerText?a.innerText=b:a.nodeValue?a.nodeValue=b:a.textContent&&(a.textContent=b)}function j(a){return a.innerText?a.innerText:a.nodeValue?a.nodeValue:a.textContent?a.textContent:""}function k(a){do a=a.previousSibling;while(a&&1!==a.nodeType&&3!==a.nodeType);return a}function l(b,c,d){var e,f=b&&b[0];if(f){if(!d){if(3===f.nodeType)return f;if(a.trim(b.text()))return l(b.contents().last(),c)}for(e=k(f);!e;){if(b=b.parent(),b.is(c)||!b.length)return!1;e=k(b[0])}if(e)return l(a(e),c)}return!1}function m(b,c){return b?"string"==typeof b?(b=a(b,c),b.length?b:!1):b.jquery?b:!1:!1}function n(a){for(var b=a.innerHeight(),c=["paddingTop","paddingBottom"],d=0,e=c.length;e>d;d++){var f=parseInt(a.css(c[d]),10);isNaN(f)&&(f=0),b-=f}return b}function o(a,b){return a?(b="string"==typeof b?"dotdotdot: "+b:["dotdotdot:",b],"undefined"!=typeof window.console&&"undefined"!=typeof window.console.log&&window.console.log(b),!1):!1}if(!a.fn.dotdotdot){a.fn.dotdotdot=function(b){if(0==this.length)return b&&b.debug===!1||o(!0,'No element found for "'+this.selector+'".'),this;if(this.length>1)return this.each(function(){a(this).dotdotdot(b)});var e=this;e.data("dotdotdot")&&e.trigger("destroy.dot"),e.data("dotdotdot-style",e.attr("style")||""),e.css("word-wrap","break-word"),"nowrap"===e.css("white-space")&&e.css("white-space","normal"),e.bind_events=function(){return e.bind("update.dot",function(b,h){b.preventDefault(),b.stopPropagation(),i.maxHeight="number"==typeof i.height?i.height:n(e),i.maxHeight+=i.tolerance,"undefined"!=typeof h&&(("string"==typeof h||h instanceof HTMLElement)&&(h=a("<div />").append(h).contents()),h instanceof a&&(g=h)),q=e.wrapInner('<div class="dotdotdot" />').children(),q.empty().append(g.clone(!0)).find("br").replaceWith("  <br />  ").end().css({height:"auto",width:"auto",border:"none",padding:0,margin:0});var k=!1,l=!1;return j.afterElement&&(k=j.afterElement.clone(!0),k.show(),j.afterElement.remove()),f(q,i)&&(l="children"==i.wrap?c(q,i,k):d(q,e,q,i,k)),q.replaceWith(q.contents()),q=null,a.isFunction(i.callback)&&i.callback.call(e[0],l,g),j.isTruncated=l,l}).bind("isTruncated.dot",function(a,b){return a.preventDefault(),a.stopPropagation(),"function"==typeof b&&b.call(e[0],j.isTruncated),j.isTruncated}).bind("originalContent.dot",function(a,b){return a.preventDefault(),a.stopPropagation(),"function"==typeof b&&b.call(e[0],g),g}).bind("destroy.dot",function(a){a.preventDefault(),a.stopPropagation(),e.unwatch().unbind_events().empty().append(g).attr("style",e.data("dotdotdot-style")||"").data("dotdotdot",!1)}),e},e.unbind_events=function(){return e.unbind(".dot"),e},e.watch=function(){if(e.unwatch(),"window"==i.watch){var b=a(window),c=b.width(),d=b.height();b.bind("resize.dot"+j.dotId,function(){c==b.width()&&d==b.height()&&i.windowResizeFix||(c=b.width(),d=b.height(),l&&clearInterval(l),l=setTimeout(function(){e.trigger("update.dot")},10))})}else k=h(e),l=setInterval(function(){var a=h(e);(k.width!=a.width||k.height!=a.height)&&(e.trigger("update.dot"),k=h(e))},100);return e},e.unwatch=function(){return a(window).unbind("resize.dot"+j.dotId),l&&clearInterval(l),e};var g=e.contents(),i=a.extend(!0,{},a.fn.dotdotdot.defaults,b),j={},k={},l=null,q=null;return i.lastCharacter.remove instanceof Array||(i.lastCharacter.remove=a.fn.dotdotdot.defaultArrays.lastCharacter.remove),i.lastCharacter.noEllipsis instanceof Array||(i.lastCharacter.noEllipsis=a.fn.dotdotdot.defaultArrays.lastCharacter.noEllipsis),j.afterElement=m(i.after,e),j.isTruncated=!1,j.dotId=p++,e.data("dotdotdot",!0).bind_events().trigger("update.dot"),i.watch&&e.watch(),e},a.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",fallbackToLetter:!0,lastCharacter:{},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0,debug:!1},a.fn.dotdotdot.defaultArrays={lastCharacter:{remove:[" ","",",",";",".","!","?"],noEllipsis:[]}};var p=1,q=a.fn.html;a.fn.html=function(c){return c!=b&&!a.isFunction(c)&&this.data("dotdotdot")?this.trigger("update",[c]):q.apply(this,arguments)};var r=a.fn.text;a.fn.text=function(c){return c!=b&&!a.isFunction(c)&&this.data("dotdotdot")?(c=a("<div />").text(c).html(),this.trigger("update",[c])):r.apply(this,arguments)}}}(jQuery),function(a){function b(b){var c=b.text(),d=a('<span style="display:none"></span>').text(c);a("body").append(d);var e=a("body").find("span:last").width();return a("body").find("span:last").remove(),e}a.fn.marquee=function(c){function d(){if(!p){if(!f.length)return n.reject();if(i==m){if(l++,l==c.count)return f.css(j),n.resolve();i=c.leftToRight?-1*g:h}f.css("text-indent",i+"px"),c.leftToRight?i++:i--,o=setTimeout(d,c.speed)}}function e(){p||(-1!==o&&(clearTimeout(o),o=-1),f.css("text-indent",""))}var f=a(this),g=b(f),h=f.width(),i=0,j={"text-indent":f.css("text-indent"),overflow:f.css("overflow"),"white-space":f.css("white-space")},k={"text-indent":i,overflow:"hidden","white-space":"nowrap"},c=a.extend(!0,{count:-1,speed:10,leftToRight:!1},c),l=0,m=-1*g,n=a.Deferred(),o=-1,p=!1;return h>=g?(n.reject(),p=!0):(c.leftToRight?(i=-1*g,i++,m=h):i--,f.css(k)),{promise:n.promise(),halt:e,go:d}}}(jQuery),angular.module("spot.im.utils").directive("hoverMarquee",[function(){return{link:{post:function(a,b,c){var d=a.$eval(c.speed)||10,e=a.$eval(c.leftToRight)||!1,f=a.$eval(c.count)||-1,g={speed:d,leftToRight:e,count:f},h=null;b.hover(function(){h=b.marquee(g),h.go()},function(){h.halt(),h=null})}}}}]),angular.module("spot.im.utils").service("localeStringGetter",["$q",function(a){var b=null;this.set=function(a){b=a},this.getString=function(a){return b(a)},this.interpolate=function(b,c){var d=this.getString(b);return d?a.when(d).then(function(a){if(a){var b=/%{(\w*)}/gi;return a=a.replace(b,function(a,b){return c[b]||"<"+b+">"})}}):""}}]).directive("localeString",["$q","localeStringGetter",function(a,b){return function(c,d,e){function f(){var c=b.interpolate(g,h);c&&a.when(c).then(function(a){i?d.attr(i,a):d.is("input, textarea")?d.val(a):d.text(a)})}var g=e.localeString;if(g){var h=c.$eval(e.localeParams),i=e.localeAttr;f(),c.$on("locale-changed",f)}}}]),angular.module("spot.im.utils").directive("maxWidth",["$timeout","$window",function(a,b){function c(a){var b=a.parent(),c=0;return b.children().each(function(b,d){var e=angular.element(d);d!==a[0]&&"none"!==e.css("display")&&(c+=e.outerWidth(!0))}),b.width()-c+"px"}function d(a){a.css("max-width",c(a))}return{restrict:"A",link:function(c,e){a(function(){d(e),angular.element(b).on("resize",function(){d(e)})})}}}]),function(a,b){function c(b,c){this.options=a.extend(!0,{},this.defaults,c),this.itemsCollection={},this.mentionsCollection=[],this.inputBuffer=[],this.currentDataQuery="",this.element=b,this.initTextarea(),this.initListBox(),this.initMentionsOverlay(),this.resetInput(),this.bindEvents()}var d={BACKSPACE:8,TAB:9,RETURN:13,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,COMMA:188,SPACE:32,HOME:36,END:35},e={htmlEncode:function(a){return b.escape(a)},highlightTerm:function(a,b){return b||b.length?a.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+b+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>"):a},setCaratPosition:function(a,b){if(a.createTextRange){var c=a.createTextRange();c.move("character",b),c.select()}else a.selectionStart||b?(a.focus(),a.setSelectionRange(b,b)):a.focus()},getCaretPosition:function(a){try{if(a.selectionStart)return a.selectionStart;if(document.selection){a.focus();var b=document.selection.createRange();if(null==b)return 0;var c=a.createTextRange(),d=c.duplicate();return c.moveToBookmark(b.getBookmark()),d.setEndPoint("EndToStart",c),d.text.length}}catch(e){}return 0},rtrim:function(a){return a.replace(/\s+$/,"")}};c.prototype={defaults:{reverseOrder:!1,autoselect:!0,triggerChar:"@",onDataRequest:a.noop,onItemSelected:a.noop,minChars:2,showAvatars:!0,classes:{autoCompleteItemActive:"active"},templates:{wrapper:b.template('<div class="mentions-input-box"></div>'),autocompleteList:b.template('<div class="mentions-autocomplete-list"></div>'),autocompleteListItem:b.template('<li data-ref-id="<%= id %>" data-ref-type="<%= type %>" data-display="<%= display %>"><div class="names"><span class="name"><%= display %></span> <span class="username"><%= username %></span></div><div class="type"><%= type %></div></li>'),autocompleteListItemAvatar:b.template('<div class="avatar" style="background-image: url(\'<%= avatar %>\')"></div>'),autocompleteListItemIcon:b.template('<div class="icon <%= icon %>"></div>'),mentionsOverlay:b.template('<div class="mentions"><div></div></div>'),mentionItemSyntax:b.template("@[<%= value %>](<%= type %>:<%= id %>)"),mentionItemHighlight:b.template('<strong class="branded-border-bottom"><%= value %></strong>')}},resetBuffer:function(){this.inputBuffer.length=0},selectItem:function(a){a.addClass(this.options.classes.autoCompleteItemActive),a.siblings().removeClass(this.options.classes.autoCompleteItemActive),this.activeItem=a},bindEvents:function(){this.onInputBoxKeyDown=b.bind(this.onInputBoxKeyDown,this),this.onInputBoxKeyPress=b.bind(this.onInputBoxKeyPress,this),this.onInputBoxInput=b.bind(this.onInputBoxInput,this),this.onInputBoxClick=b.bind(this.onInputBoxClick,this),this.onInputBoxBlur=b.bind(this.onInputBoxBlur,this),this.onListItemHover=b.bind(this.onListItemHover,this),this.onListItemClick=b.bind(this.onListItemClick,this),this.element.bind("keydown",this.onInputBoxKeyDown).bind("keypress",this.onInputBoxKeyPress).bind("input",this.onInputBoxInput).bind("click",this.onInputBoxClick).bind("blur",this.onInputBoxBlur),this.listBox.on("mousedown","li",this.onListItemClick).on("mouseover","li",this.onListItemHover)},initTextarea:function(){var a=this.element.parent();this.element.wrapAll(this.options.templates.wrapper()),this.wrapper=a.find("> div")},initListBox:function(){this.listBox=a(this.options.templates.autocompleteList()),this.listBox.appendTo(this.wrapper)},initMentionsOverlay:function(){this.mentionsOverlay=a(this.options.templates.mentionsOverlay()),this.mentionsOverlay.prependTo(this.wrapper)},resetInput:function(){this.element.val(""),this.mentionsCollection.length=0,this.updateValues()},doSearch:function(){var a=this.currentDataQuery;if(a&&a.length&&a.length>=this.options.minChars){var b=this;this.options.onDataRequest.call(this,a,function(c){b.populateDropdown(a,c)})}else this.hideAutoComplete()},populateDropdown:function(c,d){this.listBox.show(),b.each(d,function(a){a.value||(a.value=a.name)});var f=b.pluck(this.mentionsCollection,"value");if(d=b.reject(d,function(a){return b.include(f,a.value)}),!d.length)return void this.hideAutoComplete();this.listBox.empty();var g=a("<ul>").appendTo(this.listBox).hide();this.options.reverseOrder&&d.reverse();var h=this,i=this.options;b.each(d,function(c,f){var j=b.uniqueId("mention_");h.itemsCollection[j]=b.extend({value:c.name},c);var k=a(i.templates.autocompleteListItem({id:e.htmlEncode(c.id),display:e.htmlEncode(c.name),username:c.unique_name?e.htmlEncode("@"+c.unique_name):null,type:e.htmlEncode(c.type.substr(0,1).toUpperCase()+c.type.slice(1))})).attr("data-uid",j);if(i.autoselect&&(0===f&&!i.reverseOrder||f===d.length-1&&i.reverseOrder)&&h.selectItem(k),i.showAvatars){var l;l=a(c.avatar?i.templates.autocompleteListItemAvatar({avatar:c.avatar}):i.templates.autocompleteListItemIcon({icon:c.icon})),l.prependTo(k)}k.appendTo(g)}),this.listBox.show(),g.show()},hideAutoComplete:function(){this.activeItem=null,this.listBox.empty().hide()},updateMentionsCollection:function(){var a=this.getValue();this.mentionsCollection=b.reject(this.mentionsCollection,function(b){return!b.value||-1==a.indexOf(b.value)}),this.mentionsCollection=b.compact(this.mentionsCollection)},addMention:function(a){var b=this.getValue(),c=new RegExp("\\"+this.options.triggerChar+this.currentDataQuery,"gi");c.exec(b);var d=e.getCaretPosition(this.element[0]),f=d-this.currentDataQuery.length-1,g=b.substr(0,f),h=b.substr(d,b.length),i=(g+a.value).length+1;a.start=f,a.length=a.value.length,this.mentionsCollection.push(a),this.resetBuffer(),this.currentDataQuery="",this.hideAutoComplete();var j=g+a.value+" "+h;this.element.val(j),this.updateValues(),this.element.focus(),e.setCaratPosition(this.element[0],i)},getValue:function(){return this.element.val().trim()},updateValues:function(){var a=this.getValue(),c=this.options;this.mentionsCollection.forEach(function(b){var d=c.templates.mentionItemSyntax(b);a=a.replace(b.value,d)});var d=e.htmlEncode(a),f=this;b.each(this.mentionsCollection,function(a){var c=b.extend({},a,{value:e.htmlEncode(a.value)}),g=f.options.templates.mentionItemSyntax(c),h=f.options.templates.mentionItemHighlight(c);d=d.replace(g,h)}),d=d.replace(/\n/g,"<br />"),d=d.replace(/ {2}/g,"&nbsp; "),this.element.data("messageText",a),this.mentionsOverlay.find("div").html(d)},onInputBoxKeyDown:function(c){if(c.keyCode==d.LEFT||c.keyCode==d.RIGHT||c.keyCode==d.HOME||c.keyCode==d.END)return b.defer(b.bind(this.resetBuffer,this)),void(navigator.userAgent.indexOf("MSIE 9")>-1&&b.defer(b.bind(this.updateValues,this)));if(c.keyCode==d.BACKSPACE)return void(this.inputBuffer=this.inputBuffer.slice(0,-1+this.inputBuffer.length));if(!this.listBox.is(":visible"))return!0;switch(c.keyCode){case d.UP:case d.DOWN:var e=null;return e=c.keyCode==d.DOWN?this.activeItem&&this.activeItem.length?this.activeItem.next():this.listBox.find("li").first():a(this.activeItem).prev(),e.length&&this.selectItem(e),!1;case d.RETURN:case d.TAB:if(this.activeItem&&this.activeItem.length)return this.activeItem.trigger("mousedown"),c.stopImmediatePropagation(),!1;break;case d.ESC:this.hideAutoComplete()}return!0},onInputBoxKeyPress:function(a){if(a.keyCode!==d.BACKSPACE){var b=String.fromCharCode(a.which||a.keyCode);this.inputBuffer.push(b)}},onInputBoxInput:function(){this.updateValues(),this.updateMentionsCollection();var a=this.getValue(),c=e.getCaretPosition(this.element[0]),d=0,f=-1,g=a.lastIndexOf(" ",c);this.options.triggerChar.length>0&&(d=a.lastIndexOf(this.options.triggerChar,c),f=a.lastIndexOf(" ",c),g=d),d>f&&(this.currentDataQuery=a.slice(g+1),this.currentDataQuery=e.rtrim(this.currentDataQuery),b.defer(b.bind(this.doSearch,this)))},onInputBoxClick:function(){this.resetBuffer()},onInputBoxBlur:function(){this.hideAutoComplete()},onListItemHover:function(b){var c=a(b.currentTarget);this.selectItem(c)},onListItemClick:function(b){var c=a(b.currentTarget),d=this.itemsCollection[c.attr("data-uid")];return this.options.disableMentions||this.addMention(d),this.options.onItemSelected(d),!1}},a.fn.mentionsInput=function(d){return this.each(function(){var e=a(this),f=new c(e,d),g={reset:function(){f.resetInput()},getMentions:function(){var a=b.clone(f.mentionsCollection);if(a.length){var c=f.element.data("messageText");a.forEach(function(a){var b=/@\[[^\]]*\]\(([^:]*):([^\)]*)/g,d=b.exec(c);a.start=d.index,c=c.substr(0,d.index)+a.value+c.substr(b.lastIndex+1)})}return a},replyMention:function(a){f.options.disableMentions||(f.resetInput(),f.addMention(a))}};a(this).data("mentionsInput",g)})}}(jQuery,_),angular.module("spot.im.utils").directive("mentionsInput",["$parse",function(){return{restrict:"EA",link:function(a,b,c){var d=c.mentionsInput?a.$eval(c.mentionsInput):{};b.mentionsInput(d),d.api=b.data("mentionsInput")}}}]),angular.module("spot.im.utils").directive("modalWindow",["jquery","$timeout",function(a,b){return{restrict:"A",link:function(a,c){a.shouldCenter!==!1&&(c.hide(),b(function(){c.css({"margin-left":-c.width()/2,"margin-top":-c.height()/2}).show()}))}}}]),angular.module("spot.im.utils").directive("modelPrefix",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){function e(a){return a&&!g.test(a)&&-1===f.indexOf(a)?(d.$setViewValue(f+a),d.$render(),f+a):a}var f=c.modelPrefix,g=new RegExp("^"+f,"i");d.$formatters.push(e),d.$parsers.push(e)}}}),angular.module("spot.im.utils").directive("ngRepeatPostRender",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){b.$last===!0&&a(function(){b.$eval(d.ngRepeatPostRender)})}}}]),angular.module("spot.im.utils").directive("scrolledElement",[function(){return{controller:["Events",function(a){angular.extend(this,a)}],link:function(a,b,c,d){var e=null;b.on("scroll",function(){var a=b.scrollTop(),c=b.outerHeight(),f=b[0].scrollHeight;0===a?(d.trigger("on-scrolled-top"),b.trigger("on-scrolled-top"),e="top"):0>=f-(a+c)&&(d.trigger("on-scrolled-bottom"),b.trigger("on-scrolled-bottom"),e="bottom")})}}}]).directive("onScrolledBottom",[function(){return{require:"^scrolledElement",scope:{action:"&onScrolledBottom"},link:function(a,b,c,d){d.on("on-scrolled-bottom",a.action),b.on("$destroy",function(){d.off("on-scrolled-bottom",a.action)})}}}]).directive("onScrolledTop",[function(){return{require:"^scrolledElement",scope:{action:"&onScrolledTop"},link:function(a,b,c,d){d.on("on-scrolled-top",a.action),b.on("$destroy",function(){d.off("on-scrolled-top",a.action)})}}}]),angular.module("spot.im.utils").directive("scrollUnwatch",["$rootScope","underscore","Logger","utils",function(a,b,c,d){var e=a.$watch,f=c.getInstance("scrollUnwatch");return{restrict:"A",link:{pre:function(a,c){function g(){var b=0,e=0,g=c.scrollTop(),k=c.height(),l=c.find("[scroll-unwatch-item]"),m=0,n=g-i>0;i&&j&&(n?(m=j[0],l=l.slice(j[0])):(m=0,l=l.slice(0,j[1]+1)));var o=d.closestIndexOf(l.length,function(a){return l.eq(a).position().top},0,!1),p=d.closestIndexOf(l.length,function(a){return l.eq(a).position().top},k,!0);l.each(function(a,c){var d=a>=o&&p>=a,f=$(c),g=f.scope();g&&(d?(g.$rewatch(f),b++):(g.$unwatch(f),e++))}),f.debug("updateWatchers","{0} scopes rewatched and {1} scopes unwatched (total {2} watchers in {3} scopes)",[b,e,Object.keys(h).reduce(function(a,b){return 1*a+h[b].watchersList.length},0),Object.keys(h).length]),i=g,j=n?[m+o,m+p]:[o,p],a.$apply()}var h={};a.deregisterItemScope=function(){var a=this;a.$unwatch(),delete h[a.$id]},a.registerItemScope=function(){var a=this;a.$watch=function(b,c,d){var f=e.call(this,b,c,d);h[a.$id]||(h[a.$id]={isActive:!0,watchersList:[]}),h[a.$id].watchersList.push({originalScope:this,watchExp:b,listener:c,objectEquality:d,deregistration:f})};var b=a.$on("$destroy",function(){b(),a.deregisterItemScope()});f.debug("registerItemScope","register scope {0}",[a.$id])},a.$rewatch=function(){var a=this,b=h[a.$id];b&&0!==b.watchersList.length&&!b.isActive&&(f.debug("$rewatch","rewatch scope {0}",[a.$id]),b.watchersList.forEach(function(a){a.deregistration=e.call(a.originalScope,a.watchExp,a.listener,a.objectEquality)}),b.isActive=!0)},a.$unwatch=function(){var a=this,b=h[a.$id];b&&0!==b.watchersList.length&&b.isActive&&(f.debug("$unwatch","unwatch scope {0}",[a.$id]),b.watchersList.forEach(function(a){a.deregistration()}),b.isActive=!1)},a.validateItemScopeWatchers=function(a){var b=this,d=a.position().top,e=(c.scrollTop(),c.height());d>=0&&e>d?b.$rewatch(a):b.$unwatch(a)};var i=null,j=null;c.on("scroll",b.debounce(g,200))}}}}]),angular.module("spot.im.utils").directive("scrollUnwatchItem",["$rootScope","$timeout","underscore","Logger","utils",function(a,b){a.$watch;return{restrict:"A",link:{pre:function(a,b){a.registerItemScope&&a.registerItemScope(b)},post:function(a,c){a.validateItemScopeWatchers&&b(function(){a.validateItemScopeWatchers(c)})}}}}]),angular.module("spot.im.utils").factory("BaseScrollbar",["underscore",function(a){var b=20,c=function(c,d,e){this.element=c,this.logger=d,this.options=e;var f=null;c.on("scroll",a.debounce(function(){var a=c.scrollTop(),e=c.outerHeight(),g=c[0].scrollHeight;0===a?(c.trigger("scrolled-top"),d.debug("'scrolled-top' event was fired"),f="top"):b>g-(a+e)&&(c.trigger("scrolled-bottom"),d.debug("'scrolled-bottom' event was fired"),f="bottom")},100)),this.options.api=this};return c.prototype={scrollBottom:function(a){this.logger.debug("scrollBottom method was activated with distance = {0}",[a]),this._scrollBottom(a)},update:function(a){this.logger.debug("update method was activated"),this._update(a)},isActive:function(){var a={x:this._isXActive(),y:this._isYActive()};return this.logger.debug("isActive","X is {0}active, Y is {1}active",[a.x?"":"not ",a.y?"":"not "]),a},distanceFromBottom:function(){var a=this.element[0],b=a.scrollHeight-a.scrollTop-a.clientHeight;return this.logger.debug("distanceFromBottom","{0}px from bottom",[b]),b},destroy:function(){this.logger.debug("Destroy BaseScrollbar"),this.element.off("scrolled-top"),this.element.off("scrolled-bottom"),this.element.off("scroll"),this.options.api=null,this._destroy()},_scrollBottom:function(){},_update:function(){},_isXActive:function(){},_isYActive:function(){},_destroy:function(){}},c}]),angular.module("spot.im.utils").directive("nativeScrollbar",["BaseScrollbar","Logger",function(a,b){return{restrict:"A",link:function(c,d,e){var f=b.getInstance("nativeScroll");d.on("mousewheel",function(a){var b=d.outerHeight(),c=a.originalEvent.wheelDelta;return this.scrollTop===this.scrollHeight-b&&0>c||0===this.scrollTop&&c>0?(a.preventDefault(),a.stopPropagation(),a.returnValue=!1,!1):void 0});var g=e.nativeScrollbar?c.$eval(e.nativeScrollbar):{},h=new a(d,f,g);angular.extend(h,{_scrollBottom:function(){d.scrollTop(d.get(0).scrollHeight-d.get(0).clientHeight)},_update:function(){},_isYActive:function(){return d.get(0).scrollHeight>d.get(0).clientHeight},_isXActive:function(){return d.get(0).scrollWidth>d.get(0).clientWidth}})}}}]),angular.module("spot.im.utils").directive("perfectScrollbar",["BaseScrollbar","Logger",function(a,b){return function(c,d,e){var f=b.getInstance("perfectScrollbar"),g=e.perfectScrollbar?c.$eval(e.perfectScrollbar):{};
d.perfectScrollbar(g);var h=new a(d,f,g),i=d.data("perfect-scrollbar-api");angular.extend(h,{_scrollBottom:function(a){i.scrollBottom(a)},_update:function(a){i.update(a)},_isYActive:function(){return i.isYActive()},_isXActive:function(){return i.isXActive()},_destroy:function(){i.destroy()}})}}]),angular.module("spot.im.utils").directive("ngScrollbar",["Events","$window","underscore",function(a,b,c){var d=20;return{scope:{},controller:["$scope","$element",function(a,d){function e(){return d[0].scrollHeight}var f=[],g=c.debounce(function(){b.requestAnimationFrame(function(){var a=0;f.forEach(function(b){b.show(),a+=b[0].clientHeight}),d[0].scrollTop=d[0].scrollTop+a,f=[]})},200);this.update=function(){var a=Math.min(d.scrollTop(),e());d.scrollTop(a),d.perfectScrollbar2("update")},this.scrollToTop=function(){d.scrollTop(0),d.perfectScrollbar2("update")},this.scrollToBottom=function(){var a=e();d.scrollTop(a),d.perfectScrollbar2("update")},this.distanceFromBottom=function(){return d[0].scrollHeight-d[0].scrollTop-d[0].clientHeight},this.isYActive=function(){return d[0].scrollHeight>0},this.addChildElement=function(a){a.hide(),b.requestAnimationFrame(function(){var b=a.offset().top>d.outerHeight();b||(f.push(a),g())})}}],link:function(a,e,f){var g=a.$eval(f.ngScrollbar)||{};g=angular.extend({wheelSpeed:b.navigator.platform.toUpperCase().indexOf("MAC")>=0?100:700},g),e.perfectScrollbar2(g);var h=null;e.on("scroll",c.debounce(function(){var a=e.scrollTop(),b=e.outerHeight(),c=e[0].scrollHeight;0===a?(e.trigger("on-scrolled-top"),h="top"):d>c-(a+b)&&(e.trigger("on-scrolled-bottom"),h="bottom")},100)),e.bind("$destroy",function(){e.perfectScrollbar2("destroy")})}}}]).directive("scrollItem",[function(){return{require:"^ngScrollbar",link:function(a,b,c,d){d.addChildElement(b)}}}]),angular.module("spot.im.utils").directive("selectOnClick",function(){return{restrict:"A",link:function(a,b){b.on("click",function(){this.select()})}}}),function(a){function b(b,c){function d(){return m.update(),f(),m}function e(){var a=v.toLowerCase();s.obj.css(u,w/q.ratio),p.obj.css(u,-w),y.start=s.obj.offset()[u],q.obj.css(a,r[c.axis]),r.obj.css(a,r[c.axis]),s.obj.css(a,s[c.axis])}function f(){z?o.obj[0].ontouchstart=function(a){1===a.touches.length&&(h(a.touches[0]),a.stopPropagation())}:(s.obj.bind("mousedown",h),r.obj.bind("mouseup",k)),c.scroll&&window.addEventListener?(n[0].addEventListener("DOMMouseScroll",j,!1),n[0].addEventListener("mousewheel",j,!1),n[0].addEventListener("MozMousePixelScroll",A,!1)):c.scroll&&(n[0].onmousewheel=j),c.windowResize&&window.addEventListener&&window.addEventListener("resize",m.update,!1),c.observeChange&&n.on("transitionend",function(){m.update()})}function g(){z?o.obj[0].ontouchstart=null:(s.obj.unbind("mousedown",h),r.obj.unbind("mouseup",k)),c.scroll&&window.addEventListener?(n[0].removeEventListener("DOMMouseScroll",j,!1),n[0].removeEventListener("mousewheel",j,!1),n[0].removeEventListener("MozMousePixelScroll",A,!1)):c.scroll&&(n[0].onmousewheel=null),c.windowResize&&window.addEventListener&&window.removeEventListener("resize",m.update,!1),c.observeChange&&n.off("transitionend")}function h(b){a("body").addClass("no-select");var c=parseInt(s.obj.css(u),10);y.start=t?b.pageX:b.pageY,x.start="auto"==c?0:c,z?(document.ontouchmove=function(a){a.preventDefault(),k(a.touches[0])},document.ontouchend=l):(a(document).bind("mousemove",k),a(document).bind("mouseup",l),s.obj.bind("mouseup",l))}function i(a){a===p[c.axis]-o[c.axis]?m.scrolledBottomTriggered||(b.trigger("scrolled-bottom"),m.scrolledBottomTriggered=!0):m.scrolledBottomTriggered=!1,0===a?m.scrolledTopTriggered||(b.trigger("scrolled-top"),m.scrolledTopTriggered=!0):m.scrolledTopTriggered=!1}function j(b){if(p.ratio<1){var d=b||window.event,e=d.wheelDelta?d.wheelDelta/120:-d.detail/3;w-=e*c.wheel,w=Math.min(p[c.axis]-o[c.axis],Math.max(0,w)),i(w),s.obj.css(u,w/q.ratio),p.obj.css(u,-w),(c.lockscroll||w!==p[c.axis]-o[c.axis]&&0!==w)&&(d=a.event.fix(d),d.preventDefault())}}function k(a){p.ratio<1&&(x.now=c.invertscroll&&z?Math.min(r[c.axis]-s[c.axis],Math.max(0,x.start+(y.start-(t?a.pageX:a.pageY)))):Math.min(r[c.axis]-s[c.axis],Math.max(0,x.start+((t?a.pageX:a.pageY)-y.start))),w=x.now*q.ratio,i(w),p.obj.css(u,-w),s.obj.css(u,x.now))}function l(){a("body").removeClass("no-select"),a(document).unbind("mousemove",k),a(document).unbind("mouseup",l),s.obj.unbind("mouseup",l),document.ontouchmove=document.ontouchend=null}var m=this,n=b,o={obj:a(".viewport",b)},p={obj:a(".overview",b)},q={obj:a(".scrollbar",b)},r={obj:a(".track",q.obj)},s={obj:a(".thumb",q.obj)},t="x"===c.axis,u=t?"left":"top",v=t?"Width":"Height",w=0,x={start:0,now:0},y={},z="ontouchstart"in document.documentElement,A=function(a){a.preventDefault()};return this.destroy=function(){g()},this.update=function(a){if(!a)if("y"===c.axis&&c.stickToBottom){var b=p.obj.position().top,d=o.y;a=o.y-p.y>b-d?"bottom":"relative"}else a="relative";o[c.axis]=o.obj[0]["offset"+v],p[c.axis]=p.obj[0]["scroll"+v],p.ratio=o[c.axis]/p[c.axis],q.obj.toggleClass("disable",p.ratio>=1),r[c.axis]="auto"===c.size?o[c.axis]:c.size,s[c.axis]=Math.min(r[c.axis],Math.max(0,"auto"===c.sizethumb?r[c.axis]*p.ratio:c.sizethumb)),q.ratio="auto"===c.sizethumb?p[c.axis]/r[c.axis]:(p[c.axis]-o[c.axis])/(r[c.axis]-s[c.axis]),w="relative"===a&&p.ratio<=1?Math.min(p[c.axis]-o[c.axis],Math.max(0,w)):0,w="bottom"===a&&p.ratio<=1?p[c.axis]-o[c.axis]:isNaN(parseInt(a,10))?w:parseInt(a,10),e()},d()}a.tiny=a.tiny||{},a.tiny.scrollbar={options:{axis:"y",wheel:40,scroll:!0,lockscroll:!0,size:"auto",sizethumb:"auto",invertscroll:!1,windowResize:!0,observeChange:!0,stickToBottom:!1}},a.fn.tinyscrollbar=function(c){var d=a.extend({},a.tiny.scrollbar.options,c);return this.each(function(){a(this).data("tsb",new b(a(this),d))}),this},a.fn.tinyscrollbar_update=function(b){var c=a(this).data("tsb");return c?c.update(b):null},a.fn.tinyscrollbar_destroy=function(){var b=a(this).data("tsb");return b?b.destroy():null}}(jQuery),angular.module("spot.im.utils").directive("tinyscrollbar",["jquery","$window",function(){return function(a,b,c){function d(){b.tinyscrollbar_update()}var e=c.tinyscrollbar?a.$eval(c.tinyscrollbar):{},f=!1;if(e.skipCondition&&(f="function"==typeof e.skipCondition?!!e.skipCondition():!!e.skipCondition),!f){b.addClass("tinyscrollbar"),b.tinyscrollbar(e);var g=b.find(".overview").children(":first-child");b.bind("$destroy",function(){b.tinyscrollbar_destroy()}),a.$watch(function(){return b.height()},d),a.$watch(function(){return g.height()},d)}}}]),angular.module("spot.im.utils").directive("stickyHeaderClass",[function(){return{controller:function(){this.setStaticHeader=function(a){this.staticHeader=a}},link:function(a,b,c,d){function e(){if(d.staticHeader){{var a=d.staticHeader.position();d.staticHeader.height()}!g&&a.top<0?(g=!0,b.addClass(f)):g&&a.top>=0&&(g=!1,b.removeClass(f))}}var f=c.stickyHeaderClass,g=!1;b.on("scroll",e),b.on("$destroy",function(){b.off("scroll",e)})}}}]).directive("stickyHeaderStatic",[function(){return{require:"^stickyHeaderClass",link:function(a,b,c,d){d.setStaticHeader(b)}}}]),angular.module("spot.im.utils").directive("utmHref",[function(){return{restrict:"A",link:function(a,b,c){function d(){if(c.href&&0===c.href.indexOf("http")){var a=c.href.indexOf("?")>-1?"&":"?";b.attr("href",c.href+a+"utm_source=spot.im&utm_content=embed")}}c.$observe("href",d)}}}]),angular.module("spot.im.utils").filter("prepend",function(){return function(a,b){return b+a}}).filter("prettyDate",["utils",function(a){return function(b){return a.formatTime(b)}}]).filter("fromUnixTimestamp",[function(){return function(a){return 1e3*a}}]).filter("append",function(){return function(a,b){return a+b}}).filter("first",["underscore",function(a){return function(b,c){return a.first(b,c)}}]).filter("commaSeparate",function(){return function(a){for(;/(\d+)(\d{3})/.test(a.toString());)a=a.toString().replace(/(\d+)(\d{3})/,"$1,$2");return a}}).filter("truncate",function(){return function(a,b,c){if(!a||a.length<=b)return a;c=angular.extend({breakWords:!0,wordDelimiter:" "},c);var d=b;if(!c.breakWords){var e=a.substr(0,b).lastIndexOf(c.wordDelimiter);e>=0&&(d=e)}return a.substr(0,d)+"..."}}).filter("escape",["utils",function(a){return function(b){return a.escapeHtml(b)}}]).filter("emphasis",[function(){return function(a){return a.replace(/{{/g,"<em>").replace(/}}/g,"</em>")}}]).filter("thousands",["$window",function(a){return function(b){var c=a.parseInt(b,10);return c>999?Math.floor(c/1e3)+"K":b}}]).filter("domain",[function(){return function(a){return a?a.toLowerCase().replace(/(http[s]?:\/\/)?(www\.)?/i,"").replace(/(\/)?$/,""):""}}]).filter("reverse",function(){return function(a){return a.slice().reverse()}}).filter("tagWrap",[function(){return function(a,b){return a?(b=b||"span",a.replace(/(\S+)/g,"<"+b+">$1</"+b+">").replace(/\s/g,"")):""}}]).filter("previewIFrame",["embedlyService","$sce",function(a,b){return function(c,d){var e=$(c).filter("iframe");if(0==e.length)return"";var f=e.find("embed");if(d.autoPlay){e.attr("src",a.appendAutoPlayToUrl(e.attr("src")));var g=e.find('param[name="autoplay"]');g&&g.attr("value",!0);var h=e.find('param[name="autostart"]');h&&h.attr("value",!0)}if(d.scaleHeight){var i=d.width/e.attr("width")*e.attr("height");e.attr("height",i),f.length&&f.attr("height",i),delete d.scaleHeight}for(var j in d)e.attr(j,d[j]),f.length&&f.attr(j,d[j]);return b.trustAsHtml(e[0].outerHTML)}}]),angular.module("spot.im.utils").filter("linkey",[function(){var a=/(((ftp|https?):\/\/:?)|(mailto:?)|(www\.:?))[A-Za-z0-9._%+-@]+\S*[^\s.;(){}<>"]/,b=/^mailto:/,c=/^www/;return function(d,e){function f(a){return a||""}function g(a,b){return'<a utm-href ng-href="{{url}}" {{anchorClass}} target="_blank">{{text}}</a>'.replace("{{anchorClass}}",e?'class="'+e+'"':"").replace("{{url}}",a).replace("{{text}}",f(b))}var h=d,i=[],j=[],k="",l="",m=0;if(!d)return d;for(;i=h.match(a);)k=i[0].replace(c,"http://www"),l=i[0].replace(b,""),m=i.index,j.push(f(h.substr(0,m))),j.push(g(k,l)),h=h.substring(m+i[0].length);return j.push(f(h)),j.join("")}}]),angular.module("spot.im.utils").factory("browser",["$window",function(a){function b(a){a=a.toLowerCase();var b=/(opr)[\/]([\w.]+)/.exec(a)||/(chrome)[ \/]([\w.]+)/.exec(a)||/(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[],c=/(ipad)/.exec(a)||/(iphone)/.exec(a)||/(android)/.exec(a)||/(windows phone)/.exec(a)||/(win)/.exec(a)||/(mac)/.exec(a)||/(linux)/.exec(a)||/(cros)/i.exec(a)||[];return{browser:b[3]||b[1]||"",version:b[2]||"0",platform:c[0]||""}}var c,d;if(c=b(a.navigator.userAgent),d={},c.browser&&(d[c.browser]=!0,d.version=c.version,d.versionNumber=parseInt(c.version)),c.platform&&(d[c.platform]=!0),(d.android||d.ipad||d.iphone||d["windows phone"])&&(d.mobile=!0),(d.cros||d.mac||d.linux||d.win)&&(d.desktop=!0),(d.chrome||d.opr||d.safari)&&(d.webkit=!0),d.rv){var e="msie";c.browser=e,d[e]=!0}if(d.opr){var f="opera";c.browser=f,d[f]=!0}if(d.safari&&d.android){var g="android";c.browser=g,d[g]=!0}return d.name=c.browser,d.platform=c.platform,d}]),angular.module("spot.im.utils").factory("cookiesManager",["$window","Logger","jquery",function(a,b,c){var d=b.getInstance("cookiesManager"),e=a.cookieBaseDomain;return{getItem:function(a){var b=c.cookie(a);return d.debug("getItem","key: {0}, valueLength: {1}",[a,(b||"").length]),b},setItem:function(a,b,f){return d.debug("setItem","key: {0}, valueLength: {1}",[a,b.length]),f=f||7300,c.cookie(a,b,{path:"/",domain:e,expires:f}),!0},removeItem:function(a,b){return d.debug("removeItem","key: {0}",[a]),c.removeCookie(a,{path:"/",domain:b||e})}}}]),angular.module("spot.im.utils").factory("deviceDetect",[function(){return{isAndroid:function(){return navigator.userAgent.match(/Android/i)},isBlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},isIOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},isOperaMini:function(){return navigator.userAgent.match(/Opera Mini/i)},isWindowsMobile:function(){return navigator.userAgent.match(/IEMobile/i)},isMobile:function(){return this.isAndroid()||this.isBlackBerry()||this.isIOS()||this.isOperaMini()||this.isWindowsMobile()},isWebkit:function(){return"WebkitAppearance"in document.documentElement.style}}}]),angular.module("spot.im.utils").factory("direction",[function(){function a(a){var b="A-Za-z--------",c="---",d=new RegExp("^[^"+b+"]*["+c+"]");return d.test(a)}function b(b){for(var c=0,d=0;d<b.length;d++)if(" "!==b[d]){var e=a(b[d]);e?c++:c--}return c>0}return{isTextRTL:b}}]),angular.module("spot.im.utils").factory("embedlyService",["underscore","utils","$rootScope","$q","$window","EmbedlyResource",function(a,b,c,d,e,f){var g={pending:{},embedsCache:{},regex:new RegExp(/((https?\:\/\/)|(www\.))(\S+)(\w{2,4})(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi),isYouTube:function(a){return a&&a.indexOf("youtube.com")>-1},isVimeo:function(a){return a&&a.indexOf("vimeo.com")>-1},appendAutoPlayToUrl:function(a){var c=a;return(this.isYouTube(c)||this.isVimeo(c))&&(c=b.addParamToUrl(c,"autoplay","1")),c},resolveUrl:function(a){var b=null;if(this.pending[a])b=this.pending[a];else if(this.embedsCache[a])b=d.when(this.embedsCache[a]);else{var e=d.defer();b=e.promise,this.pending[a]=b;var g=this,h=a;"http://"!==a.slice(0,"http://".length)&&"https://"!==a.slice(0,"https://".length)&&(h="http://"+h);{"https:"===window.location.protocol?{query:{secure:!0,frame:!0}}:{}}f.get({url:h},function(b){c.$evalAsync(function(){if(delete g.pending[a],"error"==b.type||b.invalid)e.resolve(null);else{var c={type:"embed",subtype:b.type,title:b.title,description:b.description,thumbnail_url:b.thumbnail_url,url:b.url||a,html:b.html,provider_name:b.provider_name,provider_url:b.provider_url,thumbnail_width:b.thumbnail_width,thumbnail_height:b.thumbnail_height,width:b.width,height:b.height,urlQuote:a};"photo"==b.type&&(c.thumbnail_url=b.url),g.embedsCache[a]=c,e.resolve(c)}})})}return b},resolve:function(a){function b(a,b){return g.resolveUrl(a).then(function(c){if(null!==c){c.range=[b,a.length];for(var d=!1,e=0;e<f.length&&!d;e++)f[e].range[0]>b&&(f.splice(Math.min(e-1,0),0,c),d=!0);d||f.push(c)}})}for(var c,e=[],f=[],g=this;c=this.regex.exec(a);){var h=c[0],i=c.index,j=b(h,i);e.push(j)}var k=d.defer();return d.all(e).then(function(){k.resolve(f)},k.reject),k.promise}};return g}]),angular.module("spot.im.utils").factory("fileReader",["$q","$rootScope",function(a,b){var c=function(a,c){return function(){b.$evalAsync(function(){c.resolve(a.result)})}},d=function(a,c){return function(){b.$evalAsync(function(){c.reject(a.result)})}},e=function(){return function(a){b.$broadcast("fileProgress",{total:a.total,loaded:a.loaded})}},f=function(a){var b=new FileReader;return b.onload=c(b,a),b.onerror=d(b,a),b.onprogress=e(b),b},g=function(b){var c=a.defer(),d=f(c);return d.readAsDataURL(b),c.promise};return{readAsDataUrl:g}}]),angular.module("spot.im.utils").factory("historyTracker",["$state","$stateParams","$rootScope",function(a,b,c){function d(a,b){return o?void(o=!1):(0===m.length?n=0:n!==m.length-1?(m.length=n+1,n++):n++,void m.push({name:a,params:b}))}function e(){d(a.$current.name,b)}function f(){return n>0&&m.length>1}function g(){return n<m.length-1&&m.length>1}function h(){if(f()){n--;var b=m[n];o=!0,a.go(b.name,b.params)}}function i(){if(g()){n++;var b=m[n];o=!0,a.go(b.name,b.params)}}function j(){for(var a="",b=0;b<m.length;b++)b>0&&(a+="->"),b==n&&(a+="["),a+=m[b].name,b==n&&(a+="]");return a}function k(a,b,c){var d=null,e=null;for(e=0;e<m.length;e++)if(m[e].name===a)if(d=m[e].params,d&&b)for(var f in b)b.hasOwnProperty(f)&&b[f]===d[f]&&c[params]!==d[f]&&(d[f]=c[f]);else m[e].params=c||{}}function l(a){c.$on("$stateChangeSuccess",function(b,c,e){a&&-1!==a.indexOf(c.name)||d(c.name,e)})}var m=[],n=null,o=!1;return window.historyTracker={canForward:g,canBack:f,back:h,forward:i,getSnapshot:j,pushState:d,pushCurrentState:e,replaceStateParams:k,start:l}}]),angular.module("spot.im.utils").factory("isoCountryCodes",["underscore","$q","CountryResource",function(a,b,c){function d(){return c.get().$promise.then(function(b){var c=a.findWhere(e,{id:b&&b.country_code});g.currentCountry=c||g.defaultCountry}).catch(function(){return!0})}var e=[{id:"AF",name:"Afghanistan",code:"93"},{id:"AL",name:"Albania",code:"355"},{id:"DZ",name:"Algeria",code:"213"},{id:"AS",name:"American Samoa",code:"1 684"},{id:"AD",name:"Andorra",code:"376"},{id:"AO",name:"Angola",code:"244"},{id:"AI",name:"Anguilla",code:"1 264"},{id:"AQ",name:"Antarctica",code:"672"},{id:"AG",name:"Antigua and Barbuda",code:"1 268"},{id:"AR",name:"Argentina",code:"54"},{id:"AM",name:"Armenia",code:"374"},{id:"AW",name:"Aruba",code:"297"},{id:"AU",name:"Australia",code:"61"},{id:"AT",name:"Austria",code:"43"},{id:"AZ",name:"Azerbaijan",code:"994"},{id:"BS",name:"Bahamas",code:"1 242"},{id:"BH",name:"Bahrain",code:"973"},{id:"BD",name:"Bangladesh",code:"880"},{id:"BB",name:"Barbados",code:"1 246"},{id:"BY",name:"Belarus",code:"375"},{id:"BE",name:"Belgium",code:"32"},{id:"BZ",name:"Belize",code:"501"},{id:"BJ",name:"Benin",code:"229"},{id:"BM",name:"Bermuda",code:"1 441"},{id:"BT",name:"Bhutan",code:"975"},{id:"BO",name:"Bolivia",code:"591"},{id:"BA",name:"Bosnia and Herzegovina",code:"387"},{id:"BW",name:"Botswana",code:"267"},{id:"BR",name:"Brazil",code:"55"},{id:"IO",name:"British Indian Ocean Territory",code:""},{id:"VG",name:"British Virgin Islands",code:"1 284"},{id:"BN",name:"Brunei",code:"673"},{id:"BG",name:"Bulgaria",code:"359"},{id:"BF",name:"Burkina Faso",code:"226"},{id:"MM",name:"Burma (Myanmar)",code:"95"},{id:"BI",name:"Burundi",code:"257"},{id:"KH",name:"Cambodia",code:"855"},{id:"CM",name:"Cameroon",code:"237"},{id:"CA",name:"Canada",code:"1"},{id:"CV",name:"Cape Verde",code:"238"},{id:"KY",name:"Cayman Islands",code:"1 345"},{id:"CF",name:"Central African Republic",code:"236"},{id:"TD",name:"Chad",code:"235"},{id:"CL",name:"Chile",code:"56"},{id:"CN",name:"China",code:"86"},{id:"CX",name:"Christmas Island",code:"61"},{id:"CC",name:"Cocos (Keeling) Islands",code:"61"},{id:"CO",name:"Colombia",code:"57"},{id:"KM",name:"Comoros",code:"269"},{id:"CK",name:"Cook Islands",code:"682"},{id:"CR",name:"Costa Rica",code:"506"},{id:"HR",name:"Croatia",code:"385"},{id:"CU",name:"Cuba",code:"53"},{id:"CY",name:"Cyprus",code:"357"},{id:"CZ",name:"Czech Republic",code:"420"},{id:"CD",name:"Democratic Republic of the Congo",code:"243"},{id:"DK",name:"Denmark",code:"45"},{id:"DJ",name:"Djibouti",code:"253"},{id:"DM",name:"Dominica",code:"1 767"},{id:"DO",name:"Dominican Republic",code:"1 809"},{id:"EC",name:"Ecuador",code:"593"},{id:"EG",name:"Egypt",code:"20"},{id:"SV",name:"El Salvador",code:"503"},{id:"GQ",name:"Equatorial Guinea",code:"240"},{id:"ER",name:"Eritrea",code:"291"},{id:"EE",name:"Estonia",code:"372"},{id:"ET",name:"Ethiopia",code:"251"},{id:"FK",name:"Falkland Islands",code:"500"},{id:"FO",name:"Faroe Islands",code:"298"},{id:"FJ",name:"Fiji",code:"679"},{id:"FI",name:"Finland",code:"358"},{id:"FR",name:"France",code:"33"},{id:"PF",name:"French Polynesia",code:"689"},{id:"GA",name:"Gabon",code:"241"},{id:"GM",name:"Gambia",code:"220"},{id:"PS",name:"Gaza Strip",code:"970"},{id:"GE",name:"Georgia",code:"995"},{id:"DE",name:"Germany",code:"49"},{id:"GH",name:"Ghana",code:"233"},{id:"GI",name:"Gibraltar",code:"350"},{id:"GR",name:"Greece",code:"30"},{id:"GL",name:"Greenland",code:"299"},{id:"GD",name:"Grenada",code:"1 473"},{id:"GU",name:"Guam",code:"1 671"},{id:"GT",name:"Guatemala",code:"502"},{id:"GN",name:"Guinea",code:"224"},{id:"GW",name:"Guinea-Bissau",code:"245"},{id:"GY",name:"Guyana",code:"592"},{id:"HT",name:"Haiti",code:"509"},{id:"VA",name:"Holy See (Vatican City)",code:"39"},{id:"HN",name:"Honduras",code:"504"},{id:"HK",name:"Hong Kong",code:"852"},{id:"HU",name:"Hungary",code:"36"},{id:"IS",name:"Iceland",code:"354"},{id:"IN",name:"India",code:"91"},{id:"ID",name:"Indonesia",code:"62"},{id:"IR",name:"Iran",code:"98"},{id:"IQ",name:"Iraq",code:"964"},{id:"IE",name:"Ireland",code:"353"},{id:"IM",name:"Isle of Man",code:"44"},{id:"IL",name:"Israel",code:"972"},{id:"IT",name:"Italy",code:"39"},{id:"CI",name:"Ivory Coast",code:"225"},{id:"JM",name:"Jamaica",code:"1 876"},{id:"JP",name:"Japan",code:"81"},{id:"JE",name:"Jersey",code:""},{id:"JO",name:"Jordan",code:"962"},{id:"KZ",name:"Kazakhstan",code:"7"},{id:"KE",name:"Kenya",code:"254"},{id:"KI",name:"Kiribati",code:"686"},{id:"KS",name:"Kosovo",code:"381"},{id:"KW",name:"Kuwait",code:"965"},{id:"KG",name:"Kyrgyzstan",code:"996"},{id:"LA",name:"Laos",code:"856"},{id:"LV",name:"Latvia",code:"371"},{id:"LB",name:"Lebanon",code:"961"},{id:"LS",name:"Lesotho",code:"266"},{id:"LR",name:"Liberia",code:"231"},{id:"LY",name:"Libya",code:"218"},{id:"LI",name:"Liechtenstein",code:"423"},{id:"LT",name:"Lithuania",code:"370"},{id:"LU",name:"Luxembourg",code:"352"},{id:"MO",name:"Macau",code:"853"},{id:"MK",name:"Macedonia",code:"389"},{id:"MG",name:"Madagascar",code:"261"},{id:"MW",name:"Malawi",code:"265"},{id:"MY",name:"Malaysia",code:"60"},{id:"MV",name:"Maldives",code:"960"},{id:"ML",name:"Mali",code:"223"},{id:"MT",name:"Malta",code:"356"},{id:"MH",name:"Marshall Islands",code:"692"},{id:"MR",name:"Mauritania",code:"222"},{id:"MU",name:"Mauritius",code:"230"},{id:"YT",name:"Mayotte",code:"262"},{id:"MX",name:"Mexico",code:"52"},{id:"FM",name:"Micronesia",code:"691"},{id:"MD",name:"Moldova",code:"373"},{id:"MC",name:"Monaco",code:"377"},{id:"MN",name:"Mongolia",code:"976"},{id:"ME",name:"Montenegro",code:"382"},{id:"MS",name:"Montserrat",code:"1 664"},{id:"MA",name:"Morocco",code:"212"},{id:"MZ",name:"Mozambique",code:"258"},{id:"NA",name:"Namibia",code:"264"},{id:"NR",name:"Nauru",code:"674"},{id:"NP",name:"Nepal",code:"977"},{id:"NL",name:"Netherlands",code:"31"},{id:"AN",name:"Netherlands Antilles",code:"599"},{id:"NC",name:"New Caledonia",code:"687"},{id:"NZ",name:"New Zealand",code:"64"},{id:"NI",name:"Nicaragua",code:"505"},{id:"NE",name:"Niger",code:"227"},{id:"NG",name:"Nigeria",code:"234"},{id:"NU",name:"Niue",code:"683"},{id:"NFK",name:"Norfolk Island",code:"672"},{id:"KP",name:"North Korea",code:"850"},{id:"MP",name:"Northern Mariana Islands",code:"1 670"},{id:"NO",name:"Norway",code:"47"},{id:"OM",name:"Oman",code:"968"},{id:"PK",name:"Pakistan",code:"92"},{id:"PW",name:"Palau",code:"680"},{id:"PA",name:"Panama",code:"507"},{id:"PG",name:"Papua New Guinea",code:"675"},{id:"PY",name:"Paraguay",code:"595"},{id:"PE",name:"Peru",code:"51"},{id:"PH",name:"Philippines",code:"63"},{id:"PN",name:"Pitcairn Islands",code:"870"},{id:"PL",name:"Poland",code:"48"},{id:"PT",name:"Portugal",code:"351"},{id:"PR",name:"Puerto Rico",code:"1"},{id:"QA",name:"Qatar",code:"974"},{id:"CG",name:"Republic of the Congo",code:"242"},{id:"RO",name:"Romania",code:"40"},{id:"RU",name:"Russia",code:"7"},{id:"RW",name:"Rwanda",code:"250"},{id:"BL",name:"Saint Barthelemy",code:"590"},{id:"SH",name:"Saint Helena",code:"290"},{id:"KN",name:"Saint Kitts and Nevis",code:"1 869"},{id:"LC",name:"Saint Lucia",code:"1 758"},{id:"MF",name:"Saint Martin",code:"1 599"},{id:"PM",name:"Saint Pierre and Miquelon",code:"508"},{id:"VC",name:"Saint Vincent and the Grenadines",code:"1 784"},{id:"WS",name:"Samoa",code:"685"},{id:"SM",name:"San Marino",code:"378"},{id:"ST",name:"Sao Tome and Principe",code:"239"},{id:"SA",name:"Saudi Arabia",code:"966"},{id:"SN",name:"Senegal",code:"221"},{id:"RS",name:"Serbia",code:"381"},{id:"SC",name:"Seychelles",code:"248"},{id:"SL",name:"Sierra Leone",code:"232"},{id:"SG",name:"Singapore",code:"65"},{id:"SK",name:"Slovakia",code:"421"},{id:"SI",name:"Slovenia",code:"386"},{id:"SB",name:"Solomon Islands",code:"677"},{id:"SO",name:"Somalia",code:"252"},{id:"ZA",name:"South Africa",code:"27"},{id:"KR",name:"South Korea",code:"82"},{id:"ES",name:"Spain",code:"34"},{id:"LK",name:"Sri Lanka",code:"94"},{id:"SD",name:"Sudan",code:"249"},{id:"SR",name:"Suriname",code:"597"},{id:"SJ",name:"Svalbard",code:""},{id:"SZ",name:"Swaziland",code:"268"},{id:"SE",name:"Sweden",code:"46"},{id:"CH",name:"Switzerland",code:"41"},{id:"SY",name:"Syria",code:"963"},{id:"TW",name:"Taiwan",code:"886"},{id:"TJ",name:"Tajikistan",code:"992"},{id:"TZ",name:"Tanzania",code:"255"},{id:"TH",name:"Thailand",code:"66"},{id:"TL",name:"Timor-Leste",code:"670"},{id:"TG",name:"Togo",code:"228"},{id:"TK",name:"Tokelau",code:"690"},{id:"TO",name:"Tonga",code:"676"},{id:"TT",name:"Trinidad and Tobago",code:"1 868"},{id:"TN",name:"Tunisia",code:"216"},{id:"TR",name:"Turkey",code:"90"},{id:"TM",name:"Turkmenistan",code:"993"},{id:"TC",name:"Turks and Caicos Islands",code:"1 649"},{id:"TV",name:"Tuvalu",code:"688"},{id:"UG",name:"Uganda",code:"256"},{id:"UA",name:"Ukraine",code:"380"},{id:"AE",name:"United Arab Emirates",code:"971"},{id:"GB",name:"United Kingdom",code:"44"},{id:"US",name:"United States",code:"1"},{id:"UY",name:"Uruguay",code:"598"},{id:"VI",name:"US Virgin Islands",code:"1 340"},{id:"UZ",name:"Uzbekistan",code:"998"},{id:"VU",name:"Vanuatu",code:"678"},{id:"VE",name:"Venezuela",code:"58"},{id:"VN",name:"Vietnam",code:"84"},{id:"WF",name:"Wallis and Futuna",code:"681"},{id:"PS",name:"West Bank",code:"970"},{id:"EH",name:"Western Sahara",code:""},{id:"YE",name:"Yemen",code:"967"},{id:"ZM",name:"Zambia",code:"260"},{id:"ZW",name:"Zimbabwe",code:"263"}],f=a.findWhere(e,{id:"US"}),g={loadPromise:d(),list:e,defaultCountry:f,currentCountry:f,getById:function(b){var c=null;return b&&(c=a.findWhere(e,{id:b})),c}};return g}]),angular.module("spot.im.utils").factory("isoLanguageCodes",["underscore",function(a){function b(){var b=window.navigator.userLanguage||window.navigator.language,f=b.split("-")[0];e=a.findWhere(c,{id:f.split("-")[0]})||d}var c=[{id:"ab",name:"Abkhaz"},{id:"aa",name:"Afar"},{id:"af",name:"Afrikaans"},{id:"ak",name:"Akan"},{id:"sq",name:"Albanian"},{id:"am",name:"Amharic"},{id:"ar",name:"Arabic"},{id:"an",name:"Aragonese"},{id:"hy",name:"Armenian"},{id:"as",name:"Assamese"},{id:"av",name:"Avaric"},{id:"ae",name:"Avestan"},{id:"ay",name:"Aymara"},{id:"az",name:"Azerbaijani"},{id:"bm",name:"Bambara"},{id:"ba",name:"Bashkir"},{id:"eu",name:"Basque"},{id:"be",name:"Belarusian"},{id:"bn",name:"Bengali, Bangla"},{id:"bh",name:"Bihari"},{id:"bi",name:"Bislama"},{id:"bs",name:"Bosnian"},{id:"br",name:"Breton"},{id:"bg",name:"Bulgarian"},{id:"my",name:"Burmese"},{id:"ca",name:"Catalan, Valencian"},{id:"ch",name:"Chamorro"},{id:"ce",name:"Chechen"},{id:"ny",name:"Chichewa, Chewa, Nyanja"},{id:"zh",name:"Chinese"},{id:"cv",name:"Chuvash"},{id:"kw",name:"Cornish"},{id:"co",name:"Corsican"},{id:"cr",name:"Cree"},{id:"hr",name:"Croatian"},{id:"cs",name:"Czech"},{id:"da",name:"Danish"},{id:"dv",name:"Divehi, Dhivehi, Maldivian"},{id:"nl",name:"Dutch"},{id:"dz",name:"Dzongkha"},{id:"en",name:"English"},{id:"eo",name:"Esperanto"},{id:"et",name:"Estonian"},{id:"ee",name:"Ewe"},{id:"fo",name:"Faroese"},{id:"fj",name:"Fijian"},{id:"fi",name:"Finnish"},{id:"fr",name:"French"},{id:"ff",name:"Fula, Fulah, Pulaar, Pular"},{id:"gl",name:"Galician"},{id:"ka",name:"Georgian"},{id:"de",name:"German"},{id:"el",name:"Greek"},{id:"gn",name:"Guaran"},{id:"gu",name:"Gujarati"},{id:"ht",name:"Haitian, Haitian Creole"},{id:"ha",name:"Hausa"},{id:"he",name:"Hebrew"},{id:"hz",name:"Herero"},{id:"hi",name:"Hindi"},{id:"ho",name:"Hiri Motu"},{id:"hu",name:"Hungarian"},{id:"ia",name:"Interlingua"},{id:"id",name:"Indonesian"},{id:"ie",name:"Interlingue"},{id:"ga",name:"Irish"},{id:"ig",name:"Igbo"},{id:"ik",name:"Inupiaq"},{id:"io",name:"Ido"},{id:"is",name:"Icelandic"},{id:"it",name:"Italian"},{id:"iu",name:"Inuktitut"},{id:"ja",name:"Japanese"},{id:"jv",name:"Javanese"},{id:"kl",name:"Kalaallisut, Greenlandic"},{id:"kn",name:"Kannada"},{id:"kr",name:"Kanuri"},{id:"ks",name:"Kashmiri"},{id:"kk",name:"Kazakh"},{id:"km",name:"Khmer"},{id:"ki",name:"Kikuyu, Gikuyu"},{id:"rw",name:"Kinyarwanda"},{id:"ky",name:"Kyrgyz"},{id:"kv",name:"Komi"},{id:"kg",name:"Kongo"},{id:"ko",name:"Korean"},{id:"ku",name:"Kurdish"},{id:"kj",name:"Kwanyama, Kuanyama"},{id:"la",name:"Latin"},{id:"lb",name:"Luxembourgish, Letzeburgesch"},{id:"lg",name:"Ganda"},{id:"li",name:"Limburgish, Limburgan, Limburger"},{id:"ln",name:"Lingala"},{id:"lo",name:"Lao"},{id:"lt",name:"Lithuanian"},{id:"lu",name:"Luba-Katanga"},{id:"lv",name:"Latvian"},{id:"gv",name:"Manx"},{id:"mk",name:"Macedonian"},{id:"mg",name:"Malagasy"},{id:"ms",name:"Malay"},{id:"ml",name:"Malayalam"},{id:"mt",name:"Maltese"},{id:"mi",name:"Mori"},{id:"mr",name:"Marathi (Marh)"},{id:"mh",name:"Marshallese"},{id:"mn",name:"Mongolian"},{id:"na",name:"Nauru"},{id:"nv",name:"Navajo, Navaho"},{id:"nd",name:"Northern Ndebele"},{id:"ne",name:"Nepali"},{id:"ng",name:"Ndonga"},{id:"nb",name:"Norwegian Bokml"},{id:"nn",name:"Norwegian Nynorsk"},{id:"no",name:"Norwegian"},{id:"ii",name:"Nuosu"},{id:"nr",name:"Southern Ndebele"},{id:"oc",name:"Occitan"},{id:"oj",name:"Ojibwe, Ojibwa"},{id:"cu",name:"Old Church Slavonic, Church Slavonic, Old Bulgarian"},{id:"om",name:"Oromo"},{id:"or",name:"Oriya"},{id:"os",name:"Ossetian, Ossetic"},{id:"pa",name:"Panjabi, Punjabi"},{id:"pi",name:"Pli"},{id:"fa",name:"Persian (Farsi)"},{id:"pl",name:"Polish"},{id:"ps",name:"Pashto, Pushto"},{id:"pt",name:"Portuguese"},{id:"qu",name:"Quechua"},{id:"rm",name:"Romansh"},{id:"rn",name:"Kirundi"},{id:"ro",name:"Romanian"},{id:"ru",name:"Russian"},{id:"sa",name:"Sanskrit (Saskta)"},{id:"sc",name:"Sardinian"},{id:"sd",name:"Sindhi"},{id:"se",name:"Northern Sami"},{id:"sm",name:"Samoan"},{id:"sg",name:"Sango"},{id:"sr",name:"Serbian"},{id:"gd",name:"Scottish Gaelic, Gaelic"},{id:"sn",name:"Shona"},{id:"si",name:"Sinhala, Sinhalese"},{id:"sk",name:"Slovak"},{id:"sl",name:"Slovene"},{id:"so",name:"Somali"},{id:"st",name:"Southern Sotho"},{id:"es",name:"Spanish, Castilian"},{id:"su",name:"Sundanese"},{id:"sw",name:"Swahili"},{id:"ss",name:"Swati"},{id:"sv",name:"Swedish"},{id:"ta",name:"Tamil"},{id:"te",name:"Telugu"},{id:"tg",name:"Tajik"},{id:"th",name:"Thai"},{id:"ti",name:"Tigrinya"},{id:"bo",name:"Tibetan Standard, Tibetan, Central"},{id:"tk",name:"Turkmen"},{id:"tl",name:"Tagalog"},{id:"tn",name:"Tswana"},{id:"to",name:"Tonga (Tonga Islands)"},{id:"tr",name:"Turkish"},{id:"ts",name:"Tsonga"},{id:"tt",name:"Tatar"},{id:"tw",name:"Twi"},{id:"ty",name:"Tahitian"},{id:"ug",name:"Uyghur, Uighur"},{id:"uk",name:"Ukrainian"},{id:"ur",name:"Urdu"},{id:"uz",name:"Uzbek"},{id:"ve",name:"Venda"},{id:"vi",name:"Vietnamese"},{id:"vo",name:"Volapk"},{id:"wa",name:"Walloon"},{id:"cy",name:"Welsh"},{id:"wo",name:"Wolof"},{id:"fy",name:"Western Frisian"},{id:"xh",name:"Xhosa"},{id:"yi",name:"Yiddish"},{id:"yo",name:"Yoruba"},{id:"za",name:"Zhuang, Chuang"},{id:"zu",name:"Zulu"}],d=a.findWhere(c,{id:"en"}),e=null;return b(),{list:c,defaultLanguage:d,currentLanguage:e,getById:function(b){var d=null;return b&&(d=a.findWhere(c,{id:b})),d}}}]),angular.module("spot.im.utils").factory("underscore",[function(){return window._.mixin({indexOfObj:function(a,b){if(!a||0===a.length)return-1;var c,d=-1;for(c=0;c<a.length&&-1===d;c++)b(a[c],c)&&(d=c);return d},removeObjFromArray:function(a,b){var c=_.indexOfObj(a,b),d=null;return c>=0&&(d=a.splice(c,1)),d},addToSet:function(a,b){return b&&0!=b.length&&a?(_.difference(b,a).forEach(function(b){a.push(b)}),a):a}}),window._}]).factory("jquery",function(){return window.jQuery}).factory("Pusher",function(){return window.Pusher}),angular.module("spot.im.utils").factory("localStorageManager",["$window","Logger",function(a,b){var c=b.getInstance("localStorageManager");return{isSupport:function(){var b="test";try{return a.localStorage.setItem(b,b),a.localStorage.removeItem(b),!0}catch(c){return!1}}(),getItem:function(b){var d=null;return this.isSupport&&(d=a.localStorage.getItem(b)),c.debug("getItem","key: {0}, valueLength: {1}",[b,(d||"").length]),d
},setItem:function(b,d){return c.debug("setItem","key: {0}, valueLength: {1}",[b,d.length]),this.isSupport&&a.localStorage.setItem(b,d),!0},removeItem:function(b){c.debug("removeItem","key: {0}",[b]),this.isSupport&&a.localStorage.removeItem(b)},iterate:function(b){if(this.isSupport)for(var c in a.localStorage)a.localStorage.hasOwnProperty(c)&&b(c)}}}]),angular.module("spot.im.utils").provider("Logger",["$windowProvider",function(a){var b=a.$get(),c=!0;this.enabled=function(a){try{c=!!a||b.localStorage&&"1"===b.localStorage.getItem("forceLogs")}catch(d){c=!!a}},this.$get=["$log","utils",function(a,b){var d=function(a){this.className=a,this.isEnabled=!0};return d.getInstance=function(a){return new d(a)},d.prototype={_getFormattedNow:function(){var a=new Date;return b.supplant("{0}:{1}:{2}:{3}",[a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()])},_logFn:function(d,e){if(c&&this.isEnabled){var f=this._getFormattedNow(),g="",h=[];switch(e.length){case 1:g=b.supplant("{0} - {1}: {2}",[f,this.className,e[0]]);break;case 3:h=e[2],g=b.supplant("{0} - {1}::{2}('{3}')",[f,this.className,e[0],e[1]]);break;case 2:"string"==typeof e[1]?g=b.supplant("{0} - {1}::{2}('{3}')",[f,this.className,e[0],e[1]]):(h=e[1],g=b.supplant("{0} - {1}: {2}",[f,this.className,e[0]]))}a[d].call(null,b.supplant(g,h))}},enabled:function(a){this.isEnabled=a},log:function(){this._logFn("log",arguments)},info:function(){this._logFn("info",arguments)},warn:function(){this._logFn("warn",arguments)},debug:function(){this._logFn("debug",arguments)},error:function(){this._logFn("error",arguments)}},d}]}]),angular.module("spot.im.utils").factory("utils",["$q","$injector","$window",function(a,b,c){var d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"};return{toUnixTimestamp:function(a){return Math.round(a.getTime()/1e3)},currentUnixTimestamp:function(){return this.toUnixTimestamp(new Date)},hasLocalStorage:function(){return!!window.localStorage},supplant:function(a,b){return a.replace(/\{([^{}]*)\}/g,function(a,c){var d=b[c];return"string"==typeof d||"number"==typeof d?d:a})},guid:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+a()+a()+a()+a()+a()+a()},copyAttributes:function(a,b,c){var d=a;for(var e in c){var f,g,h=c[e],i=b,j=!0,k=h.split(".");for(f=0;f<k.length&&j;f++)i.hasOwnProperty(k[f])?i=i[k[f]]:j=!1;if(j){for(g=d,k=e.split("."),f=0;f<k.length-1;f++)g.hasOwnProperty(k[f])||(g[k[f]]={}),g=g[k[f]];g[k[k.length-1]]=i}}},extend:function(a,b,c){b.hasOwnProperty("constructor")&&"function"==typeof b.constructor||(b.constructor=function(){a.apply(this,arguments)});var d=function(){this.constructor.apply(this,arguments),this.initialize&&"function"==typeof this.initialize&&this.initialize.apply(this,arguments)};_.extend(d,a,c);var e=function(){};return e.prototype=a.prototype,d.prototype=new e,b&&_.extend(d.prototype,b),d},deepExtend:function(){for(var a=arguments[0],b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)c[d]&&c[d].constructor&&c[d].constructor===Object?(a[d]=a[d]||{},arguments.callee(a[d],c[d])):a[d]=c[d]}return a},deepSubstract:function(a,b){var c={};for(var d in a)b[d]?b[d].constructor&&b[d].constructor===Object&&(c[d]=arguments.callee(a[d],b[d])):b[d]||(c[d]=a[d]);return c},formatTime:function(a){var b=60,c=60*b,d=24*c,e=7*d,f=365*d,g=this.currentUnixTimestamp()-a,h=null;if(!a||isNaN(g)||0>g)h="";else if(5>g)h="Now";else if(b>g)h=Math.floor(g)+"s";else if(c>g)h=Math.floor(g/b)+"m";else if(d>g)h=Math.floor(g/c)+"h";else if(e>g){var i=Math.floor(g/d);h=2>i?"1d":i+"d"}else if(g>=e&&f>=g){var j=new Date(1e3*a);h=dateFormat(j,"mmm d",!1)}else if(g>f){var k=Math.floor(g/f);h=k+"y"}return h},getConstrainedDimensions:function(a,b,c,d){var e={};if(c>=a&&d>=b)e={width:a,height:b};else{var f=[c/a,d/b];f=Math.min(f[0],f[1]),e={width:a*f,height:b*f}}return e},addParamToUrl:function(a,b,c){var d=-1==a.indexOf("?")?"?":"&";return a+d+b+"="+c},isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},closestIndexOf:function(a,b,c,d){for(var e,f=0,g=a-1,h=null;g>=f;){e=(f+g)/2|0;var i=b(e);c>i?f=e+1:g=e-1}var h=null;f=Math.max(Math.min(f,a-1),0),g=Math.max(Math.min(g,a-1),0);var j=b(f),k=b(g);return h=j===c?f:k===c?g:d?Math.max(f,g):Math.min(f,g)},addCssRule:function(a,b){var c=a+"{ ";for(var d in b)c+=d+": "+b[d]+";";var e=document.getElementsByTagName("head")[0],f=document.createElement("style");f.setAttribute("type","text/css"),f.styleSheet?f.styleSheet.cssText=c:f.appendChild(document.createTextNode(c)),e.appendChild(f)},loadStylesheet:function(a,b){var c=document.createElement("link");c.addEventListener("load",function(){b&&"function"==typeof b&&b()}),c.href=a,c.rel="stylesheet",c.type="text/css",document.getElementsByTagName("head")[0].appendChild(c)},hexToRGB:function(a,b){var c=a.replace(/#/g,"");c=c.match(new RegExp("(.{"+c.length/3+"})","g"));for(var d=0;d<c.length;d++)c[d]=parseInt(1==c[d].length?c[d]+c[d]:c[d],16);return"undefined"!=typeof b&&c.push(b),"rgba("+c.join(",")+")"},preloadImage:function(b){var c=a.defer();return angular.element("<img />").load(c.resolve).error(c.reject).attr("src",b),c.promise},escapeHtml:function(a){return String(a).replace(/[&<>"']/g,function(a){return d[a]})},urlRegex:/((https?\:\/\/)|(www\.))(\S+)(\w{2,4})(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi,isJsonContentType:function(a){return a?"application/json;charset=utf-8"===a.replace(/[\s]/g,"").toLowerCase():!1},toSnakeCase:function(a){return a.replace(/([A-Z])/g,function(a){return"_"+a.toLowerCase()})},calculateAge:function(a){if(!this.isValidDateStr(a))return null;var b=new Date,c=new Date(a),d=b.getFullYear()-c.getFullYear(),e=b.getMonth()-c.getMonth();return(0>e||0===e&&b.getDate()<c.getDate())&&d--,d},isValidDateStr:function(a){var b=Date.parse(a);return c.isNaN(b)===!1},getTimeSince:function(a,b){return a||(a=(new Date).getTime()),b||(b=(new Date).getTime()),a-b},getDateObject:function(a){a||(a="0000-00-00");var b=a.split("-");return{year:b[0],month:b[1],day:b[2]}},dateObjectToISOString:function(a){var b=null;for(b in a)null===a[b]&&(a[b]="year"===b?"0000":"00");return a.year+"-"+a.month+"-"+a.day},getDaysInMonthArray:function(a){var b=null,c=null,d=null,e=[];for(this.isValidDateStr(a)||(a="1970-01-01"),b=this.getDateObject(a),d=new Date(b.year,b.month,0).getDate(),c=1;d>=c;c++)e.push((10>c?"0":"")+c);return e},getMonthsNamesObject:function(a){var b=null,c=null,d={};for(a||(a="en-us"),b=1;12>=b;b++)c=10>b?"0"+b:""+b,d[c]=new Date(c+"/01/0001").toLocaleString(a,{month:"long"});return d},getYearsArraySince:function(a){var b=null,c=(new Date).getFullYear(),d=[];for(b=a;c>=b;b++)d.push(""+b);return d},applyProtocol:function(a){return("https:"==document.location.protocol?"https":"http")+"://"+a.replace(/^((https?):)?\/\//,"")},preloadTemplate:function(c){var d=b.get("$templateCache"),e=b.get("$http"),f=a.defer(),g=d.get(c);return g?f.resolve(g):e.get(c).success(function(a){d.put(c,a),f.resolve(a)},f.reject),f.promise},calculateImageSize:function(a,b,c,d){var e=0,f=a,g=b;return a>=b?a>=c?(e=c/a,f=c,g=Math.floor(b*e),g>=d&&(e=d/g,g=d,f=Math.floor(f*e))):b>d&&(e=d/b,g=d,f=Math.floor(a*e),f>c&&(e=c/f,f=c,g=Math.floor(g*e))):b>a&&(b>d?(e=d/b,g=d,f=Math.floor(a*e),f>c&&(e=c/f,f=c,g=Math.floor(g*e))):a>=c&&(e=c/a,f=c,g=Math.floor(b*e),g>=d&&(e=d/g,g=d,f=Math.floor(f*e)))),{width:f,height:g}}}}]),angular.module("spot.im.utils").directive("tooltipContainer",[function(){return{controller:["$element",function(a){var b=a;this.getContainer=function(){return b}}]}}]),angular.module("spot.im.utils").directive("tooltipSizeBoundary",[function(){return{controller:["$element",function(a){var b=a;this.getBoundaryElement=function(){return b}}]}}]),angular.module("spot.im.utils").directive("tooltip",["jquery","$window","$rootScope","$compile","$templateCache","$http","$parse","utils","tooltipUtils",function(a,b,c,d,e,f,g,h,i){return{scope:!0,require:"^tooltipContainer",link:function(a,c,e,f){function g(){i.positionTemplate(q,o,c)}function j(){r=!0,n.then(function(e){q=d(e)(a).appendTo(o).on("click",k),g(),c.addClass("active"),angular.element(b).on("resize",g),b.setTimeout(function(){o.on("click",k)},0)})}function k(){r&&(q.remove(),q=null,c.removeClass("active"),angular.element(b).off("resize",g),o.off("click",k)),r=!1}function l(){r?k():j()}var m=a.$eval(e.tooltip),n=h.preloadTemplate(m),o=f.getContainer(),p=e.tooltipTriggerdHover||!1,q=null,r=!1;p?c.on("mouseenter",j).on("mouseleave",k):c.on("click",l),a.$on("$destroy",k)}}}]),angular.module("spot.im.utils").factory("tooltipUtils",["utils","$compile","$rootScope",function(){return{positionTemplate:function(a,b,c,d){var e=20,f=5,g=b.offset(),h=a.find(".handle"),i=h.outerHeight(),j=Math.sqrt(2)*i,k=a.outerHeight(),l=a.outerWidth(),m=b.height(),n=b.width(),o=c.offset(),p=o,q=c.outerHeight(),r=c.outerWidth();p={left:p.left-g.left,top:p.top-g.top};var s={left:"initial",right:"initial",top:"initial",bottom:"initial"},t=m-p.top-q,u=p.top;k+=j/2;var v=t>k||k>u;if(d){var w=o.top-d.offset().top,x=d.height()-w-q;v=v&&x>k}v?(s.top=p.top+q,s.paddingTop=j/2,h.css({top:(j-i)/2,bottom:"initial"}).addClass("top").removeClass("bottom")):(s.bottom=m-p.top,s.paddingBottom=j/2,h.css({top:"initial",bottom:(Math.sqrt(2)-1)*i/2}).addClass("bottom").removeClass("top")),s.left=p.left-Math.min(p.left,e),s.left<f&&(s.left=f),s.left+l>n&&(s.left=n-l-f),h.css("left",p.left-s.left+(j-i)/2+(r-j)/2+"px"),a.css(s)}}}]),angular.module("spot.im.utils").factory("tooltipsStack",["$document","$timeout",function(a,b){var c=[],d=function(a){angular.extend(this,{type:"not-set",openFn:angular.noop,closeFn:angular.noop,templateFn:angular.noop,triggerElement:null,allowTop:!1},a)};return d.prototype={open:function(){var a=c.length>0,d=!1,e=this;if(a){var f=c[c.length-1],g=f.templateFn();d=this.allowTop&&this.triggerElement.closest(g).length>0}(!a||d)&&b(function(){c.push(e),e.openFn.apply()})},close:function(){var a=c[c.length-1]===this;a&&(c.splice(c.length-1,1),this.closeFn.apply())},isOpen:function(){return c.indexOf(this)>=0},canClose:function(){var a=c[c.length-1]===this;return a}},a.on("click",function(a){if(c.length>0){var b,d=angular.element(a.target),e=-1;for(b=0;b<c.length;b++){var f=c[b].templateFn();d.closest(f).length>0&&(e=b)}for(b=c.length-1;b>e;b--)c[b].close()}}),{register:function(a){return new d(a)}}}]),angular.module("spot.im.core",["ngResource","ngSanitize","spot.im.utils"]).constant("apiUrl",window.apiUrl).constant("apiCdnUrl",window.apiCdnUrl).config(["$httpProvider",function(a){a.interceptors.push("appStageDefer"),a.interceptors.push("cdnInterceptor"),a.interceptors.push("statusInterceptor"),a.interceptors.push("entitiesInterceptor")}]).run(["$rootScope","$q","SessionUser","localeManager","localeStringGetter","translations","notifications","invitations","pusherService",function(a,b,c,d,e,f,g,h){a.session=c,a.locale=d,a.notifications=g,a.invitations=h,a.$safeApply=function(a,b){var c=this.$root.$$phase;"$apply"==c||"$digest"==c?a&&"function"==typeof a&&a.call(b):a&&"function"==typeof a?this.$apply(a.call(b)):this.$apply()},f.initialize(),e.set(function(a){var c=b.defer();return f.loadPromise.then(function(){var b=f.getString(a);b?c.resolve(b):c.reject()},c.reject),c.promise}),c.subscribeLoginChange(function(){c.isRegistered&&(g.initialize(),h.initialize())})}]).factory("stateProviderBridge",function(){return{mapState:function(a,b){return{stateName:a,stateParams:b}},href:function(){return""},transitionTo:function(){}}}),angular.module("spot.im.core").factory("AlertItem",["$injector","utils","stateProviderBridge","entityStateResolver","CloudinaryService",function(a,b,c,d,e){var f=function(){this.initialize.apply(this,arguments)};return f.prototype={initialize:function(){},parse:function(f,g,h){var i={},j=[];for(var k in g)if(g.hasOwnProperty(k)&&g[k]){var l=g[k];switch(typeof l){case"object":if(l.text){var m=l.text;if("object"==typeof m&&m&&(m=m.key?h.getString(m.key):m),l.id&&l.type){var n="{{"+m+"}}";j.push({id:l.id,type:l.type,concreteType:l.spot_type,text:m,placeholder:n}),i[k]=n}else i[k]=m}break;default:i[k]=l}}var o=h.getTemplate(f,g.count,g.target_user_id,g.domain);if(g.text=b.escapeHtml(o?o(i):""),g.entities=j,g.meta){var p=g.meta;if(p.main){var q=g[p.main];if(q.type&&q.id){var r=d.resolveState(q.type,q.spot_type,{id:q.id});g.main={type:q.type,id:q.id,concreteType:q.spot_type,url:c.href(r.stateName,r.stateParams)}}}if(p.image){g.imageId=p.image_id;var s=g[p.image],t={width:40,height:40,crop:"fill"};if(s.type&&s.id){var u=null;switch(s.type){case"user":u=a.get("User").getUserImageUrl(s.profile_image,t);break;case"spot":u=e.getUrl(p.image_id,{width:40,height:40,crop:"fill"})}u&&(g.imageUrl=u)}}}angular.extend(this,g)}},f}]),angular.module("spot.im.core").factory("AlertsList",["$q","$injector","Events","SessionUser","translations","pusherEvents",function(a,b,c,d,e,f){var g=function(){this.list=[],this.unviewedCount=0;var a=this;f.onAll(function(b,c,d){a._handleAlert(d,!0)})};return g.prototype={parse:function(a,b){this.list=[],this.unviewedCount=b;var c=this;a.forEach(function(a){c._handleAlert(a,!1)})},appendItem:function(a,b){var c=this.list.filter(function(b){return b.id===a.id});if(c.length>0){var d=c.indexOf(c[0]);this.list[d]=a}else this.list.unshift(a);b&&a.unread&&this.unviewedCount++},clearUnviewedCounter:function(){this.unviewedCount=0},_filterMe:function(b){var c=d.getUser(),e=b.notification_filter.me;return a.when(c&&c.id===e)},_filterEveryone:function(){return a.when(!0)},_filterExclude:function(b){var c=d.getUser(),e=b.notification_filter.exclude_user_ids;return a.when(e.indexOf(c.id)<0)},_filterHosts:function(c){var e=d.getUser(),f=c.spot&&c.spot.id,g=a.defer();if(e&&f){var h=b.get("SpotsManager");h.getSpot({id:f}).then(function(a){a.isHost(e.id)?g.resolve(!0):g.reject()},g.reject)}else g.reject();return g.promise},_filterAlert:function(b){var c=a.defer();if(b.notification_filter){var d=[];for(var e in b.notification_filter)switch(e){case"me":d.push(this._filterMe(b));break;case"everyone":d.push(this._filterEveryone(b));break;case"exclude_user_ids":d.push(this._filterExclude(b));break;case"hosts":d.push(this._filterHosts(b))}a.all(d).then(function(a){_.every(a,function(a){return a})&&c.resolve()},c.reject)}else c.resolve();return c.promise},_triggerAlert:function(){},_createItem:function(){return null},_canTranslate:function(){return!1},_handleAlert:function(a,b){if(a&&a.type){var c=this;e.loadPromise.then(function(){c._canTranslate(a,e)&&c._filterAlert(a).then(function(){var d=c._createItem(a,e);c.appendItem(d,b),b&&c._triggerAlert(d)})})}}},angular.extend(g.prototype,c),g}]),angular.module("spot.im.core").factory("BaseModel",["underscore","$q","Events",function(a,b,c){var d=function(a,b){this.constructor(a,b)};return a.extend(d,{extend:function(b,c){var d=this,e=function(){d.apply(this,arguments)};a.extend(e,d,c);var f=function(){};return f.prototype=d.prototype,e.prototype=new f,b&&a.extend(e.prototype,b),e}}),a.extend(d.prototype,c,{fetch:function(c){var d=b.defer(),e=b.defer();return d.promise.then(a.bind(function(a){this.parse(a,c),this.fetchDone(),e.resolve(this)},this),e.reject),this.beforeFetch(),this.retrieve(d),e.promise},constructor:function(b,c){c||(c={}),this.initialize(b,c),c.parse?this.parse(b,c):a.extend(this,b)},set:function(b,c){if(void 0!==b&&null!==b&&0!==b.length){var d,e,f,g=this;if("object"==typeof b){d=b;for(e in d)f=d[e],d.hasOwnProperty(e)&&!a.isEqual(g[e],f)&&(g[e]=f)}else{for(var h=b.split("."),i=this,j=0;j<h.length-1;j++)"object"!=typeof i[h[j]]&&(i[h[j]]={}),i=i[h[j]];i[h[h.length-1]]=c}}},get:function(a){for(var b=a.split("."),c=this,d=0;d<b.length&&c;d++)c=c[b[d]];return c},initialize:function(){},beforeFetch:function(){},fetchDone:function(){},retrieve:function(a){a.reject(null)},resolveDependencies:function(){return b.when(!0)},parse:function(a,b){this.set(a),b||(b={}),b.skipResolveDependencies||this.resolveDependencies()}}),d}]),angular.module("spot.im.core").factory("Cursor",["$q",function(a){function b(a){this.data=[],this.allData=[],this.nextFn=a}return b.prototype={hasNext:function(){return this.nextFn&&"function"==typeof this.nextFn},next:function(){var b=a.defer();if(this.hasNext()){var c=this;this.nextFn().then(function(a){if(a){var d=a.data,e=a.nextFn;d&&d.length>0?(c.data.length=0,d.forEach(function(a){c.data.push(a),c.allData.push(a)}),c.nextFn=e,b.resolve()):(c.data=d||[],c.nextFn=null,b.resolve())}else c.nextFn=null,b.reject()},function(){c.nextFn=null,b.reject()})}else b.reject();return b.promise}},b}]),angular.module("spot.im.core").factory("Events",["underscore","$q",function(a){var b={on:function(a,b,c){this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(b,c,d){var e=this,f=a.once(function(){e.off(b,f),c.apply(this,arguments)});return f._originalCallback=c,this.on(b,f,d)},off:function(b,c,d){var e,f,g,h,i,j,k,l;if(!this._events)return this;if(!b&&!c&&!d)return this._events={},this;for(h=b?[b]:a.keys(this._events),i=0,j=h.length;j>i;i++)if(b=h[i],g=this._events[b]){if(this._events[b]=e=[],c||d)for(k=0,l=g.length;l>k;k++)f=g[k],(c&&c!==f.callback&&c!==f.callback._originalCallback||d&&d!==f.context)&&e.push(f);e.length||delete this._events[b]}return this},trigger:function(a){if(!this._events)return this;{var b=[].slice.call(arguments,1),c=this._events[a];this._events.all}if(c)for(var d,e=-1;++e<c.length;)(d=c[e]).callback.apply(d.ctx,b);return this}};return b}]),angular.module("spot.im.core").factory("pusherEvents",["$rootScope","pusherService",function(a,b){function c(b,c,d){a.$safeApply(function(){e[b]&&e[b][c]&&e[b][c].length>0&&e[b][c].forEach(function(a){a(d)}),f.length>0&&f.forEach(function(a){a(b,c,d)})})}function d(a){delete e[a]}var e={},f=[],g={subscribe:function(a){b.bindAll(a,function(b,d){c(a,b,d)})},unsubscribe:function(a){b.unsubscribe(a),d(a)},on:function(a,b,c){return c&&"function"==typeof c&&(e[a]||(e[a]={}),e[a][b]||(e[a][b]=[]),e[a][b].push(c)),function(){g.off(a,b,c)}},off:function(a,b,c){if(c&&"function"==typeof c){var d=e[a]&&e[a][b];if(angular.isArray(d)){var f=d.indexOf(c);d.splice(f,1)}}},onAll:function(a){return f.push(a),function(){g.offAll(a)}},offAll:function(a){var b=f.indexOf(a);f.splice(b,1)}};return g}]),angular.module("spot.im.core").factory("CoreSpotCreateCtrl",["utils","$q","pixelManager","SessionUser","CoreSpotEditCtrl","CloudinaryService","SpotResource","trackerVent",function(a,b,c,d,e,f,g,h){var i=a.extend(e,{constructor:function(){var b=a.guid(),c={id:b,spot_id:b,type:"public",main_language:"en",embed_position:"left",bubble_text_color:"#555",brand_color:"#0086ff"};this.validationError=!1,this.createError=!1,e.apply(this,[c])},_doUpdate:function(a){var b=angular.extend(this.spot,a);return this.validationError&&(this.validationError=this._validate()),b},_doCreate:function(){var a=(b.defer(),this);this.createError=!1,h.trigger("Create Spot Save",this.spotInfo.category.text,this.spot.id,this.spot.name);var c=g.create(this.spot).$promise.then(function(){return h.trigger("Create Spot Success",a.spotInfo.category.text,a.spot.id,a.spot.name),SpotsManager.getSpot({id:a.spot.id})}).then(function(a){var b=d.getUser();return b.applyJoinedSpot(a.id),a}).catch(function(c){a.createError=!0;var d=c&&c.data&&c.data.meta.error_details;return h.trigger("Create Spot Failed",a.spotInfo.category.text,a.spot.id,a.spot.name,d),b.reject(d)});return c.then(function(){a._trackSpotCreated()}),c},hasSpotIcon:function(){return!!this.spot.spot_icon},getSpotIcon:function(a){return f.getUrl(this.spot.spot_icon,a)},_validate:function(){this.spot.category_id||this._setError("category_id","Please select a category"),this.spot.name||this._setError("name","Please select a name"),this.spot.spot_icon||this._setError("spot_icon","Please select spot icon");var a=!1;for(var b in this.flags)a=a||!!this.flags[b].error;return a},createSpot:function(){var a=this,c=null;return this.createSpotLoading=!0,this.validationError=this._validate(),c=this.validationError?b.reject():this._doCreate(),c.finally(function(){a.createSpotLoading=!1})},_trackSpotCreated:function(){c.fireUrl("https://www.facebook.com/tr?ev=6016372396233&amp;cd[value]=0.00&amp;cd[currency]=USD&amp;noscript=1"),c.fireUrl("https://www.googleadservices.com/pagead/conversion/961679912/?label=Cj0nCP6hwVYQqKTIygM&amp;guid=ON&amp;script=0"),c.fireUrl("https://analytics.twitter.com/i/adsct?txn_id=l4xcq&p_id=Twitter"),c.fireUrl("https://t.co/i/adsct?txn_id=l4xcq&p_id=Twitter")}});return i}]),angular.module("spot.im.core").factory("CoreSpotEditCtrl",["$q","SpotResource","Spot","underscore","SpotsManager","CloudinaryService","spotCategories","isoLanguageCodes","fileReader",function(a,b,c,d,e,f,g,h,i){function j(a){return i.readAsDataUrl(a).then(function(a){return f.uploadPromise(a,null)}).then(function(a){return console.log("user Image upload complete.",a.public_id),a.public_id})}function k(b,c){var d=/[\u00BF-\u1FFF\u2C00-\uD7FFa-zA-Z0-9\-\.]{3,25}$/,f=a.defer();return d.test(c)?e.reservePublicSpotName(b,c).then(function(a){f.resolve(a)},function(a){var b=null;409===a.code&&(b="This spot name is taken. Please try a different one."),f.reject(b)}):f.reject(c?c.length<=2?"Spot name field should contain 3 letters minimum.":c.length>25?"Spot name field should contain 25 letters maximum.":"Not a valid spot name. You can use only letters, numbers, dots or dashes.":"Spot name field is required."),f.promise}function l(a){var b=this;this.spot=a,this.flags={},this.languages=h.list,this.colors=["#9e0a16","#ec3846","#f15475","#ef6338","#fdad00","#85b13b","#33b27d","#3a825d","#2dabe2","#0086ff","#156ab7","#094c8a","#7d74cb","#765272","#906969","#6e5454"],this.isLanguagesSelectVisible=!1,this.isColorPickerVisible=!1,this.spotInfo={name:a.name,category:null,languages:this._getSpotLanguages(),language:null,spot_icon:a.spot_icon,embed_position:a.embed_position,bubble_text_color:a.bubble_text_color||"#555",brand_color:a.brand_color},"#000"===this.spotInfo.bubble_text_color&&(this.spotInfo.bubble_text_color="#555"),g.get().then(function(c){b.spotCategories=c,b.spotInfo.category=d.findWhere(c,{id:a.category_id})}),this.isEmbedded=null,c.getImplementationStatuses([a.id]).then(function(c){b.isEmbedded=c[a.id].embedded})}return l.prototype={_setError:function(a,b){var c=this.flags[a]||(this.flags[a]={});c.error=!0,c.tooltip=b},_doUpdate:function(a){return b.update({id:this.spot.id},a).$promise},_getSpotLanguages:function(){var a=[].concat(this.spot.main_language,this.spot.languages).map(function(a){return h.getById(a)}).filter(function(a){return!!a});return a.filter(function(b,c){return a.indexOf(b)==c})},showLanguagesSelect:function(){this.isLanguagesSelectVisible=!0},hideLanguagesSelect:function(){this.clearError("languages"),this.isLanguagesSelectVisible=!1},onColorPickerSelect:function(a){this.spotInfo.brand_color=a,this.isColorPickerVisible=!1,this.updateFieldImmediate("brand_color",a)},toggleColorPicker:function(){this.isColorPickerVisible=!this.isColorPickerVisible},clearError:function(a){angular.extend(this.flags[a]||{},{error:!1,tooltip:""})},updateFieldImmediate:function(b,c,e){var f={},g=a.when(),h=this,i=-1;switch(this.flags[b]={approved:!1,error:!1,loading:!1,tooltip:""},this.flags[b].loading=!0,b){case"name":this.flags[b].approved=!1,this.flags[b].error=!1,g=k(this.spot.id,c).then(function(){f.name=f.spot_name=c});break;case"languages":var l=c;if("add"===e)if(l)if(i=this.spotInfo.languages.indexOf(l),i>=0)g=a.reject("You already chose this language.");else{var m=[].concat(this.spotInfo.languages,l);f.languages=d.pluck(m,"id")}else g=a.reject("Please select a language.");else if("remove"===e&&(i=this.spotInfo.languages.indexOf(l),-1!==i)){var m=[].concat(this.spotInfo.languages.slice(0,i),this.spotInfo.languages.slice(i+1));f.languages=d.pluck(m,"id")}break;case"spot_icon":g=j(c).then(function(a){f[b]=a});break;default:f[b]=c}g.then(function(){return h._doUpdate(f)}).then(function(){switch(b){case"name":h.flags[b].approved=!0,h.flags[b].tooltip="Spot name is yours!";break;case"languages":"add"===e?(h.spotInfo.languages.push(c),h.spotInfo.language=null):"remove"===e&&h.spotInfo.languages.splice(i,1),h.hideLanguagesSelect();break;default:h.flags[b].approved=!0,h.clearError(b)}}).catch(function(a){h._setError(b,a)}).finally(function(){h.flags[b].loading=!1})}},l.prototype.updateField=d.debounce(l.prototype.updateFieldImmediate,500),l}]),angular.module("spot.im.core").factory("CoreSpotCtrl",["SessionUser","SpotsManager","UsersManager","Events","IntimateSpot","spotMessagesFetcher","spotMembersFetcher","OnlineMembers","spotEvents","spotTyping","$q","underscore","currentSpotView","unreadIntimateMessages",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a,b){this.spot=null,this.isIntimate=!1,this.fetchNextMessages=null,this.onlineMembers=null,this.newMessageWaiting=!1,this.expandedPreview=!1,this.isFetchingMessages=!1,this.lastSeenTimestamp=null,this.spotTyping=null,this._readyDeferred=k.defer(),this.readyPromise=this._readyDeferred.promise,this.spotCategory={id:0,text:""},this._firstMessagesFetchDeferred=k.defer(),this.firstMessagesFetchPromise=this._firstMessagesFetchDeferred.promise,this.spotHosts=[],b?this._loadSpotDone(a):this._loadSpot(a)}return o.prototype={_loadSpot:function(a){b.getSpot(a,!0).then(this._loadSpotDone.bind(this),this._readyDeferred.reject)},_loadSpotDone:function(b){var c=this;this.spot=b,this.isIntimate=b instanceof e,this.fetchNextMembers=g.get(b,50);var d=f.get(b);this.fetchNextMessages=function(){this.isFetchingMessages=!0;var a=d.apply(null,arguments);return a.then(function(){c.isFetchingMessages=!1,c._firstMessagesFetchDeferred.resolve()}),a},this.onlineMembers=h.get(b),i.start(b),this.spotTyping=j.get(this.spot),this.spotTyping.on("update",function(a,b){this.trigger("spotTypingUpdate",a,b)},this),a.subscribeLoginChange(function(){c.reloadSpot()},this),m.enter(this.spot),this._readyDeferred.resolve(!0)},reloadSpot:function(){var a=this;this.spot.removeAllMembers(),this.fetchNextMembers(!0),this.spot.removeAllMessages(),this.fetchNextMessages(!0).then(function(){a.lastSeenTimestamp=null,a.isIntimate&&n.update()})},destroy:function(){this.onlineMembers.destroy(),i.stop(this.spot),this.spotTyping.off(null,null,this),this.spotTyping.destroy(),m.leave(this.spot),this.off()},getBlurrySpotIconUrl:function(a,b){return this.spot.getSpotIconUrl({width:b,height:a,crop:"crop",blur:1800,opacity:45})},loadCategory:function(){var a=this;return this.spot.getSpotCategory().then(function(b){l.isUndefined(b)||(a.spotCategory=b)})},loadHosts:function(){var a=this;return this.spot.getHosts().then(function(b){[].push.apply(a.spotHosts,b)})},isReady:function(){return"fulfilled"===this.readyPromise.state},replyMessage:function(a){var b=this;c.getUser({id:a.sender_id},!1).then(function(c){var d={id:l.escape(c.id),name:l.escape(c.display_name),uniqe_name:l.escape(c.username),value:l.escape("@"+c.username),type:"user"};b.trigger("replyMention",d,a.id)})},markPreviewExpanded:function(a){this.expandedPreview=a},markNewMessageAsWaiting:function(){this.newMessagesCount=0;var a=this;this.spot.messages.forEach(function(b){b.timestamp>a.lastSeenTimestamp&&a.newMessagesCount++})},markNewMessagesAsSeen:function(){this.newMessagesCount=0,this.lastSeenTimestamp=Math.max.apply(null,this.spot.messages.map(function(a){return a.timestamp}))},hasMessages:function(){return this.spot&&this.spot.messages&&this.spot.messages.length>0},getLastMessage:function(){if(!this.hasMessages())return null;var a=-1,b=null;return this.spot.messages.forEach(function(c){c.timestamp>a&&(a=c.timestamp,b=c)}),b},isOtherPartyOnline:function(){return this.isIntimate&&this.onlineMembers.isOnline(this.spot.other_party_id)},getEmptyMessageType:function(){var a=null;return this.isIntimate&&(a=this.onlineMembers.isOnline(this.spot.other_party_id)?"online":this.spot.other_party.mobile_user?"mobile":"default"),a},isPopularLinksEnabled:function(){return this.spot&&this.spot.popular_links_count>=3&&"intimate"!==this.spot.type}},angular.extend(o.prototype,d),o}]),angular.module("spot.im.core").factory("CoreUserProfileCtrl",["$q","stateProviderBridge","userMessagesFetcher",function(a,b,c){function d(b,c){this.user=null,this._readyDeferred=a.defer(),this.readyPromise=this._readyDeferred.promise,this.isMyProfile=!1,this.isFetchingMedia=!1,this.userMedia=[],this.fetchNextMedia=null,this.hostSpots=[],this.mutualSpots=[],this.memberSpots=[],c?this._loadUserDone(b):this._loadUser(b)}a.when(!0);return d.prototype={_loadUser:function(a){UsersManager.getUser(a,!0).then(this._loadUserDone.bind(this),this._readyDeferred.reject)},_loadUserDone:function(a){this.user=a,this.isMyProfile=a.isMe();var b=c.get(a,30,"media_history");this.fetchNextMedia=function(){this.isFetchingMedia=!0;var a=b.apply(null,arguments),c=this;return a.then(function(a){c.isFetchingMedia=!1,c.userMedia=c.userMedia.concat(a)}),a};var d=this;a.getSortedSpots().then(function(a){[].push.apply(d.hostSpots,a.hostSpots),[].push.apply(d.mutualSpots,a.mutualSpots),[].push.apply(d.memberSpots,a.memberSpots)}),this.fetchNextMedia(),this._readyDeferred.resolve(a)},destroy:function(){},isReady:function(){return"fulfilled"===this.readyPromise.state},hasBasicInformation:function(){return this.user.about||this.user.locale||this.user.country||this.user.age||this.user.gender},getProfileImageUrl:function(a,b){return this.user.getUserImageUrl({width:b,height:a,crop:"fill"})},getBlurryProfileImageUrl:function(a,b){return this.user.getUserImageUrl({width:b,height:a,crop:"crop",blur:1800,opacity:45})},acceptIntimateSpot:function(a){var c=this.user,d=c.acceptIntimate();a&&d.then(function(){var a=c.getCoreIntimateSpotUrlState();b.transitionTo(a.stateName,a.stateParams)})}},d}]),angular.module("spot.im.core").factory("CoreUserProfileEditCtrl",["$q","fileReader","CloudinaryService","UserResource","isoLanguageCodes","isoCountryCodes","CoreUserProfileCtrl","utils","underscore","SessionUser","mainSpot","historyTracker",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a){return b.readAsDataUrl(a).then(function(a){return c.uploadPromise(a,null)}).then(function(a){return console.log("user Image upload complete.",a.public_id),a.public_id})}function n(a){return d.update_fields(a).$promise}var o=h.extend(g,{constructor:function(a,b){this.userImageFile=null,this.editUserData={},this.languages=e.list,this.countries=f.list,this.updateField=i.debounce(this.updateField,500),this.flags={},g.apply(this,[a,b])},_loadUserDone:function(a){g.prototype._loadUserDone.apply(this,arguments),this.editUserData={display_name:a.display_name,username:a.username,about:a.about,language:e.getById(a.locale),country:f.getById(a.country),birthday:h.getDateObject(a.birthday),gender:a.gender,muted:a.muted?"true":"false"},this.mapDays=h.getDaysInMonthArray(a.birthday),this.mapMonths=h.getMonthsNamesObject(a.locale),this.mapYears=h.getYearsArraySince(1950)},_usernameReservation:function(b){var c=/[\u00BF-\u1FFF\u2C00-\uD7FFa-zA-Z0-9\-\.]{2,}$/,d=a.defer();return c.test(b)?(this.flags.username.loading=!0,j.reserveUsername(b,this.user.id).then(function(a){a.tooltip="Username is yours!",d.resolve(a)},function(a){var b=null;409===a.code&&(b="Username taken"),d.reject(b)})):d.reject(!b||b.length<=2?"Username field is required":"Not a valid username (ex: user.name-123)"),d.promise},uploadProfileImage:function(){var a=this;this.flags.isUploadingImage=!0,m(this.userImageFile).then(function(a){return n({profile_image:a})}).finally(function(){a.flags.isUploadingImage=!1})},updateField:function(b,c){var d={},e=a.when(),f=this.user.getProfileUrlState(),g=this;switch(this.flags[b]={approved:!1,error:!1,loading:!1,tooltip:""},this.flags[b].loading=!0,b){case"birthday":var i=h.dateObjectToISOString(c),j=h.isValidDateStr(i);d[b]=i,this.mapDays=h.getDaysInMonthArray(i),(j&&"0000"===c.year||!j&&"0000-00-00"!==i)&&(e=a.reject("Please enter a complete date"));break;case"username":this.flags[b].approved=!1,this.flags[b].error=!1,e=this._usernameReservation(c).then(function(a){d=a
});break;case"muted":d[b]="true"===c;break;default:d[b]=c}e.then(function(){return n(d)}).then(function(){"username"===b&&(g.flags[b].approved=!0,g.flags[b].tooltip=d.tooltip);var a=g.user.getProfileUrlState();l.replaceStateParams(f.stateName,f.stateParams,a.stateParams)}).catch(function(a){-1!==["username","birthday"].indexOf(b)&&(g.flags[b].error=!0,g.flags[b].tooltip=a)}).finally(function(){g.flags[b].loading=!1})},logout:function(){j.logout().then(function(){k.redirect()})}});return o}]),angular.module("spot.im.core").factory("hrefLinkFactory",["$timeout","stateProviderBridge",function(a,b){return function(c,d){return function(e,f,g){var h=null;e.$watchCollection(g[c],function(a){if(a&&(h=d(a),h&&h.stateName)){var c=b.href(h.stateName,h.stateParams);f.attr("href",c),"newWindow"in g&&f.attr("target","_blank")}}),f.bind("click",function(c){var d=c.which||c.button;d>1||c.ctrlKey||c.metaKey||c.shiftKey||f.attr("target")||!h||(a(function(){b.transitionTo(h.stateName,h.stateParams)}),c.preventDefault())})}}}]),angular.module("spot.im.core").directive("intimateHref",["hrefLinkFactory",function(a){return{restrict:"A",link:a("intimateHref",function(a){var b=null;return a&&(b=a.getCoreIntimateSpotUrlState()),b})}}]),angular.module("spot.im.core").directive("messageHref",["hrefLinkFactory",function(a){return{restrict:"A",link:a("messageHref",function(a){var b=null;return a&&(b=a.getCoreState()),b})}}]),angular.module("spot.im.core").directive("senderHref",["hrefLinkFactory",function(a){return{restrict:"A",link:a("senderHref",function(a){var b=null;return a&&(b=a.getSenderCoreState()),b})}}]),angular.module("spot.im.core").directive("spotHref",["hrefLinkFactory",function(a){return{restrict:"A",link:a("spotHref",function(a){var b=null;return a&&(b=a.getCoreState()),b})}}]),angular.module("spot.im.core").directive("stateHref",["hrefLinkFactory",function(a){return{restrict:"A",link:a("stateHref",function(a){var b=null;return a&&(b={stateName:a,stateParams:{}}),b})}}]),angular.module("spot.im.core").directive("userHref",["hrefLinkFactory","User",function(a,b){return{restrict:"A",link:a("userHref",function(a){var c=null;return a&&(a instanceof b?c=a.getCoreState():"string"==typeof a&&(c=b.getCoreState(a))),c})}}]),angular.module("spot.im.core").directive("linkEntities",["stateProviderBridge","entityStateResolver","$compile",function(a,b,c){return{scope:!0,link:function(d,e,f){function g(){var g=d.$eval(f.entities),h=d.$eval(f.text),i=f.hrefClick;if(angular.isDefined(g)){var j=h,k=j;g&&g.length>0&&(d.states=[],g.forEach(function(c,e){var f=c.text||j,g=b.resolveState(c.type,c.concreteType,{id:c.id});d.states[e]=a.mapState(g.stateName,g.stateParams);var h=null;h=i?'<a ng-click="'+i+"($event, states["+e+'])" class="entity branded-text branded-icons-before '+c.type+'">'+f+"</a>":'<a ui-sref="{{ states['+e+"].stateName }}({{ states["+e+'].stateParams }})" class="entity branded-text branded-icons-before '+c.type+'">'+f+"</a>",k=c.placeholder&&c.text?k.replace(c.placeholder,h):h}));var l=c("<div>"+k+"</div>")(d);e.html(""),e.append(l)}}d.$watch(f.text,g)}}}]),angular.module("spot.im.utils").directive("messagesScroll",["$timeout",function(a){return{scope:!1,require:"ngScrollbar",controller:["$scope",function(){}],link:function(b,c,d,e){function f(){var a=e.distanceFromBottom(),b=i.getLastMessage();return null===i.lastSeenTimestamp||b&&b.isMine()&&b.timestamp>i.lastSeenTimestamp||200>=a}function g(a){return i.hasMessages()&&i.lastSeenTimestamp&&a>i.lastSeenTimestamp&&e.isYActive()}function h(){var a=Math.max.apply(null,i.spot.messages.map(function(a){return a.timestamp}));f()?(e.scrollToBottom(),i.markNewMessagesAsSeen()):(g(a)&&i.markNewMessageAsWaiting(),e.update())}var i=b.spotCtrl;i.scrollToReadNewMessages=function(){e.scrollToBottom(),this.markNewMessagesAsSeen()},c.on("on-scrolled-top",function(){i.fetchNextMessages()}),c.on("on-scrolled-bottom",function(){i.markNewMessagesAsSeen()}),b.$watchCollection("spotCtrl.spot.messages",function(b){b&&b.length&&a(h)}),b.$watch("spotCtrl.isUserTyping",function(b){b&&a(h)}),b.$on("initiator:stateChanged",function(b,c,d){"spot-state"===d&&"modal-state"!==c&&a(function(){e.scrollToBottom()})})}}}]),angular.module("spot.im.core").directive("spotThumbnail",["$parse","utils",function(a,b){return{restrict:"A",link:function(a,c,d){function e(a){c.removeClass("default").css({"background-color":"","background-image":"url("+a+")"})}function f(a){c.addClass("default").css({"background-color":a.brand_color,"background-image":""})}function g(a){a?b.preloadImage(a).then(function(){e(a)},function(){f(j)}):f(j)}function h(a){c.css("border-radius","50%");var b=k.spotIcon||a.getSpotThumbnailUrl(k);g(b)}function i(a){c.css("border-radius","50%");var b=k.spotIcon||a.other_party&&a.other_party.getUserImageUrl(k);g(b)}var j=a.$eval(d.spotThumbnail),k=angular.extend({width:46,height:46,crop:"fill"},a.$eval(d.options));a.$watchCollection(d.spotThumbnail,function(a){a&&("public"===a.type?h(a):"intimate"===a.type&&i(a))})}}}]),angular.module("spot.im.core").filter("linkEntitiesAndEscape",["$filter","$sce","$sanitize","entityStateResolver","stateProviderBridge",function(a,b,c,d,e){return function(b,c){if(!c||!c.length)return a("escape")(b);var f=b,g=[];c.forEach(function(c){if(!(!c.type in["user","spot"])&&c.range){var h=d.resolveState(c.type,c.spot_type,{id:c.entity_id}),i=e.href(h.stateName,h.stateParams),j=c.range[0]+c.range[1],k=b.substr(c.range[0],c.range[1]);k=a("escape")(k);var l='<a class="'+c.type+' branded-text" href="'+i+'">'+k+"</a>";g.push({original:l,escaped:a("escape")(l)}),f=f.substring(0,c.range[0])+l+f.substring(j)}});var h=a("escape")(f);return g.forEach(function(a){h=h.replace(a.escaped,a.original)}),h}}]),angular.module("spot.im.core").filter("mySpotsFilter",["underscore",function(a){return function(b,c){if(!b||0===b.length)return b;var d=a.filter(b,function(a){var b=a.name||"";return 0===b.indexOf(c)||b.indexOf(" "+c)>0});return d}}]),angular.module("spot.im.core").filter("remove_hosts",["underscore",function(a){return function(b,c){return a.filter(b,function(a){return!c.isHost(a.id)})}}]),angular.module("spot.im.core").factory("MessagesManager",["$q","underscore","$injector","MessageResource","currentSpotView",function(a,b,c,d,e){var f=window.MessagesManager={_pool:{},_storeInPool:function(a){this._pool[a.id]=a},_createInstance:function(a,d){d=b.extend({},d,{parse:!0});var e=this._pool[a.id];if(e)d.parse?e.parse(a):e.set(a);else{var f=c.get("Message");e=new f(a,d),this._storeInPool(e)}return e},_findByMessageId:function(a){return this._pool[a]},_loadByMessageId:function(a,b){var c=this;d.get({id:a},function(d){if(d.isSuccess){var e=c._findByMessageId(a);b.resolve(e)}else b.reject()},b.reject)},_loadByMessagesIds:function(a,b){var c=this;d.get({ids:a.join(",")},function(d){if(d.isSuccess){var e=[];a.forEach(function(a){var b=c._findByMessageId(a);e.push(b)}),b.resolve(e)}else b.reject()},b.reject)},_getByMessageId:function(a,b){var c=this._findByMessageId(a);c?b.resolve(c):this._loadByMessageId(a,b)},clearPool:function(){this._pool={}},getMessage:function(b){var c=a.defer();return b.id?this._getByMessageId(b.id,c):c.reject(),c.promise},getMessagesByIds:function(b){var c=a.defer(),d=[],e=[],f=this;if(b.forEach(function(a){var b=f._findByMessageId(a);b?d.push(b):e.push(a)}),e.length>0)if(1===e.length){var g=a.defer();f._loadByMessageId(e[0],g),g.promise.then(function(a){c.resolve([a])},c.reject)}else{var h=a.defer();this._loadByMessagesIds(e,h),h.promise.then(function(a){d=d.concat(a),c.resolve(d)},c.reject)}else c.resolve(d);return c.promise},refetchMessage:function(b){var c=a.defer();return this._loadByMessageId(b,c),c.promise},setMessage:function(a,b){var c=this,d=this._findByMessageId(a.id);return d?d.parse(a,b):d=c._createInstance(a,b),d},setMessages:function(a,b){var c=this;a.forEach(function(a){c.setMessage(a,b)})},retrieveAllMessages:function(){return b.values(this._pool)}};return e.on("leave",function(){f.clearPool()}),f}]),angular.module("spot.im.core").factory("SpotsManager",["underscore","$q","$injector","SpotResource",function(a,b,c,d){var e=window.SpotsManager={_pool:{},_getClass:function(a){switch(a){case"intimate":return c.get("IntimateSpot");case"public":return c.get("PublicSpot");case"private":return c.get("PrivateSpot");default:return null}},_createInstance:function(b,c,d){d=a.extend({},d,{parse:!0});var e=this._pool[c.id];if(e)d.parse?e.parse(c):e.set(c);else{var f=this._getClass(b);e=f?new f(c,d):null,e&&(this._pool[c.id]=e)}return e},_searchSpot:function(a,b,c,e){var f=this,g=null,h=null,i=null;a?(g="get",h={id:a},i=function(){return f._findBySpotId(a)}):b&&(g="find_public_by_name",h={name:b},i=function(){return f._findPublicByEncodedName(b)}),e&&e.params&&angular.extend(h,e.params),g?d[g](h,function(a){if(a.isSuccess){var b=i();c.resolve(b)}else c.reject()},c.reject):c.reject()},_findBySpotId:function(a){return this._pool[a]},_loadBySpotId:function(a,b,c){this._searchSpot(a,null,b,c)},_getBySpotId:function(a,b,c,d){var e=this._findBySpotId(a);e&&!b?c.resolve(e):this._loadBySpotId(a,c,d)},_findPublicByEncodedName:function(b){return a.find(a.values(this._pool),function(a){return"public"===a.get("type")&&a.getEncodedName()===b})},_loadPublicByEncodedName:function(a,b,c){this._searchSpot(null,a,b,c)},_getPublicByEncodedName:function(a,b,c,d){var e=this._findPublicByEncodedName(a);e&&!b?c.resolve(e):this._loadPublicByEncodedName(a,c,d)},_findSpot:function(a){var b=null;if(a.id)b=this._findBySpotId(a.id);else if(a.type)switch(a.type){case"intimate":break;case"public":a.name&&(b=this._findPublicByEncodedName(a.name));break;case"private":}return b},_loadSpot:function(a,b,c){if(a.id)this._loadBySpotId(a.id,b,c);else if(a.type)switch(a.type){case"intimate":break;case"public":a.name?this._loadPublicByEncodedName(a.name,b,c):b.reject();break;case"private":b.reject();break;default:b.reject()}else b.reject()},getSpotsByIds:function(b){var c=a.map(b,function(a){return{id:a}});return this.getSpots(c)},getSpots:function(a){function c(){h--,0===h&&g.resolve(f)}function d(a){f.push(a)}var e=this,f=[],g=b.defer(),h=a.length;return 0===a.length&&g.resolve([]),a.forEach(function(a){e.getSpot(a).then(d).finally(c)}),g.promise},getSpot:function(a,c,d){var e=b.defer();if(a.id)this._getBySpotId(a.id,c,e,d);else if(a.type)switch(a.type){case"intimate":e.reject();break;case"public":a.name?this._getPublicByEncodedName(a.name,c,e,d):e.reject();break;case"private":e.reject();break;default:e.reject()}else e.reject();return e.promise},refetchSpot:function(a,c){var d=b.defer();return this._loadBySpotId(a,d,c),d.promise},removeSpot:function(a){var b=this._pool[a];b&&delete this._pool[a]},setSpot:function(a,b){var c=this,d=this._findSpot(a);return d?d.parse(a,b):d=c._createInstance(a.type,a,b),d},reservePublicSpotName:function(a,c,e){var f=b.defer();return d.reserve_public_name({spot_id:a,spot_name:c,interval:e||600},function(a){f.resolve({spotId:a.response.spot_id,spotUrl:a.response.url})},function(a){var b=a.data.meta;f.reject(b)}),f.promise},fetchAllSpots:function(){var b=this;a.values(this._pool).forEach(function(a){b.refetchSpot(a.id)})}};return e}]),angular.module("spot.im.core").factory("UsersManager",["underscore","$q","$injector","SessionUser","UserResource",function(a,b,c,d,e){var f=window.UsersManager={_pool:{},_createInstance:function(b,d){d=a.extend({},d,{parse:!0});var e=this._pool[b.id];if(e)d.parse?e.parse(b):e.set(b);else{var f=c.get("User");e=new f(b,d),this._pool[b.id]=e}return e},_findByUserId:function(a){return this._pool[a]},_loadByUserId:function(a,b){var c=this;e.get({id:a},function(d){if(d.isSuccess){var e=c._findByUserId(a);b.resolve(e)}else b.reject()},b.reject)},_getByUserId:function(a,b,c){var d=this._findByUserId(a);d&&!b?c.resolve(d):this._loadByUserId(a,c)},_findByUniqueName:function(b){return a.find(a.values(this._pool),function(a){return a.get("username")===b})},_loadByUniqueName:function(a,b){var c=this;e.get_by_name({username:a},function(d){if(d.isSuccess){var e=c._findByUniqueName(a);b.resolve(e)}else b.reject()},b.reject)},_getByUniqueName:function(a,b,c){var d=this._findByUniqueName(a);d&&!b?c.resolve(d):this._loadByUniqueName(a,c)},_findUser:function(a){var b=null;return a.id?b=this._findByUserId(a.id):a.unique_name&&(b=this._findByUniqueName(a.unique_name)),b},_loadUser:function(a,b){a.id?this._loadByUserId(a.id,b):a.unique_name?this._loadByUniqueName(a.unique_name,b):b.reject()},getUser:function(a,c){var d=b.defer();return a.id?this._getByUserId(a.id,c,d):a.unique_name?this._getByUniqueName(a.unique_name,c,d):d.reject(),d.promise},getUsersByIds:function(c){var d=b.defer(),e=this,f=[],g=[];if(c.forEach(function(a){var b=e._findByUserId(a);b?f.push(b):g.push(a)}),g.length>0){var h=[];g.forEach(function(a){var c=b.defer();e._loadByUserId(a,c),h.push(c.promise)}),b.all(h).then(function(b){a.addToSet(b,f),d.resolve(b)},d.reject)}else d.resolve(f);return d.promise},setUser:function(a,b){var c=this,d=this._findUser(a);return d?d.parse(a,b):d=c._createInstance(a,b),d},refetchUser:function(a){var c=b.defer();return this._loadByUserId(a,c),c.promise},retrieveAllUsers:function(){return a.values(this._pool)}};return f}]),angular.module("spot.im.core").factory("deviceManager",["$window","underscore","cookiesManager","localStorageManager","utils","Logger","trackerVent",function(a,b,c,d,e,f,g){var h="spotim-device",i=a.deviceCookieVersion,j=f.getInstance("deviceManager"),k={_getDeviceJson:function(){var a=c.getItem(h);return a||(a=d.getItem(h),a&&c.setItem(h,a)),a},generateDevice:function(){return{id:e.guid(),password:e.guid(),type:"web"}},storeDevice:function(a){try{var b=JSON.stringify({version:i,value:a});c.setItem(h,b),d.setItem(h,b)}catch(e){g.trigger("Device Store Error",e.message)}},getDevice:function(){var a=this._getDeviceJson(),b=null,c=null,d=!1;try{c=JSON.parse(a)}catch(e){d=!0,j.error("getDevice","failure: {0}",[e])}return c&&c.version===i&&c.value?b=c.value:(d?g.trigger("Device Corrupted",a,"Parse error"):c.version!==i?g.trigger("Device Corrupted",a,"Incorrect version ("+c.version+" and expected "+i+")"):!c.value,b=this.generateDevice()),b},removeDevice:function(){c.removeItem(h),d.removeItem(h)},hasDevice:function(){var a=this._getDeviceJson();return!(!a||!a.length)}};return"https:"!==window.location.protocol&&(window.location.href="https:"+window.location.href.substring(window.location.protocol.length)),k}]),angular.module("spot.im.core").factory("Explore",["underscore","geoLocationService","SpotResource","BaseModel","SpotsManager",function(a,b,c,d,e){var f={explore:"explore",category:"category",hashtag:"hashtag"},g=d.extend({_defaultOptions:{category:null,hashtag:null},initialize:function(a,b){this.resetOptions(b)},resetOptions:function(b){this.options=a.extend({},this._defaultOptions,b),this.calculateState()},calculateState:function(){this.state=this.options.category?f.category:this.options.hashtag?f.hashtag:f.explore},beforeFetch:function(){this.fetchWithLocation=b.isDoneLoading()},fetchDone:function(){this.fetchWithLocation||b.getPromise().then(a.bind(function(){this.fetchWithLocation=!0,this.fetch()},this))},getStateParams:function(){var a=null;switch(this.state){case f.category:a={category:this.options.category,spot_count:50};break;case f.hashtag:a={tag:this.options.hashtag,spot_count:50};break;case f.explore:a={spot_count:10}}return a},retrieve:function(a){var d=this.getStateParams();if(this.fetchWithLocation){var e=b.getCurrentPosition();e.country&&(d.country=e.country),e.city&&(d.city=e.city),e.longitude&&(d.longitude=e.longitude),e.latitude&&(d.latitude=e.latitude)}c.explore(d,a.resolve)},parse:function(b){var c=this;switch(this.state){case f.category:this.spotsLists||(this.spotsLists={}),this.spotsLists[this.options.category]||(this.spotsLists[this.options.category]={id:this.options.category,name:this.options.category}),this.spotsLists[this.options.category].spots=this.parseSpotsCollection(b);break;case f.hashtag:this.topHashtags||(this.topHashtags={}),this.topHashtags[this.options.hashtag]||(this.topHashtags[this.options.hashtag]={name:this.options.hashtag}),this.topHashtags[this.options.hashtag].spots=this.parseSpotsCollection(b);break;case f.explore:var d=(a.findWhere(b,{id:"top_hashtags"})||{}).data||[];this.topHashtags={},d.forEach(function(a){c.topHashtags[a]={name:a,spots:[]}});var e=a.filter(b,function(a){return"top_hashtags"!==a.id});this.spotsLists={},e.forEach(function(a,b){c.spotsLists[a.id]={order:b,id:a.id,name:a.name,spots:c.parseSpotsCollection(a.data)}})}},getSpotsLists:function(){return a.values(this.spotsLists)},parseSpotsCollection:function(b){var c=[];return b&&b.length>0&&a.each(b,function(a){var b=e.setSpot(a);b&&c.push(b)}),c},fetchOptions:function(a){return this.resetOptions(a),this.fetch()},getCurrentSpotsList:function(){var a=[];switch(this.state){case f.category:a=(this.spotsLists||{})[this.options.category]||{};break;case f.hashtag:a=(this.topHashtags||{})[this.options.hashtag]||{}}return a}});return g}]),angular.module("spot.im.core").factory("Invitation",["AlertItem","utils","$q","UserResource","SpotsManager","UsersManager",function(a,b,c,d,e,f){var g=b.extend(a,{initialize:function(a,b,c){var d=a+"."+b.type;this.parse(d,b,c),this.isHandled=!1,this.spotId=b.spot.id},_setHandled:function(a){this.isHandled=a},accept:function(){var a=this,b=this.inviter.id,d=null;return this._setHandled(!0),f.getUser({id:b}).then(function(b){return d=b,d.acceptSpotInvitation(a.spotId)}).then(function(){return d}).catch(function(){return a._setHandled(!1),c.reject()})},decline:function(){var a=this,b=this.inviter.id,d=null;return this._setHandled(!0),f.getUser({id:b}).then(function(b){return d=b,d.declineSpotInvitation(a.spotId)}).then(function(){return d}).catch(function(){return a._setHandled(!1),c.reject()})}});return g}]),angular.module("spot.im.core").factory("invitations",["AlertsList","utils","$q","Invitation","UserResource",function(a,b,c,d,e){var f="invitations",g=new a;return angular.extend(g,{initialize:function(){var a=this;this.unviewedCount=0,e.get_my_invitations(null,function(b){b.isSuccess&&a.parse(b.invitations,b.unread_invitations_count)})},_createItem:function(a,b){return new d(f,a,b)},_canTranslate:function(a,b){var c=f+"."+a.type,d=b.getTemplate(c,a.count,a.target_user_id,a.domain);return null!==d},_triggerAlert:function(a){this.trigger("invitations:Alert",a)},markAllRead:function(){{var a=c.defer(),b=this;_.pluck(this.list,"id")}return e.mark_invitations_read({},a.resolve,function(){b.clearUnviewedCounter(),a.reject()}),a.promise},clearUnviewedCounter:function(){a.prototype.clearUnviewedCounter.call(this)}}),g}]),angular.module("spot.im.core").factory("Message",["$q","$sce","$injector","underscore","translations","SessionUser","BaseModel","MessageResource","MessageEntity","MessageEntityTypes","$filter","entityStateResolver","stateProviderBridge",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=["selfie","sticker","photo","location","video","audio","embed"],o=g.extend({initialize:function(){this.entities=[],this.liked=!1,this.likes=0,this.show_in_history=!1,this.deleted_by=null,this.reply_to=null},parse:function(a){if(this.entities.length=0,a.entities){var b=this;a.entities.forEach(function(a){var c=new i(a,{parse:!0});b.addEntity(c)}),delete a.entities}g.prototype.parse.apply(this,arguments)},markLiked:function(){this.liked||(this.liked=!0)},markUnliked:function(){this.liked&&(this.liked=!1)},setLikes:function(a){this.likes=a},isLiked:function(){return this.liked},getCoreState:function(){return l.resolveState("message",null,{id:this.id})},getMessageState:function(){var a=this.getCoreState();return m.mapState(a.stateName,a.stateParams)},getSenderCoreState:function(){return l.resolveState("user",null,{name:this.username})},getSenderState:function(){var a=this.getSenderCoreState();return m.mapState(a.stateName,a.stateParams)},getSenderImageUrl:function(a){var b=c.get("UsersManager"),d=b._findByUserId(this.sender_id);return d&&d.getUserImageUrl(a)},markAsSent:function(){this._isSent=!0},isSent:function(){return this._isSent},isDeleted:function(){return null!==this.deleted_by},isMine:function(){return f.isRegistered?this.get("sender_id")===f.getUser().get("id"):!1},getEmbed:function(){return this.entities&&0!=this.entities.length?d.findWhere(this.entities,{type:"embed"}):null},getText:function(){var a=this.text;if(!a||0===a.length){var b=this.getFirstMediaEntity();if(b){var c=b.getType();switch(c){case j.USER_MENTION:a="(mentioned a user)";break;case j.SPOT_MENTION:a="(mentioned a spot)";break;case j.PHOTO:a="(posted a photo)";break;case j.SELFIE:a="(posted a selfie)";break;case j.LOCATION:a="(posted a location)";break;case j.AUDIO:a="(posted an audio)";break;case j.VIDEO:a="(posted a video)";break;case j.LINK:a="(posted a link)";break;case j.RICH:a="(posted something new)"}}}return a},hasEntities:function(){var a=!1;return this.entities.forEach(function(b){n.indexOf(b.type)>-1&&(a=!0)}),a},getFirstMediaEntity:function(){return d.chain(this.entities).filter(function(a){return n.indexOf(a.type)>-1}).first().value()},getMessageType:function(){var a="text",b=this.getFirstMediaEntity();return b&&(a=b.getType().toLowerCase()),a},deleteMessage:function(){o.deleteMessage(this.get("id"))},getImageUrl:function(a){var b=this.getFirstMediaEntity();return b?b.getImageUrl(a):null},markShowInHistory:function(){this.show_in_history=!0},addEntity:function(a){a.type!==j.ERROR&&this.entities.push(a)},report:function(b){var c=a.defer();return h.report_message({id:this.get("id")},{reason:b},function(a){a.isSuccess?c.resolve():c.reject()},c.reject),c.promise},share:function(){var b=a.defer();return h.share_message({id:this.get("id")},{},function(a){a.isSuccess?b.resolve():b.reject()},b.reject),b.promise}},{getReportCategories:function(){var b=a.defer();return e.loadPromise.then(function(){var a=e.getAttribute("message.report_categories");b.resolve(a)},b.reject),b.promise},deleteMessage:function(a){return h.delete_message({id:a}).$promise}});return o}]),angular.module("spot.im.core").factory("MessageEntityTypes",[function(){var a={USER_MENTION:"USER_MENTION",SPOT_MENTION:"SPOT_MENTION",PHOTO:"PHOTO",SELFIE:"SELFIE",LOCATION:"LOCATION",AUDIO:"AUDIO",VIDEO:"VIDEO",LINK:"LINK",RICH:"RICH",STICKER:"STICKER",ERROR:"ERROR"};return a}]).factory("MessageEntity",["$q","$sce","BaseModel","CloudinaryService","utils","MessageEntityTypes","Logger",function(a,b,c,d,e,f,g){var h=g.getInstance("MessageEntity"),i=c.extend({initialize:function(){this.id=e.guid()},parse:function(a){this.set(a),"selfi"===this.type&&(this.type="selfie"),"sketch"===this.type&&(this.type="photo"),this.width=parseInt(this.width,10),this.height=parseInt(this.height,10),this.is_playable=this._isPlayable()},getImageUrl:function(a){a&&a.full_size||(a=angular.extend({width:30,height:30},a));var b=null;switch(this.type){case"photo":case"selfie":b=d.getUrl("attachments/"+this.entity_id,a);break;case"location":b=this.getLocationImageUrl(a);break;case"embed":b=this.image_id?d.getUrl(this.image_id,a):"photo"==this.subtype?this.url:this.thumbnail_url,b&&(b=e.applyProtocol(b))}return b},getMediaSize:function(a,b){var c=this.getMediaWidth(),d=this.getMediaHeight(),f=e.calculateImageSize(c,d,a,b);return h.debug("getMediaSize","srcWidth={0}, srcHeight={1}, maxWidth={2}, maxHeight={3}, width = {4}, height = {5}",[c,d,a,b,f.width,f.height]),f},getMediaHeight:function(){return this.thumbnail_height||this.height},getMediaWidth:function(){return this.thumbnail_width||this.width},_isPlayable:function(){return["video","audio"].indexOf(this.type)>-1||"embed"==this.type&&["video","rich"].indexOf(this.subtype)>-1},getLocationImageUrl:function(a){if("location"!==this.type)return"";var a=["center="+this.getLocationFullAddress(),"zoom=16","size="+Math.floor(a.width)+"x"+Math.floor(a.height),"markers=color:blue|"+this.getLocationFullAddress(),"sensor=false"];return"//maps.googleapis.com/maps/api/staticmap?"+a.join("&")},getLocationIcon:function(a){if(!this.provider||!this.provider.name)return"";switch(this.provider.name){case"foursquare":return this.provider.icon.prefix+a+this.provider.icon.suffix}},getLocationProviderUrl:function(){if(!this.provider||!this.provider.name)return"";switch(this.provider.name){case"foursquare":return this.provider.page_url}},getAudioFileUrl:function(){return"audio"!==this.type?"":d.getAssetUrl("attachments/"+this.entity_id)},getLocationFullAddress:function(){return this.address+","+this.city+","+this.country},getType:function(){var a=null;switch(this.type){case"embed":switch(this.subtype){case"video":a=f.VIDEO;break;case"photo":a=f.PHOTO;break;case"link":a=f.LINK;break;case"rich":a=f.RICH;break;default:a=f.ERROR}break;case"user":a=f.USER_MENTION;break;case"spot":a=f.SPOT_MENTION;break;case"photo":a=f.PHOTO;break;case"selfie":a=f.SELFIE;break;case"location":a=f.LOCATION;break;case"audio":a=f.AUDIO;break;case"video":a=f.VIDEO;break;case"sticker":a=f.STICKER;break;default:a=f.ERROR}return a}});return i}]),angular.module("spot.im.core").factory("Notification",["AlertItem","utils","$q","UserResource",function(a,b,c,d){var e=b.extend(a,{initialize:function(a,b,c){var d=a+"."+b.type;this.parse(d,b,c)},_setRead:function(a){this.unread=!a},isUnread:function(){return this.unread},markRead:function(){var a=c.defer(),b=this;return d.mark_notifications_read({notifications_ids:this.id},null,a.resolve,function(){b._setRead(!1),a.reject()}),this._setRead(!0),a.promise}});return e}]),angular.module("spot.im.core").factory("notifications",["AlertsList","utils","$q","Logger","Notification","UserResource",function(a,b,c,d,e,f){var g=d.getInstance("notifications"),h="notifications",i=new a;return angular.extend(i,{initialize:function(){var a=this;this.unviewedCount=0,g.debug("initialize","Load notifications"),f.get_my_notifications(null,function(b){b.isSuccess&&(g.debug("initialize","Parse notifications"),a.parse(b.notifications,b.unread_notifications_count))})},_createItem:function(a,b){return new e(h,a,b)},_canTranslate:function(a,b){var c=h+"."+a.type,d=b.getTemplate(c,a.count,a.target_user_id,a.domain);return null!==d},_triggerAlert:function(a){this.trigger("notifications:Alert",a)},_setAllRead:function(a){this.list.forEach(function(b){b._setRead(a)}),this.clearUnviewedCounter()},hasUnread:function(){return this.list.some(function(a){return a.isUnread()})},markAllRead:function(){var a=c.defer(),b=this,d=_.pluck(this.list,"id");return f.mark_notifications_read({notifications_ids:d.join(",")},a.resolve,function(){b._setAllRead(!1),a.reject()}),this._setAllRead(!0),a.promise},clearUnviewedCounter:function(){this.unviewedCount>0&&(f.mark_notifications_read(),a.prototype.clearUnviewedCounter.call(this))}}),i}]),angular.module("spot.im.core").factory("FollowUp",["BaseModel","utils",function(a,b){var c=a.extend({initialize:function(){this.id=null,this.text=null,this.userId=null},parse:function(a){var c={id:"id",userId:"user_id",text:"text"};b.copyAttributes(this,a,c)}});return c}]),angular.module("spot.im.core").factory("PopularLink",["BaseModel","FollowUp","PopularLinksResource","CloudinaryService","utils",function(a,b,c,d,e){var f=a.extend({initialize:function(a){this.spotId=a.spotId,this.firstFollowUp=null,this.followUps=[],this.likersIds=[]},parse:function(a){var c={description:"description",title:"title",imageId:"image_id",likersIds:"likers_ids",totalFollowers:"total_followers",totalFollowUps:"total_follow_ups",totalLikes:"total_likes",url:"url"};e.copyAttributes(this,a,c),"first_follow_up"in a&&(this.firstFollowUp=new b(a.first_follow_up,{parse:!0})),"follow_ups"in a&&this._addFollowUps(a.follow_ups)},_addFollowUp:function(a){var c=null;return a&&(c=new b(a,{parse:!0}),this.followUps.push(c)),c},_addFollowUps:function(a){var b=this,c=[];return a&&a.length>0&&a.forEach(function(a){var d=b._addFollowUp(a);c.push(d)}),c},hasFirstFollowUp:function(){return!!this.firstFollowUp},hasFollowUps:function(){return this.followUps.length>0},hasLikes:function(){return 0===this.totalLikes},getImageUrl:function(a){return d.getUrl(this.imageId,a)},like:function(){var a=this;return c.like({spotId:this.spotId},{url:this.url}).$promise.then(function(b){b=b&&b.response,b&&(b.likers&&[].push.apply(a.likersIds,b.likers),a.totalLikes=b.total_likes,a.totalFollowUps=b.total_follow_ups,a.totalFollowers=b.total_followers)})},sendFollowUp:function(a){var b=this;return c.send_follow_up({spotId:this.spotId},{url:this.url,text:a}).$promise.then(function(a){if(a=a&&a.response){var c=a.follow_ups&&a.follow_ups.length>0&&a.follow_ups[0];if(c){var d=b._addFollowUp(c);b.firstFollowUp||(b.firstFollowUp=d)}b.totalLikes=a.total_likes,b.totalFollowUps=a.total_follow_ups,b.totalFollowers=a.total_followers}})}});return f}]),angular.module("spot.im.core").factory("PopularLinksCollection",["PopularLink","PopularLinksResource","$q",function(a,b,c){var d=function(a){this.spotId=a,this.lastUpdate=null,this.links=[],this.isLoading=!1};return d.prototype={fetch:function(c){var d=this;return c=angular.extend({},c,{spotId:this.spotId}),this.isLoading=!0,b.get(c).$promise.then(function(b){b=b&&b.response;var c=b&&b.links,e=b&&b.last_update;return c=(c||[]).map(function(b){return new a(angular.extend(b,{spotId:d.spotId}),{parse:!0})}),[].push.apply(d.links,c),d.lastUpdate||(d.lastUpdate=e),d.isLoading=!1,c})},hasLinks:function(){return this.links.length>0},reset:function(){this.links.length=0,this.lastUpdate=null},getFetcher:function(a){a||(a=10);var b=0,d=!1,e=!1,f=this;return function(g,h){if(d||e)return c.when([]);e=!0,h===!0&&(b=0,f.reset());var i=g||a,j={page_size:i};return b&&(j.start_index=b),f.fetch(j).then(function(a){return d=a.length<i,e=!1,b+=a.length,a})}},getPopularLinksBlockedUrls:function(){return b.get_blocked_list({spotId:this.spotId}).$promise},updatePopularLinksBlockedUrls:function(a,c){return b.update_blocked_list({spotId:this.spotId},{block_urls:a,unblock_urls:c}).$promise}},d}]),angular.module("spot.im.core").factory("SessionUser",["$q","$injector","Logger","$rootScope","$http","Events","facebookService","UserResource","deviceManager","appStage","trackerVent","analyticsId",function(a,b,c,d,e,f,g,h,i,j,k,l){var m=c.getInstance("SessionUser"),n=3e4,o=a.defer(),p={sessionHeader:"x-spot-im-session",isInitialized:!1,initialConnectionPromise:o.promise,initialize:function(){var a=this;this.on("login_complete",function(){d.$evalAsync(function(){o.resolve(a.getUser()),j.setStage("authenticated")})}),this.on("login_failed",function(){d.$evalAsync(function(){o.resolve(null),j.setStage("authenticated")})}),i.hasDevice()?(this.currentDevice=i.getDevice(),this.apiLoginWithCurrentDevice()):a.trigger("login_failed"),this.isInitialized=!0},isReady:function(){return"pending"!=this.initialConnectionPromise.state},canLogin:function(){return i.hasDevice()},resetSession:function(){this.sessionId="public",e.defaults.headers.common[this.sessionHeader]=this.sessionId,this.socialIdentities={},this.isRegistered=!1,this.isExiled=!1,this.user=null,this.channelName=null,this.trigger("logout_complete")},_setSession:function(a,c,d,f){this.sessionId=a||"PUPZIK",e.defaults.headers.common[this.sessionHeader]=this.sessionId,this.socialIdentities=d,this.isRegistered=!0,this.channelName=f;var g=b.get("UsersManager");this.user=g._findByUserId(c),this.trigger("login_complete")},_apiLogin:function(b){var c=this,d=a.defer(),e=function(a){if(0!==a.status&&a.data&&a.data.meta&&a.data.meta.code){var e=a.data.meta.code;e>=400&&500>e&&k.trigger("Device Remove",a.data.meta.error_details)}var f=a.data&&a.data.meta&&a.data.meta.error_details;k.trigger("Login Failed",b.device.id,f,a.data),d.reject(f),m.debug("_apiLogin","Login failed"),c.trigger("login_failed")};return h.login(b,function(a){a=a.response,k.trigger("Login Success",a.user_id),c._setSession(a.session_id,a.user_id,a.social_identities,a.channel_name),m.debug("_apiLogin","Login success"),d.resolve(a)},e),d.promise},apiLoginWithCurrentDevice:function(){var a=this.currentDevice,b={device:{password:a.password,id:a.id}};
m.debug("apiLoginWithCurrentDevice","Login with current device {0}",[b.device.id]);var c=this._apiLogin(b);return c},apiLoginWithNewDevice:function(a){return i.storeDevice(a),this.currentDevice=a,m.debug("apiLoginWithNewDevice","Login with new device {0}",[a.id]),this._apiLogin({device:a})},apiUserRegister:function(c,d,e,f){var g=a.defer(),j=this,n=angular.extend({userId:null,username:null,displayName:null},f);this.currentDevice=i.generateDevice();var o={device:{id:this.currentDevice.id,type:this.currentDevice.type,password:this.currentDevice.password,analytics_id:l.get()},user:{social_type:c,social_id:d,social_token:e,display_name:n.displayName,locale:b.get("localeManager").getLocale()}};return m.debug("apiUserRegister","Register user with device {0}",[o.device.id]),n.userId&&(o.user.id=n.userId),n.username&&(o.user.username=n.username),h.register(o,function(a){k.trigger("Device Register Success",j.currentDevice.id),a=a.response,j._setSession(a.session_id,a.user_id,a.social_identities,a.channel_name),m.debug("apiUserRegister","Registration success"),i.storeDevice(j.currentDevice),g.resolve()},function(a){var b=a&&a.meta&&a.meta.error_details;k.trigger("Device Register Failed",j.currentDevice.id,b),j.isRegistered=!1,m.debug("apiUserRegister","Registration failed"),j.trigger("login_failed"),g.reject(b)}),g.promise},deleteAccount:function(){var b=this,c=a.defer();return h.delete_my_account(null,function(){k.trigger("Delete Account Success"),b.afterLogout(),c.resolve()},function(){k.trigger("Delete Account Failure"),c.reject()}),c.promise},logout:function(){var b=this,c=a.defer();return h.logout({device_ids:i.getDevice().id},function(){b.afterLogout(),c.resolve()},function(){k.trigger("Logout Failure"),c.reject()}),c.promise},afterLogout:function(){this.resetSession(),i.removeDevice(),k.trigger("Logout Success")},subscribeLoginChange:function(a,b){function c(){d.isRegistered!==e&&(e=d.isRegistered,a.apply(b,[d.isRegistered,d.getUser()]))}a.apply(b,[this.isRegistered,this.getUser()]);var d=this,e=this.isRegistered;this.on("login_complete",c,b),this.on("logout_complete",c,b)},unsubscribeLoginChange:function(a){this.off(null,null,a)},reserveUsername:function(b,c){var d=a.defer(),e={user_id:c,username:b,interval:n};return h.reserve_username(e,function(a){a=a.response;var e={user_id:a&&a.user_id||c,username:b};d.resolve(e)},function(a){d.reject(a.data.meta)}),d.promise},markAsExiled:function(){this.isExiled=!0,this.trigger("user-exiled")},getUser:function(){return this.user},getSocialToken:function(a){return this.isRegistered&&this.socialIdentities&&this.socialIdentities[a]&&this.socialIdentities[a].social_token}};angular.extend(p,f),p.resetSession(),p.subscribeLoginChange(function(){m.debug("subscribeLoginChange","User is {0}",[p.isRegistered?"registered":"not registered"])});var q=null;return p.subscribeLoginChange(function(){if(null!==q&&(q.unsubscribe(),q=null),p.isRegistered){var a=b.get("UserEvents");q=new a(p.getUser(),p.channelName)}}),p}]),angular.module("spot.im.core").factory("IntimateSpot",["$injector","$q","Spot","UsersManager","entityStateResolver",function(a,b,c,d,e){var f=c.extend({initialize:function(){c.prototype.initialize.apply(this,arguments),this.other_party=null},parse:function(a){a.other_party&&(this.other_party_id=a.other_party,delete a.other_party),c.prototype.parse.apply(this,arguments)},resolveDependencies:function(){var a=c.prototype.resolveDependencies.apply(this,arguments),e=b.when(),f=this;return this.other_party_id&&(e=d.getUser({id:this.other_party_id}).then(function(a){f.other_party=a,f.name=a.isZombie()?"Zombie":a.display_name})),b.all([a,e])},getSpotImageUrl:function(a){return c.prototype.getSpotImageUrl.call(this,a)},getOtherPartyImageUrl:function(a){return this.other_party?this.other_party.getUserImageUrl(a):this.getSpotImageUrl(a)},getCoreState:function(){return e.resolveState("spot","intimate",{id:this.id})},getSpotTypeLabel:function(){return"Direct"},joinSpot:function(){var a=this;return c.prototype.joinSpot.apply(this,arguments).then(function(){return a.resolveDependencies()})}});return f}]),angular.module("spot.im.core").factory("OnlineMembersBase",["$q","$window","SessionUser","SpotResource","UsersManager","Events","Logger","pusherEvents",function(a,b,c,d,e,f){function g(b){this.spot=b,this.pool={},this.orderedList=[],this.totalCount=b.online_members_count,this._readyDeferred=a.defer(),this.readyPromise=this._readyDeferred.promise}return g.prototype={_onSpotEvent:function(a){if(a){var b=this;e.getUser({id:a}).then(function(a){b.pool[a.id]=a;var c=b.orderedList.indexOf(a);c>0&&b.orderedList.splice(c,1),0!==c&&b.orderedList.splice(0,0,a),b.trigger("list-update",b.orderedList)})}},_updateMembersState:function(b,c){this.totalCount=c,this.pool={};var d=[],f=this,g=[];b.forEach(function(a){var b=e.getUser({id:a}).then(function(a){f.pool[a.id]=a});g.push(b),d.push(a)}),this.spot.addMembers(b),a.all(g).then(function(){f.orderedList.length=0,d.forEach(function(a){f.pool[a]&&f.orderedList.push(f.pool[a])}),f.trigger("list-update",f.orderedList)})},_startListen:function(){},_stopListen:function(){},isOnline:function(a){return!!this.pool[a]},destroy:function(){this.trigger("destroy")}},angular.extend(g.prototype,f),g}]),angular.module("spot.im.core").factory("OnlineMembersIntimateSpot",["OnlineMembersBase","$q","$window","SessionUser","SpotResource","UsersManager","Events","Logger","pusherEvents","pusherService","utils",function(a,b,c,d,e,f,g,h,i,j,k){var l=k.extend(a,{_handleMembersChange:function(){var a=this;j.getChannel(this.spot.channel_name).then(function(b){var c=b.members,d=c.count,e=[];c.each(function(a){e.push(a.id)}),a._updateMembersState(e,d)})},_startListen:function(){var a=this;this._handleMembersChange(),i.on(this.spot.channel_name,"pusher:subscription_succeeded",function(){a._handleMembersChange()}),i.on(this.spot.channel_name,"pusher:member_added",function(){a._handleMembersChange()}),i.on(this.spot.channel_name,"pusher:member_removed",function(){a._handleMembersChange()})},_stopListen:function(){}});return l}]),angular.module("spot.im.core").factory("OnlineMembersPublicSpot",["OnlineMembersBase","$q","$window","SessionUser","SpotResource","UsersManager","Events","Logger","pusherEvents","utils",function(a,b,c,d,e,f,g,h,i,j){var k=2e4,l=6e4,m=j.extend(a,{initialize:function(){this.timeoutId=0},_fetchOnlineMembers:function(){var a=this,b={id:this.spot.id};e.online_members(b).$promise.then(function(b){var c=b.response.total_count,d=(b.users||[]).map(function(a){return a.id});a._updateMembersState(d,c),a._readyDeferred.resolve()}).finally(function(){var b=d.isRegistered?k:l;a.timeoutId=c.setTimeout(a._fetchOnlineMembers.bind(a),b)})},_startListen:function(){this._fetchOnlineMembers();var a=this;i.on(this.spot.channel_name,"message",function(b){a._onSpotEvent(b.sender_id)}),i.on(this.spot.channel_name,"message_liked",function(b){a._onSpotEvent(b.liked_by.id)}),i.on(this.spot.channel_name,"user_typing",function(b){a._onSpotEvent(b.typer.id)})},_stopListen:function(){this.timeoutId&&c.clearInterval(this.timeoutId)}});return m}]),angular.module("spot.im.core").factory("OnlineMembers",["OnlineMembersPublicSpot","OnlineMembersIntimateSpot",function(a,b){function c(a){var b=f[a.id];return b||(b=d(a)),b.refCount++,b.instance}function d(c){var d=null;switch(c.type){case"intimate":d=new b(c);break;case"public":d=new a(c)}var g=f[c.id]={instance:d,refCount:0};return g.instance._startListen(),g.instance.on("destroy",function(){e(g)}),g}function e(a){a.refCount--,0===a.refCount&&(a.instance._stopListen(),a.instance.off(),delete f[a.instance.spot.id])}var f={};return{get:c}}]),angular.module("spot.im.core").factory("PrivateSpot",["Spot",function(a){var b=a.extend({getSpotUrl:function(){return"/private/"+this.get("id")},getSpotTypeLabel:function(){return"Private"}});return b}]),angular.module("spot.im.core").factory("PublicSpot",["Spot","entityStateResolver",function(a,b){var c=a.extend({getEncodedName:function(){return(this.url||"").split("/").pop()},getCoreState:function(){return b.resolveState("spot","public",{name:this.getEncodedName()})},getSpotTypeLabel:function(){return"Public"}});return c}]),angular.module("spot.im.core").factory("spotEvents",["$q","$injector","utils","pusherEvents","SessionUser","Logger","pusherService","entitiesInterceptor",function(a,b,c,d,e,f,g,h){function i(a){var b=n[a.id];return b||(b=j(a)),b.refCount++,b.instance}function j(a){var b=n[a.id]={instance:new m(a),refCount:0};return b}function k(a){var b=n[a.id];b&&(b.refCount--,0===b.refCount&&(b.instance.unsubscribe(),delete n[b.instance.spot.id]))}var l=f.getInstance("spotEvents"),m=function(a){this.spot=a,this.channelName=this.spot.channel_name,d.subscribe(this.channelName),l.debug("Spot {0} with channelName={1}",[this.spot.name,this.channelName]),d.on(this.channelName,"message_liked",this.handleLiked.bind(this)),d.on(this.channelName,"message_unliked",this.handleUnliked.bind(this)),d.on(this.channelName,"message_pinned",this.handlePin.bind(this)),d.on(this.channelName,"message_unpinned",this.handleUnpin.bind(this)),d.on(this.channelName,"message_deleted",this.handleMessageDeleted.bind(this)),d.on(this.channelName,"message",this.handleMessage.bind(this)),d.on(this.channelName,"host_added",this.handleHostAdded.bind(this)),d.on(this.channelName,"host_removed",this.handleHostRemoved.bind(this)),d.on(this.channelName,"member_parted",this.handlePart.bind(this)),d.on(this.channelName,"spot_new_member",this.handleJoin.bind(this)),d.on(this.channelName,"spot_deleted",this.handleSpotDeleted.bind(this))};m.prototype={isCurrentSpot:function(a){return a===this.spot.id},isCurrentUser:function(a){return e.isRegistered&&e.getUser().id===a},unsubscribe:function(){l.debug("unsubscribe","Spot {0} with channelName={1}",[this.spot.name,this.channelName]),d.unsubscribe(this.channelName)},handleLiked:function(a){if(this.isCurrentSpot(a.spot.id)){var c=a.liked_by.id,d=this.isCurrentUser(c),e=a.message.id,f=a.count,g=b.get("MessagesManager"),h=g._findByMessageId(e);h&&(h.setLikes(f),d&&h.markLiked())}},handleUnliked:function(a){if(this.isCurrentSpot(a.spot.id)){var c=a.unliked_by.id,d=this.isCurrentUser(c),e=a.message.id,f=a.count,g=b.get("MessagesManager"),h=g._findByMessageId(e);h&&(h.setLikes(f),d&&h.markUnliked())}},handlePin:function(a){if(this.isCurrentSpot(a.spot.id)){var b=(a.pinned_by.id,a.message.id);this.spot.applyPinnedMessage(b)}},handleUnpin:function(a){if(this.isCurrentSpot(a.spot.id)){var b=a.message.id;this.spot.applyUnpinnedMessage(b)}},handleMessageDeleted:function(a){if(this.isCurrentSpot(a.spot.id)){var b=a.message.id;this.spot.removeMessage(b)}},handleMessage:function(a){var b=a.messages&&a.messages[0];if(b&&this.isCurrentSpot(b.spot_id)){var c=(b.sender_id,b.id);h.interceptEntities(a),this.spot.addMessages([c]).then(function(a){a[0].markShowInHistory()})}},handleHostAdded:function(a){if(this.isCurrentSpot(a.spot.id)){var b=a.new_host.id;this.spot.applyAddHost(b)}},handleHostRemoved:function(a){if(this.isCurrentSpot(a.spot.id)){var b=a.removed_host.id;this.spot.applyRemoveHost(b)}},handlePart:function(a){if(this.isCurrentSpot(a.spot.id)){var b=a.parted_user.id;this.spot.members_count--,this.isCurrentUser(b)?this.spot.trigger("destroy"):this.spot.removeMember(b)}},handleJoin:function(a){if(this.isCurrentSpot(a.spot.id)){var b=a.user.id;this.spot.members_count++,this.isCurrentUser(b)||this.spot.addMembers([b])}},handleSpotDeleted:function(a){this.isCurrentSpot(a.spot.id)&&this.spot.trigger("destroy")}};var n={};return{start:i,stop:k}}]),angular.module("spot.im.core").factory("Spot",["$q","$rootScope","$injector","underscore","BaseModel","SpotResource","PopularLinksResource","SessionUser","Message","spotCategories","stateProviderBridge","MessagesManager","PopularLink","UsersManager","CloudinaryService","utils","Events","trackerVent",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=e.extend({getSpotTypeLabel:function(){throw"Spot::getSpotTypeLabel is abstract method."},getCoreState:function(){throw"Spot::getCoreState is abstract method."},getSpotUrlState:function(){var a=this.getCoreState();return k.mapState(a.stateName,a.stateParams)},getSpotUrl:function(){var a=this.getCoreState();return k.href(a.stateName,a.stateParams)},initialize:function(){this.members_ids=[],this.members=[],this.hosts_ids=[],this.hosts=[],this.online_ids=[],this.kicked_members_ids=[],this.kicked_members=[],this.messages_ids=[],this.messages=[],this.pinned_message_id=null,this.pinned_message=null,this.members_count=0,this.popular_links_count=0,this._oldestTimestamp=0;var a=this;this.once("destroy",function(){this.status=null,h.unsubscribeLoginChange(a)}),h.subscribeLoginChange(function(b){b||(a.status=null)},a)},parse:function(a){a.messages&&(d.addToSet(this.messages_ids,a.messages),delete a.messages),a.hosts&&(d.addToSet(this.hosts_ids,a.hosts),delete a.hosts),a.members_preview&&(d.addToSet(this.members_ids,a.members_preview),delete a.members_preview),a.kicked_members&&(d.addToSet(this.kicked_members_ids,a.kicked_members),delete a.kicked_members),e.prototype.parse.apply(this,arguments)},resolveDependencies:function(){var b=this,c=this.addMessages(this.messages_ids),e=this.addMembers(this.hosts_ids).then(function(){d.addToSet(b.hosts,d.filter(b.members,function(a){return b.isHost(a.id)}))}),f=this.addMembers(this.members_ids),g=this.pinned_message_id?this.applyPinnedMessage(this.pinned_message_id):a.when(!0);return a.all([c,e,f,g])},isCreated:function(){return!!this.get("id")},isSameSpot:function(a){if(!a)return!1;var b=!1;return a.id?b=this.id===a.id:a.name&&a.type&&(b=this.unique_name===a.name&&this.type===a.type),b},isActiveChat:function(){return this.isCreated()},isInvitation:function(){return"invitation"==this.get("status")},isJoined:function(){return"mine"===this.get("status")},isCurrentKicked:function(){return"kicked"===this.get("status")},isHost:function(a){return d.contains(this.hosts_ids,a)},isKickedUser:function(a){return d.contains(this.kicked_members_ids,a)},isHostedByMe:function(){return h.isRegistered?this.isHost(h.getUser().get("id")):!1},getSpotImageUrl:function(a){return o.getUrl(this.cover_image,a)},getSpotIconUrl:function(a){return o.getUrl(this.spot_icon,a)},hasSpotThumbnail:function(){return!(!this.spot_icon&&!this.cover_image)},getSpotThumbnailUrl:function(a){var b=this.spot_icon||this.cover_image;return o.getUrl(b,a)},getSpotHashtags:function(){return(this.get("description")||"").match(/#([A-Za-z0-9]+)/g)},getHosts:function(){return n.getUsersByIds(this.hosts_ids)},getLatestMessage:function(){for(var a,b=0,c=null,d=this.messages.length-1;d>=0;d--)a=this.messages[d].timestamp,a>b&&(b=a,c=this.messages[d]);return c},addMessages:function(c){var e=this,f=a.defer();return l.getMessagesByIds(c).then(function(a){b.$safeApply(function(){var b=Math.max.apply(Math,d.pluck(a,"timestamp"));e._oldestTimestamp<b&&(e._oldestTimestamp=b),d.addToSet(e.messages_ids,c),d.addToSet(e.messages,a);for(var g=0;g<a.length;g++)a[g].timestamp>e.last_activity_date&&(e.last_activity_date=a[g].timestamp);f.resolve(a)})},f.reject),f.promise},hasMessages:function(){return this.messages_ids.length>0},removeAllMessages:function(){this.messages_ids.length=0,this.messages.length=0},removeAllMembers:function(){this.members_ids.length=0,this.members.length=0},removeMessage:function(a){d.removeObjFromArray(this.messages_ids,function(b){return b===a}),d.removeObjFromArray(this.messages,function(b){return b.id===a})},addMembers:function(b){var e=this,f=a.defer(),g=c.get("UsersManager");return g.getUsersByIds(b).then(function(a){d.addToSet(e.members_ids,b),d.addToSet(e.members,a),f.resolve(a)},f.reject),f.promise},removeMember:function(a){d.removeObjFromArray(this.members_ids,function(b){return b===a}),d.removeObjFromArray(this.members,function(b){return b.id===a})},getMemebrsCount:function(){return this.members.length},loadSpotMessages:function(b){var c=a.defer(),d=this;return b=b||{},b.id=this.get("id"),f.get_messages(b,function(a){var b=a.messages.map(function(a){return a.id});d.addMessages(b).then(function(b){c.resolve({messages:b,totalCount:a.response.total_count})})},c.reject),c.promise},loadSpotMembers:function(b){var c=a.defer(),d=this;return b=b||{},b.id=this.get("id"),f.get_members(b,function(a){if(a.isSuccess){var b=a.users.map(function(a){return a.id});d.addMembers(b).then(function(a){c.resolve(a)})}else c.reject()},c.reject),c.promise},loadKickedMembers:function(){var b=a.defer(),e=this,f=c.get("UsersManager");return f.getUsersByIds(this.kicked_members_ids).then(function(a){d.addToSet(e.kicked_members,a),b.resolve(a)},b.reject),b.promise},applyKickedUser:function(a){var b=d.find(this.members,function(b){return b.id===a});this.removeMember(a),d.addToSet(this.kicked_members_ids,[a]),d.addToSet(this.kicked_members,[b])},applyUnkickedUser:function(a){this.addMembers([a]),d.removeObjFromArray(this.kicked_members_ids,function(b){return b===a}),d.removeObjFromArray(this.kicked_members,function(b){return b.id===a})},kickUser:function(b){var c=a.defer();f.kick({id:this.get("id"),entityId:b},null,function(a){a.isSuccess?c.resolve():c.reject()},c.reject),this.applyKickedUser(b);var d=this;return c.promise.then(null,function(){d.applyUnkickedUser(b)}),c.promise},unkickUser:function(b){var c=a.defer();f.unkick({id:this.get("id"),entityId:b},null,function(a){a.isSuccess?c.resolve():c.reject()},c.reject),this.applyUnkickedUser(b);var d=this;return c.promise.then(null,function(){d.applyKickedUser(b)}),c.promise},applyAddHost:function(a){d.addToSet(this.hosts_ids,[a]);var b=this;this.addMembers([a]).then(function(){d.addToSet(b.hosts,d.filter(b.members,function(b){return b.id==a}))})},applyRemoveHost:function(a){d.removeObjFromArray(this.hosts_ids,function(b){return b===a}),d.removeObjFromArray(this.hosts,function(b){return b.id===a})},addHost:function(b){var c=a.defer();f.add_cohost({id:this.get("id"),entityId:b},null,function(a){a.isSuccess?c.resolve():c.reject()},c.reject),this.applyAddHost(b);var d=this;return c.promise.then(null,function(){d.applyRemoveHost(b)}),c.promise},removeHost:function(b){var c=a.defer();f.remove_cohost({id:this.get("id"),entityId:b},null,function(a){a.isSuccess?c.resolve():c.reject()},c.reject),this.applyRemoveHost(b);var d=this;return c.promise.then(null,function(){d.applyAddHost(b)}),c.promise},joinSpot:function(){var b=a.defer();if(this.isJoined())b.resolve();else{f.join({id:this.get("id")},null,function(a){a.isSuccess?b.resolve():b.reject()},b.reject);var c=this,d=h.getUser().id;this.addMembers([d]),b.promise.then(null,function(){c.removeMember(d)}),b.promise.then(function(){r.trigger("Spot Joined",c.type,c.id,c.name)})}return b.promise},partSpot:function(){var b=a.defer(),c=this;f.part({id:this.get("id")},null,function(){c.trigger("destroy"),h.getUser().applyPartedSpot(c.id),b.resolve()},b.reject);var c=this,d=h.getUser().id;return this.removeMember(d),b.promise.then(null,function(){c.addMembers([d])}),b.promise.then(function(){r.trigger("Spot Parted",c.type,c.id,c.name)}),b.promise},postMessage:function(b,c){var d=h.getUser(),e=b.text,g=b.entities;if((!e||0===e.length)&&0==g.length)return null;var j=p.guid(),k=a.defer(),m={text:e,entities:g,id:j};c&&(m.reply_to=c),f.post_message({id:this.id},{message:m},function(a){a.isSuccess?k.resolve():k.reject()},k.reject);var b=new i({text:e,entities:g,id:j,reply_to:c,timestamp:Math.max(this._oldestTimestamp,p.currentUnixTimestamp()),sender_id:d.id,display_name:d.display_name,username:d.username,promise:k.promise,likes:0,liked:!1,reported:!1,spot_id:this.id},{parse:!0}),n=this;return k.promise.then(function(){r.trigger("Spot Message Sent",n.id,n.type,n.name,b.getMessageType(),g,n.isHost(d.id),n.category_id,b.text.length)}),b.markAsSent(),b.markShowInHistory(),l.setMessage(b),this.addMessages([b.id]),b},pinMessage:function(b){var c=a.defer();return f.pin_message({id:this.id,entityId:b},null,function(a){a.isSuccess?c.resolve():c.reject()},c.reject),this.applyPinnedMessage(b),c.promise},unpinMessage:function(b){var c=a.defer();return f.unpin_message({id:this.id,entityId:b},null,function(a){a.isSuccess?c.resolve():c.reject()},c.reject),this.applyUnpinnedMessage(b),c.promise},applyPinnedMessage:function(a){var b=this,c=this.addMessages([a]);return c.then(function(c){c[0].deleted_by||(b.pinned_message_id=a,b.pinned_message=c[0])}),c},applyUnpinnedMessage:function(a){this.pinned_message_id===a&&(this.pinned_message_id=null,this.pinned_message=null)},deleteMessage:function(b){var c=a.defer();return this.pinned_message_id==b&&this.applyUnpinnedMessage(b),f.delete_message({id:this.id,entityId:b},null,function(a){a.isSuccess?c.resolve():c.reject()},c.reject),c.promise},getLatestMessage:function(){return d.max(this.messages,function(a){return a.timestamp})},inviteFriends:function(b){var c=a.defer(),e=d.map(b,function(a){return{type:"fb",id:a}});return f.invite({id:this.get("id")},{invitees:e},function(a){a.isSuccess?c.resolve():c.reject()},c.reject),c.promise},updateMute:function(b){var c=a.defer();this.is_muted!==b?f.update({id:this.get("id")},{is_muted:b},function(a){a.isSuccess?c.resolve():c.reject()},c.reject):c.resolve(),this.is_muted=b;var d=this;return c.promise.then(null,function(){d.is_muted=!b}),c.promise},report:function(b){var c=a.defer();return f.report_spot({id:this.get("id")},{reason:b},function(a){a.isSuccess?c.resolve():c.reject()},c.reject),c.promise},isGatherAllowed:function(){return!this.next_gather_time||0===this.getNextGatherTime()},getNextGatherTime:function(){var a=this.next_gather_time||0,b=(new Date).getTime()/1e3;return Math.max(a-b,0)},gather:function(b){var c=a.defer();if(this.isGatherAllowed()){var d=this;f.gather({id:this.get("id")},{message:b},function(a){a.isSuccess?(d.next_gather_time=a.response.next_gather_time,c.resolve()):c.reject()},c.reject)}else c.reject();var e=this;return c.promise.then(function(){r.trigger("Spot Gather",e.id,e.name)}),c.promise},share:function(){var b=a.defer();return f.share({id:this.get("id")},{},function(a){a.isSuccess?b.resolve():b.reject()},b.reject),b.promise},likeMessage:function(b){if(this.isJoined()){var c=a.defer();b.markLiked();var d=b.likes;f.like_message({id:this.id,entityId:b.id},null,function(a){a.isSuccess?(b.setLikes(a.likes),c.resolve()):c.reject()},c.reject),c.promise.then(null,function(){b.setLikes(d)}),b.setLikes(d+1);var e=this;return c.promise.then(function(){r.trigger("Spot Message Like",e.id,e.name,b.getMessageType())}),c.promise}},unlikeMessage:function(b){if(this.isJoined()){var c=a.defer();b.markUnliked(!1);var d=b.likes;return f.unlike_message({id:this.id,entityId:b.id},null,function(a){a.isSuccess?(b.setLikes(a.likes),c.resolve()):c.reject()},c.reject),c.promise.then(null,function(){b.setLikes(d)}),b.setLikes(Math.max(d-1,0)),c.promise}},toggleLikeMessage:function(a){return a.isLiked()?this.unlikeMessage(a):this.likeMessage(a)},getSpotCategory:function(){var a=this.category_id;return j.get().then(function(b){return d.findWhere(b,{id:a})})}},{getReportCategories:function(){var b=a.defer(),d=c.get("translations");return d.loadPromise.then(function(){var a=d.getAttribute("spot.report_categories");b.resolve(a)},b.reject),b.promise},getImplementationStatuses:function(a){return f.get_implementation_status_by_id({spots_ids:a.join(",")}).$promise.then(function(b){b=b&&b.response;var c={};return a.forEach(function(a){c[a]={embedded:!!b[a].embedded,lastSeen:b[a].last_seen||!1}}),c})}});return angular.extend(s.prototype,q),s}]),angular.module("spot.im.core").factory("UserEvents",["$q","$injector","utils","pusherEvents","Logger",function(a,b,c,d,e){var f=e.getInstance("UserEvents"),g=function(a,b){this.user=a,this.channelName=b,d.subscribe(this.channelName),f.debug("User {0} with channelName={1}",[this.user.display_name,this.channelName]),d.on(this.channelName,"member_joined",this.handleJoinSpot.bind(this)),d.on(this.channelName,"user_invited",this.handleUserInvited.bind(this)),d.on(this.channelName,"intimate_user_invited",this.handleIntimateUserInvited.bind(this)),d.on(this.channelName,"invitation_accepted",this.handleInvitationAccepted.bind(this)),d.on(this.channelName,"mark_notifications_as_read",this.handleMarkNotificaitonAsRead.bind(this))};return g.prototype={unsubscribe:function(){f.debug("unsubscribe","User {0} with channelName={1}",[this.user.display_name,this.channelName]),d.unsubscribe(this.channelName)},handleJoinSpot:function(a){var b=a.spot.id;this.user.applyJoinedSpot(b)},handleUserInvited:function(){},handleIntimateUserInvited:function(a){var c=a.inviter.id,d=b.get("UsersManager");d.refetchUser(c)},handleInvitationAccepted:function(a){var c=a.spot.id,d=a.spot.spot_type,e=a.invitee.id;if("intimate"===d){var f=b.get("SpotsManager"),g=b.get("UsersManager");g.refetchUser(e),f.refetchSpot(c),this.user.applyJoinedSpot(c)}},handleMarkNotificaitonAsRead:function(){var a=b.get("notifications");a.clearUnviewedCounter()}},g}]),angular.module("spot.im.core").factory("User",["$injector","$q","stateProviderBridge","entityStateResolver","$rootScope","underscore","translations","UserResource","SessionUser","CloudinaryService","BaseModel","MessagesManager","isoLanguageCodes","isoCountryCodes","utils","trackerVent",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=k.extend({initialize:function(){this.spots_ids=[],this.spots=[],this.spot_invites_ids=[],this.messages_ids=[],this.messages=[],this.hostSpots=[],this.mutualSpots=[],this.memberSpots=[],this.intimateSpots=[],this.isOnline=!1,this.locale=null,this.total_likes=0,this.total_sent_messages=0},parse:function(a){this._spotsLoadDeferred=b.defer(),this._spotsLoadPromise=this._spotsLoadDeferred.promise,a.spots&&(f.addToSet(this.spots_ids,a.spots),delete a.spots),a.spot_invites&&(f.addToSet(this.spot_invites_ids,a.spot_invites),delete a.spot_invites),"false"===a.muted?a.muted=!1:"true"===a.muted&&(a.muted=!0),k.prototype.parse.apply(this,arguments),"total_likes"in a&&(this.total_likes=a.total_likes||0),"total_sent_messages"in a&&(this.total_sent_messages=a.total_sent_messages||0),"birthday"in a&&(this.age=o.calculateAge(a.birthday))},resolveDependencies:function(){var b=this,c=a.get("SpotsManager");return c.getSpotsByIds(this.spots_ids).then(function(a){f.addToSet(b.spots,a),b._sortSpots(),b._spotsLoadDeferred.resolve()},this._spotsLoadDeferred.reject),this._spotsLoadPromise},_sortSpots:function(){var a=i.getUser(),b={};(a?a.spots_ids:[]).forEach(function(a){b[a]=!0});var c=this;this.intimateSpots.length=0,this.memberSpots.length=0,this.mutualSpots.length=0,this.hostSpots.length=0,this.spots.forEach(function(d){if("intimate"===d.type)c.intimateSpots.push(d);else if(d.hosts_ids.indexOf(c.id)<0){var e=b[d.id];e&&a!==c?c.mutualSpots.push(d):c.memberSpots.push(d)}else c.hostSpots.push(d)}),this.intimateSpotsCount=this.intimateSpots.length,this.memberSpotsCount=this.memberSpots.length,this.hostSpotsCount=this.hostSpots.length,this.totalMembersCount=this.hostSpots.reduce(function(a,b){return a+b.members_count-1},0)},getSortedSpots:function(){var c=this,d=a.get("SpotsManager"),e=b.defer();return d.getSpotsByIds(this.spots_ids).then(function(a){var b=i.getUser(),d={},f={intimateSpots:[],memberSpots:[],mutualSpots:[],hostSpots:[],allSpots:[]};(b?b.spots_ids:[]).forEach(function(a){d[a]=!0}),a.forEach(function(a){if("intimate"===a.type)f.intimateSpots.push(a);else if(a.hosts_ids.indexOf(c.id)<0){var e=d[a.id];e&&b!==c?f.mutualSpots.push(a):f.memberSpots.push(a)}else f.hostSpots.push(a);f.allSpots.push(a)}),f.totalMembersCount=f.hostSpots.reduce(function(a,b){return a+b.members_count-1},0),e.resolve(f)},e.reject),e.promise},addMessages:function(a){var c=this,d=b.defer();return l.getMessagesByIds(a).then(function(b){e.$safeApply(function(){f.addToSet(c.messages_ids,a),f.addToSet(c.messages,b),d.resolve(b)})},d.reject),d.promise},loadUserMessages:function(a){var c=b.defer(),d=this;return a=a||{},a.id=this.get("id"),h.get_messages(a,function(a){if(a.isSuccess){var b=a.messages.map(function(a){return a.id});d.addMessages(b).then(function(a){c.resolve(a)})}else c.reject()},c.reject),c.promise},isMe:function(){var a=i.getUser();return a?a.id===this.id:!1},isZombie:function(){return"zombie"===this.state},update:function(){var a=this;return h.update({id:this.get("id")},this,function(b){a.parse(b),deferred.resolve()}),deferred.promise},report:function(a,c){var d=b.defer(),e={reason:a};return c&&(e.spot_id=c),h.report({id:this.get("id")},e,function(a){a.isSuccess?d.resolve():d.reject()},d.reject),d.promise},updatePicture:function(a){var c=b.defer(),d=this;return this.get("id")?j.upload(a,this.get("id"),function(){d.update().then(c.resolve,c.reject)}):c.reject("Cannot update user without id."),c.promise},getUserImageUrl:function(a){return q.getUserImageUrl(this.profile_image,a)},isPublicFigure:function(){var a=this.get("name");return a&&a.length>1&&""===a[0]},getFirstName:function(){var a=this.display_name||"";return a.split(" ")[0]},getCoreState:function(){return q.getCoreState(this.username)},getProfileUrlState:function(){return q.getProfileUrlState(this.username)},getProfileUrl:function(){var a=this.getCoreState();return c.href(a.stateName,a.stateParams)},getLanguage:function(){var a=m.getById(this.locale);return a&&a.name},getCountry:function(){var a=n.getById(this.country);return a&&a.name},getBirthday:function(){return o.getDateObject(this.birthday)},getRecentActivateSpot:function(){return this.getSortedSpots().then(function(a){var b,c=[].concat(a.memberSpots).concat(a.hostSpots);return b=0===c.length?null:f.max(c,function(a){return a.last_activity_date})})},applyPartedSpot:function(a){var b=null,c=f.indexOfObj(this.spots,function(b){return b.id===a});return c>=0&&(b=this.spots.splice(c,1)[0]),c=f.indexOf(this.spots_ids,a),c>=0&&this.spots_ids.splice(c,1),this._sortSpots(),b},applyJoinedSpot:function(c){var d=this,e=b.defer(),g=a.get("SpotsManager");return g.getSpotsByIds([c]).then(function(a){f.addToSet(d.spots_ids,[c]),f.addToSet(d.spots,a),e.resolve(a)},e.reject),e.promise.then(function(){d._sortSpots()}),e.promise},inviteIntimate:function(){var a=this,c=b.defer();return h.create_intimate_spot({id:this.id},null,function(a){a.isSuccess?c.resolve():c.reject()},c.reject),c.promise.then(function(){a._sortSpots(),p.trigger("Spot Intimate Invite")}),c.promise},acceptSpotInvitation:function(c){var d=b.defer();if(c){var e=a.get("SpotsManager");e.getSpotsByIds([c]).then(function(a){a[0].joinSpot().then(d.resolve,d.reject)},d.reject);var f=this;d.promise.then(function(){i.getUser().applyJoinedSpot(f.intimate_spot_id)}),d.promise.then(function(){p.trigger("Spot Accept Invitation",c)})}else d.reject();return d.promise},declineSpotInvitation:function(a){var c=b.defer();return a?h.decline_invitation({entity_id:a},null,function(a){a.isSuccess?c.resolve():c.reject()},c.reject):c.reject(),c.promise},declineIntimate:function(){return this.declineSpotInvitation(this.intimate_spot_id)},acceptIntimate:function(){return this.acceptSpotInvitation(this.intimate_spot_id)},getCoreIntimateSpotUrlState:function(){return q.getCoreIntimateSpotUrlState(this.intimate_spot_id)},getIntimateSpotUrlState:function(){return q.getIntimateSpotUrlState(this.intimate_spot_id)},getIntimateSpotUrl:function(){var a=this.getCoreIntimateSpotUrlState();return c.href(a.stateName,a.stateParams)},getIntimateSpotId:function(){return this.get("intimate_spot_id")},hasIntimateSpot:function(){return!!this.getIntimateSpotId()}},{getCoreState:function(a){return d.resolveState("user",null,{name:a})},getProfileUrlState:function(a){var b=q.getCoreState(a);return c.mapState(b.stateName,b.stateParams)},getCoreIntimateSpotUrlState:function(a){return d.resolveState("spot","intimate",{id:a})},getIntimateSpotUrlState:function(a){var b=q.getCoreIntimateSpotUrlState(a);return c.mapState(b.stateName,b.stateParams)},getUserImageUrl:function(a,b){return j.getUrl(a,b)},getReportCategories:function(){var a=b.defer();return g.loadPromise.then(function(){var b=g.getAttribute("user.report_categories");a.resolve(b)},a.reject),a.promise
},getMobileCode:function(){var a=b.defer();return h.get_mobile_code(function(b){a.resolve(b)},a.reject),a.promise},sendSms:function(a){var c=b.defer();return h.send_sms({phone:a},function(a){c.resolve(a)},c.reject),c.promise}});return q}]),angular.module("spot.im.core").factory("ExploreResource",["$http","$q","geoLocationService","apiUrl",function(a,b,c,d){function e(){var b=c.getCurrentPosition(),e={country:b.country,city:b.city,longitude:b.longitude,latitude:b.latitude,spot_count:10};return a({url:d+"/v4/spots",method:"GET",params:e})}return{get:function(){var a=b.defer(),d=function(){e().then(function(b){a.resolve(b.data)},a.reject)};return c.getPromise().then(d,d),a.promise}}}]),angular.module("spot.im.core").factory("TranslationsResource",["$resource","apiUrl",function(a,b){return a(b+"/v4/translations",{},{get:{method:"GET",params:{stage:"authenticated"}}})}]),angular.module("spot.im.core").factory("CountryResource",["$resource","apiUrl",function(a,b){return a(b+"/v4/where_am_i",{},{get:{method:"GET",params:{stage:"authenticated",skipStatus:!0}}})}]),angular.module("spot.im.core").factory("EmbedlyResource",["$resource","apiUrl",function(a,b){return a(b+"/v4/embedly",{},{get:{method:"POST",params:{stage:"authenticated",skipStatus:!0}}})}]),angular.module("spot.im.core").factory("appStageDefer",["appStage","apiUrl","apiCdnUrl","$injector",function(a,b,c,d){return{request:function(e){if(0!==e.url.indexOf(b)&&0!==e.url.indexOf(c))return e;if(!e.params||!e.params.stage)return e;var f=e.params.stage;return a.after(f)?e:a.stagePromise(f).then(function(){var a=d.get("SessionUser");return e.headers[a.sessionHeader]=a.sessionId,e})}}}]),angular.module("spot.im.core").factory("cdnInterceptor",["apiUrl","apiCdnUrl",function(a,b){return{request:function(c){return c.url=c.url.replace(a,b),c}}}]),angular.module("spot.im.core").factory("entitiesInterceptor",["$injector","dependenciesResolver","utils",function(a,b,c){function d(c){if(c){var d=a.get("SpotsManager"),e=a.get("UsersManager"),f=a.get("MessagesManager"),g=[],h={};c.messages&&c.messages.length&&c.messages.forEach(function(a){h=f.setMessage(a,{skipResolveDependencies:!0}),g.push(h)}),c.spots&&c.spots.length&&c.spots.forEach(function(a){h=d.setSpot(a,{skipResolveDependencies:!0}),g.push(h)}),c.users&&c.users.length&&c.users.forEach(function(a){h=e.setUser(a,{skipResolveDependencies:!0}),g.push(h)})}g.forEach(function(a){b.resovle(a)})}return{interceptEntities:d,request:function(a){return a.params&&a.params.interceptEntities&&(a.interceptEntities=a.params.interceptEntities,delete a.params.interceptEntities),a},response:function(a){var b=a.config.interceptEntities,e=a.data;return b&&c.isJsonContentType(a.headers()["content-type"])&&d(e),a}}}]),angular.module("spot.im.core").factory("statusInterceptor",["$q","$injector","underscore","utils",function(a,b,c,d){return{request:function(a){return a.params&&a.params.skipStatus&&(a.skipStatus=a.params.skipStatus,delete a.params.skipStatus),a},response:function(c){if(!d.isJsonContentType(c.headers()["content-type"]))return c;var e=c.config.skipStatus;if(e)return c;var f=c.data;if(f&&f.meta&&f.meta.code>=200&&f.meta.code<300)return f.isSuccess=!0,c;f.isSuccess=!1;var g=b.get("SessionUser");if(g.isRegistered&&f&&f.meta&&"Session expired error"===f.meta.error_details){var h=b.get("$http"),i=g.apiLoginWithCurrentDevice().then(function(a){return c.config.headers[g.sessionHeader]=a.session_id,h(c.config)});return i}return a.reject(c)}}}]),angular.module("spot.im.core").factory("MessageResource",["$resource","apiUrl","RequestedFields",function(a,b){return a(b+"/v4/messages/:id/:action",{},{get:{method:"GET",params:{interceptEntities:!0,stage:"authenticated"}},delete_message:{method:"DELETE"},report_message:{method:"POST",params:{action:"report"}},share_message:{method:"POST",params:{action:"share"}}})}]),angular.module("spot.im.core").factory("PopularLinksResource",["$resource","apiUrl","RequestedFields",function(a,b){return a(b+"/v4/spots/:spotId/spotlight/popular_links/:action",{},{get:{method:"GET",params:{interceptEntities:!0,stage:"authenticated"}},send_follow_up:{method:"POST",params:{interceptEntities:!0,action:"follow_up"}},like:{method:"POST",params:{interceptEntities:!0,action:"like"}},get_blocked_list:{method:"GET",params:{interceptEntities:!1,action:"urls",stage:"authenticated"}},update_blocked_list:{method:"POST",params:{interceptEntities:!1,action:"urls"}}})}]),angular.module("spot.im.core").factory("SearchResource",["$resource","apiUrl",function(a,b){return a(b+"/v4/search/:action",{},{autocomplete:{method:"GET",params:{action:"autocomplete",stage:"authenticated"}},search:{method:"GET",params:{action:"search",stage:"authenticated"}}})}]),angular.module("spot.im.core").factory("SpotResource",["$resource","apiUrl","RequestedFields",function(a,b,c){return a(b+"/v4/spots/:id/:action/:entityId/:subAction",{},{find_public_by_name:{method:"GET",params:{interceptEntities:!0,stage:"authenticated","requested_fields[main_object]":c.get("spot","full"),"requested_fields[extra_spots]":c.get("spot"),"requested_fields[extra_users]":c.get("user","minimal")}},get:{method:"GET",params:{interceptEntities:!0,stage:"authenticated","requested_fields[main_object]":c.get("spot","full"),"requested_fields[extra_spots]":c.get("spot"),"requested_fields[extra_users]":c.get("user","minimal",["mobile_user"])}},create:{method:"POST",params:{interceptEntities:!0,"requested_fields[main_object]":c.get("spot","full")}},update:{method:"PUT",params:{interceptEntities:!0,"requested_fields[main_object]":c.get("spot","full")}},get_members:{method:"GET",params:{action:"members",interceptEntities:!0,stage:"authenticated","requested_fields[extra_users]":c.get("user","minimal")}},online_members:{method:"GET",params:{action:"members",source:"online_members",interceptEntities:!0,stage:"authenticated","requested_fields[extra_users]":c.get("user",["id","display_name","is_online","state","username","profile_image"])}},join:{method:"POST",params:{action:"members",interceptEntities:!0,"requested_fields[main_object]":c.get("spot","full"),"requested_fields[extra_users]":c.get("user","minimal")}},get_messages:{method:"GET",params:{action:"messages",interceptEntities:!0,stage:"authenticated","requested_fields[extra_users]":c.get("user","minimal"),"requested_fields[extra_spots]":c.get("spot","minimal",["unread_count"])}},kick:{method:"POST",params:{action:"members",subAction:"kick",interceptEntities:!0,"requested_fields[main_object]":c.get("spot",["kicked_members"])}},unkick:{method:"DELETE",params:{action:"members",subAction:"kick",interceptEntities:!0,"requested_fields[main_object]":c.get("spot",["kicked_members"])}},add_cohost:{method:"POST",params:{action:"hosts","requested_fields[main_object]":c.get("spot",["hosts"]),"requested_fields[extra_users]":c.get("user")}},remove_cohost:{method:"DELETE",params:{action:"hosts","requested_fields[main_object]":c.get("spot",["hosts"]),"requested_fields[extra_users]":c.get("user")}},reserve_public_name:{method:"POST",params:{action:"reserve_public_name"}},explore:{method:"GET",params:{action:"explore",stage:"authenticated"}},share:{method:"POST",params:{action:"share"}},gather:{method:"POST",params:{action:"gather"}},get_categories:{method:"GET",params:{action:"categories",stage:"authenticated"}},get_implementation_status_by_id:{method:"GET",params:{action:"analytics",subAction:"embedded_status",stage:"authenticated"}},part:{method:"DELETE",params:{interceptEntities:!0,action:"members"}},invite:{method:"PUT",params:{action:"members"}},post_message:{method:"POST",params:{interceptEntities:!0,action:"messages"}},delete_message:{method:"DELETE",params:{action:"messages"}},like_message:{method:"POST",params:{action:"messages",subAction:"like"}},unlike_message:{method:"DELETE",params:{action:"messages",subAction:"like"}},report_message:{method:"POST",params:{action:"messages",subAction:"report"}},pin_message:{method:"POST",params:{action:"messages",subAction:"pin"}},unpin_message:{method:"DELETE",params:{action:"messages",subAction:"pin"}},report_spot:{method:"POST",params:{action:"report"}},typing:{method:"POST",params:{action:"typing"}}})}]),angular.module("spot.im.core").factory("UserResource",["$resource","apiUrl","RequestedFields",function(a,b,c){return a(b+"/v4/users/:id/:action/:entity_id",{},{login:{method:"POST",params:{action:"sessions",interceptEntities:!0,"requested_fields[main_object]":c.get("user","full"),"requested_fields[extra_spots]":c.get("spot","minimal",["hosts","channel_name","members_count","pinned_message_id","online_members_count","unread_count","created_at","updated_at"]),"requested_fields[extra_users]":c.get("user","minimal")}},logout:{method:"DELETE",params:{action:"sessions",interceptEntities:!0}},register:{method:"POST",params:{interceptEntities:!0,"requested_fields[main_object]":c.get("user","full"),"requested_fields[extra_spots]":c.get("spot","minimal",["hosts","channel_name","members_count","pinned_message_id","online_members_count","unread_count","created_at","updated_at"]),"requested_fields[extra_users]":c.get("user","minimal")}},get:{method:"GET",params:{interceptEntities:!0,stage:"authenticated","requested_fields[main_object]":c.get("user","full"),"requested_fields[extra_spots]":c.get("spot","minimal",["members_preview","members_count","online_members_count","unread_count"]),"requested_fields[extra_users]":c.get("user","minimal")}},get_by_name:{method:"GET",params:{id:"username",interceptEntities:!0,stage:"authenticated","requested_fields[main_object]":c.get("user","full"),"requested_fields[extra_spots]":c.get("spot","minimal",["members_preview","members_count","online_members_count","unread_count"]),"requested_fields[extra_users]":c.get("user","minimal")}},get_messages:{method:"GET",params:{action:"media",interceptEntities:!0,stage:"authenticated","requested_fields[extra_users]":c.get("user"),"requested_fields[extra_spots]":c.get("spot","minimal",["unread_count"])}},get_mobile_code:{method:"GET",params:{action:"mobile_code",stage:"authenticated"}},send_sms:{method:"POST",params:{action:"sms_download_link"}},create_intimate_spot:{method:"POST",params:{action:"intimate",interceptEntities:!0}},reserve_username:{method:"POST",params:{action:"reserve_username"}},delete_my_account:{method:"DELETE",params:{id:"me"}},get_my_notifications:{method:"GET",params:{id:"me",action:"notifications",stage:"authenticated","requested_fields[extra_spots]":c.get("spot"),"requested_fields[extra_users]":c.get("user")}},mark_notifications_read:{method:"PUT",params:{id:"me",action:"notifications"}},get_my_invitations:{method:"GET",params:{id:"me",action:"invitations",stage:"authenticated","requested_fields[extra_spots]":c.get("spot"),"requested_fields[extra_users]":c.get("user")}},mark_invitations_read:{method:"PUT",params:{id:"me",action:"invitations_count"}},decline_invitations:{method:"DELETE",params:{id:"me",action:"invitations"}},decline_invitation:{method:"PUT",params:{id:"me",action:"invitations"}},report:{method:"POST",params:{action:"report"}},update_fields:{method:"PUT",params:{interceptEntities:!0,id:"me","requested_fields[main_object]":c.get("user","full")}}})}]),angular.module("spot.im.core").factory("mySpotsList",["Events","spotEvents","SpotsManager",function(a,b,c){return angular.extend({list:[],memberSpots:[],hostSpots:[],intimateSpots:[],indexOf:function(a){var b,c=null;for(b=0;b<this.list.length&&!c;b++)this.list[b].id===a&&(c=b);return c},clear:function(){this.list.forEach(function(a){b.stop(a)}),this.list.length=0,this.trigger("change")},add:function(a,d){function e(a){var c=f.indexOf(a.id);null===c&&(b.start(a),"intimate"===a.type?f.intimateSpots.push(a):a.isHostedByMe()?f.hostSpots.push(a):f.memberSpots.push(a),f.list.push(a),d||f.trigger("change"))}var f=this;"string"==typeof a?c.getSpot({id:a}).then(e):e(a)},addList:function(a){var b=this;a.forEach(function(a){b.add(a,!0)}),this.trigger("change")},remove:function(a){var c=this.indexOf(a),d=null;null!==c&&(d=this.list[c],b.stop(d),this.list.splice(c,1),[this.memberSpots,this.hostSpots,this.intimateSpots].forEach(function(a){c=a.indexOf(d),-1!==c&&a.splice(c,1)}),this.trigger("change"))}},a)}]).run(["SessionUser","mySpotsList","pusherEvents","unreadIntimateMessages",function(a,b,c,d){a.subscribeLoginChange(function(a,c){b.clear(),a&&c.getSortedSpots().then(function(a){b.addList(a.allSpots)})}),c.onAll(function(c,d,e){switch(d){case"member_joined":var f=e.spot.id,g=a.channelName===c;g&&b.add(f);break;case"member_parted":var h=e.parted_user.id,f=e.spot.id,i=a.isRegistered&&a.getUser().id===h;i&&b.remove(f);break;case"invitation_accepted":var f=e.spot.id,j=e.spot.spot_type,g=a.channelName===c;g&&"intimate"===j&&b.add(f)}}),d.initialize()}]).factory("unreadIntimateMessages",["$rootScope","mySpotsList","pusherEvents","currentSpotView","SessionUser",function(a,b,c,d,e){function f(){a.unreadIntimateMessages=0,b.list.forEach(function(b){"intimate"===b.type&&(h[b.channel_name]=b,b.unread_count&&a.$evalAsync(function(){a.unreadIntimateMessages=a.unreadIntimateMessages+b.unread_count}))})}function g(){b.on("change",f),c.onAll(function(b,c,f){var g=h[b];if(g&&"message"===c&&d.isNot(g)){var i=e.isRegistered&&e.getUser().id===f.sender_id;i||(a.unreadIntimateMessages=a.unreadIntimateMessages+1,g.unread_count=g.unread_count+1)}})}var h={};return a.unreadIntimateMessages=0,{initialize:g,update:f}}]),angular.module("spot.im.core").factory("analyticsId",[function(){function a(){var a="";try{a=mixpanel.get_distinct_id()}catch(b){}return a}return{get:a}}]),angular.module("spot.im.core").run(["trackerUtils","trackerVent","$rootScope","utils",function(a,b,c,d){var e=!0,f=["app.public_spot_by_id","app.public_spot.user_profile_by_id","app.intimate_spot.user_profile_by_id"];c.$on("$stateChangeSuccess",function(b,c,g){if(-1===f.indexOf(c.name)){if(e)return void(e=!1);if(params={},c&&c.name&&(params.state_name=c.name),g)for(var h in g)g.hasOwnProperty(h)&&(params["state_"+d.toSnakeCase(h)]=g[h]);a.mainSpot&&"app.public_spot.chat"===params.state_name&&params.state_spot_encoded_name&&params.state_spot_encoded_name.length>0&&params.state_spot_encoded_name!==a.mainSpot.unique_name&&(params.spot_hopping=!0)}})}]),angular.module("spot.im.core").run(["trackerUtils","trackerVent","SessionUser",function(a,b,c){b.onAll({"Create Spot Clicked":function(b){a.trackAll("Create Spot Clicked",{button_name:b,is_logged_in:c.isRegistered})},"Create Spot Manage":function(){a.trackAll("Create Spot Manage",{is_logged_in:c.isRegistered})},"Create Spot Save":function(b,c,d){a.trackAll("Create Spot Save",{spot_category:b,spot_id:c,spot_name:d})},"Create Spot Success":function(b,c,d){a.trackAll("Create Spot Success",{spot_category:b,spot_id:c,spot_name:d}),a.trackGA("Spot","Create Spot Success")},"Create Spot Failed":function(b,c,d,e){a.trackAll("Create Spot Failed",{spot_category:b,spot_id:c,spot_name:d,reason:e})}})}]),angular.module("spot.im.core").run(["trackerUtils","trackerVent",function(a,b){b.onAll({"External API Embed Expanded":function(){a.trackAll("Embed Expanded Via Button")},"Edit Profile Clicked":function(b){a.trackAll("Edit Profile Clicked",{user_id:b})},"Delete Account Success":function(){a.trackAll("Delete Account Success")},"Delete Account Failure":function(){a.trackAll("Delete Account Failure")},"Device Corrupted":function(b,c){a.trackAll("Corrupted Device",{deviceData:b,reason:c})},"Device Remove":function(b){a.trackAll("Remove Device",{deviceRemoveReason:b})},"Device Store Error":function(b){a.trackAll("Store Device Error",{deviceStoreError:b})},"Mobile Code Open":function(b){a.trackAll("User Clicked Mobile",{action:b})},"Mobile Code Requested":function(b){a.trackAll("User Requested Mobile Code",{type:b?"direct":"sms"})},"Embed Tab Clicked":function(b){a.trackAll("Embed Tab Clicked",{tab_name:b})}})}]),angular.module("spot.im.core").run(["trackerUtils","trackerVent",function(a,b){function c(a){var b="";switch(a){case"fb":b="facebook";break;case"tw":b="twitter";break;case"li":b="linkedin";break;case"gl":b="google+"}return b}b.onAll({"Logout Success":function(){a.trackAll("Logout Success")},"Logout Failure":function(){a.trackAll("Logout Failure")},"Register Success":function(b){a.trackAll("Register Successful",{social_network:c(b)}),a.trackGA("User","Register Successful")},"Register Failed":function(b,d){a.trackAll("Register Failed",{social_network:c(b),reason:d})},"Login Success":function(b){a.identify(b),a.trackAll("Login Successful",{user_id:b})},"Login Failed":function(b,c,d){a.trackAll("Login Failed",{device_id:b,reason:c,response:JSON.stringify(d)})},"Device Register Failed":function(b,c){a.trackAll("Device Register Failed",{device_id:b,reason:c})},"Device Register Success":function(b){a.trackAll("Device Register Success",{device_id:b})},"Login Opened":function(){a.trackAll("Login Opened")},"Social Connect":function(b){a.trackAll("Social Connect",{social_network:b})}})}]),angular.module("spot.im.core").run(["trackerUtils","trackerVent",function(a,b){b.onAll({"Popular Link Clicked":function(){a.trackAll("Popular Link Clicked")},"Popular Links Paged":function(){a.trackAll("Popular Links Paged")}})}]),angular.module("spot.im.core").run(["trackerUtils","trackerVent","spotCategories",function(a,b,c){function d(a,b){return a.length>32?a:b}b.onAll({"Spot Message Like":function(b,c,d){a.trackAll("Like",{spot_id:b,spot_name:c,message_type:d})},"Spot Joined":function(b,c,e){a.trackAll("Spot Joined",{spot_type:b,spot_id:c,spot_name:d(c,e)})},"Spot Parted":function(b,c,e){a.trackAll("Spot Parted",{spot_type:b,spot_id:c,spot_name:d(c,e)})},"Spot Gather":function(b,c){a.trackAll("Gather",{spot_id:b,spot_name:c})},"Spot Message Sent":function(b,e,f,g,h,i,j,k){c.getById(j).then(function(c){var h=c&&c.text;h||"intimate"!==h||(h="intimate"),a.trackAll("Message Sent",{spot_id:b,spot_name:d(b,f),message_type:g,spot_type:e,is_host:i,spot_category:h,message_length:k})})},"Spot Popular Link Comment":function(b,c,d){a.trackAll("Popular Link Comment",{button_type:d,spot_id:b,spot_name:c})},"Spot Intimate Invite":function(){a.trackAll("1 on 1 Invite")},"Spot Accept Invitation":function(b){b.length>32?a.trackAll("1 on 1 Accept",{spot_id:b}):a.trackAll("Public Accept",{spot_id:b})}})}]),angular.module("spot.im.core").run(["trackerUtils","SessionUser","$window",function(a,b,c){c.setTimeout(function(){b.subscribeLoginChange(function(b,c){try{if(b){var d=JSON.stringify({login_timestamp:(new Date).getTime(),username:c.username});cookiesManager.setItem("spot-im-login",d)}else{var d=cookiesManager.getItem("spot-im-login");if(d){var e=JSON.parse(d);a.trackAll("User Logged Out",e),cookiesManager.removeItem("spot-im-login")}}}catch(f){}})},4e3)}]),angular.module("spot.im.core").run(["trackerUtils","trackerVent","$injector","deviceManager","SessionUser","$rootScope","notices.controllers.joinCommunity.steps","notices.components.realtime.noticeType","defaultBubbleType",function(a,b,c,d,e,f,g,h,i){function j(){return l&&l.id||""}function k(){return l&&l.name||""}var l=null,m="default",n={},o={};c.has("mainSpot")&&c.get("mainSpot").then(function(a){l=a}),n[g.JOIN_COMMUNITY]="join_community",n[g.POPULAR_LINK]="popular_link",n[g.SPOT_ICON]="spot_icon",n[h.USER_MENTIONED]="user_mentioned",n[h.MESSAGE_LIKED]="message_liked",n[h.SPOT_NEW_MEMBER]="spot_new_member",n[h.USER_REPORTED]="user_reported",n[h.MESSAGE_PINNED]="message_pinned",n[h.SPOT_MENTIONED]="spot_mentioned",n[h.INVITATION_ACCEPTED]="invitation_accepted",n[h.MESSAGE]="message",o[i.DEFAULT]="default",o[i.MEMBERS_SLIDER]="members_slider",b.onAll({"Ticker Expanded":function(b){var c=j(),g=k(),h=f.state,i=e.isRegistered,l=d.hasDevice(),o={is_logged_in:i,has_device_cookie:l,spot_id:c,spot_name:g,state:h,notice_type:n[b]||"no_notice",bubble_type:m};!i&&l&&(o.device_cookie=d._getDeviceJson()),a.trackAll("Ticker Expanded",o)},"Spot Closed":function(){var b=j(),c=k(),d=e.isRegistered,f={is_logged_in:d,spot_id:b,spot_name:c};a.trackAll("Spot Closed",f)},"Ticker Notices Closed":function(b){var c=j(),d=k(),g=f.state;isLoggedIn=e.isRegistered,params={is_logged_in:isLoggedIn,spot_id:c,spot_name:d,state:g,notice_type:n[b]},a.trackAll("Ticker Notices Closed",params)},"Set Deafult Bubble Type":function(a){m=o[a]}})}]),function(){var a={device:null,product:null,embed_type:null,visitor_id:null};angular.module("spot.im.core").run(["$injector","SessionUser","visitorId","trackerUtils",function(b,c,d){a.visitor_id=d,c.subscribeLoginChange(function(b,c){a.user_id=b?c.id:null})}]),angular.module("spot.im.core").factory("trackerUtils",["influxdbService","$window",function(b,c){var d={};return d.setEnvironment=function(b,c,d){a.device=b,a.product=c,a.embed_type=d},d.trackInfluxdb=function(c,d){try{d=angular.extend({},a,d);var e=b.sanitizeSeriesName(c),f=e+(d.spot_id?"_"+d.spot_id:""),g=Object.keys(d),h=g.map(function(a){return d[a]});b.writeSeries(f,g,[h]),f!==e&&b.writeSeries(e,g,[h])}catch(i){}},d.trakMixpanel=function(b,c){try{c=angular.extend({},a,c),mixpanel.track(b,c)}catch(d){}},d.trackAll=function(a,b){d.trakMixpanel(a,b),d.trackInfluxdb(a,b)},d.trackGA=function(a,b,d,e){try{c.ga&&"function"==typeof c.ga&&c.ga("send","event",a,b,d,e)}catch(f){}},d.identify=function(a){try{mixpanel.identify(a)}catch(b){}},d.alias=function(a){try{mixpanel.alias(a)}catch(b){}},d}])}(),angular.module("spot.im.core").factory("trackerVent",["Events",function(a){var b={};return angular.extend(b,a),b.onAll=function(a){for(var c in a)b.on(c,a[c])},b}]),angular.module("spot.im.core").provider("appStage",["$qProvider",function(a){function b(){l.forEach(function(a){a(k)})}function c(a){var c=a[1];k=c,b()}function d(a){h[a].resolve(a)}function e(a){var b=g.when();j=a||f,j.forEach(function(a){var c=g.defer();h[a]=c,i[a]=g.all([b,c.promise]),b=c.promise});for(var e in i)i[e].then(c);d(j[0])}var f=["started","authenticated"],g=a.$get(),h={},i={},j=null,k=null,l=[],m={setStage:d,onChange:function(a){a&&"function"==typeof a&&l.push(a)},stagePromise:function(a){return i[a]},get:function(){return k},is:function(a){return"string"==typeof a&&(a=[a]),a.indexOf(k)>=0},after:function(a){var b=j.indexOf(a),c=j.indexOf(k);return c>=b}};this.$get=[function(){return m}],this.initialize=e}]),angular.module("spot.im.core").factory("CloudinaryService",["underscore","$q","$http","$window","$sce","$rootScope","utils","apiUrl",function(a,b,c,d,e,f,g,h){function i(a){return Math.ceil(1*a)}if(!d.CLOUDINARY_SIGNATURE_URL)return console.log("Can't load Cloudinary: window.CLOUDINARY_SIGNATURE_URL is missing."),null;var j=200;return{getUrl:function(b,c){if(!b)return"";c=a.extend({width:null,height:null,crop:null,opacity:null,blur:null,colorize:null,extension:null,"default":null},c);var e=["f_auto"];if(c.height&&e.push("h_"+i(c.height)),c.width&&e.push("w_"+i(c.width)),c.crop&&e.push("c_"+c.crop),c.blur&&e.push("e_blur:"+c.blur),c.opacity&&e.push("o_"+c.opacity),c.default&&e.push("d_"+c.default),c.colorize){var f=c.colorize.replace(/#/g,"");e.push("e_colorize"),e.push("co_rgb:"+f)}var g=e.length>0?e.join(",")+"/":"",h=d.CLOUDINARY_NS;"namespace"in c&&(h=c.namespace);var k=c.extension||"jpg",l=d.CLOUDINARY_URL+"/"+g+"v"+j+"/"+h+"/"+b+"."+k;return l},getAssetUrl:function(a){var b=(d.CLOUDINARY_URL+"/v"+j+"/"+d.CLOUDINARY_NS+"/"+a).replace("image","raw");return b=e.trustAsResourceUrl(b)},sign:function(a){return c.post(h+d.CLOUDINARY_SIGNATURE_URL,a)},uploadPromise:function(a,c){c||(c=g.guid());var e={public_id:d.CLOUDINARY_NS+"/"+c,api_key:d.CLOUDINARY_API_KEY,timestamp:(new Date).getTime()/1e3};return this.sign(e).then(function(c){return e.signature=c.data.response.signature,e.file=a,b.when($.ajax({method:"POST",url:"https://api.cloudinary.com/v1_1/com-3pix/image/upload",data:e}))}).then(function(a){return a.public_id=a.public_id.substring(d.CLOUDINARY_NS.length+1),a})},upload:function(a,b,c){b||(b=g.guid());var e={public_id:d.CLOUDINARY_NS+"/"+b,api_key:d.CLOUDINARY_API_KEY,timestamp:(new Date).getTime()/1e3};this.sign(e).then(function(b){e.signature=b.data.response.signature,e.file=a,$.ajax({method:"POST",url:"https://api.cloudinary.com/v1_1/com-3pix/image/upload",data:e}).success(function(a){a.public_id=a.public_id.substring(d.CLOUDINARY_NS.length+1),f.$apply(function(){c(a)})}).error(function(a){f.$apply(function(){c(a)})})})}}}]),angular.module("spot.im.core").factory("currentSpotView",["Events",function(a){var b=null,c=angular.extend({enter:function(a){c.trigger("enter"),b=a},leave:function(a){b===a&&(c.trigger("leave"),b=null)},get:function(){return b},has:function(){return!!b},is:function(a){return b===a},isSpotId:function(a){return b&&b.id===a},isNot:function(a){return!this.is(a)}},a);return c}]),angular.module("spot.im.core").factory("dependenciesResolver",["$injector","$rootScope",function(){function a(a){d.indexOf(a)>=0||(d.push(a),b())}function b(){if(!c&&d.length>0){c=!0;var a=d.shift();a.resolveDependencies().finally(function(){c=!1,b()})}}var c=!1,d=[];return{resovle:a}}]),angular.module("spot.im.core").factory("dynamicAlerts",["$q","pusherEvents","Events","SpotsManager","UsersManager","MessagesManager","currentSpotView",function(a,b,c,d,e,f,g){function h(b){a.all([d.getSpot({id:b.spot.id}),e.getUser({id:b.liked_by.id}),f.getMessage({id:b.message.id})]).then(function(a){var b=a[0],c=a[1],d=a[2];if(d.isMine()){var e={type:"message-liked",spotId:b.id,spotName:b.name,state:b.getSpotUrlState(),userId:c.id,username:c.username,displayName:c.display_name,imageUrl:c.getUserImageUrl(o),messageId:d.id,message:d.text};q.trigger(e.type,e)}})}function i(b){a.all([d.getSpot({id:b.spot_id}),e.getUser({id:b.sender_id})]).then(function(a){var c=a[0],d=a[1];d.isMe()||("intimate"===c.type?j(b,c,d):"public"===c.type&&k(b,c,d))})}function j(a,b,c){if(g.isNot(b)){var d={type:"intimate-message",spotId:b.id,spotName:b.name,state:b.getSpotUrlState(),userId:c.id,username:c.username,displayName:c.display_name,imageUrl:c.getUserImageUrl(o),messageId:a.id,message:a.text};q.trigger(d.type,d)}}function k(a,b,c){if(p.forcePublicMessageAlerts&&g.is(b)){var d={type:"public-message",spotId:b.id,spotName:b.name,state:b.getSpotUrlState(),userId:c.id,username:c.username,displayName:c.display_name,imageUrl:c.getUserImageUrl(o),messageId:a.id,message:a.text};q.trigger(d.type,d)}}function l(b){var c={type:"intimate-invitation-accepted",spotId:b.spot.id,userId:b.invitee.id};a.all([d.getSpot({id:c.spotId}),e.getUser({id:c.userId})]).then(function(a){var b=a[0],d=a[1];"intimate"===b.type&&g.isNot(b)&&!d.isMe()&&(c.spotName=b.name,c.displayName=d.display_name,c.username=d.username,c.imageUrl=d.getUserImageUrl(o),c.state=b.getSpotUrlState(),q.trigger(c.type,c))})}function m(b){var c={type:"intimate-invitation-received",spotId:b.spot.id,userId:b.inviter.id};a.all([d.getSpot({id:c.spotId}),e.getUser({id:c.userId})]).then(function(a){var b=a[0],d=a[1];"intimate"===b.type&&g.isNot(b)&&!d.isMe()&&(c.spotName=b.name,c.displayName=d.display_name,c.username=d.username,c.imageUrl=d.getUserImageUrl(o),c.state=d.getProfileUrlState(),q.trigger(c.type,c))})}function n(b){var c={type:"user-mentioned",spotId:b.spot.id,userId:b.mentioner.id,messageId:b.message.id};a.all([d.getSpot({id:c.spotId}),e.getUser({id:c.userId}),f.getMessage({id:c.messageId})]).then(function(a){var b=a[0],d=a[1],e=a[2];g.isNot(b)&&!d.isMe()&&(c.state=b.getSpotUrlState(),c.spotName=b.name,c.displayName=d.display_name,c.username=d.username,c.imageUrl=d.getUserImageUrl(o),c.message=e.text,q.trigger(c.type,c))})}var o={width:40,height:40},p={forcePublicMessageAlerts:!1},q=angular.extend({setConfig:function(a){angular.extend(p,a)}},c);return b.onAll(function(a,b,c){switch(b){case"message":return i(c);case"message_liked":return h(c);case"invitation_accepted":return l(c);case"intimate_user_invited":return m(c);case"user_mentioned":return n(c)}}),q}]),angular.module("spot.im.core").factory("entityStateResolver",[function(){return{resolveState:function(a,b,c){var d=null,e=null;switch(a){case"spot":switch(b){case"intimate":c.id&&(d="intimate-spot-by-id",e={id:c.id});break;case"public":default:c.id?(d="public-spot-by-id",e={id:c.id}):c.name&&(d="public-spot-by-name",e={name:c.name})}break;case"user":c.id?(d="user-profile-by-id",e={id:c.id}):c.name&&(d="user-profile-by-name",e={name:c.name});break;case"message":d="message-by-id",c.id&&(e={id:c.id})}return{stateName:d,stateParams:e}}}}]),angular.module("spot.im.core").factory("facebookService",["underscore","$rootScope","$q","$http","Cursor","$window",function(a,b,c,d,e,f){var g={_currentProfile:null,initialize:function(){!function(a){var b,c="facebook-jssdk",d=a.getElementsByTagName("script")[0];a.getElementById(c)||(b=a.createElement("script"),b.id=c,b.async=!0,b.src="//connect.facebook.net/en_US/all.js",d.parentNode.insertBefore(b,d))}(document);var a=c.defer();this._initializePromise=a.promise,f.fbAsyncInit=function(){FB.init({appId:f._FACEBOOK.appId,status:!0,cookie:!0,xfbml:!0,frictionlessRequests:!0}),a.resolve()}},login:function(){var a=c.defer();return this._currentProfile=null,this._initializePromise.then(function(){FB.login(function(c){b.$safeApply(function(){c.authResponse?(console.log("facebookService: Facebook login complete"),a.resolve(c)):(console.log("facebookService: Facebook login failed",c),a.reject(c))})})}),a.promise},getLoginStatus:function(){var a=c.defer();return this._currentProfile=null,this._initializePromise.then(function(){FB.getLoginStatus(function(c){b.$safeApply(function(){console.log("getLoginStatus",c),a.resolve("connected"===c.status?{isConnected:!0,fbResponse:c}:"not_authorized"===c.status?{isConnected:!1,fbResponse:c}:{isConnected:!1,fbResponse:c})})})}),a.promise},getAccessToken:function(){return FB.getAccessToken()},getCurrentProfile:function(){var a=c.defer();if(this._currentProfile)a.resolve(this._currentProfile);else{var d=this;this._initializePromise.then(function(){FB.api("/me?fields=id,name,picture.type(large),username",function(c){b.$safeApply(function(){d._currentProfile=c,a.resolve(d._currentProfile)})})})}return a.promise},getProfileImageUrl:function(a,b){var c="";if(a){var d="";b&&b.width&&b.height&&(d="?width="+b.width+"&height="+b.height),c="https://graph.facebook.com/"+a+"/picture"+d}return c},invite:function(d){d=d||{};var e=c.defer();return FB.ui(a.extend({message:"Visit Spot.IM!",redirect_url:f.location.protocol+"//"+f.location.hostname,filters:["app_non_users"]},d,{method:"apprequests"}),function(a){b.$apply(function(){a?e.resolve(a.to):e.reject()})}),e.promise},share:function(d){var e=c.defer();return FB.ui(a.extend({name:"Spot.IM",link:f.location.protocol+"//"+f.location.hostname},d,{method:"feed"}),function(a){b.$apply(function(){a&&a.post_id?e.resolve(a.post_id):e.reject()})}),e.promise},getFriendsCursor:function(a,d){function f(d,e){return function(){var g=c.defer(),h="select uid, name, username, pic from user where uid in (select uid2 from friend where uid1 = me())";return a&&a.length>0&&(h+=' and ((strpos(lower(name), "'+a+'") = 0 or strpos(name, "'+a+'") = 0) or (strpos(lower(name), " '+a+'") >= 0 or strpos(name, " '+a+'") >= 0))'),h+=" order by name limit "+d+" offset "+e,FB.api("/fql?q="+encodeURIComponent(h),function(a){b.$safeApply(function(){a.error?g.reject(a.error):g.resolve({data:a.data,nextFn:f(d,e+d)})})}),g.promise}}return new e(f(d,0))}};return g.initialize(),g}]),angular.module("spot.im.core").factory("geoLocationService",["jquery","$q","$rootScope","underscore","jquery",function(a,b,c,d,a){var e=window.FOURSQUARE_CLIENT_ID,f=window.FOURSQUARE_CLIENT_SECRET,g={defaultOptions:{enableHighAccuracy:!1,timeout:1/0,maximumAge:36e5},_resolveGeoLocation:function(d){var e=b.defer(),f=this;return this._geoLocation?e.resolve(this._geoLocation):this._geoLocationPromise||(this._geoLocationPromise=e.promise,window.navigator.geolocation?window.navigator.geolocation.getCurrentPosition(function(a){c.$safeApply(function(){f._geoLocation={longitude:a.coords.longitude,latitude:a.coords.latitude},e.resolve(f._geoLocation)})},function(a){c.$safeApply(function(){e.reject(a)})},a.extend({},this.defaultOptions,d)):e.reject()),this._geoLocationPromise
},_resolveIpInfo:function(){var d=b.defer(),e=this;return this._ipInfo?d.resolve(this._ipInfo):this._ipInfoPromise||(this._ipInfoPromise=d.promise,a.get("http://ipinfo.io",function(a){c.$safeApply(function(){var b=a.loc.split(",");e._ipInfo={longitude:b[1],latitude:b[0],city:a.city,country:a.country},d.resolve(e._ipInfo)})},"jsonp").fail(function(){c.$safeApply(function(){d.reject()})})),this._ipInfoPromise},resolveLocation:function(){if(!this.currentLocation){var a=this._resolveGeoLocation(),c=this._resolveIpInfo(),d=b.defer();a.then(d.resolve,function(){c.then(d.resolve,d.reject)}),this.currentLocation={geoLocationPromise:d.promise,ipInfoPromise:c}}return this.currentLocation},searchFoursquareVenues:function(d,g){var h=b.defer();return this.resolveLocation().geoLocationPromise.then(function(b){var i="https://api.foursquare.com/v2/venues/search";a.get(i,{client_id:e,client_secret:f,v:"20131001",ll:b.latitude+","+b.longitude,query:d||"",limit:g||50}).then(function(a){c.$safeApply(function(){h.resolve(a)})},function(a){c.$safeApply(function(){h.reject(a)})})},h.reject),h.promise}};return g.resolveLocation(),g}]),angular.module("spot.im.core").factory("googlePlusService",["underscore","$rootScope","$q","$window",function(a,b,c,d){var e=d._GOOLGEPLUS.apiKey,f=d._GOOLGEPLUS.clientId,g=d._GOOLGEPLUS.scopes,h={initialize:function(){var a=c.defer();this._initializePromise=a.promise,d.googlePlusCallback=function(){gapi.client.setApiKey(e),a.resolve()};var b=document.createElement("script");b.type="text/javascript",b.src="https://apis.google.com/js/client.js?onload=googlePlusCallback";var f=document.getElementsByTagName("script")[0];return f.parentNode.insertBefore(b,f),a.promise},getCurrentProfile:function(){var a=c.defer();return gapi.client.load("plus","v1",function(){var b=gapi.client.plus.people.get({userId:"me"});b.execute(function(b){a.resolve(b.id&&b.displayName&&b.image.url?b:{error:!0})})}),a.promise},login:function(){var a=c.defer();return gapi.auth.authorize({client_id:f,scope:g,immediate:!1},function(b){a.resolve(b&&!b.error?{isConnected:!0,response:b}:{isConnected:!1,response:b})}),a.promise}};return h.initialize(),h}]),angular.module("spot.im.core").factory("influxdbService",["$window","$q",function(a){var b=["utm_source","utm_medium","utm_term","utm_content","utm_campaign","utm_expid","utm_name","ref"],c=new InfluxDB({hosts:a.influxdbConfig.hosts,port:a.influxdbConfig.port,ssl:a.influxdbConfig.port+""=="8087",max_retries:1,username:a.influxdbConfig.username,password:a.influxdbConfig.password,database:a.influxdbConfig.database}),d={writeSeries:function(a,b,d){var e={name:a,columns:b,points:d};c.writeSeries([e])},sanitizeSeriesName:function(a){return a.replace(/\s+/g,"_").toLowerCase()},sanitizeUrl:function(a){var c=document.createElement("a");c.href=a;var d={},e=[],f="",g="";return c.search.slice(1).split("&").forEach(function(a){if(""!==a){var c=a.split("="),f=c[0],g=c[1];-1===b.indexOf(f)&&(d[f]=g,e.push(f))}}),f=e.sort(function(a,b){return a.toLowerCase().localeCompare(b.toLowerCase())}).reduce(function(a,b){return a+"&"+b+"="+d[b]},""),g=c.origin+c.pathname,f&&(g+="?"+f.slice(1)),g}};return d}]),angular.module("spot.im.core").factory("linkedInService",["underscore","$rootScope","$q","$window",function(a,b,c,d){var e={initialize:function(){!function(){var a=document.createElement("script");a.type="text/javascript",a.async=!1,a.src="http://platform.linkedin.com/in.js?async=true",a.onload=function(){IN.init({api_key:d._LINKEDIN.apiKey})};var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}(document)},login:function(){var a=c.defer();return this._currentProfile=null,IN.User.authorize(function(b){a.resolve({response:b})}),a.promise},getCurrentProfile:function(){var a=c.defer();return IN.API.Profile("me").fields(["id","firstName","lastName","pictureUrl"]).result(function(b){var c={token:IN.ENV.auth.oauth_token,displayName:b.values[0].firstName+" "+b.values[0].lastName,id:b.values[0].id,pictureUrl:b.values[0].pictureUrl};a.resolve(c)}).error(function(b){a.resolve({isConnected:!1,linkedinResponse:b})}),a.promise}};return e.initialize(),e}]),angular.module("spot.im.core").factory("localeManager",["$window","SessionUser","Events",function(a,b,c){var d={currentLocale:null,rtlLocales:["he"],initLocale:function(){this.currentLocale=null,this.setLocale(this.getLocale())},setLocale:function(a){this.isRegistered&&this.user&&(this.user.locale=a),this.currentLocale=a,this.isRTL=-1!==this.rtlLocales.indexOf(a),this.trigger("localeManager:locale-changed")},getLocale:function(){var b=this.isRegistered&&this.user?this.user.locale:this.currentLocale;return null===b&&(b=a.navigator.userLanguage||a.navigator.language,b=b.substr(0,2).toLowerCase()),b}};return angular.extend(d,c),b.subscribeLoginChange(function(){d.initLocale()}),d}]),angular.module("spot.im.core").factory("pixelManager",["$window","$q","Logger",function(a,b,c){function d(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}var e=(new c.getInstance("pixelManager"),a.pixelApiUrl),f={fire:function(a){var b=e+d(a);this.fireUrl(b)},fireUrl:function(b){var c=new Image;c.onload=function(){c.src=""},a.setTimeout(function(){c.src=""},5e3),c.src=b}};return f}]),angular.module("spot.im.core").factory("pusherService",["$window","$q","Events","$injector","Pusher","Logger",function(a,b,c,d,e,f){function g(){var a=d.get("SessionUser"),b={};b.auth=a.isRegistered&&a.currentDevice?{params:{device_type:"web",device_id:a.currentDevice.id,user_id:a.user.id}}:{params:{device_type:"web"}},n.config=angular.extend({},n.config,b)}function h(a){return r[a]||(r[a]={statePromise:b.when(),state:"unsubscribed",channel:null}),r[a]}function i(a){var c=b.defer();g();var d=n.subscribe(a);return d.bind("pusher:subscription_succeeded",function(){c.resolve()}),d.bind("pusher:subscription_error",function(a){c.reject(a)}),r[a].channel=d,c.promise}function j(a,b){if(h(b),"subscribed"===r[b].state)return r[b].statePromise;var c=r[b].statePromise;return r[b].state="subscribed",r[b].statePromise=q.then(function(){return c}).then(function(){m.debug("subscribe","{0}: do subscribe to channel {1}",[a,b]);var c=i(b);return c.then(function(){m.debug("subscribe","{0}: do subscribe done with channel {1}",[a,b])}),c}),r[b].statePromise}function k(a){return n.unsubscribe(a),r[a].channel=null,b.when()}function l(a,b){if(h(b),"unsubscribed"===r[b].state)return r[b].statePromise;var c=r[b].statePromise;return r[b].state="unsubscribed",r[b].statePromise=q.then(function(){return c}).then(function(){m.debug("unsubscribe","{0}: do unsubscribe to channel {1}",[a,b]);var c=k(b);return c.then(function(){m.debug("unsubscribe","{0}: do unsubscribe done with channel {1}",[a,b])}),c}),r[b].statePromise}var m=f.getInstance("pusherService"),n=null,o=0,p=b.defer(),q=p.promise,r=a.pusherChannels={},s={connect:function(){m.debug("connect","start"),n=new e(a.PUSHER_KEY,{authTransport:"buffered",encrypted:!0,authEndpoint:a.PUSHER_AUTH_URL,wsHost:a.PUSHER_WS_HOST,httpHost:a.PUSHER_HTTP_HOST});var b=!1;n.connection.bind("connected",function(){p.resolve(),b&&(s.trigger("pusher:reconnected"),b=!1)}),n.connection.bind("unavailable",function(){p.reject(),b=!0}),n.connection.bind("state_change",function(a){m.debug("State Changed","{0} -> {1}",[a.previous,a.current])})},bind:function(a,b,c){o++,j(o,a).then(function(){r[a].channel.bind(b,c)})},bindAll:function(a,b){o++,j(o,a).then(function(){r[a].channel.bind_all(b)})},unsubscribe:function(a){o++,l(o,a)},getChannel:function(a){return o++,j(o,a).then(function(){return r[a].channel})}};return angular.extend(s,c),s}]),angular.module("spot.im.core").factory("RequestedFields",["underscore",function(a){var b={spot:{defaults:["id","type","channel_name"],minimal:["id","type","state","last_activity_date","is_muted","other_party","name","unique_name","spot_icon","bubble_text_color","cover_image","brand_color","embedded","brand_messages","messages","reported"],compact:["members_count","hosts","inviters","kicked_members","pinned_message_id","online_members_count"],full:["main_language","languages, restricted_words","embed_position","place_in_queue","online_members_count","hashtags","unread_count","url","category_id","description","websites","last_gather_time","created_at","updated_at","popular_links_count"]},user:{defaults:["id"],minimal:["id","state","username","display_name","reported","profile_image","relation_status","exiled","is_online","last_activity_at"],compact:["first_name","last_name"],full:["about","locale","spots","email","mutual_spots","intimate_spot_id","media_history_count","country","birthday","gender","muted","total_sent_messages","total_likes","last_message_id"]}};return{get:function(c,d,e){var f=[],g=[],h=b[c];switch(Array.isArray(d)&&(e=d,d=null),d){case"full":f=f.concat(h.minimal,h.compact,h.full);break;case"compact":f=f.concat(h.minimal,h.compact);break;case"minimal":f=f.concat(h.minimal);break;default:f=f.concat(h.defaults)}return e&&(angular.forEach(e,function(a){0!==a.indexOf("-")?f.push(a):g.push(a.substr(1))}),g.length&&(f=a.difference(f,g))),f.join(",")}}}]),angular.module("spot.im.core").factory("SocialLogin",["$q","$window","jquery","utils","cookiesManager","localStorageManager","Logger","SessionUser","trackerVent","analyticsId",function(a,b,c,d,e,f,g,h,i,j){var k=g.getInstance("SocialLogin"),l=b.apiUrl+"/v4/users/auth/?social_type=",m={facebook:"fb",twitter:"tw","google+":"gl",linkedin:"li"},n=function(){this._deferred=a.defer(),this.promise=this._deferred.promise,this.profile={userId:null,displayName:null,username:null,socialType:null,socialId:null,socialToken:null}};return n.prototype={_afterLogin:function(a){this.profile.socialType=a.social_type;var b=a.social_token;"object"==typeof b&&(b=angular.extend({},b)),this.profile.socialToken=b,this.profile.socialId=a.social_id,this.profile.displayName=a.display_name,this.profile.userId=a.user_id,this.profile.username=a.suggested_username},login:function(a){function g(a){n(),k.debug("login","Handling result {0}",[JSON.stringify(a)]),w._afterLogin(a),w._deferred.resolve(w.profile)}function h(a){var b=a.data;b&&b.name&&"spot.im.social.login"===b.name&&b.json&&g(b.json)}function n(){v&&b.clearInterval(v),b.removeEventListener("message",h,!1),e.removeItem("spot.im.social.login",".spot.im"),f.removeItem("spot.im.social.login")}i.trigger("Social Connect",a),a=m[a.toLowerCase()];var o=c(b).outerWidth(),p=c(b).outerHeight(),q=500,r=400,s=parseInt((o-q)/2,10),t=parseInt((p-r)/2.5,10),u=["width="+q,"height="+r,"left="+s,"top="+t].join(","),v=null,w=this;b.addEventListener("message",h,!1),v=b.setInterval(function(){var a=e.getItem("spot.im.social.login");if(a||(a=f.getItem("spot.im.social.login")),a)try{var b=JSON.parse(a);g(b)}catch(c){}(!y||y.closed)&&n()},500);var x=l+a+"&analytics_id="+j.get(),y=window.open(d.applyProtocol(x),"Spot.IM login",u);return y&&y.focus(),this.promise},quickLogin:function(b){var c=this.profile,d=!1;return this.login(b).then(function(){d=!c.userId;var a=[c.socialType,c.socialId,c.socialToken];return d&&a.push(c),h.apiUserRegister.apply(h,a)}).then(function(){d?i.trigger("Register Success",c.socialType):i.trigger("Login Success",c.userId)}).catch(function(b){return d?i.trigger("Register Failed",c.socialType,b):i.trigger("Login Failed",null,b,null),a.reject(b)})}},n}]),angular.module("spot.im.core").factory("spotCategories",["$q","SpotResource","underscore",function(a,b,c){var d=null;return{get:function(){var c=a.defer();return d?c.resolve(d):b.get_categories(null,function(a){a.isSuccess&&(d=a.response),c.resolve(d)},function(){c.resolve(d)}),c.promise},getById:function(a){return this.get().then(function(b){return c.findWhere(b,{id:a})})}}}]),angular.module("spot.im.core").factory("spotMembersFetcher",["$q",function(a){var b={get:function(b,c){var d=0;c=c||20;var e=!1,f=!1,g=function(g){var h=a.defer();if(e||f)return void h.reject();g===!0&&(d=0);var i=c+d-1;f=!0;var j={start_index:d,end_index:i};return b.loadSpotMembers(j).then(function(a){e=0===a.length,f=!1,h.resolve()}),d=i,h.promise};return g}};return b}]),angular.module("spot.im.core").factory("spotMessagesFetcher",["underscore","$q",function(a,b){var c={get:function(c){var d=20,e=null,f=!1,g=!1;return function(h){if(f||g)return b.when([]);g=!0;var i=null;return h===!0&&(e=null),i=e?{algorithm:"id",around_id:e,before:d}:{count:d},c.loadSpotMessages(i).then(function(b){var c=b.messages;return f=0===c.length,g=!1,c.forEach(function(a){a.markShowInHistory()}),e=c.length>0?a.min(c,function(a){return a.timestamp}).id:null,c})}}};return c}]),angular.module("spot.im.core").factory("spotTyping",["$q","$timeout","SpotResource","Events","SessionUser","pusherEvents","underscore",function(a,b,c,d,e,f,g){function h(a){var b=l[a.id];return b||(b=i(a)),b.refCount++,b.instance}function i(a){var b=new m(a),c=l[a.id]={instance:b,refCount:0};return c.instance._start(),c.instance.on("destroy",function(){j(c)}),c}function j(a){a.refCount--,0===a.refCount&&(a.instance._stop(),a.instance.off(),delete l[a.instance.spot.id])}var k=15e3,l={},m=function(a){this.spot=a,this.typersPool=[],this._removeTimeoutIds={},this.onUserTypingEvent=this.onUserTypingEvent.bind(this),this.onUserMessageEvent=this.onUserMessageEvent.bind(this)};return m.prototype={_start:function(){f.on(this.spot.channel_name,"user_typing",this.onUserTypingEvent),f.on(this.spot.channel_name,"message",this.onUserMessageEvent)},_stop:function(){f.off(this.spot.channel_name,"user_typing",this.onUserTypingEvent),f.off(this.spot.channel_name,"message",this.onUserMessageEvent)},onUserTypingEvent:function(a){var b=a.typer.id,c=a.typer.profile_image;this._addTyper(b,c)},onUserMessageEvent:function(a){this._removeTyper(a.sender_id)},_addTyper:function(a,b){var c=!!g.findWhere(this.typersPool,{id:a}),d=e.isRegistered&&e.getUser().id===a;c||d||(this.typersPool.push({id:a,profileImageId:b}),this.trigger("update","typerAdded",a),this._setRemoveTimeout(a))},_setRemoveTimeout:function(a){var c=this._removeTimeoutIds[a],d=this;c&&b.cancel(c),this._removeTimeoutIds[a]=b(function(){d._removeTyper(a)},k)},_removeTyper:function(a){var b=g.findWhere(this.typersPool,{id:a}),c=this.typersPool.indexOf(b);b&&c>-1&&(this.typersPool.splice(c,1),this.trigger("update","typerRemoved",a))},isAnyoneTyping:function(){return 0!==this.typersPool.length},getTypers:function(){return this.typersPool},destroy:function(){this._stop(),this.trigger("destroy")}},angular.extend(m.prototype,d),{get:h,notifyUserTyping:function(b){return e.isRegistered?c.typing({id:b},null).$promise:a.reject()}}}]),angular.module("spot.im.core").factory("spotMediaFetcher",["$q","underscore",function(a){var b=function(b,c,d,e,f){var g,h=a.defer();"all"===c&&"likes"===d&&(g="all_media_by_likes"),"all"===c&&"date"===d&&(g="all_media_history"),"host"===c&&"likes"===d&&(g="host_media_by_likes"),"host"===c&&"date"===d&&(g="host_media"),"pinned"===c&&"likes"===d&&(g="pinned_by_likes"),"pinned"===c&&"date"===d&&(g="pinned");var i={source:g};return e?(i.algorithm="id",i.around_id=e,i.before=f):(i.algorithm="latest",i.count=f),b.loadSpotMessages(i).then(function(a){h.resolve(a)},h.reject),h.promise};return b}]),angular.module("spot.im.core").factory("translations",["$q","Logger","SessionUser","localeManager","TranslationsResource",function(a,b,c,d,e){var f=b.getInstance("translations"),g={_dictionary:null,loadPromise:null,initialize:function(){d.on("localeManager:locale-changed",this._load.bind(this)),this._load()},_load:function(){var b=a.defer();this.loadPromise=b.promise;var c=this;f.debug("initialize","Load translations");var g=d.getLocale();e.get({locale:g},function(a){f.debug("initialize","Load success"),c._dictionary=a.response.translation,b.resolve(c._dictionary)},function(){f.error("initialize","Load failed"),b.reject()})},getAttribute:function(a){for(var b=a.split("."),c=this._dictionary,d=0;d<b.length&&c;d++)c=c[b[d]];return c},getString:function(a){var b=this.getAttribute(a);return"string"==typeof b?b:null},getTemplate:function(a,b,d,e){var f=this.getAttribute(a);if(!f)return null;if(b&&f&&"string"!=typeof f&&(1===b&&f.one?f=f.one:2===b&&f.two?f=f.two:b>0&&f.other&&(f=f.other)),d&&f&&"string"!=typeof f){var g=c.getUser();f.me&&g&&g.id===d?f=f.me:f.other&&(f=f.other)}return e&&f&&"string"!=typeof f&&f[e]&&(f=f[e]),function(a){var b=null;if(f&&"string"==typeof f){if(b=new String(f),a){var c=/%{(\w*)}/gi;b=b.replace(c,function(b,c){return a[c]||"MISSING PARAMETER"})}}else b="";return b}}};return g}]),angular.module("spot.im.core").factory("userMessagesFetcher",["underscore","$q",function(a,b){var c={get:function(c,d,e){var f=null,g=!1,h=!1;return function(i){if(g||h)return b.when([]);h=!0;var j={source:e};return i===!0&&(f=null),f?angular.extend(j,{algorithm:"id",around_id:f,before:d}):angular.extend(j,{algorithm:"latest",count:d}),c.loadUserMessages(j).then(function(b){return g=0===b.length,h=!1,b.forEach(function(a){a.markShowInHistory()}),f=b.length>0?a.min(b,function(a){return a.timestamp}).id:null,b})}}};return c}]),angular.module("spot.im.core").factory("visitorId",["cookiesManager","utils",function(a,b){var c=a.getItem("spotim-visitor-id");return c||(c=b.guid(),a.setItem("spotim-visitor-id",c)),c}]),angular.module("spot.im.core").factory("visitorSessions",["$window","Logger","cookiesManager","localStorageManager","utils","influxdbService","$rootScope","SessionUser","tabFocus","visitorId",function(a,b,c,d,e,f,g,h,i,j){function k(){var a=[];return d.iterate(function(b){if(0==b.indexOf(r))try{var c=d.getItem(b),e=JSON.parse(c),f=u._deserialize(e);a.push(f)}catch(g){t.error("getPastSessions","error loading session key {0}: {1}",[b,g.message])}}),a}function l(a){t.debug("clearPastSessions","start of clearPastSessions");var b=k(),c=[];t.debug("clearPastSessions","there are {0} sessions to clear",[b.length]),b.forEach(function(b){b.closeIfPossible(),b.isClosed&&(c.push(b.id),b.clear(a))}),t.debug("clearPastSessions","sessions to be cleared: "+c),t.debug("clearPastSessions","end of clearPastSessions (clear loop didn't finished yet)")}function m(a){var b=["session_id","spot_id","visitor_id","user_id","url","real_url","domain","start_time","time_expanded","time_spent","version"],c=f.sanitizeUrl(a.url),d=[a.id,a.spotId,a.visitorId,a.userId,c,a.url,a.domain,a.startTime,a.timeExpanded,a.timeSpent,"1.0"];f.writeSeries("visitor_sessions_"+a.spotId,b,[d]),f.writeSeries("visitor_sessions",b,[d])}var n=40,o=15,p=2,q=2e3,r="spotim-visitor-session-id-",s="spotim-visitor-session-lock-",t=b.getInstance("visitorSessions"),u=function(a,b,c,d,e,f){this.id=a,this.visitorId=b,this.userId=c,this.spotId=d,this.url=e,this.domain=f,this.isOpened=!1,this.isClosed=!1,this.isFocused=!1,this.timeSpent=0,this.timeExpanded=0,this.isExpanded=!1,this.lastSeenFocused=null,this.startTime=null,this._key=r+a,this._lockName=s+a};u.prototype={open:function(){this.isOpened||(t.debug("openning session "+this.id),this._startTimeTracking(),this.isOpened=!0)},_serialize:function(){return{id:this.id,isClosed:this.isClosed,lastSeenFocused:this.lastSeenFocused,spotId:this.spotId,visitorId:this.visitorId,userId:this.userId,url:this.url,domain:this.domain,startTime:this.startTime,timeExpanded:this.timeExpanded,timeSpent:this.timeSpent}},_persist:function(){try{var a=this._serialize(),b=JSON.stringify(a);d.setItem(this._key,b)}catch(c){t.error("_persist","error for session {0}: {1}",[this.id,c.message])}},_startTimeTracking:function(){var b=this;this.startTime=Date.now(),this.lastSeenFocused=Date.now(),this._persist(),this._intervalId=a.setInterval(function(){b._nextTimeTracking()},q)},_nextTimeTracking:function(){this.closeIfPossible(),this.isClosed||(this.isFocused?(this.isExpanded?(this.timeExpanded+=q,t.debug("updating session "+this.id+" because it is focused (expanded)")):t.debug("updating session "+this.id+" because it is focused (collapsed)"),this.timeSpent+=q,this.lastSeenFocused=Date.now(),this._persist()):t.debug("not updating session "+this.id+" because it is not focused."))},_stopTimeTracking:function(){this._intervalId&&(a.clearInterval(this._intervalId),this.intervalId=null)},canClose:function(){return this.isClosed?!1:Date.now()-this.lastSeenFocused>1e3*n},closeIfPossible:function(){this.canClose()&&this.close()},close:function(){if(this.canClose())try{t.debug("closing session: "+this.id),this.isClosed=!0,this._persist()}finally{this._stopTimeTracking()}},focus:function(){t.debug("focusing session: "+this.id),this.isFocused=!0},blur:function(){t.debug("blurring session: "+this.id),this.isFocused=!1},expand:function(){t.debug("expanding session: "+this.id),this.isExpanded=!0},collapse:function(){t.debug("collapsing session: "+this.id),this.isExpanded=!1},_releaseLockCookie:function(){t.debug("_releaseLockCookie","releasing session-lock: "+this._lockName+"from cookiesManager"),c.removeItem(this._lockName)},_getLockCookie:function(){var a=c.getItem(this._lockName),b=null;if(a)try{b=JSON.parse(a);var d=(new Date).getTime();d>b.expires&&(this._releaseLockCookie(),b=null)}catch(e){t.error("_getLockCookie","error while fetching lock for session {0}: {1}",[this.id,e.message]),b=null}return b},_hasLockCookie:function(){var a=this._getLockCookie();return!!a},_createLockCookie:function(){var a=e.guid(),b=new Date,d=b.setTime(b.getTime()+1e3*o),f={tag:a,expires:d};return t.debug("_createLockCookie","creating a lock for session: "+this.id+" (tag: "+a+", expiration: "+d+")"),c.setItem(this._lockName,JSON.stringify(f),1),a},_tryToLock:function(b){if(this._hasLockCookie())return void t.debug("session "+this.id+" is locked");var c=this._createLockCookie(),d=this;a.setTimeout(function(){t.debug("_tryToLock","reading lock-tag for session "+d.id);var a=d._getLockCookie();return a?void(a.tag===c?(t.debug("_tryToLock","managed to acquire lock for session "+d.id+"using lock-tag "+c),b()):t.debug("_tryToLock","could not acquire lock for session "+d.id+" (was hopping for tag "+c+" but got "+a.tag+")")):void t.debug("_tryToLock","no lock for session (released by other tab) "+d.id)},1e3*p)},_destroy:function(){t.debug("_destroy","destroing visitor session "+this.id+" from localStorageManager"),d.removeItem(this._key)},clear:function(a){var b=this;this._tryToLock(function(){var c=b._serialize();b._destroy(),b._releaseLockCookie(),a(c)})}},u._deserialize=function(a){var b=new u(a.id,a.visitorId,a.userId,a.spotId,a.url,a.domain);return b.isClosed=a.isClosed,b.lastSeenFocused=a.lastSeenFocused,b.startTime=a.startTime,b.timeExpanded=a.timeExpanded,b.timeSpent=a.timeSpent,b};var v=null,w={setCurrentSession:function(a){v=a},createNewSession:function(a,b,c,d){var f=e.guid();return t.debug("createNewSession","id: {0}, visitorId: {1}, userId: {2}, spotId: {3}, url: {4}, domain: {5}",[f,j,a,b,c,d]),new u(f,j,a,b,c,d)}};return i.on("blur",function(){v&&v.blur()}),i.on("focus",function(){v&&v.focus()}),g.$watch("state",function(a){v&&(v.focus(),"spot-state"===a?v.expand():"notices-closed-state"===a&&v.collapse())}),a.setInterval(function(){t.debug("About to clear past sessions"),l(function(a){a.timeSpent<=0?t.debug("we will not track session "+a.id+" because no time was spent during that session."):m(a)})},5e3),h.subscribeLoginChange(function(){h.isRegistered&&v&&(t.debug("Setting the user_id for the current session: "+h.getUser().id),v.userId=h.getUser().id)}),w}]),angular.module("spot.im.ui",["spot.im.utils"]),angular.module("spot.im.embed",["spot.im.utils","spot.im.core","spot.im.ui","ngAnimate","ui.router","ui.utils","ui.bootstrap","pasvaz.bindonce","monospaced.elastic","duScroll"]).config(["LoggerProvider",function(a){a.enabled(window.logsOn)}]).config(["$httpProvider",function(a){a.interceptors.push("parentUrlHeader")}]).constant("device","desktop_browser"),angular.module("spot.im.embed").factory("SpotActions",["$q","$rootScope","$state","modalUtils","facebookService","Message","$window","SessionUser","utils",function(a,b,c,d,e,f,g,h,i){var j=function(a){this.spot=a};return j.prototype={joinSpot:function(){var b=a.defer();return h.isRegistered?this.spot.joinSpot().then(b.resolve,b.reject):b.reject(),b.promise},toggleLikeMessage:function(a){var b=this;this.joinSpot().then(function(){b.spot.toggleLikeMessage(a)})},reportMessage:function(a){this.joinSpot().then(function(){f.getReportCategories().then(function(b){var c=b.title,e=b.reasons,f=function(b){return a.report(b)},g=[];for(var h in e)g.push({id:h,text:e[h]});d.selection(c,g,null,"Save",f,"report")})})},shareMessage:function(a){function c(){var c={height:400,width:400,crop:"fill"},f=a.getImageUrl(c)||d.spot.getSpotImageUrl(c),g={display:"popup",name:d.spot.name,link:b.parentUrl,description:a.text};f&&(g.picture=i.applyProtocol(f)),e.share(g).then(function(){a.share()})}var d=this;h.isRegistered?this.joinSpot().then(c):c()},openMessageModal:function(a){h.isRegistered?this.joinSpot().then(function(){d.spotMessageModal(a)}):d.spotMessageModal(a)},unkickMember:function(a){var b=this.spot;d.confirmation("Are you sure you want to unkick this member?").then(function(){b.unkickUser(a)})},kickMember:function(a){var b=this.spot;d.confirmation("Are you sure you want to kick this member?").then(function(){b.kickUser(a)})},removeHost:function(a){var b=this.spot;d.confirmation("Are you sure you want to remove this host?").then(function(){b.removeHost(a)})},addHost:function(a){var b=this.spot;d.confirmation("Are you sure you want to add this host?").then(function(){b.addHost(a)})},deleteMessage:function(b){var c=this.spot,e=a.defer();if(b.isMine())c.deleteMessage(b.id,h.getUser().id).then(e.resolve,e.reject);else{var f="Are you sure you want to delete this message?";d.confirmation(f,"Absolutely","Cancel","remove").then(function(){c.deleteMessage(b.id,h.getUser().id).then(e.resolve,e.reject)})}return e.promise},goToState:function(a,b){h.isRegistered?c.go(a,b):this.joinSpot().then(function(){c.go(a,b)})},goToUserProfile:function(a){this.goToState("app.user_profile.about",{userUniqueName:a})},goToUserProfileById:function(a){this.goToState("app.user_profile.user_profile_by_id",{userId:a})}},j}]),angular.module("spot.im.embed").factory("UserActions",["$state","$q","underscore","facebookService","modalUtils","User","SessionUser","$rootScope",function(a,b,c,d,e,f,g){var h=function(a){this.user=a};return h.prototype={shareProfile:function(){d.share({name:this.user.display_name,link:window.location.protocol+"//"+window.location.hostname+this.user.getProfileUrl(),description:this.user.about,picture:this.user.getUserImageUrl({height:400,width:400,crop:"fill"})})},reportUser:function(a){var b=this.user;f.getReportCategories().then(function(c){var d=c.title,f=c.reasons,g=function(c){return b.report(c,a)},h=[];for(var i in f)h.push({id:i,text:f[i]});e.selection(d,h,null,"Save",g,"report")})},inviteToSpot:function(){}},h.inviteIntimateSpot=function(a){var c=null;return c=g.isRegistered?a.inviteIntimate():b.reject()},h}]),angular.module("spot.im.embed").factory("embedOptions",["$location",function(a){var b=angular.extend({type:"floating",spotId:null,spotName:null},a.search());return b}]),angular.module("spot.im.embed").factory("initiatorApi",["$rootScope","$state","$timeout","$window","Events","$q","Logger","embedOptions","sso","tabFocus","appStage","stateHandler","trackerVent",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=g.getInstance("initiatorApi"),o=null,p=f.when(!0),q={_postMessage:function(a){d.parent!==d&&d.parent.postMessage(JSON.stringify(a),"*")},_callChangeState:function(b){var c=a.state,d=f.defer(),e=function(){a.$broadcast("initiator:stateChanged",c,b),d.resolve()},g=[p];return f.all(g).then(function(){if(a.state===b)e();else{n.debug("_callChangeState","Change the state from {0} to {1}",[c,b]);var d=a.$on("stateChanger:state-changed",function(){d(),n.debug("_callChangeState","Change the state from {0} to {1} completed",[c,b]),e()});l.changeState(b)}}),p=d.promise,d.promise},_handleMessage:function(b){var c=null;try{c=JSON.parse(b.data)}catch(d){}if(c){var e=q[c.action];e&&"function"==typeof e&&a.$safeApply(function(){e.call(q,c.params||{})})}},startListen:function(){d.addEventListener("message",this._handleMessage,!1)},windowSize:function(b){n.debug("windowSize","Launcher reports on new window size: {0} X {1}",[b.windowWidth,b.windowHeight]),a.sizes=b,this.trigger("windowSize",b)},boundingRect:function(a){n.debug("boundingRect","Launcher reports on bounding rect: {0} X {1} X {2} X {3}",[a.top,a.right,a.bottom,a.left]),this.trigger("boundingRect",a)},windowUrl:function(b){n.debug("windowUrl","Launcher Main window Url",b),a.parentUrl=b,this.trigger("windowUrl",b)},stateUpdated:function(){n.debug("stateUpdated","Launcher reports that state updated succesfully"),this.trigger("stateUpdated")},embedSizeApplied:function(){n.debug("embedSizeApplied","Launcher reports that new size applied succesfully"),this.trigger("embedSizeApplied")},websiteOpenEmbed:function(){this.spotState(),m.trigger("External API Embed Expanded")},destroyEmbed:function(){this._postMessage({action:"destroyEmbed"})},spotState:function(){return this._callChangeState("spot-state")},noticesClosedState:function(){return this._callChangeState("notices-closed-state")},noticesOpenedState:function(){return this._callChangeState("notices-opened-state")},modalState:function(){var b=f.defer();if("static"===h.type){var c=this;this.requestBoundingRect().then(function(d){a.stateChangerOptions={paddingTop:d.top,paddingLeft:d.left},c._callChangeState("modal-state").then(b.resolve)})}else this._callChangeState("modal-state").then(b.resolve);return b.promise},syncInitialState:function(a){n.debug("syncInitialState","Syncing launcher with initial state of {0}",[a]);var b=this,c=f.defer();o=c.promise;var d=q.performanceReportStart("syncInitialState",new Date);return this.requestWindowSize().then(function(){return b._callChangeState(a)}).then(function(){k.setStage("visible"),q.performanceReportEnd("syncInitialState",d,new Date)})},requestWindowSize:function(){var a=f.defer();return this.once("windowSize",a.resolve),this._postMessage({action:"requestWindowSize"}),a.promise},requestBoundingRect:function(){var a=f.defer();return this.once("boundingRect",a.resolve),this._postMessage({action:"requestBoundingRect"}),a.promise},applyEmbedSize:function(a,b,c){n.debug("applyEmbedSize","Ask launcher to apply the embed size to {0} X {1}",[a,b]),this.once("embedSizeApplied",c),this._postMessage({action:"applyEmbedSize",params:{width:a,height:b}})},applyEmbedState:function(b,c){n.debug("applyEmbedState","Ask launcher to apply the embed state to {0}",[b]);var d=b.replace(/-([a-z])/g,function(a){return a[1].toUpperCase()});this.once("stateUpdated",c),this._postMessage({action:d,params:{state:b,position:a.position}})},startSSOProcess:function(){this._postMessage({action:"startSSOProcess"})},setTabCounter:function(a){this._postMessage({action:"setTabCounter",params:a})},notifyEmbedFocus:function(){this._postMessage({action:"notifyEmbedFocus"})},notifyEmbedBlur:function(){this._postMessage({action:"notifyEmbedBlur"})},updateTabFocus:function(){j.focus()},updateTabBlur:function(){j.blur()},loginSSOUser:function(a){try{n.debug("loginSSOUser","Called with {0}",[JSON.srtingify(a)])}catch(b){n.debug("loginSSOUser","Called with "+a+" (failed to srtingify)")}i.loginUser(a)},performanceReportStart:function(){},performanceReportEnd:function(){}};return angular.extend(q,e),q}]),angular.module("spot.im.embed").factory("domainOptions",["localStorageManager",function(a){var b=20140327,c={initialize:function(a){this.domain=a},_getOptions:function(){var c=null;try{c=JSON.parse(a.getItem(this.domain)),c&&c.version===b||(c=null)}catch(d){}return c||{}},_setOptions:function(c){try{var d=angular.extend({},c,{version:b});a.setItem(this.domain,JSON.stringify(d))}catch(e){}},setOption:function(a,b){if(this.domain){var c=this._getOptions();c[a]=b,this._setOptions(c)}},getOption:function(a){if(!this.domain)return null;var b=this._getOptions();return b[a]},getInitialState:function(){var a=this.getOption("initialState");
return-1===["notices-closed-state","spot-state"].indexOf(a)&&(a=null),a},setInitialState:function(a){"modal-state"!==a&&("notices-opened-state"===a&&(a="notices-closed-state"),this.setOption("initialState",a))}};return c}]),angular.module("spot.im.embed").factory("mainSpot",["embedOptions","domainOptions","$injector","$state","$q","SpotsManager","underscore",function(a,b,c,d,e,f,g){function h(b){var d=c.get("SessionUser");d.initialConnectionPromise.then(function(){var c={stage:null};return a.domain&&(c.domain=a.domain),f.getSpot(b,!0,{params:c})}).then(l.resolve,l.reject)}function i(){return"spot-"+(a.spotId||a.spotName)}function j(a){return{brandColor:a.brand_color,position:a.embed_position,iconUrl:a.getSpotIconUrl({width:70,height:70}),bubbleTextColor:a.bubble_text_color}}function k(a){var c=i(),d=j(a);b.setOption(c,d)}var l=e.defer(),m=l.promise,n={promise:m,initialize:function(){a.spotId?this.setSpotById(a.spotId):a.spotName&&this.setSpotByName(a.spotName),a.spotRename&&(this.spotRename=a.spotRename),a.iconUrl&&(this.iconUrl=a.iconUrl),this.then(k)},isReady:function(){return"fulfilled"===m.state},setSpotByName:function(a){h({type:"public",name:a})},setSpotById:function(a){h({id:a})},redirect:function(a){this.then(function(a){var b=a.getSpotUrlState(),c=d.is("app.public_spot_by_id")&&g.isEqual(d.params,{spotId:a.id})||d.includes("app.public_spot.**")&&g.isEqual(d.params,{spotEncodedName:a.getEncodedName()});c||d.transitionTo(b.stateName,b.stateParams)},a)},then:function(a,b){return m.then(a,b)},getSpotOptions:function(){var a=i(),c=b.getOption(a),d=e.when(c||this.then(function(a){return j(a)}));return d}};return n}]),angular.module("spot.im.embed").factory("stateHandler",["$rootScope",function(a){function b(a){return["notices-closed-state","notices-opened-state"].indexOf(a)>=0}function c(a){return["spot-state","modal-state"].indexOf(a)>=0}function d(b,d){return j(b,d).then(function(){a.state=d,e(b,d);var g=c(b),h=c(d);g!==h&&f(h)})}function e(a,b){k.forEach(function(c){c(a,b)})}function f(a){l.forEach(function(b){b(a)})}var g=!1,h=null,i=null,j=null,k=[],l=[],m={registerDOMChanger:function(a){j=a,g&&d(i,h).then(function(){g=!1})},onChangeState:function(a){a&&"function"==typeof a&&k.push(a)},onOpenCloseSpot:function(a){a&&"function"==typeof a&&l.push(a)},changeState:function(b){i=a.state,h=b,j?d(i,h):g=!0},is:function(b){return angular.isArray(b)||(b=[b]),b.indexOf(a.state)>=0},isSpotClosed:function(){return b(a.state)},isSpotOpened:function(){return c(a.state)}};return m}]),angular.module("spot.im.embed").factory("stateProviderBridge",["$state","$stateParams",function(a){return{mapState:function(a,b){var c=null,d=null;switch(a){case"intimate-spot-by-id":c="app.intimate_spot.chat",d={spotId:b.id};break;case"public-spot-by-id":c="app.public_spot_by_id",d={spotId:b.id};break;case"public-spot-by-name":c="app.public_spot.chat",d={spotEncodedName:b.name};break;case"user-profile-by-id":c="app.user_profile_by_id",d={userId:b.id};break;case"user-profile-by-name":c="app.user_profile.about",d={userUniqueName:b.name};break;case"message-by-id":c="app.message",d={messageId:b.id};break;default:c=a,d=b}return{stateName:c,stateParams:d}},href:function(b,c){var d=this.mapState(b,c);return a.href(d.stateName,d.stateParams)},transitionTo:function(b,c){var d=this.mapState(b,c);a.transitionTo(d.stateName,d.stateParams)}}}]),angular.module("spot.im.embed").factory("sessionStarter",["$rootScope","$q","pusherService","SessionUser","initiatorApi",function(a,b,c,d,e){function f(){j||(c.connect(),j=!0,i.resolve())}function g(b){if(d.canLogin())f();else if("spot-state"===b)f();else var c=a.$watch("state",function(a){"spot-state"===a&&(c(),f())})}function h(){d.afterLogout(),e.destroyEmbed()}var i=b.defer(),j=!1;return d.isExiled&&h(),d.on("user-exiled",h),{promise:i.promise,initialize:g}}]),angular.module("spot.im.embed").factory("embedSession",["$rootScope","utils","localStorageManager","domainOptions",function(a,b,c,d){var e=0,f="global-embed-session",g="domain-embed-session",h=432e5,i=function(){this._read(),(new Date).getTime()-this.lastActivity>h&&this._restartSession(),this.lastActivity=(new Date).getTime(),this._store()};i.prototype={_read:function(){},_store:function(){},_getData:function(){return{startTime:this.startTime||null,lastActivity:this.lastActivity,actionsPool:this.actionsPool,persistentPool:this.persistentPool}},_setData:function(a){this.startTime=a.startTime||e,this.lastActivity=a.lastActivity||e,this.actionsPool=a.actionsPool||{},this.persistentPool=a.persistentPool||{}},_restartSession:function(){this.startTime=(new Date).getTime(),this.actionsPool={}},addAction:function(a,b){var c=a?this.persistentPool:this.actionsPool;c[b]||(c[b]=[]),c[b].push((new Date).getTime()),this._store()},clearAction:function(a,b){var c=a?this.persistentPool:this.actionsPool;c[b]&&(c[b].length=0,this._store())},getActionHistory:function(a,b){var c=a?this.persistentPool:this.actionsPool;return c[b]||[]},getLastOccurence:function(a,b){var c=this.getActionHistory(a,b),d=c.length>0?c[c.length-1]:e;return d},isHappened:function(a,b){return this.getActionHistory(a,b).length>0},getTimeSinceLastOccurence:function(a,b){return(new Date).getTime()-this.getLastOccurence(a,b)}};var j=b.extend(i,{_read:function(){var a=null;try{a=JSON.parse(c.getItem(f))}catch(b){}this._setData(a||{})},_store:function(){var a=JSON.stringify(this._getData());c.setItem(f,a)}}),k=b.extend(i,{_read:function(){var a=d.getOption(g)||{};this._setData(a)},_store:function(){d.setOption(g,this._getData())}});return{global:new j,domain:new k}}]),angular.module("spot.im.embed").factory("sso",["$injector","SessionUser","deviceManager","CloudinaryService","$q","Logger","localStorageManager","Events",function(a,b,c,d,e,f,g,h){function i(){g.setItem("isSsoUser",!0),k.isSsoUser=!0,k.trigger("markSsoUser")}var j=f.getInstance("sso"),k=angular.extend({isSsoUser:"true"===g.getItem("isSsoUser"),initialize:function(){if(c.hasDevice())return void j.debug("we already have a device so SSO is not relevant...");var b=a.get("initiatorApi");b.startSSOProcess()},loginUser:function(a){if(a.error)return j.error("sso to Spot.IM server failed"),void j.error(a.error);var c=a.device;c&&b.apiLoginWithNewDevice(c).then(function(){a.is_new_user&&i()})},unmarkSsoUser:function(){g.removeItem("isSsoUser"),this.isSsoUser=!1,this.trigger("unmarkSsoUser")}},h);return k}]).run(["sso","$document",function(a,b){function c(){b.one("click",function(){a.unmarkSsoUser()})}a.on("markSsoUser",function(){c()}),a.isSsoUser&&c()}]),angular.module("spot.im.embed").factory("mobileCode",["$q","$window","User","isoCountryCodes","trackerVent",function(a,b,c,d,e){function f(){h.ttlSeconds<=0&&h.timerTimeoutId?(b.clearTimeout(h.timerTimeoutId),h.timerTimeoutId=null,"phone-enter"!==h.step&&(h.step="phone-enter")):(h.ttlSeconds--,g.forEach(function(a){a(h.ttlSeconds)}),h.timerTimeoutId=b.setTimeout(f,1e3))}var g=[],h={countryCode:"",phoneNumber:null,isVisible:!1,verificationCode:null,ttlSeconds:null,step:null,isSmsSent:!1,timerTimeoutId:null,open:function(a){this.isVisible=!0,null==this.step&&(this.step="phone-enter"),e.trigger("Mobile Code Open",a)},close:function(){this.isVisible=!1},onTick:function(a){a&&"function"==typeof a&&g.push(a)},startTimer:function(){this.timerTimeoutId||f()},sendSms:function(){var b=this,d=this.countryCode+this.phoneNumber;return c.sendSms(d).then(function(a){b.verificationCode=a.mobile_code,b.ttlSeconds=a.ttl}).catch(function(){return a.reject("Oops... That didn't work. Please try again.")})},getCode:function(){var b=this;return c.getMobileCode().then(function(a){b.verificationCode=a.mobile_code,b.ttlSeconds=a.ttl},function(){return a.reject("Oops... That didn't work. Please try again.")})}};return d.loadPromise.then(function(){h.countryCode=d.currentCountry.code}),h}]),angular.module("spot.im.embed").factory("stickers",["CloudinaryService",function(a){function b(b,c,d){var e="stickers/"+b+"/"+c;return a.getUrl(e,angular.extend({},d,{namespace:""}))}return{getStickerUrl:b}}]),angular.module("spot.im.embed").factory("easterEggs",[function(){return{catchCommand:function(a){var b=!1;return b}}}]),angular.module("spot.im.embed").directive("stateChanger",["initiatorApi","$rootScope","$window","$timeout","$animate","jquery","Logger","stateHandler",function(a,b,c,d,e,f,g,h){var i=g.getInstance("stateChanger"),j={"notices-closed-state":0,"notices-opened-state":4,"spot-state":8,"modal-state":12};return{restrict:"A",link:function(c,g){function k(c){if("modal-state"===c)return f.when(!0);for(var d=g.children(":not(.ng-hide)"),e=d.map(function(){var a,c,d=f(this);return c=d.outerHeight(!0)+1+(parseInt(d.css("bottom"),0)||0),"left"===b.position?a=d.outerWidth(!0)+1+(parseInt(d.css("left"),0)||0):"right"===b.position&&(a=d.outerWidth(!0)+1+(parseInt(d.css("right"),0)||0)),{height:c,width:a}}),h=0,i=0,j=0;j<e.length;j++)h=Math.max(h,e[j].height),i=Math.max(i,e[j].width);var k=f.Deferred(),l=5;return a.applyEmbedSize(i+l+"px",h+l+"px",k.resolve),k.promise()}function l(b){var c=f.Deferred();return a.applyEmbedState(b,c.resolve),c.promise()}function m(a){i.debug("hide","Hides element {0}",[a.selector]);var b=f.Deferred();return e.addClass(a,"ng-hide",b.resolve),b.then(function(){i.debug("hide","Element {0} hidden",[a.selector])}),b.promise()}function n(a){i.debug("show","Shows element {0}",[a.selector]);var b=f.Deferred();return e.removeClass(a,"ng-hide",b.resolve),b.then(function(){i.debug("show","Element {0} showed",[a.selector])}),b.promise()}function o(a){var b=null,c=[],d=function(){};["modal-state","spot-state"].indexOf(a)>-1?(b=s,c=[u],t.length>0&&c.push(t),d=function(){g.removeClass("default-visible notices-visible").addClass("spot-visible")}):["notices-opened-state"].indexOf(a)>-1?(b=t,c=[s,u],d=function(){g.removeClass("spot-visible default-visible").addClass("notices-visible")}):["notices-closed-state"].indexOf(a)>-1&&(b=u,c=[s],t.length>0&&c.push(t),d=function(){g.removeClass("spot-visible notices-visible").addClass("default-visible")});var e=f.Deferred();return v.then(function(){var a=c.map(m);f.when.apply(f,a).then(function(){return d(),n(b)}).then(e.resolve)}),v=e.promise(),e.promise()}function p(){var a=b.stateChangerOptions||{};b.stateChangerOptions=null,g.css({paddingTop:a.paddingTop||"",paddingLeft:a.paddingLeft||""})}function q(a){var b=f.Deferred();return o(a).then(function(){return p(),l(a)}).then(function(){return k(a)}).then(b.resolve),b.promise()}function r(a){var b=f.Deferred();return l(a).then(function(){return p(),o(a)}).then(function(){return l(a)}).then(function(){return k(a)}).then(b.resolve),b.promise()}var s=angular.element(".spot-bubble"),t=angular.element(".notices-bubble"),u=angular.element(".default-bubble"),v=f.when(!0);h.registerDOMChanger(function(a,c){var d=j[a]>j[c]?q(c,a):r(c,a);return d.then(function(){b.$emit("stateChanger:state-changed")}),d}),c.$watch("sizes",function(a,c){a!==c&&d(function(){k(b.state)},100)})}}}]),angular.module("spot.im.embed").directive("mySpotsClass",["$animate","$rootScope","$state",function(a,b,c){return{restrict:"A",link:function(d,e,f){function g(b){a.addClass(e,i,b)}function h(b){a.removeClass(e,i,b)}var i=f.mySpotsClass;d.$watch("showMySpots",function(a,d){if(a!==d)if(a)g();else{if(b.mySpotsSpot){var e=b.mySpotsSpot.getSpotUrlState();b.mySpotsSpot=null,c.is(e.stateName,e.stateParams)||c.go(e.stateName,e.stateParams)}h()}})}}}]),angular.module("spot.im.embed").directive("onClickAnalytics",["trackerVent",function(a){return{restrict:"A",link:function(b,c,d){function e(){var c=[];d.analyticsParmeters&&(c=b.$eval(d.analyticsParmeters)),c.unshift(d.onClickAnalytics),a.trigger.apply(a,c)}c.bind("click",e)}}}]),angular.module("spot.im.embed").directive("paintedStageMarker",["appStage","$timeout",function(a,b){return{restrict:"A",link:function(){b(function(){a.setStage("painted")})}}}]),angular.module("spot.im.embed").provider("$stateDefaultOptions",[function(){var a={};this.set=function(b){a=angular.extend({},b)},this.$get=[function(){return a}]}]).config(["$provide",function(a){a.decorator("$state",["$delegate","$stateDefaultOptions",function(a,b){var c=a.go;a.go=function(d,e,f){var g=angular.extend({},b,f);return c.apply(a,[d,e,g])};var d=a.transitionTo;return a.transitionTo=function(c,e,f){var g=angular.extend({},b,f);return d.apply(a,[c,e,g])},a}])}]),angular.module("spot.im.embed").factory("parentUrlHeader",["embedOptions","apiUrl","apiCdnUrl",function(a,b,c){return{request:function(d){return!a.parentUrl||0!==d.url.indexOf(b)&&0!==d.url.indexOf(c)||(d.headers["x-embed-url"]=a.parentUrl),d}}}]),angular.module("spot.im.embed").run(["$rootScope","mainSpot","utils","CloudinaryService","$window","embedOptions",function(a,b,c,d,e,f){function g(a){a||(a="#0086ff");var b=d.getUrl(k,{colorize:a,extension:"png"});c.addCssRule([".branded-icons:hover",".branded-icons-hover-after:hover:after",".branded-icons-active",".branded-icons-after:after",".branded-icons-before:before",".branded-icons-before-hover:hover:before",".branded-icons-before-active:before",".branded-icons-parent .branded-icons-child",".branded-icons-parent .branded-icons-child-after:after",".branded-icons-parent .branded-icons-child-before:before",".branded-icons-parent-hover:hover .branded-icons-child",".branded-icons-parent-hover:hover .branded-icons-child-after:after",".branded-icons-parent-hover:hover .branded-icons-child-before:before"].join(", "),{"background-image":"url("+b+") !important"}),c.addCssRule([".branded-text",".branded-text-hover:hover",".branded-text-active",".branded-text-parent-hover:hover .branded-text-child"].join(", "),{color:a+" !important"}),c.addCssRule([".branded-border-bottom",".branded-border-bottom-hover:hover"].join(", "),{"border-bottom-color":a+"!important"}),c.addCssRule([".branded-border-top",".branded-border-top-hover:hover",".branded-border-top-after:after"].join(", "),{"border-top-color":a+"!important"}),c.addCssRule([".branded-border",".branded-border-hover:hover",".branded-border-active:active",".branded-border-after:after"].join(", "),{"border-color":a+" !important"}),c.addCssRule([".branded-bg",".branded-bg-after:after",".branded-bg-hover:hover",".branded-bg-active:active",".branded-bg-parent-hover:hover .branded-bg-child-after:after",".branded-bg-parent-hover:hover .branded-bg-child"].join(", "),{"background-color":a+" !important"}),c.addCssRule(".branded-bg-transparent-"+100*h,{"background-color":c.hexToRGB(a,h)+" !important"}),c.addCssRule(".branded-bg-transparent-hover-"+100*i+":hover",{"background-color":c.hexToRGB(a,i)+" !important"}),c.addCssRule([".branded-bg-transparent-"+100*j,".branded-bg-transparent-hover-"+100*j+":hover",".branded-bg-transparent-active-"+100*j+":active"].join(", "),{"background-color":c.hexToRGB(a,j)+" !important"}),c.addCssRule([".branded-text",".branded-text-hover:hover",".branded-text-parent .branded-text-child",".branded-text-parent-hover:hover .branded-text-child"].join(", "),{color:a+" !important"});var e=new Image;e.src=b}var h=.7,i=.05,j=.15,k=e.brandedObjectId;b.getSpotOptions().then(function(a){g(f.brandColor||a.brandColor)})}]),angular.module("spot.im.embed").run(["$window","$rootScope","initiatorApi","tabFocus",function(a,b,c,d){function e(a){d.isFocus?g=a:(h=a-g,h>0&&c.setTabCounter(h))}function f(a){if(i!==a.type)switch(a.type){case"blur":c.notifyEmbedBlur();break;case"focus":c.notifyEmbedFocus()}i=a.type}var g=0,h=0;d.on("focus",function(){g+=h,h=0}),b.$watch("unreadIntimateMessages + invitations.unviewedCount + notifications.unviewedCount",e);var i=null;angular.element(a).on("blur focus",f)}]).factory("tabFocus",["Events",function(a){var b=angular.extend({isFocus:!0,focus:function(){this.isFocus=!0,this.trigger("focus")},blur:function(){this.isFocus=!1,this.trigger("blur")}},a);return b}]),angular.module("spot.im.embed").config(["$stateDefaultOptionsProvider",function(a){a.set({location:"replace"})}]).config(["appStageProvider",function(a){a.initialize(["started","painted","visible","authenticated"])}]).run(["browser","$document",function(a,b){b.find("body").addClass(a.name)}]).run(["domainOptions","embedOptions","$rootScope",function(a,b,c){a.initialize(b.domain),c.$watch("state",function(b){a.setInitialState(b)})}]).run(["initiatorApi",function(a){a.startListen()}]).run(["mainSpot","initiatorApi","Logger",function(a,b,c){var d=c.getInstance("mainSpot-initializer");a.initialize(),a.then(null,function(){d.error("Main spot doesn't exist"),b.destroyEmbed()})}]).run(["device","embedOptions","$rootScope","$window","$state","trackerUtils","trackerVent","Logger","sessionStarter","historyTracker","SessionUser","initiatorApi","mainSpot","domainOptions","appStage","utils","sso","visitorId",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=h.getInstance("embed-initializer");try{d.document.domain="spot.im",d.name="spot-im"}catch(t){s.error("Can't set document.domain to 'spot.im': {0}",[t.toString()])}f.setEnvironment(a,"embed",b.type),c.$state=e,c.options=b,c.bodyClasses=[b.type],c.parentUrl=b.parentUrl,c.rootPath=e.href("app"),c.appStoreUrl=d.appStoreUrl,c.googlePlayUrl=d.googlePlayUrl,c.websiteUrl=d.websiteUrl,b.undocked&&c.bodyClasses.push("undocked"),c.afterRender=function(){o.stagePromise("visible").then(function(){var a=k.getUser(),c=null;a&&(c=a.id);var d={url:b.parentUrl,visitor_id:r,user_id:c};b.spotId&&(d.spot_id=b.spotId,f.trackInfluxdb("embed_spot_load_end",d))})},c.$on("$stateChangeStart",function(a,b,c){switch(b.name){case"app.message":case"app.spot_invite":case"app.manage_spots":case"app.disclaimer.privacy":case"app.disclaimer.terms":g.trigger("Create Spot Clicked","embed");var f=d.websiteUrl+e.href(b,c).replace("/embed","");return d.open(f),void a.preventDefault()}"app.otherwise"===b.name&&(a.preventDefault(),m.redirect(function(){e.transitionTo("app.not_found")}))}),j.start(["app.public_spot_by_id","app.user_profile_by_id"]),c.state=null,k.subscribeLoginChange(function(a){var b=c.bodyClasses.indexOf("registered");a&&0>b?c.bodyClasses.push("registered"):b>=0&&c.bodyClasses.splice(b,1)}),k.initialize(),m.getSpotOptions().then(function(a){c.position=b.position||a.position||"right",c.bodyClasses.push(c.position);var d=b.state||n.getInitialState()||"notices-closed-state";"static"===b.type&&(d="spot-state",b.width&&p.addCssRule(".spot-im-embed.static .spot-bubble",{width:b.width}),b.height&&p.addCssRule(".spot-im-embed.static .spot-bubble",{height:b.height})),i.initialize(d),l.syncInitialState(d),q.initialize()})}]).run(["mainSpot","visitorSessions","SessionUser","$rootScope","embedOptions",function(a,b,c,d,e){a.then(function(a){var f=e.domain,g=e.parentUrl,h=c.isRegistered?c.getUser().id:null,i=b.createNewSession(h,a.id,g,f);b.setCurrentSession(i),i.open(),"spot-state"==d.state?i.expand():"notices-closed-state"==d.state&&i.collapse()})}]),angular.module("spot.im.embed").directive("actionsMenu",["$rootScope","$window","$state","$compile","utils",function(a,b,c,d,e){var f=function(a){function b(b){var c=angular.extend({name:"",stateName:null,stateParams:{},onClick:null},b);a.items.push(c)}function c(c){a.$evalAsync(function(){a.items.length=0;for(var d=0;d<c.length;d++)b(c[d])})}a.items=[],a.onClick=function(a,b){b.onClick&&"function"==typeof b.onClick&&b.onClick()};var f=e.preloadTemplate("/templates/common/directives/actions-menu.html").then(function(b){return d(b)(a)});return{getTemplate:function(){return f},setItems:c}}(a.$new(!0));return{restrict:"A",scope:!0,link:function(a,c,d){function e(a){function d(){h?(b.clearTimeout(h),h=null):(f.setItems(g),a.appendTo(c).css("top",c.height()))}function e(){h=b.setTimeout(function(){a.remove(),h=null},200)}c.on("mouseenter",d).on("mouseleave",e).on("click",e)}var g=a.$eval(d.actionsMenu),h=null;f.getTemplate().then(e)}}}]),angular.module("spot.im.embed").directive("bendText",["direction",function(a){return{restrict:"A",link:function(b,c,d){function e(a,b,c){var d=180/Math.PI,e=b-c,f=0;return a.forEach(function(a){f+=a[0].offsetWidth/2/e*d,a.rotation=f,f+=a[0].offsetWidth/2/e*d}),f}function f(a,b){var d=parseInt(c.css("font-size"),10),f=a.split("").map(function(a){return angular.element("<span>"+a.replace(" ","&nbsp;")+"</span>")}),g=0,h=0,i=0;c.empty(),c.append(f),g=f.reduce(function(a){return a+f[h].offsetWidth},0),i=e(f,b,d),f.forEach(function(a){a.css({position:"absolute",left:"50%",marginLeft:-(a[0].offsetWidth/2)/d+"em",transform:"rotate("+(1*-i/2+a.rotation)+"deg)",transformOrigin:"center "+b/d+"em"})})}function g(d){var e=b.defaultBubbleData.className;if(e!==h&&(c.addClass(e),c.removeClass(h),h=e),d.length>0){var g=d;a.isTextRTL(g)&&(g=g.split("").reverse().join("")),c.empty(),f(g,i)}}var h=null,i=d.radius;b.$watch(d.bendText,g),b.$on("bend-text",g)}}}]),angular.module("spot.im.embed").directive("dynamicAlerts",["$animate","$timeout","$window",function(a,b,c){return{restrict:"E",replace:!0,templateUrl:"/templates/common/directives/dynamic-alerts.html",controller:["$scope","dynamicAlerts",function(a,b){function c(b){a.alertsList.push(b),a.inProgress||a.$broadcast("showQueue")}a.alertsList=[],a.inProgress=!1,b.on("intimate-message",c),b.on("public-message",c),b.on("message-liked",c),b.on("intimate-invitation-accepted",c),b.on("intimate-invitation-received",c),b.on("user-mentioned",c)}],link:function(d,e){function f(){a.addClass(e,"animate-off",function(){e.removeClass("animate-on animate-off"),d.alert=null,d.inProgress=!1})}function g(){k?c.setTimeout(g,200):f()}function h(){var a=d.alertsList[0];d.$evalAsync(function(){d.alert=a}),b(function(){e.find(".text").dotdotdot()})}function i(){d.alertsList.shift(),0===d.alertsList.length?g():(h(),b(i,j))}var j=5e3,k=!1;e.on("mouseenter",function(){k=!0}).on("mouseleave",function(){k=!1}),d.$on("showQueue",function(){h(),d.inProgress=!0,a.addClass(e,"animate-on",function(){b(i,j)})}),d.close=function(a){a.preventDefault(),f()}}}}]),angular.module("spot.im.embed").directive("facesList",["$timeout","$window",function(a,b){return{restrict:"A",templateUrl:"/templates/common/faces-list.html",scope:{usersList:"=facesList",imageOptions:"=",onlineMembers:"=",faceClick:"=?"},link:function(c,d,e){function f(){a(function(){var a=d.width(),b=Math.floor(a/g);b=Math.min(b,c.usersList.length),c.facesList.length=0;for(var e=0;b>e;e++)c.facesList.push(c.usersList[e])})}var g=c.$eval(e.faceWidth);c.facesList=[],c.$watchCollection("usersList",f),angular.element(b).on("resize",f),d.bind("$destroy",function(){angular.element(b).off("resize",f)})}}}]),angular.module("spot.im.embed").directive("navigationMenu",["$timeout","$rootScope","$window","$state",function(a,b,c,d){return{restrict:"A",templateUrl:"/templates/common/directives/navigation-menu.html",scope:!0,controller:["$scope",function(a){a.items=[],a.selectedItem=null,a.isVisible=!1;var b=this;a.onClick=function(c,d){a.selectedItem=d,b.hideMenu()},this.addItem=function(b){var c=angular.extend({name:"",stateName:null,stateParams:{},onClick:null},b);a.items.push(c),this.stateChanged()},this.stateChanged=function(){a.items.forEach(function(b){b.stateName&&d.is(b.stateName)&&(a.selectedItem=b)})},this.showMenu=function(){a.$evalAsync(function(){a.isVisible=!0})},this.hideMenu=function(){a.$evalAsync(function(){a.isVisible=!1})}}],link:function(a,c,d,e){for(var f=a.$eval(d.navigationMenu),g=0;g<f.length;g++)e.addItem(f[g]);c.on("mouseenter",e.showMenu).on("mouseleave",e.hideMenu);var h=b.$on("$stateChangeSuccess",e.stateChanged);a.$on("$destroy",h)}}}]),angular.module("spot.im.embed").directive("spotItem",function(){return{templateUrl:"/templates/common/spot-item.html",replace:!0,restrict:"E",scope:{spot:"=",hrefClick:"&"},controller:["$scope","OnlineMembers",function(a,b){a.lastActivityDate=a.spot.last_activity_date,a.latestMessage=null,"intimate"===a.spot.type&&(a.onlineMembers=b.get(a.spot)),a.$watch("spot.messages.length",function(){a.latestMessage=a.spot.getLatestMessage(),a.latestMessage&&(a.lastActivityDate=a.latestMessage.timestamp)}),a.$on("$destroy",function(){a.onlineMembers&&a.onlineMembers.destroy()})}]}}),angular.module("spot.im.embed").directive("messageBubbleLink",[function(){return{restrict:"EA",templateUrl:"/templates/common/message-bubble/link.html"}}]),angular.module("spot.im.embed").controller("MessageBubbleController",["$q","$rootScope","$element","$filter","$scope","SpotsManager","SpotActions","UsersManager","SessionUser","underscore","mobileCode",function(a,b,c,d,e,f,g,h,i,j,k){e.bounceALike=!1,e.messageType=e.message.getMessageType(),e.senderImage=e.message.getSenderImageUrl({width:36,height:36,crop:"fill"}),e.messageText=d("linkey")(d("escape")(e.message.text),"branded-text"),e.hasText=e.message.text,e.session=i,e.messageEntities=[],e.message.entities&&e.message.entities.forEach(function(a){if(-1!==["user","spot"].indexOf(a.type)&&a.range){var b=e.message.text.substr(a.range[0],a.range[1]);e.messageEntities.push({type:a.type,id:a.entity_id,text:b,placeholder:b})}});var l=e.SIZES={MAX_BUBBLE_WIDTH:500,MAX_BUBBLE_HEIGHT:150,MIN_BUBBLE_WIDTH:120,MIN_BUBBLE_HEIGHT:70};if(e.isBlankCaret=!0,e.backgroundImage=null,e.mediaEntity=e.message.getFirstMediaEntity(),e.mediaEntity){var m=e.mediaEntity.getMediaSize(l.MAX_BUBBLE_WIDTH,l.MAX_BUBBLE_HEIGHT),n=e.mediaEntity.getImageUrl(m);e.backgroundImage=n,e.isThinImage=m.width<l.MIN_BUBBLE_WIDTH,e.isShortImage=m.height<l.MIN_BUBBLE_HEIGHT,e.isBlankCaret=!!(e.isThinImage||e.hasText&&"selfie"!==e.messageType||"sticker"===e.messageType)}e.openMobileCode=function(a,b){"web"!==b&&k.open(a)},a.all([f.getSpot({id:e.message.spot_id}),h.getUser({id:e.message.sender_id})]).then(function(a){e.spot=a[0],e.user=a[1],e.spotActions=new g(e.spot),e.isHost=e.spot.isHost(e.user.id),e.isMessageType=function(a){return e.messageType===a};var c=e.message.isMine();e.mineOrIntimate=c||"intimate"===e.spot.type,e.notMineOrIntimate=!c&&"intimate"!==e.spot.type,e.isMobileExclusive=["selfie","sticker"].indexOf(e.messageType)>-1&&!c,e.hasTextAndNotASelfie=e.hasText&&"selfie"!==e.messageType,e.toggleLike=function(){e.mineOrIntimate||(e.bounceALike=!0,window.setTimeout(function(){e.bounceALike=!1},1100),e.spotActions.toggleLikeMessage(e.message))},e.reply=function(){b.$broadcast("replyMention",{id:j.escape(e.user.id),name:j.escape(e.user.display_name),uniqe_name:j.escape(e.user.username),value:j.escape("@"+e.user.username),type:"user"})},e.openModal=function(){e.spotActions.openMessageModal(e.message)}}),e.$watch("message.text",function(a,b){a!==b&&(e.messageText=d("linkey")(d("escape")(e.message.text),"branded-text"))})}]),angular.module("spot.im.embed").directive("messageBubble",[function(){return{restrict:"A",templateUrl:"/templates/common/message-bubble/layout.html",controller:"MessageBubbleController",scope:{message:"=messageBubble"}}}]),angular.module("spot.im.embed").directive("messageBubblePhoto",[function(){return{restrict:"EA",templateUrl:"/templates/common/message-bubble/photo.html"}}]),angular.module("spot.im.embed").directive("messageBubbleSelfie",[function(){return{restrict:"EA",templateUrl:"/templates/common/message-bubble/selfie.html"}}]),angular.module("spot.im.embed").directive("messageBubbleSticker",[function(){return{restrict:"EA",templateUrl:"/templates/common/message-bubble/sticker.html",controller:["$scope","stickers",function(a,b){var c=a.message.getFirstMediaEntity();a.stickerUrl=b.getStickerUrl(c.category_id,c.sticker_id,{height:145,width:145})}]}}]),angular.module("spot.im.embed").directive("messageBubbleText",[function(){return{restrict:"EA",templateUrl:"/templates/common/message-bubble/text.html"}}]),angular.module("spot.im.embed").directive("messageBubbleVideo",[function(){return{restrict:"EA",templateUrl:"/templates/common/message-bubble/video.html",controller:["$scope",function(a){var b=190;a.isPlaying=!1,a.play=function(){a.isPlaying=!0;var c=a.mediaEntity.getMediaSize(a.SIZES.MAX_BUBBLE_WIDTH,b);a.backgroundImage=a.mediaEntity.getImageUrl(c)}}]}}]),angular.module("spot.im.embed").controller("MessagePreviewController",["$scope","$element","Message","modalUtils","SpotsManager","SessionUser",function(a,b,c,d,e,f){a.$watch("message",function(){a.message.entities.length>0&&(a.entity=a.message.getFirstMediaEntity())}),e.getSpot({id:a.message.spot_id}).then(function(b){a.hasDeletePermisson=a.message.isMine()||b.isHost(f.getUser().id)}),a.deleteMessage=function(e){d.confirmation("Are you sure you want to delete this message?").then(function(){c.deleteMessage(a.message.id).then(function(){b.parents(".media-item").remove()})}),e.stopPropagation()}}]),angular.module("spot.im.embed").directive("messagePreview",[function(){return{restrict:"E",templateUrl:"/templates/common/message-preview.html",controller:"MessagePreviewController",scope:{message:"=",isExpandable:"=",width:"=?",height:"=?",showInfo:"=",index:"=",hideBackdrop:"=",messageClick:"&"},link:function(a,b){a.height||(a.height=b.parent().height()),a.width||(a.width=b.parent().width())}}}]),angular.module("spot.im.embed").factory("modalUtils",["$modal","$modalStack","$q","jquery","SpotsManager","initiatorApi",function(a,b,c,d,e,f){function g(){var a=c.defer(),d=b.getTop();return d||f.spotState().then(function(){a.resolve()}),a.promise}return{open:function(b){var d=c.defer();return f.modalState().then(function(){a.open(b).result.then(function(){g().then(d.resolve)},function(){g().then(d.reject)})}),d.promise},selection:function(b,d,e,h,i,j){var k=c.defer();return f.modalState().then(function(){a.open({template:'<button class="close-button" ng-click="$dismiss()"></button><div class="modal-content"><div class="confirmation-message">'+b+'</div><ul class="selection-items"><li ng-repeat="item in data.items" class="item"><input class="reason-radio" type="radio" name="item-select" ng-model="data.selectedValue" ng-value="item.id" /><span ng-bind="item.text"></span></li></ul></div><div class="modal-buttons"><button class="approve-button ladda-button zoom-out" ng-click="onSave()" ng-disabled="isButtonDisabled()" ng-class="{ \'ladda-loading\': isLoading }"><span class="label" ng-bind="saveButtonText"></span><span class="spinner"></span></button></div>',controller:["$scope",function(a){a.saveButtonText=h||"Save",(null===e||void 0===e)&&(e=null),a.data={items:d||[],selectedValue:e},a.isButtonDisabled=function(){return a.isLoading||null===a.data.selectedValue},a.isLoading=!1,a.onSave=function(){function b(){a.isLoading=!1,a.$close(a.data.selectedValue)}function d(){a.isLoading=!1,a.$dismiss()}a.isLoading=!0;var e=i(a.data.selectedValue);c.when(e).then(b,d)}}],backdrop:!0,windowClass:"selection-modal-view "+j}).result.then(function(){g().then(k.resolve)},function(){g().then(k.reject)})}),k.promise},confirmation:function(b,d,e,h){var i=c.defer();return f.modalState().then(function(){a.open({template:'<button class="close-button" ng-click="$dismiss()"></button><div class="modal-content"><div class="confirmation-message">'+b+'</div></div><div class="modal-buttons"><button class="dismiss-button" ng-click="$dismiss()" ng-bind="cancelButtonText"></button><button class="approve-button" ng-click="$close()" ng-bind="okButtonText"></button></div>',controller:["$scope",function(a){a.okButtonText=d||"Ok",a.cancelButtonText=e||"Cancel"}],backdrop:!0,windowClass:"confirmation-modal-view "+h}).result.then(function(){g().then(i.resolve)},function(){g().then(i.reject)})}),i.promise},spotMessagesModal:function(b,d,h){var i=c.defer();return f.modalState().then(function(){a.open({templateUrl:"/templates/message/modal.html",controller:"MessageModalController",backdrop:!h,windowClass:"message-modal-view",resolve:{messages:function(){return b},currentIndex:function(){return d},spot:function(){return e.getSpot({id:b[0].spot_id})}}}).result.then(function(){g().then(i.resolve)},function(){g().then(i.reject)})}),i.promise},spotMessageModal:function(a){return this.spotMessagesModal([a],0)}}}]),angular.module("spot.im.embed").directive("pinnedMessage",[function(){return{restrict:"E",scope:{message:"=",width:"=?",height:"=?",messageClick:"&"},templateUrl:"/templates/common/pinned-message-directive.html",controller:["$scope",function(a){a.width=a.width||"170",a.height=a.height||"210",a.$watch("message",function(){a.entity=a.message.entities.length>0?a.message.getFirstMediaEntity():null
})}]}}]),angular.module("spot.im.embed").factory("sonification",["pusherEvents","$rootScope","SpotsManager","UsersManager","MessagesManager","$q","SessionUser","tabFocus",function(a,b,c,d,e,f,g,h){function i(){return h.isFocus===!1||"spot-state"!==b.state&&"modal-state"!==b.state}function j(){return g.getUser()&&g.getUser().muted}function k(a){return g.getUser()&&g.getUser().id===a}function l(){a.onAll(function(a,b,d){if(i()&&!j())switch(b){case"message":k(d.sender_id)||c.getSpot({id:d.spot_id}).then(function(a){"intimate"===a.type&&m.privateMessageRecived.play()});break;case"user_mentioned":k(d.mentioner.id)||m.notificationRecieved.play();break;case"message_liked":var e=k(d.sender_id);e&&m.notificationRecieved.play();break;case"invitation_accepted":k(d.invitee.id)||m.notificationRecieved.play();break;case"intimate_user_invited":m.notificationRecieved.play()}})}var m={messageSent:new Audio("/embed/assets/audios/message-sent.wav"),privateMessageRecived:new Audio("/embed/assets/audios/private_message.wav"),notificationRecieved:new Audio("/embed/assets/audios/notification-recived.wav")};return{start:l,sounds:{messageSent:"messageSent",privateMessageRecived:"privateMessageRecived",notificationRecieved:"notificationRecieved"},play:function(a,b){(b||i())&&!j()&&m.hasOwnProperty(a)&&m[a].play()}}}]).run(["sonification",function(a){a.start()}]),angular.module("spot.im.embed").directive("profileHover",["$window","$rootScope","UsersManager","MessagesManager","$compile","$q","$state","utils","tooltipUtils","UserActions","$document","tooltipsStack",function(a,b,c,d,e,f,g,h,i,j,k,l){var m="/templates/common/tooltips/profile-hover.html";return h.preloadTemplate(m),{restrict:"A",require:["^tooltipContainer","?^tooltipSizeBoundary"],scope:{userId:"=profileHover"},link:function(b,k,n,o){function p(){var a=t().then(u),c=h.preloadTemplate(m);f.all([c,a]).then(function(a){if(G){var c=a[0];z=e(c)(b),b.user=E,b.lastMessage=F;var d=E.getProfileUrlState();b.userStateName=d.stateName,b.userStateParams=d.stateParams,z.on("mouseenter",r).on("mouseleave",s).appendTo(C);var f=B&&B.getBoundaryElement();i.positionTemplate(z,C,k,f),C.addClass("profile-hover-opened")}})}function q(){C.removeClass("profile-hover-opened"),z&&(z.off("mouseenter",r).off("mouseleave",s).detach(),z=null)}function r(){null!==D&&a.clearTimeout(D)}function s(){H.close()}function t(){return c.getUser({id:b.userId},!0).then(function(a){return E=a,E.isZombie()?f.reject("User is zombie"):E},f.reject)}function u(){return E&&null!==E.last_message_id?d.getMessage({id:E.last_message_id}).then(function(a){F=a?a.getText():null}).catch(function(){F=null}):(F=null,f.when(F))}function v(){G=!0,H.open()}function w(){G=!1,D=a.setTimeout(function(){H.close()},200)}function x(){H.close(),k.off("mouseenter",v).off("mouseleave",w)}function y(){k.on("mouseenter",v).on("mouseleave",w)}b.user=null,b.lastMessage=null;var z=null;b.acceptIntimateSpot=function(a){var c=b.user,d=c.acceptIntimate();a&&d.then(function(){var a=c.getIntimateSpotUrlState();g.go(a.stateName,a.stateParams)})},b.inviteIntimateSpot=function(){var a=b.user;j.inviteIntimateSpot(a)};var A=o[0],B=o[1],C=A.getContainer(),D=null,E=null,F=null,G=!1,H=l.register({type:"profile-hover",openFn:p,closeFn:q,templateFn:function(){return z},triggerElement:k,allowTop:!0});y(),b.$on("$destroy",x)}}}]),angular.module("spot.im.embed").directive("signupTooltip",["SessionUser","utils","tooltipUtils","$rootScope","$compile","SocialLogin","currentSpotView","$document","tooltipsStack","translations","trackerVent",function(a,b,c,d,e,f,g,h,i,j,k){var l="/templates/common/tooltips/signup-tooltip.html";return b.preloadTemplate(l),{restrict:"A",require:["^tooltipContainer","?^tooltipSizeBoundary"],scope:{text:"@signupTooltip",signupAction:"&"},link:function(d,g,h,m){function n(){b.preloadTemplate(l).then(function(a){k.trigger("Login Opened"),"signupTranslate"in h&&(d.text=j.getAttribute(h.signupTranslate)),v=e(a)(d),v.on("click",".close",function(){z.close()}),v.appendTo(y);var b=x&&x.getBoundaryElement();c.positionTemplate(v,y,g,b)})}function o(){v&&(v.detach(),v=null)}function p(){angular.isFunction(d.signupAction)&&d.$evalAsync(function(){d.signupAction()})}function q(){p(),z.close()}function r(){a.isRegistered?p():z.open()}function s(a){return 13===a.keyCode?(a.preventDefault(),a.stopPropagation(),r(),!1):void 0}function t(){z.close(),"enter"===h.signupTrigger?g.off("keydown",s):g.off("click",r)}function u(){"enter"===h.signupTrigger?g.on("keydown",s):g.on("click",r)}var v=null;d.expendContent=!1,d.expendButton=function(){d.expendContent=!0},d.loginWith=function(a){var b=new f;b.quickLogin(a).then(q)},d.close=function(){z.close()};var w=m[0],x=m[1],y=w.getContainer(),z=i.register({type:"signup",openFn:n,closeFn:o,templateFn:function(){return v},triggerElement:g,allowTop:!0});u(),d.$on("$destroy",t)}}}]),angular.module("spot.im.embed").controller("DefaultBubbleController",["$scope","defaultBubbleData","stateHandler","pusherEvents","mainSpot",function(a,b,c,d,e){function f(){e.then(function(a){p&&(d.off(a.channel_name,"message",j),p=!1)})}function g(){e.then(function(a){p||(d.on(a.channel_name,"message",j),p=!0)})}function h(c){m=c,i()&&(a.showBendText=!0,b.setText(m+l))}function i(){return 0===a.unreadNotifications&&m>0}function j(){c.is("notices-closed-state")&&h(m+1)}function k(b){n=b,a.unreadNotifications=n-o,a.unreadNotifications>0&&(a.showBendText=!1)}var l=" NEW MESSAGES",m=0,n=0,o=0,p=!1;a.defaultBubbleData=b,a.unreadNotifications=0,a.showBendText=!0,a.$watch("unreadIntimateMessages + invitations.unviewedCount + notifications.unviewedCount",k),c.onOpenCloseSpot(function(c){c?(f(),a.showBendText=!1):(g(),o+=a.unreadNotifications,a.unreadNotifications=0,m=0,i()?(a.showBendText=!0,b.setText(m+l)):a.unreadNotifications>0?a.showBendText=!1:(a.showBendText=!0,b.applyDefaultText()))}),g()}]),angular.module("spot.im.embed").controller("MobileTooltipController",["$scope",function(a){a.openAppstore=function(b){a.openNewWindow(b,a.appStoreUrl)},a.openPlaystore=function(b){a.openNewWindow(b,a.googlePlayUrl)}}]),angular.module("spot.im.embed").controller("InvitationsController",["$scope","$state","invitations","entityStateResolver","stateProviderBridge",function(a,b,c,d,e){function f(a){var c=a.getIntimateSpotUrlState();b.go(c.stateName,c.stateParams)}c.clearUnviewedCounter(),a.tinyscrollbar={skipCondition:c.list.length<5},a.goToMainEntity=function(a,b){if(b.main&&"a"!==a.target.tagName.toLowerCase()){var c=d.resolveState(b.main.type,b.main.concreteType,{id:b.main.id});e.transitionTo(c.stateName,c.stateParams)}},a.getNewInvitationsLabel=function(){var a="";return a=0===c.unviewedCount?"No New Invitations":1===c.unviewedCount?"One New Invitation":c.unviewedCount+" New Invitations"},a.accept=function(a,b){b.accept().then(f)},a.decline=function(a,b){b.decline()}}]),angular.module("spot.im.embed").controller("NotificationsController",["$scope","notifications","entityStateResolver","stateProviderBridge",function(a,b,c,d){b.clearUnviewedCounter(),a.markRead=function(a,b){return b.markRead(),a.stopPropagation(),a.preventDefault(),!1},a.tinyscrollbar={skipCondition:b.list.length<5},a.goToMainEntity=function(a,b){if(b.main&&"a"!==a.target.tagName.toLowerCase()){var e=c.resolveState(b.main.type,b.main.concreteType,{id:b.main.id});d.transitionTo(e.stateName,e.stateParams)}}}]),angular.module("spot.im.embed").controller("MessageModalController",["$scope","messages","currentIndex","spot","SessionUser","SpotActions","utils",function(a,b,c,d,e,f,g){a.messages=b,a.numOfMessages=b.length,a.spot=d,a.spotActions=new f(d),a.move=function(c){if(a.currentIndex=c,a.message=b[c],a.entity=a.message.getFirstMediaEntity(),a.expanded=!1,a.entity&&a.entity.getImageUrl()){var d=.8*a.sizes.windowWidth,e=.7*a.sizes.windowHeight,f={},h=a.entity.width||a.entity.thumbnail_width||640,i=a.entity.height||a.entity.thumbnail_height||640,j=g.getConstrainedDimensions(h,i,d,e);f="location"===a.entity.type?{width:j.width,height:j.height}:{full_size:!0},a.photoStyle={width:j.width,height:j.height,backgroundImage:"url('"+a.entity.getImageUrl(f)+"')"}}},a.move(c)}]),angular.module("spot.im.embed").controller("MobileCodeController",["$window","$document","$scope","isoCountryCodes","underscore","trackerVent","mobileCode",function(a,b,c,d,e,f,g){function h(a){angular.element(a.target).closest(".mobile-code-view").length||(c.$evalAsync(g.close()),b.off("click",h))}c.error=null,c.countryCodes=d.list,c.headerSubtitle=null,c.inputColor="valid",c.displayTimer=null,c.loading=!1,c.sendSms=function(){c.loading=!0,g.sendSms().then(function(){f.trigger("Mobile Code Requested",!1),c.error=null,c.inputColor="valid",c.headerSubtitle="Phone: +"+g.countryCode+"-"+g.phoneNumber,g.step="code-received",g.isSmsSent=!0,g.startTimer(),c.loading=!1},function(a){c.loading=!1,c.error=a,c.inputColor="invalid"})},c.getCode=function(){g.getCode().then(function(){f.trigger("Mobile Code Requested",!0),c.error=null,c.inputColor="valid",g.step="code-received",g.isSmsSent=!1,g.startTimer()},function(a){c.error=a,c.inputColor="invalid"})},c.phoneEnterStep=function(){g.step="phone-enter"},c.phoneNumberValidation=function(){if(g.phoneNumber){var a=/\d{3}-\d{7}$|\d{2}-\d{7}$|\d{9,10}$|\d{3}\s\d{7}$|\d{2}\s\d{7}$/,b=g.phoneNumber.match(a);null===b?(c.error="Please enter a valid phone number",c.inputColor="invalid"):(c.error=null,c.inputColor="valid")}},a.setTimeout(function(){b.on("click",h)},0)}]).directive("countdown",[function(){return{restrict:"A",scope:!0,link:function(a,b){function c(a){var b=parseInt(a/60,10),c=parseInt(a%60,10);return 10>c&&(c="0"+c),10>b&&(b="0"+b),b+":"+c}a.mobileCode.onTick(function(a){var d=c(a);b.text(d)})}}}]),angular.module("spot.im.embed").controller("MySpotsController",["$scope","mySpotsList",function(a,b){function c(){if(a.searchValue.length>0){var c=a.searchValue.toLowerCase();a.list=b.list.filter(function(a){return a.name.toLowerCase().indexOf(c)>=0}),a.filter="all"}else switch(a.filter){case"public":a.list=b.memberSpots;break;case"intimate":a.list=b.intimateSpots;break;case"hosted":a.list=b.hostSpots;break;default:a.list=b.list}}function d(){a.$evalAsync(function(){a.hasMemberSpots=b.memberSpots.length>0,a.hasIntimateSpots=b.intimateSpots.length>0,a.hasHostSpots=b.hostSpots.length>0,c()})}a.searchValue="",a.filter="all",a.list=[],a.hasMemberSpots=!0,a.hasIntimateSpots=!0,a.hasHostSpots=!0,a.setFilter=function(b){a.filter!==b&&(a.searchValue="",a.filter=b,c())},a.handleSpotClick=function(b,c){a.toggleMySpots(c)},a.$watch("searchValue",c),b.on("change",d),a.$on("$destroy",function(){b.off("change",d)})}]),angular.module("spot.im.embed").factory("notices.components.joinCommunity",["mainSpot","utils","$window","$rootScope","$q","PopularLinksCollection","localStorageManager","noticesHandler",function(a,b,c,d,e,f,g,h){function i(){var a=null;try{var b=g.getItem(q);a=JSON.parse(b)}catch(c){}return a}function j(a){try{var b=JSON.stringify(a);g.setItem(q,b)}catch(c){}}function k(a){"spot-state"!==d.state&&j({lastTimeSeen:(new Date).getTime(),isCloseClicked:a||!1})}function l(a){return a.loadSpotMembers({start_index:0,end_index:3})}function m(a){var b=new f(a);return b.fetch({page_size:1}).then(function(){return b.links[0]})}function n(){t=a.then(function(a){return e.all([a,l(a),m(a.id)])}).then(function(a){var b=a[0],c=a[1],d=a[2];return{spot:b,members:c,popularLink:d}})}function o(){var a=i(),c=a&&a.lastTimeSeen,d=a&&a.isCloseClicked,e=b.getTimeSince(c)>7*r,f=b.getTimeSince(c)>21*r;return!c||!d&&e||f}function p(){var a=o();if(a){var b=null;t.then(function(a){var d=h.display("join-community",a);return b=c.setTimeout(function(){k(!1)},s),d}).catch(function(){k(!0),b&&c.clearTimeout(b)})}return a}var q="join-community-notice-stats",r=864e5,s=16e3,t=null;return n(),{display:p}}]),angular.module("spot.im.embed").factory("notices.components.memberImagesSlider",["defaultBubbleData","mainSpot","$timeout","$filter","$window","$rootScope","utils","$q","localStorageManager","localeStringGetter","defaultBubbleType","trackerVent",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){var a=null;try{var b=i.getItem(t);a=JSON.parse(b)}catch(c){}return a}function n(a){try{var b=JSON.stringify(a);i.setItem(t,b)}catch(c){}}function o(){x=b.then(function(a){return w=a.members_count,A=a.online_members_count,a.loadSpotMembers({start_index:0,end_index:9})}).then(function(a){return y=a.map(function(a){return a.getUserImageUrl(z)}),g.preloadImage(y[0])})}function p(){var a=m(),b=a&&a.lastTimeSeen,c=a&&a.activationCount,d=g.getTimeSince(b)>.5*u,e=g.getTimeSince(b)>7*u;return!b||d&&5>c||e}function q(){var b=null,e=null;B%v===0&&(a.setImage(["background-image: url("+y[C]+")","background-color: transparent!important"].join(";")),C++,e=g.preloadImage(y[C])),B===y.length&&A>1&&j.interpolate("embed.online",{online_count:d("commaSeparate")(A)}).then(function(b){a.setClassName("online"),a.setText(b)}),B++,b=c(angular.noop,1e3),C<y.length?(e=g.preloadImage(y[C]),h.all([e,b]).then(q)):b.then(function(){r(),a.applyDefaultImage(),a.applyDefaultText(),a.applyDefaultClass(),l.trigger("Set Deafult Bubble Type",k.DEFAULT)})}function r(){if("notices-closed-state"===f.state){var a=m(),b=0,c=(new Date).getTime();a&&(b=a.activationCount,c=a.firstTimeSeen);var d=g.getTimeSince(c)<30*u;d?b++:b=1,n({lastTimeSeen:(new Date).getTime(),activationCount:b,firstTimeSeen:c})}}function s(){p()&&x.then(function(){j.interpolate("embed.members",{members_count:d("commaSeparate")(w)}).then(function(b){a.setText(b),l.trigger("Set Deafult Bubble Type",k.MEMBERS_SLIDER),q()})})}var t="member-images-slider-stats",u=864e5,v=2,w=0,x=null,y=[],z={width:52,height:52,crop:"fill"},A=0,B=0,C=0;return o(),s}]),angular.module("spot.im.embed").constant("notices.components.realtime.noticeType",{USER_MENTIONED:"USER_MENTIONED",MESSAGE_LIKED:"MESSAGE_LIKED",SPOT_NEW_MEMBER:"SPOT_NEW_MEMBER",USER_REPORTED:"USER_REPORTED",MESSAGE_PINNED:"MESSAGE_PINNED",SPOT_MENTIONED:"SPOT_MENTIONED",INVITATION_ACCEPTED:"INVITATION_ACCEPTED",MESSAGE:"MESSAGE"}).factory("notices.components.realtime",["mainSpot","Events","notifications","invitations","User","Spot","CloudinaryService","pusherEvents","noticesHandler","notices.components.realtime.noticeType",function(a,b,c,d,e,f,g,h,i,j){function k(a){n.push(a),o.trigger(o.EVENT_NAME,a),i.display("realtime",o.getNext())}function l(a){var b={type:"notification",item:a};k(b)}function m(a){if(!p){var b={type:"message",item:a};k(b)}}var n=[],o={},p=!0;a.then(function(a){h.on(a.channel_name,"message",m)});var q=function(a){this.user=null,this.spot=null,this.message=null,this.alertType=null,this.noticeType=null,this.parseAlert(a)};return q.prototype={parseAlert:function(a){var b=this.alertItem=a.item,c=this.alertType=a.type;if("notification"===c){switch(b.type){case"user_mentioned":this.user=b.mentioner,this.message=b.message,this.spot=b.spot,this.noticeType=j.USER_MENTIONED;break;case"message_liked":this.user=b.liked_by,this.message=b.message,this.spot=b.spot,this.noticeType=j.MESSAGE_LIKED;break;case"spot_new_member":this.user=b.new_member,this.spot=b.spot,this.noticeType=j.SPOT_NEW_MEMBER;break;case"user_reported":this.user=b.reported_user,this.noticeType=j.USER_REPORTED;break;case"message_pinned":this.message=b.message,this.user=b.pinned_by,this.spot=b.spot,this.noticeType=j.MESSAGE_PINNED;break;case"spot_mentioned":this.message=b.message,this.user=b.mentioner,this.spot=b.spot,this.noticeType=j.SPOT_MENTIONED;break;case"invitation_accepted":this.user=b.invitee,this.spot=b.spot,this.noticeType=j.INVITATION_ACCEPTED}this.imageId=b.imageId}else"message"===c&&(this.user={id:b.sender_id,name:b.display_name,username:b.username,profile_image:b.profile_image},this.message=b,this.noticeType=j.MESSAGE)},getNoticeData:function(){var a={noticeType:this.noticeType};return this.user?angular.extend(a,{imageType:"regular-image",imageUrl:e.getUserImageUrl(this.user.profile_image,{height:50,width:50,crop:"fill"})}):this.spot?angular.extend(a,{imageType:"regular-image",imageUrl:g.getUrl(this.imageId,{height:50,width:50,crop:"fill"})}):angular.extend(a,{imageType:"none"}),"message"===this.alertType?angular.extend(a,{imageClass:"online-dot",textType:"user-text",displayName:this.user.name,username:this.user.username,text:this.message.text}):"notification"===this.alertType&&angular.extend(a,{textType:"text-block",text:this.alertItem.text}),a}},angular.extend(o,b,{EVENT_NAME:"notices.components.realtime:Notice",hasNext:function(){return n.length>0},getNext:function(){var a=new q(n.shift());return a.getNoticeData()},start:function(){n.length=0,c.on("notifications:Alert",l),p=!1},stop:function(){c.off("notifications:Alert",l),p=!0}}),o}]),angular.module("spot.im.embed").constant("notices.controllers.joinCommunity.steps",{JOIN_COMMUNITY:"JOIN_COMMUNITY",POPULAR_LINK:"POPULAR_LINK",SPOT_ICON:"SPOT_ICON"}).controller("notices.controllers.joinCommunity",["$scope","$timeout","notices.controllers.joinCommunity.steps",function(a,b,c){var d=24e3,e=a.currentNotice,f=e.noticeData,g=d/3,h=f.popularLink&&f.popularLink.title;a.noticeData=f,a.joinCommunityStep=c.JOIN_COMMUNITY,b(angular.noop,g).then(function(){return h?(a.joinCommunityStep=c.POPULAR_LINK,b(angular.noop,g)):!0}).then(function(){return a.joinCommunityStep=c.SPOT_ICON,b(angular.noop,g)}).then(function(){a.resolveCurrentNotice()})}]),angular.module("spot.im.embed").controller("notices.controllers.notice",["$scope","$rootScope","$q","$timeout","noticesHandler",function(a,b,c,d,e){a.currentNotice=null,a.resolveCurrentNotice=function(){a.currentNotice&&(a.currentNotice.done(),a.currentNotice=null)},a.rejectCurrentNotice=function(){a.currentNotice&&(a.currentNotice.cancel(),a.currentNotice=null)},a.closeNotice=function(b){a.rejectCurrentNotice(),b.stopPropagation()},e.onNotice(function(c){switch(a.currentNotice=c,c.type){case"join-community":b.noticeBubbleHeightClass="join-community-height";break;case"realtime":b.noticeBubbleHeightClass="realtime-height"}}),a.$on("$destroy",a.rejectCurrentNotice)}]),angular.module("spot.im.embed").controller("notices.controllers.realtime",["$scope","$timeout",function(a,b){var c=5e3;a.$watch("currentNotice",function(){var d=a.currentNotice,e=d.noticeData;a.data=e,b(angular.noop,c).then(function(){a.resolveCurrentNotice()})})}]),angular.module("spot.im.embed").constant("defaultBubbleType",{DEFAULT:"DEFAULT",MEMBERS_SLIDER:"MEMBERS_SLIDER"}).factory("defaultBubbleData",["mainSpot","embedOptions","utils","localeStringGetter","SessionUser","trackerVent","defaultBubbleType",function(a,b,c,d,e,f,g){function h(){e.subscribeLoginChange(function(a){if(a){var b=e.getUser(),d={height:52,width:52,crop:"fill"},f=b.getUserImageUrl(d);c.preloadImage(f).then(function(){m.setImage(["background-image: url("+f+")","background-color: transparent!important"].join(";"))})}else m.applyDefaultImage()})}function i(){var d=a.getSpotOptions();d.then(function(a){return k=b.iconUrl||a.iconUrl,c.preloadImage(k)}).then(function(){j=["background-image: url("+k+")","background-color: transparent!important"].join(";"),h()}),d.then(function(a){l=a.bubbleTextColor||l,m.applyTextColor()}),m.applyDefaultClass(),m.applyDefaultText(),f.trigger("Set Deafult Bubble Type",g.DEFAULT)}var j=null,k=null,l="#555",m={text:"",image:null,className:"",textColor:"",bubbleType:null,initialize:i,setText:function(a){this.text=a},setType:function(a){this.bubbleType=a},applyDefaultText:function(){var a=this;d.getString("embed.community").then(function(b){a.text=b})},setImage:function(a){this.image=a},applyDefaultImage:function(){this.image=j},setTextColor:function(a){this.textColor=a},applyTextColor:function(){this.textColor=l},setClassName:function(a){this.className=a},applyDefaultClass:function(){this.className=""}};return m}]).run(["defaultBubbleData",function(a){a.initialize()}]),angular.module("spot.im.embed").factory("noticesData",["$q","domainOptions","utils",function(a,b,c){function d(){var a=c.deepSubstract(h,g);b.setOption(e,a)}var e="NoticesData",f={lastSessionStart:0,lastDisplayTimestamp:0,realtime:{lastDisplayTimestamp:0,displayCount:0},teaser:{lastDisplayTimestamp:0,displayCount:0},onlineCount:{lastDisplayTimestamp:0,displayCount:0},offlineNotifications:{lastDisplayTimestamp:0,displayCount:0}},g={sessionPeriod:36e5,timeBetweenNotices:6e4,realtime:{minInterval:0,maxOccurrences:-1,priority:1},onlineCount:{minInterval:9e5,maxOccurrences:-1,priority:2},teaser:{minInterval:0,maxOccurrences:-1,priority:3},offlineNotifications:{timeout:3e5,minInterval:120,maxOccurrences:5,priority:4}},h=c.deepExtend({},f,b.getOption(e),g);return{initializeSession:function(){var a=(new Date).getTime();h.lastSessionStart=a,d()},updateDisplayedNotice:function(a){var b=(new Date).getTime();h[a].displayCount++,h[a].lastDisplayTimestamp=b,h.lastDisplayTimestamp=b,d()},get:function(){return h}}}]),angular.module("spot.im.embed").factory("noticesHandler",["$q","$rootScope","$timeout","Logger","initiatorApi",function(a,b,c,d,e){function f(a){m.length>0?(k.apply(null,m.shift()),a.resolve()):"notices-opened-state"===b.state?e.noticesClosedState().then(function(){p=!1,a.resolve()}):a.resolve()}function g(a){"notices-opened-state"===b.state&&e.noticesClosedState().then(function(){p=!1,a.reject()})}function h(){return"notices-opened-state"===b.state?a.when(!0):e.noticesOpenedState()}function i(){return["notices-opened-state","notices-closed-state"].indexOf(b.state)>-1}function j(a){n.forEach(function(b){b(a)})}function k(a,b,c){return b&&i()?void h().then(function(){l.debug("display","Display {0} notice",[a]),j({index:o,type:a,noticeData:b,done:function(){l.debug("display","Done display {0} notice",[a]),f(c)},cancel:function(){l.debug("display","Cancel display {0} notice",[a]),g(c)}}),o++}):void f(c)}var l=d.getInstance("noticesHandler"),m=[],n=[],o=0,p=!1,q={onNotice:function(a){a&&"function"==typeof a&&n.push(a)},display:function(b,c){var d=a.defer();return p?m.push([b,c,d]):(o=0,p=!0,k(b,c,d)),d.promise}};return q}]),angular.module("spot.im.embed").factory("notices.strategies.anonymous",["$timeout","notices.strategies.base","notices.components.joinCommunity","notices.components.memberImagesSlider",function(a,b,c,d){var e=5e3,f=angular.extend({},b,{displayNotices:function(){c.display()||d()},_start:function(){var b=this;this.initialTimeoutPromise=a(b.displayNotices.bind(b),e)},_stop:function(){a.cancel(this.initialTimeoutPromise)}});return f}]),angular.module("spot.im.embed").factory("notices.strategies.base",[function(){var a={initialize:function(){this.isStarted=!1},start:function(){this.isStarted||(this.isStarted=!0,this._start())},stop:function(){this.isStarted&&(this.isStarted=!1,this._stop())},_start:function(){},_stop:function(){}};return a}]),angular.module("spot.im.embed").factory("notices.strategies.main",["SessionUser","notices.strategies.base","notices.strategies.anonymous","notices.strategies.registered",function(a,b,c,d){var e=c,f=angular.extend({},b,{_start:function(){e._start()},_stop:function(){e._stop()}});return f.initialize(),a.subscribeLoginChange(function(){f.isStarted&&f.stop(),e=a.isRegistered?d:c,f.isStarted&&f.start()}),f}]),angular.module("spot.im.embed").factory("notices.strategies.registered",["noticesData","notices.strategies.base","notices.components.realtime",function(a,b,c){var d=angular.extend({},b,{_start:function(){c.start()},_stop:function(){c.stop()}});return d}]),angular.module("spot.im.embed").controller("RootController",["$rootScope","$window","$state","$q","notices.strategies.main","initiatorApi","SessionUser","mainSpot","domainOptions","trackerVent","utils","embedOptions","historyTracker","mobileCode",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.historyTracker=m,a.openNewWindow=function(a,c){b.open(c),a.preventDefault()},a.showMySpots=!1,a.toggleMySpots=function(b){a.showMySpots=!a.showMySpots,a.mySpotsSpot=b},a.undock=function(){var d=c.href("app"),e=["width=368","height=568","left=0","top=0"].join(","),f=k.applyProtocol(b.location.host+d+"/undocked.html?"),g=[];l.spotId&&g.push("spotId="+l.spotId),l.spotName&&g.push("spotName="+l.spotName),g.push("url="+c.href(c.current.name).substring(d.length)),a.noticesClosedState(),b.open(f+g.join("&"),"Spot.IM Embed",e).focus()},a.spotState=function(a){h.redirect(),f.spotState(),e.stop(),a.stopPropagation()},a.noticesClosedState=function(){var a=f.noticesClosedState();return e.start(),a},a.toggleSpotState=function(b){"spot-state"===a.state?a.noticesClosedState():a.spotState(b)},a.mobileCode=n,a.isNoticesState=function(){return["notices-opened-state","notices-closed-state"].indexOf(a.state)>-1},a.subscribeLoginChange=function(a){var b=this;this.$on("$destroy",function(){g.unsubscribeLoginChange(b)}),g.subscribeLoginChange(a,b)},a.$watch("state",function(a){"notices-opened-state"===a||"notices-closed-state"===a?e.start():e.stop()}),a.$on("online",function(){c.transitionTo(c.current.name,null,{reload:!0})})}]),angular.module("spot.im.embed").config(["$locationProvider","$stateProvider",function(a,b){a.html5Mode(!0).hashPrefix("!"),b.state("app",{url:"/embed",templateUrl:"/templates/layout.html",resolve:{mainSpotEntity:["mainSpot",function(a){return a.promise}]},"abstract":!0}).state("app.not_found",{url:"/404",templateUrl:"/templates/404.html"}).state("app.intimate_spot",{url:"/1on1/id/:spotId","abstract":!0,templateUrl:"/templates/spot/layout.html",controller:"SpotController"}).state("app.intimate_spot.chat",{url:"",templateUrl:"/templates/spot/chat.html"}).state("app.public_spot_by_id",{url:"/id/:spotId",templateUrl:"/templates/spot/layout.html",controller:"SpotController"}).state("app.public_spot",{url:"/:spotEncodedName","abstract":!0,templateUrl:"/templates/spot/layout.html",controller:"SpotController"}).state("app.public_spot.chat",{url:"",templateUrl:"/templates/spot/chat.html"}).state("app.public_spot.popular",{url:"/popular",templateUrl:"/templates/spot/popular-links/main.html"}).state("app.public_spot.reply",{url:"/reply/:messageId",template:"<ui-view></ui-view>",controller:"ReplyController"}).state("app.public_spot.spot_members",{url:"/members",templateUrl:"/templates/spot/spot-members.html"}).state("app.public_spot.spot_media",{url:"/media",templateUrl:"/templates/spot/spot-media.html"}).state("app.user_profile_by_id",{url:"/profile/id/:userId",templateUrl:"/templates/user-profile/layout.html",controller:"UserProfileController"}).state("app.user_profile_edit",{url:"/profile/edit",templateUrl:"/templates/user-profile/edit/layout.html",controller:"UserProfileEditController"}).state("app.user_profile",{url:"/profile/:userUniqueName","abstract":!0,templateUrl:"/templates/user-profile/layout.html",controller:"UserProfileController"}).state("app.user_profile.about",{url:"/about",templateUrl:"/templates/user-profile/about.html"}).state("app.user_profile.media",{url:"/media",templateUrl:"/templates/user-profile/media.html"}).state("app.message",{url:"/messages/:messageId"}).state("app.otherwise",{url:"*path"}).state("app.manage_spots",{url:"/spots"}).state("app.spot_invite",{url:"/spots"}).state("app.disclaimer",{url:"/disclaimer","abstract":!0}).state("app.disclaimer.terms",{url:"/terms"}).state("app.disclaimer.privacy",{url:"/privacy"})}]),angular.module("spot.im.embed").controller("FacesPanelController",["$scope","$interval","User","underscore","$state",function(a,b,c,d,e){function f(){i.length=0,Array.prototype.push.apply(i,g.orderedList);var a=h.filter(function(a){return!g.isOnline(a.id)});Array.prototype.push.apply(i,a)}var g=a.spotCtrl.onlineMembers,h=a.spotCtrl.spot.members,i=a.usersList=[];a.imageOptions={width:25,height:25,padding:2,crop:"fill"},g.on("list-update",function(){a.$evalAsync(function(){f()})}),f(),a.onFaceClick=function(a){var b=a.getProfileUrlState();e.go(b.stateName,b.stateParams)}}]),angular.module("spot.im.embed").controller("FooterController",["$scope","$window","SessionUser","SpotActions","currentSpotView","sso",function(a,b,c,d,e,f){function g(){var a="default";return i?a="host":f.isSsoUser&&(a="sso"),a}function h(){a.footerType=g(),"sso"===a.footerType&&f.once("unmarkSsoUser",function(){a.$evalAsync(h)})}var i=!1;if(f.once("markSsoUser",function(){a.$evalAsync(h)}),h(),c.isRegistered){var j=c.getUser();j.getSortedSpots().then(function(a){a.hostSpots.length>0&&(i=!0,h())})}}]),angular.module("spot.im.embed").controller("MessageContextMenuController",["$scope","UsersManager","UserActions","SpotActions",function(a,b,c,d){function e(){a.$destroy()}a.userActions=new c(a.user),a.spotActions=new d(a.spot),a.reportSender=function(){a.userActions.reportUser(a.spot.id)},a.isPinned=function(){return a.message.id===a.spot.pinned_message_id},a.deleteMessage=function(b){a.spotActions.deleteMessage(b),e()}}]),angular.module("spot.im.embed").controller("MessageController",["$scope","$timeout",function(a,b){a.pulseLikes=!1,a.$watch("message.likes",function(c,d){c!==d&&(a.pulseLikes=!0,b(function(){a.pulseLikes=!1},1500))}),a.openModal=function(){a.spotActions.openMessageModal(a.message)},a.expandPreview=function(b){b.is_playable?b.expanded=!0:a.openModal()},a.goToEntity=function(b,c){a.spotActions.goToState(c.stateName,c.stateParams)};var c=a.message.entities;a.entities=[],c&&c.forEach(function(b){if(-1!==["user","spot"].indexOf(b.type)&&b.range){var c=a.message.text.substr(b.range[0],b.range[1]);a.entities.push({type:b.type,id:b.entity_id,text:c,placeholder:c})}})}]),angular.module("spot.im.embed").controller("MessageTypingController",["$scope","$rootScope","$window","User","UsersManager","$q",function(a,b,c,d,e,f){function g(a){return e.getUser({id:a})}function h(b){a.$safeApply(function(){a.userImage=d.getUserImageUrl(b,{width:37,height:37,crop:"fill"})})}function i(){var b=a.typersIds.length;1===b?g(a.typersIds[0].id).then(function(b){a.currentTypers=b.display_name,a.typingMessage=l}):b>1&&f.all([g(a.typersIds[0].id),g(a.typersIds[1].id)]).then(function(c){var d,e=c[0],f=c[1];d=b>2?e.display_name+", "+f.display_name+n.replace("%d",b-2):e.display_name+" & "+f.display_name,a.currentTypers=d,a.typingMessage=m})}function j(){return 0===a.typersIds.length?(a.userImage=null,void(a.userName=null)):(o>a.typersIds.length-1&&(o=0),h(a.typersIds[o].profileImageId),o++,void(p=c.setTimeout(j,k)))}var k=5e3,l=" is typing",m=" are typing",n=" & %d others";a.currentTypers="",a.typingMessage="",a.typersIds=a.spotCtrl.spotTyping.getTypers(),h(a.typersIds[0].profileImageId),i();var o=0,p=0;j(),a.$watch("typersIds.length",i),a.$on("$destroy",function(){c.clearTimeout(p)})}]),angular.module("spot.im.embed").controller("PinnedMessageController",["$scope","domainOptions","$timeout","embedSession",function(a,b,c,d){function e(){i&&c.cancel(i),i=c(function(){a.isExpanded=!1},g)}function f(){d.domain.getActionHistory(!1,h).length||(d.domain.addAction(!1,h),a.isExpanded=!0,e()),j()}var g=7e3,h="pinned-message-key",i=null,j=a.$watch("state",function(a){"spot-state"===a&&f()});a.unpin=function(){a.spotCtrl.spot.unpinMessage(a.spotCtrl.spot.pinned_message_id)},a.togglePin=function(){a.isExpanded=!a.isExpanded,a.isExpanded&&e()},a.$watch("spotCtrl.spot.pinned_message",function(b,c){null===b?a.isExpanded=!1:c!==b&&(d.domain.clearAction(!1,h),a.isExpanded=!0,e())})}]),angular.module("spot.im.embed").controller("BlockedUrlsController",["$scope",function(a){function b(a,b){this.collection=a,this.originalList=[],this.updatedList=[],this.urlToBlock=b,this.isLoading=!1,this.fetchBlockedUrls()}b.prototype={toggle:function(){this.isOpen=!this.isOpen},_fetchDone:function(a){[].push.apply(this.originalList,a),[].push.apply(this.updatedList,this.originalList)},fetchBlockedUrls:function(){var a=this;return this.collection.getPopularLinksBlockedUrls().then(function(b){var c=b&&b.response&&b.response.blocked_urls;a._fetchDone(c)})},blockUrl:function(){this.updatedList.indexOf(this.urlToBlock)<0&&this.updatedList.push(this.urlToBlock),this.urlToBlock=null},unblockUrl:function(a){var b=this.updatedList.indexOf(a);this.updatedList.splice(b,1)},saveList:function(){this.isLoading=!0;var b=this,c=this.updatedList.filter(function(a){return b.originalList.indexOf(a)<0
}),d=this.originalList.filter(function(a){return b.updatedList.indexOf(a)<0});this.collection.updatePopularLinksBlockedUrls(c,d).then(function(){b.isLoading=!1}),a.$close()}},a.blockedUrlsCtrl=new b(a.collection,a.urlToBlock)}]),angular.module("spot.im.embed").directive("popularLinks",[function(){return{restrict:"E",scope:{spot:"=",collection:"=popularLinksCollection"},templateUrl:"/templates/spot/popular-links/layout.html",controller:["$scope","$element","$attrs","$parse","modalUtils","PopularLinksCollection","trackerVent",function(a,b,c,d,e,f,g){a.collection||(a.collection=new f(a.spot.id));var h=a.collection;a.hideArrow=!1,a.fetchNext=h.getFetcher(10),a.fetchNextOnScrool=function(){g.trigger("Popular Links Paged"),a.fetchNext()},a.openBlockedlinks=function(b){a.urlToBlock=b,e.open({templateUrl:"/templates/spot/popular-links/blocked-urls.html",controller:"BlockedUrlsController",scope:a,backdrop:!0,windowClass:"blocked-urls-modal-view"})},h.hasLinks()||a.fetchNext(5),a.onArrowClick=function(){a.hideArrow=!0,b.find(".links-list-container").scrollTop(200,200)},a.onScroll=function(){a.hideArrow=!0}}]}}]),angular.module("spot.im.embed").directive("popularLink",["$filter",function(a){return{restrict:"E",scope:{index:"=",link:"=",spot:"=",onBlockClick:"&"},templateUrl:"/templates/spot/popular-links/link.html",controller:["$scope","$timeout","UsersManager","SessionUser","localeStringGetter","trackerVent",function(b,c,d,e,f,g){function h(){j.firstFollowUp&&(b.firstFollowUpText=j.firstFollowUp.text,d.getUser({id:j.firstFollowUp.userId}).then(function(a){b.firstFollowUpUser=a}))}var i={width:95,height:90,crop:"fill"},j=b.link;b.followUpText=null,b.likedByMe=!1,b.title=a("truncate")(j.title||j.url,50,{breakWords:!1}),b.description=a("truncate")(j.description,50,{breakWords:!1}),b.imageUrl=j.getImageUrl(i)||b.spot.getSpotThumbnailUrl(i),b.flip=!1,b.onFollowUpClick=function(a){b.flip=!0,b.spot.joinSpot().then(function(){return f.getString(a)}).then(function(c){g.trigger("Spot Popular Link Comment",b.spot.id,b.spot.name,a),j.sendFollowUp(c)}),c(function(){b.flip=!1},6e3)},b.sendFollowUp=function(){b.followUpText&&(b.flip=!0,b.spot.joinSpot().then(function(){g.trigger("Spot Popular Link Comment",b.spot.id,b.spot.name,null),j.sendFollowUp(b.followUpText),b.followUpText=null}),c(function(){b.flip=!1},6e3))},b.likePopularLink=function(){b.spot.joinSpot().then(function(){b.likedByMe||(b.likedByMe=!0,j.like())})},e.subscribeLoginChange(function(a,c){b.currentUser=c,b.isHost=b.spot.isHostedByMe()},b),b.$on("$destroy",function(){e.unsubscribeLoginChange(b)}),b.$watch("link.firstFollowUp",h)}],link:function(a,b){var c=b.find(".add-follow-up-block"),d=c.find(".action"),e=d.height();a.$on("elastic:resize",function(){var a=d.height(),b=c.height();c.height(b+a-e),e=a}),a.$watch("followUpText",function(a){a||c.height("")})}}}]),angular.module("spot.im.embed").controller("PostMessageController",["$rootScope","$scope","$state","$q","$timeout","jquery","underscore","CloudinaryService","SocialLogin","fileReader","embedlyService","utils","SearchResource","MessageEntity","Message","SessionUser","spotTyping","trackerVent","sonification","easterEggs",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){function u(){b.newMessage=new o,b.preview.remove(!0),z=null,b.mentionsInput.api.reset()}function v(a){var c=b.newMessage.text.replace(a.urlQuote,"");0===c.trim().length&&(c=""),b.newMessage.text=c,a.range=null}var w=1e4,x=g.throttle(function(){var a=b.spotCtrl.spot.id;q.notifyUserTyping(a)},w);b.repliedMessageId=null,b.newMessage=new o,b.isResolvingEmbed=!1,b.isMessagePinned=!1,b.isUploadingImage=!1,b.data={imageFile:null};var y=null;b.preview={entity:null,isImage:!1,isClosed:!1,hasPreview:function(){return null!==this.entity},remove:function(a){(a||!this.isImage)&&(b.spotCtrl.markPreviewExpanded(!1),this.entity=null)},setEntity:function(a,c){null!==this.entity&&this.isImage||(this.entity=a,this.isImage=c,b.spotCtrl.markPreviewExpanded(!0))}},b.togglePinMessage=function(){b.isMessagePinned=!b.isMessagePinned},b.openImageEditor=function(){var a=d.defer();y=a.promise,b.isUploadingImage=!0,y.finally(function(){b.isUploadingImage=!1}),j.readAsDataUrl(b.data.imageFile).then(function(c){var d=l.guid();h.upload(c,"attachments/"+d,function(){var e=new Image;e.src=c;var f={type:"photo",ranges:[],entity_id:d,width:e.width,height:e.height},g=new n(f,{parse:!0});b.preview.setEntity(g,!0),a.resolve()},function(){a.reject()})},function(){a.reject()})};var z=null,A=0,B=function(){function a(a){z=a;var c=k.resolve(a);c.then(function(c){if(a===z&&c.length>0&&!b.preview.hasPreview()&&!b.preview.isClosed){var d=new n(c[0],{parse:!0});b.preview.setEntity(d,!1),v(d)}}),A+=1,b.isResolvingEmbed=!0,c.finally(function(){A-=1,0===A&&(b.isResolvingEmbed=!1)})}var c=b.newMessage.text.trim();z!==c&&a(c)};b.messagePaste=function(){e(function(){B()})},b.messageKeyPress=function(a){if(!b.isMessageEmpty()){x();var c=b.newMessage.text,d=a.currentTarget.selectionStart,e=c.slice(-1),f=8===a.keyCode;(" "===e||d<c.length||f)&&B()}},b.isMessageEmpty=function(){var a=b.newMessage.text||"";return 0===a.trim().length&&!b.preview.hasPreview()},b.postMessage=function(){if(p.isRegistered&&!b.isResolvingEmbed&&!b.isMessageEmpty()){b.spotCtrl.spot.isJoined()||b.spotActions.joinSpot();var a=angular.element(".talk-input");if(b.newMessage.text=a.val(),!t.catchCommand(b.newMessage.text)){b.preview.hasPreview()&&b.newMessage.addEntity(b.preview.entity);var c=b.mentionsInput.api.getMentions();c.forEach(function(a){var c={type:a.type,entity_id:a.id,range:[a.start,a.value.length]};b.newMessage.addEntity(new n(c,{parse:!0}))});var d=b.spotCtrl.spot.postMessage(b.newMessage,b.repliedMessageId);d.promise.then(function(){b.isMessagePinned&&(b.spotCtrl.spot.pinMessage(d.id),b.isMessagePinned=!1)}),s.play(s.sounds.messageSent,!0),u()}}},b.mentionsInput={onDataRequest:function(a,c){b.$safeApply(function(){m.autocomplete({q:a,size:3,spot_id:b.spotCtrl.spot.id},function(a){a.response.forEach(function(a){a.avatar=h.getUrl(a.type+"s/"+a.id,{width:30,height:30,crop:"fill"}),"spot"===a.type?a.value=a.name:"user"===a.type&&(a.value="@"+a.unique_name)}),c.call(this,a.response)})})},onItemSelected:function(){},reverseOrder:!0,api:null},b.spotCtrl.on("replyMention",function(a,c){b.repliedMessageId=c,b.mentionsInput.api.replyMention(a)}),b.$on("replyMention",function(a,c){b.mentionsInput.api.replyMention(c)}),b.loginWith=function(a){r.trigger("Login Opened"),r.trigger("Social Connect",a);var c=new i;c.quickLogin(a).then(function(){b.spotActions.joinSpot()})}}]),angular.module("spot.im.embed").controller("ReplyController",["$scope","$state","$stateParams","MessagesManager",function(a,b,c,d){function e(){b.go("^")}c.messageId?d.getMessage({id:c.messageId}).then(function(b){a.spotCtrl.replyMessage(b)}).finally(e):e()}]),angular.module("spot.im.embed").controller("SpotController",["$scope","CoreSpotCtrl","SpotActions","mainSpotEntity","$state","$timeout","$stateParams","mainSpot","pusherService","modalUtils",function(a,b,c,d,e,f,g,h,i,j){var k=!1,l=null;g.spotId?(l={id:g.spotId},k=!0):g.spotEncodedName&&(l={type:"public",name:g.spotEncodedName}),a.spotCtrl=d.isSameSpot(l)?new b(d,!0):new b(l),a.spotCtrl.readyPromise.then(function(){var b=!1,f=(new Date-1e3*a.spotCtrl.spot.last_activity_date)/6e4;if(f>15&&a.spotCtrl.isPopularLinksEnabled()&&(b=!0),!a.spotCtrl.isIntimate&&k){var g=a.spotCtrl.spot.getSpotUrlState();e.go(g.stateName,g.stateParams)}a.spotActions=new c(a.spotCtrl.spot),d===a.spotCtrl.spot?(a.spotName=h.spotRename||a.spotCtrl.spot.name,a.spotIcon=h.iconUrl):a.spotName=a.spotCtrl.spot.name,a.spotCtrl.loadCategory(),a.spotCtrl.loadHosts()}),a.spotCtrl.isUserTyping=!1,a.spotCtrl.on("spotTypingUpdate",function(){a.$evalAsync(function(){a.spotCtrl.isUserTyping=a.spotCtrl.spotTyping.isAnyoneTyping()})},a),a.spotCtrl.partSpot=function(){var b=null,c=null;a.spotCtrl.isIntimate?(b="Leave this DirectSpot?",c="This DirectSpot will no longer appear on your list. To start talking to <username>, you need to send a new invitation."):(b="Leave this Spot?",c="This Spot will no longer appear on your list, and you will not receive further notifications from this community."),j.confirmation("<em>"+b+"</em>"+c,"Leave and remove","Cancel","part-spot-confirmation").then(function(){a.spotCtrl.spot.partSpot()})},i.on("pusher:reconnected",function(){a.$evalAsync(function(){a.spotCtrl.reloadSpot()})},a),a.$on("$destroy",function(){a.spotCtrl.destroy(),i.off(null,null,a),a.spotCtrl.spotTyping.off(null,null,a)})}]),angular.module("spot.im.embed").controller("SpotMediaController",["$scope","spotMediaFetcher",function(a,b){b(a.spotCtrl.spot,"all","date",null,30).then(function(b){a.totalMedia=b.totalCount,a.messages=b.messages}),a.fetchNextMessages=function(){b(a.spotCtrl.spot,"all","date",a.messages[a.messages.length-1].id,30).then(function(b){var c=b.messages;a.totalMedia=b.totalCount,c.forEach(function(b){a.messages.push(b)})})},a.scrollbar={api:null}}]),angular.module("spot.im.embed").controller("SpotMembersController",["$scope",function(a){a.members=null,a.hosts=null,a.scrollbarHosts={api:null},a.scrollbarMembers={api:null},a.hosts=a.spotCtrl.spot.hosts,a.members=a.spotCtrl.spot.members,a.isOnline=function(b){return b.isOnline=a.spotCtrl.onlineMembers.isOnline(b.id),b.isOnline},a.$watch("spot.members",function(){a.hosts=a.spotCtrl.spot.hosts,a.members=a.spotCtrl.spot.members})}]),angular.module("spot.im.embed").directive("spotMenu",["pusherEvents","$rootScope",function(a,b){return{restrict:"E",scope:{spot:"=",showPopularLinks:"="},templateUrl:"/templates/spot/spot-menu/layout.html",controller:["$scope",function(a){a.showNewMessages=!1,a.newMessagesCount=0}],link:function(c,d){var e=a.on(c.spot.channel_name,"message",function(){c.showNewMessages&&c.newMessagesCount++}),f=b.$on("$stateChangeStart",function(a,b){"app.public_spot.chat"!==b.name?c.showNewMessages=!0:(c.newMessagesCount=0,c.showNewMessages=!1)});d.one("$destroy",function(){e(),f()})}}}]),angular.module("spot.im.embed").directive("userProfileSpotsList",[function(){return{restrict:"EA",templateUrl:"/templates/user-profile/spots-list.html",scope:{list:"=",name:"="},controller:["$scope",function(a){var b=3;this.setList=function(c){a.visibleList=c.slice(0,b)},a.showMore=function(){b+=6,a.visibleList=a.list.slice(0,b)}}],link:function(a,b,c,d){a.$watchCollection("list",function(a){d.setList(a)})}}}]),angular.module("spot.im.embed").controller("UserProfileController",["$scope","$state","CoreUserProfileCtrl","$stateParams","UserActions","modalUtils","trackerVent",function(a,b,c,d,e,f,g){var h=!1,i=null;d.userId?(i={id:d.userId},h=!0):d.userUniqueName&&(i={unique_name:d.userUniqueName});var j=null;a.userProfileCtrl=new c(i),a.userProfileCtrl.inviteIntimateSpot=function(){e.inviteIntimateSpot(this.user)},a.userProfileCtrl.onEditClick=function(){g.trigger("Edit Profile Clicked",a.userProfileCtrl.user.id)},a.userProfileCtrl.readyPromise.then(function(){if(h){var c=a.userProfileCtrl.user.getProfileUrlState();b.go(c.stateName,c.stateParams)}j=new e(a.userProfileCtrl.user)}),a.navigationMenu=[{name:"About",stateName:"app.user_profile.about"},{name:"Gallery",stateName:"app.user_profile.media"}],a.userMenu=[{name:"Report",onClick:function(){j.reportUser()}}],a.openMessageModal=function(a){f.spotMessageModal(a)},a.$on("$destroy",function(){a.userProfileCtrl.destroy()})}]),angular.module("spot.im.embed").controller("UserProfileEditController",["$scope","CoreUserProfileEditCtrl","SessionUser","historyTracker",function(a,b,c,d){a.userProfileEditCtrl=new b(c.getUser(),!0),a.done=function(){d.back()},a.$on("$destroy",function(){a.userProfileEditCtrl.destroy()})}]),angular.module("spot.im.core").run(["$templateCache",function(a){"use strict";a.put("/templates/404.html","404!!"),a.put("/templates/common/application-header.html",' <div class="application-header-view branded-bg">\n    <button class="back-button" ng-show="historyTracker.canBack()" ng-click="historyTracker.back()"></button>\n\n    <button class="back-button close-my-spots" ng-click="toggleMySpots()"></button>\n\n    <button  ng-if="session.isRegistered" class="my-spots-button"\n        ng-class="{new: unreadIntimateMessages > 0}"\n        ng-click="toggleMySpots()">\n        <span class="counter-circle">\n            <span class="number" ng-bind="unreadIntimateMessages"></span>\n        </span>\n    </button>\n\n    <button ng-if="session.isRegistered" class="invitations-button"\n            ng-class="{ new: invitations.unviewedCount > 0 }"\n            ng-click="invitations.markAllRead()"\n            tooltip="\'/templates/header/invitations.html\'">\n        <span class="counter-circle">\n            <span class="number" ng-bind="invitations.unviewedCount"></span>\n        </span>\n    </button>\n\n    <button ng-if="session.isRegistered" class="notifications-button"\n            ng-class="{ new: notifications.unviewedCount > 0 }"\n            ng-click="notifications.markAllRead()"\n            tooltip="\'/templates/header/notifications.html\'" >\n        <span class="counter-circle">\n            <span class="number" ng-bind="notifications.unviewedCount"></span>\n        </span>\n    </button>\n\n    <div  class="lead-right" ng-if="session.isRegistered">\n        <a class="profile-link" user-href= "session.getUser()"\n           ng-style="{ backgroundImage: \'url(\' + session.getUser().getUserImageUrl({height: 21, width: 21, crop:\'fill\'}) + \')\' }">\n        </a>\n    </div>\n\n    <button class="undock-button" ng-click="undock()" ng-class="{ \'lead-right\': !session.isRegistered }"></button>\n\n    <button class="minimize-button" ng-click="noticesClosedState()" on-click-analytics="Spot Closed"></button>\n\n    <!-- <button class="minimize-button" ng-click="noticesClosedState()" ng-class="{ \'lead-right\': !session.isRegistered }"></button> -->\n</div>'),a.put("/templates/common/directives/actions-menu.html",'<ul class="menu-view">\n    <li ng-repeat="item in items">\n        <a ng-if="item.stateName" class="item"  ng-bind="item.name" ng-click="onClick($event, item)"\n           ui-sref="{{ item.stateName }}({{ item.stateParams }})" ui-sref-active="current branded-text"></a>\n        <button ng-if="!item.stateName" class="item" ng-bind="item.name" ng-click="onClick($event, item)"></button>\n    </li>\n</div>'),a.put("/templates/common/directives/dynamic-alerts.html",'<div ng-switch on="alert.type" class="dynamic-alert">\n    <a ng-switch-when="intimate-message"\n        ui-sref="{{ alert.state.stateName }}({{ alert.state.stateParams }})"\n        ng-click="close($event, \'clicked\')"\n        ng-class="alert.type"\n        class="container">\n        <img src="{{ alert.imageUrl }}" class="image" />\n        <span class="text">\n            <strong ng-bind="alert.displayName"></strong><em ng-bind="\'@\' + alert.username"></em> sent you a private message: "{{ alert.message }}".\n        </span>\n    </a>\n    <a ng-switch-when="public-message"\n        ui-sref="{{ alert.state.stateName }}({{ alert.state.stateParams }})"\n        ng-click="close($event, \'clicked\')"\n        ng-class="alert.type"\n        class="container">\n        <img src="{{ alert.imageUrl }}" class="image" />\n        <span class="text">\n            <strong ng-bind="alert.displayName"></strong><em ng-bind="\'@\' + alert.username"></em> says: "{{ alert.message }}".\n        </span>\n    </a>\n    <a ng-switch-when="intimate-invitation-accepted"\n        ui-sref="{{ alert.state.stateName }}({{ alert.state.stateParams }})"\n        ng-click="close($event, \'clicked\')"\n        ng-class="alert.type"\n        class="container">\n        <img src="{{ alert.imageUrl }}" class="image" />\n        <span class="text">\n            <strong ng-bind="alert.displayName"></strong><em ng-bind="\'@\' + alert.username"></em> accepted your invitation to talk. Write {{ alert.displayName }} a private message.\n        </span>\n    </a>\n    <a ng-switch-when="message-liked"\n        ui-sref="{{ alert.state.stateName }}({{ alert.state.stateParams }})"\n        ng-click="close($event, \'clicked\')"\n        ng-class="alert.type"\n        class="container">\n        <img src="{{ alert.imageUrl }}" class="image" />\n        <span class="text">\n            <strong ng-bind="alert.displayName"></strong><em ng-bind="\'@\' + alert.username"></em> likes your message: "{{ alert.message }}".\n        </span>\n    </a>\n    <a ng-switch-when="intimate-invitation-received"\n        ui-sref="{{ alert.state.stateName }}({{ alert.state.stateParams }})"\n        ng-click="close($event, \'clicked\')"\n        ng-class="alert.type"\n        class="container">\n        <img src="{{ alert.imageUrl }}" class="image" />\n        <span class="text">\n            <strong ng-bind="alert.displayName"></strong><em ng-bind="\'@\' + alert.username"></em> invites you to talk privately. Start a conversation!\n        </span>\n    </a>\n    <a ng-switch-when="user-mentioned"\n        ui-sref="{{ alert.state.stateName }}({{ alert.state.stateParams }})"\n        ng-click="close($event, \'clicked\')"\n        ng-class="alert.type"\n        class="container">\n        <img src="{{ alert.imageUrl }}" class="image" />\n        <span class="text">\n            <strong ng-bind="alert.displayName"></strong><em ng-bind="\'@\' + alert.username"></em> mentioned you in <strong ng-bind="alert.spotName"></strong>: "{{ alert.message }}".\n        </span>\n    </a>\n    <a href="#" class="close" ng-click="close($event, \'ignored\')"></a>\n</div>'),a.put("/templates/common/directives/navigation-menu.html",'<span class="branded-text branded-border-top-after selected-item" ng-bind="selectedItem.name"></span>\n<ul class="menu-view" ng-show="isVisible">\n    <li ng-repeat="item in items">\n        <a class="item" ng-bind="item.name" ng-click="onClick($event, item)"\n           ui-sref="{{ item.stateName }}({{ item.stateParams }})" ui-sref-active="current branded-text"></a>\n    </li>\n</ul>'),a.put("/templates/common/faces-list.html",'<ul class="faces-list">\n    <li ng-repeat="user in facesList" class="face-item" ng-class="{ online: onlineMembers.isOnline(user.id) }"\n        ng-style="{ backgroundImage: \'url(\' + user.getUserImageUrl(imageOptions) + \')\' }">\n        <a class="anchor" ng-click="faceClick(user)" profile-hover="user.id"></a>\n    </li>\n</ul>'),a.put("/templates/common/message-bubble/layout.html",'<div bindonce class="message-bubble" ng-class="{ \'me\': message.isMine() }">\n\n    <!-- User Image -->\n    <a class="user-image" profile-hover="user.id" user-href="user"\n        ng-style="{ backgroundImage: \'url(\' + senderImage + \')\' }"\n        ng-class="{\n            \'online\': user.is_online,\n            \'host\': isHost\n        }">\n    </a>\n\n    <!-- Bubble -->\n    <div class="bubble-wrapper">\n        <div class="bubble"\n            ng-class="[\n                messageType,\n                hasTextAndNotASelfie ? \'with-text\' : \'\',\n                mineOrIntimate ? \'no-user-details\' : \'\',\n                isThinImage ? \'thin\' : \'\',\n                isShortImage ? \'short\' : \'\',\n                isBlankCaret ? \'blank-caret\' : \'\'\n            ]"\n            ng-switch on="messageType">\n\n            <!-- User Details -->\n            <div ng-if="!mineOrIntimate" class="user-details" auto-direction="user.display_name |escape">\n\n                <!-- DisplayName -->\n                <a class="display-name" profile-hover="user.id"\n                    user-href="user"\n                    ng-bind="user.display_name">\n                </a>\n\n                <!-- Username -->\n                <span class="username" user-href="user" profile-hover="user.id"\n                    ng-bind="user.username | prepend:\'@\'">\n                </span>\n\n            </div>\n\n            <!-- Text -->\n            <message-bubble-text ng-if="hasTextAndNotASelfie"></message-bubble-text>\n\n            <!-- Photo -->\n            <message-bubble-photo ng-switch-when="photo"></message-bubble-photo>\n\n            <!-- Sticker -->\n            <message-bubble-sticker ng-switch-when="sticker"></message-bubble-sticker>\n\n            <!-- Selfie -->\n            <message-bubble-selfie ng-switch-when="selfie"></message-bubble-selfie>\n\n            <!-- Video -->\n            <message-bubble-video ng-switch-when="video"></message-bubble-video>\n\n            <!-- Link -->\n            <message-bubble-link ng-switch-when="link"></message-bubble-link>\n\n            <!-- Actions -->\n            <ul class="actions">\n\n                <!-- Like -->\n                <li class="like branded-icons-before-hover"\n                    ng-if="notMineOrIntimate || message.likes > 0"\n                    ng-class="{\n                        \'branded-icons-before-active branded-text-active\': message.likes > 0,\n                        \'bounce\': bounceALike\n                    }"\n                    signup-tooltip="Please sign in to like a message"\n                    signup-translate="embed.signin_tooltip.like_a_message"\n                    signup-action="toggleLike()">\n                    <!-- parent-container=".bubble" -->\n                    <span ng-bind="message.likes" ng-if="message.likes > 0"></span>\n                </li>\n\n                <!-- Reply -->\n                <li class="reply branded-icons-before-hover"\n                    ng-if="notMineOrIntimate"\n                    ng-click="reply()">\n                </li>\n\n                <!-- More -->\n                <li class="more branded-icons-before-hover"\n                    tooltip="\'/templates/spot/message-context-menu.html\'">\n                </li>\n\n                <!-- Timeago -->\n                <li class="timeago"\n                    ng-bind="message.timestamp | prettyDate">\n                </li>\n\n                <!-- Device -->\n                <li class="device" ng-click="openMobileCode(\'mobile_icon\', message.sent_from)" ng-class="{\n'+"                        'branded-icons': message.sent_from === 'ios' || message.sent_from === 'android',\n                        'ios': message.sent_from === 'ios',\n                        'android': message.sent_from === 'android',\n                        'web': message.sent_from === 'web'\n                    }\">\n                </li>\n            </ul>\n\n            <!-- Ha-Chupchik shel ha kumkum -->\n            <div class=\"caret-image\"\n                 ng-style=\"isBlankCaret ? {} : { backgroundImage: 'url(' + backgroundImage + ')' }\"></div>\n        </div>\n\n        <!-- Mobile Exclusive -->\n        <div class=\"mobile-exclusive\" ng-click=\"openMobileCode('mobile_exclusive')\" ng-if=\"isMobileExclusive\">\n                Mobile Exclusive!\n        </div>\n    </div>\n</div>"),a.put("/templates/common/message-bubble/link.html",'<div class="bubble-link bubble-image-wrapper" ng-class="{ \'no-background\': !backgroundImage }"\n     ng-click="openModal()">\n    <img class="bubble-image" ng-src="{{ backgroundImage }}" />\n\n    <button class="link-preview" auto-direction="mediaEntity.title">\n        <span class="domain" bo-bind="mediaEntity.provider_url | domain"></span>\n        <div class="title" bo-html="mediaEntity.title | escape | tagWrap"></div>\n    </button>\n</div>'),a.put("/templates/common/message-bubble/photo.html",'<div class="bubble-photo bubble-image-wrapper" ng-click="openModal()">\n    <img class="bubble-image" ng-src="{{ backgroundImage }}" />\n</div>'),a.put("/templates/common/message-bubble/selfie.html",'<div class="bubble-selfie bubble-image-wrapper" ng-click="openMobileCode(\'selfie\')">\n    <img class="bubble-image" ng-src="{{ backgroundImage }}" />\n\n    <div class="selfie-text-wrapper">\n        <article class="selfie-text"\n            bo-html="messageText | tagWrap"\n            auto-direction="message.text">\n        </article>\n    </div>\n</div>'),a.put("/templates/common/message-bubble/sticker.html",'<div class="bubble-sticker" ng-click="openMobileCode(\'sticker\')">\n    <img class="sticker-image" ng-src="{{ stickerUrl }}" />\n</div>'),a.put("/templates/common/message-bubble/text.html",'<article class="bubble-text"\n    auto-direction="message.text"\n    link-entities entities="messageEntities"\n    text="messageText"></article>'),a.put("/templates/common/message-bubble/video.html",'<div class="bubble-video bubble-image-wrapper" ng-class="{ playing: isPlaying }">\n\n    <img class="bubble-image" ng-src="{{ backgroundImage }}" />\n\n    <button class="link-preview" ng-click="play()" auto-direction="mediaEntity.title">\n        <span class="domain" bo-bind="mediaEntity.provider_url | domain"></span>\n        <div class="title" bo-html="mediaEntity.title | escape | tagWrap"></div>\n    </button>\n\n    <div class="play-content" ng-if="isPlaying"\n         bo-html="mediaEntity.html | previewIFrame: {\n            autoPlay: true,\n            webkitallowfullscreen: \'\',\n            mozallowfullscreen: \'\',\n            allowfullscreen: \'\'\n         }">\n    </div>\n</div>'),a.put("/templates/common/message-preview.html",'<div class="message-preview-view" ng-class="entity ? \'type-\' + entity.getType().toLowerCase() : \'\'" ng-click="messageClick({ message: message })">\n    <a ng-if="hasDeletePermisson" ng-click="deleteMessage($event)" class="delete-media-message">X</a>\n\n    <div class="text"\n         ng-if="!message.hasEntities()"\n         ng-bind-html="message.text | escape"></div>\n\n    <div ng-if="message.hasEntities()">\n        <div class="expanded" ng-if="expanded">\n\n             <div ng-if="entity.type==\'embed\'"\n                  ng-bind-html="entity.html | previewIFrame:{ width: width , height: height, autoPlay: true }"></div>\n\n             <audio ng-if="entity.type==\'audio\'" controls autoplay="true">\n                <source ng-src="{{ entity.getAudioFileUrl() }}" />\n             </audio>\n        </div>\n\n        <a ng-if="!expanded">\n            <div ng-if="entity.type == \'embed\' && entity.subtype==\'link\'"></div>\n\n            <div ng-class="{ \'preview-overlay\': entity.is_playable }">\n                <div ng-if="entity.getImageUrl({ width: width, height: height })" class="message-wrapper" >\n                    <div class="photo"\n                         ng-class="{ \'link-photo\' : entity.subtype==\'link\'}"\n                         ng-style="{ backgroundImage: \'url(\\\'\' + entity.getImageUrl({ width: width, height: height, crop: \'fill\' }) + \'\\\')\' }"></div>\n                </div>\n\n                <div ng-if="entity.type==\'audio\'" class="audio">\n                    <source ng-src="{{ entity.getAudioFileUrl() }}" />\n                </div>\n                <div class="play-overlay" ng-if="entity.is_playable && entity.type!=\'audio\'">\n                    <div class="play"></div>\n                </div>\n            </div>\n        </a>\n    </div>\n</div>'),a.put("/templates/common/pinned-message-directive.html",'<div class="pinned-message-directive-view" ng-class="entity ? \'type-\' + entity.getType().toLowerCase() : \'\'" ng-click="messageClick({ message: message })">\n    <div class="text"\n         ng-if="!message.hasEntities()"\n         ng-bind-html="message.text | escape"></div>\n\n    <div ng-if="message.hasEntities()">\n<!--         <div class="expanded" ng-if="expanded">\n\n             <div ng-if="entity.type==\'embed\'"\n                  ng-bind-html="entity.html | previewIFrame:{ width: width , height: height, autoPlay: true }"></div>\n\n             <audio ng-if="entity.type==\'audio\'" controls autoplay="true">\n                <source ng-src="{{ entity.getAudioFileUrl() }}" />\n             </audio>\n        </div> -->\n\n        <a ng-if="!expanded">\n            <div ng-class="{ \'preview-overlay\': entity.is_playable }">\n                <div ng-if="entity.getImageUrl({ width: width, height: height })" class="message-wrapper">\n                    <div class="photo" ng-style="{ backgroundImage: \'url(\\\'\' + entity.getImageUrl({ width: width, height: height, crop: \'fill\' }) + \'\\\')\' }"></div>\n                </div>\n\n                <div ng-if="entity.type==\'audio\'" class="audio">\n                    <div class="play"></div>\n                </div>\n            </div>\n        </a>\n    </div>\n    <div class="details" ng-if="[\'embed\', \'video\', \'location\'].indexOf(entity.type) !== -1">\n        <div class="content" ng-bind="entity.type === \'location\'? entity.getLocationFullAddress() : entity.title" title="{{entity.type}}"></div>\n    </div>\n    <div class="info">\n        <div class="sender" ng-class="{ owner: message.isMine() }">\n            <span>by </span>\n\n            <a sender-href="message">\n                <span class="name" ng-bind="message.username | prepend:\'@\'"></span>\n            </a>\n<!--             <span class="name" ng-bind="message.timestamp | prettyDate"></span> -->\n        </div>\n    </div>\n</div>\n'),a.put("/templates/common/spot-item.html",'<ng-switch on="spot.type">\n    <!-- Regular spots -->\n    <a class="spot-item-view branded-bg-transparent-active-15 branded-border-active public-spot" spot-href="spot" ng-click="hrefClick($event, spot)" ng-switch-when="public">\n        <div class="spot-icon" ng-class="{ host: spot.isHostedByMe() }" spot-thumbnail="spot" options="{ width: 46, height: 46, crop: \'fill\' }"></div>\n        <div class="spot-info">\n            <div class="spot-title">\n                <span class="spot-name" ng-bind="spot.name" ng-attr-title="{{spot.name}}"></span>\n                <span class="spot-right-side">\n                    <span class="spot-last-activity-date" ng-bind="lastActivityDate | prettyDate"></span>\n                </span>\n            </div>\n            <div class="spot-desc">\n                <span ng-if="spot.online_members_count > 0">\n                    <span class="online-count" ng-bind="spot.online_members_count + \' Online\'"></span>\n                    <span class="total-count" ng-bind="spot.members_count | number | prepend:\'/ \'"></span>\n                </span>\n                <span ng-if="!spot.online_members_count" class="total-count" ng-bind="spot.members_count + \' Members\'"></span>\n            </div>\n        </div>\n    </a>\n\n    <!-- Intimate spots -->\n    <a class="spot-item-view branded-bg-transparent-active-15 branded-border-active intimate-spot" spot-href="spot" ng-click="hrefClick($event, spot)" ng-switch-when="intimate">\n        <div class="spot-icon" ng-class="{ online: onlineMembers.isOnline(spot.other_party_id) }" spot-thumbnail="spot" options="{ width: 46, height: 46, crop: \'fill\' }"></div>\n        <div class="spot-info">\n            <div class="spot-title" ng-attr-title="{{spot.other_party.display_name}} {{ spot.other_party.username | prepend:\'@\' }}">\n                <span class="spot-name">\n                    <span class="display-name" ng-bind="spot.other_party.display_name"></span>\n                    <span class="username" ng-bind="spot.other_party.username | prepend:\'@\' "></span>\n                </span>\n                <span class="spot-right-side">\n                    <span class="spot-last-activity-date" ng-bind="lastActivityDate | prettyDate"></span>\n                    <span class="counter-circle" ng-if="spot.unread_count">\n                        <span class="number" ng-bind="spot.unread_count"></span>\n                    </span>\n                </span>\n            </div>\n            <div class="spot-desc" ng-bind="latestMessage.getText()"></div>\n        </div>\n    </a>\n</ng-switch>'),a.put("/templates/common/tooltips/profile-hover.html",'<div class="profile-hover-view">\n    <div class="handle"></div>\n    <div class="container">\n        <div class="user-image" ng-style="{ backgroundImage: \'url(\' + user.getUserImageUrl({ width: 69, height: 69, crop: \'fill\' }) + \')\' }"\n            ng-class="{ online: user.is_online}">\n            <a class="user-image-anchor" user-href="user"></a>\n        </div>\n        <div class="user-data">\n            <div class="names">\n                <a user-href="user" class="name" ng-bind="user.display_name"></a>\n                <a user-href="user" class="username branded-text" ng-bind="user.username | prepend:\'@\'" ></a>\n            </div>\n\n            <div class="last-message-wrapper" ng-if="lastMessage">\n                <span class="label">Last message</span>\n                <div class="message" ng-bind="lastMessage" ui-jq="dotdotdot"></div>\n            </div>\n\n            <div class="intimate-spot-actions thin" ng-if="!user.isMe()" ng-switch on="user.relation_status">\n                <div ng-switch-when="none">\n                    <button class="invite-button with-text branded-bg"\n                        signup-tooltip="Please sign in to talk privately"\n                        signup-translate="embed.signin_tooltip.talk_privately"\n                        signup-action="inviteIntimateSpot()">\n                        <span class="text">Invite to DirectSpot</span>\n                    </button>\n                </div>\n\n                <div class="invitation-sent" ng-switch-when="invitation_sent">Invitation Sent</div>\n\n                <div class="invitation-received" ng-switch-when="invitation_received">\n                    <div class="action-text branded-text">Accept Invitation?</div>\n                    <button class="accept-button branded-bg" ng-click="acceptIntimateSpot(true)"></button>\n                    <button class="decline-button" ng-click="user.declineIntimate()"></button>\n                </div>\n\n                <div ng-switch-when="intimate">\n                    <a class="go-to-intimate-button with-text" intimate-href="user">\n                        <span class="text">Send Message</span>\n                    </a>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>'),a.put("/templates/common/tooltips/signup-tooltip.html",'<div class="signup-tooltip-view">\n    <div class="handle"></div>\n    <div class="container">\n        <button class="tooltip-close" ng-click="close()"></button>\n        <div class="tooltip-text" ng-bind="text"></div>\n        <div class="connect-buttons">\n            <button ng-click="loginWith(\'facebook\')" class="connect-button-with-text facebook">Sign in</button>\n            <button ng-click="loginWith(\'twitter\')" class="connect-button-with-text twitter">Sign in</button>\n            <button ng-click="loginWith(\'google+\')" class="connect-button-with-text google-plus">Sign in</button>\n        </div>\n        <button ng-show="!expendContent" ng-click="expendButton()" class="expend-button">More options</button>\n        <div class="connect-buttons expend-content" ng-show="expendContent">\n            <button ng-click="loginWith(\'linkedin\')" class="connect-button-with-text linkedin">Sign in</button>\n        </div>\n        <div class="tooltip-footer">\n            <span class="label">We\'ll never post on your behalf</span>\n            <div class="disclaimer-links">\n                <a ui-sref="app.disclaimer.terms" class="disclaimer-link" >Terms</a> &\n                <a ui-sref="app.disclaimer.privacy" class="disclaimer-link">Privacy</a>\n            </div>\n        </div>\n    </div>\n</div>'),a.put("/templates/footer/layout.html",'<div class="footer-view" ng-controller="FooterController" ng-switch on="footerType">\n    <div ng-switch-when="default" class="footer-content">\n        <a href="/landing/index.html" target="_blank" class="logo"></a>\n        <a href="/landing/index.html" target="_blank" class="anchor">Add Spot.IM to your site</a>\n        <button class="mobile-login"\n            signup-tooltip="Please sign in to download the app"\n            signup-translate="embed.signin_tooltip.download_the_app"\n            signup-action="mobileCode.open(\'footer\')">Continue from mobile</button>\n    </div>\n    <div ng-switch-when="sso" class="footer-content">\n        <a href="/landing/index.html" target="_blank" class="logo"></a>\n        <span>\n            By continuing, you agree to our <a class="anchor" ui-sref="app.disclaimer.terms">Terms</a>\n            and <a class="anchor" ui-sref="app.disclaimer.privacy">Privacy Policy</a>\n        </span>\n    </div>\n    <div ng-switch-when="host" class="footer-content">\n        <a ui-sref="app.manage_spots" class="logo"></a>\n        <a class="anchor manage-spots branded-text branded-border-bottom" ui-sref="app.manage_spots">Host Panel</a>\n        <!-- <a class="anchor" ui-sref="app.spot_invite">Grow your community</a> -->\n        <button class="mobile-login"\n            signup-tooltip="Please sign in to download the app"\n            signup-translate="embed.signin_tooltip.download_the_app"\n            signup-action="mobileCode.open(\'footer\')">Continue from mobile</button>\n    </div>\n</div>'),a.put("/templates/footer/mobile-tooltip.html",'<div class="mobile-tooltip-view fade-in" ng-controller="MobileTooltipController">\n    <div class="handle"></div>\n	<div class="wrapper">\n		<div class="appstore branded-icons" ng-click="openAppstore($event)"></div>\n		<div class="playstore branded-icons" ng-click="openPlaystore($event)"></div>\n	</div>\n</div>'),a.put("/templates/header/invitations.html",'<div class="invitations-tooltip" ng-controller="InvitationsController">\n    <div class="handle"></div>\n    <div class="invitations-content">\n        <div class="invitations-header">\n            <em class="new-invitations branded-text" ng-bind="getNewInvitationsLabel()"></em>\n        </div>\n\n        <div class="invitations-wrapper" tinyscrollbar="tinyscrollbar">\n            <div class="scrollbar"><div class="track"><div class="thumb"></div></div></div>\n            <div class="viewport">\n                <div class="overview">\n                    <ul class="invitations-list">\n                        <li class="invitation" ng-repeat="invitation in invitations.list | orderBy:\'timestamp\':true"\n                        ng-if="!invitation.isHandled">\n                            <div ng-click="goToMainEntity($event, invitation)" ng-class="{ \'linked-invitation\': invitation.main }">\n                                <div class="invitation-image" ng-style="{ backgroundImage: \'url(\' + invitation.imageUrl + \')\' }"></div>\n                                <div class="invitation-data">\n                                    <div class="text" link-entities data-text="invitation.text" data-entities="invitation.entities"></div>\n                                    <div class="timestamp" ng-bind="invitation.timestamp | prettyDate"></div>\n                                </div>\n                                <div class="buttons">\n                                    <a class="accept branded-bg" ng-click="accept($event, invitation)" title="Accept invitation"></a>\n                                    <a class="decline" ng-click="decline($event, invitation)" title="Decline invitation"></a>\n                                </div>\n                            </div>\n                        </li>\n                    </ul>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>'),a.put("/templates/header/notifications.html",'<div class="notifications-tooltip" ng-controller="NotificationsController">\n    <div class="handle"></div>\n    <div class="notifications-content">\n        <div class="notifications-wrapper tinyscrollbar" tinyscrollbar="tinyscrollbar">\n            <div class="scrollbar"><div class="track"><div class="thumb"></div></div></div>\n            <div class="viewport">\n                <div class="overview">\n                    <ul class="notifications-list">\n                        <li class="notification unread" ng-repeat="notification in notifications.list | orderBy:\'timestamp\':true"\n                            ng-class="{ unread: notification.isUnread() }">\n                            <div ng-click="goToMainEntity($event, notification)" ng-class="{ \'linked-notification\': notification.main }">\n                                <div class="notification-image" ng-style="{ backgroundImage: \'url(\' + notification.imageUrl + \')\' }"></div>\n                                <div class="notification-data">\n                                    <div class="text" link-entities data-text="notification.text" data-entities="notification.entities"></div>\n                                    <div class="timestamp" ng-bind="notification.timestamp | prettyDate"></div>\n                                </div>\n                                <!-- <div class="buttons">\n                                    <div class="remove" title="Remove notification" ng-if="false"></div>\n                                    <div class="mark-read" ng-click="markRead($event, notification);" title="Mark notification as read"></div>\n                                </div> -->\n                            </div>\n                        </li>\n                    </ul>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>'),a.put("/templates/layout.html",'<div class="spot-im-embed" ng-class="bodyClasses" ng-controller="RootController" state-changer anchor-click-root\n     ng-init="afterRender()" painted-stage-marker>\n    <div class="spot-bubble ng-hide" tooltip-container>\n        <div class="layout-view-container">\n            <div class="layout-view" my-spots-class="my-spots-visible">\n                <div class="my-spots-wrapper" ng-include="\'/templates/my-spots/layout.html\'"></div>\n                <div class="embed-view">\n                    <ng-include src="\'/templates/mobile-code/layout.html\'"></ng-include>\n                    <ng-include src="\'/templates/common/application-header.html\'"></ng-include>\n                    <dynamic-alerts></dynamic-alerts>\n                    <div class="embed-body" tooltip-container ui-view></div>\n                    <ng-include src="\'/templates/footer/layout.html\'"></ng-include>\n                </div>\n                <div class="my-spots-backdrop" ng-click="toggleMySpots()"></div>\n            </div>\n        </div>\n    </div>\n\n    <div class="notices-bubble ng-hide" ng-class="noticeBubbleHeightClass" ng-click="spotState($event)">\n        <ng-include src="\'/templates/notices/notice.html\'"></ng-include>\n    </div>\n    <div class="default-bubble ng-hide" ng-click="spotState($event)" ng-controller="DefaultBubbleController" on-click-analytics="Ticker Expanded">\n        <div class="curved-text" bend-text="defaultBubbleData.text" class-name="defaultBubbleData.className" radius="43"\n             ng-style="{ color: defaultBubbleData.textColor }" ng-if="showBendText">\n        </div>\n    	<div class="branded-bubble branded-bg branded-bubble-text" ng-attr-style="{{ image }}" ng-repeat="image in [ defaultBubbleData.image ]"\n             ng-class="{new: unreadNotifications > 0}">\n            <span class="counter-circle">\n                <span ng-bind="unreadNotifications" class="number"></span>\n            </span>\n        </div>\n    </div>\n    <div class="spot-im-dot" ng-click="toggleSpotState($event)"></div>\n</div>'),a.put("/templates/message/modal.html",'<button class="close-button" ng-click="$dismiss()"></button>\n<div class="modal-body" tooltip-container>\n    <button class="pagination prev"\n         ng-if="messages.length > 1"\n         ng-click="move(currentIndex-1)"\n         ng-disabled="currentIndex == 0"\n         ng-class="{ disabled: currentIndex == 0 }"></button>\n\n    <button class="pagination next"\n         ng-if="messages.length > 1"\n         ng-click="move(currentIndex+1)"\n         ng-disabled="currentIndex == numOfMessages - 1"\n         ng-class="{ disabled: currentIndex == numOfMessages-1 }"></button>\n\n    <div class="text"\n         ng-if="!message.hasEntities()"\n         ng-bind-html="message.text | escape"\n         ng-style="{ width: width, height: height }"></div>\n\n    <div ng-if="message.hasEntities()">\n        <div ng-switch on="entity.type"\n             class="entity"\n             ng-class="{ overlay: entity.is_playable }">\n\n            <div ng-switch-when="location" class="location">\n                <div class="photo" ng-style="photoStyle"></div>\n                <div class="info">\n                    <div class="name">\n                        <a ng-href="//maps.google.com?q={{entity.getLocationFullAddress()}}"\n                           ng-bind="entity.name"\n                           target="_blank"></a>\n                    </div>\n                    <div class="address" ng-bind="entity.getLocationFullAddress()"></div>\n                </div>\n            </div>\n\n            <div ng-switch-when="embed">\n                <div ng-switch on="entity.subtype">\n                    <div ng-switch-when="photo" class="photo" ng-style="photoStyle"></div>\n                    <div ng-switch-default class="other_embed">\n                        <div class="media">\n                                <div class="video"\n                                     ng-if="entity.is_playable"\n                                     ng-bind-html="entity.html | previewIFrame:{ width: \'100%\', height: \'100%\', autoPlay: false }"></div>\n\n                                <div class="photo"\n                                     ng-if="!entity.is_playable"\n                                     ng-style="{ backgroundImage: \'url(\' + entity.getImageUrl({ full_size: true }) + \')\' }">\n                                </div>\n                        </div>\n\n                        <div class="title"\n                             ng-bind="entity.title | truncate:45"\n                             title="{{entity.title}}"\n                             ng-if="entity.title"></div>\n\n                        <div class="description"\n                             ng-bind="entity.description | truncate:130"\n                             title="{{entity.description}}"\n                             ng-if="entity.description"></div>\n\n                        <a class="provider"\n                           ng-href="{{entity.url}}" target="_blank"\n                           utm-href\n                           ng-if="entity.url">Go to website</a>\n                    </div>\n                </div>\n            </div>\n\n            <div ng-switch-when="photo">\n                <div class="photo" ng-style="photoStyle"></div>\n            </div>\n\n            <div ng-switch-when="video">\n                <div class="photo" ng-style="photoStyle"></div>\n            </div>\n\n            <div ng-switch-when="audio">\n                <audio controls>\n                    <source ng-src="{{ entity.getAudioFileUrl() }}" />\n                </audio>\n            </div>\n        </div>\n    </div>\n\n    <ul class="actions">\n        <li class="right likes clickable branded-icons-parent-hover branded-text-hover"\n            ng-class="{ liked: message.liked }"\n            signup-tooltip="Please sign in to like this item"\n            signup-translate="embed.signin_tooltip.like_this_item"\n            signup-action="spotActions.toggleLikeMessage(message)">\n                <span ng-bind="message.likes" class="branded-text"></span>\n                <span class="heart" ng-class="{\'branded-icons-active\' : message.liked}"></span>\n            </li>\n        <li class="sender">\n            <!--a ng-href="{{message.get(\'sender\').getProfileUrl()}}"\n               class="sender-image"\n               ng-style="{ backgroundImage: \'url(\' + message.getSenderImageUrl({ width: 30, height: 30, crop: \'fill\' }) + \')\'}"\n               ng-click="$dismiss()">\n            </a-->\n        </li>\n        <li>\n            <span class="uploaded-by">Uploaded by</span>\n            <a sender-href="message"\n               ng-click="$dismiss()"\n               class="username"\n               ng-bind="message.username | prepend:\'@\'"></a>\n        </li>\n        <li class="timestamp" ng-bind="message.timestamp | prettyDate"></li>\n        <li class="like branded-text-hover" ng-bind="message.likes | append:\' Likes\'"\n            ng-class="{ liked: message.liked, pulse: pulseLikes }"></li>\n        <li class="icon share clickable branded-icons branded-text-hover" ng-click="spotActions.shareMessage(message)">Share</li>\n        <li class="icon report clickable branded-icons branded-text-hover"\n            signup-tooltip="Please sign in to like this item"\n            signup-translate="embed.signin_tooltip.report_this_item"\n            signup-action="spotActions.reportMessage(message)">\n            Report\n        </li>\n    </ul>\n</div>'),a.put("/templates/mobile-code/code-received.html",'<div class="code-received">\n    <div class="header">\n        <div ng-if="!mobileCode.isSmsSent">\n            <div class="title">Sign in from mobile</div>\n        </div>\n        <div ng-if="mobileCode.isSmsSent">\n            <div class="title">Yay! We\'ve sent you a link</div>\n            <div class="subtitle" ng-bind="headerSubtitle"> </div>\n        </div>\n    </div>\n    <div class="code-wrapper">\n        <div ng-if="mobileCode.isSmsSent" class="text-code">\n            <strong>Download the app.</strong> Then use this verification code to sign in.\n        </div>\n        <div ng-if="!mobileCode.isSmsSent" class="text-code">\n            This is your verification code, <br> use it to sign in.\n        </div>\n        <div class="code-verification" ng-bind="mobileCode.verificationCode"></div>\n        <div class="buttons-wrapper" ng-if="mobileCode.isSmsSent">\n            <button class="resend-button" ng-class="{\'loading\': loading}" ng-disabled="loading" ng-click="sendSms()">Send again</button>\n            <button class="reenter-button" ng-click="phoneEnterStep()">\n                <span>Re-enter number<span>\n            </button>\n        </div>\n        <div class="buttons-wrapper" ng-if="!mobileCode.isSmsSent">\n            <span class="label">Don\'t have the app?</span>\n            <button class="download-link-button" ng-click="phoneEnterStep()">\n                <span class="text">Get Download link</span>\n            </button>\n        </div>\n    </div>\n    <div class="timer-wrapper">\n        <div class="expiration-text">This code will expire in</div>\n        <div class="timer">\n            <div class="timer-icone"></div>\n            <div countdown class="timer-countdown"></div>\n        </div>\n    </div>\n</div>'),a.put("/templates/mobile-code/layout.html",'<div class="mobile-code-wrapper" ng-controller="MobileCodeController" ng-if="mobileCode.isVisible">\n    <div class="mobile-code-view" ng-class="mobileCode.step">\n        <button class="hide-button" ng-click="mobileCode.close()"></button>\n        <ng-include src="\'/templates/mobile-code/phone-enter.html\'"></ng-include>\n        <ng-include src="\'/templates/mobile-code/code-received.html\'"></ng-include>\n    </div>\n    <div class="mobile-code-backdrop">\n</div>'),a.put("/templates/mobile-code/phone-enter.html",'<div class="phone-enter">\n    <div class="header">\n        <div class="container">\n            <div class="title">Continue from Mobile</div>\n            <div class="subtitle">Get a link to Spot.IM on your phone</div>\n            <div class="icons">\n                <div class="android-icon"></div>\n                <div class="iphone-icon"></div>\n            </div>\n        </div>\n    </div>\n    <form class="content" name="embedPhoneCode" ng-submit="sendSms()">\n        <div class="error" ng-if="error" ng-bind="error"></div>\n        <div class="phone-wrapper">\n            <div class="country-code">\n                <select class="country-code-select" ng-model="mobileCode.countryCode"\n                        ng-options="country.code as country.name + \' (+\' + country.code + \')\' for country in countryCodes">\n                </select>\n                <div class="selected-country-code" ng-bind="mobileCode.countryCode | prepend:\'+\'"></div>\n            </div>\n            <div class="phone-number-wrapper" ng-class="inputColor">\n                <input  class="phone-number" ng-model="mobileCode.phoneNumber" placeholder="Your phone number" ng-blur="phoneNumberValidation()" ng-class="inputColor" autofocus ng-disabled="loading" />\n            </div>\n        </div>\n        <div class="links-wrapper">\n            <button class="sms-button" type="submit" ng-class="{\'loading\': loading}" ng-disabled="loading">Text me a link!</button>\n            <div>\n                <span class="label">Already have the app?</span>\n                <div class="code-button-icon">\n                    <a href="#" class="code-button" ng-click="getCode()">Get verification code</a>\n                    <div class="question-icon title-below"\n                    data-title="If you already installed the app, get the verification code to sign in.">\n                </div>\n                </div>\n            </div>\n        </div>\n        <div class="info-wrapper">\n            <div class="info-line">\n                <div class="phone-icon"></div>\n                <div class="label">Continue to talk on the go </div>\n            </div>\n            <div class="info-line">\n                <div class="friends-icon"></div>\n                <div class="label">Create new friendships</div>\n            </div>\n            <div class="info-line">\n                <div class="selfie-icon"></div>\n                <div class="label">Send cool Selfies & Stickers</div>\n            </div>\n        </div>\n    </form>\n</div>\n'),a.put("/templates/my-spots/layout.html",'<div class="my-spots-view" ng-controller="MySpotsController">\n    <div class="search-input-wrapper branded-bg">\n        <input type="text" class="search-input" ng-model="searchValue" placeholder="Search My Spots...">\n    </div>\n    <nav class="my-spots-categories">\n        <a class="item" ng-class="{current: filter == \'all\'}" ng-click="setFilter(\'all\')">\n            <span class="counter-text">All</span>\n        </a>\n        <a ng-if="hasIntimateSpots" class="item" ng-class="{current: filter === \'intimate\'}" ng-click="setFilter(\'intimate\')">\n            <span class="counter-text">Direct</span>\n            <span class="counter-circle" ng-if="unreadIntimateMessages">\n                <span class="number" ng-bind="unreadIntimateMessages"></span>\n            </span>\n        </span>\n        </a>\n        <a ng-if="hasHostSpots" class="item" ng-class="{current: filter === \'hosted\'}" ng-click="setFilter(\'hosted\')">\n            <span class="counter-text">Hosted</span>\n        </a>\n        <a ng-if="hasMemberSpots" class="item" ng-class="{current: filter === \'public\'}" ng-click="setFilter(\'public\')">\n            <span class="counter-text">Public</span>\n        </a>\n    </nav>\n    <div class="my-spots-results">\n        <ul class="my-spots-results-container">\n            <li ng-repeat="spot in list | orderBy:\'last_activity_date\':true">\n                <spot-item spot="spot" href-click="handleSpotClick($event, spot)"></spot-item>\n            </li>\n        </ul>\n    </div>\n</div>'),a.put("/templates/notices/join-community.html",'<div class="join-community-view" ng-controller="notices.controllers.joinCommunity" on-click-analytics="Ticker Expanded" analytics-parmeters="[joinCommunityStep]" ng-switch on="joinCommunityStep">\n    <button class="close-button" ng-click="closeNotice($event)"\n            on-click-analytics="Ticker Notices Closed" analytics-parmeters="[joinCommunityStep]"></button>\n    <div class="members-list teaser" ng-switch-when="JOIN_COMMUNITY" >\n        <div class="header-container">\n            <div ng-if="noticeData.members.length > 1" class="header"\n                locale-string="embed.notices.join_community.teaser1"\n                locale-params="{\n                    new_member: noticeData.members[0].display_name,\n                    online_count: noticeData.spot.members_count,\n                    spot_name: noticeData.spot.name\n                }">\n                <span ng-bind="noticeData.members[0].display_name"></span>  &\n                <span class="bold-text" ng-bind="noticeData.spot.members_count | append: \' others\'"></span> joined\n                <span ng-bind="noticeData.spot.name"></span> Community\n            </div>\n            <div ng-if="noticeData.members.length === 1" class="header"\n                locale-string="embed.notices.join_community.teaser"\n                locale-params="{\n                    new_member: noticeData.members[0].display_name,\n                    online_count: noticeData.spot.members_count,\n                    spot_name: noticeData.spot.name\n                }">\n                <span ng-bind="noticeData.members[0].display_name"></span> joined\n                <span ng-bind="noticeData.spot.name"></span> Community just now\n            </div>\n        </div>\n        <div class="faces-wrapper">\n            <ul class="faces-list">\n                <li ng-repeat="user in noticeData.members" class="face-item"\n                    ng-style="{ backgroundImage: \'url(\' + user.getUserImageUrl({ width: 24, height: 24, crop: \'fill\' }) + \')\' }">\n                </li>\n            </ul>\n            <div class="open-button branded-bg" locale-string="embed.notices.join_community.cta_button">Open</div>\n        </div>\n    </div>\n\n    <div class="popular-link teaser" ng-switch-when="POPULAR_LINK">\n        <div class="container">\n            <div class="header">\n                Hot on <span ng-bind="noticeData.spot.name"></span>\n            </div>\n            <div class="content">\n                <div class="popular-logo" ng-style="{ backgroundImage: \'url(\' + noticeData.popularLink.getImageUrl({ width: 59, height: 59}) + \')\' }"></div>\n                <div class="popular-title branded-text" auto-direction="noticeData.popularLink.title"\n                     ng-bind="noticeData.popularLink.title | truncate:40:{ breakWords: false }"></div>\n            </div>\n        </div>\n    </div>\n\n    <div class="join-ticker teaser" ng-switch-when="SPOT_ICON">\n        <div class="spot-logo" ng-style="{ backgroundImage: \'url(\' + noticeData.spot.getSpotIconUrl({ width: 51, height: 51 }) + \')\' }"></div>\n        <span class="text">\n            <span>Join <span ng-bind="noticeData.spot.name"></span> Community!</span>\n        </span>\n    </div>\n\n</div>\n'),a.put("/templates/notices/notice.html",'\n<div class="notices-view" ng-controller="notices.controllers.notice">\n    <ng-include ng-if="currentNotice.type === \'join-community\'" src="\'/templates/notices/join-community.html\'"></ng-include>\n    <ng-include ng-if="currentNotice.type === \'realtime\'" src="\'/templates/notices/realtime.html\'"></ng-include>\n</div>\n'),a.put("/templates/notices/realtime.html","\n<!-- \nScope has to define the following properties inside data object:\nnoticeClass - class for the notice view\nimageType - type of the image. Possible values:\n            'none': no image. (default)\n            'regular-image': regular image. Scope has to define imageUrl property that defines the image url.\n            'wide-image': wide image. Scope has to define imageUrl property that defines the image url.  \n            'icon-image': an icon.\nimageClass - Defines a class name for the image section\ntextType - type of the text. Possible values:\n            'text-block': single block of text. Scope has to contain text property that defines the text.\n            'user-text': user's name and username with a text. Scope has to contain text property that\n                         defines the text and displayName and username properties.\n            'title-text': a title with a text. Scope has to contain title and text properties that define the title and the text.\ntextClass - Defines a class name for the text section\n -->\n\n"+'<div class="notice-wrapper-view" ng-controller="notices.controllers.realtime" on-click-analytics="Ticker Expanded" analytics-parmeters="[data.noticeType]">\n    <div class="notice-view"\n         ng-class="[data.noticeClass, data.imageType === \'none\' ? \'no-image\' : \'\' ]">\n        <button class="close-button" ng-click="closeNotice($event)" on-click-analytics="Ticker Notices Closed" analytics-parmeters="[data.noticeType]"></button>\n        <div ng-class="[\'left-area\', data.imageType, data.imageClass]" ng-style="{ backgroundImage: \'url(\' + data.imageUrl + \')\' }"></div>\n        <div ng-class="[\'right-area\', data.textType, data.textClass]" ng-switch on="data.textType">\n            <div ng-switch-when="text-block" class="text" ng-bind-html="data.text | emphasis" ui-jq="dotdotdot"></div>\n            <div ng-switch-when="user-text">\n                <span ng-bind="data.displayName" class="name"></span>\n                <span ng-bind="data.username | prepend:\'@\'" class="username"></span>\n                <br/>\n                <div ui-jq="dotdotdot" ng-bind="data.text" class="text"></div>\n            </div>\n            <div ng-switch-when="title-text">\n                <div class="title" ng-bind="data.title"></div>\n                <div class="text" ng-bind="data.text" ui-jq="dotdotdot"></div>\n            </div>\n        </div>\n    </div>\n</div>'),a.put("/templates/session/connect.html",'<div class="connect-view">\n    <div class="networks">\n        <button class="facebook connect-button" ng-click="login()">Connect</button>\n        <button class="twitter connect-button">Connect</button>\n        <button class="google-plus connect-button">Connect</button>\n        <button class="linkedin connect-button">Connect</button>\n    </div>\n</div>'),a.put("/templates/session/register.html",'<div class="register-view">\n    register screen\n</div>'),a.put("/templates/spot/chat.html",'<div class="chat-view">\n    <ng-include src="\'/templates/spot/pinned-message.html\'"></ng-include>\n    <div class="messages-list-wrapper" ng-class="{ \'expanded-preview\': spotCtrl.expandedPreview }" tooltip-size-boundary>\n        <div class="messages-list" scroll-unwatch ng-scrollbar messages-scroll>\n            <div ng-if="spotCtrl.isFetchingMessages" class="messages-loader"></div>\n            <ul>\n                <li class="message-wrapper" scroll-unwatch-item scroll-item tooltip-container\n                    ng-repeat="message in spotCtrl.spot.messages | filter:{ show_in_history: true, deleted_by: null } | orderBy:\'timestamp\' track by message.id"\n                    message-bubble="message"></li>\n            </ul>\n            <ng-include ng-if="spotCtrl.isUserTyping" src="\'/templates/spot/typing-message.html\'">\n        </div>\n        <div ng-if="spotCtrl.newMessagesCount > 0" class="new-messages-wrapper">\n            <button class="new-messages"\n                    ng-click="spotCtrl.scrollToReadNewMessages()">\n                <span ng-bind="spotCtrl.newMessagesCount"></span> New messages\n            </button>\n        </div>\n        <div ng-if="!spotCtrl.spot.hasMessages() && !spotCtrl.isFetchingMessages" class="empty-intimate-spot" ng-switch on="spotCtrl.getEmptyMessageType()">\n            <div class="title">Start a Conversation!</div>\n            <div class="message" ng-switch-when="online">\n                <span ng-bind="spotCtrl.spot.name"></span> is <span class="online">online</span> and will get your messages instantly\n            </div>\n            <div class="message" ng-switch-when="mobile">\n                 <span ng-bind="spotCtrl.spot.name"></span> is on <span class="branded-text">Spot.IM Mobile</span> and will get your messages instantly\n            </div>\n            <div class="message" ng-switch-default>\n                <span ng-bind="spotCtrl.spot.name"></span> isn\'t online right now, and will see your messages later\n            </div>\n        </div>\n    </div>\n    <ng-include src="\'/templates/spot/post-message.html\'"></ng-include>\n</div>'),a.put("/templates/spot/faces-panel.html",'<div class="faces-panel-view" ng-controller="FacesPanelController">\n	<a class="members-button" ng-class="{ hover: spotCtrl.onlineMembers.totalCount > 0 }" ui-sref="app.public_spot.spot_members">\n		<div class="online"><span class="count" ng-bind="spotCtrl.onlineMembers.totalCount | thousands"></span> Online</div>\n		<div class="members" ng-bind="spotCtrl.spot.members_count | prepend:\'+\'"></div>\n	</a>\n	<div class="faces-wrapper" faces-list="usersList" image-options="imageOptions" face-width="31"\n		 online-members="spotCtrl.onlineMembers" face-click="onFaceClick"></div>\n</div>'),a.put("/templates/spot/layout.html",'<div class="spot-main" ng-if="spotCtrl.isReady()" ng-class="{ intimate: spotCtrl.spot.type === \'intimate\', joined: spotCtrl.spot.isJoined() }">\n    <ng-include src="\'/templates/spot/spot-header.html\'"></ng-include>\n    <ng-include ng-if="spotCtrl.spot.type !== \'intimate\'" src="\'/templates/spot/faces-panel.html\'"></ng-include>\n    <spot-menu spot="spotCtrl.spot" show-popular-links="spotCtrl.isPopularLinksEnabled()" ng-if="spotCtrl.spot.type !== \'intimate\'"></spot-menu>\n    <div ui-view></div>\n</div>'),a.put("/templates/spot/message-context-menu.html",'<div class="message-context-menu" ng-controller="MessageContextMenuController">\n    <ul class="menu" >\n        <li class="branded-text-hover"\n            ng-if="session.isRegistered"\n            ng-click="spotActions.shareMessage(message)">\n            Share Message\n        </li>\n        <li class="branded-text-hover"\n            ng-if="spot.isHostedByMe() && isPinned()"\n            ng-click="spot.unpinMessage(message.id)">\n            Unpin\n        </li>\n        <li class="branded-text-hover"\n            ng-if="spot.isHostedByMe() && !isPinned()"\n            ng-click="spot.pinMessage(message.id)">\n            Pin\n        </li>\n        <li class="branded-text-hover"\n            ng-if="spot.isHostedByMe() || message.isMine()"\n            ng-click="deleteMessage(message)">\n            Delete Message\n        </li>\n        <!--<li ng-if="user && !user.isMe() && user.relation_status === \'intimate\'" link-entities="[{id: user.getIntimateSpotId(), type: \'spot\'}]">Go to 1 On 1 Spot</li>\n        <li ng-if="user && !user.isMe() && user.relation_status === \'none\'" ng-click="user.inviteIntimate()">Invite to 1 On 1</li>\n        <li ng-if="user && !user.isMe() && user.relation_status === \'invitation_sent\'">1 On 1 Invitation Sent</li>\n        <li ng-if="user && !user.isMe() && user.relation_status === \'invitation_received\'">1 On 1 Invitation Received</li>-->\n        <li class="branded-text-hover"\n            ng-if="spot.isHostedByMe() && spot.isHost(message.sender_id) && !message.isMine()"\n            ng-click="spotActions.removeHost(message.sender_id)">\n            Remove Host\n        </li>\n        <li class="branded-text-hover"\n            ng-if="spot.isHostedByMe() && !spot.isHost(message.sender_id) && !message.isMine()"\n            ng-click="spotActions.addHost(message.sender_id)">\n            Assign Host\n        </li>\n        <li class="branded-text-hover"\n            ng-if="spot.isHostedByMe() && !spot.isHost(message.sender_id) && !message.isMine() && !spot.isKickedUser(message.sender_id)"\n            ng-click="spotActions.kickMember(message.sender_id)">\n            Kick User\n        </li>\n        <li class="branded-text-hover"\n            ng-if="spot.isHostedByMe() && !spot.isHost(message.sender_id) && !message.isMine() && spot.isKickedUser(message.sender_id)"\n            ng-click="spotActions.unkickMember(message.sender_id)">\n            UnKick User\n        </li>\n        <li class="branded-text-hover"\n            ng-if="session.isRegistered && !message.isMine() && !spot.isKickedUser(message.sender_id)"\n            ng-click="reportSender()">\n            Report User\n        </li>\n\n        <li class="branded-text-hover"\n            ng-if="session.isRegistered && !message.isMine()"\n            ng-click="spotActions.reportMessage(message)">\n            Report Message\n        </li>\n    </ul>\n</div>'),a.put("/templates/spot/pinned-message.html",'<div class="pinned-message-view ng-hide flash" ng-controller="PinnedMessageController"\n     ng-hide="!spotCtrl.spot.pinned_message" ng-class="{ host: spotCtrl.spot.isHostedByMe(), expanded: isExpanded }">\n    <div class="pinned-buttons">\n        <button class="menu-button" ng-click="togglePin()">\n            <span class="pin-icon"></span>\n        </button>\n        <button class="unpin-button" ng-if="isExpanded && spotCtrl.spot.isHostedByMe()" ng-click="unpin()">\n            Remove\n        </button>\n    </div>\n    <pinned-message ng-if="!!spotCtrl.spot.pinned_message" message="spotCtrl.spot.pinned_message"\n                    message-click="spotActions.openMessageModal(message)">\n    </pinned-message>\n</div>\n'),a.put("/templates/spot/popular-links/blocked-urls.html",'<div class="blocked-urls-view">\n    <button class="close-button" ng-click="$close()"></button>\n    <div class="header">\n        <div class="title">Edit Blocked Items</div>\n        <span class="description">\n            URL\'s on this list will <strong>never</strong> show on Most Popular screen.\n            <br/>\n            <strong>Note:</strong> Supports regular expressions.\n        </span>\n    </div>\n    <div class="block-url">\n        <input type="text" class="block-url-input" ng-model="blockedUrlsCtrl.urlToBlock" />\n        <button class="block-button" ng-click="blockedUrlsCtrl.blockUrl()">Add to list</button>\n    </div>\n    <div class="blocked-list-wrapper">\n        <ul class="blocked-list">\n            <li ng-repeat="url in blockedUrlsCtrl.updatedList | reverse" class="blocked-url">\n                <span ng-bind="url" class="url-text"></span>\n                <button class="unblock-button branded-text" ng-click="blockedUrlsCtrl.unblockUrl(url)">Unblock</button>\n            </li>\n        </ul>\n    </div>\n    <div class="footer">\n        <button class="save-button branded-bg" ng-click="blockedUrlsCtrl.saveList()">Save list</button>\n    </div>\n</div>'),a.put("/templates/spot/popular-links/layout.html",'<div class="popular-links-view" tooltip-size-boundary scrolled-element\n     ui-event="{ scroll: \'onScroll()\', \'on-scrolled-bottom\': \'fetchNextOnScrool()\' }">\n\n    <div class="header">\n        <div class="title"><span locale-string="spotlight.popular_links.popular_on">Popular on</span> <span ng-bind="spot.name"></span></div>\n        <div class="subtitle">\n            Updated <span ng-bind="collection.lastUpdate | prettyDate"></span> ago\n        </div>\n    </div>\n    <ul class="list">\n        <li ng-repeat="link in collection.links" class="item">\n            <popular-link link="link" index="$index + 1" spot="spot" on-block-click="openBlockedlinks(link.url)"></popular-link>\n        </li>\n    </ul>\n\n    <button class="arrow" ng-hide="hideArrow" ng-click="onArrowClick()"></button>\n</div>'),a.put("/templates/spot/popular-links/link.html",'<div class="popular-link-view">\n    <section class="rate-block">\n        #<span class="index" ng-bind="index"></span>\n        <button class="block-button branded-text" ng-if="isHost" ng-click="onBlockClick(link.url)">Block</button>\n    </section>\n    <section class="follow-up-block" ng-if="link.hasFirstFollowUp()">\n        <div class="user-image" user-href="firstFollowUpUser"\n            ng-style="{ backgroundImage: \'url(\' + firstFollowUpUser.getUserImageUrl({ height: 30, width: 30 }) + \')\' }">\n        </div>\n        <span class="text" ng-bind="firstFollowUpText"></span>\n    </section>\n    <section>\n        <a class="preview-block" ng-href="{{ link.url }}" target="_blank" utm-href on-click-analytics="Popular Link Clicked">\n            <div class="preview-image" ng-style="{ backgroundImage: \'url(\' + imageUrl + \')\' }"></div>\n            <div class="preview-info" auto-direction="title + description">\n                <div class="title branded-text" ng-bind="title"></div>\n                <div class="description" ng-bind="description"></div>\n            </div>\n        </a>\n    </section>\n    <section class="users-block" ng-if="link.hasFollowers() || link.hasLikers()">\n        <section class="talkers" ng-if="link.hasFollowers()">\n            <div class="title"><span ng-bind="link.followersIds.length"></span> Talking about this</div>\n            <div class="faces"></div>\n        </section>\n        <section class="likers" ng-if="link.hasLikers()">\n            <div class="title"><span ng-bind="link.likersIds.length"></span> Likes</div>\n            <div class="faces"></div>\n        </section>\n    </section>\n    <section class="add-follow-up-block">\n        <div class="wrapper" ng-class="{ flip: flip }">\n            <div class="action" tooltip-container>\n                <div class="title" locale-string="spotlight.popular_links.what_do_you_think">What do you think?</div>\n                <div class="buttons">\n                    <button class="button branded-bg-hover branded-bg-active funny"\n                        signup-tooltip="Please sign in to send a message"\n                        signup-translate="embed.signin_tooltip.send_a_message"\n                        signup-action="onFollowUpClick(\'spotlight.popular_links.so_funny\')">\n                        <span class="label" locale-string="spotlight.popular_links.funny">FUNNY</span>\n                    </button>\n                    <button class="button branded-bg-hover branded-bg-active amazing"\n                        signup-tooltip="Please sign in to send a message"\n                        signup-translate="embed.signin_tooltip.send_a_message"\n                        signup-action="onFollowUpClick(\'spotlight.popular_links.thats_amazing\')">\n                        <span class="label" locale-string="spotlight.popular_links.amazing">AMAZING</span>\n                    </button>\n                    <button class="button branded-bg-hover branded-bg-active shocking"\n                        signup-tooltip="Please sign in to send a message"\n                        signup-translate="embed.signin_tooltip.send_a_message"\n                        signup-action="onFollowUpClick(\'spotlight.popular_links.so_weird\')">\n                        <span class="label" locale-string="spotlight.popular_links.shocking">SHOCKING</span>\n                    </button>\n                    <button class="button branded-bg-hover branded-bg-active cute"\n                        signup-tooltip="Please sign in to send a message"\n                        signup-translate="embed.signin_tooltip.send_a_message"\n                        signup-action="onFollowUpClick(\'spotlight.popular_links.so_cute\')">\n                        <span class="label" locale-string="spotlight.popular_links.cute">CUTE</span>\n                    </button>\n                    <button class="button branded-bg-hover branded-bg-active tragic"\n                        signup-tooltip="Please sign in to send a message"\n                        signup-translate="embed.signin_tooltip.send_a_message"\n                        signup-action="onFollowUpClick(\'spotlight.popular_links.this_is_tragic\')">\n                        <span class="label" locale-string="spotlight.popular_links.tragic">TRAGIC</span>\n                    </button>\n                </div>\n                <div class="follow-up-box">\n                    <textarea class="textarea" msd-elastic ng-model="followUpText" placeholder="Type your comment..."\n                        locale-string="spotlight.popular_links.type_your_comment" locale-attr="placeholder"\n                        signup-tooltip="Please sign in to send a message"\n                        signup-translate="embed.signin_tooltip.send_a_message"\n                        signup-trigger="enter" signup-action="sendFollowUp()">\n                    </textarea>\n                    <button class="like-button branded-icons" ng-class="{ \'branded-icons-active\': likedByMe }"\n                        signup-tooltip="Please sign in to like this item"\n                        signup-translate="embed.signin_tooltip.like_this_item"\n                        signup-action="likePopularLink()">\n                    </button>\n                </div>\n            </div>\n            <div class="status">\n                <div class="user-image" ng-style="{ backgroundImage: \'url(\' + currentUser.getUserImageUrl({ height: 30, width: 30 }) + \')\' }"></div>\n                <span class="message">\n                    <span locale-string="spotlight.popular_links.your_message_was_sent">Your message was sent!</span>\n                    <a class="message-button branded-text" ui-sref="app.public_spot.chat" locale-string="spotlight.popular_links.view_your_message">View your message</a>\n                </span>\n            </div>\n        </div>\n    </section>\n</div>'),a.put("/templates/spot/popular-links/main.html",'<popular-links spot="spotCtrl.spot" popular-links-collection="spotCtrl.popularLinksCollection"></popular-links>'),a.put("/templates/spot/post-message.html",'<div class="post-message-view" ng-class="{ \'preview-visible\': preview.hasPreview() }" ng-controller="PostMessageController">\n    <div ng-if="!spotCtrl.spot.isCurrentKicked()">\n        <div class="talk-input-wrapper" ng-class="{ pinned: isMessagePinned }">\n\n            <textarea  ng-model="newMessage.text" ng-trim="false" class="talk-input"\n                       mentions-input="mentionsInput"\n                       ui-event="{ \'paste\': \'messagePaste($event)\' }"\n                       on-keyup="messageKeyPress($event)"\n                       signup-tooltip="Please sign in to send a message"\n                       signup-trigger="enter" signup-action="postMessage()"\n                       locale-string="spot.post_message.type_your_message" locale-attr="placeholder"\n                       placeholder="Type in your message..."></textarea>\n\n            <div class="preview" ng-if="preview.hasPreview()">\n                <button class="close" ng-click="preview.remove(true)"></button>\n\n                <div class="thumbnail-container" ng-if="preview.entity.title && preview.entity.getImageUrl()">\n                    <div ng-style="{ backgroundImage: \'url(\' + preview.entity.getImageUrl({ width: 90, height: 90, crop: \'fit\' }) + \')\' }"\n                         class="thumbnail"></div>\n                </div>\n\n                <div class="bold title" ng-if="preview.entity.title"><span ng-bind="preview.entity.title" target="_blank"></span></div>\n                <div class="description" ng-if="preview.entity.description"><span ng-bind="preview.entity.description" target="_blank"></span></div>\n\n                <div ng-if="preview.entity.getImageUrl() && !preview.entity.title"\n                     ng-style="{ backgroundImage: \'url(\' + preview.entity.getImageUrl({ width: 500, height: 90, crop: \'fit\' }) + \')\' }"\n                     class="thumbnail-only"></div>\n            </div>\n        </div>\n\n        <div class="buttons">\n            <div ng-if="session.isRegistered">\n                <div class="pin branded-text-hover branded-icons-parent-hover"\n                     ng-click="togglePinMessage()"\n                     ng-class="{ pinned: isMessagePinned }"\n                     ng-if="spotCtrl.spot.isHostedByMe()">\n                    <span class="pin-image branded-icons-child"></span><span locale-string="spot.post_message.pin_up">Pin Up</span>\n                </div>\n\n                <button class="add-image ladda-button zoom-out branded-text-hover branded-icons-parent-hover"\n                        ng-class="{ \'ladda-loading\': isUploadingImage, disabled : isUploadingImage || preview.hasPreview() }"\n                        ng-disabled="isUploadingImage || preview.hasPreview()">\n                    <span class="image-icon branded-icons-child"></span><span locale-string="spot.post_message.add_image">Add Image</span>\n                </button>\n                <div file-input="data.imageFile" on-change="openImageEditor()" trigger-button=".add-image"></div>\n            </div>\n\n            <div class="login-buttons" ng-if="!session.isRegistered">\n                <span locale-string="gui.login.connect_with">Connect with</span>\n                <button class="connect-button facebook" ng-click="loginWith(\'facebook\')"></button>\n                <button class="connect-button twitter" ng-click="loginWith(\'twitter\')"></button>\n                <button class="connect-button google-plus" ng-click="loginWith(\'google+\')"></button>\n                <button class="connect-button linkedin" ng-click="loginWith(\'linkedin\')"></button>\n            </div>\n\n            <span class="embedly-spinner" ng-if="isUploadingImage || isResolvingEmbed"></span>\n\n            <button class="send branded-bg" locale-string="spot.post_message.send"\n                    signup-tooltip="Please sign in to send a message"\n                    signup-translate="embed.signin_tooltip.send_a_message"\n                    signup-action="postMessage()"\n                    ng-class="{ disabled: isResolvingEmbed || isUploadingImage || isMessageEmpty() }"\n                    ng-disabled="isResolvingEmbed || isUploadingImage || isMessageEmpty()">Send</button>\n        </div>\n    </div>\n\n    <div ng-if="spotCtrl.spot.isCurrentKicked()">\n        <div class="kicked">Sorry (not really), but you are kicked from this spot!</div>\n    </div>\n</div>'),a.put("/templates/spot/single-message.html",'<div class="single-message-view" ng-controller="MessageController" bindonce\n     ng-class="{ deleted: message.deleted_by }">\n\n    <a ng-click="spotActions.goToUserProfile(message.username)" class="sender-image anchor"\n       bo-style="{ backgroundImage: \'url(\' + message.getSenderImageUrl({ width: 37, height: 37, crop: \'fill\' }) + \')\'}"\n        profile-hover="message.sender_id">\n    </a>\n    <div class="green-dot" ng-class="{ online : spotCtrl.onlineMembers.isOnline(message.sender_id) }"></div>\n\n    <div class="sender" ng-class="{ owner: spotCtrl.spot.isHost(message.sender_id) }">\n        <span class="host" ng-if="spotCtrl.spot.isHost(message.sender_id)"></span>\n        <span ng-click="spotActions.goToUserProfile(message.username)"\n              class="name"\n              ng-bind="message.display_name"\n              profile-hover="message.sender_id"></span>\n        <a ng-click="spotActions.goToUserProfile(message.username)"\n           class="username branded-text-hover" \n           ng-bind="message.username | prepend:\'@\' "\n           profile-hover="message.sender_id">\n       </a>\n        <div class="context-menu branded-icons-parent-hover" ng-if="session.isRegistered" tooltip="\'/templates/spot/message-context-menu.html\'">\n            <div class="menu-arrow branded-icons-child"></div>\n        </div>\n    </div>\n\n    <div class="body">\n        <div class="text" link-entities data-text="message.text |escape" data-entities="entities" href-click="goToEntity"\n             auto-direction="message.text |escape"></div>\n\n        <div ng-repeat="entity in message.entities">\n            <div bo-switch="entity.type">\n                <div bo-switch-when="photo">\n                    <img bo-src="entity.getImageUrl({ width: 200, height: 200, crop: \'fit\' })"\n                         class="photo" ng-click="openModal()">\n                </div>\n\n                <div bo-switch-when="audio" ng-click="openModal()">\n                    <audio controls>\n                        <source bo-src="entity.getAudioFileUrl()" />\n                    </audio>\n                </div>\n\n                <div bo-switch-when="location" class="preview">\n                    <a ng-click="openModal()">\n                        <div class="thumbnail-container">\n                            <img ng-src="{{ entity.getLocationImageUrl({ width: 160, height: 110 }) }}" class="thumbnail">\n                        </div>\n                    </a>\n\n                    <div class="bold title">\n                        <a bo-href="entity.getLocationProviderUrl()" bo-bind="entity.name" target="_blank"></a>\n                    </div>\n\n                    <div class="description" bo-bind="entity.getLocationFullAddress()"></div>\n                </div>\n\n                <div bo-switch-when="embed" class="preview">\n                    <div class="expanded" ng-if="entity.expanded"\n                         bo-html="entity.html | previewIFrame:{ width: 280, scaleHeight: true, autoPlay: true }">\n                    </div>\n\n                    <div class="thumbnail-container" ng-hide="entity.expanded || !entity.getImageUrl()">\n                        <a class="thumbnail-link" ng-click="expandPreview(entity)">\n                            <img bo-src="entity.getImageUrl()" class="thumbnail">\n\n                            <div class="play" bo-if="entity.is_playable"></div>\n                        </a>\n                    </div>\n                    <div class="bold title branded-text">\n                        <a ng-href="{{entity.url}}" class="branded-text" ng-bind="entity.title" target="_blank"></a>\n                    </div>\n\n                    <div class="description">\n                        <a bo-href="entity.url" bo-bind="entity.description" target="_blank"></a>\n                    </div>\n\n                    <div class="provider" bo-if="entity.title">\n                        via <a bo-href="entity.provider_url"\n                               bo-bind="entity.provider_name"\n                               target="_blank"></a>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <ul class="actions" ng-if="!message.deleted_by">\n        <li class="icon like clickable branded-icons branded-text"\n            ng-class="{ \'branded-icons-active\' : message.likes > 0,\n                        liked: message.likes > 0, pulse: pulseLikes, clickable: spotCtrl.spot.isJoined() }"\n            ng-click="spotActions.toggleLikeMessage(message)">\n            <span ng-bind="\'(\' + message.likes + \')\'" ng-if="message.likes > 0"></span>\n        </li>\n        <li class="icon reply clickable branded-icons branded-text-hover" ng-click="spotCtrl.replyMessage(message)" ng-if="!isIntimate">Reply</li>\n        <li class="timestamp" ng-bind="message.timestamp | prettyDate"></li>\n    </ul>\n</div>'),a.put("/templates/spot/spot-header.html",'<div class="spot-header" ng-if="spotCtrl.spot.isJoined() || spotCtrl.isIntimate">\n    <!-- Intimate Spot -->\n    <div ng-if="spotCtrl.isIntimate" class="spot-link-wrapper">\n        <a class="spot-icon" ng-class="{ online: spotCtrl.isOtherPartyOnline() }" user-href="spotCtrl.spot.other_party"\n             spot-thumbnail="spotCtrl.spot" options="{ width: 30, height: 30, spotIcon: spotIcon }">\n        </a>\n        <a class="spot-definition" user-href="spotCtrl.spot.other_party">\n            <div class="spot-name" auto-direction="spotName" ng-bind="spotName"></div>\n            <div class="title-icon title-below intimate" data-title="{{spotCtrl.spot.getSpotTypeLabel()}}Spot"></div>\n        </a>\n    </div>\n\n    <!-- Public Spot -->\n    <div ng-if="!spotCtrl.isIntimate" class="spot-link-wrapper">\n        <a class="spot-icon" spot-href="spotCtrl.spot"\n             spot-thumbnail="spotCtrl.spot" options="{ width: 30, height: 30, spotIcon: spotIcon }">\n        </a>\n        <a class="spot-definition" spot-href="spotCtrl.spot">\n            <div class="spot-name" auto-direction="spotName" ng-bind="spotName"></div>\n            <div class="title-icon title-below public" data-title="{{spotCtrl.spot.getSpotTypeLabel()}}Spot"></div>\n        </a>\n    </div>\n\n    <button ng-if="spotCtrl.spot.isJoined()" class="join-button joined branded-bg-hover branded-border-hover" ng-click="spotCtrl.partSpot()">\n        <span class="joined-text">Joined</span>\n        <span class="leave-text">Leave</span>\n    </button>\n    <button ng-if="!spotCtrl.spot.isJoined()" class="join-button branded-bg"\n            signup-tooltip="Please sign in to join the Spot"\n            signup-translate="embed.signin_tooltip.join_the_spot"\n            signup-action="spotCtrl.spot.joinSpot()">\n        <span class="join-text">Join</span>\n    </button>\n</div>\n\n<div ng-if="!spotCtrl.spot.isJoined() && !spotCtrl.isIntimate" class="spot-intro" ng-style="{ backgroundImage: \'url(\' + spotCtrl.getBlurrySpotIconUrl(125, 500) + \')\'}" tooltip-container>\n    <div class="head-image-wrapper">\n        <div class="head-image" ng-style="{ backgroundImage: \'url(\' + spotCtrl.spot.getSpotIconUrl({width: 102, height: 102}) + \')\'}"></div>\n    </div>\n\n    <div class="attributes">\n        <div class="names row">\n            <span class="display-name" auto-direction="spotName" ng-bind="spotName"></span>\n            <span class="title-icon title-below public" data-title="{{spotCtrl.spot.getSpotTypeLabel()}}Spot"></span>\n        </div>\n        <div class="spot-info row">\n            <div class="hide-on-hover">\n                <span class="category" ng-bind="spotCtrl.spotCategory.text | append: \' Community\'"></span>\n                <span class="live-since" ng-bind="spotCtrl.spot.created_at | fromUnixTimestamp | date: \'mediumDate\' | prepend: \'Live since \'"></span>\n            </div>\n            <div class="show-on-hover">\n                <span class="hosted-by">Hosted By</span>\n                <ul class="hosts">\n                    <li class="host" ng-repeat="host in spotCtrl.spotHosts | orderBy: \'-last_activity_at\' | limitTo: 5" ng-style="{ backgroundImage: \'url(\' + host.getUserImageUrl({width: 25, height: 25, crop: \'fill\'}) + \')\' }" user-href="host" profile-hover="host.id"></li>\n                    <li class="host"></li>\n                </ul>\n            </div>\n        </div>\n        <div class="actions row">\n            <button class="join-button branded-bg"\n                    signup-tooltip="Please sign in to join the Spot"\n                    signup-translate="embed.signin_tooltip.join_the_spot"\n                    signup-action="spotCtrl.spot.joinSpot()">\n                <span class="join-text">Join</span>\n            </button>\n        </div>\n    </div>\n</div>'),a.put("/templates/spot/spot-media.html",'<div class="spot-media-view" ng-controller="SpotMediaController" scrolled-element\n     ui-event="{ \'on-scrolled-bottom\': \'fetchNextMessages()\' }">\n	<ul class="media-list">\n		<li class="media-item" ng-repeat="message in messages">\n			<message-preview message="message" width="230" height="195" show-info="true"\n                             index="$index" hide-backdrop="true" message-click="spotActions.openMessageModal(message)">\n            </message-preview>\n        </li>\n	</ul>\n</div>'),a.put("/templates/spot/spot-members.html",'<div class="spot-members-view" ng-controller="SpotMembersController"\n     scrolled-element ui-event="{ \'on-scrolled-bottom\': spotCtrl.fetchNextMembers }" bindonce>\n\n	<div class="members-section">\n        <div class="header">\n            <div class="title">\n                Hosts <span class="count branded-text" ng-bind="\'(\' + hosts.length + \')\'"></span>\n            </div>\n        </div>\n        <ul class="members-container">\n            <li ng-repeat="host in hosts | orderBy:\'isOnline\':true"\n            	ng-click="spotActions.goToUserProfile(host.username)"\n            	class="member-item">\n            	<div bo-style="{ backgroundImage: \'url(\' + host.getUserImageUrl({width: 100, height: 100, crop: \'fill\'}) + \')\' }"\n                 	 class="member-image" profile-hover="host.id"\n                 	 ng-class="{ online: isOnline(host) }"> </div>\n                <div class="member-name" ng-bind="host.display_name" profile-hover="host.id"></div>\n            </li>\n        </ul>\n    </div>\n\n    <div class="members-section">\n        <div class="header">\n            <div class="title">\n                Members <span class="count branded-text" ng-bind="\'(\' + (spotCtrl.spot.members_count - hosts.length) + \')\'"></span>\n            </div>\n        </div>\n    	<ul class="members-container">\n    		<li ng-repeat="member in members | remove_hosts:spotCtrl.spot | orderBy:\'isOnline\':true"\n                ng-click="spotActions.goToUserProfile(member.username)"\n    			class="member-item">\n				<div ng-style="{ backgroundImage: \'url(\' + member.getUserImageUrl({width: 100, height: 100, crop: \'fill\'}) + \')\' }"\n                    class="member-image" profile-hover="member.id"\n					 ng-class="{online: isOnline(member)}"></div>\n				<div class="member-name" style="-webkit-backface-visibility: hidden;"\n                     ng-bind="member.display_name" profile-hover="member.id"></div>\n    		</li>\n    	</ul>\n    </div>\n</div>'),a.put("/templates/spot/spot-menu/layout.html",'<div class="spot-menu-view">\n    <div class="switch">\n        <a class="switch-button" ui-sref="app.public_spot.chat" ui-sref-active="branded-bg" on-click-analytics="Embed Tab Clicked" analytics-parmeters="[\'talk\']">\n            <span locale-string="navigation.talk">Talk</span>\n            <span ng-if="showNewMessages && newMessagesCount > 0" ng-bind="\'(\' + newMessagesCount + \')\'"></span>\n        </button>\n        <a class="switch-button" ng-if="showPopularLinks" ui-sref="app.public_spot.popular" ui-sref-active="branded-bg" on-click-analytics="Embed Tab Clicked" analytics-parmeters="[\'popular\']">\n            <span locale-string="navigation.popular">Popular</span>\n        </a>\n        <a class="switch-button" ui-sref="app.public_spot.spot_media" ui-sref-active="branded-bg" on-click-analytics="Embed Tab Clicked" analytics-parmeters="[\'gallery\']">\n            <span locale-string="navigation.gallery">Gallery</span>\n        </a>\n        <a class="switch-button" ui-sref="app.public_spot.spot_members" ui-sref-active="branded-bg" on-click-analytics="Embed Tab Clicked" analytics-parmeters="[\'community\']">\n            <span locale-string="navigation.community">Community</span>\n        </a>\n    </div>\n</div>'),a.put("/templates/spot/typing-message.html",'<div class="typing-message-view" ng-controller="MessageTypingController">\n    <div class="sender-image"\n        ng-repeat="userImage in [ userImage ]"\n        ng-style="{ backgroundImage: \'url(\' + userImage + \')\'}" />\n    </a>\n    <div class="body branded-text">\n        <div class="text" ng-bind="currentTypers"></div>\n        <div class="is-typing" ng-bind="typingMessage"></div>\n        <div class="three-dots"> ...</div>\n    </div>\n</div>'),a.put("/templates/user-profile/about.html",'<div class="about-view">\n\n    <section class="info-section" ng-if="userProfileCtrl.hasBasicInformation()">\n        <fieldset>\n            <legend class="title">Basic Information</legend>\n            <div class="field" ng-if="userProfileCtrl.user.about">\n                <label class="label">About</label>\n                <span class="value" ng-bind="userProfileCtrl.user.about"></span>\n            </div>\n            <div class="field" ng-if="userProfileCtrl.user.getLanguage()">\n                <label class="label">Language</label>\n                <span class="value" ng-bind ="userProfileCtrl.user.getLanguage()"></span>\n            </div>\n            <div class="field" ng-if="userProfileCtrl.user.getCountry()">\n                <label class="label">Country</label>\n                <span class="value" ng-bind="userProfileCtrl.user.getCountry()"></span>\n            </div>\n            <div class="field gender" ng-if="userProfileCtrl.user.gender">\n                <label class="label">Gender</label>\n                <span class="value" ng-bind="userProfileCtrl.user.gender"></span>\n            </div>\n            <div class="field" ng-if="userProfileCtrl.user.age">\n                <label class="label">Age</label>\n                <span class="value" ng-bind="userProfileCtrl.user.age"></span>\n            </div>\n        </fieldset>\n    </section>\n\n    <section class="spots-section">\n        <div class="title"><span ng-bind="userProfileCtrl.user.display_name"></span>\'s Spots</div>\n\n        <user-profile-spots-list list="userProfileCtrl.memberSpots" name="\'Active\'"></user-profile-spots-list>\n\n        <user-profile-spots-list list="userProfileCtrl.mutualSpots" name="\'Shared with you\'"></user-profile-spots-list>\n\n        <user-profile-spots-list list="userProfileCtrl.hostSpots" name="\'Hosted\'"></user-profile-spots-list>\n\n    </section>\n\n</div>'),a.put("/templates/user-profile/edit/about.html",'<div class="about-view">\n\n    <section class="info-section-edit">\n\n        <fieldset>\n            <legend class="title">Personal Information</legend>\n            <div class="field">\n                <label for="first-name" class="label">First Name</label>\n                <span class="value">\n                    <input id="first-name" type="text" maxlength="15" ng-model="userProfileEditCtrl.editUserData.display_name" ng-change="userProfileEditCtrl.updateField(\'display_name\', userProfileEditCtrl.editUserData.display_name)">\n                </span>\n                <span class="validation" ng-class="{\'loading\': userProfileEditCtrl.flags.display_name.loading}"></span>\n            </div>\n            <div class="field" ng-class="{error: userProfileEditCtrl.flags.username.error, approved: userProfileEditCtrl.flags.username.approved}">\n                <label for="username" class="label">Username</label>\n                <span class="value username">\n                    <input id="username" type="text" maxlength="15" ng-change="userProfileEditCtrl.updateField(\'username\', userProfileEditCtrl.editUserData.username)" ng-model="userProfileEditCtrl.editUserData.username">\n                </span>\n                <span class="validation title-above" ng-class="{loading: userProfileEditCtrl.flags.username.loading}" data-title="{{userProfileEditCtrl.flags.username.tooltip}}"></span>\n            </div>\n        </fieldset>\n\n        <fieldset>\n            <legend class="title">Basic Information</legend>\n            <div class="field">\n                <label for="about" class="label">About</label>\n                <span class="value long">\n                    <input id="about" type="text" maxlength="30" ng-model="userProfileEditCtrl.editUserData.about" ng-change="userProfileEditCtrl.updateField(\'about\', userProfileEditCtrl.editUserData.about)">\n                </span>\n                <span class="validation" ng-class="{\'loading\': userProfileEditCtrl.flags.about.loading}"></span>\n            </div>\n            <div class="field">\n                <label class="label">Language</label>\n                <span class="value long select">\n                    <select ng-model="userProfileEditCtrl.editUserData.language" ng-options="language as language.name  for language in userProfileEditCtrl.languages" ng-change="userProfileEditCtrl.updateField(\'locale\', userProfileEditCtrl.editUserData.language.id)">\n                        <option value="">None</option>\n                    </select>\n                    <em class="selected" ng-bind="userProfileEditCtrl.editUserData.language.name || \'None\'"></em>\n                </span>\n                <span class="validation" ng-class="{\'loading-select\': userProfileEditCtrl.flags.locale.loading}"></span>\n            </div>\n            <div class="field">\n                <label class="label">Country</label>\n                <span class="value long select">\n                    <select ng-model="userProfileEditCtrl.editUserData.country" ng-options="country as country.name  for country in userProfileEditCtrl.countries" ng-change="userProfileEditCtrl.updateField(\'country\', userProfileEditCtrl.editUserData.country.id)">\n                        <option value="">None</option>\n                    </select>\n                    <em class="selected" ng-bind="userProfileEditCtrl.editUserData.country.name || \'None\'"></em>\n                </span>\n                <span class="validation" ng-class="{\'loading-select\': userProfileEditCtrl.flags.country.loading}"></span>\n            </div>\n            <div class="field birthday" ng-class="{error: userProfileEditCtrl.flags.birthday.error, approved: userProfileEditCtrl.flags.birthday.approved}">\n                <label class="label">Birthday</label>\n                <span class="value select day">\n                    <select ng-model="userProfileEditCtrl.editUserData.birthday.day" ng-options="day for day in userProfileEditCtrl.mapDays" ng-change="userProfileEditCtrl.updateField(\'birthday\', userProfileEditCtrl.editUserData.birthday)">\n                        <option value="">Day</option>\n                    </select>\n                    <em class="selected" ng-bind="userProfileEditCtrl.editUserData.birthday.day && userProfileEditCtrl.editUserData.birthday.day != \'00\' ? userProfileEditCtrl.editUserData.birthday.day : \'Day\'"></em>\n                </span>\n                <span class="value select month">\n                    <select ng-model="userProfileEditCtrl.editUserData.birthday.month" ng-options="number as name for (number,name) in userProfileEditCtrl.mapMonths" ng-change="userProfileEditCtrl.updateField(\'birthday\', userProfileEditCtrl.editUserData.birthday)">\n                        <option value="">Month</option>\n                    </select>\n                    <em class="selected" ng-bind="userProfileEditCtrl.mapMonths[userProfileEditCtrl.editUserData.birthday.month] || \'Month\'"></em>\n                </span>\n                <span class="value select year">\n                    <select ng-model="userProfileEditCtrl.editUserData.birthday.year" ng-options="year for year in userProfileEditCtrl.mapYears" ng-change="userProfileEditCtrl.updateField(\'birthday\', userProfileEditCtrl.editUserData.birthday)">\n                        <option value="">Year</option>\n                    </select>\n                    <em class="selected" ng-bind="userProfileEditCtrl.editUserData.birthday.year && userProfileEditCtrl.editUserData.birthday.year != \'0000\' ? userProfileEditCtrl.editUserData.birthday.year : \'Year\'"></em>\n                </span>\n                <span class="validation title-above" ng-class="{\'loading\': userProfileEditCtrl.flags.birthday.loading}" data-title="{{userProfileEditCtrl.flags.birthday.tooltip}}"></span>\n            </div>\n            <div class="field gender">\n                <label for="genderMale" class="label">Gender</label>\n                <label class="value radio">\n                    <input type="radio" ng-model="userProfileEditCtrl.editUserData.gender" value="male" id="genderMale" ng-change="userProfileEditCtrl.updateField(\'gender\', userProfileEditCtrl.editUserData.gender)"> Male\n                </label>\n                <label class="value radio">\n                    <input type="radio" ng-model="userProfileEditCtrl.editUserData.gender" value="female" ng-change="userProfileEditCtrl.updateField(\'gender\', userProfileEditCtrl.editUserData.gender)"> Female\n                </label>\n                <span class="validation" ng-class="{\'loading\': userProfileEditCtrl.flags.gender.loading}"></span>\n            </div>\n        </fieldset>\n\n        <fieldset>\n            <legend class="title">Settings</legend>\n            <div class="field muted">\n                <label for="soundOn" class="label">Play Sound</label>\n                <label class="value radio">\n                    <input type="radio" ng-model="userProfileEditCtrl.editUserData.muted" value="false" id="soundOn" ng-change="userProfileEditCtrl.updateField(\'muted\', userProfileEditCtrl.editUserData.muted)"> On\n                </label>\n                <label class="value radio">\n                    <input type="radio" ng-model="userProfileEditCtrl.editUserData.muted" value="true" ng-change="userProfileEditCtrl.updateField(\'muted\', userProfileEditCtrl.editUserData.muted)"> Off\n                </label>\n                <span class="validation" ng-class="{\'loading\': userProfileEditCtrl.flags.muted.loading}"></span>\n            </div>\n        </fieldset>\n\n    </section>\n\n</div>'),a.put("/templates/user-profile/edit/intro.html",'<div class="intro-view edit" ng-style="{ backgroundImage: \'url(\' + userProfileEditCtrl.getBlurryProfileImageUrl(125, 500) + \')\'}">\n    <div class="head-image-wrapper" ng-class="{uploading: userProfileEditCtrl.flags.isUploadingImage}">\n        <button class="head-image" ng-style="{ backgroundImage: \'url(\' + userProfileEditCtrl.getProfileImageUrl(102, 102) + \')\'}"></button>\n        <div file-input="userProfileEditCtrl.userImageFile" on-change="userProfileEditCtrl.uploadProfileImage()" trigger-button=".head-image"></div>\n    </div>\n    <div class="attributes">\n        <div class="actions row">\n            <div class="intimate-spot-actions">\n                <a class="done-button with-text branded-bg" ng-click="done()">Done</a>\n                <!-- <a class="logout-link with-text branded-text no-bg" ng-click="userProfileEditCtrl.logout()">Logout</a> -->\n            </div>\n        </div>\n    </div>\n</div>'),a.put("/templates/user-profile/edit/layout.html",'<div class="user-profile-view" ng-if="userProfileEditCtrl.isReady()">\n    <ng-include src="\'/templates/user-profile/edit/intro.html\'"></ng-include>\n    <ng-include src="\'/templates/user-profile/edit/about.html\'"></ng-include>\n</div>'),a.put("/templates/user-profile/intro.html",'<div class="intro-view" ng-style="{ backgroundImage: \'url(\' + userProfileCtrl.getBlurryProfileImageUrl(125, 500) + \')\'}">\n    <div class="head-image-wrapper" ng-class="{ online: userProfileCtrl.user.is_online }">\n        <div class="head-image" ng-style="{ backgroundImage: \'url(\' + userProfileCtrl.getProfileImageUrl(102, 102) + \')\'}"></div>\n    </div>\n    <div class="attributes">\n        <div class="names row">\n            <span class="display-name" ng-bind="userProfileCtrl.user.display_name"></span>\n            <span class="unique-name" ng-bind="userProfileCtrl.user.username | prepend:\'@\'"></span>\n            <button ng-if="!userProfileCtrl.user.isMe()"class="user-menu right-menu" actions-menu="userMenu"></button>\n        </div>\n\n        <div class="counters row">\n            <div class="messages-count-num" ng-bind="userProfileCtrl.user.total_sent_messages | thousands"></div>\n            <div class="messages-count-label">Messages Sent</div>\n            <div class="likes-count-num" ng-bind="userProfileCtrl.user.total_likes | thousands"></div>\n            <div class="likes-count-label">Likes Recieved</div>\n        </div>\n\n        <div class="actions row" sticky-header-static>\n            <div class="navigation" navigation-menu="navigationMenu"></div>\n            <div class="intimate-spot-actions" ng-switch on="userProfileCtrl.user.relation_status">\n                <button class="invite-button with-text branded-bg" ng-switch-when="none"\n                    signup-tooltip="Please sign in to talk privately"\n                    signup-translate="embed.signin_tooltip.talk_privately"\n                    signup-action="userProfileCtrl.inviteIntimateSpot()">\n                    <span class="text">Invite to DirectSpot</span>\n                </button>\n\n                <div class="invitation-sent with-text" ng-switch-when="invitation_sent">Invitation Sent</div>\n\n                <div class="invitation-received" ng-switch-when="invitation_received">\n                    <div class="action-text">Accept Invitation?</div>\n                    <button class="accept-button branded-bg" ng-click="userProfileCtrl.acceptIntimateSpot(true)"></button>\n                    <button class="decline-button" ng-click="userProfileCtrl.user.declineIntimate()"></button>\n                </div>\n\n                <div ng-switch-when="intimate">\n                    <a class="go-to-intimate-button with-text" intimate-href="userProfileCtrl.user">\n                        <span class="text">Send Message</span>\n                    </a>\n                </div>\n\n                <div ng-switch-when="me">\n                    <a ui-sref="app.user_profile_edit" class="go-to-edit-profile-button with-text branded-bg" ng-click="userProfileCtrl.onEditClick()">\n                        <span class="text">Edit Profile</span>\n                    </a>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>'),a.put("/templates/user-profile/layout.html",'<div class="user-profile-view" sticky-header-class="sticky-visible" ng-if="userProfileCtrl.isReady()" scrolled-element>\n    <div ng-include="\'/templates/user-profile/sticky-header.html\'"></div>\n    <ng-include src="\'/templates/user-profile/intro.html\'"></ng-include>\n    <div ui-view></div>\n</div>\n'),a.put("/templates/user-profile/media.html",'<ul class="media-view" on-scrolled-bottom="userProfileCtrl.fetchNextMedia()">\n    <li ng-repeat="message in userProfileCtrl.userMedia" class="media-item">\n        <message-preview message="message" width="230" height="195" show-info="true"\n                         index="$index" hide-backdrop="true" message-click="openMessageModal(message)">\n        </message-preview>\n    </li>\n</ul>'),a.put("/templates/user-profile/spots-list.html",'<section ng-if="list.length > 0">\n    <div class="subtitle">\n        <span ng-bind="name"></span>\n        <span class="count" ng-bind="list.length"></span>\n    </div>\n    <div>\n        <div class="spot-item" ng-repeat="spot in visibleList">\n            <a class="icon" ng-class="{ host: spot.isHostedByMe() }" spot-href="spot" spot-thumbnail="spot" options="{ width: 40, height: 40, crop: \'fill\' }"></a>\n            <div class="info">\n                <a class="spot-name" ng-bind="spot.name" spot-href="spot"></a>\n                <div class="users-count">\n                    <span class="online-count"><span ng-bind="spot.online_members_count"></span> Online</span>\n                    <span class="members-count"><span ng-bind="spot.members_count"></span> Members</span>\n                </div>\n            </div>\n            <div class="users">\n                <div class="user-icon" ng-repeat="user in spot.members | first:3"\n                     ng-style="{ backgroundImage: \'url(\' + user.getUserImageUrl({ width: 27, height: 27, crop: \'fill\' }) + \')\' }">\n                     <a class="anchor" user-href="user" profile-hover="user.id"></a>\n                </div>\n            </div>\n        </div>\n        <div class="spot-item" ng-if="list.length > visibleList.length">\n            <button class="show-more-button branded-text branded-border-top-after" ng-click="showMore()">View More</button>\n        </div>\n    </div>\n</section>\n\n\n\n'),a.put("/templates/user-profile/sticky-header.html",'<div class="sticky-header-view">\n    <div class="user-image" ng-class="{ online: userProfileCtrl.user.is_online }" ng-style="{ backgroundImage: \'url(\' + userProfileCtrl.getProfileImageUrl(32, 32) + \')\'}"></div>\n\n    <div class="names">\n        <span class="display-name" ng-bind="userProfileCtrl.user.display_name"></span>\n        <span class="unique-name" ng-bind="userProfileCtrl.user.username | prepend:\'@\'"></span>\n    </div>\n\n    <div class="navigation" navigation-menu="navigationMenu"></div>\n\n    <div class="intimate-spot-actions thin" ng-switch on="userProfileCtrl.user.relation_status">\n        <button class="invite-button with-text branded-bg" ng-click="userProfileCtrl.inviteIntimateSpot()" ng-switch-when="none">\n            <span class="text">Invite</span>\n        </button>\n\n        <div class="invitation-sent" ng-switch-when="invitation_sent">Sent</div>\n\n        <div class="invitation-received" ng-switch-when="invitation_received">\n            <button class="accept-button branded-bg" ng-click="userProfileCtrl.acceptIntimateSpot(true)"></button>\n            <button class="decline-button" ng-click="userProfileCtrl.user.declineIntimate()"></button>\n        </div>\n\n        <div ng-switch-when="intimate">\n            <a class="go-to-intimate-button with-text" intimate-href="userProfileCtrl.user">\n                <span class="text">Message</span>\n            </a>\n        </div>\n\n        <div ng-switch-when="me">\n            <a ui-sref="app.user_profile_edit" class="go-to-edit-profile-button with-text branded-bg" ng-click="userProfileCtrl.onEditClick()">\n                <span class="text">Edit Profile</span>\n            </a>\n        </div>\n\n    </div>\n</div>')
}]);