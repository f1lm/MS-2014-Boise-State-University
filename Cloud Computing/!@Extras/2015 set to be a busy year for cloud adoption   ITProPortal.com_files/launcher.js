"use strict";!function(a,b,c){function d(a){return("https:"==c.location.protocol?"https":"http")+"://"+a.replace(/^((https?):)?\/\//,"")}function e(){var a=999;return-1!==navigator.appVersion.indexOf("MSIE")&&(a=parseFloat(navigator.appVersion.split("MSIE")[1])),a}function f(){function b(a){a.forEach(function(a){a=a.split("="),""!==a[0]&&(c[a[0]]=decodeURIComponent(a[1]||""))})}var c={},d=a.location.search.slice(1).split("&");b(d);var e=a.location.hash;return d=e.substring(e.indexOf("?")).slice(1).split("&"),b(d),JSON.parse(JSON.stringify(c))}function g(a,b,c){var d;try{d=new(XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0"),d.open(b?"POST":"GET",a,1),d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.setRequestHeader("Content-type","application/json; charset=utf-8"),d.onreadystatechange=function(){d.readyState>3&&c&&c(d.responseText,d)},d.send(b)}catch(e){}}function h(){var a=null;if(b.spotId){var a=b.spotId.trim(),d=JSON.stringify([{name:"embed_spot_launcher_"+a,columns:["url","spot_id"],points:[[c.location.href,a]]}]),e=["goldiewilson-wedontneedroads-1.c.influxdb.com"],f=e[Math.floor(Math.random()*e.length)+0],h="8087",i="spotim_poc_production",j="spotim_poc_production_user",k="iedsfk3jkls23fdf8uefjwio123[hiuw",l="https://"+f+":"+h+"/db/"+i+"/series?u="+j+"&p="+k;g(l,d)}}function i(a){var b=c.createElement("link");b.addEventListener("load",function(){a&&"function"==typeof a&&a()}),b.href=d(t+"/styles/initiator.css?ver="+s),b.rel="stylesheet",b.type="text/css",c.getElementsByTagName("head")[0].appendChild(b)}function j(a,b){var d=a+"{ ";for(var e in b)d+=e+": "+b[e]+";";d+="}";var f=c.getElementsByTagName("head")[0],g=c.createElement("style");return g.setAttribute("type","text/css"),g.styleSheet?g.styleSheet.cssText=d:g.appendChild(c.createTextNode(d)),f.appendChild(g),g}function k(a,b){var d;c.createEvent?(d=c.createEvent("HTMLEvents"),d.initEvent(b,!0,!0)):(d=c.createEventObject(),d.eventType=b),d.eventName=b,c.createEvent?a.dispatchEvent(d):a.fireEvent("on"+d.eventType,d)}function l(){b.posX&&!q&&(j("#spot-im-root.spot-im-floating.spot-im-right",{right:b.posX+" !important"}),j("#spot-im-root.spot-im-floating.spot-im-modal iframe",{right:b.posX+" !important",left:"initial !important"}),j("#spot-im-root.spot-im-floating.spot-im-left",{left:b.posX+" !important"}),j("#spot-im-root.spot-im-floating.spot-im-modal iframe",{left:b.posX+" !important",right:"initial !important"})),b.posY&&!q&&(j("#spot-im-root.spot-im-floating.spot-im-bottom",{bottom:b.posY+" !important"}),j("#spot-im-root.spot-im-floating.spot-im-modal.spot-im-bottom iframe",{bottom:b.posY+" !important"})),w&&!q&&(b.width&&j("#spot-im-root.spot-im-static, #spot-im-root-placeholder",{width:b.width}),b.height&&j("#spot-im-root.spot-im-static, #spot-im-root-placeholder",{height:b.height}))}function m(a,b){var c=/{{(\w*)}}/gi;return a.replace(c,function(a,c){return b[c]||""})}function n(){if(b.startingRoute)return t+b.startingRoute;var a=f(),c=null,d=a.sp_spotname,e=a.sp_spottype,g=a.sp_username,h=a.sp_spotid,i=a.sp_messageid;return c="public"===e&&d&&i?m(x.PUBLIC_SPOT_REPLY,{spotName:d,messageId:i}):"public"===e&&d?m(x.PUBLIC_SPOT_BY_NAME,{spotName:d}):"intimate"===e&&h?m(x.INTIMATE_SPOT_BY_ID,{spotId:h}):g?m(x.USER_PROFILE_BY_NAME,{spotName:b.spotName,username:g}):b.spotId?m(x.PUBLIC_SPOT_BY_ID,{spotId:b.spotId}):b.spotName?m(x.PUBLIC_SPOT_BY_NAME,{spotName:b.spotName}):x.UNDEFINED_ROUTE}function o(){i(function(){l(),F.initialize();var a=["type="+encodeURIComponent(b.type),"domain="+encodeURIComponent(c.domain),"version="+encodeURIComponent(s),"parentUrl="+encodeURIComponent(c.location.href)];b.spotId?a.push("spotId="+encodeURIComponent(b.spotId)):b.spotName&&a.push("spotName="+encodeURIComponent(b.spotName)),b.position&&(b.position=b.position.toLowerCase(),-1!==b.position.indexOf("left")?b.position="left":-1!==b.position.indexOf("right")&&(b.position="right"),a.push("position="+encodeURIComponent(b.position))),b.brandColor&&a.push("brandColor="+encodeURIComponent(b.brandColor)),b.iconUrl&&a.push("iconUrl="+encodeURIComponent(b.iconUrl)),b.spotRename&&a.push("spotRename="+encodeURIComponent(b.spotRename)),b.state&&a.push("state="+encodeURIComponent(b.state)),w&&(b.width&&a.push("width="+encodeURIComponent(b.width)),b.height&&a.push("height="+encodeURIComponent(b.height))),b.undocked&&a.push("undocked="+!0);var d=n();C.src="https:"+d+"?"+a.join("&")})}if(b||(b={}),b.mobileEmbedUrl||(b.mobileEmbedUrl="//www.spot.im/membed"),b.embedUrl||(b.embedUrl="//www.spot.im/embed"),!b.spotId&&!b.spotName)return void a.alert("Spot.IM Embed can't initialized without a spot.");if(e()<10)return void(a.console&&a.console.log&&a.console.log("Spot.IM doesn't support IE "+e()+" browser"));var p=f(),q=/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile/.test(a.navigator.userAgent),r="true"===p.forceMobile;if(!(b.allowDesktop===!1&&!q||b.allowMobile===!1&&q&&!r||q&&!r)){var s="4.1.324_4.0.45",t=null;t=q||r?b.mobileEmbedUrl:b.embedUrl;var u=(function(){var a=function(a){this.id=Math.floor(65536*(1+Math.random())).toString(16).substring(1),this.reportStart(a)};a.prototype={reportStart:function(a){this.startTime=a||new Date},reportEnd:function(a){this.endTime=a||new Date,this.duration=this.endTime-this.startTime}};var b=function(a){this.name=a,this.occurrences=[]};b.prototype={reportStart:function(b){var c=new a(b);return this.occurrences.push(c),c.id},reportEnd:function(a,b){var c=this.occurrences[this.occurrences.length-1];a&&(c=this.occurrences.find(function(b){return b.id==a})),c&&c.reportEnd(b)}};var c=function(){this.events={}};c.prototype={reportStart:function(a,c){var d=this.events[a]||(this.events[a]=new b(name));d.reportStart(c)},reportEnd:function(a,c,d){var e=this.events[a]||(this.events[a]=new b(name));e.reportEnd(c,d)}};var d=new c;return{reporter:d}}(),{NOTICES_CLOSED_STATE:"notices-closed-state",NOTICES_OPENED_STATE:"notices-opened-state",SPOT_STATE:"spot-state",MODAL_STATE:"modal-state"});b.type=(b.type||"floating").toLowerCase();var v=(b.state||u.NOTICES_CLOSED_STATE).toLowerCase(),w="static"===b.type,x={PUBLIC_SPOT_BY_NAME:t+"/{{spotName}}",PUBLIC_SPOT_BY_ID:t+"/id/{{spotId}}",INTIMATE_SPOT_BY_ID:t+"/1on1/id/{{spotId}}",UNDEFINED_ROUTE:t+"/404",USER_PROFILE_BY_NAME:t+"/{{spotName}}/profile/{{username}}/about",PUBLIC_SPOT_REPLY:t+"/{{spotName}}/reply/{{messageId}}"},y=function(){function b(){o=0,c.title=c.title.replace(p,"","gi")}function d(){var a=c.title.match(p),b="("+o+") ";c.title=null!=a?c.title.replace(p,b,"gi"):b+c.title}function e(a){n=a,n?m():l()}function f(c){if(q!==c.type)switch(c.type){case"blur":e(!0);break;case"focus":a.setTimeout(function(){e(!1),b()},200)}q=c.type}function g(){a.addEventListener("blur",f),a.addEventListener("focus",f)}function h(){n?(o++,d()):b()}function i(a){n?(o=a,d()):b()}function j(){e(!1),b()}function k(){e(!0)}function l(){F.updateTabFocus()}function m(){F.updateTabBlur()}var n=c.hidden===!0||c.mozHidden===!0||c.webkitHidden===!0||c.msHidden===!0||c.onfocusin===!1,o=0,p=/^\(\d*\)/,q=null;return{start:g,increment:h,set:i,onEmbedFocus:j,onEmbedBlur:k}}(),z=c.getElementById(b.containerId),A=c.getElementsByTagName("body")[0];if(null===z&&(z=c.createElement("div"),z.id="spot-im-root"),z.parentNode&&"body"===z.parentNode.tagName.toLowerCase()||A.appendChild(z),w){var B=c.createElement("div");B.id="spot-im-root-placeholder",z.parentNode.insertBefore(B,z.nextSibling)}var C=c.createElement("iframe");z.appendChild(C);var D=["spot-im-hide","spot-im-"+b.type];z.className=D.join(" ");var E=C.contentWindow||C,F=function(a,b,c,d,e){return{initialize:function(){this.listenToMessages(),this.listenToWindowResize(),this.listenToUrl(),this.isReady=!1,y.start()},_notifyReady:function(){this.isReady=!0,this._removeClass(D,"spot-im-hide"),k(b,"spot-im-ready"),c.className=D.join(" ")},_removeClass:function(a,b){var c=a.indexOf(b);-1!==c&&a.splice(c,1)},_addClass:function(a,b){var c=a.indexOf(b);-1===c&&a.push(b)},_postMessage:function(a,b){d.postMessage(JSON.stringify({action:a,params:b}),"*")},_updateState:function(a,d){this._removeEmbedSize();var e=this,f=this.state;if(e._removeClass(D,"spot-im-"+f),e._addClass(D,"spot-im-"+a),d.position&&(this.position&&e._removeClass(D,"spot-im-"+this.position),this.position=d.position,e._addClass(D,"spot-im-"+this.position)),w){var g=b.getElementsByTagName("body")[0];g.style.overflow=a===u.MODAL_STATE?"hidden":""}e.state=a,k(b,"spotim-state-changed"),e._postMessage("stateUpdated"),c.className=D.join(" "),this.isReady||this._notifyReady()},_removeEmbedSize:function(){this.embedSizeStyleRule&&(b.getElementsByTagName("head")[0].removeChild(this.embedSizeStyleRule),this.embedSizeStyleRule=null)},_getTitleElement:function(){return b.getElementsByTagName("title")[0]},state:e,position:null,maxEmbedSize:null,destroyEmbed:function(){c.contains(C)&&c.removeChild(C)},getWindowSize:function(){var c,d;return"BackCompat"===b.compatMode?(c=a.innerHeight,d=a.innerWidth):(c=b.documentElement.clientHeight,d=b.documentElement.clientWidth),{windowHeight:c,windowWidth:d}},listenToMessages:function(){var b=this;a.addEventListener("message",function(a){var c=null;try{c=JSON.parse(a.data)}catch(d){}if(c){var e=b[c.action];e&&"function"==typeof e&&e.call(b,c.params||{})}},!1)},listenToWindowResize:function(){var b=null,c=this;a.addEventListener("resize",function(){a.clearTimeout(b),b=a.setTimeout(function(){c.requestWindowSize()},300)},!1)},listenToUrl:function(){var b=this;a.addEventListener("popstate",function(){b.requestWindowUrl()})},noticesOpenedState:function(a){this._updateState(u.NOTICES_OPENED_STATE,a)},noticesClosedState:function(a){this._updateState(u.NOTICES_CLOSED_STATE,a)},spotState:function(a){this._updateState(u.SPOT_STATE,a)},modalState:function(a){this._updateState(u.MODAL_STATE,a)},requestWindowSize:function(){var a=this.getWindowSize();this._postMessage("windowSize",a)},requestBoundingRect:function(){var a=c.getBoundingClientRect();this._postMessage("boundingRect",{top:a.top,left:a.left,right:a.right,bottom:a.bottom})},requestWindowUrl:function(){this._postMessage("windowUrl",a.location.href)},applyEmbedSize:function(a){this._removeEmbedSize(),this.embedSizeStyleRule=j("#spot-im-root",{width:a.width+" !important",height:a.height+" !important","max-width":"initial !important","max-height":"initial !important"}),this._postMessage("embedSizeApplied")},websiteOpenEmbed:function(){this._postMessage("websiteOpenEmbed",!0)},startSSOProcess:function(){k(b,"spotim-sso")},setTabCounter:function(a){y.set(a)},notifyEmbedFocus:function(){y.onEmbedFocus()},notifyEmbedBlur:function(){y.onEmbedBlur()},updateTabFocus:function(){this._postMessage("updateTabFocus",!0)},updateTabBlur:function(){this._postMessage("updateTabBlur",!0)},loginSSOUser:function(a){this._postMessage("loginSSOUser",a)},performanceReportStart:function(){},performanceReportEnd:function(){}}}(a,c,z,E,v,b.size);b.openEmbed=function(){F.websiteOpenEmbed()},b.loginSSOUser=function(a){F.loginSSOUser(a)},o(),h(),z.addEventListener("mousewheel",function(){},!1)}}(window,window.SPOTIM,document);