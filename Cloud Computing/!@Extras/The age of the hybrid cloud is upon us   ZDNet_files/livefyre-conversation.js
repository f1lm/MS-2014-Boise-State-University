define(["jquery","version!fly/managers/debug","managers/user","managers/edition","translations/livefyre-conversation","utils/string-helper","version!fly/components/livefyre-conversation"],function(e,t,n,r,i,s){var t=t.init("livefyre"),s=s;e.widget("zdnet.livefyreConversation",e.fly.livefyreConversation,{options:{urlUserToken:"/livefyre/user-token/",globalConfig:{strings:i},commentStreamConfigs:{datetimeFormat:{minutesUntilAbsoluteTime:1440,absoluteFormat:i.commentsDateFormat},postToButtons:["fb","tw","li"]},commentCountUpdated:function(t,n){var r=e('[data-component="shareBar"] .siu-cmnt.lf-count .count');r.text(n)}},overlayInterval:null,authDelegate:{viewProfile:function(e,t){},editProfile:function(e,t){window.open("https://secure-fly.zdnet.com/members/edit-profile/","_blank")},login:function(e){var t=this;this._trigger("login"),n.hasAccess({requireUsername:!0,nextAction:function(){return t._loginToLivefyre(),e.success(),!1},position:"Comment"})}},events:{initialRenderComplete:function(n){var r=this;t.log("Conversation rendered",n),window.setTimeout(function(){e(".fyre-editor",r.$element).append(e("<div/>",{"class":"livefyreInfo",html:'<a href="'+i.zdnetGuidelinesURL+'" target="_blank">'+i.zdnetGuidelines+"</a>"})),s.wrapFirstWord(e(".fyre-comment-count span"),"strong"),s.wrapFirstWord(e("em.fyre-stream-livecount"),"span")},1e3)},commentPosted:function(e){t.log("Comment posted",e)},commentFlagged:function(e){t.log("Comment flagged",e)},commentLiked:function(e){t.log("Comment liked",e)},commentShared:function(e){t.log("Comment shared",e)},commentCountUpdated:function(e){t.log("Comment count updated",e),this.count=e},userLoggedIn:function(n){t.log("User is logged in"),n.isModerator&&e("#livefyreConversation").addClass("moderator")}},_create:function(n){var r=this,i=r.options;this._setup(),require(["livefyre"],function(){e.each(r.authDelegate,function(e,t){r.authDelegate[e]=t.bind(r)}),i.globalConfig.authDelegate=e.extend(new fyre.conv.RemoteAuthDelegate,r.authDelegate),r.conversation=fyre.conv.load(i.globalConfig,[i.commentStreamConfigs],function(n){r._loginToLivefyre(),e.each(r.events,function(e,i){n.on(e,function(n){i.call(r,n),r._trigger(e,null,n),t.log(e+": ",n)})})})})},_loginToLivefyre:function(){e.ajax({url:this.options.urlUserToken}).done(function(e){n.getUserData(function(t,n){e.userToken&&n.userName&&fyre.conv.login(e.userToken)})}).fail(function(){window.location.reload()})}})})