define(["jquery","version!fly/managers/debug","managers/social/social-flags"],function(e,t,n){t=t.init("facebook");var r=!1,i={fbOptions:{appId:"136759700898",channelUrl:"//"+document.domain+"/html/facebook/channel.html",status:!0,cookie:!0,xfbml:!0,version:"v2.0"},onInit:null,debug:!1};return{init:function(s){var o=this;n.enabled.facebook&&(e.extend(!0,i,s),r?i.onInit&&i.onInit():(e("#fb-root").length<=0&&e('<div id="fb-root"></div>').appendTo(e("body")),window.fbAsyncInit=function(){FB.init(i.fbOptions),r=!0,o.setupEvents(),i.onInit&&i.onInit(),t.log("Initialized"),delete window.fbAsyncInit},require(["facebook"+(i.debug?"-debug":"")])))},parse:function(e){if(r)try{e?FB.XFBML.parse(e):FB.XFBML.parse()}catch(n){t.log("FB failed to parse the page",n)}else t.log("Parse failed -- not initialized yet")},isInitialized:function(){return r},setupEvents:function(){var n=this;t.log("Setting up events");var r=e('[data-popup="facebook"]');r.length>0&&r.click(function(){t.log("Facebook Clicked!"),n.trackShare()}),FB.Event.subscribe("edge.create",function(e,r){t.log("Liked");var i={wdloc:r._attr.ref};n.trackLike(i)}),FB.Event.subscribe("edge.remove",function(e,r){t.log("Unliked");var i={wdloc:r._attr.ref};n.trackUnlike(i)})},trackShare:function(){dwMgr.trackSocialShare(this,{eventt:"share",lite_event_category:"social",ssite:"facebookSend",wd:"sharebar",wdloc:"body"}),omnitureMgr.trackEvent("clickSocialShare",{socialCode:omnitureMgr.getSocialCode("facebookSend")})},trackLike:function(e){dwMgr.trackSocialShare(this,{eventt:"share",lite_event_category:"social",ssite:"facebook",wd:"sharebar",wdloc:e.wdloc}),omnitureMgr.trackEvent("clickSocialShare",{socialCode:omnitureMgr.getSocialCode("facebook")})},trackUnlike:function(e){}}})