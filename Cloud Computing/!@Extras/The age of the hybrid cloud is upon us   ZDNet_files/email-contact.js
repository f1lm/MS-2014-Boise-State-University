define(["jquery","version!fly/managers/debug","translations/form-validate","version!fly/components/modal-async","components/loading","version!fly/components/base"],function(e,t,n){var r=e.support.touch?"vclick":"click",i=e.zdnet.loading();t=t.init("emailContact"),e.widget("zdnet.emailContact",e.fly.base,{options:{modalAsync:{url:"/user/email-contact/xhr/",requestData:{}}},modal:null,_create:function(){this._setup(),this._setupEvents()},_setupEvents:function(){var e={};e[r]="_handleAsyncModal",this._on(this.$element,e)},_handleAsyncModal:function(t){var n=this;t.preventDefault(),this.modal&&this.modal.$element.remove(),this.modal=e.fly.modalAsync(e.extend(!0,{},{openOnInit:!0},this.options.modalAsync)),this.modal.$element.on("modalasynccontentset",function(e,t){n._handleContactFormEvents(t.$modal)})},_handleContactFormEvents:function(r){var s=this,o=e(r.find("form")),u=o.find("button, input, textarea");i.$element.appendTo(o),o.formValidate({success:function(r,s){r.preventDefault();var a=o.serialize();u.attr("disabled","disabled"),i.add(),e.ajax({url:o.attr("action"),type:o.attr("method"),data:a,dataType:"json"}).done(function(e){t.log("success",e),e.errors?e.errors.recaptcha?o.data("formValidate").addGlobalError(n.recaptchaFail,"error"):o.data("formValidate").addGlobalError(n.emailError,"error"):(o.data("formValidate").addGlobalError(n.emailSuccess,"success"),o[0].reset())}).fail(function(e){t.log("error",e),o.data("formValidate").addGlobalError(n.emailError,"error")}).always(function(e){t.log("complete",e),u.removeAttr("disabled"),i.remove(),Recaptcha.reload()})}})}})})