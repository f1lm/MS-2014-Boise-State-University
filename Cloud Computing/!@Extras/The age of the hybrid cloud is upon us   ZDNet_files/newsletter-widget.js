define(["jquery","version!fly/managers/debug","managers/user","version!fly/components/base"],function(e,t,n){var t=t.init("newsletterWidget");e.widget("zdnet.newsletterWidget",e.fly.base,{options:{postNewsletter:"/newsletter/xhr/subscribe/"},_create:function(){var e=this;e._setup(),e._setupEvents()},_setupEvents:function(){var e=this,t={};t["submit .newsletterWidgetForm"]="_handleSubmit",this._on(this.$document,t)},_handleSubmit:function(r){r.preventDefault();var i=this.options,s=e(".newsletterWidgetForm input:checked").map(function(){return this.value}).get();if(!s||s.length==0)return;n.hasAccess({position:"Newsletter Sub Widget",nextAction:function(){return e('.newsletterWidgetForm input[type="submit"]').attr("disabled","disabled"),e.ajax({timeout:15e3,dataType:"json",url:i.postNewsletter,dataType:"json",data:{subs:s.join(",")}}).fail(function(n,r){r=="timeout"&&(t.log("Request timeout. Try again"),e(".newsletterWidgetErrorMessage").show())}).done(function(t){t.status=="success"?(e.each(s,function(e,t){omnitureMgr.trackEvent("newsletterSubscribe",{newsletterId:t})}),e(".newsletterWidgetForm").hide(),e(".newsletterWidgetSuccessMessage").show()):e(".newsletterWidgetErrorMessage").show()}),!1}})}})})