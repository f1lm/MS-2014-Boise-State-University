define(["jquery","version!fly/managers/debug","version!fly/utils/string-helper","version!fly/components/base"],function(e,t,n){var r=t.init("socialButton");e.widget("fly.socialButton",e.fly.base,{options:{mode:null,title:"",summary:"",url:"",shortUrl:"",twitterRelated:"cnet,zdnet",twitterUsername:!1,redditData:{target:null,bdrColor:null,bgColor:null},googleplusKey:"",facebookAppId:"",site:"",buttonSelectorId:"button",location:null},_create:function(){var t=this.options,n=this;this._setup(),this.url=t.url||window.location.href,this.encodedUrl=encodeURIComponent(t.url),this.encodedTitle=encodeURIComponent(t.title),this.$buttons=this.$element.find("[data-"+t.buttonSelectorId+"]");if(this.$buttons.length<=0)return r.log("Error: No buttons found.",this.$element),!1;this.$buttons.each(function(){var r=e(this),i=r.data(t.buttonSelectorId);n._setFunction(i.toLowerCase())})},_setFunction:function(t){var i="get"+n.capitalize(t),s;if(!e.isFunction(this[i]))return r.log("Error: Function name does not exist:",i),!1;s=this[i](),this.setContent(t,s)},getFacebook:function(){var t=this.getMode("horizontal"),n={width:"46",layout:"box_count",href:this.url,send:"false"},r;switch(t){case"horizontal":n.height="21",n.width="85",n.layout="button_count";break;case"horizontal-wide":n.height="24",n.width="350",n.layout="standard"}return r='<div class="fb-like" data-send="false" data-show-faces="false" data-font="arial"',e.each(n,function(e,t){r+=" data-"+e+'="'+t+'"'}),r+="></div>",this._setFbContainer(),r},getFacebookActivity:function(t){var n={width:"290",height:"350",header:"false",font:"arial",recommendations:"true",ref:"activity-widget",site:this.options.site},r=e.extend({},n,t),i;return i='<div class="fb-activity" max-age="10" border-color="#fff"',e.each(r,function(e,t){i+=" data-"+e+'="'+t+'"'}),i+="></div>",this._setFbContainer(),i},getTwitterfollow:function(){var t=this.getMode("horizontal"),n=this.options.twitterUsername,r={},i,s,o;return n?(n=encodeURI(e.trim(n)),n.indexOf("@")===0&&(n=n.substring(1)),s=t=="horizontal"?"true":"false",o=t=="horizontal"?"false":"true",r={"show-count":o,lang:"en","show-screen-name":s},i='<a href="http://twitter.com/'+n+'" class="twitter-follow-button"',e.each(r,function(e,t){i+=" data-"+e+'="'+t+'"'}),i+=">Follow @"+n+"</a>",i):!1},getTwitter:function(){var t=this.getMode("horizontal"),n={},r=this.options,i;return n={count:t,related:this.options.twitterRelated,text:this.options.title},r.shortUrl?(n.url=r.shortUrl,n.counturl=this.url):n.url=this.url,r.via&&(n.via=r.via),i='<a href="http://twitter.com/share" class="twitter-share-button"',e.each(n,function(e,t){i+=" data-"+e+'="'+t.replace(/"/g,"&#34;")+'"'}),i+="></a>",i},getStumbleupon:function(){var e=this.getMode("vertical"),t={},n;return e==="horizontal"?(t.height="18",t.width="74",t.type="1"):(t.height="60",t.width="50",t.type="5"),n='<iframe src="http://www.stumbleupon.com/badge/embed/'+t.type+"/?url="+this.encodedUrl+'" scrolling="no" frameborder="0" style="border:none;overflow:hidden;width:'+t.width+"px;height:"+t.height+'px;" allowTransparency="true"></iframe>',n},getReddit:function(){var e=this.getMode("horizontal"),t="https:"==document.location.protocol?"https://redditstatic.s3.amazonaws.com":"http://www.reddit.com/static",n={},r=this.options,i=r.redditData,s;return e==="horizontal"?(n.height="22",n.width="120",n.type="1"):(n.height="69",n.width="51",n.type="2"),s='<iframe src="'+t+"/button/button"+n.type+".html?width="+n.width+"&url="+this.encodedUrl+"&title="+this.encodedTitle,i.target&&(s+="&sr="+encodeURIComponent(i.target)),i.bgColor&&(s+="&bgcolor="+encodeURIComponent(i.bgColor)),i.bdrColor&&(s+="&bordercolor="+encodeURIComponent(i.bdrColor)),s+='&newwindow=1" height="'+n.height+'" width="'+n.width+'" scrolling="no" frameborder="0"></iframe>',s},getGoogleplus:function(){var e=this.getMode("vertical"),t,n;return t=e=="horizontal"?"medium":"tall",n='<div class="g-plusone" data-size="'+t+'" data-href="'+this.url+'" data-count="true" data-callback="handleGooglePlusCallback"></div>',n},getLinkedin:function(){var e=this.getMode("vertical"),t,n;return n=e=="horizontal"?"right":"top",t='<script type="IN/Share" data-counter="'+n+'" data-url="'+encodeURI(this.url)+'" data-onsuccess="self.initLinkedEvents"></script>',t},_setFbContainer:function(){e("#fb-root").length<=0&&e('<div id="fb-root"></div>').appendTo(e("body"))},getMode:function(e){var t=this.options,n=t.mode,r=this.$element;return n=n||e,n=n.toLowerCase(),(!r.data("mode")||r.data("mode")&&r.data("mode")===n)&&r.attr("data-mode",n),n},setContent:function(t,i){var s="_init"+n.capitalize(t),o=this._getButtonEl(t),u=this;e(i).appendTo(o),e.isFunction(this[s])?this[s]():r.log("Error: No handler function assigned. ",s),this._setupLoadEvent("loaded",null,{el:o,name:t})},_getButtonEl:function(t){var n=this.options,r;return this.$buttons.filter(function(i){var s=e(this),u=s.attr("data-"+n.buttonSelectorId);return r=u===t?e(this):!1,r})},_initFacebook:function(){var e=this;require(["//connect.facebook.net/en_US/all.js#xfbml=1&appId="+this.options.facebookAppId],function(){FB.XFBML.parse();try{FB.Event.subscribe("edge.create",function(t){e._setupClickEvent(null,{name:"facebook",response:t})})}catch(t){}})},_initFacebookactivity:function(){this._initFacebook()},_initTwitter:function(){var e=this;require(["http://platform.twitter.com/widgets.js"],function(){try{twttr.widgets.load(),twttr.events.bind("follow",function(t){e._setupClickEvent(t,{name:"twitter",action:"follow"})}),twttr.events.bind("click",function(t){e._setupClickEvent(t,{name:"twitter",action:"click"})}),twttr.events.bind("tweet",function(t){e._setupClickEvent(t,{name:"twitter",action:"tweet"})})}catch(t){r.log("Issue with twitter js (http://platform.twitter.com/widgets.js)",t)}})},_initTwitterfollow:function(){this._initTwitter()},_initLinkedin:function(){require(["//platform.linkedin.com/in.js"],function(){e(".IN-widget").click(function(){self._setupClickEvent(null,{name:"linkedin"})})})},_initGoogleplus:function(){var e=this;require(["https://apis.google.com/js/plusone.js"],function(){window.handleGooglePlusCallback=function(t){var n=t.state=="on"?"plusone":"rmvplusone";e._setupClickEvent(null,{name:"googleplus",type:n})}.bind(this)})},_initReddit:function(){},_setupClickEvent:function(t,n){t=t||null;var r=this.options.location;r&&e.extend(n,{location:r}),this._trigger("clicked",t,n)},_setupLoadEvent:function(t,n){t=t||null;var r=this.options.location;r&&e.extend(n,{location:r}),this._trigger("loaded",t,n)},_destroy:function(){this.buttonContent&&this.$buttonContent.remove()}})})