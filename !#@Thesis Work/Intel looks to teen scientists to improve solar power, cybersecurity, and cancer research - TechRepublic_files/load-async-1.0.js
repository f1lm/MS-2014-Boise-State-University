define(["jquery","version!fly/managers/debug","version!fly/components/base"],function(e,t){var n=t.get("loadAsync");e.widget("tr.loadAsync",e.fly.base,{options:{url:null,data:{},replace:!0,delay:0},_create:function(){var e=this.options;this._setup(),this.id=this.$element.attr("id"),this.id||(this.id="uid-"+Math.floor(Math.random()*1e5),this.$element.attr("id",this.id)),n.log("_create: ","container",this.id),this._load()},_load:function(){var t=this.options,r=this;n.log("_load: ","loading",r.id,t.url,t.data),setTimeout(function(){e.ajax({type:"GET",dataType:"json",url:t.url,data:t.data}).done(e.proxy(r._handleSuccess,r)).fail(e.proxy(r._handleFailure,r))},t.delay)},_handleSuccess:function(e){var t=this.options,r=this;n.log("_handleSuccess: ","response success?",e.success,r.id),e.success&&e.html?(t.replace?r.$element.replaceWith(e.html):r.$element.html(e.html),r._trigger("contentSet",null,{content:r.$element})):r._handleFailure(e),this._optimizelyTrigger([{el:this.$element,type:"load-async"}])},_handleFailure:function(e){var t=this.options,r=this;n.log("_handleFailure: ","error message",e,r.id),this._optimizelyTrigger([{el:this.$element,type:"load-async"}])},_optimizelyTrigger:function(t){e(window).trigger("load-async-complete",t)}})})