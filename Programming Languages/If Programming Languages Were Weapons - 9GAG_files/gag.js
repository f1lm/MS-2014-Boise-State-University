jQuery.noConflict();(function($,window){GAG={};window.GAG=GAG;GAG.GA={track:function(category,action,label,value){try{if(value==undefined){value=1}ga("send","event",category,action,label,value);if(window._ga&&window._ga instanceof Array){for(var i=0;i<window._ga.length;i++){var prefix=window._ga[i];ga(prefix+".send","event",category,action,label,value)}}}catch(e){}}};if(!window.console){window.console={log:function(){}}}shortcut={all_shortcuts:{},add:function(B,H,D){var G={type:"keydown",propagate:false,disable_in_input:false,target:document,keycode:false};if(!D){D=G}else{for(var A in G){if(typeof D[A]=="undefined"){D[A]=G[A]}}}var F=D.target;if(typeof D.target=="string"){F=document.getElementById(D.target)}var C=this;B=B.toLowerCase();var E=function(M){M=M||window.event;if(D.disable_in_input){var J;if(M.target){J=M.target}else{if(M.srcElement){J=M.srcElement}}if(J.nodeType==3){J=J.parentNode}if(J.tagName=="INPUT"||J.tagName=="TEXTAREA"){return}}if(M.keyCode){code=M.keyCode}else{if(M.which){code=M.which}}var L=String.fromCharCode(code);if(code==188){L=","}if(code==190){L="."}var Q=B.split("+");var P=0;var N={"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"};var K={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};var O={shift:{wanted:false,pressed:false},ctrl:{wanted:false,pressed:false},alt:{wanted:false,pressed:false},meta:{wanted:false,pressed:false}};if(M.ctrlKey){O.ctrl.pressed=true}if(M.shiftKey){O.shift.pressed=true}if(M.altKey){O.alt.pressed=true}if(M.metaKey){O.meta.pressed=true}for(var I=0;k=Q[I],I<Q.length;I++){if(k=="ctrl"||k=="control"){P++;O.ctrl.wanted=true}else{if(k=="shift"){P++;O.shift.wanted=true}else{if(k=="alt"){P++;O.alt.wanted=true}else{if(k=="meta"){P++;O.meta.wanted=true}else{if(k.length>1){if(K[k]==code){P++}}else{if(D.keycode){if(D.keycode==code){P++}}else{if(L.toLowerCase()==k.toLowerCase()){P++}else{if(N[L]&&M.shiftKey){L=N[L];if(L==k){P++}}}}}}}}}}if(P==Q.length&&O.ctrl.pressed==O.ctrl.wanted&&O.shift.pressed==O.shift.wanted&&O.alt.pressed==O.alt.wanted&&O.meta.pressed==O.meta.wanted){H(M);if(!D.propagate){M.cancelBubble=true;M.returnValue=false;if(M.stopPropagation){M.stopPropagation();M.preventDefault()}return false}}};this.all_shortcuts[B]={callback:E,target:F,event:D.type};if(F.addEventListener){F.addEventListener(D.type,E,false)}else{if(F.attachEvent){F.attachEvent("on"+D.type,E)}else{F["on"+D.type]=E}}},remove:function(A){A=A.toLowerCase();var D=this.all_shortcuts[A];delete (this.all_shortcuts[A]);if(!D){return}var B=D.event;var C=D.target;var E=D.callback;if(C.detachEvent){C.detachEvent("on"+B,E)}else{if(C.removeEventListener){C.removeEventListener(B,E,false)}else{C["on"+B]=false}}}};GAG.Utils={loadScript:function(src,async){(function(){var ga=document.createElement("script");ga.type="text/javascript";ga.async=true;ga.src=src;ga.async=async;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ga,s)})()},scriptLoaded:function(src){var len=$("script").filter(function(){return($(this).attr("src")==src)}).length;return(len>0)},parseJsonString:function(jsonText){try{return $.parseJSON(jsonText)}catch(e){}return{}},formatPostLink:function(entryId){return"http://"+GAG.Page.getDomain()+"/gag/"+entryId},formatProtocolForUrl:function(url){return url.replace(/(^.*http:)|(^.*https:)/g,location.protocol)},textSearch:function(inputElement,container,searchElement,config){if(typeof config=="undefined"){config={}}$(inputElement).keyup(function(){var filter=$(this).val();var count=0;$(container).each(function(){var index=-1;var text=$(this).find(searchElement).text();if((index=text.search(new RegExp(filter,"i")))<0){$(this).hide()}else{$(this).show();if(typeof config.highlight!="undefined"&&config.highlight){var newText1=text.substr(0,index)+"<strong>";var newText2=text.substr(index,filter.length)+"</strong>"+text.substr(index+filter.length,text.length);$(this).find(searchElement).html(newText1+newText2)}count++}})})},getUrlParam:function(name){return decodeURI((RegExp(name+"=(.+?)(&|$)").exec(location.search)||[,null])[1])},isCurrentlyFocusedInTypeable:function(){var focusedElementTagName=$(document.activeElement).prop("tagName").toLowerCase();return(focusedElementTagName=="input"||focusedElementTagName=="textarea")},formatNumber:function(number,decimals,dec_point,thousands_sep){if(typeof decimals==="undefined"){decimals=0}number=(number+"").replace(/[^0-9+\-Ee.]/g,"");var n=!isFinite(+number)?0:+number,prec=!isFinite(+decimals)?0:Math.abs(decimals),sep=(typeof thousands_sep==="undefined")?",":thousands_sep,dec=(typeof dec_point==="undefined")?".":dec_point,s,toFixedFix=function(n,prec){var k=Math.pow(10,prec);return""+Math.round(n*k)/k};s=(prec?toFixedFix(n,prec):""+Math.round(n)).split(".");if(s[0].length>3){s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,sep)}if((s[1]||"").length<prec){s[1]=s[1]||"";s[1]+=new Array(prec-s[1].length+1).join("0")}return s.join(dec)},cookieCheckKey:"cchk",isCookieEnabled:function(){var cookie=$.cookie(GAG.Utils.cookieCheckKey);if(cookie!=null){return true}$.cookie(GAG.Utils.cookieCheckKey,1,{duration:1000});cookie=$.cookie(GAG.Utils.cookieCheckKey);if(cookie!=null){return true}return false}};GAG.Validator={isValidLoginKey:function(usernameOrEmail){return this.isValidUsername(usernameOrEmail)||this.isValidEmail(usernameOrEmail)},isValidUsername:function(username){return username.test("^[0-9a-zA-Z_]{3,15}$")},isValidEmail:function(email){return(email.match("^([a-zA-Z0-9._-]+)@([a-zA-Z0-9.-]+)\\.([a-zA-Z]{2,4})$")!=null)},isValidFullName:function(fullName){return($.trim(fullName).length>0)},isValidPassword:function(password,min,max){var isValid=true;if(min!=undefined){if(password.length<min){isValid=false}}if(max!=undefined){if(password.length>max){isValid=false}}if(password.length==0){isValid=false}return isValid},isValidGender:function(gender){return gender=="F"||gender=="M"},MONTH_DAYS:[31,29,31,30,31,30,31,31,30,31,30,31],isValidDateValues:function(dobYear,dobMonth,dobDay){var isLeap=dobYear%400==0||(dobYear%100!=0&&dobYear%4==0);this.MONTH_DAYS[1]=isLeap?29:28;var validRange=(dobDay>=1&&dobDay<=31)&&(dobMonth>=1&&dobMonth<=12)&&(dobYear>=1900);var validDay=dobDay<=this.MONTH_DAYS[dobMonth-1];return validRange&&validDay},isValidPostLink:function(url){var pattern=new RegExp("^http(s?)://"+GAG.Page.getDomain()+"/gag/([1-9])([0-9]*)(\\?[^ ]*)?$");return url.trim().test(pattern)},lookLikeURL:function(url){var pattern=new RegExp("^http(s?)://");return url.trim().test(pattern)}};GAG.Response=function(){this._isSuccess=false;this._keys={};this.setKey(GAG.Response.Constants.RESPONSE_MESSAGE,"")};GAG.Response.Constants={RESPONSE_MESSAGE:"RESPONSE_MESSAGE",RESPONSE_CODE:"RESPONSE_CODE",RESPONSE_DATA:"RESPONSE_DATA"};GAG.Response.prototype.succeeded=function(msg){this._isSuccess=true;this.setKey(GAG.Response.Constants.RESPONSE_MESSAGE,msg);return this};GAG.Response.prototype.failed=function(msg){this._isSuccess=false;this.setKey(GAG.Response.Constants.RESPONSE_MESSAGE,msg);return this};GAG.Response.prototype.isSuccess=function(){return this._isSuccess};GAG.Response.prototype.setKey=function(key,value){this._keys[key]=value;return this};GAG.Response.prototype.getKey=function(key){return this._keys[key]};GAG.Response.prototype.setCode=function(value){this.setKey(GAG.Response.Constants.RESPONSE_CODE,value);return this};GAG.Response.prototype.getCode=function(){return this.getKey(GAG.Response.Constants.RESPONSE_CODE)};GAG.Response.prototype.setData=function(value){this.setKey(GAG.Response.Constants.RESPONSE_DATA,value);return this};GAG.Response.prototype.getData=function(){return this.getKey(GAG.Response.Constants.RESPONSE_DATA)};GAG.Response.prototype.setMessage=function(value){this.setKey(GAG.Response.Constants.RESPONSE_MESSAGE,value);return this};GAG.Response.prototype.getMessage=function(){return this.getKey(GAG.Response.Constants.RESPONSE_MESSAGE)};GAG.BaseObject=function(){this._namespace=""};GAG.BaseObject.prototype.setNamespace=function(namespace){this._namespace=namespace};GAG.BaseObject.prototype.log=function(msg,prependText){console.log(this._namespace+" "+(prependText?prependText+" ":"")+msg)};GAG.BaseObject.prototype.failed=function(msg){return(new GAG.Response()).failed(msg)};GAG.BaseObject.prototype.succeeded=function(msg){return(new GAG.Response()).succeeded(msg)};GAG.Model=function(){this._base=this};GAG.Model.prototype=new GAG.BaseObject();GAG.Model.prototype.getBase=function(){return this._base};GAG.Model.prototype.init=function(){};GAG.Configs={_configs:{},init:function(){},load:function(configs){this._configs=configs?configs:{}},get:function(key){var keys=key.split(".");var cfg=this._configs;var value="";while(cfg&&keys.length>0){cfg=cfg[keys.shift()];value=cfg}return value},Facebook:{init:function(){},getAppId:function(){return GAG.Configs.get("configs.facebook.app_id")},getChannelFile:function(){var protocol=GAG.Page.getProtocol();return"//"+GAG.Page.getDomain()+"/static/"+protocol+"_channel.html"}}};GAG.State={fbAsyncInited:false};GAG.Page={_domain:"9gag.com",_backUrl:"",_pageKey:"",init:function(){this._domain=GAG.Configs.get("page.domain");this._backUrl=GAG.Configs.get("page.back_url");this._pageKey=GAG.Configs.get("page.page_key")},getProtocol:function(){return("https:"==document.location.protocol)?"https":"http"},getDomain:function(){return this._domain},getCookieOptions:function(){return{path:"/",expires:365*20}},getPageKey:function(){return this._pageKey},load:function(uri){window.location=uri},preloadImage:function(imageUrl){var img=new Image();img.src=imageUrl;var tmpDiv=document.getElementById("tmp-img");if(tmpDiv){tmpDiv.appendChild(img)}},getBackUrl:function(){return this._backUrl},KEYS:{NEW_VOTE_PAGE:"v",POST_PAGE:"post",LANDING_PAGE:"landing",PROFILE_PAGE:"profile",MEMBER_PAGE:"member",HOT_PAGE:"hot",TRENDING_PAGE:"trending",VOTE_PAGE:"vote",INVITE_FACEBOOK_PAGE:"invite",CONTACT_PAGE:"contact",UPLOAD_PAGE:"page-zone-submit",SIGNUP_PAGE:"signup"},isNewVotePage:function(){return this._pageKey==this.KEYS.NEW_VOTE_PAGE},isPostPage:function(){return this._pageKey==this.KEYS.POST_PAGE},isLandingPage:function(){return this._pageKey==this.KEYS.LANDING_PAGE},isListingPage:function(){return(jQuery.inArray(this._pageKey,[this.KEYS.HOT_PAGE,this.KEYS.TRENDING_PAGE,this.KEYS.VOTE_PAGE])>=0)?true:false},isProfilePage:function(){return this._pageKey==this.KEYS.PROFILE_PAGE},isMemberPage:function(){return this._pageKey==this.KEYS.MEMBER_PAGE},isInviteFacebookPage:function(){return this._pageKey==this.KEYS.INVITE_FACEBOOK_PAGE},isUploadPage:function(){return this._pageKey==this.KEYS.UPLOAD_PAGE},isContactPage:function(){return this._pageKey==this.KEYS.CONTACT_PAGE},isSignupPage:function(){return this._pageKey==this.KEYS.SIGNUP_PAGE}};GAG.Facebook={_xfbmlRenderItems:[],_fbInitedCallbacks:[],_getFriendsCallbacks:[],init:function(){},asyncInit:function(){GAG.State.fbAsyncInited=true;this.initApp();this.executeRenderQueue();this.getFriends()},initApp:function(){FB.init({appId:GAG.Configs.Facebook.getAppId(),channelUrl:GAG.Configs.Facebook.getChannelFile(),xfbml:false,status:true,cookie:true});this._checkFacebookLoginStatus()},addInitCallback:function(callbackType,callback){GAG.Facebook._fbInitedCallbacks.push({callbackType:callbackType,callback:callback})},_executeFbInitedCallbacks:function(callbackType){for(var i=0;i<this._fbInitedCallbacks.length;i++){var cbItem=this._fbInitedCallbacks[i];if((callbackType.indexOf(cbItem.callbackType)!==-1)&&(typeof cbItem.callback=="function")&&(!this._fbInitedCallbacks[i]["executed"])){this._fbInitedCallbacks[i]["executed"]=true;cbItem.callback()}}},sessionChangeHandler:function(response){if(!response){return}if(response.status==="connected"){if(response.authResponse){GAG.Facebook.autoLogin();GAG.Facebook._executeFbInitedCallbacks("connected,logged-in,all")}}else{if(response.status==="not_authorized"){GAG.Facebook._executeFbInitedCallbacks("logged-in,all")}else{GAG.Facebook._executeFbInitedCallbacks("logged-out,all")}}},_checkFacebookLoginStatus:function(){FB.getLoginStatus(GAG.Facebook.sessionChangeHandler);FB.Event.subscribe("auth.authResponseChange",GAG.Facebook.sessionChangeHandler)},executeRenderQueue:function(){for(var i=0;i<this._xfbmlRenderItems.length;i++){var task=this._xfbmlRenderItems[i];this.parseElement(task.elementId,task.callback)}},renderElement:function(elementId,callback){if(GAG.State.fbAsyncInited){this.parseElement(elementId,callback)}else{this._xfbmlRenderItems.push({elementId:elementId,callback:callback})}},parseElement:function(elementId,callback){var el=document.getElementById(elementId);if(!el){return}try{if(callback){FB.XFBML.parse(el,callback)}else{FB.XFBML.parse(el)}}catch(e){}},login:function(callback){FB.login(function(response){if(response.authResponse){if(typeof(callback)=="function"){callback.call(response)}else{alert("it is not a callback")}}return response.authResponse})},autoConnectKey:"auto_log",autoConnectDuration:{path:"/",duration:365*20},autoLogin:function(){if(GAG.User.isLoggedIn()){return}if(!GAG.Utils.isCookieEnabled()){return}var cookie=$.cookie(GAG.Facebook.autoConnectKey);var val={a:false,d:false,lo:false,dl:false};if(cookie||cookie===false){val=JSON.parse(cookie)}if(val!=null){if(val.a){return}if(!val.dl&&(val.lo||val.d)){return}}GAG.GA.track("Facebook-Login","Auto","");val.a=true;var cookieVal=JSON.stringify(val);var returns=$.cookie(GAG.Facebook.autoConnectKey,cookieVal,GAG.Facebook.autoConnectDuration);GAG.Facebook.Connect.autoLogin(location.href)},openSendDialog:function(fbid,name,link,desc,pic){FB.ui({method:"send",name:name,to:fbid,link:link,desciption:desc,picture:pic})},getFriends:function(){if(GAG.Facebook._getFriendsCallbacks.length>0){FB.getLoginStatus(function(response){if(response.status==="connected"){for(var i=0;i<GAG.Facebook._getFriendsCallbacks.length;i++){try{FB.api("/me/friends",GAG.Facebook._getFriendsCallbacks[i])}catch(e){}}GAG.Facebook._getFriendsCallbacks=[]}else{var successLogin=GAG.Facebook.login(GAG.Facebook.getFriends)}})}},addGetFriendsCallback:function(callback){this._getFriendsCallbacks.push(callback)},getProfilePic:function(fbid){var url="https://graph.facebook.com/{{fbid}}/picture?type=square";return url.replace("{{fbid}}",fbid)},renderLike:function(elementId,callback,configs){var div=this.Plugins.Like.getElement(configs);var el=$("#"+elementId).html("").append(div);this.renderElement(elementId,callback)},Plugins:{Like:{getElement:function(configs){var defaults={"class":"fb-like","data-href":"","data-layout":"button_count","data-show-faces":"false","data-font":"arial","data-width":300};configs=$.extend(defaults,configs);var div=$("<div/>");for(var dataKey in configs){div.attr(dataKey,configs[dataKey])}return div}}},Connect:{FB_CONNECT_CALLBACK_URL:"/connect/facebook-callback",INIT_FAILURE_MESSAGE:"Facebook Connect is not enabled, please check if there's any browser plugin blocking the function.",_additionalParams:{},addParam:function(key,value){this._additionalParams[key]=value},_getConnectParamsString:function(){var str="";var index=0;for(k in this._additionalParams){str+=(index==0?"":"&")+k+"="+encodeURIComponent(this._additionalParams[k]);index++}return str},_getConnectUrl:function(token){var url=GAG.Facebook.Connect.FB_CONNECT_CALLBACK_URL;url+="?"+this._getConnectParamsString();return url},autoLogin:function(redirectUrl){try{if(redirectUrl==undefined||redirectUrl==null){redirectUrl="/"}var url="https://"+GAG.Page.getDomain()+"/connect/auto-login";var next="next="+encodeURIComponent(redirectUrl+"&"+this._getConnectParamsString());url+="?"+next;window.location=url}catch(e){if($.browser.msie&&parseInt($.browser.version,10)<=8){}else{}return}},connect:function(redirectUrl){try{if(redirectUrl==undefined||redirectUrl==null){redirectUrl="/"}var url="https://"+GAG.Page.getDomain()+"/connect/facebook";var next="next="+encodeURIComponent(redirectUrl+"&"+this._getConnectParamsString());url+="?"+next;window.location=url}catch(e){if($.browser.msie&&parseInt($.browser.version,10)<=8){}else{}return}}}};window.fbAsyncInit=function(){GAG.Facebook.asyncInit()};GAG.GPlus={btnClicked:false,_asyncInited:false,_renderQueue:[],init:function(){this._checkAsyncInit()},_checkAsyncInit:function(){if(typeof gapi!=="undefined"){this.asyncInit()}else{setTimeout($.proxy(this._checkAsyncInit,this),100)}},asyncInit:function(){this._asyncInited=true;this._executeQueue()},renderButton:function(elementId,callback){var options=this._getRenderOptions();options.callback=callback;if(this._asyncInited){gapi.signin.render(elementId,options)}else{this._renderQueue.push({domId:elementId,options:options})}},_executeQueue:function(){while(this._renderQueue.length>0){var item=this._renderQueue.shift();gapi.signin.render(item.domId,item.options)}},_getRenderOptions:function(){var options={clientid:GAG.Configs.get("configs.gplus.client_id"),cookiepolicy:"single_host_origin",accesstype:"offline",scope:"https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/userinfo.email"};var apppackagename=GAG.Configs.get("configs.gplus.app_package_name");if(apppackagename){options.apppackagename=apppackagename}return options}};window.gplusRender=function(){};GAG.User=$.extend({},new GAG.Model(),(function(){var _self={_isLoggedIn:null,_user:null};return{init:function(){_self._user=GAG.Configs.get("user")},isLoggedIn:function(doRedirect,next){_self._isLoggedIn=this.getUserId()>0;if(doRedirect&&!_self._isLoggedIn){var url="https://"+GAG.Page.getDomain()+"/login";if(next){url+="?next="+next}GAG.Page.load(url)}return _self._isLoggedIn},getUsername:function(){return _self._user&&_self._user.username?_self._user.username:""},getUserId:function(){return _self._user&&_self._user.id?_self._user.id:0}}})());GAG.Login=$.extend({},new GAG.Model(),{userId:""});GAG.Entry=(function(){var _self={API:{REPORT_ENTRY_URI:"/report-post"},init:function(){},_isRequesting:false,report:function(entryId,reportType,reportLink,okHandler,failHandler){if(!GAG.User.isLoggedIn(true,GAG.Page.getBackUrl())){return}if(_self._isRequesting){return}var params={entryId:entryId,type:reportType,link:reportLink};var url=_self.API.REPORT_ENTRY_URI;$.ajax({type:"POST",url:url,data:params,beforeSend:function(){GAG.Entry._isRequesting=true},complete:function(){GAG.Entry._isRequesting=false},success:function(jsonText){var json=GAG.Utils.parseJsonString(jsonText);if(json.okay){okHandler(entryId)}else{failHandler(entryId)}},error:function(json){failHandler(entryId)}})}};return{init:_self.init,report:_self.report}})();GAG.Vote=$.extend({},new GAG.Model(),{API:{URL_LIKE:"/vote/like",URL_DISLIKE:"/vote/dislike",URL_UNLIKE:"/vote/unlike"},_requests:{},_isRequesting:false,init:function(){},_submitRequest:function(url,entryId,okHandler,failHandler){if(entryId===undefined){return}if(this._isRequesting){}var params={id:entryId};var doPostAction=true;$.ajax({type:"POST",url:url,data:params,beforeSend:function(){GAG.Vote._isRequesting=true;if(typeof okHandler=="function"){okHandler(entryId)}},complete:function(){GAG.Vote._isRequesting=false},success:function(jsonText){var json=GAG.Utils.parseJsonString(jsonText);if(json.id&&json.msg){if(typeof okHandler=="function"){okHandler(entryId)}}else{if(typeof failHandler=="function"){failHandler(entryId)}}},error:function(json){if(typeof failHandler=="function"){failHandler(entryId)}}})},like:function(entryId,okHandler,failHandler){this._submitRequest(this.API.URL_LIKE,entryId,okHandler,failHandler)},unlike:function(entryId,okHandler,failHandler){this._submitRequest(this.API.URL_UNLIKE,entryId,okHandler,failHandler)},dislike:function(entryId,okHandler,failHandler){this._submitRequest(this.API.URL_DISLIKE,entryId,okHandler,failHandler)}});GAG.Track={tuvCookie:"_tuv",tuvCookieMax:100,baseUrl:"http://t.9gag.com",imageUrl:"/img.gif",_entryIDsBuffer:{},init:function(){var elm=GAG.Configs.get("configs.t.domain");if(elm){GAG.Track.baseUrl=elm}},_saveHistory:function(cookieName,historyObj){var jsonStr=historyObj.join(",");$.cookie(cookieName,jsonStr,{expires:10000,path:"/",domain:GAG.Configs.get("page.cookie_domain")})},_checkUnique:function(cookieName,cookieMax,key){if(key.length>32){var key=$.md5(key)}if(GAG.Track._entryIDsBuffer[key]){return false}else{GAG.Track._entryIDsBuffer[key]=1}var historyJsonStr=$.cookie(cookieName);var historyArr=[];if(historyJsonStr){historyArr=historyJsonStr.split(",")}if(historyArr.indexOf(key)==-1){if(historyArr.length>=cookieMax){historyArr.shift()}historyArr.push(key);GAG.Track._saveHistory(cookieName,historyArr);return true}else{return false}return true},uniqueViewed:function(options){var action="unique-viewed";if(typeof options.entry=="undefined"){return}var idsStr=options.entry+""||"";var ids=idsStr.split(",");var uniqueIds=[];for(var i=0;i<ids.length;i++){if(GAG.Track._checkUnique(GAG.Track.tuvCookie,GAG.Track.tuvCookieMax,ids[i])){uniqueIds.push(ids[i])}}if(ids.length>0&&uniqueIds.length>0){options.entry=uniqueIds.join(",");GAG.Track.event(action,"v",options)}},read:function(entryKeys){$.ajax({type:"POST",url:"/read/ids",data:{ids:entryKeys.join(",")},dataType:"json",success:function(json){},error:function(json){}})},markReadInCookie:function(entryKey){GAG.Track._checkUnique("viewed_ids",GAG.Track.tuvCookieMax,entryKey)},event:function(action,value,options){var user=options.user?options.user:GAG.Configs.get("user.id");if(!user){user=""}var params={action:action,value:value,ref:"",label:(typeof options.label==="undefined")?"":options.label,labelValue:(typeof options.labelValue==="undefined")?"":options.labelValue,platform:(typeof options.platform==="undefined")?"":options.platform,entry:(typeof options.entry==="undefined")?"":options.entry,user:user,view:(typeof options.view==="undefined")?"":options.view};params.ref=GAG.Track._getQueryStringParam("ref");var url=GAG.Track._formatUrl(params);var img=new Image();img.src=url},_getUrl:function(){return location.href},_getReferrer:function(){return document.referrer},_getTime:function(){var now=new Date();var nowUTC=new Date(now.getUTCFullYear(),now.getUTCMonth(),now.getUTCDate(),now.getUTCHours(),now.getUTCMinutes(),now.getUTCSeconds());var ts=Math.round((nowUTC).getTime()/1000);return ts},_getQueryStringParam:function(key){var url=window.location.href;var keysValues=url.split(/[\?&]+/);for(var i=0;i<keysValues.length;i++){var keyValue=keysValues[i].split("=");if(keyValue[0]==key){return keyValue[1]}}return""},_formatUrl:function(paramObj){var reqUrl=GAG.Track.baseUrl+GAG.Track.imageUrl;var queryString="";var paramArr=[];if(paramObj){if(paramObj.action!=undefined&&paramObj.action!=null){paramArr.push("a="+encodeURIComponent(paramObj.action))}if(paramObj.value!=undefined&&paramObj.value!=null){paramArr.push("v="+encodeURIComponent(paramObj.value))}if(paramObj.ref!=undefined&&paramObj.ref!=null){paramArr.push("ref="+encodeURIComponent(paramObj.ref))}if(paramObj.label!=undefined&&paramObj.label!=null){paramArr.push("lbl="+encodeURIComponent(paramObj.label))}if(paramObj.labelValue!=undefined&&paramObj.labelValue!=null){paramArr.push("lblv="+encodeURIComponent(paramObj.labelValue))}if(paramObj.platform!=undefined&&paramObj.platform!=null){paramArr.push("p="+encodeURIComponent(paramObj.platform))}if(paramObj.entry!=undefined&&paramObj.entry!=null){paramArr.push("e="+encodeURIComponent(paramObj.entry))}if(paramObj.user!=undefined&&paramObj.user!=null){paramArr.push("u="+encodeURIComponent(paramObj.user))}if(paramObj.view!=undefined&&paramObj.view!=null){paramArr.push("w="+encodeURIComponent(paramObj.view))}}paramArr.push("url="+encodeURIComponent(GAG.Track._getUrl()));paramArr.push("referrer="+encodeURIComponent(GAG.Track._getReferrer()));paramArr.push("t="+encodeURIComponent(GAG.Track._getTime()));for(var i=0;i<paramArr.length;i++){queryString+=paramArr[i]+"&"}reqUrl+="?"+queryString;return reqUrl}};GAG.Toast=(function(){var _self={_toastMsgCookieKey:"toastMsg",init:function(){},getToast:function(){if(!navigator.cookieEnabled){return{}}var toastCode=$.cookie(_self._toastMsgCookieKey);$.cookie(_self._toastMsgCookieKey,null,{domain:GAG.Configs.get("page.cookie_domain"),path:"/"});if(!toastCode){return{}}toastCode=toastCode.split(",");if(toastCode.length==0){return{}}toastCode=toastCode[0];var toastMessage=_self.mapToastCode(toastCode);if(typeof toastMessage!=="undefined"){return toastMessage}return{}},mapToastCode:function(toastCode){var color=_self.COLOR;var text=_self.TEXT;var mapping=_self.MAPPING;var message={SAFE_MODE_DISABLED:{color:color.COLOR_RED,text:text.SAFE_MODE_DISABLED},POST_REMOVED:{color:color.COLOR_YELLOW,text:text.POST_REMOVED},WELCOME_BACK:{color:color.COLOR_YELLOW,text:text.WELCOME_BACK},WELCOME_TO_9GAG:{color:color.COLOR_YELLOW,text:text.WELCOME_TO_9GAG},POST_DELETED:{color:color.COLOR_YELLOW,text:text.POST_DELETED},POST_DISASSOCIATED:{color:color.COLOR_YELLOW,text:text.POST_DISASSOCIATED},PROFILE_SETTING_SAVED:{color:color.COLOR_GREEN,text:text.PROFILE_SETTING_SAVED},PROFILE_SETTING_ERROR:{color:color.COLOR_RED,text:text.PROFILE_SETTING_ERROR},PROFILE_LANGUAGE_CHANGED:{color:color.COLOR_YELLOW,text:text.PROFILE_LANGUAGE_CHANGED},CONTACT_FORM_SENT:{color:color.COLOR_GREEN,text:text.CONTACT_FORM_SENT},CONTACT_FORM_ERROR:{color:color.COLOR_RED,text:text.CONTACT_FORM_ERROR},LOGIN_FAILED:{color:color.COLOR_RED,text:text.LOGIN_FAILED},PRIVACY_SETTING_NOTICE:{color:color.COLOR_YELLOW,text:text.PRIVACY_SETTING_NOTICE},ACCOUNT_DELETED:{color:color.COLOR_YELLOW,text:text.ACCOUNT_DELETED}};if(!typeof mapping[toastCode]!=="undefined"){return message[mapping[toastCode]]}},COLOR:{COLOR_RED:"red",COLOR_YELLOW:"yellow",COLOR_GREEN:"green",COLOR_BLUE:"blue"},TEXT:{SAFE_MODE_DISABLED:"NSFW Posts are shown",POST_REMOVED:"Ooooops! The post you're looking for has been reported by the community and removed.",WELCOME_BACK:"Awww Yeah! Welcome back.",WELCOME_TO_9GAG:"Me Gusta! Welcome to 9GAG, go have fun now!",POST_DELETED:"The post is removed.",POST_DISASSOCIATED:"The post is removed from your profile.",PROFILE_SETTING_SAVED:"Your settings have been saved.",PROFILE_SETTING_ERROR:"Ooooops! There is an error.",PROFILE_LANGUAGE_CHANGED:"Language have been changed.",CONTACT_FORM_SENT:"Your email have been sent.",CONTACT_FORM_ERROR:"Ooooops! There is an error.",LOGIN_FAILED:"Ooooops! There is an error logging in.",PRIVACY_SETTING_NOTICE:"You can now control your profile privacy in settings.",ACCOUNT_DELETED:"Your account has been deleted."},MAPPING:{1:"SAFE_MODE_DISABLED",2:"WELCOME_BACK",3:"POST_REMOVED",4:"WELCOME_TO_9GAG",5:"POST_DELETED",6:"POST_DISASSOCIATED",7:"PROFILE_SETTING_SAVED",8:"PROFILE_SETTING_ERROR",9:"PROFILE_LANGUAGE_CHANGED",10:"CONTACT_FORM_SENT",11:"CONTACT_FORM_ERROR",12:"LOGIN_FAILED",13:"PRIVACY_SETTING_NOTICE",14:"ACCOUNT_DELETED"}};return{init:_self.init,getToast:_self.getToast}})();GAG.CacheFactory=$.extend({},new GAG.Model(),{storageImpl:{},nonPersistentLS:{structureLocalStorage:{},setItem:function(key,value){this.structureLocalStorage[key]=value},getItem:function(key){if(typeof this.structureLocalStorage[key]!="undefined"){return this.structureLocalStorage[key]}else{return null}},removeItem:function(key){this.structureLocalStorage[key]=undefined}},init:function(){var testKey="9gagTestStorage";try{localStorage.setItem(testKey,"");localStorage.removeItem(testKey);this.storageImpl=localStorage}catch(err){GAG.CacheableAbstract.log("Local Storage is not available, use non-persistent storage instead");this.storageImpl=this.nonPersistentLS}}});GAG.CacheableAbstract=$.extend({},new GAG.Model(),{remoteHandler:null,cacheKey:"",cacheTTL:3600,remoteKey:"",init:function(remoteHandler){this.remoteHandler=remoteHandler},get:function(options){return this.getFromCache(options)},formatRemoteParams:function(options){return{}},getFromCache:function(){if(this.cacheKey==""){GAG.CacheableAbstract.log("getFromCache: empty cache key");return null}var value=GAG.CacheFactory.storageImpl.getItem(this.cacheKey);if(value==null){return null}value=JSON.parse(value);if(value.expireAt==undefined){GAG.CacheableAbstract.log("getFromCache: invalid cache. Reason: no expire time.  do clear:"+this.cacheKey);GAG.CacheFactory.storageImpl.removeItem(this.cacheKey);return null}else{if(value.expireAt<this.getCurrentTime()){GAG.CacheableAbstract.log("getFromCache: invalid cache. Reason: expired.  do clear:"+this.cacheKey);GAG.CacheFactory.storageImpl.removeItem(this.cacheKey);return null}else{return value.data}}},addToCache:function(data){return false},removeFromCache:function(data){return false},updateCache:function(data){if(this.cacheKey==""){GAG.CacheableAbstract.log("updateCache: empty cache key");return false}var obj={};obj.data=data;obj.expireAt=this.cacheTTL+this.getCurrentTime();GAG.CacheFactory.storageImpl.setItem(this.cacheKey,JSON.stringify(obj));return true},clearCache:function(){if(this.cacheKey==""){GAG.CacheableAbstract.log("clearCache: empty cache key");return null}GAG.CacheFactory.storageImpl.removeItem(this.cacheKey);return true},getCurrentTime:function(){return Math.floor(Date.now()/1000)},log:function(){}});GAG.CacheableRemoteHandler=$.extend({},new GAG.Model(),{remoteUrl:"/cacheable",queue:[],graceCookieKey:"cacheableGrace",addToQueue:function(item,callback){this.queue.push({params:item,callback:callback})},processQueue:function(){var self=this;if(this.queue.length==0){GAG.CacheableAbstract.log("Skip call remoteUrl. Reason: empty queue");return}if(!GAG.CacheableRemoteHandler.issetPhpSessionId()||GAG.CacheableRemoteHandler.isInGracePeriod()){if(!GAG.CacheableRemoteHandler.issetPhpSessionId()){GAG.CacheableAbstract.log("GAG.CacheableRemoteHandler php session id is not set. Bye!!")}if(GAG.CacheableRemoteHandler.isInGracePeriod()){GAG.CacheableAbstract.log("GAG.CacheableRemoteHandler is in grace period. Bye!!")}return}else{GAG.CacheableAbstract.log("calling cacheable")}var data=[];var callbacks=[];$.each(this.queue,function(i,obj){data[i]=obj.params;callbacks[i]=obj.callback});$.ajax({url:self.remoteUrl,type:"POST",dataType:"json",data:{json:JSON.stringify(data)},success:function(json){$.each(callbacks,function(i,callback){callback(json)})},complete:function(){$.each(callbacks,function(i,callback){callback(data)})}});this.queue=[]},isInGracePeriod:function(){return $.cookie(GAG.CacheableRemoteHandler.graceCookieKey)},issetPhpSessionId:function(){return $.cookie("PHPSESSID")}});GAG.CacheableVote=$.extend({},GAG.CacheableAbstract,{cacheKey:"cacheableVote",cacheTTL:1800,formatRemoteParams:function(options){return{action:"vote",params:{}}},get:function(){var value=this.getFromCache();if(value===null){return value}return value},addToCache:function(data){var value=this.getFromCache();if(value===null){value={}}$.each(data,function(entryKey,score){value[entryKey]=score});return this.updateCache(value)},removeFromCache:function(data){return false}});GAG.CacheableUser=$.extend({},GAG.CacheableAbstract,{cacheKey:"cacheableUser",cacheTTL:1800,formatRemoteParams:function(options){return{action:"user",params:{}}},get:function(){var value=this.getFromCache();if(value===null){return value}return value},addToCache:function(data){return false},removeFromCache:function(data){return false}});GAG.CacheableUserPreference=$.extend({},GAG.CacheableAbstract,{cacheKey:"cacheableUserPreference",cacheTTL:1800,formatRemoteParams:function(options){return{action:"user-preference",params:{}}},get:function(){return this.getFromCache()},addToCache:function(data){return false},removeFromCache:function(data){return false}});GAG.CacheableUserUpload=$.extend({},GAG.CacheableAbstract,{cacheKey:"cacheableUserUpload",cacheTTL:1800,formatRemoteParams:function(options){return{action:"user-upload",params:{}}},get:function(){return this.getFromCache()},addToCache:function(data){return false},removeFromCache:function(data){return false}});GAG.CacheableUserQuota=$.extend({},GAG.CacheableAbstract,{cacheKey:"cacheableUserQuota",cacheTTL:1800,formatRemoteParams:function(options){return{action:"user-quota",params:{}}},get:function(){return this.getFromCache()},addToCache:function(data){return false},removeFromCache:function(data){return false}});GAG.Controller=function(){this._base=this};GAG.Controller.prototype=new GAG.BaseObject();GAG.Controller.prototype.getBase=function(){return this._base};GAG.Controller.prototype.init=function(){};GAG.Controller.prototype.onLoad=function(){};GAG.Controller.prototype.onResize=function(){};GAG.Controller.prototype.onScroll=function(){};GAG.Controller.prototype.onDomReady=function(){};GAG.CacheController=$.extend({},new GAG.Controller(),{_dataMap:{},_updateQueue:[],_entryUpdateQueue:[],init:function(){this._dataMap.entryInfo={}},keys:{ENTRY_LIST:"entryList",ENTRY_INFO:"entryInfo",FEATURED_LIST:"featuredList",FEATURED_INFO:"featuredInfo",},getValue:function(cacheKey){return this._dataMap[cacheKey]},setValue:function(cacheKey,value){this._dataMap[cacheKey]=value},invalidate:function(cacheKey){delete this._dataMap[cacheKey]},reset:function(){this._dataMap={}},notifyForCacheUpdate:function(cacheKey){this._updateQueue.push(cacheKey)},isUpdateNeeded:function(cacheKey){return($.inArray(cacheKey,this._updateQueue)>=0)},notifyForCacheUpdateCompleted:function(cacheKey){var index=$.inArray(cacheKey,this._updateQueue);if(index>=0){this._updateQueue.splice(index,1)}},setList:function(value,list){if(value instanceof Array){this._dataMap[list]=value}},getList:function(list){if(!this._dataMap[list]){this._dataMap[list]=[]}return this._dataMap[list]},addItemsToList:function(items,list){for(var i=0;i<items.length;i++){if($.inArray(items[i],this.getList(list))===false){this.getList(list).push(items[i])}}},setItemInfoForList:function(itemId,itemInfo,list){this.getList(list)[itemId]=itemInfo},getItemInfoForList:function(itemId,list){if(!this.getList(list)){this.getList(list)[itemId]={}}return this.getList(list)[itemId]},getItemInfoForKeyInList:function(itemId,key,list){if(this.getItemInfoForList(itemId,list)){return this.getItemInfoForList(itemId,list)[key]}else{return null}},handlers:{getEntryInfoFromDOM:function(container){var entryInfo={offset:$(container).offset(),height:$(container).height(),outerHeight:$(container).outerHeight(),};return entryInfo},getFeaturedItemInfoFromDOM:function(container){var itemInfo={top:$(container).offset().top,height:$(container).height(),};return itemInfo},featuredItemHandler:{setFeaturedList:function(value){var self=GAG.CacheController;self.setList(value,self.keys.FEATURED_LIST)},getFeaturedList:function(){var self=GAG.CacheController;return self.getList(self.keys.FEATURED_LIST)},addFeaturedItemsToList:function(items){var self=GAG.CacheController;self.addItemsToList(items,self.keys.FEATURED_LIST)},setFeaturedItemInfo:function(itemId,itemInfo){var self=GAG.CacheController;self.setItemInfoForList(itemId,itemInfo,self.keys.FEATURED_INFO)},getFeaturedItemInfo:function(itemId){var self=GAG.CacheController;return self.getItemInfoForList(itemId,self.keys.FEATURED_INFO)},getFeaturedItemInfoForKey:function(itemId,key){var self=GAG.CacheController;return self.getItemInfoForKeyInList(itemId,key,self.keys.FEATURED_INFO)},},entryHandler:{_self:GAG.CacheController,setEntryList:function(value){var self=GAG.CacheController;self.setList(value,self.keys.ENTRY_LIST)},getEntryList:function(){var self=GAG.CacheController;return self.getList(self.keys.ENTRY_LIST)},addEntriesToList:function(entries){var self=GAG.CacheController;self.addItemsToList(entries,self.keys.ENTRY_LIST)},setEntryInfo:function(entryId,entryInfo){var self=GAG.CacheController;self.setItemInfoForList(entryId,entryInfo,self.keys.ENTRY_INFO)},getEntryInfo:function(entryId){var self=GAG.CacheController;return self.getItemInfoForList(entryId,self.keys.ENTRY_INFO)},getEntryInfoForKey:function(entryId,key){var self=GAG.CacheController;return self.getItemInfoForKeyInList(entryId,key,self.keys.ENTRY_INFO)},},},getFeaturedItemHandler:function(){var self=GAG.CacheController;return self.handlers.featuredItemHandler},getEntryHandler:function(){var self=GAG.CacheController;return self.handlers.entryHandler},parseEntryInfo:function(){var self=GAG.CacheController;var entryAry=[];$(GAG.ListController.selectors.ENTRY_CONTAINER).each(function(){var entryId=$(this).data("entry-id");entryAry.push(entryId);var entryInfo=self.handlers.getEntryInfoFromDOM($(this));self.handlers.entryHandler.setEntryInfo(entryId,entryInfo)});self.handlers.entryHandler.setEntryList(entryAry)},updateEntryInfoForEntryIds:function(entryIds){for(var i=0;i<entryIds.length;i++){var container=$("#jsid-entry-entity-"+entryIds[i]);if(container&&container.length==1){this.handlers.getEntryInfoFromDOM(container)}}},});GAG.AdsController=$.extend({},new GAG.Controller(),{_ADS_TAG_HTML:"",_mode:"",_modeAvailable:["","nsfw"],_postSeries:0,_googleTags:{"list-featured-sidebar-300x250":{id:"div-gpt-ad-1386120113080-0",width:300,height:250,tag:"/16921351/9gag-list-featured-sidebar-300x250"},"list-instream-300x250":{id:"div-gpt-ad-1386120113080-1",width:300,height:250,tag:"/16921351/list-instream-300x250"},"list-sidebar1-300x250-atf":{id:"div-gpt-ad-1386120113080-2",width:300,height:250,tag:"/16921351/9gag-list-sidebar1-300x250-atf"},"list-sidebar2-300x250-sticky":{id:"div-gpt-ad-1386120113080-3",width:300,height:250,tag:"/16921351/9gag-list-sidebar2-300x250-sticky"},"nsfw-list-featured-sidebar-300x250":{id:"div-gpt-ad-1386120474498-0",width:300,height:250,tag:"/16921351/9gag-nsfw-list-featured-sidebar-300x250"},"nsfw-list-instream-300x250":{id:"div-gpt-ad-1386120474498-1",width:300,height:250,tag:"/16921351/9gag-nsfw-list-instream-300x250"},"nsfw-list-sidebar1-300x250-atf":{id:"div-gpt-ad-1386120474498-2",width:300,height:250,tag:"/16921351/9gag-nsfw-list-sidebar1-300x250-atf"},"nsfw-list-sidebar2-300x250-sticky":{id:"div-gpt-ad-1386120474498-3",width:300,height:250,tag:"/16921351/9gag-nsfw-list-sidebar2-300x250-sticky"},"post-featured-sidebar-300x250":{id:"div-gpt-ad-1386120438705-0",width:300,height:250,tag:"/16921351/9gag-post-featured-sidebar-300x250"},"post-footer-728x90":{id:"div-gpt-ad-1386120438705-1",width:728,height:90,tag:"/16921351/9gag-post-footer-728x90"},"post-sidebar1-300x250-atf":{id:"div-gpt-ad-1386120438705-2",width:300,height:250,tag:"/16921351/9gag-post-sidebar1-300x250-atf"},"post-sidebar2-300x250-btf":{id:"div-gpt-ad-1386120438705-3",width:300,height:250,tag:"/16921351/9gag-post-sidebar2-300x250-btf"},"post-leaderboard-728x90-atf":{id:"div-gpt-ad-1403086688513-0",width:728,height:90,tag:"/16921351/9gag-post-leaderboard-728x90-atf"},"nsfw-post-featured-sidebar-300x250":{id:"div-gpt-ad-1386120515685-0",width:300,height:250,tag:"/16921351/9gag-nsfw-post-featured-sidebar-300x250"},"nsfw-post-footer-728x90":{id:"div-gpt-ad-1386120515685-1",width:728,height:90,tag:"/16921351/9gag-nsfw-post-footer-728x90"},"nsfw-post-sidebar1-300x250-atf":{id:"div-gpt-ad-1386120515685-2",width:300,height:250,tag:"/16921351/9gag-nsfw-post-sidebar1-300x250-atf"},"nsfw-post-sidebar2-300x250-btf":{id:"div-gpt-ad-1386120515685-3",width:300,height:250,tag:"/16921351/9gag-nsfw-post-sidebar2-300x250-btf"},"nsfw-leaderboard-728x90-atf":{id:"div-gpt-ad-1403086688513-0",width:728,height:90,tag:"/16921351/9gag-nsfw-post-leaderboard-728x90-atf"},"9gaghouse-post-featured-sidebar-300x250":{id:"div-gpt-ad-1410317119151-0",width:300,height:250,tag:"/16921351/9gaghouse-post-featured-sidebar-300x250"},"9gaghouse-post-footer-728x90":{id:"div-gpt-ad-1410317119151-1",width:728,height:90,tag:"/16921351/9gaghouse-post-footer-728x90"},"9gaghouse-post-leaderboard-728x90-atf":{id:"div-gpt-ad-1410317119151-2",width:728,height:90,tag:"/16921351/9gaghouse-post-leaderboard-728x90-atf"},"9gaghouse-post-sidebar1-300x250-atf":{id:"div-gpt-ad-1410317119151-3",width:300,height:250,tag:"/16921351/9gaghouse-post-sidebar1-300x250-atf"},"9gaghouse-post-sidebar2-300x250-btf":{id:"div-gpt-ad-1410317119151-4",width:300,height:250,tag:"/16921351/9gaghouse-post-sidebar2-300x250-btf"},"m.9gag-adx-top10-list-300x250":{id:"div-gpt-ad-1365732552334-0",width:300,height:250,tag:"/16921351/m.9gag-adx-top10-list-300x250"},"cosplay-list-featured-sidebar-300x250":{id:"div-gpt-ad-1401866442620-0",width:300,height:250,tag:"/16921351/9gag-cosplay-list-featured-sidebar-300x250"},"cosplay-list-sidebar1-300x250-atf":{id:"div-gpt-ad-1401866442620-1",width:300,height:250,tag:"/16921351/9gag-cosplay-list-sidebar1-300x250-atf"},"cosplay-list-sidebar2-300x250-sticky":{id:"div-gpt-ad-1401866442620-2",width:300,height:250,tag:"/16921351/9gag-cosplay-list-sidebar2-300x250-sticky"}},init:function(){var initModeTag=$("#gag-ads-init-mode");if(initModeTag.length>0){this._mode=initModeTag.data("mode");initModeTag.remove()}this.renderAllAds()},selectors:{ADS_CONTAINER:".badge-gag-ads-container",ADS_DATA_TAG:"gag-ads"},handlers:{renderAds:function(selectors,noReRender){var self=GAG.AdsController;$(selectors+" "+self.selectors.ADS_CONTAINER).each(function(){var adsTag=$(this).data(self.selectors.ADS_DATA_TAG);if(noReRender&&$(this).html().length>0){return}if(self._googleTags[adsTag]==undefined){console.log("undefined ads:"+adsTag);return}var ads=self._googleTags[adsTag];if(adsTag&&adsTag.length>0){var slotName=self.handlers.generateUniqueDivId(ads);$(this).html('<div id="'+slotName+'" ></div>');self.handlers.pushGoogleTag(ads,slotName)}})},generateUniqueDivId:function(ads){var self=GAG.AdsController;var divId=ads.id+"-"+Math.floor((Math.random()*100000));if($("#"+divId).length){return self.handlers.generateUniqueDivId(ads)}return divId},pushGoogleTag:function(ads,slotName){var self=GAG.AdsController;googletag.cmd.push(function(){googletag.pubads().disableInitialLoad();var slot=googletag.defineSlot(ads.tag,[ads.width,ads.height],slotName).addService(googletag.pubads());googletag.display(slotName);googletag.pubads().refresh([slot])})}},getMode:function(){var self=GAG.AdsController;return self._mode},setMode:function(mode){var self=GAG.AdsController;if(self._modeAvailable.indexOf(mode)>=0&&self._mode!=mode){self._mode=mode;self.renderAllAds()}},renderAllAds:function(){var self=GAG.AdsController;self.handlers.renderAds("")},notifyForAdsUpdate:function(containerSelector){var self=GAG.AdsController;self.handlers.renderAds(containerSelector)},notifyForAdsInsert:function(containerSelector){var self=GAG.AdsController;self.handlers.renderAds(containerSelector,true)},});GAG.FacebookController=$.extend({},new GAG.Controller(),(function(){var _self={BADGE_FACEBOOK_RENDER:".badge_facebook_render",FB_RENDER_PREFIX:"jsid-fb-render",_pushFbElementsToQueue:function(){$(_self.BADGE_FACEBOOK_RENDER).each(function(index,item){var domId=$(item).attr("id");if(!domId){domId=GAG.PageController.getUniqueDomId(GAG.FacebookController.FB_RENDER_PREFIX);$(item).attr("id",domId)}GAG.Facebook.renderElement(domId)})},_bindAddToTimelineButtons:function(){$(".badge-add-fb-timeline").on("click",function(e){e.preventDefault();var turnOff=$(this).hasClass("switch_on");if(turnOff){GAG.FacebookController.enableFbTimelineAck(false);return}var perm="email,publish_actions";try{FB.login(function(response){var granted=response.authResponse?true:false;GAG.FacebookController.enableFbTimelineAck(granted)},{scope:perm})}catch(e){}})}};return{init:function(){_self._pushFbElementsToQueue();_self._bindAddToTimelineButtons()},enableFbTimelineAck:function(enable){var apiUrl="/member/facebook-timeline";var params={on:enable?"on":"off",platform:"facebook"};if(!enable){apiUrl="/connect/unlink"}$.ajax({type:"POST",dataType:"json",url:apiUrl,data:params,success:function(json){window.location.reload()}})}}})());GAG.FeaturedController=$.extend({},new GAG.Controller(),{_isLoading:false,_isLoadingHidden:false,_page:1,_hiddenItemData:{},_noMoreItem:false,_currentPosition:0,_endPoint:"",_cacheKey:"featured",_cacheExpireKey:"featured_expire",_cacheFeaturedMaxItemCount:300,_pageOneExpired:false,_cacheTtl:900,_lastInsertIsAd:false,_dataResult:[],init:function(){this._endPoint=GAG.Configs.get("configs.endPoint");this._endPoint=GAG.Utils.formatProtocolForUrl(this._endPoint);this.bindScrollEvents();this.bindClickEvents();$.proxy(this.handlers.loadMoreScrollHandler,this)()},selectors:{SIDEBAR_CONTAINER:"#sidebar-content",SIDEBAR_ITEMS:".badge-featured-item",SIDEBAR_ITEM_PREFIX:"#featured-item-",ITEM_CONTAINER:"#jsid-featured-item-container",FEATURED_AD:"#jsid-featured-sidebar-ad",DIV_GET_THE_APP:".get-the-app",LOADING_DIALOG:"#block-feature-cover .loading",SIDEBAR_FOOTER:"#sidebar .footer",POST_ENTRY_INFO:".badge-entry-info",MAIN_WRAPPER:".main-wrap",FEATURED_TAIL:"#jsid-featured-sidebar-tail",LOADING_SPINNER:".block-feature-cover .loading",},handlers:{windowScrollHandler:function(){$.proxy(this.handlers.loadMoreScrollHandler,this)()},resetSidebarToTop:function(){var self=GAG.FeaturedController;var sidebarContainer=$(self.selectors.SIDEBAR_CONTAINER);sidebarContainer.removeClass("sticky");sidebarContainer.css({position:"",top:""})},loadMoreScrollHandler:function(){if($(GAG.FeaturedController.selectors.ITEM_CONTAINER).length>0){var self=GAG.FeaturedController;var winH=$(window).height()-GAG.PageController._topStickyElementHeight;var screenTop=GAG.PageController.getWindowEffectiveScrollTop();var screenBottom=screenTop+winH;var sidebarContainer=$(self.selectors.SIDEBAR_CONTAINER);var posContainer=sidebarContainer.offset().top+sidebarContainer.height();var pixelToLoadMore=posContainer-screenBottom;var sidebarTail=$(self.selectors.FEATURED_TAIL);var sidebarTailPadding=30;var sidebarTailHeight=+sidebarTail.height()-sidebarTailPadding;var stickyStart=$(".badge-page").offset().top+sidebarContainer.height()-sidebarTailHeight-(!GAG.Page.isPostPage()?GAG.PageController._topStickyElementHeight:0);var stickyEnd=$(".badge-page").offset().top+$(".badge-page").height()+(winH-sidebarTailHeight);var mainWrapperHeight=$(self.selectors.MAIN_WRAPPER).height();var conditionSticky=mainWrapperHeight>sidebarContainer.height()&&winH<sidebarContainer.height()&&GAG.FeaturedController._noMoreItem&&!sidebarContainer.hasClass("sticky");if(screenTop>=stickyStart&&screenBottom<=stickyEnd&&conditionSticky){sidebarContainer.css({position:"fixed",top:(-stickyStart+(GAG.Page.isPostPage()?46:49)+$(".badge-page").offset().top)+"px",width:"inherit"});sidebarContainer.addClass("sticky");if(!GAG.PageController._tickerBeenStickied){GAG.GA.track("ticker","stickied","sidebar");GAG.PageController._tickerBeenStickied=true}}else{if(screenTop<stickyStart&&sidebarContainer.hasClass("sticky")){self.handlers.resetSidebarToTop();GAG.CacheController.notifyForCacheUpdate(GAG.CacheController.keys.FEATURED_LIST)}else{if(screenBottom>stickyEnd&&sidebarContainer.hasClass("sticky")){sidebarContainer.css({position:"absolute",top:($(".badge-page").offset().top+$(".badge-page").height()-sidebarContainer.height()-90)+"px",width:"inherit"});sidebarContainer.removeClass("sticky")}}}if(pixelToLoadMore<winH*3){GAG.FeaturedController.loadMorePosts()}}},loadMoreAjaxCallbackHandler:function(data){if(!data||!data.okay){return}var self=GAG.FeaturedController;var clickedItemIds=self.getClickedItemIds();if(!data.result||data.result.length==0){if(!data.areHiddenItems&&!self._isLoadingHidden){var sortedHiddenItemData=[];for(i=0;i<clickedItemIds.length;i++){if(self._hiddenItemData[clickedItemIds[i]]){sortedHiddenItemData.push(self._hiddenItemData[clickedItemIds[i]])}}var hiddenItemDataObj={okay:true,result:sortedHiddenItemData,areHiddenItems:true};self._isLoadingHidden=true;self.handlers.loadMoreAjaxCallbackHandler(hiddenItemDataObj)}self._noMoreItem=true}var container=$(self.selectors.ITEM_CONTAINER);var loadMoreTrigger=container.data("load-more-trigger");var itemDisplayed=container.data("item-displayed");var noOfLoadMore=itemDisplayed/loadMoreTrigger;var adsPosition=container.data("ads-position")+"";var adsPositionAry=new Array();adsPositionAry=adsPosition.split(",");var adsPositionsAry=new Array();adsPositionAry.forEach(function(index){for(i=0;i<noOfLoadMore;i++){adsPositionsAry.push((parseInt(index)+parseInt(loadMoreTrigger)*i)+"")}});var adsTag=container.data("ads-tag");var postType=container.data("list-key");var adTemplate='<section class="badge-block-ad block-ad">                <div class="badge-gag-ads-container img-container" data-gag-ads="'+adsTag+'"></div>            </section>';var adsAdded=0;var totalHTML="";for(var i=0;i<data.result.length;i++){var item=data.result[i];if($.inArray(self._currentPosition+"",adsPositionsAry)>=0){if(!self._lastInsertIsAd){totalHTML+=adTemplate;adsAdded++;self._lastInsertIsAd=true}}var template='<li class="badge-featured-item" data-item-id="'+item.itemId+'" id="featured-item-'+item.itemId+'">                    <div class="img-container" data-item-id="'+item.itemId+'">                        <a href="'+item.url+'?ref=fsidebar" class="badge-evt" target="_blank" data-evt="Featured-Sidebar,'+postType+"ImageClicked,"+item.url+'">                        <img src="'+item.imageURL+'" /></a>                    </div>                    <div class="info-container" data-item-id="'+item.itemId+'">                        <h3><a href="'+item.url+'?ref=fsidebar" class="badge-evt" target="_blank" data-evt="Featured-Sidebar,'+postType+"TitleClicked,"+item.url+'">'+item.title+"</a></h3>                    </div>                </li>";if($("#featured-item-"+item.itemId).length==0){if(GAG.Page.isPostPage()&&item.url.indexOf(GAG.PostController._fastCurrentEntryKey)>-1){self.appendClickedItemId(parseInt(item.itemId))}else{if((data.areHiddenItems)||($.inArray(parseInt(item.itemId),clickedItemIds)==-1)){totalHTML+=template;self._currentPosition++;self._lastInsertIsAd=false}else{self._hiddenItemData[item.itemId]=item}}}}if(totalHTML.length>0){container.append(totalHTML)}if(adsAdded>0){container.ready(function(){GAG.AdsController.notifyForAdsInsert(self.selectors.SIDEBAR_CONTAINER)})}GAG.CacheController.notifyForCacheUpdate(GAG.CacheController.keys.FEATURED_LIST);self._page++;self._isLoading=false;$.proxy(self.handlers.loadMoreScrollHandler(),self)}},loadMorePosts:function(){var self=GAG.FeaturedController;if(self._isLoading||self._noMoreItem){return}self._isLoading=true;var container=$(self.selectors.ITEM_CONTAINER);var loadMoreTrigger=(+container.data("load-more-trigger"));if((self._page>1)&&(self._dataResult.length>0)){var sliceResult=self._dataResult.slice((self._page-1)*loadMoreTrigger,self._page*loadMoreTrigger);$.proxy(self.handlers.loadMoreAjaxCallbackHandler.call(self,{okay:true,result:sliceResult}),self);return}var listKey=container.data("list-key");var url=self._endPoint+"/read/ajax-featured?pageType="+listKey;if(!window.sessionStorage||!sessionStorage.getItem(url)||self._pageOneExpired||(self._page==1&&self.isCacheExpired(listKey))){$(self.selectors.LOADING_SPINNER).removeClass("hide");$.ajax({type:"GET",crossDomain:true,dataType:"jsonp",jsonpCallback:"data",cache:"true",url:self._endPoint+"/read/ajax-featured?pageType="+listKey,success:function(data){$(self.selectors.LOADING_SPINNER).addClass("hide");if(window.sessionStorage){if(self._page==1){self.checkAndUpdateCacheExpireTime(listKey);self._pageOneExpired=true}sessionStorage.setItem(url,JSON.stringify(data))}if(data&&data.okay&&data.result&&(data.result.length>0)){self._dataResult=data.result;data.result=data.result.slice((self._page-1)*loadMoreTrigger,self._page*loadMoreTrigger)}$.proxy(self.handlers.loadMoreAjaxCallbackHandler.call(self,data),self)},error:function(){self._noMoreItem=true;self._isLoading=false;$(self.selectors.LOADING_SPINNER).addClass("hide")}})}else{var data=JSON.parse(sessionStorage.getItem(url));self._dataResult=data.result;data.result=data.result.slice((self._page-1)*loadMoreTrigger,self._page*loadMoreTrigger);$.proxy(self.handlers.loadMoreAjaxCallbackHandler.call(self,data),self)}},getCacheExpireTimes:function(){var expireTimes={};if(sessionStorage.getItem(GAG.FeaturedController._cacheExpireKey)){expireTimes=JSON.parse(sessionStorage.getItem(GAG.FeaturedController._cacheExpireKey))}return expireTimes?expireTimes:{}},setCacheExpireTime:function(listKey,expire){var self=GAG.FeaturedController;var expireTimes=self.getCacheExpireTimes();expireTimes[listKey]=expire;sessionStorage.setItem(GAG.FeaturedController._cacheExpireKey,JSON.stringify(expireTimes))},checkAndUpdateCacheExpireTime:function(listKey){var self=GAG.FeaturedController;if(self.isCacheExpired(listKey)){self.setCacheExpireTime(listKey,$.now()+self._cacheTtl*1000)}},isCacheExpired:function(listKey){var self=GAG.FeaturedController;var expireTimes=self.getCacheExpireTimes();var expired=true;if(expireTimes[listKey]>$.now()){expired=false}return expired},appendClickedItemId:function(itemId){var itemIds=GAG.FeaturedController.getClickedItemIds();if(itemIds){var idx=$.inArray(itemId,itemIds);if(idx==-1){itemIds.push(itemId)}else{itemIds.splice(idx,1);itemIds.push(itemId)}if(itemIds.length>GAG.FeaturedController._cacheFeaturedMaxItemCount){itemIds=itemIds.slice(itemIds.length-GAG.FeaturedController._cacheFeaturedMaxItemCount)}}else{var itemIds=[];itemIds.push(itemId)}GAG.CacheFactory.storageImpl.setItem(GAG.FeaturedController._cacheKey,JSON.stringify(itemIds))},getClickedItemIds:function(){var data=GAG.CacheFactory.storageImpl.getItem(GAG.FeaturedController._cacheKey);var itemIds=JSON.parse(data);return itemIds?itemIds:[]},bindScrollEvents:function(){$(window).on("scroll resize",null,null,$.proxy(this.handlers.windowScrollHandler,this))},bindClickEvents:function(){$("#jsid-featured-item-container").on("click",".badge-featured-item",function(e){var itemId=$(this).data("itemId");GAG.FeaturedController.appendClickedItemId(itemId)})}});GAG.GPlusController=$.extend({},new GAG.Controller(),{init:function(){this._bindElements();this._bindSocialTransfer()},_bindProfile:function(authResult){if(!GAG.GPlus.btnClicked){return}if(authResult.access_token){var code=authResult.code;var params={platform:"google-plus"};if(code){params.code=code}$.ajax({url:"/connect/social",type:"POST",dataType:"json",data:params,success:function(json){window.location.reload()},error:function(json){console.log(json)}})}},_bindSocialTransfer:function(){var transferForm=$("#social-transfer form");if(transferForm.length==0){return}GAG.GPlus.renderButton("jsid-confirm-transfer",function(authResult){if(!GAG.GPlus.btnClicked){return}if(authResult.access_token){$("input[name=code]",transferForm).val(authResult.code);transferForm.submit()}else{window.location.reload()}})},_doLogin:function(authResult){if(!GAG.GPlus.btnClicked){return}if(authResult.access_token){var code=authResult.code;var url="https://"+GAG.Page.getDomain()+"/connect/google-plus-callback?code="+encodeURIComponent(code);window.location.href=url}},_bindElements:function(){GAG.GPlus.renderButton("jsid-gplus-btn-settings",this._bindProfile);$(".badge-gplus-connect").each(function(index,item){var btn=$(item);var domId=btn.attr("id");if(!domId){domId=GAG.PageController.getUniqueDomId("gplus");btn.attr("id",domId)}GAG.GPlus.renderButton(domId,GAG.GPlusController._doLogin)})}});GAG.ShareController=$.extend({},new GAG.Controller(),(function(){var _self={selectors:{CLICK_EVENT_SELECTOR_DELEGATE:"#container"},_openFacebookShareDialog:function(e){e.preventDefault();e.stopPropagation();var btn=$(this);var entryUrl=btn.attr("data-share");var url="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(entryUrl);_self._openWindow(url)},_openTwitterShareDialog:function(e){e.preventDefault();e.stopPropagation();var btn=$(this);var entryUrl=btn.attr("data-share");var label=btn.attr("data-title");var url="https://twitter.com/intent/tweet?via=9GAG&source=tweetbutton&original_referer="+encodeURIComponent(entryUrl)+"&text="+label+"&url="+encodeURIComponent(entryUrl);_self._openWindow(url)},_openGPlusShareDialog:function(e){e.preventDefault();var btn=$(this);var entryUrl=btn.attr("data-share");var label=btn.attr("data-title");var url="https://plus.google.com/share?url="+encodeURIComponent(entryUrl);_self._openWindow(url)},_openPinterestShareDialog:function(e){e.preventDefault();var btn=$(this);var entryUrl=btn.attr("data-share");var imageUrl=btn.attr("data-img");var label=btn.attr("data-title");var url="//pinterest.com/pin/create/button/?url="+encodeURIComponent(entryUrl)+"&media="+encodeURIComponent(imageUrl)+"&description="+label;_self._openWindow(url)},_openWindow:function(url){var w=640;var h=460;var sTop=window.screen.height/2-(h/2);var sLeft=window.screen.width/2-(w/2);var sharer=window.open(url,"Share","status=1,height="+h+",width="+w+",top="+sTop+",left="+sLeft+",resizable=0")},_bindElements:function(){$(_self.selectors.CLICK_EVENT_SELECTOR_DELEGATE).on("click",".badge-facebook-share",_self._openFacebookShareDialog);$(_self.selectors.CLICK_EVENT_SELECTOR_DELEGATE).on("click",".badge-twitter-share",_self._openTwitterShareDialog);$(_self.selectors.CLICK_EVENT_SELECTOR_DELEGATE).on("click",".badge-gplus-share",_self._openGPlusShareDialog);$(_self.selectors.CLICK_EVENT_SELECTOR_DELEGATE).on("click",".badge-pinterest-share",_self._openPinterestShareDialog)}};return{init:function(){_self._bindElements()}}})());GAG.HeadbarController=$.extend({},new GAG.Controller(),(function(){var _self={_bindElements:function(){_self._bindSearchIcon()},_bindSearchIcon:function(){var searchIcon=$("#jsid-search-icon");searchIcon.on("click",function(e){e.preventDefault();_self._toggleSearchBar()})},SLIDE_DURATION:300,_toggleSearchBar:function(){var searchBar=$("#header_searchbar");searchBar.slideToggle(_self.SLIDE_DURATION)}};return{init:function(){_self._bindElements();var navWrapper=$(".nav-wrap");var header=navWrapper.find("h1");var headerItems=navWrapper.find(".headbar-items");var moreButton=headerItems.find("#jsid-header-funny-menu").parent();var moreMenu=$("#jsid-header-funny-menu-items");var leftOffset=header.width()+headerItems.width()-moreButton.width();moreMenu.css("margin-left",leftOffset+"px");moreMenu.css("left","0")}}})());GAG.ListController=$.extend({},new GAG.Controller(),{_scrollDuration:100,_focusMinimumInViewPortion:150,_entryReadTimeout:800,_playGifTimeout:50,_scrollFaultTolerance:20,_lastScrolledTop:-500,_scrollAutoPlayGifTimeoutObject:false,_scrollAutoPlayGifRatio:0.6,selectors:{LIST_VIEW:".badge-list-view-element",ENTRY_CONTAINER:".badge-entry-container",IN_VIEW_ELEMENTS:".badge-in-view",IN_FOCUS_ELEMENTS:".badge-in-view-focus",IN_VIEW_CLASS:"badge-in-view",IN_FOCUS_CLASS:"badge-in-view-focus",ENTRY_CONTAINER_ID_PREFIX:"#jsid-entry-entity-",},customEvents:{IN_FOCUS_SET:"inViewFocusSet",IN_FOCUS_UNSET:"inViewFocusUnset",ENTRY_READ:"entryRead"},init:function(){this.bindElements();$.proxy(this.handlers.listViewScrollHandler,this)()},bindElements:function(){this.bindInViewTrackerEvents();this._bindViewHistoryTrackingEvents()},handlers:{recalculateInViewEntries:function(){var self=GAG.ListController;var scrollTop=GAG.PageController.getWindowEffectiveScrollTop();var scrollBottom=scrollTop+$(window).height();self._lastScrolledTop=scrollTop;var cache=GAG.CacheController;var entryCacheHandler=cache.getEntryHandler();var entryList=entryCacheHandler.getEntryList();if(!entryList||entryList.length==0||cache.isUpdateNeeded(cache.keys.ENTRY_LIST)){cache.parseEntryInfo();entryList=entryCacheHandler.getEntryList()}var inViewEntries=[];var inFocusViewEntries=[];for(var i=0;i<entryList.length;i++){var entryId=entryList[i];var top=entryCacheHandler.getEntryInfoForKey(entryId,"offset").top-GAG.PageController._topStickyElementHeight;var height=entryCacheHandler.getEntryInfoForKey(entryId,"outerHeight");if(top<scrollBottom&&top+height>scrollTop){inViewEntries.push(entryId);if(top+height>=scrollTop+self._focusMinimumInViewPortion&&top+self._focusMinimumInViewPortion<=scrollBottom){inFocusViewEntries.push(entryId)}}}self._updateEntriesInView(inViewEntries);self._updateEntriesInViewFocus(inFocusViewEntries);if(!GAG.Page.isPostPage()&&(GAG.PageController.getScrollAutoPlayMp4State()>0)){self.scrollAutoPlayGifHandler(inFocusViewEntries)}},listViewScrollHandler:function(event){var self=this;var scrollTop=GAG.PageController.getWindowEffectiveScrollTop();if(Math.abs(scrollTop-self._lastScrolledTop)>200){self.handlers.recalculateInViewEntries()}},},bindInViewTrackerEvents:function(){$(window).on("scroll resize",null,null,$.proxy(this.handlers.listViewScrollHandler,this));$("body").on(this.customEvents.IN_FOCUS_SET,this.selectors.ENTRY_CONTAINER,null,$.proxy(function(e){var entry=$(e.target);var timeout=setTimeout($.proxy(function(){$(entry).trigger($.Event(this.customEvents.ENTRY_READ))},this),this._entryReadTimeout);$(entry).data("entry-read-timeout-object",timeout)},this));$("body").on(this.customEvents.IN_FOCUS_UNSET,this.selectors.ENTRY_CONTAINER,null,$.proxy(function(e){var entry=$(e.target);clearTimeout($(entry).data("entry-read-timeout-object"))},this))},scrollAutoPlayGifHandler:function(entryIds){if(this._scrollAutoPlayGifTimeoutObject){clearTimeout(this._scrollAutoPlayGifTimeoutObject)}var timeout=setTimeout($.proxy(function(){this.autoPlayFocusedVideos(entryIds)},this),this._playGifTimeout);this._scrollAutoPlayGifTimeoutObject=timeout},autoPlayFocusedVideos:function(entryIds){var selected=[];var cache=GAG.CacheController;var entryCacheHandler=cache.getEntryHandler();var visibleTop=GAG.PageController.getWindowEffectiveScrollTop();var visibleBottom=$(window).scrollTop()+$(window).height();var scrollAutoPlayState=GAG.PageController.getScrollAutoPlayMp4State();var maxVisibleRatio=-1;for(var i=0;i<entryIds.length;i++){var entryId=entryIds[i];var top=entryCacheHandler.getEntryInfoForKey(entryId,"offset").top;var bottom=top+entryCacheHandler.getEntryInfoForKey(entryId,"outerHeight");var visibleHeight=0;if((top<visibleTop)&&(bottom>visibleBottom)){visibleHeight=visibleBottom-visibleTop}else{if((top>visibleTop)&&(bottom<visibleBottom)){visibleHeight=bottom-top}else{if((top<visibleTop)&&(bottom>visibleTop)){visibleHeight=bottom-visibleTop}else{if((top<visibleBottom)&&(top>visibleTop)){visibleHeight=visibleBottom-top}}}}var visibleRatio=visibleHeight/(bottom-top);if(scrollAutoPlayState==1){if(visibleRatio>maxVisibleRatio){maxVisibleRatio=visibleRatio;selected=[entryId]}}else{if(scrollAutoPlayState==2){if(this._scrollAutoPlayGifRatio<visibleRatio){selected.push(entryId)}}}}GAG.PostController.playVideosAndPauseOthersByEntryIds(selected)},_updateEntriesInView:function(entryIds){var self=GAG.ListController;var targetClass=self.selectors.IN_VIEW_CLASS;self._unsetEntriesInViewInFocus(targetClass,entryIds,false);self._setEntriesInViewInFocus(targetClass,entryIds,false)},_updateEntriesInViewFocus:function(entryIds){var self=GAG.ListController;var targetClass=self.selectors.IN_FOCUS_CLASS;self._unsetEntriesInViewInFocus(targetClass,entryIds,true);self._setEntriesInViewInFocus(targetClass,entryIds,true)},_unsetEntriesInViewInFocus:function(targetClass,entryIds,isFocused){var self=GAG.ListController;$("."+targetClass).each(function(){var entryId=$(this).data("entry-id");var index=$.inArray(entryId,entryIds);if(index<0){$(this).removeClass(targetClass);if(isFocused){$(this).trigger($.Event(self.customEvents.IN_FOCUS_UNSET))}}})},_setEntriesInViewInFocus:function(targetClass,entryIds,isFocused){var self=GAG.ListController;var selector=[];for(var i=0;i<entryIds.length;i++){selector.push(self.selectors.ENTRY_CONTAINER_ID_PREFIX+entryIds[i])}$(selector.join(", ")).each(function(){$(this).addClass(targetClass);if(isFocused===true){$(this).trigger($.Event(self.customEvents.IN_FOCUS_SET))}})},findCurrentlyInViewEntries:function(){return $(this.selectors.IN_VIEW_ELEMENTS)},findCurrentlyInViewEntry:function(){return this.findCurrentlyInViewEntries().first()},findCurrentlyInFocusEntries:function(){return $(this.selectors.IN_FOCUS_ELEMENTS)},findCurrentlyInFocusEntry:function(){return this.findCurrentlyInFocusEntries().first()},scrollToNextEntry:function(currentEntry){if(typeof currentEntry=="undefined"){currentEntry=this.findCurrentlyInViewEntry()}var self=GAG.ListController;var collection=$(this.selectors.ENTRY_CONTAINER);var currentIndex=collection.index(currentEntry);var targetIndex=currentIndex+1>=collection.length?currentIndex:currentIndex+1;var targetEntry=$(collection[targetIndex]);if(currentIndex+1>=collection.length){var listscroll=GAG.ListScrollingController;if(listscroll._loadedCount>=listscroll._loadCountMax){var loadMoreBut=$(listscroll.selectors.LOAD_MORE_BUTTON);if(loadMoreBut&&loadMoreBut.length>0){loadMoreBut[0].click()}}}if(!targetEntry.offset()){return}$("html,body").animate({scrollTop:targetEntry.offset().top-GAG.PageController._topStickyElementHeight},this._scrollDuration,"swing",function(){self.handlers.recalculateInViewEntries()})},scrollToPrevEntry:function(currentEntry){var self=GAG.ListController;if(typeof currentEntry=="undefined"){currentEntry=this.findCurrentlyInViewEntry()}if($(window).scrollTop()==0){return}if(!currentEntry.offset()){return}var targetEntry=$(currentEntry);var isFirstEntry=false;if(Math.abs(currentEntry.offset().top-GAG.PageController.getWindowEffectiveScrollTop())<this._scrollFaultTolerance){var collection=$(this.selectors.ENTRY_CONTAINER);var currentIndex=collection.index(currentEntry);var targetIndex=currentIndex-1<0?0:currentIndex-1;targetEntry=$(collection[targetIndex]);isFirstEntry=targetIndex==0}if(!targetEntry.offset()){return}$("html,body").animate({scrollTop:!isFirstEntry?(targetEntry.offset().top-GAG.PageController._topStickyElementHeight):0},this._scrollDuration,"swing",function(){self.handlers.recalculateInViewEntries()})},_readIds:{},_readIdsBuffer:[],_readIdsBufferFlushThreshold:5,_bindViewHistoryTrackingEvents:function(){$("body").on(this.customEvents.ENTRY_READ,this.selectors.ENTRY_CONTAINER,null,$.proxy(function(e){var entry=$(e.target);var entryId=$(entry).data("entry-id");var trackUserViewHistory=GAG.Configs.get("page.page_pool");if(!this._readIds[entryId]){this._readIds[entryId]=1;this._readIdsBuffer.push(entryId);if(trackUserViewHistory){GAG.Track.markReadInCookie(entryId)}if(this._readIdsBuffer.length>=this._readIdsBufferFlushThreshold){if(trackUserViewHistory){GAG.Track.read(this._readIdsBuffer)}var options={label:"",labelValue:"",platform:"d",entry:this._readIdsBuffer.join(","),view:"l"};GAG.Track.uniqueViewed(options);this._readIdsBuffer=[]}}},this))}});GAG.ListScrollingController=$.extend({},new GAG.Controller(),{_isLoading:false,_listViewElement:null,_bottomReached:false,_loadCountMax:20,_loadItemCount:0,_loadedCount:1,_lastScrollEntryPoint:0,_lastScrollFeaturedPoint:0,_disableAutoHiding:false,selectors:{LOAD_MORE_BUTTON:".badge-load-more-post",ENTRY_LIST_CONTAINER:".badge-entry-collection",ENTRY_CONTAINER:".badge-entry-container",ENTRY_LIST_VIEW:".badge-list-view-element",ADS_CONTAINER_FEATURED:"#jsid-featured-item-container section",},init:function(){this._listViewElement=$(this.selectors.ENTRY_LIST_VIEW);if(navigator.userAgent.match(/(iPhone|iPod|iPad)/i)){this._disableAutoHiding=true}else{if(GAG.Page.isPostPage()){this._disableAutoHiding=true}}this.bindElements()},bindElements:function(){this.bindScrollEvents();this.bindLastEntryInFocus()},handlers:{windowScrollHandler:function(){$.proxy(this.handlers.loadMoreScrollHandler,this)();if(!this._disableAutoHiding){$.proxy(this.handlers.autoHidingScrollHandler,this)()}},loadMoreScrollHandler:function(){var winH=$(window).height();if($(window).scrollTop()+winH>=$(document).height()-winH*3){this.loadMorePosts()}},loadMoreLastEntryFocusHandler:function(e){var entry=$(e.target);if($(this.selectors.ENTRY_CONTAINER).last().is(entry)){this.loadMorePosts()}},archiveContainer:function(container,height){if(container.html()!=""){GAG.PostController.postCallback("postWillArchive",container);container.css("min-height",height+"px");container.data("stored-html",container.html());container.empty();container.addClass("archived");GAG.PostController.postCallback("postDidArchive",container)}},extractContainer:function(container){if(container.data("stored-html")!=null){GAG.PostController.postCallback("postWillRestore",container);container.html(container.data("stored-html"));container.data("stored-html",null);container.removeClass("archived");GAG.PostController.postCallback("postDidRestore",container)}},scanEntriesForArchive:function(){var self=GAG.ListScrollingController;var cache=GAG.CacheController;var entryCacheHandler=cache.getEntryHandler();var list=GAG.ListController;var entryList=entryCacheHandler.getEntryList();var winH=$(window).height();var screenBefore=winH*3;var screenAfter=winH*4;var currentPos=GAG.PageController.getWindowEffectiveScrollTop();if(!entryList||entryList.length==0||cache.isUpdateNeeded(cache.keys.ENTRY_LIST)){cache.parseEntryInfo();entryList=entryCacheHandler.getEntryList();cache.notifyForCacheUpdateCompleted(cache.keys.ENTRY_LIST)}$(list.selectors.ENTRY_CONTAINER+":not(.archived)").each(function(){var container=$(this);var entryId=container.data("entry-id");var h=entryCacheHandler.getEntryInfoForKey(entryId,"height");var off=entryCacheHandler.getEntryInfoForKey(entryId,"offset");var top=off.top;var bottom=off.top+h;if(bottom<currentPos-screenBefore-h||top>currentPos+screenAfter+h){self.handlers.archiveContainer(container,h)}});for(var i=0;i<entryList.length;i++){var entryId=entryList[i];var h=entryCacheHandler.getEntryInfoForKey(entryId,"height");var off=entryCacheHandler.getEntryInfoForKey(entryId,"offset");var top=off.top;var bottom=off.top+h;if(bottom>=currentPos-screenBefore-h&&top<=currentPos+screenAfter+h){var container=$(list.selectors.ENTRY_CONTAINER_ID_PREFIX+entryId);self.handlers.extractContainer(container)}}},scanFeaturedItemForArchive:function(){var self=GAG.ListScrollingController;var cache=GAG.CacheController;var featuredCacheHandler=cache.getFeaturedItemHandler();var featured=GAG.FeaturedController;var winH=$(window).height();var screenBefore=winH*2;var screenAfter=winH*3;var currentPos=GAG.PageController.getWindowEffectiveScrollTop();var featuredList=featuredCacheHandler.getFeaturedList();if(!featuredList||featuredList.length==0||cache.isUpdateNeeded(cache.keys.FEATURED_LIST)){var itemIds=[];$(featured.selectors.SIDEBAR_ITEMS).each(function(){var itemId=$(this).data("item-id");var featuredItem=cache.handlers.getFeaturedItemInfoFromDOM($(this));featuredCacheHandler.setFeaturedItemInfo(itemId,featuredItem);itemIds.push(itemId)});featuredCacheHandler.setFeaturedList(itemIds);featuredList=itemIds;cache.notifyForCacheUpdateCompleted(cache.keys.FEATURED_LIST)}$(featured.selectors.SIDEBAR_ITEMS+":not(.archived)").each(function(){var container=$(this);var itemId=container.data("item-id");var featuredItem=featuredCacheHandler.getFeaturedItemInfo(itemId);if(!featuredItem){featuredItem=cache.handlers.getFeaturedItemInfoFromDOM(container);featuredCacheHandler.setFeaturedItemInfo(itemId,featuredItem)}var top=featuredItem.top;var bottom=top+featuredItem.height;if(bottom<currentPos-screenBefore-featuredItem.height||top>currentPos+screenAfter+featuredItem.height){self.handlers.archiveContainer(container,featuredItem.height)}});for(var i=0;i<featuredList.length;i++){var itemId=featuredList[i];var featuredItem=featuredCacheHandler.getFeaturedItemInfo(itemId);if(!featuredItem){featuredItem=cache.handlers.getFeaturedItemInfoFromDOM(container);featuredCacheHandler.setFeaturedItemInfo(itemId,featuredItem)}var top=featuredItem.top;var bottom=top+featuredItem.height;if(bottom>=currentPos-screenBefore-featuredItem.height&&top<=currentPos+screenAfter+featuredItem.height){var container=$(featured.selectors.SIDEBAR_ITEM_PREFIX+itemId);self.handlers.extractContainer(container)}}},autoHidingScrollHandler:function(){var self=this;var currentPos=GAG.PageController.getWindowEffectiveScrollTop();var scrolledDistanceForEntry=Math.abs(currentPos-this._lastScrollEntryPoint);var scrolledDistanceForFeatured=Math.abs(currentPos-this._lastScrollFeaturedPoint);if(scrolledDistanceForEntry>1000){self._lastScrollEntryPoint=currentPos;self.handlers.scanEntriesForArchive()}if(scrolledDistanceForFeatured>1000){self._lastScrollFeaturedPoint=currentPos;self.handlers.scanFeaturedItemForArchive()}},loadMoreAjaxHandler:function(data){if(!data.okay){return}var googleAdTagIntervalStr=$("#jsid-gat-interval").data("post-interval")+"";var googleAdTagIntervals=googleAdTagIntervalStr.split(",");var totalHtml="";var adsLoaded=false;for(var i=0;i<data.ids.length;i++){var entryKey=data.ids[i];if($("#jsid-entry-entity-"+entryKey).length==0){if(googleAdTagIntervals.indexOf(i+"")>-1){totalHtml+='<div class="banner-block stream-naughty">                                    <div class="naughty-background">                                        <div class="badge-gag-ads-container naughty-container" data-gag-ads="list-instream-300x250"></div>                                    </div>                                </div>';adsLoaded=true}totalHtml+=data.items[entryKey];this._loadItemCount++}}var lastEntryElement=this.findLastEntryElement();$(lastEntryElement).append(totalHtml);GAG.PageController.loadAnimatedGif();var cache=GAG.CacheController;cache.notifyForCacheUpdate(cache.keys.ENTRY_LIST);GAG.CacheableVoteController.process();GAG.CacheableVoteController.remoteHandler.processQueue();if(adsLoaded){GAG.AdsController.notifyForAdsInsert(this.selectors.ENTRY_LIST_CONTAINER)}GAG.GA.track("load-more",GAG.Configs.get("page.page_list"),"load-"+this._loadedCount);this._loadedCount++;if($(this.selectors.LOAD_MORE_BUTTON).data("load-count-max")){this._loadCountMax=$(this.selectors.LOAD_MORE_BUTTON).data("load-count-max")}if(this._loadedCount==this._loadCountMax){GAG.GA.track("load-more",GAG.Configs.get("page.page_list"),"i-want-more-fun")}var loadMoreBut=$(this.selectors.LOAD_MORE_BUTTON);if(this._loadedCount<this._loadCountMax){if(data.loadMoreUrl!=""){loadMoreBut.prop("href",data.loadMoreUrl);loadMoreBut.text(loadMoreBut.data("original-text"));loadMoreBut.data("original-text","");loadMoreBut.removeClass("spin")}else{loadMoreBut.removeAttr("href");loadMoreBut.text("No more posts");loadMoreBut.removeClass("spin").addClass("end");this._bottomReached=true}}else{loadMoreBut.text("I want more fun");loadMoreBut.prop("href",data.loadMoreUrl);loadMoreBut.removeClass("spin").addClass("blue");this._bottomReached=true}this._isLoading=false}},loadMorePosts:function(){if(this._isLoading||this._bottomReached){return}var loadMoreBut=$(this.selectors.LOAD_MORE_BUTTON);loadMoreBut.data("original-text",loadMoreBut.text());loadMoreBut.text(loadMoreBut.data("loading-text"));loadMoreBut.addClass("spin");var requestUrl=loadMoreBut.prop("href");this._isLoading=true;if(typeof requestUrl!="undefined"&&requestUrl!=""){if(navigator.userAgent.match(/(iPhone|iPod|iPad)/i)){var xmlhttp=new XMLHttpRequest();xmlhttp.open("GET",requestUrl,true);xmlhttp.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");xmlhttp.setRequestHeader("X-Requested-With","XMLHttpRequest");xmlhttp.onreadystatechange=$.proxy(function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){var data=jQuery.parseJSON(xmlhttp.responseText);console.log("loading more success");this.handlers.loadMoreAjaxHandler.call(this,data)}else{if(xmlhttp.readyState==4){console.log("loading more error")}}},this);xmlhttp.send()}else{$.getJSON(requestUrl,null,$.proxy(this.handlers.loadMoreAjaxHandler,this))}}},findLastEntryElement:function(){return this._listViewElement.find(this.selectors.ENTRY_LIST_CONTAINER).last();return this._listViewElement.find(this.selectors.ENTRY_CONTAINER).last()},bindScrollEvents:function(){$(window).scroll($.proxy(this.handlers.windowScrollHandler,this))},bindLastEntryInFocus:function(){$("body").on(GAG.ListController.customEvents.IN_FOCUS_SET,this.selectors.ENTRY_CONTAINER,null,$.proxy(this.handlers.loadMoreLastEntryFocusHandler,this))}});GAG.PostController=$.extend({},new GAG.Controller(),{_entryStickyElementMarginTop:20,_entryStickyElementMarginTopProfile:20,_reportInProgress:false,_voteUp:"up",_voteDown:"down",_fastInitLoad:true,_domReady:false,CLASS_STICKY:"sticked",init:function(){this._domReady=true;this.bindElements();this.renderPostFooterLike();this.trackPostUV()},availableCallbacks:["postWillArchive","postDidArchive","postWillRestore","postDidRestore"],selectors:{CONTAINER:"div#container",ENTRY_CONTAINER:".badge-entry-container",ENTRY_CONTAINER_RAW:"badge-entry-container",ENTRY_ENTITY:".badge-entry-entity",ENTRY_POST_FOOTER_LIKE_ID:"jsid-footer-facebook-like-plugin",ENTRY_STICKY_ELEMENTS:".badge-entry-sticky",ENTRY_STICKY_ELEMENTS_SHADOW:".badge-entry-sticky-shadow",ENTRY_TITLE:".badge-item-title",ENTRY_IMG:".badge-item-img",ENTRY_LOVE_COUNT:".badge-item-love-count",ENTRY_COMMENT_COUNT:".badge-item-comment-count",ENTRY_SHARE_COUNT:".badge-item-share-count",ENTRY_SHARE:".badge-item-share",ENTRY_SHARE_MENU:".badge-item-share-menu",ENTRY_FB_SHARE:".badge-facebook-share",ENTRY_FB_BOT_SHARE:".badge-facebook-bot-share",ENTRY_TW_SHARE:".badge-twitter-share",ENTRY_TW_BOT_SHARE:".badge-twitter-bot-share",ENTRY_GPLUS_SHARE:".badge-gplus-share",ENTRY_PIN_SHARE:".badge-pinterest-share",ENTRY_EMAIL_SHARE:".badge-email-share",ENTRY_NSFW_COVER:".badge-nsfw-entry-cover",ENTRY_VIDEO_CONTAINER:".badge-video-container",ENTRY_VIDEO_COVER:".badge-video-cover",ENTRY_ANIMATED_COVER:".badge-animated-cover",ENTRY_ANIMATED_CONTAINER_ANIMATED:".badge-animated-container-animated",ENTRY_ANIMATED_VIDEO_PLAYER:"video",ENTRY_ANIMATED_CONTAINER_STATIC:".badge-animated-container-static",ENTRY_ANIMATED_SPINNER:".gif-spinner",ENTRY_ANIMATED_PLAY_BUTTON:".badge-gif-play",ENTRY_ANIMATED_PLAYING:"badge-gif-playing",ENTRY_NEXT_POST_ENTRY:".badge-next-post-entry",ENTRY_PREV_POST_ENTRY:".badge-prev-post-entry",ENTRY_POST_GRID_ENTRY:".badge-post-grid-entry",ENTRY_CONTENT:".badge-entry-content",ENTRY_INFO:".badge-entry-info",ENTRY_UPVOTE_BUTTON:".badge-item-vote-up",ENTRY_DOWNVOTE_BUTTON:".badge-item-vote-down",ENTRY_COMMENT_BUTTON:".badge-item-comment",ENTRY_VOTE_CONTAINER:".badge-item-vote-container",ENTRY_COMMENT_SYS:"#jsid-comment-sys",ENTRY_POST_ZOOM:".badge-post-zoom",ENTRY_POST_CONTAINER:".badge-post-container",COMMENT_SWITCH_9GAG:".badge-comment-switch-9gag",MODAL_POST_ZOOM_CONTAINER:"#jsid-modal-post-zoom",SEARCH_ENTRY_ENTITY:".badge-search-entry-entity",MODAL_REPORT_CONTAINER:".badge-overlay-report",MODAL_REPORT_TYPE:"input[name=radio-report]",MODAL_REPORT_SUBMIT:".badge-report-submit-btn",REPORT_LINK:".badge-item-report",MORE_SHARE_BUTTON:".badge-more-share-button",MORE_SHARE_MENU:".badge-more-share-menu",POST_DOWNLOAD_FOOTER:"badge-download-footer",POST_SOCIAL_FOOTER:"badge-social-footer",GROUP_TW_SHARE:"twitter-post-share",GROUP_GPLUS_SHARE:"gplus-post-share",ENTRY_TOOLBAR_PRE:".badge-toolbar-pre",ENTRY_TOOLBAR_STICKY:".badge-entry-toolbar-sticky",FEATURED_SIDEBAR_BOTTOM_ADS:"#jsid-featured-sidebar-ad .img-container",},bindElements:function(){this.bindVoteUpElements();this.bindVoteDownElements();this.bindCommentElements();this.bindToggleShareMenu();this.bindReportElements();this.bindEntryCoverElements();this.bindStickyEntryBars();this.bindZoomElements();this._bindEntryTrackingEvents();this.bindSearchResultElements();this.bindFastElements()},_fastItems:null,_fastEntryIds:[],_fastCurrentEntryKey:null,_fastLastEntryKey:null,_fastForwardDirection:true,_fastTriggerLoadThreshold:9,_fastPostGridSize:6,_fastTimer:null,_fastReloadAdsThreshold:5,_fastReloadAdsCount:1,_fastSkipBackward:[],_fastSkipForward:[],_fastForwardByButton:false,initLoadFastEntries:function(){var data=GAG.Configs.get("data");this._fastCurrentEntryKey=$(this.selectors.ENTRY_ENTITY).data("entry-id");if(data.fast_entries!=null){this.extractFastEntries(data.fast_entries)}},getFastEntriesJson:function(requestUrl){var direction="next";if(!this._fastForwardDirection){var direction="prev"}requestUrl=requestUrl+"?direction="+direction+"&c=13";if(GAG.Configs.get("configs").from_section&&GAG.Configs.get("configs").section_url){requestUrl+="&sc="+GAG.Configs.get("configs").section_url}$.getJSON(requestUrl,null,$.proxy(this.extractFastEntries,this))},extractFastEntries:function(data){if(!data.okay){return}var gridsToFill=0;if(this._fastItems==null){this._fastItems=data.items}else{$.extend(this._fastItems,data.items)}var tempEntryIds=data.entryIds;if(!this._fastForwardDirection){tempEntryIds.reverse()}var updateCount=0;for(var i=0;i<tempEntryIds.length;i++){if($.inArray(tempEntryIds[i],this._fastEntryIds)<0){if(this._fastForwardDirection){this._fastEntryIds.push(tempEntryIds[i])}else{this._fastEntryIds.unshift(tempEntryIds[i])}updateCount++}}var index=$.inArray(this._fastCurrentEntryKey,this._fastEntryIds);this.updatePrevNextButtons(index);if(tempEntryIds.length>0&&updateCount==0){if(this._fastForwardDirection){this._fastSkipForward.push(data.entryIds[0])}else{this._fastSkipBackward.push(data.entryIds[0])}}},fastEntriesMapElements:function(entryKey,url){if(this._fastItems[entryKey]!=null){var currentEntry=this._fastItems[entryKey];this.mapPostContent(currentEntry);if(this._fastReloadAdsCount>=this._fastReloadAdsThreshold){GAG.AdsController.renderAllAds();this._fastReloadAdsCount=1}else{this._fastReloadAdsCount++}}else{window.location.href=url}},bindFastElements:function(){if(!GAG.Page.isPostPage()){return}this.initLoadFastEntries();$(this.selectors.CONTAINER).on("click",".badge-fast-entry",$.proxy(function(e){e.preventDefault();var target=$(e.currentTarget);if(target.hasClass("disabled")){return}var entryKey=target.data("entry-key");var requestUrl=target.attr("href");var action="";if(target.hasClass("badge-next-post-entry")){action="NEXT_ENTRY";this._fastForwardDirection=true}else{if(target.hasClass("badge-prev-post-entry")){action="PREV_ENTRY";this._fastForwardDirection=false}else{action="GRID_ENTRY"}}this._fastLastEntryKey=this._fastCurrentEntryKey;this._fastCurrentEntryKey=entryKey;this._fastForwardByButton=true;if(requestUrl){this.fastEntriesMapElements(entryKey,requestUrl);var index=$.inArray(this._fastCurrentEntryKey,this._fastEntryIds);var minTrigger=this._fastTriggerLoadThreshold;var maxTrigger=this._fastEntryIds.length-this._fastTriggerLoadThreshold;var tempEntryIds=$.makeArray(this._fastEntryIds);if(!this._fastForwardDirection&&index<=minTrigger){var minTiggerEntryKey=tempEntryIds[1];if($.inArray(minTiggerEntryKey,this._fastSkipBackward)<0){requestUrl=this._fastItems[minTiggerEntryKey].entryRelativeUrl;this.getFastEntriesJson(requestUrl)}}else{if(this._fastForwardDirection&&index>=maxTrigger){var maxTiggerEntryKey=tempEntryIds[tempEntryIds.length-2];if($.inArray(maxTiggerEntryKey,this._fastSkipForward)<0){requestUrl=this._fastItems[maxTiggerEntryKey].entryRelativeUrl;this.getFastEntriesJson(requestUrl)}}}GAG.GA.track("fast-entry",action,GAG.Page.getPageKey());var options={label:"",labelValue:"",platform:"d",entry:entryKey,view:"p"};GAG.Track.uniqueViewed(options)}},this));if(GAG.Page.isPostPage()){window.onpopstate=$.proxy(function(e){this.trackPostUV();var url=window.location.href;var urlArray=url.split("/");if(jQuery.inArray("gag",urlArray)>=0){if(!this._fastInitLoad){var entryKey=urlArray[jQuery.inArray("gag",urlArray)+1];var hasAnchor=(window.location.hash&&window.location.hash.length>0);if(!hasAnchor){this.fastEntriesMapElements(entryKey,url)}}else{this._fastInitLoad=false}}},this)}},updatePrevNextButtons:function(index){GAG.FeaturedController.handlers.resetSidebarToTop();GAG.PostController.handlers.resetEntryStickyToolbar();var nextEntry=this._fastItems[this._fastEntryIds[index+1]];$(this.selectors.ENTRY_NEXT_POST_ENTRY).removeData("entry-key");if(typeof nextEntry!="undefined"){$(this.selectors.ENTRY_NEXT_POST_ENTRY).removeClass("disabled");$(this.selectors.ENTRY_NEXT_POST_ENTRY).data("entry-key",nextEntry.entryId);$(this.selectors.ENTRY_NEXT_POST_ENTRY).attr("href",nextEntry.entryRelativeUrl)}else{$(this.selectors.ENTRY_NEXT_POST_ENTRY).addClass("disabled");$(this.selectors.ENTRY_NEXT_POST_ENTRY).attr("href","")}var prevEntry=this._fastItems[this._fastEntryIds[index-1]];$(this.selectors.ENTRY_PREV_POST_ENTRY).removeData("entry-key");if(typeof prevEntry!="undefined"){$(this.selectors.ENTRY_PREV_POST_ENTRY).removeClass("disabled");$(this.selectors.ENTRY_PREV_POST_ENTRY).data("entry-key",prevEntry.entryId);$(this.selectors.ENTRY_PREV_POST_ENTRY).attr("href",prevEntry.entryRelativeUrl)}else{$(this.selectors.ENTRY_PREV_POST_ENTRY).addClass("disabled");$(this.selectors.ENTRY_PREV_POST_ENTRY).attr("href","")}},mapPostContent:function(entryData){$("html, body").animate({scrollTop:0},0);var entry=$(this.selectors.ENTRY_ENTITY);var index=$.inArray(entryData.entryId,this._fastEntryIds);this._fastCurrentEntryKey=entryData.entryId.toString();if(!this._fastForwardByButton){var tempEntryIds=$.makeArray(this._fastEntryIds);for(var i=0;i<tempEntryIds.length;i++){tempEntryIds[i]=tempEntryIds[i].toString()}var oldEntry=entry.data("entry-id").toString();this._fastForwardDirection=tempEntryIds.indexOf(oldEntry)>tempEntryIds.indexOf(this._fastCurrentEntryKey)?false:true}else{if(this._fastLastEntryKey){this.replacePostUrl(this._fastLastEntryKey);this.updatePostUrl(this._fastCurrentEntryKey)}}this._fastForwardByButton=false;entry.removeData("entry-id");entry.removeData("entry-url");entry.removeData("entry-votes");entry.removeData("entry-comments");entry.attr("id","jsid-entry-entity-"+entryData.entryId);entry.attr("data-entry-id",entryData.entryId);entry.data("entry-id",entryData.entryId);entry.data("entry-url",entryData.entryUrl);entry.data("entry-votes",entryData.votes);entry.data("entry-comments",entryData.comments);$(this.selectors.ENTRY_TITLE).text(entryData.title);GAG.PageController.setPageTitleWithSpecialChars(entryData.pageTitle);var counter=$(this.selectors.ENTRY_LOVE_COUNT).parent().attr("id","love-count-"+entryData.entryId);$(this.selectors.ENTRY_LOVE_COUNT,counter).text(GAG.Utils.formatNumber(entryData.votes));$(this.selectors.ENTRY_COMMENT_COUNT).text(entryData.comments);$(this.selectors.ENTRY_SHARE).attr("data-entry-id",entryData.entryId);$(this.selectors.ENTRY_SHARE_MENU).attr("id","share-menu-"+entryData.entryId);$(this.selectors.ENTRY_CONTENT).html(entryData.entryContent);if(entryData.currentVote==1){this.handlers.likeHandler(entryData.entryId)}else{if(entryData.currentVote==-1){this.handlers.dislikeHandler(entryData.entryId)}else{this.handlers.unlikeHandler(entryData.entryId)}}GAG.CacheableVoteController.process();GAG.CacheableVoteController.remoteHandler.processQueue();if(entryData.entryType=="link"){$(this.selectors.ENTRY_CONTENT).addClass("with-button")}else{$(this.selectors.ENTRY_CONTENT).removeClass("with-button")}$(this.selectors.ENTRY_INFO).html(entryData.entryInfo);this.updatePrevNextButtons(index);$("link[rel=image_src]").attr("href",entryData.entryUrl);$("link[rel=canonical]").attr("href",entryData.entryUrl);$("meta[name=title]").attr("href",entryData.title);$(this.selectors.ENTRY_SHARE_COUNT).text(entryData.totalShares);$(this.selectors.ENTRY_FB_SHARE).removeAttr("data-track").attr("data-track",entryData.fbTrack);$(this.selectors.ENTRY_FB_SHARE).removeAttr("data-evt").attr("data-evt",entryData.fbEvt);$(this.selectors.ENTRY_FB_SHARE).removeAttr("data-share").attr("data-share",entryData.fbShare);$(this.selectors.ENTRY_FB_BOT_SHARE).removeAttr("data-evt").attr("data-evt",entryData.fbBotEvt);$(this.selectors.ENTRY_TW_SHARE).removeAttr("data-track").attr("data-track",entryData.twTrack);$(this.selectors.ENTRY_TW_SHARE).removeAttr("data-evt").attr("data-evt",entryData.twEvt);$(this.selectors.ENTRY_TW_SHARE).removeAttr("data-title").attr("data-title",entryData.twTitle);$(this.selectors.ENTRY_TW_SHARE).removeAttr("data-share").attr("data-share",entryData.twShare);$(this.selectors.ENTRY_TW_BOT_SHARE).removeAttr("data-evt").attr("data-evt",entryData.twBotEvt);$(this.selectors.ENTRY_GPLUS_SHARE).removeAttr("data-track").attr("data-track",entryData.gPlusTrack);$(this.selectors.ENTRY_GPLUS_SHARE).removeAttr("data-evt").attr("data-evt",entryData.gPlusEvt);$(this.selectors.ENTRY_GPLUS_SHARE).removeAttr("data-share").attr("data-share",entryData.gPlusShare);$(this.selectors.ENTRY_PIN_SHARE).removeAttr("data-track").attr("data-track",entryData.pinTrack);$(this.selectors.ENTRY_PIN_SHARE).removeAttr("data-evt").attr("data-evt",entryData.pinEvt);$(this.selectors.ENTRY_PIN_SHARE).removeAttr("data-title").attr("data-title",entryData.pinTitle);$(this.selectors.ENTRY_PIN_SHARE).removeAttr("data-share").attr("data-share",entryData.pinShare);$(this.selectors.ENTRY_PIN_SHARE).removeAttr("data-img").attr("data-img",entryData.pinImg);$(this.selectors.ENTRY_EMAIL_SHARE).attr("href",entryData.emailHref);$(this.selectors.ENTRY_EMAIL_SHARE).removeAttr("data-track").attr("data-track",entryData.emailTrack);$(this.selectors.ENTRY_EMAIL_SHARE).removeAttr("data-evt").attr("data-evt",entryData.emailEvt);this.renderCommentElement(entryData.entryUrl,this._currentCommentType,entryData.commentOpClientId,entryData.commentOpSignature);var isNsfw=entryData.isNsfw;var newMode=isNsfw>0?"nsfw":"";if(GAG.AdsController.getMode()!=newMode){GAG.AdsController.setMode(newMode);this._fastReloadAdsCount=1}if(entryData.entryAdminMeta!="undefined"){$("#jsid-admin-meta").html(entryData.entryAdminMeta)}GAG.PageController.loadAnimatedGif()},renderPendingComment:function(){if(window.csAsyncInited&&this._domReady){if(window.pendingComment){this.renderCommentElement(window.pendingComment.url,window.pendingComment.commentType)}else{}}else{}},renderCommentElement:function(entryUrl,commentType,opClientId,opSignature){if(this._currentEntryUrl==entryUrl&&this._currentCommentType==commentType){return}if(!commentType){commentType=GAG.Configs.get("page.default_comment_type")}this._currentEntryUrl=entryUrl;this._currentCommentType=commentType;if(commentType=="9gag"){$(this.selectors.COMMENT_SWITCH_9GAG).addClass("selected").css({cursor:"default"});$(".badge-comment").removeAttr("data-href").attr("data-href",entryUrl);if(window.CS2.setLoginUrl){window.CS2.setLoginUrl("https://"+GAG.Configs.get("page.domain")+"/login?next="+encodeURIComponent(entryUrl)+"#comment")}if((opClientId!=undefined)&&(opSignature!=undefined)){window.CS2.setOriginalPosterParam(opClientId,opSignature)}window.CS2.load(entryUrl);$(".badge-comment").show()}$(this.selectors.CONTAINER).one("mouseenter",this.selectors.ENTRY_COMMENT_SYS,null,$.proxy(function(e){GAG.GA.track("Comment","Viewed","CommentDiv")},this))},renderPostFooterLike:function(){var href=$("#"+this.selectors.ENTRY_POST_FOOTER_LIKE_ID).data("href");GAG.Facebook.renderLike(this.selectors.ENTRY_POST_FOOTER_LIKE_ID,function(){},{"data-href":href})},handlers:{likeHandler:function(entryId){GAG.PostController.handlers.loveHandler(entryId,1)},dislikeHandler:function(entryId){GAG.PostController.handlers.loveHandler(entryId,-1)},unlikeHandler:function(entryId){GAG.PostController.handlers.loveHandler(entryId,0)},loveHandler:function(entryId,score){var entity=$("#jsid-entry-entity-"+entryId+",#jsid-sidebar-ticker-entry-"+entryId);var vote=entity.find(GAG.PostController.selectors.ENTRY_VOTE_CONTAINER);var downvote=entity.find(GAG.PostController.selectors.ENTRY_DOWNVOTE_BUTTON);var upvote=entity.find(GAG.PostController.selectors.ENTRY_UPVOTE_BUTTON);vote.removeClass(GAG.PostController._voteDown);vote.removeClass(GAG.PostController._voteUp);downvote.removeClass("active");upvote.removeClass("active");if(score>0){vote.addClass(GAG.PostController._voteUp);upvote.addClass("active")}else{if(score<0){vote.addClass(GAG.PostController._voteDown);downvote.addClass("active")}}GAG.PostController.updateFastItem(entryId,"currentVote",score)},reportHandler:function(event){if(!GAG.User.isLoggedIn()){event.preventDefault();GAG.AccountController.presentSignupForm();return}$(this.selectors.MODAL_REPORT_CONTAINER).data("entry-id",$(event.currentTarget).closest(this.selectors.ENTRY_ENTITY).data("entry-id"));GAG.OverlayController.showOverlay(GAG.OverlayController.selectors.OVERLAY_COMPONENT_REPORT)},reportSubmitHandler:function(event){if(!this._reportInProgress){this._reportInProgress=true;var reportButton=$(event.currentTarget);var reportContainer=$(this.selectors.MODAL_REPORT_CONTAINER);var entryKey=reportContainer.data("entry-id");var radioCheckbox=$(this.selectors.MODAL_REPORT_TYPE+":checked",reportContainer);var reportType=radioCheckbox.val();var reportLink=$("#jsid-repost-link").val();reportButton.data("text-normal",reportButton.val());reportButton.val(reportButton.data("text-loading"));GAG.Entry.report(entryKey,reportType,reportLink,$.proxy(function(){reportButton.val(reportButton.data("text-normal"));GAG.OverlayController.hideOverlay(GAG.OverlayController.selectors.OVERLAY_COMPONENT_REPORT);radioCheckbox.prop("checked",false);this._reportInProgress=false},this),$.proxy(function(){reportButton.val(reportButton.data("text-normal"));alert("Something went wrong, please try again");this._reportInProgress=false},this))}},resetEntryStickyToolbar:function(){var self=GAG.PostController;var entryToolbar=$(self.selectors.ENTRY_TOOLBAR_STICKY);if(entryToolbar&&entryToolbar.length>0){entryToolbar.css({position:"","z-index":"",top:""});entryToolbar.removeClass("sticked")}},entryStickyToolbarHandler:function(){var self=GAG.PostController;var currentPos=$(window).scrollTop();var winH=$(window).height();var entry=$(self.selectors.ENTRY_CONTAINER);var entryToolbarContainer=entry.find(self.selectors.ENTRY_TOOLBAR_PRE);var entryToolbar=entry.find(self.selectors.ENTRY_TOOLBAR_STICKY);if(entryToolbar&&entryToolbar.length>0){var containerTop=entryToolbarContainer.offset().top;var containerHeight=entryToolbar.height();var entryActionBarHeight=entryToolbar.height();var entryActionBarPadding=10;var postContainer=$(self.selectors.ENTRY_POST_CONTAINER);var bottom=postContainer.offset().top+postContainer.height()-containerHeight-entryActionBarPadding*2;if(currentPos<containerTop&&entryToolbar.hasClass("sticked")){self.handlers.resetEntryStickyToolbar()}else{if(currentPos>=containerTop&&currentPos<=bottom&&!entryToolbar.hasClass("sticked")){entryToolbar.css({position:"fixed","z-index":"3",top:"0"});entryToolbar.addClass("sticked")}}}},entryStickElementHandler:function(event){var self=GAG.PostController;var cache=GAG.CacheController;var list=GAG.ListController;var currentPos=$(window).scrollTop();var winH=$(window).height();var entryCacheHandler=cache.getEntryHandler();var entryList=entryCacheHandler.getEntryList();if(!entryList||entryList.length==0||cache.isUpdateNeeded(cache.keys.ENTRY_LIST)){cache.parseEntryInfo();entryList=entryCacheHandler.getEntryList();cache.notifyForCacheUpdateCompleted(cache.keys.ENTRY_LIST)}var tempStickedItems=[];for(var i=0;i<entryList.length;i++){var entryId=entryList[i];var h=entryCacheHandler.getEntryInfoForKey(entryId,"height");var off=entryCacheHandler.getEntryInfoForKey(entryId,"offset");var top=off.top;var bottom=off.top+h;if(bottom>=currentPos-winH-h&&top<=currentPos+winH+h){var entry=$(list.selectors.ENTRY_CONTAINER_ID_PREFIX+entryId);var shadow=entry.find(self.selectors.ENTRY_STICKY_ELEMENTS_SHADOW);var stickyActionBar=entry.find(self.selectors.ENTRY_STICKY_ELEMENTS);if(shadow&&shadow.length>0&&stickyActionBar&&stickyActionBar.length>0){var shadowTop=shadow.offset().top;var stickyActionBarHeight=stickyActionBar.height()||stickyActionBar.outerHeight();if(shadowTop-self._entryStickyElementMarginTop>=GAG.PageController.getWindowEffectiveScrollTop()){stickyActionBar.css({position:"relative","z-index":1,top:""});stickyActionBar.removeClass(self.CLASS_STICKY)}else{if(shadowTop-self._entryStickyElementMarginTop<GAG.PageController.getWindowEffectiveScrollTop()&&top+h+parseFloat(entry.css("paddingTop"))-stickyActionBarHeight-self._entryStickyElementMarginTop>GAG.PageController.getWindowEffectiveScrollTop()){var stickyTop=(GAG.PageController._topStickyElementHeight+self._entryStickyElementMarginTop)+"px";stickyActionBar.css({position:"fixed","z-index":2,top:stickyTop});stickyActionBar.addClass(self.CLASS_STICKY);tempStickedItems.push(entryId)}else{var stickyTop=(h+parseFloat(entry.css("paddingTop"))-(shadowTop-top)-stickyActionBarHeight)+"px";stickyActionBar.css({position:"relative","z-index":2,top:stickyTop});stickyActionBar.removeClass(self.CLASS_STICKY)}}}}}var needRecalc=false;var stickedItemCacheKey="entrySticked";var prevStickedItems=cache.getValue(stickedItemCacheKey);if(prevStickedItems&&prevStickedItems.length>0){for(var i=0;i<prevStickedItems.length;i++){if($.inArray(prevStickedItems[i],tempStickedItems)<0){var entryId=prevStickedItems[i];var entry=$(list.selectors.ENTRY_CONTAINER_ID_PREFIX+entryId);var stickyActionBar=entry.find(self.selectors.ENTRY_STICKY_ELEMENTS);if(stickyActionBar.hasClass(self.CLASS_STICKY)){stickyActionBar.css({position:"","z-index":"",top:""});stickyActionBar.removeClass(self.CLASS_STICKY);needUpdate=true}}}}cache.setValue(stickedItemCacheKey,tempStickedItems);if(needRecalc){self.handlers.entryStickElementHandler()}}},onVoteUp:function(e){var btn=$(e.currentTarget);var entryId=btn.closest(this.selectors.ENTRY_ENTITY).data("entry-id");var entryUrl=btn.closest(this.selectors.ENTRY_ENTITY).data("entry-url");var vote=btn.closest(this.selectors.ENTRY_VOTE_CONTAINER);if(GAG.PageController.ensureLoggedIn(entryUrl)){var upVoted=vote.hasClass(this._voteUp)||btn.hasClass("up active");var downVoted=vote.hasClass(this._voteDown)||btn.hasClass("down active");if(downVoted){this.addLoveCount(entryId)}var cacheData={};if(upVoted){GAG.Vote.unlike(entryId,function(){},function(){});this.minusLoveCount(entryId);this.handlers.unlikeHandler(entryId);cacheData[entryId]=0;GAG.GA.track("EntryAction","UndoUpvote",this._getPageTrackKey())}else{GAG.Vote.like(entryId,function(){},function(){});this.addLoveCount(entryId);this.handlers.likeHandler(entryId);cacheData[entryId]=1;GAG.GA.track("EntryAction","Upvote",this._getPageTrackKey())}GAG.CacheableVote.addToCache(cacheData)}e.stopPropagation()},_getPageTrackKey:function(){var trackKey="ListPage";if(GAG.Page.isPostPage()){trackKey="PostPage"}else{if(GAG.Page.isProfilePage()){trackKey="ProfilePage"}}return trackKey},onVoteDown:function(e){var btn=$(e.currentTarget);var entryId=btn.closest(this.selectors.ENTRY_ENTITY).data("entry-id");var entryUrl=btn.closest(this.selectors.ENTRY_ENTITY).data("entry-url");var vote=btn.closest(this.selectors.ENTRY_VOTE_CONTAINER);if(GAG.PageController.ensureLoggedIn(entryUrl)){var selected=vote.hasClass(this._voteDown);if(vote.hasClass(this._voteUp)){this.minusLoveCount(entryId)}var cacheData={};if(selected){GAG.Vote.unlike(entryId,function(){},function(){});this.addLoveCount(entryId);this.handlers.unlikeHandler(entryId);cacheData[entryId]=0;GAG.GA.track("EntryAction","UndoDownvote",this._getPageTrackKey())}else{GAG.Vote.dislike(entryId,function(){},function(){});this.minusLoveCount(entryId);this.handlers.dislikeHandler(entryId);cacheData[entryId]=-1;GAG.GA.track("EntryAction","Downvote",this._getPageTrackKey())}GAG.CacheableVote.addToCache(cacheData)}e.stopPropagation()},addLoveCount:function(entryId){var counter=this.getLoveCounter(entryId);var entity=$("#jsid-entry-entity-"+entryId);var curr=parseInt(entity.data("entry-votes"));if(isNaN(curr)){return}curr++;$(this.selectors.ENTRY_LOVE_COUNT,counter).text(GAG.Utils.formatNumber(curr));entity.data("entry-votes",curr);GAG.PostController.updateFastItem(entryId,"votes",curr)},minusLoveCount:function(entryId){var counter=this.getLoveCounter(entryId);var entity=$("#jsid-entry-entity-"+entryId);var curr=parseInt(entity.data("entry-votes"));if(isNaN(curr)){return}curr--;$(this.selectors.ENTRY_LOVE_COUNT,counter).text(GAG.Utils.formatNumber(curr));entity.data("entry-votes",curr);GAG.PostController.updateFastItem(entryId,"votes",curr)},updateFastItem:function(entryId,attr,value){if(GAG.PostController._fastItems!=null){if(GAG.PostController._fastItems[entryId]!="undefined"){GAG.PostController._fastItems[entryId][attr]=value}}},getLoveCounter:function(entryId){return $("#love-count-"+entryId)},trackPostUV:function(){if(GAG.Page.isPostPage()){var entryKey=$(this.selectors.ENTRY_ENTITY).data("entry-id");var options={label:"",labelValue:"",platform:"d",entry:entryKey,view:"p"};GAG.Track.uniqueViewed(options)}},bindStickyEntryBars:function(){if(GAG.Page.isPostPage()){$(window).on("scroll resize",null,null,$.proxy(this.handlers.entryStickyToolbarHandler,this))}else{if(GAG.Page.isProfilePage()){this._entryStickyElementMarginTop=this._entryStickyElementMarginTopProfile}$(window).on("scroll resize",null,null,$.proxy(this.handlers.entryStickElementHandler,this))}},bindVoteUpElements:function(){$(this.selectors.CONTAINER).on("click",this.selectors.ENTRY_UPVOTE_BUTTON,$.proxy(this.onVoteUp,this))},bindVoteDownElements:function(){$(this.selectors.CONTAINER).on("click",this.selectors.ENTRY_DOWNVOTE_BUTTON,$.proxy(this.onVoteDown,this))},_currentCommentType:"",_currentEntryUrl:"",bindCommentElements:function(){this._currentCommentType="";this._currentEntryUrl=GAG.Configs.get("page.entry_url");this.renderPendingComment()},bindSearchResultElements:function(){$(this.selectors.CONTAINER).on("click",this.selectors.SEARCH_ENTRY_ENTITY,null,$.proxy(function(e){e.preventDefault();var entity=$(e.currentTarget);var entityUrl=entity.data("entry-url");window.open(entityUrl,"_blank")},this));$(this.selectors.CONTAINER).on("click",this.selectors.SEARCH_ENTRY_ENTITY+" "+this.selectors.ENTRY_NSFW_COVER,null,$.proxy(function(e){e.stopPropagation()},this))},bindEntryCoverElements:function(){$(this.selectors.CONTAINER).on("click",this.selectors.ENTRY_NSFW_COVER,null,$.proxy(function(e){e.preventDefault();var entryURL=$(e.currentTarget).parents(this.selectors.ENTRY_ENTITY).data("entry-url");if(!entryURL){entryURL=$(e.currentTarget).parents(this.selectors.SEARCH_ENTRY_ENTITY).data("entry-url")}GAG.AccountController.setSafeMode(0,entryURL)},this));$(this.selectors.CONTAINER).on("click",this.selectors.ENTRY_VIDEO_COVER,null,$.proxy(function(e){e.preventDefault();var target=$(e.currentTarget);var entity=target.closest(this.selectors.ENTRY_ENTITY);var container=$(e.currentTarget).parents(this.selectors.ENTRY_VIDEO_CONTAINER);var width="500";var height="277";if(entity.hasClass("post-page")){var width="600";var height="340"}var content='<iframe width="'+width+'" height="'+height+'" src="http://www.youtube.com/embed/'+container.data("video-id")+'?autoplay=1&controls=1&iv_load_policy=3" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" allowfullscreen></iframe>';container.html(content)},this));$(this.selectors.CONTAINER).on("click",this.selectors.ENTRY_ANIMATED_COVER,null,$.proxy(function(e){e.preventDefault();var self=GAG.PostController;var target=$(e.currentTarget);if((target.data("web-post")!=undefined)&&target.data("web-post")=="1"){return false}var coverContainer=target.find(self.selectors.ENTRY_ANIMATED_CONTAINER_STATIC);var animatedContainer=target.find(self.selectors.ENTRY_ANIMATED_CONTAINER_ANIMATED);var videoPlayer=target.find(self.selectors.ENTRY_ANIMATED_VIDEO_PLAYER);var container=coverContainer.parent();var gifImage=animatedContainer.find("video");var coverImage=coverContainer.find(".badge-item-img");if(gifImage.length==0){var altTag='alt="'+coverImage.attr("alt")+'"';if($.browser&&$.browser.mozilla){altTag=""}var coverStyle=coverContainer.find("img").attr("style");var videoStyle="width:"+container.css("width")+"; height:"+container.css("height")+";";if(Modernizr.video){animatedContainer.append('<video preload="none" poster="'+coverImage[0].src+'" style="'+videoStyle+'" loop><source src="'+animatedContainer.data("mp4")+'" type="video/mp4"><source src="'+animatedContainer.data("webm")+'" type="video/webm"><div class="badge-item-animated-img"></div></video>')}else{animatedContainer.append('<img src="'+animatedContainer.data("image")+'" '+altTag+' style="'+coverStyle+'"/>')}animatedContainer.removeData("image");animatedContainer.attr("data-image","");animatedContainer.removeData("mp4");animatedContainer.attr("data-mp4","");animatedContainer.removeData("webm");animatedContainer.attr("data-webm","");self.bindImageLoadedEvent(container)}else{if(!coverContainer.hasClass("loading")&&(coverContainer.hasClass("presenting")||coverContainer.hasClass("hide"))){if(e&&e.type==="click"){if($(videoPlayer)[0].paused&&(coverContainer.hasClass("presenting")||coverContainer.hasClass("hide"))){$(videoPlayer)[0].play();container.addClass(self.selectors.ENTRY_ANIMATED_PLAYING);coverContainer.addClass("hide");coverContainer.removeClass("presenting")}else{$(videoPlayer)[0].pause();container.removeClass(self.selectors.ENTRY_ANIMATED_PLAYING);coverContainer.removeClass("hide");coverContainer.addClass("presenting");coverImage.css("visibility","hidden")}}}if(!coverContainer.hasClass("presenting")){var gifElement=animatedContainer.find("img");gifElement.prop("src",gifElement.prop("src"))}else{$(GAG.PostController.selectors.ENTRY_ANIMATED_PLAY_BUTTON).removeClass("hide")}}},this))},bindImageLoadedEvent:function(container){var self=GAG.PostController;var coverContainer=container.find(self.selectors.ENTRY_ANIMATED_CONTAINER_STATIC);var animatedContainer=container.find(self.selectors.ENTRY_ANIMATED_CONTAINER_ANIMATED);var coverImage=container.find(".badge-item-img");animatedContainer.find("img").load(function(){coverContainer.removeClass("loading");coverContainer.addClass("hide");coverContainer.removeClass("presenting");animatedContainer.removeClass("hide");if(Modernizr.video){coverContainer.css("padding-left",coverImage.css("padding-left"));coverImage.css("padding-left","");coverImage.css("visibility","hidden")}var gifElement=$(this);gifElement.prop("src",gifElement.prop("src"));animatedContainer.find("img").unbind()}).each(function(){if(this.complete){$(this).load()}})},bindReportElements:function(){$(this.selectors.CONTAINER).on("click",this.selectors.REPORT_LINK,null,$.proxy(this.handlers.reportHandler,this));$(this.selectors.MODAL_REPORT_SUBMIT).on("click",null,null,$.proxy(this.handlers.reportSubmitHandler,this))},bindToggleShareMenu:function(){$(this.selectors.CONTAINER).on("click",this.selectors.MORE_SHARE_BUTTON,$.proxy(function(e){e.stopPropagation();var triggerElement=$(e.currentTarget);var entity=triggerElement.closest(this.selectors.ENTRY_ENTITY);var toggleShareMenu=entity.find(".badge-more-share-menu");if(toggleShareMenu.hasClass("hide")){GAG.PageController.hidePopupMenu(this.selectors.MORE_SHARE_MENU);toggleShareMenu.removeClass("hide");GAG.GA.track("EntryAction","ShareMenuOpened",this._getPageTrackKey())}else{GAG.PageController.hidePopupMenu();GAG.GA.track("EntryAction","ShareMenuClosed",this._getPageTrackKey())}},this))},bindShortcutKeys:function(){GAG.KeyboardController.bindAction("l",$.proxy(this.onVoteUp,this));GAG.KeyboardController.bindAction("h",$.proxy(this.onVoteDown,this))},bindZoomElements:function(){$(this.selectors.CONTAINER).on("click",this.selectors.ENTRY_POST_ZOOM,$.proxy(function(e){e.preventDefault();var target=$(e.currentTarget);var entity=target.closest(this.selectors.ENTRY_ENTITY);this.showPostZoomOverlay(entity)},this))},_bindEntryTrackingEvents:function(){GAG.Facebook.addInitCallback("all",$.proxy(function(){FB.Event.subscribe("edge.create",$.proxy(function(href,widget,response){var el=$(widget.dom);var entryId=el.closest(this.selectors.ENTRY_ENTITY).data("entry-id");var view=el.parents(GAG.ListController.selectors.LIST_VIEW).length>0?"l":"p";GAG.Track.event("social","fb.l",{platform:"d",entry:entryId,view:view})},this));FB.Event.subscribe("edge.remove",$.proxy(function(href,widget,response){var el=$(widget.dom);var entryId=el.closest(this.selectors.ENTRY_ENTITY).data("entry-id");var view=el.parents(GAG.ListController.selectors.LIST_VIEW).length>0?"l":"p";GAG.Track.event("social","fb.rl",{platform:"d",entry:entryId,view:view})},this))},this))},replacePostUrl:function(entryId){var url="http://"+document.location.hostname+"/gag/"+entryId;if(typeof(window.history.pushState)!="undefined"){window.history.pushState({},"",url)}},updatePostUrl:function(entryId){var url="http://"+document.location.hostname+"/gag/"+entryId;if(typeof(window.history.replaceState)!="undefined"){window.history.replaceState({},"",url)}},recoverOrginialUrl:function(){window.history.go(-1)},showPostZoomOverlay:function(entity){var content=entity.find("img").first().clone().removeAttr("class");$(this.selectors.MODAL_POST_ZOOM_CONTAINER).find(".badge-post-zoom-img").html("").append(content);GAG.OverlayController.showOverlay(this.selectors.MODAL_POST_ZOOM_CONTAINER)},hidePostZoomOverlay:function(){$(this.selectors.MODAL_POST_ZOOM_CONTAINER).addClass("hide");$("body").removeClass("no-scroll")},scrollToComment:function(){var comment=$("#comment");$("html,body").animate({scrollTop:comment.offset().top},100)},pauseAllVideos:function(){var self=this;var videoPlayer=document.getElementsByTagName("video");var coverContainer="";for(var i=0;i<videoPlayer.length;i++){videoPlayer[i].pause();coverContainer.closest("."+self.selectors.ENTRY_ANIMATED_PLAYING).removeClass(self.selectors.ENTRY_ANIMATED_PLAYING);coverContainer=$(videoPlayer[i]).parent().parent().find(self.selectors.ENTRY_ANIMATED_CONTAINER_STATIC);coverContainer.removeClass("hide");coverContainer.addClass("presenting");coverContainer.find(".badge-item-img").css("visibility","hidden")}},playVideosAndPauseOthersByEntryIds:function(entryIds){self=this;var alreadyPlayingEntryIds=[];$("."+self.selectors.ENTRY_ANIMATED_PLAYING).each(function(){var entryId=$(this).closest("article").data("entry-id");if($.inArray(entryId,entryIds)<0){var video=$(this).find("video");if(video&&(video.length>0)){video[0].pause()}var coverContainer=$(this).find(self.selectors.ENTRY_ANIMATED_CONTAINER_STATIC);coverContainer.removeClass("hide");coverContainer.addClass("presenting");coverContainer.find(".badge-item-img").css("visibility","hidden");$(this).removeClass(self.selectors.ENTRY_ANIMATED_PLAYING)}else{alreadyPlayingEntryIds.push(entryId)}});GAG.ListController.findCurrentlyInFocusEntries().each(function(){var entryId=$(this).closest("article").data("entry-id");if(($.inArray(entryId,entryIds)>=0)&&($.inArray(entryId,alreadyPlayingEntryIds)<0)){$(this).find(self.selectors.ENTRY_ANIMATED_COVER).click()}})},upvoteEntry:function(container){$(container).find(this.selectors.ENTRY_UPVOTE_BUTTON).first().click()},downvoteEntry:function(container){$(container).find(this.selectors.ENTRY_DOWNVOTE_BUTTON).first().click()},commentEntry:function(container){var entity=$(container).first();if(GAG.Page.isPostPage()){this.scrollToComment()}else{if(container.length>0){var commentBtn=$(container).find(this.selectors.ENTRY_COMMENT_BUTTON).first();commentBtn.click();window.open(commentBtn.attr("href"),"_blank")}}},playEntry:function(container){var entity=$(container).first();var videoCover=entity.find(this.selectors.ENTRY_VIDEO_COVER);var animatedCover=entity.find(this.selectors.ENTRY_ANIMATED_COVER);if(videoCover.length){videoCover.click()}else{if(animatedCover.length){animatedCover.click()}}},prevEntry:function(){$(this.selectors.ENTRY_PREV_POST_ENTRY).click()},nextEntry:function(){$(this.selectors.ENTRY_NEXT_POST_ENTRY).click()},postCallback:function(type,container){var self=GAG.PostController;if($.inArray(type,self.availableCallbacks)>=0){self[type](container)}},postWillArchive:function(container){var self=GAG.PostController;if(container.hasClass(self.selectors.ENTRY_CONTAINER_RAW)){var coverContainer=container.find(self.selectors.ENTRY_ANIMATED_CONTAINER_STATIC);if(coverContainer&&coverContainer.length>0&&coverContainer.hasClass("loading")){var gifImage=container.find(self.selectors.ENTRY_ANIMATED_CONTAINER_ANIMATED+" img");var videoImage=container.find(self.selectors.ENTRY_ANIMATED_CONTAINER_ANIMATED+" video");if(gifImage&&gifImage.length>0){gifImage.unbind()}if(videoImage&&videoImage.length>0){videoImage.unbind()}}}},postDidArchive:function(container){},postWillRestore:function(container){},postDidRestore:function(container){var self=GAG.PostController;if(container.hasClass(self.selectors.ENTRY_CONTAINER_RAW)){var coverContainer=container.find(self.selectors.ENTRY_ANIMATED_CONTAINER_STATIC);var animatedContainer=container.find(self.selectors.ENTRY_ANIMATED_CONTAINER_ANIMATED);var gifImage=container.find(self.selectors.ENTRY_ANIMATED_CONTAINER_ANIMATED+" img");var videoImage=container.find(self.selectors.ENTRY_ANIMATED_CONTAINER_ANIMATED+" video");var gifExist=(gifImage&&gifImage.length>0);var videoExist=(videoImage&&videoImage.length>0);if(gifExist&&gifImage[0].complete&&coverContainer.hasClass("loading")){coverContainer.removeClass("loading");coverContainer.removeClass("presenting");coverContainer.addClass("hide")}else{if(gifExist&&!gifImage[0].complete&&coverContainer.hasClass("loading")){coverContainer.addClass("loading");coverContainer.removeClass("presenting");self.bindImageLoadedEvent(container)}}if(videoExist){coverContainer.removeClass("loading");coverContainer.removeClass("hide");coverContainer.addClass("presenting")}}},});GAG.PageController=$.extend({},new GAG.Controller(),{docTitle:"",init:function(){this.bindElements();this.updateTimeZoneOffset();this.updateSignUpReferrer();this.setCustomizeElementValues();this.checkCustomizeElementsShowStatus();this.loadAnimatedGif();this.syncAccountSystemSession();this.docTitle=document.title},getUniqueDomId:function(prefix){var domId;while(!domId||document.getElementById(domId)){domId=(prefix?prefix:"jsid_dom")+"_"+parseInt((Math.random()*999999),10)}return domId},_toastFadeDuration:500,_showFooterNavAfter:600,_sidebarStickyElementMarginTop:20,_sidebarStickyHeight:0,_topVolatileElementHeight:0,_topStickyElementHeight:0,_autoCompleteMinLength:2,_autoCompleteMaxResult:10,_isNotificationShown:false,_lastNotificationUpdateTs:false,_isUpdatingNotification:false,_isMarkingNotificationAsRead:false,_isChatNotificationShown:false,_lastChatNotificationUpdateTs:false,_isUpdatingChatNotification:false,_isMarkingChatNotificationAsRead:false,_isSigningUpEmailSubscription:false,_CLASS_STICKY:"sticked",_CLASS_SHOW_BACK_TO_TOP:"show",_themeIdCookieKey:"themeId",_signUpReferrerCookieKey:"sign_up_referer",_sidePersonalizeCookieKey:"side_personalize",_safeModeCookieKey:"safemode",_tickerLoadMoreIndex:0,_tickerLoadMorePage:0,_tickerLoadingMore:false,_tickerNoMoreItem:false,_tickerBeenStickied:false,_tickerItems:[],_tickerOverlayHeight:0,_tickerIntervalId:false,selectors:{THEME_FILES:".badge-theme-file",FOOTER_NAV:"a.badge-scroll-to-top",SCROLL_TO_TOP:"a.badge-scroll-to-top",HEADER_TOP_NAV:".badge-sticky-nav",HEADER_TOP_BANNER:".badge-volatile-banner",HEADER_USER_FUNCTION_PLACEHOLDER:".badge-user-function-placeholder",HEADER_USER_FUNCTION:"#jsid-user-function",HEADER_VISITOR_FUNCTION:"#jsid-visitor-function",HEADER_USER_MENU:"#jsid-header-user-menu",HEADER_USER_ITEM:"#jsid-header-user-menu-items",HEADER_BANNER_CONFIRM_EMAIL:"#jsid-banner-confirm-email",HEADER_BANNER_CONFIRM_EMAIL_USERNAME:"#jsid-banner-confirm-email-username",HEADER_FUNNY_MENU:"#jsid-header-funny-menu",HEADER_FUNNY_ITEM:"#jsid-header-funny-menu-items",HEADER_NOTIFICATION_MENU:"#jsid-header-notification-menu",HEADER_NOTIFICATION_ITEM:"#jsid-header-notification-items",HEADER_NOTIFICATION_CONTAINER:"#jsid-header-notification-items-container",HEADER_NOTIFICATION_SEE_ALL:"#jsid-header-notification-see-all",HEADER_CHAT_NOTIFICATION_MENU:"#jsid-header-chat-notification-menu",HEADER_CHAT_NOTIFICATION_ITEM:"#jsid-header-chat-notification-items",HEADER_CHAT_NOTIFICATION_CONTAINER:"#jsid-header-chat-notification-items-container",HEADER_UPLOAD_ITEM:".badge-upload-items",HEADER_UPLOAD_MENU:"#jsid-upload-menu",HEADER_DOWNLOAD_MENU:"#jsid-header-download-menu",HEADER_DOWNLOAD_ITEM:"#jsid-header-download-menu-items",HEADER_DOWNLOAD_BTN_CONTAINER:".badge-download-function-container",HEADER_SEARCH:".badge-header-search",HEADER_SEARCH_INPUT:"#jsid-search-input",HEADER_TOAST:".badge-toast-container",HEADER_TOAST_MESSAGE:".badge-toast-message",HEADER_TOAST_CLOSE:".badge-toast-close",SUBNAV_STICKY_STATIC:".badge-sticky-subnav-static",PERSONALISE_BTN_SHOW:".badge-personalise-btn",PERSONALISE_OPTION:".badge-personalise-options",PERSONALISE_SELECTOR:"#jsid-personalise-selector",PERSONALISE_OPTION_NSFW:".badge-personalise-option-nsfw",PERSONALISE_BTN_SAVE:"#jsid-personalise-btn-save",PERSONALISE_BTN_RESET:"#jsid-personalise-btn-reset",PERSONALISE_FORM:"#jsid-personalise-form",SIDEBAR_EMAIL_SCRIPTION_ELEM:".badge-email-subscription",SIDEBAR_EMAIL_SCRIPTION_INPUT:".badge-email-subscription-input",SIDEBAR_EMAIL_SCRIPTION_BTN:".badge-email-subscription-btn",SIDEBAR_EMAIL_SCRIPTION_TOGGLE_HIDE:".badge-toggle-hide-when-done",SIDEBAR_TICKER_ITEM:"#jsid-sidebar-ticker-items",SIDEBAR_TICKER_CONTAINER:"#jsid-sidebar-ticker-items-container",SIDEBAR_TICKER_LOADING_SPINNER:"#jsid-sidebar-ticker-items-container .loading",SIDEBAR_TICKER_OVERLAY:"#jsid-ticker-overlay",SIDEBAR_TICKER_ITEM_LINK:".badge-sidebar-ticker-items-link",SIDEBAR_TICKER_OVERLAY_TITLE:".badge-ticker-overlay-title",SIDEBAR_TICKER_OVERLAY_IMG_LINK:".badge-ticker-overlay-img-link",SIDEBAR_TICKER_OVERLAY_POINT:".badge-ticker-overlay-point",SIDEBAR_TICKER_OVERLAY_COMMENTCOUNT:".badge-ticker-overlay-commentCount",SIDEBAR_TICKER_OVERLAY_OVERVIEW:".badge-ticker-overlay-overview",CONTAINTER:"#container",PAGE:".badge-page",CLICK_EVENT_SELECTOR:".badge-evt, .badge-track",CLICK_EVENT_NOFOLLOW_SELECTOR:".badge-track-no-follow"},onScroll:function(){this.checkFooterNavElements()},bindElements:function(){this.calculateHeights();this.bindStickyNav();this.bindFooterNavElements();this.bindCustomizeElements();this.bindUploadElements();this.bindUserSettingElements();this.bindGroupElements();this.bindDownloadElements();this.bindSearchElements();this.bindToastElements();this.bindEmailSubscription();this.bindEventTracking();if(GAG.Page.getPageKey()=="hot"){this.bindTickerElements();this.bindTickerLoadmore();this.bindTickerMouseenter()}this.bindCloseAdvice();this.bindContactElements();this.bindEditorDashboardElements();this.bindPopupMenu()},calculateHeights:function(){this._topStickyElementHeight=$(this.selectors.HEADER_TOP_NAV).height();GAG.PageController._topVolatileElementHeight=0;$(this.selectors.HEADER_TOP_BANNER).each(function(){if(!$(this).hasClass("hide")){GAG.PageController._topVolatileElementHeight+=$(this).height()}})},bindEditorDashboardElements:function(){$(".badge-period-dropdown-control .period").on("click",function(){event.preventDefault();$(this).next(".period-dropdown").toggleClass("hide")});$("#jsid-period-dropdown-from").datepicker({minDate:"-30D",maxDate:"+0D",changeMonth:true,numberOfMonths:2,onClose:function(selectedDate){$("#jsid-period-dropdown-to").datepicker("option","minDate",selectedDate)}});$("#jsid-period-dropdown-to").datepicker({minDate:"-30D",maxDate:"+0D",changeMonth:true,numberOfMonths:2,onClose:function(selectedDate){$("#jsid-period-dropdown-from").datepicker("option","maxDate",selectedDate)}});$("#jsid-period-dropdown-from, #jsid-period-dropdown-to, #ui-datepicker-div").click(function(event){event.stopPropagation()});$(".badge-load-more-entry").on("click",function(e){e.preventDefault();var loadMoreBut=$(this);loadMoreBut.data("original-text",loadMoreBut.text());loadMoreBut.text(loadMoreBut.data("loading-text"));var requestUrl=loadMoreBut.prop("href");if(typeof requestUrl!="undefined"&&requestUrl!=""){$.ajax({url:requestUrl,dataType:"json",success:function(data){var totalHtml="";for(var i=0;i<data.ids.length;i++){var entryKey=data.ids[i];totalHtml+=data.items[entryKey]}$(".badge-posts-items").append(totalHtml);if(data.loadMoreUrl!=""){loadMoreBut.prop("href",data.loadMoreUrl);loadMoreBut.text(loadMoreBut.data("original-text"));loadMoreBut.data("original-text","");loadMoreBut.data("original-url",data.loadMoreUrl)}else{loadMoreBut.removeAttr("href");loadMoreBut.text("No more posts")}}})}});$(".badge-second-col").on("change",function(){if($(this).val()=="r"){$(".badge-comment-col").addClass("hide");$(".badge-report-col").removeClass("hide")}else{if($(this).val()=="c"){$(".badge-comment-col").removeClass("hide");$(".badge-report-col").addClass("hide")}}$(".badge-update-url").each(function(){var sel=$(".badge-second-col").val();var param="&scol=";if(sel=="r"){param+="r"}else{if(sel=="c"){param+="c"}}var newUrl=$(this).data("original-url")+param;$(this).attr("href",newUrl)})})},bindContactElements:function(){if(!GAG.Page.isContactPage()){return}this.showCaptcha("contact");$("#jsid-contact-form").on("submit",$.proxy(function(){if(!$("#jsid-interaction-name").val().length){$("#jsid-contact-name-error").removeClass("hide");return false}else{$("#jsid-contact-name-error").addClass("hide")}if(!GAG.Validator.isValidEmail($("#jsid-interaction-email").val())){$("#jsid-contact-email-error").removeClass("hide");return false}else{$("#jsid-contact-email-error").addClass("hide")}if($("#jsid-email-category").val()==0){$("#jsid-contact-category-error").removeClass("hide");return false}else{$("#jsid-contact-category-error").addClass("hide")}if(!$("#jsid-email-subject").val().length){$("#jsid-contact-subject-error").removeClass("hide");return false}else{$("#jsid-contact-subject-error").addClass("hide")}if(!$("#jsid-email-message").val().length){$("#jsid-contact-message-error").removeClass("hide");return false}else{$("#jsid-contact-message-error").addClass("hide")}var isValid=true;try{if(Recaptcha){var challenge=Recaptcha.get_challenge();var response=Recaptcha.get_response();$("#jsid-contact-recaptcha_challenge").val(challenge);$("#jsid-contact-recaptcha_response").val(response)}}catch(e){}if(!isValid){event.preventDefault();return false}return true},this))},bindSearchElements:function(){var headerSearch=$(this.selectors.HEADER_SEARCH);var headerSearchInput=$(this.selectors.HEADER_SEARCH_INPUT);var headerSearchInputId=headerSearchInput.attr("id");$("body").on("mousedown",function(event){if(headerSearchInput.length&&event.target.id!==headerSearchInputId&&headerSearch.hasClass("selected")&&!headerSearchInput.val().length){headerSearch.removeClass("selected");headerSearchInput.removeAttr("placeholder")}});headerSearch.click(function(){if(!headerSearch.hasClass("selected")){headerSearch.addClass("selected");headerSearchInput.attr("placeholder",headerSearchInput.data("placeholder")).focus();return false}});if(headerSearchInput.length){var options={url:"/tags/suggest",appendTo:this.selectors.HEADER_SEARCH,menuClass:"search-suggestion small"};this.loadAutoComplete(this.selectors.HEADER_SEARCH_INPUT,options)}},loadAutoComplete:function(selector,options){var param={url:(typeof options.url==="undefined")?"":options.url,appendTo:(typeof options.appendTo==="undefined")?"":options.appendTo,minLength:(typeof options.minLength==="undefined")?this._autoCompleteMinLength:options.minLength,maxResult:(typeof options.maxResult==="undefined")?this._autoCompleteMaxResult:options.maxResult,menuClass:(typeof options.menuClass==="undefined")?"":options.menuClass};$(selector).autocomplete({source:function(request,response){$.ajax({url:param.url,dataType:"json",data:{tag:request.term},success:function(data){var result=data.slice(0,param.maxResult);var highlight="<strong>"+request.term+"</strong>";response($.map(result,function(item){return{label:highlight+item.substr(request.term.length),value:item}}));$(".ui-helper-hidden-accessible").addClass("hide")}})},minLength:param.minLength,appendTo:param.appendTo,open:function(){var list=$(".ui-autocomplete");list.removeAttr("class").addClass(param.menuClass).removeAttr("style");$(".ui-helper-hidden-accessible").addClass("hide")},select:function(e){var target=$(e.currentTarget);$(GAG.PageController.selectors.HEADER_SEARCH_INPUT).val(target.find(".ui-state-focus").first().text());target.closest("form").submit()}}).data("ui-autocomplete")._renderItem=function(ul,item){return $("<li></li>").data("ui-autocomplete-item",item).append("<a>"+item.label+"</a>").appendTo(ul)}},toggleMenu:function(selector){return !($(selector).toggleClass("hide").hasClass("hide"))},showMenu:function(selector){$(selector).removeClass("hide")},hideMenu:function(selector){$(selector).addClass("hide")},loadSpinner:function(elementId,options){var opts={lines:(typeof options.lines==="undefined")?10:options.lines,length:(typeof options.length==="undefined")?8:options.length,width:(typeof options.width==="undefined")?4:options.width,radius:(typeof options.radius==="undefined")?10:options.radius,corners:(typeof options.corners==="undefined")?1:options.corners,rotate:(typeof options.rotate==="undefined")?0:options.rotate,color:(typeof options.color==="undefined")?"#555":options.color,speed:(typeof options.speed==="undefined")?1:options.speed,trail:(typeof options.trail==="undefined")?60:options.trail,shadow:(typeof options.shadow==="undefined")?false:options.shadow,hwaccel:(typeof options.hwaccel==="undefined")?false:options.hwaccel,className:(typeof options.className==="undefined")?"spinner":options.className,zIndex:(typeof options.zIndex==="undefined")?2000000000:options.zIndex,top:(typeof options.top==="undefined")?"auto":options.top,left:(typeof options.left==="undefined")?"auto":options.left};var target=document.getElementById(elementId);var spinner=new Spinner(opts).spin(target)},updateLanguage:function(lang){var backUrl=GAG.Page.getBackUrl();var url="http://"+GAG.Page.getDomain()+"/profile/setlanguage/lang/"+lang+"?url="+backUrl;window.location.href=url},bindStickyNav:function(){if(!GAG.Page.isPostPage()){$(window).scroll($.proxy(function(){var nav=$(this.selectors.HEADER_TOP_NAV);$(this.selectors.SUBNAV_STICKY_STATIC).height(nav.height()+1);if($(window).scrollTop()>this._topVolatileElementHeight&&!nav.hasClass(this._CLASS_STICKY)){nav.css({top:0,position:"fixed","z-index":3});nav.addClass(this._CLASS_STICKY)}else{if($(window).scrollTop()<=this._topVolatileElementHeight&&nav.hasClass(this._CLASS_STICKY)){nav.removeClass(this._CLASS_STICKY);nav.removeAttr("style")}}},this))}},bindUserSettingElements:function(){$(this.selectors.HEADER_USER_MENU+", "+this.selectors.HEADER_USER_ITEM).click($.proxy(function(e){e.stopPropagation();var on=this.toggleMenu(this.selectors.HEADER_USER_ITEM);this.hidePopupMenu(on?this.selectors.HEADER_USER_ITEM:null)},this))},hidePopupMenu:function(exclude){var popupsSelectors=[this.selectors.HEADER_FUNNY_ITEM,this.selectors.HEADER_DOWNLOAD_ITEM,this.selectors.HEADER_USER_ITEM,this.selectors.HEADER_NOTIFICATION_ITEM,this.selectors.HEADER_CHAT_NOTIFICATION_ITEM,this.selectors.HEADER_UPLOAD_ITEM,GAG.PostController.selectors.MORE_SHARE_MENU];var map={};map[this.selectors.HEADER_FUNNY_ITEM]=this.selectors.HEADER_FUNNY_MENU;map[this.selectors.HEADER_DOWNLOAD_ITEM]=this.selectors.HEADER_DOWNLOAD_MENU;map[this.selectors.HEADER_USER_ITEM]=this.selectors.HEADER_USER_MENU;map[this.selectors.HEADER_NOTIFICATION_ITEM]=this.selectors.HEADER_NOTIFICATION_MENU;map[this.selectors.HEADER_CHAT_NOTIFICATION_ITEM]=this.selectors.HEADER_CHAT_NOTIFICATION_MENU;map[this.selectors.HEADER_UPLOAD_ITEM]=this.selectors.HEADER_UPLOAD_MENU;map[GAG.PostController.selectors.MORE_SHARE_MENU]=GAG.PostController.selectors.MORE_SHARE_BUTTON;if(exclude!=this.selectors.HEADER_NOTIFICATION_ITEM){GAG.PageController._isNotificationShown=false}if(exclude!=this.selectors.HEADER_CHAT_NOTIFICATION_ITEM){GAG.PageController._isChatNotificationShown=false}popupsSelectors=$.grep(popupsSelectors,function(value){return value!=exclude});$(popupsSelectors.join(",")).addClass("hide");for(var itemKey in map){var selector=map[itemKey];var addedClass="";switch(itemKey){case this.selectors.HEADER_FUNNY_ITEM:addedClass="selected-alt";break;case this.selectors.HEADER_USER_ITEM:addedClass="selected";selector=selector+" a";break;case this.selectors.HEADER_DOWNLOAD_ITEM:addedClass="selected";break;case this.selectors.HEADER_NOTIFICATION_ITEM:addedClass="selected";selector=selector+" a";break;case this.selectors.HEADER_CHAT_NOTIFICATION_ITEM:addedClass="selected";selector=selector+" a";break}if(itemKey!=exclude){$(selector).removeClass("selected-alt").removeClass("selected")}else{$(selector).addClass(addedClass)}}},bindPopupMenu:function(){$("body").on("click",$.proxy(function(e){this.hidePopupMenu(((e.ctrlKey||e.metaKey)&&($(e.target).parents(this.selectors.HEADER_NOTIFICATION_ITEM).length>0))?this.selectors.HEADER_NOTIFICATION_ITEM:null)},this))},bindGroupElements:function(){$(this.selectors.HEADER_FUNNY_MENU+", "+this.selectors.HEADER_FUNNY_ITEM).click($.proxy(function(e){e.stopPropagation();var on=this.toggleMenu(this.selectors.HEADER_FUNNY_ITEM,this.selectors.HEADER_FUNNY_MENU);this.hidePopupMenu(on?this.selectors.HEADER_FUNNY_ITEM:null)},this))},bindDownloadElements:function(){$(this.selectors.HEADER_DOWNLOAD_MENU+", "+this.selectors.HEADER_DOWNLOAD_ITEM).click($.proxy(function(e){e.stopPropagation();var on=this.toggleMenu(this.selectors.HEADER_DOWNLOAD_ITEM);this.hidePopupMenu(on?this.selectors.HEADER_DOWNLOAD_ITEM:null)},this))},bindNotificationElements:function(){$(this.selectors.HEADER_NOTIFICATION_ITEM).on("click",this.selectors.CLICK_EVENT_SELECTOR,$.proxy(this._handelClickEventTracking,this));$(this.selectors.HEADER_NOTIFICATION_ITEM).tinyscrollbar({invertscroll:true});GAG.PageController.getNotifications();$(document).click($.proxy(function(e){if(GAG.PageController._isNotificationShown){GAG.PageController._isNotificationShown=!GAG.PageController._isNotificationShown;if(!((e.ctrlKey||e.metaKey)&&($(e.target).parents(this.selectors.HEADER_NOTIFICATION_ITEM).length>0))){this.hideMenu(this.selectors.HEADER_NOTIFICATION_ITEM);$(this.selectors.HEADER_NOTIFICATION_MENU).removeClass("menu");$(this.selectors.HEADER_NOTIFICATION_MENU+" a").removeClass("selected")}}},this));$(this.selectors.HEADER_NOTIFICATION_MENU).click($.proxy(function(e){e.stopPropagation();e.preventDefault();if(GAG.PageController._isNotificationShown){this.hideMenu(this.selectors.HEADER_NOTIFICATION_ITEM);$(this.selectors.HEADER_NOTIFICATION_MENU).removeClass("menu");$(this.selectors.HEADER_NOTIFICATION_MENU+" a").removeClass("selected");this._handelClickEventTracking(e)}else{this.showMenu(this.selectors.HEADER_NOTIFICATION_ITEM);$(this.selectors.HEADER_NOTIFICATION_MENU).addClass("menu");$(this.selectors.HEADER_NOTIFICATION_MENU+" a").addClass("selected");$(this.selectors.HEADER_NOTIFICATION_ITEM).data("plugin_tinyscrollbar").update({invertscroll:true});GAG.PageController.markNotificationsAsRead();this._handelClickEventTracking(e);this.hidePopupMenu(this.selectors.HEADER_NOTIFICATION_ITEM)}GAG.PageController._isNotificationShown=!GAG.PageController._isNotificationShown},this))},bindChatNotificationElements:function(){$(this.selectors.HEADER_CHAT_NOTIFICATION_ITEM).on("click",this.selectors.CLICK_EVENT_SELECTOR,$.proxy(this._handelClickEventTracking,this));$(this.selectors.HEADER_CHAT_NOTIFICATION_ITEM).tinyscrollbar({invertscroll:true});GAG.PageController.getChatNotifications();$(document).click($.proxy(function(e){if(GAG.PageController._isChatNotificationShown){GAG.PageController._isChatNotificationShown=!GAG.PageController._isChatNotificationShown;if(!((e.ctrlKey||e.metaKey)&&($(e.target).parents(this.selectors.HEADER_CHAT_NOTIFICATION_ITEM).length>0))){this.hideMenu(this.selectors.HEADER_CHAT_NOTIFICATION_ITEM);$(this.selectors.HEADER_CHAT_NOTIFICATION_MENU).removeClass("menu");$(this.selectors.HEADER_CHAT_NOTIFICATION_MENU+" a").removeClass("selected")}}},this));$(this.selectors.HEADER_CHAT_NOTIFICATION_MENU).click($.proxy(function(e){e.stopPropagation();e.preventDefault();if(GAG.PageController._isChatNotificationShown){this.hideMenu(this.selectors.HEADER_CHAT_NOTIFICATION_ITEM);$(this.selectors.HEADER_CHAT_NOTIFICATION_MENU).removeClass("menu");$(this.selectors.HEADER_CHAT_NOTIFICATION_MENU+" a").removeClass("selected");this._handelClickEventTracking(e)}else{this.showMenu(this.selectors.HEADER_CHAT_NOTIFICATION_ITEM);$(this.selectors.HEADER_CHAT_NOTIFICATION_MENU).addClass("menu");$(this.selectors.HEADER_CHAT_NOTIFICATION_MENU+" a").addClass("selected");$(this.selectors.HEADER_CHAT_NOTIFICATION_ITEM).data("plugin_tinyscrollbar").update({invertscroll:true});GAG.PageController.markChatNotificationsAsRead();this._handelClickEventTracking(e);this.hidePopupMenu(this.selectors.HEADER_CHAT_NOTIFICATION_ITEM)}GAG.PageController._isChatNotificationShown=!GAG.PageController._isChatNotificationShown},this))},bindUploadElements:function(){$(this.selectors.HEADER_UPLOAD_MENU).click($.proxy(function(e){e.stopPropagation();this.toggleMenu(this.selectors.HEADER_UPLOAD_ITEM);this.hidePopupMenu(this.selectors.HEADER_UPLOAD_ITEM);if(GAG.Configs.get("user.showCaptcha")){GAG.PageController.preloadCaptchaScript()}},this));$(".badge-upload-url").on("click",function(e){e.preventDefault();$("#jsid-upload-url-btn").trigger("click")});$(".badge-upload-image").on("click",function(e){e.preventDefault();$("#jsid-upload-file-btn").trigger("click")});$(".badge-upload-selector").on("click",function(e){e.preventDefault();$(GAG.UploadController.selectors.UPLOAD_TITLE_INPUT).val("");$("#jsid-source-input").addClass("hide").val("");$("#upload-file input[type=checkbox]").removeAttr("checked");$("#upload-file p.error-message").text("");GAG.OverlayController.showOverlay("#modal-upload")})},bindCustomizeElements:function(){$(this.selectors.PERSONALISE_BTN_SHOW).on("click",function(e){e.preventDefault();$(this).toggleClass("selected");$(GAG.PageController.selectors.PERSONALISE_SELECTOR).slideToggle("fast",function(){})});$(this.selectors.PERSONALISE_OPTION).on("click",function(e){e.preventDefault();$(this).toggleClass("on");var input=$(this).find("input");if(input.val()=="1"){input.val("")}else{input.val("1")}});$(this.selectors.PERSONALISE_OPTION_NSFW).on("click",function(e){e.preventDefault();var value=($(this).find("input").val()=="1")?0:1;if(!GAG.User.isLoggedIn()){var options=GAG.Page.getCookieOptions();options.domain=GAG.Configs.get("page.cookie_domain");$.cookie(GAG.PageController._sidePersonalizeCookieKey,1,options);GAG.AccountController.setSafeMode(value,window.location.href)}});$(this.selectors.PERSONALISE_BTN_SAVE).on("click",function(e){e.preventDefault();$(GAG.PageController.selectors.PERSONALISE_SELECTOR).slideUp("fast",function(){GAG.PageController._personaliseFormSubmit()})});$(this.selectors.PERSONALISE_BTN_RESET).on("click",function(e){e.preventDefault();var msg="This will remove all your manual personalisation settings.";if(confirm(msg)){$(GAG.PageController.selectors.PERSONALISE_FORM+" input[name=customize_reset]").val("1");$(GAG.PageController.selectors.PERSONALISE_SELECTOR).slideUp("fast",function(){GAG.PageController._personaliseFormReset()})}})},bindTickerMouseenter:function(){$(this.selectors.SIDEBAR_TICKER_ITEM).one("mouseenter",function(){GAG.GA.track("ticker","hover","sidebar")})},bindTickerElements:function(){var self=this;$(this.selectors.SIDEBAR_TICKER_ITEM).tinyscrollbar({invertscroll:true});$(window).resize(function(){if($(window).height()>450){$(self.selectors.SIDEBAR_TICKER_ITEM).show();$(self.selectors.SIDEBAR_TICKER_ITEM).find(".viewport").height($(window).height()-400);$(self.selectors.SIDEBAR_TICKER_ITEM).data("plugin_tinyscrollbar").update()}else{$(self.selectors.SIDEBAR_TICKER_ITEM).hide();$(self.selectors.SIDEBAR_TICKER_ITEM).find(".viewport").height(0);$(self.selectors.SIDEBAR_TICKER_ITEM).data("plugin_tinyscrollbar").update()}});this.bindTickerItem();$(window).trigger("resize")},showTickerOverlay:function(post){var self=this;var wrapper=$(self.selectors.SIDEBAR_TICKER_OVERLAY).parent();var html=$(self.selectors.SIDEBAR_TICKER_OVERLAY).clone();$(self.selectors.SIDEBAR_TICKER_OVERLAY).remove();wrapper.append(html);var mediaHtml='<img src="'+post.imageUrl460s+'" style="height:'+post.imageHeight460s+';" />';if(post.isAnimated){mediaHtml='<video preload="auto" poster="'+post.imageUrl460s+'" style="min-height:'+post.imageHeight460sv+"px;width: "+post.imageWidth460sv+'px;" loop="" autoplay="autoplay">';mediaHtml+='    <source src="'+post.imageUrl460sv+'" type="video/mp4">';mediaHtml+='    <source src="'+post.imageUrl460svwm+'" type="video/webm">';mediaHtml+="</video>"}var commentUrl=post.entryUrl+"#comment";$(self.selectors.SIDEBAR_TICKER_OVERLAY_OVERVIEW).find(".badge-entry-entity").attr("id","jsid-sidebar-ticker-entry-"+post.entryKey).data("entry-url",post.entryUrl).data("entry-id",post.entryKey);$(self.selectors.SIDEBAR_TICKER_OVERLAY_OVERVIEW).find(".badge-facebook-share").attr("data-share",post.entryUrl+"?ref=fb.s").data("track","social,fb.s,,,d,"+post.entryKey+",l").data("evt","Facebook-Share,TickerClicked,"+post.entryUrl);$(self.selectors.SIDEBAR_TICKER_OVERLAY_OVERVIEW).find(".badge-twitter-share").attr("data-share",post.entryUrl+"?ref=t").attr("data-title",post.title).data("track","social,t.s,,,d,"+post.entryKey+",l").data("evt","Twitter-Share,TickerClicked,"+post.entryUrl);$(self.selectors.SIDEBAR_TICKER_OVERLAY_TITLE).text(post.title).attr("href",post.entryUrl);$(self.selectors.SIDEBAR_TICKER_OVERLAY_POINT).attr("href",post.entryUrl).find("span").text(post.votes);$(self.selectors.SIDEBAR_TICKER_OVERLAY_COMMENTCOUNT).attr("href",commentUrl).find("span").text(post.comments);$(self.selectors.SIDEBAR_TICKER_OVERLAY_IMG_LINK).attr("href",post.entryUrl);$(self.selectors.SIDEBAR_TICKER_OVERLAY_IMG_LINK).html(mediaHtml);$(GAG.PostController.selectors.ENTRY_COMMENT_BUTTON).attr("href",commentUrl);$(self.selectors.SIDEBAR_TICKER_OVERLAY).find(GAG.PostController.selectors.ENTRY_UPVOTE_BUTTON).removeClass("active");$(self.selectors.SIDEBAR_TICKER_OVERLAY).find(GAG.PostController.selectors.ENTRY_DOWNVOTE_BUTTON).removeClass("active");$("body").css("overflow","hidden");$(self.selectors.SIDEBAR_TICKER_OVERLAY).parent().removeClass("hide");self.bindTickerItemCommentBox(post.entryUrl);GAG.CacheableVoteController.process()},bindTickerItem:function(){var self=this;$("#container").on("click",function(){$("body").css("overflow","");$(self.selectors.SIDEBAR_TICKER_OVERLAY).parent().addClass("hide")});$(this.selectors.SIDEBAR_TICKER_ITEM).on("click",this.selectors.SIDEBAR_TICKER_ITEM_LINK,function(e){e.stopPropagation();var entryKey=$(this).data("entrykey");if(!self._tickerItems[entryKey]){return false}var post=self._tickerItems[entryKey];self.showTickerOverlay(post);GAG.GA.track("ticker","clicked","sidebar");return false});var tickerItemHoverTimeout;$(this.selectors.SIDEBAR_TICKER_ITEM).on("mouseenter",this.selectors.SIDEBAR_TICKER_ITEM_LINK,function(e){e.stopPropagation();var entryKey=$(this).data("entrykey");if(!self._tickerItems[entryKey]){return false}var post=self._tickerItems[entryKey];tickerItemHoverTimeout=setTimeout(function(){self.showTickerOverlay(post);GAG.GA.track("ticker","mouseover","sidebar")},2000)}).on("mouseleave",this.selectors.SIDEBAR_TICKER_ITEM_LINK,function(e){e.stopPropagation();clearTimeout(tickerItemHoverTimeout)})},bindTickerItemCommentBox:function(entryUrl){var self=this;if(window.csAsyncInited){window.csAsyncInit();GAG.PostController.renderCommentElement(entryUrl,GAG.Configs.get("page.default_comment_type"))}else{window.pendingComment={url:entryUrl,commentType:GAG.Configs.get("page.default_comment_type")};var retryCount=0;window.csAsyncInit=function(){if(!window.GAG){retryCount++;if(retryCount<20){setTimeout(function(){window.csAsyncInit()},500);return}}else{commentAuth=GAG.Configs.get("user.comment_auth");if(!commentAuth){retryCount++;if(retryCount<20){setTimeout(function(){window.csAsyncInit()},500)}if(window.csAsyncInited==true){return}}}window.CS2.init({target:"jsid-ticker-comment-sys",count:10,appId:GAG.Configs.get("page.comment_app_id"),host:((commentAuth)?GAG.Configs.get("page.comment_host"):GAG.Configs.get("page.comment_host_cdn")),apiHost:GAG.Configs.get("page.comment_host"),cdnHost:GAG.Configs.get("page.comment_host_cdn"),cross:GAG.Configs.get("page.comment_proxy"),loginUrl:GAG.Configs.get("page.comment_login_url"),auth:commentAuth,bucketId:GAG.Configs.get("page.comment_bucket_id")});window.csAsyncInited=true;if(window.GAG){window.GAG.PostController.renderPendingComment()}};(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id)){return}js=d.createElement(s);js.id=id;js.src=GAG.Configs.get("page.comment_js_url");fjs.parentNode.insertBefore(js,fjs)}(document,"script","comment-sdk"))}},bindTickerLoadmore:function(){var self=this;$(this.selectors.SIDEBAR_TICKER_ITEM).bind("move",function(){self.tickerLoadMore(false)});setTimeout(function(){self.tickerLoadMore(true)},3000)},tickerLoadMore:function(firstLoad){var self=this;var overview=$(this.selectors.SIDEBAR_TICKER_ITEM).find(".overview");var scrollbarData=$(this.selectors.SIDEBAR_TICKER_ITEM).data("plugin_tinyscrollbar");if(self._tickerNoMoreItem){return false}var threshold=0.9;var positionCurrent=scrollbarData.contentPosition+scrollbarData.viewportSize;var positionEnd=scrollbarData.contentSize*threshold;var template="";if(firstLoad||(!self._tickerLoadingMore&&positionCurrent>=positionEnd)){self._tickerLoadingMore=true;if(self._tickerLoadMorePage>0){GAG.GA.track("ticker","load-"+self._tickerLoadMorePage,"sidebar")}$.ajax({type:"GET",crossDomain:true,dataType:"jsonp",jsonpCallback:"tickerData",cache:"true",url:GAG.FeaturedController._endPoint+"/read/ajax-comment?type=comment&index="+self._tickerLoadMoreIndex+"&length=20&timerange=24&__bucketId=00070",success:function(data){if(data.result.length==0){$(self.selectors.SIDEBAR_TICKER_LOADING_SPINNER).parent().remove();self._tickerLoadingMore=false;self._tickerNoMoreItem=true;scrollbarData.update("relative");return false}$.each(data.result,function(i,post){$(self.selectors.SIDEBAR_TICKER_LOADING_SPINNER).parent().remove();self._tickerItems[post.entryKey]=post;template+='<li>                            <a class="badge-sidebar-ticker-items-link" data-entryKey="'+post.entryKey+'">                            <div class="thumbnail">                                <img src="'+post.imageUrl+'" />                            </div>                            <div class="info">                            <h3>'+post.title+"</h3>                            <p>"+post.commentCount+" comments</p>                            </div><!-- / into -->                            </a>                        </li>";self._tickerLoadingMore=false});template+='<li>                            <div class="loading">                            <a class="btn spin" href="javascript:void(0);">Loading</a>                            </div>                        </li>';overview.append(template);self._tickerLoadMoreIndex+=20;self._tickerLoadMorePage+=1;scrollbarData.update("relative")},error:function(){$(self.selectors.SIDEBAR_TICKER_LOADING_SPINNER).parent().remove();self._tickerLoadingMore=false;self._tickerNoMoreItem=true;scrollbarData.update("relative");return false}})}},_personaliseFormReset:function(){var options=GAG.Page.getCookieOptions();options.domain=GAG.Configs.get("page.cookie_domain");$(GAG.PageController.selectors.PERSONALISE_FORM).submit()},_personaliseFormSubmit:function(){var options=GAG.Page.getCookieOptions();options.domain=GAG.Configs.get("page.cookie_domain");$(GAG.PageController.selectors.PERSONALISE_FORM).submit()},resetCustomize:function(){$("#form-modal-customize").find("input:checkbox").each(function(){var target=$(this);if(target.data("checked")){target.attr("checked","checked")}else{target.removeAttr("checked")}})},bindFooterNavElements:function(){var scrollToTopBtns=$(this.selectors.SCROLL_TO_TOP);scrollToTopBtns.on("click",function(e){e.preventDefault();GAG.KeyboardController.scrollToTop()})},checkFooterNavElements:function(){var windowTop=$(window).scrollTop();if(windowTop>this._showFooterNavAfter&&!$(this.selectors.FOOTER_NAV).hasClass(this._CLASS_SHOW_BACK_TO_TOP)){$(this.selectors.FOOTER_NAV).addClass(this._CLASS_SHOW_BACK_TO_TOP)}else{if(windowTop<=this._showFooterNavAfter&&$(this.selectors.FOOTER_NAV).hasClass(this._CLASS_SHOW_BACK_TO_TOP)){$(this.selectors.FOOTER_NAV).removeClass(this._CLASS_SHOW_BACK_TO_TOP)}}},bindToastElements:function(){if($(this.selectors.HEADER_TOAST).is(":hidden")){var toastMessage=GAG.Toast.getToast();if(!jQuery.isEmptyObject(toastMessage)){this.showToast(toastMessage.text,toastMessage.color,5000)}}},bindCloseAdvice:function(){$(".badge-advice-close").click($.proxy(function(event){event.preventDefault();var target=$(event.currentTarget);$(".badge-announcement-banner").addClass("hide");$(".badge-advice").removeClass("before");$.cookie("announcement_banner",0,GAG.Page.getCookieOptions())},this))},bindEmailSubscription:function(){$(this.selectors.CONTAINTER).on("click",this.selectors.SIDEBAR_EMAIL_SCRIPTION_BTN,$.proxy(this._emailSubscriptionButtonHandler,this));$(this.selectors.CONTAINTER).on("keypress",this.selectors.SIDEBAR_EMAIL_SCRIPTION_INPUT,$.proxy(this._emailSubscriptionKeypressHandler,this))},_emailSubscriptionKeypressHandler:function(event){if(event.which==13){event.preventDefault();this._emailSubscriptionButtonHandler(event)}},_emailSubscriptionButtonHandler:function(event){if(this._isSigningUpEmailSubscription){return}this._isSigningUpEmailSubscription=true;var $target=$(event.target);var $root=$target.parents(this.selectors.SIDEBAR_EMAIL_SCRIPTION_ELEM);var email=$root.find(this.selectors.SIDEBAR_EMAIL_SCRIPTION_INPUT).val();$root.find(this.selectors.SIDEBAR_EMAIL_SCRIPTION_INPUT).removeClass("error");var userId=GAG.Configs.get("user.id");if(!userId){userId=""}var emailParam={email:email,userId:userId};var that=this;var emailRegex=new RegExp("^([a-zA-Z0-9._-]+)@([a-zA-Z0-9.-]+)\\.([a-zA-Z]{2,4})$");if(emailRegex.test(email)){var req=$.ajax({url:"/email-subscription",data:emailParam,dataType:"json",type:"POST",success:function(data){$root.find(that.selectors.SIDEBAR_EMAIL_SCRIPTION_TOGGLE_HIDE).toggleClass("hide");that._isSigningUpEmailSubscription=false},error:function(data){that._isSigningUpEmailSubscription=false}})}else{$root.find(this.selectors.SIDEBAR_EMAIL_SCRIPTION_INPUT).addClass("error");this._isSigningUpEmailSubscription=false}},_trackGaEvent:function(el){var eventData=el.attr("data-evt");if(!eventData){return}eventData+="";var gaValues=eventData.split(",");var category="",action="",label="",value=1;category=gaValues.shift();action=gaValues.shift();label=gaValues.shift();GAG.GA.track(category,action,label,value)},_trackEvent:function(el){var eventData=el.attr("data-track");if(!eventData||eventData==undefined){return}eventData+="";var values=eventData.split(",");var action=values.shift();var value=values.shift();var label=values.shift();var labelValue=values.shift();var platform=values.shift();var entry=values.shift();var view=values.shift();var params={label:label,labelValue:labelValue,platform:platform,entry:entry,view:view};GAG.Track.event(action,value,params)},_handelClickEventTracking:function(event){var el=$(event.currentTarget);this._trackGaEvent(el);this._trackEvent(el);var tagName=el.prop("tagName");var href=el.attr("href")+"";var openInNewTab=el.attr("target");var suppressFollowing=el.is(this.selectors.CLICK_EVENT_NOFOLLOW_SELECTOR);if(!suppressFollowing&&tagName=="A"&&(href.indexOf("http")===0||href.indexOf("/")===0)&&!openInNewTab){if(event){event.preventDefault()}var redirect="window.location.href = '"+href+"';";window.setTimeout(redirect,100)}},bindEventTracking:function(){$(this.selectors.CONTAINTER).on("click",this.selectors.CLICK_EVENT_SELECTOR,$.proxy(this._handelClickEventTracking,this))},_cleanToastColor:function(toast){toast=$(toast);var classes=toast.attr("class").split(/\s+/);for(var i=0;i<classes.length;i++){if(classes[i].substr(0,12)=="toast-color-"){toast.removeClass(classes[i])}}},setPageTitle:function(title){this.docTitle=title;var unreadCount=GAG.PushController.unreadCount;var titlePreStr=unreadCount>0?"("+unreadCount+") ":"";document.title=titlePreStr+title},setPageTitleWithSpecialChars:function(title){var div=document.createElement("div");div.innerHTML=title;this.setPageTitle(div.firstChild.nodeValue)},refreshPageTitle:function(){this.setPageTitle(this.docTitle)},getWindowEffectiveScrollTop:function(){if($(window).scrollTop()<this._topVolatileElementHeight){return this._topVolatileElementHeight+this._topStickyElementHeight}return $(window).scrollTop()+this._topStickyElementHeight},scrollToTop:function(){$("html, body").animate({scrollTop:0},300)},ensureLoggedIn:function(nextUrl){if(GAG.User.isLoggedIn()){return true}else{GAG.AccountController.presentSignupForm(nextUrl);return false}},setCustomizeElementValues:function(){$(this.selectors.PERSONALISE_OPTION).each(function(){var li=$(this).closest("li");var switchOn=true;if(($(this).find("input[name=show_nsfw]").length>0)&&li){switchOn=!GAG.PageController.isSafeModeEnabled();$(this).find("input[name=show_nsfw]").val((switchOn?1:0))}if(switchOn){$(li).addClass("selected");$(this).addClass("on")}else{$(li).removeClass("selected");$(this).removeClass("on")}})},checkCustomizeElementsShowStatus:function(){if(!GAG.Page.isListingPage()){return}var shouldShow=(GAG.Page.getPageKey()=="hot")&&($.cookie(this._sidePersonalizeCookieKey)==null);shouldShow=shouldShow||($.cookie(this._sidePersonalizeCookieKey)==1);if(shouldShow){$(this.selectors.PERSONALISE_SELECTOR).show();$(this.selectors.PERSONALISE_BTN_SHOW).addClass("selected");var options=GAG.Page.getCookieOptions();options.domain=GAG.Configs.get("page.cookie_domain");$.cookie(this._sidePersonalizeCookieKey,0,options)}},isAutoAnimatedGifEnabled:function(){return true},isMp4AutoPlay:function(){var isOpera=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;var isFirefox=typeof InstallTrigger!=="undefined";var isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0;var isChrome=!!window.chrome&&!isOpera;var isIE=
/*@cc_on!@*/
false||!!document.documentMode;var ua=navigator.userAgent.toLowerCase();var isAndroid=ua.indexOf("android")>-1;var isAndroidMobile=ua.indexOf("android")>-1&&ua.indexOf("mobile");var isiPad=navigator.userAgent.match(/iPad/i)!=null;var isiPhone=((navigator.userAgent.match(/iPhone/i)!=null)||(navigator.userAgent.match(/iPod/i))!=null);if(isChrome&&!isAndroid){return true}if(isFirefox){return true}if(isIE){return true}if(isOpera){return true}return false},getScrollAutoPlayMp4State:function(){var isOpera=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;var isFirefox=typeof InstallTrigger!=="undefined";var isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0;var isChrome=!!window.chrome&&!isOpera;var isIE=
/*@cc_on!@*/
false||!!document.documentMode;var ua=navigator.userAgent.toLowerCase();var isAndroid=ua.indexOf("android")>-1;var isAndroidMobile=ua.indexOf("android")>-1&&ua.indexOf("mobile");var isiPad=navigator.userAgent.match(/iPad/i)!=null;var isiPhone=((navigator.userAgent.match(/iPhone/i)!=null)||(navigator.userAgent.match(/iPod/i))!=null);if(isiPad||isiPhone||isAndroid){return 0}if(isSafari){return 1}if(isChrome&&!isAndroid){return 2}if(isFirefox){return 2}if(isIE){return 2}if(isOpera){return 2}return 0},isSafeModeEnabled:function(){return($.cookie(GAG.PageController._safeModeCookieKey)!=="0")},loadAnimatedGif:function(){if(GAG.Page.isPostPage()&&this.isMp4AutoPlay()){$(GAG.PostController.selectors.ENTRY_ANIMATED_COVER).each(function(){if(!$(this).hasClass("badge-auto-clicked")){$(this).click();$(this).addClass("badge-auto-clicked")}})}else{$(GAG.PostController.selectors.ENTRY_ANIMATED_PLAY_BUTTON).each(function(){if(!$(this).hasClass("badge-auto-clicked")){$(this).removeClass("hide");$(this).addClass("badge-auto-clicked")}})}},showConfirmEmailBanner:function(userName){$(this.selectors.HEADER_BANNER_CONFIRM_EMAIL_USERNAME).text(userName);$(this.selectors.HEADER_BANNER_CONFIRM_EMAIL).removeClass("hide");this.calculateHeights()},showToast:function(message,color,duration){var toast=$(this.selectors.HEADER_TOAST);toast.hide();this._cleanToastColor(toast);$(this.selectors.HEADER_TOAST).addClass("toast-color-"+color);$(this.selectors.HEADER_TOAST_MESSAGE).text(message);$(this.selectors.HEADER_TOAST_CLOSE).click($.proxy(function(event){event.preventDefault();this.hideToast()},this));$(this.selectors.HEADER_TOAST).fadeIn(this._toastFadeDuration);if(typeof duration!="undefined"){setTimeout($.proxy(function(){this.hideToast()},this),duration)}},hideToast:function(){$(this.selectors.HEADER_TOAST).fadeOut(this._toastFadeDuration)},switchToTheme:function(themeId){$(this.selectors.THEME_FILES).attr("media","none");$(this.selectors.THEME_FILES+"[data-theme-id="+themeId+"]").attr("media","screen,projection")},getNotifications:function(){if(GAG.PageController._isUpdatingNotification){return}GAG.PageController._isUpdatingNotification=true;var url="/notifications";if(!GAG.PushController._lastBadgetTs){url=url+"?includeReadState=1"}var req=$.ajax({url:url,dataType:"json",success:function(data){GAG.PageController._isUpdatingNotification=false;GAG.PageController._lastNotificationUpdateTs=(new Date()).getTime();GAG.PageController.updateNotification(data);if(data["read-state"]){GAG.PushController.getNsReadStateCb({status:"OK",payload:data["read-state"],doNotGetNoti:true,error:""})}},error:function(data){GAG.PageController._isUpdatingNotification=false}})},getChatNotifications:function(){if(GAG.PageController._isUpdatingChatNotification){return}GAG.PageController._isUpdatingChatNotification=true;var url="/chat_notifications";if(!GAG.PushController._lastBadgetTs){url=url+"?includeReadState=1"}var req=$.ajax({url:url,dataType:"json",success:function(data){GAG.PageController._isUpdatingChatNotification=false;GAG.PageController._lastChatNotificationUpdateTs=(new Date()).getTime();GAG.PageController.updateChatNotification(data);if(data["read-state"]){GAG.PushController.getChatNsReadStateCb({status:"OK",payload:data["read-state"],doNotGetNoti:true,error:""})}},error:function(data){GAG.PageController._isUpdatingChatNotification=false}})},markNotificationsAsRead:function(){if(GAG.PageController._isMarkingNotificationAsRead){return}GAG.PageController._isMarkingNotificationAsRead=true;var notiUrl=GAG.Configs.get("user.noti.read_state_url");var notiParams=GAG.Configs.get("user.noti.read_state_params");var req=$.ajax({url:notiUrl,data:notiParams,dataType:"json",type:"POST",success:function(data){GAG.PageController._isMarkingNotificationAsRead=false;if(data.status=="OK"){GAG.PushController.updateNotificationUnreadCount(0)}},error:function(data){GAG.PageController._isMarkingNotificationAsRead=false}})},markChatNotificationsAsRead:function(){if(GAG.PageController._isMarkingChatNotificationAsRead){return}GAG.PageController._isMarkingChatNotificationAsRead=true;var notiUrl=GAG.Configs.get("user.chat_noti.read_state_url");var notiParams=GAG.Configs.get("user.chat_noti.read_state_params");var req=$.ajax({url:notiUrl,data:notiParams,dataType:"json",type:"POST",success:function(data){GAG.PageController._isMarkingChatNotificationAsRead=false;if(data.status=="OK"){GAG.PushController.updateChatNotificationUnreadCount(0)}},error:function(data){GAG.PageController._isMarkingChatNotificationAsRead=false}})},markNotificationItemAsRead:function(target,actionType,objectId){if($(target).data("markedRead")){return}$.ajax({url:"/notifications/mark-item",data:{actionType:actionType,objectId:objectId,state:1},dataType:"json",type:"POST",success:function(data){if(data.status=="OK"){$(target).data("markedRead",true).removeClass("new")}},error:function(data){}})},markChatNotificationItemAsRead:function(target,actionType,objectId){if($(target).data("markedRead")){return}$.ajax({url:"/chat_notifications/mark-item",data:{actionType:actionType,objectId:objectId,state:1},dataType:"json",type:"POST",success:function(data){if(data.status=="OK"){$(target).data("markedRead",true).removeClass("new")}},error:function(data){}})},updateNotification:function(data){var container=$(this.selectors.HEADER_NOTIFICATION_CONTAINER);container.empty();if(data.status=="OK"){if(data.items.length>0){for(var i=0;i<data.items.length;i++){container.append(data.items[i]["message"])}if(GAG.PushController.unreadCount>20){$(this.selectors.HEADER_NOTIFICATION_SEE_ALL).text("See "+(GAG.PushController.unreadCount-20)+" more")}else{$(this.selectors.HEADER_NOTIFICATION_SEE_ALL).text("See all")}}else{container.append(data.message)}}else{container.append(data.message)}$(this.selectors.HEADER_NOTIFICATION_ITEM).tinyscrollbar({invertscroll:true})},updateChatNotification:function(data){var container=$(this.selectors.HEADER_CHAT_NOTIFICATION_CONTAINER);container.empty();if(data.status=="OK"){if(data.items.length>0){for(var i=0;i<data.items.length;i++){container.append(data.items[i]["message"])}}else{container.append(data.message)}}else{container.append(data.message)}$(this.selectors.HEADER_CHAT_NOTIFICATION_ITEM).tinyscrollbar({invertscroll:true})},updateTimeZoneOffset:function(){var timezoneOffset=new Date().getTimezoneOffset()/-60;$.cookie("gag_tz",timezoneOffset,{domain:GAG.Configs.get("page.cookie_domain"),expires:365,path:"/"})},syncAccountSystemSession:function(){if(GAG.User.isLoggedIn()){var sessionImageUrl=GAG.Configs.get("user.acs_url");if(sessionImageUrl){var img=new Image();img.src=sessionImageUrl;$.cookie("__ssid","0",{domain:GAG.Configs.get("page.cookie_domain"),expires:1,path:"/"})}}},initUserFunction:function(){$(this.selectors.HEADER_USER_FUNCTION_PLACEHOLDER).addClass("hide");if(GAG.User.isLoggedIn()){if($(this.selectors.HEADER_USER_FUNCTION).hasClass("hide")){GAG.PageController.bindNotificationElements();if(GAG.Configs.get("user.chat_noti.show_chat_notification")){GAG.PageController.bindChatNotificationElements()}}$(this.selectors.HEADER_VISITOR_FUNCTION).addClass("hide");if(GAG.Configs.get("user.chat_noti.show_chat_notification")){$(this.selectors.HEADER_DOWNLOAD_BTN_CONTAINER).addClass("hide")}else{$(this.selectors.HEADER_DOWNLOAD_BTN_CONTAINER).removeClass("hide")}$(this.selectors.HEADER_USER_FUNCTION).removeClass("hide")}else{$(this.selectors.HEADER_USER_FUNCTION).addClass("hide");$(this.selectors.HEADER_VISITOR_FUNCTION).removeClass("hide");$(this.selectors.HEADER_DOWNLOAD_BTN_CONTAINER).removeClass("hide")}},updateSignUpReferrer:function(){if(!GAG.User.isLoggedIn()&&$.cookie(this._signUpReferrerCookieKey)==null){$.cookie(this._signUpReferrerCookieKey,document.referrer,{domain:GAG.Configs.get("page.cookie_domain"),expires:365,path:"/"})}},captchaLoaded:[],showCaptcha:function(prefix){if(!this.captchaLoaded[prefix]){$("#jsid-"+prefix+"-captchawrapper").show();var apiKey=$("#jsid-"+prefix+"-captchadiv").attr("data-apiKey");$("#recaptcha_image").attr("id",$("#recaptcha_image").data("id"));$("#recaptcha_response_field").attr("id",$("#recaptcha_response_field").data("id"));$("#jsid-"+prefix+"-recaptcha_image").attr("id","recaptcha_image");$("#jsid-"+prefix+"-recaptcha_response_field").attr("id","recaptcha_response_field");try{if(Recaptcha){Recaptcha.create(apiKey,"#jsid-"+prefix+"-captchadiv",{tabindex:1,theme:"custom",custom_theme_widget:"jsid-"+prefix+"-recaptcha_widget",lang:"en",custom_translations:{instructions_visual:"Type the two words:"},callback:function(){GAG.PageController.captchaLoaded[prefix]=true}})}}catch(e){}}},preloadCaptchaScript:function(){var recaptchaScript="//www.google.com/recaptcha/api/js/recaptcha_ajax.js";if(!GAG.Utils.scriptLoaded(recaptchaScript)){GAG.Utils.loadScript(recaptchaScript,false)}}});GAG.WebNotiController=$.extend({},new GAG.Controller(),{COOKIE_SLEEP_KEY:"web-not-sleep-key",init:function(){},requestPermission:function(message){Notification.requestPermission(function(status){if(Notification.permission!==status){Notification.permission=status}if(message&&Notification.permission==="granted"){GAG.WebNotiController.initNotification(message)}})},show:function(message){if(!window.Notification){console.log("No notification");return}if(Notification.permission==="granted"){GAG.WebNotiController.initNotification(message);return}if(Notification.permission!=="denied"){GAG.WebNotiController.requestPermission(message)}},initNotification:function(message){var cookie=$.cookie(GAG.WebNotiController.COOKIE_SLEEP_KEY);if(cookie){console.log("WebNoti skipped");GAG.GA.track("Notification-Web","Skipped","",0);return}var n=new Notification(message,{tag:"nineGAGNotification",icon:GAG.Configs.get("page.assets_url")+"/img/logo-noti-black.png"});n.onclick=GAG.WebNotiController.clickHandler;n.onclose=GAG.WebNotiController.closeHandler;n.onerror=GAG.WebNotiController.errorHandler;GAG.GA.track("Notification-Web","Sent","",0)},clickHandler:function(e){try{GAG.PageController.showMenu(GAG.PageController.selectors.HEADER_NOTIFICATION_ITEM);$(GAG.PageController.selectors.HEADER_NOTIFICATION_MENU).addClass("menu");$(GAG.PageController.selectors.HEADER_NOTIFICATION_MENU+" a").addClass("selected");$(GAG.PageController.selectors.HEADER_NOTIFICATION_ITEM).data("plugin_tinyscrollbar").update({invertscroll:true});GAG.PageController.markNotificationsAsRead();GAG.PageController.hidePopupMenu(GAG.PageController.selectors.HEADER_NOTIFICATION_ITEM);window.focus();$("html, body").animate({scrollTop:$(GAG.PageController.selectors.HEADER_NOTIFICATION_ITEM).offset().top},200);GAG.GA.track("Notification-Web","Clicked","",0)}catch(err){console.log(err.message)}},closeHandler:function(e){var date=new Date();date.setTime(date.getTime()+(GAG.Configs.get("page.webNotiSleepTtl")*1000));$.cookie(GAG.WebNotiController.COOKIE_SLEEP_KEY,1,{path:"/",expires:date});GAG.GA.track("Notification-Web","Closed","",0)},errorHandler:function(e){}});GAG.PushController=$.extend({},new GAG.Controller(),{DELAY:1000,INIT_DELAY:2000,_lastBadgetTs:false,_minBadgeInterval:5000,_regularLongPollingInterval:180000,_checkUpdateQueueInterval:1000,_isRequestingUpdate:false,_isRequestingChatUpdate:false,unreadCount:0,chatUnreadCount:0,init:function(){},onWindowLoad:function(){if(!GAG.Configs.get("user.id")){return}setTimeout($.proxy(function(){this._initPush();if(GAG.Configs.get("user.chat_noti.show_chat_notification")){this._initChatPush()}this._initBadgeUpdate()},this),this.INIT_DELAY)},selectors:{NOTIFICATION_UNREAD_COUNT:"#jsid-notification-unread-count",CHAT_NOTIFICATION_UNREAD_COUNT:"#jsid-chat-notification-unread-count"},_log:function(msg){},_pullNotificatons:function(data){var counter=$(this.selectors.NOTIFICATION_UNREAD_COUNT);if(!counter){return}this.putToUpdateQueue(data)},_initPush:function(){function messageReceived(text,id,channel){var data={type:"noti",message:text,id:id,channel:channel};GAG.PushController._log(data);GAG.PushController._pullNotificatons(data)}var options={host:GAG.Configs.get("user.noti.host"),port:GAG.Configs.get("user.noti.port"),modes:GAG.Configs.get("user.noti.modes")};if(!options.host||!options.port){return}var pushstream=new PushStream(options);pushstream.onmessage=messageReceived;var channels=GAG.Configs.get("user.noti.channels");if(channels instanceof Array){for(var i=0;i<channels.length;i++){pushstream.addChannel(channels[i]);GAG.PushController._log(channels[i])}}pushstream.connect()},_initChatPush:function(){function messageReceived(text,id,channel){var data={type:"noti",message:text,id:id,channel:channel};GAG.PushController._log(data);GAG.PushController._pullNotificatons(data)}var options={host:GAG.Configs.get("user.chat_noti.host"),port:GAG.Configs.get("user.chat_noti.port"),modes:GAG.Configs.get("user.chat_noti.modes")};if(!options.host||!options.port||!GAG.Configs.get("user.chat_noti.show_chat_notification")){return}var pushstream=new PushStream(options);pushstream.onmessage=messageReceived;var channels=GAG.Configs.get("user.chat_noti.channels");if(channels instanceof Array){for(var i=0;i<channels.length;i++){pushstream.addChannel(channels[i]);GAG.PushController._log(channels[i])}}pushstream.connect()},_updateQueue:[],putToUpdateQueue:function(data){this._updateQueue.push(data)},getNsReadStateCb:function(json){GAG.PushController._isRequestingUpdate=false;GAG.PushController._lastBadgetTs=(new Date()).getTime();if(json&&json.status=="OK"){if(GAG.PushController.unreadCount!=json.payload.unreadCount){if(!json.doNotGetNoti){GAG.PageController.getNotifications()}}GAG.PushController.updateNotificationUnreadCount(json.payload.unreadCount)}else{GAG.PushController._isRequestingUpdate=false}},getChatNsReadStateCb:function(json){GAG.PushController._isRequestingChatUpdate=false;GAG.PushController._lastBadgetTs=(new Date()).getTime();if(json&&json.status=="OK"){if(GAG.PushController.chatUnreadCount!=json.payload.unreadCount){if(!json.doNotGetNoti){GAG.PageController.getChatNotifications()}}GAG.PushController.updateChatNotificationUnreadCount(json.payload.unreadCount)}else{GAG.PushController._isRequestingChatUpdate=false}},_getNsReadState:function(){var notiUrl=GAG.Configs.get("user.noti.read_state_url")+"?"+GAG.Configs.get("user.noti.read_state_params");this._isRequestingUpdate=true;var req=$.ajax({url:notiUrl,type:"GET",dataType:"jsonp",jsonpCallback:"GAG.PushController.getNsReadStateCb"})},_getChatNsReadState:function(){var notiUrl=GAG.Configs.get("user.chat_noti.read_state_url")+"?"+GAG.Configs.get("user.chat_noti.read_state_params");this._isRequestingUpdate=true;var req=$.ajax({url:notiUrl,type:"GET",dataType:"jsonp",jsonpCallback:"GAG.PushController.getChatNsReadStateCb"})},getNotificationBadge:function(){if(this._isRequestingUpdate){return}return this._getNsReadState()},getChatNotificationBadge:function(){if(this._isRequestingChatUpdate){return}return this._getChatNsReadState()},updateNotificationUnreadCount:function(unreadCount){var counter=$(this.selectors.NOTIFICATION_UNREAD_COUNT);if(!counter){return}if(unreadCount>0){GAG.PushController.unreadCount=unreadCount;counter.text(unreadCount);counter.removeClass("hide");var message=unreadCount+" unread messages. \nClick to read detail.";if(unreadCount==1){message=unreadCount+" unread message. \nClick to read detail."}GAG.WebNotiController.show(message)}else{GAG.PushController.unreadCount=0;counter.text("0");counter.addClass("hide")}GAG.PageController.refreshPageTitle()},updateChatNotificationUnreadCount:function(unreadCount){var counter=$(this.selectors.CHAT_NOTIFICATION_UNREAD_COUNT);if(!counter){return}if(unreadCount>0){GAG.PushController.chatUnreadCount=unreadCount;counter.text(unreadCount);counter.removeClass("hide")}else{GAG.PushController.chatUreadCount=0;counter.text("0");counter.addClass("hide")}},checkUpdateQueue:function(){if(this._updateQueue.length>0){this._updateQueue=[];this.getNotificationBadge();this.getChatNotificationBadge()}},processUpdateQueue:function(){var now=(new Date()).getTime();if(!this._lastBadgetTs||now-this._lastBadgetTs>=this._minBadgeInterval){this.checkUpdateQueue()}},addRegularLongPolling:function(){this.putToUpdateQueue({})},scheduleRegularLongPolling:function(){this.addRegularLongPolling();this._regularLongPollingInterval=this._regularLongPollingInterval*1.5;setTimeout("GAG.PushController.scheduleRegularLongPolling();",this._regularLongPollingInterval)},_initBadgeUpdate:function(){setInterval("GAG.PushController.processUpdateQueue();",this._checkUpdateQueueInterval);setTimeout("GAG.PushController.scheduleRegularLongPolling();",this._regularLongPollingInterval)}});GAG.ProfileController=$.extend({},new GAG.Controller(),{init:function(){this.bindElements()},selectors:{PROFILE_CHAT_BTN:"#jsid-profile-chat-btn"},_bindProfileChatButton:function(){$(this.selectors.PROFILE_CHAT_BTN).click(function(e){var profileName=$(this).data("profilename");var viewerName=$(this).data("viewername");$(this).attr("active","");GAG.GA.track("profile","chat-click","click");GAG.GA.track("profile","chat-receive",profileName);GAG.GA.track("profile","chat-sent",viewerName);if(viewerName!="__GUEST__"){$.ajax({url:"/notification/invite-chat",data:{profileName:profileName},dataType:"json",type:"POST",success:function(data){},error:function(data){}})}})},bindElements:function(){this._bindProfileChatButton()}});GAG.ProfileSettingController=$.extend({},new GAG.Controller(),{init:function(){this.bindElements()},selectors:{SETTING_SOCIAL_UNLINK_BTNS:".badge-social-unbind",PROFILE_AVATAR_IMAGE:"#jsid-profile-avatar",PROFILE_AVATAR_UPLOAD:"input[name=avatar]",PROFILE_DEFAULT_AVATAR:"input[name=default_avatar]",PROFILE_COLOR_BTN:".badge-profile-color",PROFILE_COLOR:"input[name=profile_color]",RANDOM_AVATAR_BTN:"#jsid-random-avatar-btn"},_bindSocialUnlinkButtons:function(){$(this.selectors.SETTING_SOCIAL_UNLINK_BTNS).on("click",function(e){var btn=$(this);var platform=btn.attr("data-platform");$.ajax({url:"/connect/unlink",data:{platform:platform},dataType:"json",success:function(json){if(json&&json.okay){window.location.reload()}},error:function(json){}})})},_bindRandomAvatarButton:function(){var profileAvatarImage=$(this.selectors.PROFILE_AVATAR_IMAGE);var profileDefaultAvatar=$(this.selectors.PROFILE_DEFAULT_AVATAR);var randomAvatarBtn=$(this.selectors.RANDOM_AVATAR_BTN);$(randomAvatarBtn).click($.proxy(function(){var path=randomAvatarBtn.data("path");var max=randomAvatarBtn.data("max");var random=Math.floor(Math.random()*max+1);var src=path.replace("%random%",random);if(profileAvatarImage.attr("src")!=src){profileAvatarImage.attr("src",src);profileDefaultAvatar.val(random);var profileAvatarUpload=$(this.selectors.PROFILE_AVATAR_UPLOAD);profileAvatarUpload.replaceWith(profileAvatarUpload.clone())}else{randomAvatarBtn.click()}return false},this));$(document).on("change",this.selectors.PROFILE_AVATAR_UPLOAD,function(){profileDefaultAvatar.val("")})},_bindProfileColorButton:function(){$(this.selectors.PROFILE_COLOR_BTN).click(function(e){$(GAG.ProfileSettingController.selectors.PROFILE_COLOR_BTN).removeClass("selected");$(this).addClass("selected");$(GAG.ProfileSettingController.selectors.PROFILE_COLOR).val($(this).data("color"));GAG.GA.track("profile","change-color",$(this).data("color"));e.preventDefault()})},bindElements:function(){this._bindSocialUnlinkButtons();this._bindRandomAvatarButton();this._bindProfileColorButton()}});GAG.OverlayController=$.extend({},new GAG.Controller(),{_isShown:false,_hideUsingBackground:true,selectors:{OVERLAY:"#overlay-container",OVERLAY_COMPONENT:"section",OVERLAY_CLOSE_BUTTON:".badge-overlay-close",OVERLAY_COMPONENT_REPORT:".badge-overlay-report",OVERLAY_COMPONENT_LOGIN:".badge-overlay-signin",OVERLAY_COMPONENT_SIGNUP_FB:".badge-overlay-signup-fb",OVERLAY_COMPONENT_SIGNUP_EMAIL:".badge-overlay-signup-email"},init:function(){this.bindOverlayCloseButtons()},handlers:{closeButtonClickedHandler:function(event){this.hideOverlay($(event.currentTarget).closest(this.selectors.OVERLAY_COMPONENT));event.preventDefault()},overlayBackgroundClickedHandler:function(event){if(this._hideUsingBackground){this.hideAllOverlay()}},overlayComponentClickedHandler:function(event){event.stopPropagation()}},setHideUsingBackground:function(hideUsingBackground){this._hideUsingBackground=(hideUsingBackground!==false)},showOverlay:function(selector){this.hideAllOverlay();this._isShown=true;$(this.selectors.OVERLAY).removeClass("hide");$("body").addClass("no-scroll");if(typeof selector!="undefined"){$(selector).removeClass("hide")}},hideOverlay:function(selector){this._isShown=false;$(this.selectors.OVERLAY).addClass("hide");$("body").removeClass("no-scroll");if(typeof selector!="undefined"){$(selector).addClass("hide")}GAG.PageController.resetCustomize()},hideAllOverlay:function(){this.hideOverlay($(this.selectors.OVERLAY).children())},bindOverlayCloseButtons:function(){$(this.selectors.OVERLAY).find(this.selectors.OVERLAY_CLOSE_BUTTON).click($.proxy(this.handlers.closeButtonClickedHandler,this));$(this.selectors.OVERLAY).click($.proxy(this.handlers.overlayBackgroundClickedHandler,this));$(this.selectors.OVERLAY).find(this.selectors.OVERLAY_COMPONENT).click($.proxy(this.handlers.overlayComponentClickedHandler,this))},isInsideOverlay:function(object){return $(object).is(this.selectors.OVERLAY+" *")}});GAG.KeyboardController=$.extend({},new GAG.Controller(),(function(){var _self={JUMP_PREV:"JUMP_PREV",JUMP_NEXT:"JUMP_NEXT",VOTE_UP:"VOTE_UP",VOTE_DOWN:"VOTE_DOWN",UNVOTE:"UNVOTE",JUMP_COMMENT:"JUMP_COMMENT",LEFT_ARROW:37,RIGHT_ARROW:39,KEY_END:35,KEY_HOME:36,_track:function(action){GAG.GA.track("keyboard",action,GAG.Page.getPageKey())},_bindHomeEnd:function(){$(document).keydown(function(e){if(GAG.Utils.isCurrentlyFocusedInTypeable()){return true}if(e.keyCode==_self.KEY_HOME||e.keyCode==_self.KEY_END){e.preventDefault();var post=GAG.PostController;$("html,body").animate({scrollTop:e.keyCode==_self.KEY_END?$(document).height():0},100,"swing",function(){GAG.ListController.handlers.recalculateInViewEntries();$(post.selectors.ENTRY_CONTAINER+" "+post.selectors.ENTRY_STICKY_ELEMENTS).each(function(){$(this).css({position:"","z-index":"",top:""});$(this).removeClass(post.CLASS_STICKY)});GAG.PostController.handlers.entryStickElementHandler();GAG.ListScrollingController.handlers.scanFeaturedItemForArchive()});return false}})},_bindJumpPrev:function(key){_self.bindAction(key,function(){_self._track("prev");if(GAG.Page.isPostPage()){GAG.PostController.prevEntry()}else{_self.jump(_self.JUMP_PREV)}});if(GAG.Page.isPostPage()){$(document).keydown(function(e){if(GAG.Utils.isCurrentlyFocusedInTypeable()){return true}if(e.keyCode==_self.LEFT_ARROW){GAG.PostController.prevEntry();return false}})}},_bindJumpNext:function(key){_self.bindAction(key,function(){_self._track("next");if(GAG.Page.isPostPage()){GAG.GA.track("Next-Post-Toolbar-keyboard","PostClicked",1);GAG.PostController.nextEntry()}else{_self.jump(_self.JUMP_NEXT)}});if(GAG.Page.isPostPage()){$(document).keydown(function(e){if(GAG.Utils.isCurrentlyFocusedInTypeable()){return true}if(e.keyCode==_self.RIGHT_ARROW){GAG.PostController.nextEntry();return false}})}},_bindPostVoteUp:function(key){_self.bindAction(key,function(){_self._track("upvote");var post=GAG.PostController;var target=GAG.Page.isPostPage()?$(post.selectors.ENTRY_CONTAINER):GAG.ListController.findCurrentlyInFocusEntry();post.upvoteEntry(target)})},_bindPostVoteDown:function(key){_self.bindAction(key,function(){_self._track("downvote");var post=GAG.PostController;var target=GAG.Page.isPostPage()?$(post.selectors.ENTRY_CONTAINER):GAG.ListController.findCurrentlyInFocusEntry();post.downvoteEntry(target)})},_bindPostComment:function(key){_self.bindAction(key,function(){_self._track("comment");GAG.PostController.commentEntry(GAG.ListController.findCurrentlyInFocusEntry())})},_bindScrollToTop:function(key){_self.bindAction(key,function(){_self._track("back-to-top");_self.scrollToTop()})},_bindRandomEntry:function(key){_self.bindAction(key,function(){_self._track("random");_self.randomEntry()})},_bindPostPlay:function(key){_self.bindAction(key,function(){_self._track("play");var target=GAG.Page.isPostPage()?$(GAG.PostController.selectors.ENTRY_CONTAINER):GAG.ListController.findCurrentlyInFocusEntry();GAG.PostController.playEntry(target)})},_bindElements:function(){_self._bindScrollToTop("b");_self._bindJumpPrev("k");_self._bindJumpNext("j");_self._bindRandomEntry("r");_self._bindPostVoteUp("l");_self._bindPostVoteDown("h");_self._bindPostComment("c");_self._bindPostPlay("p");_self._bindHomeEnd()},_getKeyOptions:function(){return{type:"keypress",propagate:false,target:document,disable_in_input:true}},bindAction:function(key,action){shortcut.add(key,action,_self._getKeyOptions())},jump:function(direction){if(direction==_self.JUMP_PREV){GAG.ListController.scrollToPrevEntry()}else{GAG.ListController.scrollToNextEntry()}},scrollToTop:function(){GAG.PageController.scrollToTop()},randomEntry:function(){GAG.Page.load("http://"+GAG.Page.getDomain()+"/random")}};return{init:function(){_self._bindElements()},jump:_self.jump,bindAction:_self.bindAction,scrollToTop:_self.scrollToTop,randomEntry:_self.randomEntry}})());GAG.AccountController=$.extend({},new GAG.Controller(),{init:function(){this.bindElements()},selectors:{HEADER_LOGIN_BUTTON:".badge-login-button",HEADER_SIGNUP_BUTTON:".badge-signup-button",LOGIN_FORM_NEXT_URL:"#jsid-login-form-next-url",LOGIN_FACEBOOK_CONNECT_BUTTON:".badge-facebook-connect",LOGIN_GPLUS_CONNECT_BUTTON:".badge-gplus-connect",SIGNUP_FB:"#signup-fb",SIGNUP_EMAIL:"#signup-email",SIGNUP_EMAIL_LINK:".badge-signup-email-link",SIGNUP_LOGIN_LINK:".badge-signup-login-link",SIGNUP_FORM_NEXT_URL:".badge-signup-form-next-url",DELETE_CONFIRM_FORM:".badge-delete-confirm-form",SHOW_DELETE_FORM_BTN:"#jsid-show-form-btn",RESET_SUBMIT_BTN:".badge-reset-submit",RESET_SUBMIT_FROM:"#jsid-form-reset",RESET_NEW_PWD:"#jsid-reset-new-pwd",RESET_RETYPE_NEW_PWD:"#jsid-reset-retype-new-pwd"},bindElements:function(){this.bindSignupElements();this.bindLoginElements();this.bindDeleteConfirmElements();this.bindFacebookConnectElements();this.bindGplusConnectElements();this.bindResetForm();this.bindSignupPageElements()},bindSignupPageElements:function(){if(GAG.Page.isSignupPage()){GAG.PageController.showCaptcha("signup")}},bindSignupElements:function(){var self=this;$(this.selectors.HEADER_SIGNUP_BUTTON).on("click",$.proxy(function(e){e.preventDefault();this.presentSignupForm()},this));$(this.selectors.SIGNUP_EMAIL_LINK).click($.proxy(function(e){e.preventDefault();this.switchToEmailSignup()},this));$(this.selectors.SIGNUP_LOGIN_LINK).each(function(){if(GAG.OverlayController.isInsideOverlay($(this))){$(this).click($.proxy(function(e){e.preventDefault();this.presentLoginForm($(this.selectors.SIGNUP_FORM_NEXT_URL).val())},self))}});$(this.selectors.SIGNUP_EMAIL).on("submit",$.proxy(function(event){$(".badge-input-tzo").val(this._getTimezoneOffset());var isValid=true;try{if(Recaptcha){var challenge=Recaptcha.get_challenge();var response=Recaptcha.get_response();$("#jsid-signup-recaptcha_challenge").val(challenge);$("#jsid-signup-recaptcha_response").val(response)}}catch(e){}if(!isValid){event.preventDefault();return false}},this))},bindLoginElements:function(){$(this.selectors.HEADER_LOGIN_BUTTON).on("click",$.proxy(function(e){e.preventDefault();this.presentLoginForm()},this))},bindDeleteConfirmElements:function(){$(this.selectors.SHOW_DELETE_FORM_BTN).on("click",$.proxy(function(){$(this.selectors.DELETE_CONFIRM_FORM).removeClass("hide")},this))},bindFacebookConnectElements:function(){$(this.selectors.LOGIN_FACEBOOK_CONNECT_BUTTON).on("click",$.proxy(function(e){e.preventDefault();var redirectUrl=$(this.selectors.LOGIN_FORM_NEXT_URL).val();var val={a:false,d:false,lo:false,dl:false};var cookieVal=JSON.stringify(val);$.cookie("auto_log",cookieVal,{path:"/"});GAG.Facebook.Connect.connect(redirectUrl)},this))},bindGplusConnectElements:function(){},bindResetForm:function(){$(this.selectors.RESET_SUBMIT_FROM).submit($.proxy(function(e){if(this.validateReset()){return true}return false},this))},validateReset:function(){var password=$(this.selectors.RESET_NEW_PWD).val();var retype_password=$(this.selectors.RESET_RETYPE_NEW_PWD).val();if(password!=retype_password){$(".badge-error-message").text("Your new password doesn't seem to be matching.").removeClass("hide");return false}var rs=GAG.Validator.isValidPassword(password,6,30);if(rs){$(".badge-error-message").text("").addClass("hide")}else{$(".badge-error-message").text("Invalid password.").removeClass("hide")}return rs},_getTimezoneOffset:function(){return new Date().getTimezoneOffset()/-60},presentLoginForm:function(nextUrl){GAG.GA.track("login-signup","shown","login-form");GAG.OverlayController.showOverlay(GAG.OverlayController.selectors.OVERLAY_COMPONENT_LOGIN);$("#jsid-login-email-name").focus();if(typeof nextUrl!="undefined"){$(this.selectors.LOGIN_FORM_NEXT_URL).val(nextUrl);$(this.selectors.SIGNUP_FORM_NEXT_URL).val(nextUrl)}else{$(this.selectors.LOGIN_FORM_NEXT_URL).val(location.href);$(this.selectors.SIGNUP_FORM_NEXT_URL).val(location.href)}},presentSignupForm:function(nextUrl){GAG.PageController.preloadCaptchaScript();GAG.GA.track("login-signup","shown","signup-form");GAG.OverlayController.showOverlay(GAG.OverlayController.selectors.OVERLAY_COMPONENT_SIGNUP_FB);if(typeof nextUrl!="undefined"){$(this.selectors.LOGIN_FORM_NEXT_URL).val(nextUrl);$(this.selectors.SIGNUP_FORM_NEXT_URL).val(nextUrl)}else{$(this.selectors.LOGIN_FORM_NEXT_URL).val(location.href);$(this.selectors.SIGNUP_FORM_NEXT_URL).val(location.href)}this.switchToFacebookSignup()},switchToEmailSignup:function(){GAG.GA.track("login-signup","shown","email-signup-form");GAG.PageController.showCaptcha("signup");$(this.selectors.SIGNUP_FB).addClass("hide");$(this.selectors.SIGNUP_EMAIL).removeClass("hide")},switchToFacebookSignup:function(){$(this.selectors.SIGNUP_EMAIL).addClass("hide");$(this.selectors.SIGNUP_FB).removeClass("hide")},setSafeMode:function(value,nextUrl){if(typeof nextUrl=="undefined"){nextUrl=""}if(GAG.User.isLoggedIn()){var options=GAG.Page.getCookieOptions();options.domain=GAG.Configs.get("page.cookie_domain");$.cookie(GAG.PageController._safeModeCookieKey,value,options)}var url="/profile/safe-browse?enable="+value+"&url="+encodeURIComponent(nextUrl);window.location=url}});GAG.UploadController=$.extend({},new GAG.Controller(),{TITLE_LENGTH_WARNING_THRESHOLD:20,_sectionsCountMax:0,init:function(){this._bindElements();this._sectionsCountMax=$("#jsid-section-list").data("sections-count-max")},selectors:{UPLOAD_URL_BTN:"#jsid-upload-url-btn",UPLOAD_FILE_BTN:"#jsid-upload-file-btn",UPLOAD_URL_INPUT:"#jsid-upload-url-input",UPLOAD_FILE_INPUT:"#jsid-upload-file-input",UPLOAD_CHAR_COUNT:"#jsid-char-count",UPLOAD_TITLE_INPUT:"#jsid-upload-title",UPLOAD_SOURCE_CHECKBOX:"#jsid-source-checkbox",UPLOAD_SOURCE_CHECKBOX_LABEL:"#jsid-source-checkbox-label",UPLOAD_SOURCE_INPUT:"#jsid-source-input",UPLOAD_SUBMIT_BTN:"#jsid-submit-btn",UPLOAD_DISABLE_MASK:"#jsid-disable-mask",UPLOAD_CONTENT_ERROR_LABEL:"#jsid-upload-content-error",UPLOAD_TITLE_ERROR_LABEL:"#jsid-upload-title-error",UPLOAD_ERROR_LABEL:"#jsid-upload-error",UPLOAD_SECTION_ERROR_LABEL:"#jsid-upload-section-error",UPLOAD_SECTION:"badge-upload-section",SECTION_LIST:"#jsid-section-list"},css:{METHOD_SELECTED:"upload-selected",TITLE_WARNING:"warn"},_resetElement:function(el){el.wrap("<form>").closest("form").get(0).reset();el.unwrap()},_resetStyle:function(){$("."+this.selectors.UPLOAD_SECTION).parent().removeClass("selected")},_selectFileInput:function(){if(GAG.Configs.get("user.showCaptcha")){GAG.PageController.showCaptcha("upload")}else{$("#jsid-upload-recaptcha_skip").attr("value","yes")}$(this.selectors.UPLOAD_URL_INPUT).addClass("hide").val("");$(this.selectors.UPLOAD_FILE_INPUT).removeClass("hide");this._resetStyle();$(this.selectors.UPLOAD_URL_BTN).removeClass(this.css.METHOD_SELECTED);$(this.selectors.UPLOAD_FILE_BTN).addClass(this.css.METHOD_SELECTED)},_selectUrlInput:function(){if(GAG.Configs.get("user.showCaptcha")){GAG.PageController.showCaptcha("upload")}else{$("#jsid-upload-recaptcha_skip").attr("value","yes")}var fileInput=$(this.selectors.UPLOAD_FILE_INPUT).addClass("hide");this._resetElement(fileInput);this._resetStyle();$(this.selectors.UPLOAD_URL_INPUT).removeClass("hide");$(this.selectors.UPLOAD_FILE_BTN).removeClass(this.css.METHOD_SELECTED);$(this.selectors.UPLOAD_URL_BTN).addClass(this.css.METHOD_SELECTED)},verifyCaptcha:function(){try{if(Recaptcha){var challenge=Recaptcha.get_challenge();var response=Recaptcha.get_response();$("#jsid-upload-recaptcha_challenge").val(challenge);$("#jsid-upload-recaptcha_response").val(response)}}catch(e){}},_setCharCount:function(e){var target=$(e.currentTarget);var maxlength=parseInt(target.data("maxlength"),10);var length=target.val().length;var remain=maxlength-length;var titleInput=$(this.selectors.UPLOAD_CHAR_COUNT).text(remain);if(remain<=this.TITLE_LENGTH_WARNING_THRESHOLD){titleInput.addClass(this.css.TITLE_WARNING)}else{titleInput.removeClass(this.css.TITLE_WARNING)}},_updateSourceFields:function(e){var target=$(this.selectors.UPLOAD_SOURCE_CHECKBOX);var sourceLink=$(this.selectors.UPLOAD_SOURCE_INPUT);if(target.is(":checked")){sourceLink.removeClass("hide")}else{sourceLink.addClass("hide")}},_updateSections:function(e){var _this=GAG.UploadController;var checkedCount=jQuery(_this.selectors.SECTION_LIST+" input:checked").length;if(checkedCount<=_this._sectionsCountMax){var target=$(this);if(target.is(":checked")){target.parent().addClass("selected")}else{target.parent().removeClass("selected")}}else{e.preventDefault()}},_getContentError:function(){var imageUrl=$(this.selectors.UPLOAD_URL_INPUT).val();var imageFile=$(this.selectors.UPLOAD_FILE_INPUT+" input").val();if(!imageUrl&&!imageFile){return"Please select a file or paste an image URL."}if(false){if(imageUrl){if(!this._isValidImageUrl(imageUrl)){return"Unsupported image type."}}if((imageUrl&&!this._isValidImageExtension(imageUrl))||(imageFile&&!this._isValidImageExtension(imageFile))){return"Unsupported image type."}}},_getTitleError:function(){var title=$(this.selectors.UPLOAD_TITLE_INPUT).val();var minlength=6;var maxlength=$(this.selectors.UPLOAD_TITLE_INPUT).data("maxlength");if(!title||title.length<minlength){return"Your title doesn't look funny enough. Be creative!"}else{if(title.length>maxlength){return"Your title is a bit long. Be concise!"}}},_isValidImageUrl:function(url){var reg=/^http(s?):\/\//i;return url.toLowerCase().match(reg)},_isValidImageExtension:function(path){path+="";var extension=path.split(".").pop();var reg=/(jpeg|jpg|gif|png)/i;return extension.match(reg)},initialize:function(){if(GAG.Page.isUploadPage()){if(GAG.Configs.get("user.showCaptcha")){GAG.PageController.showCaptcha("upload")}else{$("#jsid-upload-recaptcha_skip").attr("value","yes")}}},validateForm:function(){var contentError=this._getContentError();var titleError=this._getTitleError();var valid=true;var contentErrorLabel=$(this.selectors.UPLOAD_CONTENT_ERROR_LABEL);var titleErrorLable=$(this.selectors.UPLOAD_TITLE_ERROR_LABEL);if(contentError){contentErrorLabel.removeClass("hide").text(contentError);valid=false}else{contentErrorLabel.addClass("hide").text("")}if(titleError){titleErrorLable.removeClass("hide").text(titleError);valid=false}else{titleErrorLable.addClass("hide").text("")}$(this.selectors.UPLOAD_ERROR_LABEL).addClass("hide").text("");var sections=$("."+this.selectors.UPLOAD_SECTION+":checked:enabled");var sectionLabel=$(this.selectors.UPLOAD_SECTION_ERROR_LABEL);if(valid){var options={className:"upload-spinner",top:"200px",left:"205px"};GAG.PageController.loadSpinner("spinner-here",options);$(this.selectors.UPLOAD_SUBMIT_BTN).val("Uploading...");$(this.selectors.UPLOAD_DISABLE_MASK).addClass("disabled");$(GAG.OverlayController.selectors.OVERLAY).unbind("click");this.verifyCaptcha()}return valid},_pad:function(str,ch){if(ch==undefined){ch="0"}return str<10?ch+""+str:str},_convertTime:function(seconds){var d=0;var h=0;var m=0;var s=0;if(seconds<0){seconds=0}d=parseInt(seconds/86400);seconds-=d*86400;h=parseInt(seconds/3600);seconds-=h*3600;m=parseInt(seconds/60);seconds-=m*60;s=seconds;var str="";if(d>0){str+=this._pad(d)+":"}str+=this._pad(h)+":";str+=this._pad(m)+":";str+=this._pad(s);return str},_updateDisplay:function(el){var ts=el.data("timestamp");var now=Math.round((new Date()).getTime()/1000);var startTs=el.data("start");if(startTs==null){startTs=now;el.data("start",startTs)}var elapsed=now-startTs;el.text(this._convertTime(ts-elapsed))},_updateAll:function(){$(".badge-countdown").each(function(){GAG.UploadController._updateDisplay($(this))})},_bindElements:function(){var clocks=$(".badge-countdown");if(clocks.length>0){GAG.UploadController._updateAll();setInterval("GAG.UploadController._updateAll();",1000)}$(this.selectors.UPLOAD_URL_BTN).on("click",$.proxy(function(e){e.preventDefault();this._selectUrlInput()},this));$(this.selectors.UPLOAD_FILE_BTN).on("click",$.proxy(function(e){e.preventDefault();this._selectFileInput()},this));$(this.selectors.UPLOAD_TITLE_INPUT).on("keydown",$.proxy(function(e){setTimeout($.proxy(this._setCharCount,this,e),50)},this));$(this.selectors.UPLOAD_SOURCE_CHECKBOX).on("change",$.proxy(this._updateSourceFields,this));$("."+this.selectors.UPLOAD_SECTION).on("click",this._updateSections)}});GAG.CacheableVoteController=$.extend({},new GAG.Controller(),{selectors:{ENTRY:"article[data-entry-id]"},handler:null,remoteHandler:null,init:function(remoteHandler){this.handler=GAG.CacheableVote;this.remoteHandler=remoteHandler},process:function(){var data=this.handler.get();if(data){GAG.CacheableAbstract.log("found cache. update ui");this.updateUI(data)}if(!data){GAG.CacheableAbstract.log("empty cache. try to retrieve from server");this.remoteHandler.addToQueue(this.handler.formatRemoteParams(),this.responseCallback)}},responseCallback:function(data){if(data.vote!=undefined){var cachedEntryVotes=GAG.CacheableVote.getFromCache();if(cachedEntryVotes==null){cachedEntryVotes={}}$.each(data.vote,function(entryKey,score){cachedEntryVotes[entryKey]=parseInt(score)});GAG.CacheableVote.updateCache(cachedEntryVotes);GAG.CacheableVoteController.updateUI(data.vote)}},updateUI:function(data){$(GAG.CacheableVoteController.selectors.ENTRY).each(function(i,v){var entryId=$(v).data("entry-id");if(data[entryId]!=undefined){var score=parseInt(data[entryId]);if(score>0){GAG.PostController.handlers.likeHandler(entryId)}else{if(score<0){GAG.PostController.handlers.dislikeHandler(entryId)}else{GAG.PostController.handlers.unlikeHandler(entryId)}}}})}});GAG.CacheableUserController=$.extend({},new GAG.Controller(),{selectors:{},handler:null,remoteHandler:null,_unverifiedCookieKey:"unverified",init:function(remoteHandler){this.handler=GAG.CacheableUser;this.remoteHandler=remoteHandler},process:function(){var data=this.handler.get();if(data){GAG.CacheableAbstract.log("found cache cachedUser. update ui");this.updateUI(data)}if(!data){GAG.CacheableAbstract.log("empty cache cachedUser. try to retrieve from server");this.remoteHandler.addToQueue(this.handler.formatRemoteParams(),this.responseCallback)}},responseCallback:function(data){if(data.user!=undefined){var cachedUser=GAG.CacheableUser.getFromCache();if(cachedUser==null){cachedUser={}}$.each(data.user,function(i,v){cachedUser[i]=v});GAG.CacheableUser.updateCache(cachedUser);GAG.CacheableUserController.updateUI(data)}else{GAG.PageController.initUserFunction()}},updateUI:function(data){if(data.user){var user=data.user}else{var user=data}var username=user.username;var user_id=user.userId;var avatar=user.avatar;var web_push=user.webPush;var noti=user.notiOptions;var chat_noti=user.chatNotiOptions;var comment_auth=user.commentSso;GAG.Configs._configs.user["username"]=username;GAG.Configs._configs.user["id"]=user_id;GAG.Configs._configs.user["avatar"]=avatar;GAG.Configs._configs.configs["web_push"]["key"]=web_push;GAG.Configs._configs.user["noti"]=noti;GAG.Configs._configs.user["chat_noti"]=chat_noti;GAG.Configs._configs.user["comment_auth"]=comment_auth;GAG.User.init();GAG.PageController.initUserFunction();if($.cookie(GAG.CacheableUserController._unverifiedCookieKey)==1){GAG.PageController.showConfirmEmailBanner(GAG.Configs._configs.user["username"])}if(username){if(document.getElementById("jsid-my-profile")){var myprofile=document.getElementById("jsid-my-profile");myprofile.href="/u/"+username}}if(avatar&&document.getElementById("jsid-avatar")){var avatarImg=document.getElementById("jsid-avatar");avatarImg.src=avatar}}});GAG.CacheableUserPreferenceController=$.extend({},new GAG.Controller(),{selectors:{},handler:null,remoteHandler:null,init:function(remoteHandler){this.handler=GAG.CacheableUserPreference;this.remoteHandler=remoteHandler},process:function(){var data=this.handler.get();if(!data){this.remoteHandler.addToQueue(this.handler.formatRemoteParams(),this.responseCallback)}},responseCallback:function(data){if(data["user-preference"]!=undefined){preference=data["user-preference"];GAG.CacheableUserPreferenceController._updateCookies(preference);GAG.CacheableUserPreferenceController._updateUI();GAG.CacheableUserPreference.updateCache(preference)}},_updateCookies:function(preference){var options=GAG.Page.getCookieOptions();options.domain=GAG.Configs.get("page.cookie_domain");if(preference.isAutoAnimatedGifOn!==undefined){$.cookie(GAG.PageController._autoAnimatedGifCookieKey,preference.isAutoAnimatedGifOn?"1":"0",options)}if(preference.isSafeModeOn!==undefined){$.cookie(GAG.PageController._safeModeCookieKey,preference.isSafeModeOn?"1":"0",options)}},_updateUI:function(){GAG.PageController.setCustomizeElementValues()}});GAG.CacheableUserUploadController=$.extend({},new GAG.Controller(),{selectors:{DELETE_SEPARATOR:".badge-item-delete-dot",DELETE_LINK:".badge-item-delete",REPORT_SEPARATOR:".badge-item-report-dot",REPORT_LINK:".badge-item-report",ARTICLE:"#individual-post article"},handler:null,remoteHandler:null,init:function(remoteHandler){this.handler=GAG.CacheableUserUpload;this.remoteHandler=remoteHandler},process:function(){if(GAG.Configs.get("page.page_key")=="post"){var data=this.handler.get();var lastUpload=$.cookie(GAG.CacheableController.lastUploadCookieKey);if(data){GAG.CacheableAbstract.log("found cacheUserUpload. update ui");if(lastUpload!=null&&data.indexOf(lastUpload)==-1){data.push(lastUpload);GAG.CacheableUserUpload.updateCache(data)}this.updateUI(data)}if(!data){GAG.CacheableAbstract.log("empty cacheUserUpload. try to retrieve from server");this.remoteHandler.addToQueue(this.handler.formatRemoteParams(),this.responseCallback)}if(lastUpload!=null){$.cookie(GAG.CacheableController.lastUploadCookieKey,"",{domain:GAG.Configs.get("page.cookie_domain"),expires:-1,path:"/"})}}},responseCallback:function(data){if(data["user-upload"]!=undefined){GAG.CacheableUserUpload.updateCache(data["user-upload"]);GAG.CacheableUserUploadController.updateUI(data["user-upload"])}},updateUI:function(data){var self=this;var entryId=$(self.selectors.ARTICLE).data("entry-id");if(data.indexOf(entryId)!=-1){$(self.selectors.DELETE_SEPARATOR).removeClass("hide");$(self.selectors.DELETE_LINK).removeClass("hide");$(self.selectors.REPORT_SEPARATOR).addClass("hide");$(self.selectors.REPORT_LINK).addClass("hide")}}});GAG.CacheableUserQuotaController=$.extend({},new GAG.Controller(),{handler:null,remoteHandler:null,init:function(remoteHandler){this.handler=GAG.CacheableUserQuota;this.remoteHandler=remoteHandler},process:function(){var data=this.handler.get();if(data){GAG.Configs._configs.user["showCaptcha"]=(data.restricted!==false);this.updateUI()}else{GAG.CacheableAbstract.log("empty cacheUserQuota. try to retrieve from server");this.remoteHandler.addToQueue(this.handler.formatRemoteParams(),this.responseCallback)}},responseCallback:function(data){if(data["user-quota"]!=undefined){GAG.CacheableUserQuota.updateCache(data["user-quota"]);GAG.Configs._configs.user["showCaptcha"]=(data["user-quota"]["restricted"]!==false);this.updateUI()}},updateUI:function(data){GAG.UploadController.initialize()}});GAG.CacheableController=$.extend({},new GAG.Controller(),{cacheableControllers:[GAG.CacheableVoteController,GAG.CacheableUserController,GAG.CacheableUserPreferenceController,GAG.CacheableUserUploadController,GAG.CacheableUserQuotaController],clearCookieKey:"cacheableClear",lastUploadCookieKey:"cacheableLastUpload",remoteHandler:null,selectors:{BTN_LOGOUT:".badge-logout-btn"},init:function(){this.remoteHandler=GAG.CacheableRemoteHandler;var self=this;$.each(this.cacheableControllers,function(i,controller){controller.init(self.remoteHandler)});var isClearCache=$.cookie(this.clearCookieKey);if(isClearCache){this.clearAllCache();if(!GAG.CacheableController.isHttps()){$.cookie(this.clearCookieKey,0,{domain:GAG.Configs.get("page.cookie_domain"),expires:-1,path:"/"})}}if(!GAG.CacheableRemoteHandler.issetPhpSessionId()||GAG.CacheableRemoteHandler.isInGracePeriod()){if(!GAG.CacheableRemoteHandler.issetPhpSessionId()){GAG.CacheableAbstract.log("GAG.CacheableRemoteHandler php session id is not set. Bye!!")}if(GAG.CacheableRemoteHandler.isInGracePeriod()){GAG.CacheableAbstract.log("GAG.CacheableRemoteHandler is in grace period. Bye!!")}GAG.PageController.initUserFunction();return}else{GAG.CacheableAbstract.log("calling cacheable")}this.bindDomReady();this.bindLogoutBtn()},clearAllCache:function(){GAG.CacheableAbstract.log("GAG.CacheableController clear all cache");$.each(GAG.CacheableController.cacheableControllers,function(i,controller){controller.handler.clearCache()});GAG.PageController.initUserFunction()},bindDomReady:function(){var self=this;$(function(){$.each(self.cacheableControllers,function(i,controller){controller.process()});self.remoteHandler.processQueue()})},bindLogoutBtn:function(){var self=this;$(this.selectors.BTN_LOGOUT).on("click",function(e){self.clearAllCache()})},isHttps:function(){return location.protocol=="https:"}});GAG.App=(function(){var _self={_data:{},_models:[],_controllers:[],init:function(){var app=_self;$(document).ready(function(){app._onDomReady()});$(window).on("load",function(){app._onWindowLoad()});$(window).on("scroll",function(e){app._runOnControllers("onScroll")});$(window).on("resize",function(e){app._runOnControllers("onResize")})},_onDomReady:function(){_self._runOnModels("init");_self._runOnControllers("init")},_onWindowLoad:function(){_self._runOnModels("onWindowLoad");_self._runOnControllers("onWindowLoad")},_runOnObjects:function(objects,method){if(!objects instanceof Array){return}for(var i=0;i<objects.length;i++){if(objects[i][method]&&typeof objects[i][method]=="function"){objects[i][method]()}}},_runOnModels:function(method){_self._runOnObjects(_self._models,method)},_runOnControllers:function(method){_self._runOnObjects(_self._controllers,method)},addModel:function(models){if(models instanceof Array){for(var i=0;i<models.length;i++){_self._models.push(models[i])}}else{_self._models.push(models)}return this},addController:function(controllers){if(controllers instanceof Array){for(var i=0;i<controllers.length;i++){_self._controllers.push(controllers[i])}}else{_self._controllers.push(controllers)}return this},setData:function(key,data){_self._data[key]=data},_scriptMap:{facebook:"//connect.facebook.net/en_US/all.js",twitter:"//platform.twitter.com/widgets.js","client:plusone":"https://apis.google.com/js/client:plusone.js?onload=gplusRender",ga:("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",},_loadAsyncScript:function(script){(function(){var ga=document.createElement("script");ga.type="text/javascript";ga.async=true;ga.src=script;ga.async=true;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ga,s)})()},loadAsynScripts:function(scripts){for(var i=0;i<scripts.length;i++){if(_self._scriptMap[scripts[i]]){_self._loadAsyncScript(_self._scriptMap[scripts[i]])}}},loadConfigs:function(configs){GAG.Configs.load(configs);return this}};return{init:_self.init,loadConfigs:_self.loadConfigs,loadAsynScripts:_self.loadAsynScripts,addModel:_self.addModel,addController:_self.addController}})();var models=[GAG.CacheFactory,GAG.User,GAG.Vote,GAG.Configs,GAG.Page,GAG.Facebook,GAG.GPlus,GAG.Track,GAG.Toast];var controllers=[GAG.CacheableController,GAG.CacheController,GAG.AdsController,GAG.ProfileSettingController,GAG.ProfileController,GAG.ListController,GAG.OverlayController,GAG.FacebookController,GAG.GPlusController,GAG.ShareController,GAG.PostController,GAG.PageController,GAG.KeyboardController,GAG.HeadbarController,GAG.AccountController,GAG.ListScrollingController,GAG.FeaturedController,GAG.UploadController,GAG.PushController,GAG.WebNotiController];GAG.App.addModel(models).addController(controllers).init()})(jQuery,window);window.Modernizr=function(aw,av,au){function T(b){am.cssText=b}function S(d,c){return T(ai.join(d+";")+(c||""))}function R(d,c){return typeof d===c}function Q(d,c){return !!~(""+d).indexOf(c)}function P(f,c){for(var h in f){var g=f[h];if(!Q(g,"-")&&am[g]!==au){return c=="pfx"?g:!0}}return !1}function O(g,c,j){for(var i in g){var h=c[g[i]];if(h!==au){return j===!1?g[i]:R(h,"function")?h.bind(j||c):h}}return !1}function N(g,f,j){var i=g.charAt(0).toUpperCase()+g.slice(1),h=(g+" "+ag.join(i+" ")+i).split(" ");return R(f,"string")||R(f,"undefined")?P(h,f):(h=(g+" "+af.join(i+" ")+i).split(" "),O(h,f,j))}function M(){ar.input=function(f){for(var b=0,a=f.length;b<a;b++){ab[f[b]]=f[b] in al}return ab.list&&(ab.list=!!av.createElement("datalist")&&!!aw.HTMLDataListElement),ab}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),ar.inputtypes=function(b){for(var m=0,l,j,g,c=b.length;m<c;m++){al.setAttribute("type",j=b[m]),l=al.type!=="text",l&&(al.value=ak,al.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(j)&&al.style.WebkitAppearance!==au?(ap.appendChild(al),g=av.defaultView,l=g.getComputedStyle&&g.getComputedStyle(al,null).WebkitAppearance!=="textfield"&&al.offsetHeight!==0,ap.removeChild(al)):/^(search|tel)$/.test(j)||(/^(url|email)$/.test(j)?l=al.checkValidity&&al.checkValidity()===!1:l=al.value!=ak)),ac[b[m]]=!!l}return ac}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var at="2.6.2",ar={},aq=!0,ap=av.documentElement,ao="modernizr",an=av.createElement(ao),am=an.style,al=av.createElement("input"),ak=":)",aj={}.toString,ai=" -webkit- -moz- -o- -ms- ".split(" "),ah="Webkit Moz O ms",ag=ah.split(" "),af=ah.toLowerCase().split(" "),ae={svg:"http://www.w3.org/2000/svg"},ad={},ac={},ab={},aa=[],Z=aa.slice,Y,X=function(v,u,t,s){var r,q,p,o,h=av.createElement("div"),g=av.body,b=g||av.createElement("body");if(parseInt(t,10)){while(t--){p=av.createElement("div"),p.id=s?s[t]:ao+(t+1),h.appendChild(p)}}return r=["&#173;",'<style id="s',ao,'">',v,"</style>"].join(""),h.id=ao,(g?h:b).innerHTML+=r,b.appendChild(h),g||(b.style.background="",b.style.overflow="hidden",o=ap.style.overflow,ap.style.overflow="hidden",ap.appendChild(b)),q=u(h,v),g?h.parentNode.removeChild(h):(b.parentNode.removeChild(b),ap.style.overflow=o),!!q},W=function(){function c(h,g){g=g||av.createElement(b[h]||"div"),h="on"+h;var a=h in g;return a||(g.setAttribute||(g=av.createElement("div")),g.setAttribute&&g.removeAttribute&&(g.setAttribute(h,""),a=R(g[h],"function"),R(g[h],"undefined")||(g[h]=au),g.removeAttribute(h))),g=null,a}var b={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return c}(),V={}.hasOwnProperty,U;!R(V,"undefined")&&!R(V.call,"undefined")?U=function(d,c){return V.call(d,c)}:U=function(d,c){return c in d&&R(d.constructor.prototype[c],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(a){var h=this;if(typeof h!="function"){throw new TypeError}var g=Z.call(arguments,1),f=function(){if(this instanceof f){var b=function(){};b.prototype=h.prototype;var d=new b,c=h.apply(d,g.concat(Z.call(arguments)));return Object(c)===c?c:d}return h.apply(a,g.concat(Z.call(arguments)))};return f}),ad.flexbox=function(){return N("flexWrap")},ad.canvas=function(){var b=av.createElement("canvas");return !!b.getContext&&!!b.getContext("2d")},ad.canvastext=function(){return !!ar.canvas&&!!R(av.createElement("canvas").getContext("2d").fillText,"function")},ad.webgl=function(){return !!aw.WebGLRenderingContext},ad.touch=function(){var a;return"ontouchstart" in aw||aw.DocumentTouch&&av instanceof DocumentTouch?a=!0:X(["@media (",ai.join("touch-enabled),("),ao,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(b){a=b.offsetTop===9}),a},ad.geolocation=function(){return"geolocation" in navigator},ad.postmessage=function(){return !!aw.postMessage},ad.websqldatabase=function(){return !!aw.openDatabase},ad.indexedDB=function(){return !!N("indexedDB",aw)},ad.hashchange=function(){return W("hashchange",aw)&&(av.documentMode===au||av.documentMode>7)},ad.history=function(){return !!aw.history&&!!history.pushState},ad.draganddrop=function(){var b=av.createElement("div");return"draggable" in b||"ondragstart" in b&&"ondrop" in b},ad.websockets=function(){return"WebSocket" in aw||"MozWebSocket" in aw},ad.rgba=function(){return T("background-color:rgba(150,255,150,.5)"),Q(am.backgroundColor,"rgba")},ad.hsla=function(){return T("background-color:hsla(120,40%,100%,.5)"),Q(am.backgroundColor,"rgba")||Q(am.backgroundColor,"hsla")},ad.multiplebgs=function(){return T("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(am.background)},ad.backgroundsize=function(){return N("backgroundSize")},ad.borderimage=function(){return N("borderImage")},ad.borderradius=function(){return N("borderRadius")},ad.boxshadow=function(){return N("boxShadow")},ad.textshadow=function(){return av.createElement("div").style.textShadow===""},ad.opacity=function(){return S("opacity:.55"),/^0.55$/.test(am.opacity)},ad.cssanimations=function(){return N("animationName")},ad.csscolumns=function(){return N("columnCount")},ad.cssgradients=function(){var e="background-image:",d="gradient(linear,left top,right bottom,from(#9f9),to(white));",f="linear-gradient(left top,#9f9, white);";return T((e+"-webkit- ".split(" ").join(d+e)+ai.join(f+e)).slice(0,-e.length)),Q(am.backgroundImage,"gradient")},ad.cssreflections=function(){return N("boxReflect")},ad.csstransforms=function(){return !!N("transform")},ad.csstransforms3d=function(){var b=!!N("perspective");return b&&"webkitPerspective" in ap.style&&X("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(a,d){b=a.offsetLeft===9&&a.offsetHeight===3}),b},ad.csstransitions=function(){return N("transition")},ad.fontface=function(){var b;return X('@font-face {font-family:"font";src:url("https://")}',function(l,j){var i=av.getElementById("smodernizr"),h=i.sheet||i.styleSheet,a=h?h.cssRules&&h.cssRules[0]?h.cssRules[0].cssText:h.cssText||"":"";b=/src/i.test(a)&&a.indexOf(j.split(" ")[0])===0}),b},ad.generatedcontent=function(){var b;return X(["#",ao,"{font:0/0 a}#",ao,':after{content:"',ak,'";visibility:hidden;font:3px/1 a}'].join(""),function(a){b=a.offsetHeight>=3}),b},ad.video=function(){var b=av.createElement("video"),f=!1;try{if(f=!!b.canPlayType){f=new Boolean(f),f.ogg=b.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),f.h264=b.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),f.webm=b.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")}}catch(e){}return f},ad.audio=function(){var b=av.createElement("audio"),f=!1;try{if(f=!!b.canPlayType){f=new Boolean(f),f.ogg=b.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),f.mp3=b.canPlayType("audio/mpeg;").replace(/^no$/,""),f.wav=b.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),f.m4a=(b.canPlayType("audio/x-m4a;")||b.canPlayType("audio/aac;")).replace(/^no$/,"")}}catch(e){}return f},ad.localstorage=function(){try{return localStorage.setItem(ao,ao),localStorage.removeItem(ao),!0}catch(b){return !1}},ad.sessionstorage=function(){try{return sessionStorage.setItem(ao,ao),sessionStorage.removeItem(ao),!0}catch(b){return !1}},ad.webworkers=function(){return !!aw.Worker},ad.applicationcache=function(){return !!aw.applicationCache},ad.svg=function(){return !!av.createElementNS&&!!av.createElementNS(ae.svg,"svg").createSVGRect},ad.inlinesvg=function(){var b=av.createElement("div");return b.innerHTML="<svg/>",(b.firstChild&&b.firstChild.namespaceURI)==ae.svg},ad.smil=function(){return !!av.createElementNS&&/SVGAnimate/.test(aj.call(av.createElementNS(ae.svg,"animate")))},ad.svgclippaths=function(){return !!av.createElementNS&&/SVGClipPath/.test(aj.call(av.createElementNS(ae.svg,"clipPath")))};for(var L in ad){U(ad,L)&&(Y=L.toLowerCase(),ar[Y]=ad[L](),aa.push((ar[Y]?"":"no-")+Y))}return ar.input||M(),ar.addTest=function(e,c){if(typeof e=="object"){for(var f in e){U(e,f)&&ar.addTest(f,e[f])}}else{e=e.toLowerCase();if(ar[e]!==au){return ar}c=typeof c=="function"?c():c,typeof aq!="undefined"&&aq&&(ap.className+=" "+(c?"":"no-")+e),ar[e]=c}return ar},T(""),an=al=null,function(J,I){function z(f,e){var h=f.createElement("p"),g=f.getElementsByTagName("head")[0]||f.documentElement;return h.innerHTML="x<style>"+e+"</style>",g.insertBefore(h.lastChild,g.firstChild)}function y(){var b=s.elements;return typeof b=="string"?b.split(" "):b}function x(d){var c=B[d[D]];return c||(c={},C++,d[D]=C,B[C]=c),c}function w(b,h,e){h||(h=I);if(A){return h.createElement(b)}e||(e=x(h));var d;return e.cache[b]?d=e.cache[b].cloneNode():F.test(b)?d=(e.cache[b]=e.createElem(b)).cloneNode():d=e.createElem(b),d.canHaveChildren&&!G.test(b)?e.frag.appendChild(d):d}function v(b,m){b||(b=I);if(A){return b.createDocumentFragment()}m=m||x(b);var l=m.frag.cloneNode(),j=0,i=y(),h=i.length;for(;j<h;j++){l.createElement(i[j])}return l}function u(d,c){c.cache||(c.cache={},c.createElem=d.createElement,c.createFrag=d.createDocumentFragment,c.frag=c.createFrag()),d.createElement=function(a){return s.shivMethods?w(a,d,c):c.createElem(a)},d.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+y().join().replace(/\w+/g,function(b){return c.createElem(b),c.frag.createElement(b),'c("'+b+'")'})+");return n}")(s,c.frag)}function t(b){b||(b=I);var d=x(b);return s.shivCSS&&!E&&!d.hasCSS&&(d.hasCSS=!!z(b,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),A||u(b,d),b}var H=J.html5||{},G=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,F=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,E,D="_html5shiv",C=0,B={},A;(function(){try{var b=I.createElement("a");b.innerHTML="<xyz></xyz>",E="hidden" in b,A=b.childNodes.length==1||function(){I.createElement("a");var c=I.createDocumentFragment();return typeof c.cloneNode=="undefined"||typeof c.createDocumentFragment=="undefined"||typeof c.createElement=="undefined"}()}catch(d){E=!0,A=!0}})();var s={elements:H.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:H.shivCSS!==!1,supportsUnknownElements:A,shivMethods:H.shivMethods!==!1,type:"default",shivDocument:t,createElement:w,createDocumentFragment:v};J.html5=s,t(I)}(this,av),ar._version=at,ar._prefixes=ai,ar._domPrefixes=af,ar._cssomPrefixes=ag,ar.hasEvent=W,ar.testProp=function(b){return P([b])},ar.testAllProps=N,ar.testStyles=X,ar.prefixed=function(e,d,f){return d?N(e,d,f):N(e,"pfx")},ap.className=ap.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(aq?" js "+aa.join(" "):""),ar}(this,this.document),function(ad,ac,ab){function aa(b){return"[object Function]"==P.call(b)}function Z(b){return"string"==typeof b}function Y(){}function X(b){return !b||"loaded"==b||"complete"==b||"uninitialized"==b}function W(){var b=O.shift();M=1,b?b.t?R(function(){("c"==b.t?L.injectCss:L.injectJs)(b.s,0,b.a,b.x,b.e,1)},0):(b(),W()):M=0}function V(w,v,t,s,q,p,n){function m(a){if(!g&&X(h.readyState)&&(x.r=g=1,!M&&W(),h.onload=h.onreadystatechange=null,a)){"img"!=w&&R(function(){I.removeChild(h)},50);for(var c in D[v]){D[v].hasOwnProperty(c)&&D[v][c].onload()}}}var n=n||L.errorTimeout,h=ac.createElement(w),g=0,b=0,x={t:t,s:v,e:q,a:p,x:n};1===D[v]&&(b=1,D[v]=[]),"object"==w?h.data=v:(h.src=v,h.type=w),h.width=h.height="0",h.onerror=h.onload=h.onreadystatechange=function(){m.call(this,b)},O.splice(s,0,x),"img"!=w&&(b||2===D[v]?(I.insertBefore(h,J?null:Q),R(m,n)):D[v].push(h))}function U(g,e,j,i,h){return M=0,e=e||"j",Z(g)?V("c"==e?G:H,g,e,this.i++,j,i,h):(O.splice(this.i++,0,g),1==O.length&&W()),this}function T(){var b=L;return b.loader={load:U,i:0},b}var S=ac.documentElement,R=ad.setTimeout,Q=ac.getElementsByTagName("script")[0],P={}.toString,O=[],M=0,K="MozAppearance" in S.style,J=K&&!!ac.createRange().compareNode,I=J?S:Q.parentNode,S=ad.opera&&"[object Opera]"==P.call(ad.opera),S=!!ac.attachEvent&&!S,H=K?"object":S?"script":"img",G=S?"script":H,F=Array.isArray||function(b){return"[object Array]"==P.call(b)},E=[],D={},C={timeout:function(d,c){return c.length&&(d.timeout=c[0]),d}},N,L;L=function(e){function c(i){var i=i.split("!"),h=E.length,r=i.pop(),q=i.length,r={url:r,origUrl:r,prefixes:i},p,l,j;for(l=0;l<q;l++){j=i[l].split("="),(p=C[j.shift()])&&(r=p(r,j))}for(l=0;l<h;l++){r=E[l](r)}return r}function o(b,t,s,r,q){var p=c(b),l=p.autoCallback;p.url.split(".").pop().split("?").shift(),p.bypass||(t&&(t=aa(t)?t:t[b]||t[r]||t[b.split("/").pop().split("?")[0]]),p.instead?p.instead(b,t,s,r,q):(D[p.url]?p.noexec=!0:D[p.url]=1,s.load(p.url,p.forceCSS||!p.forceJS&&"css"==p.url.split(".").pop().split("?").shift()?"c":ab,p.noexec,p.attrs,p.timeout),(aa(t)||aa(l))&&s.load(function(){T(),t&&t(p.origUrl,q,r),l&&l(p.origUrl,q,r),D[p.url]=2})))}function n(x,w){function v(b,h){if(b){if(Z(b)){h||(s=function(){var i=[].slice.call(arguments);r.apply(this,i),q()}),o(b,s,w,0,u)}else{if(Object(b)===b){for(g in p=function(){var a=0,i;for(i in b){b.hasOwnProperty(i)&&a++}return a}(),b){b.hasOwnProperty(g)&&(!h&&!--p&&(aa(s)?s=function(){var i=[].slice.call(arguments);r.apply(this,i),q()}:s[g]=function(i){return function(){var a=[].slice.call(arguments);i&&i.apply(this,a),q()}}(r[g])),o(b[g],s,w,g,u))}}}}else{!h&&q()}}var u=!!x.test,t=x.load||x.both,s=x.callback||Y,r=s,q=x.complete||Y,p,g;v(u?x.yep:x.nope,!!t),t&&v(t)}var m,f,d=this.yepnope.loader;if(Z(e)){o(e,0,d,0)}else{if(F(e)){for(m=0;m<e.length;m++){f=e[m],Z(f)?o(f,0,d,0):F(f)?L(f):Object(f)===f&&n(f,d)}}else{Object(e)===e&&n(e,d)}}},L.addPrefix=function(d,c){C[d]=c},L.addFilter=function(b){E.push(b)},L.errorTimeout=10000,null==ac.readyState&&ac.addEventListener&&(ac.readyState="loading",ac.addEventListener("DOMContentLoaded",N=function(){ac.removeEventListener("DOMContentLoaded",N,0),ac.readyState="complete"},0)),ad.yepnope=T(),ad.yepnope.executeStack=W,ad.yepnope.injectJs=function(r,q,p,n,m,h){var g=ac.createElement("script"),f,b,n=n||L.errorTimeout;g.src=r;for(b in p){g.setAttribute(b,p[b])}q=h?W:q||Y,g.onreadystatechange=g.onload=function(){!f&&X(g.readyState)&&(f=1,q(),g.onload=g.onreadystatechange=null)},R(function(){f||(f=1,q(1))},n),m?g.onload():Q.parentNode.insertBefore(g,Q)},ad.yepnope.injectCss=function(b,o,n,m,l,h){var m=ac.createElement("link"),f,o=h?W:o||Y;m.href=b,m.rel="stylesheet",m.type="text/css";for(f in n){m.setAttribute(f,n[f])}l||(Q.parentNode.insertBefore(m,Q),R(o,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};(function(a,b){if(typeof exports=="object"){module.exports=b()}else{if(typeof define=="function"&&define.amd){define(b)}else{a.Spinner=b()}}})(this,function(){var D=["webkit","Moz","ms","O"],y={},v;function j(c,d){var a=document.createElement(c||"div"),f;for(f in d){a[f]=d[f]}return a}function m(c){for(var d=1,a=arguments.length;d<a;d++){c.appendChild(arguments[d])}return c}var b=function(){var a=j("style",{type:"text/css"});m(document.getElementsByTagName("head")[0],a);return a.sheet||a.styleSheet}();function E(G,c,e,H){var r=["opacity",c,~~(G*100),e,H].join("-"),i=0.01+e/H*100,h=Math.max(1-(1-G)/c*(100-i),G),p=v.substring(0,v.indexOf("Animation")).toLowerCase(),F=p&&"-"+p+"-"||"";if(!y[r]){b.insertRule("@"+F+"keyframes "+r+"{0%{opacity:"+h+"}"+i+"%{opacity:"+G+"}"+(i+0.01)+"%{opacity:1}"+(i+c)%100+"%{opacity:"+G+"}100%{opacity:"+h+"}}",b.cssRules.length);y[r]=1}return r}function B(d,a){var f=d.style,h,c;if(f[a]!==undefined){return a}a=a.charAt(0).toUpperCase()+a.slice(1);for(c=0;c<D.length;c++){h=D[c]+a;if(f[h]!==undefined){return h}}}function x(c,d){for(var a in d){c.style[B(c,a)||a]=d[a]}return c}function q(c){for(var d=1;d<arguments.length;d++){var a=arguments[d];for(var f in a){if(c[f]===undefined){c[f]=a[f]}}}return c}function z(a){var c={x:a.offsetLeft,y:a.offsetTop};while(a=a.offsetParent){c.x+=a.offsetLeft,c.y+=a.offsetTop}return c}var C={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:1/4,fps:20,zIndex:2000000000,className:"spinner",top:"auto",left:"auto",position:"relative"};function g(a){if(typeof this=="undefined"){return new g(a)}this.opts=q(a||{},g.defaults,C)}g.defaults={};q(g.prototype,{spin:function(O){this.stop();var I=this,i=I.opts,d=I.el=x(j(0,{className:i.className}),{position:i.position,width:0,zIndex:i.zIndex}),P=i.radius+i.length+i.width,L,F;if(O){O.insertBefore(d,O.firstChild||null);F=z(O);L=z(d);x(d,{left:(i.left=="auto"?F.x-L.x+(O.offsetWidth>>1):parseInt(i.left,10)+P)+"px",top:(i.top=="auto"?F.y-L.y+(O.offsetHeight>>1):parseInt(i.top,10)+P)+"px"})}d.setAttribute("role","progressbar");I.lines(d,I.opts);if(!v){var N=0,f=(i.lines-1)*(1-i.direction)/2,J,G=i.fps,o=G/i.speed,K=(1-i.opacity)/(o*i.trail/100),H=o/i.lines;(function M(){N++;for(var a=0;a<i.lines;a++){J=Math.max(1-(N+(i.lines-a)*H)%o*K,i.opacity);I.opacity(d,a*i.direction+f,J,i)}I.timeout=I.el&&setTimeout(M,~~(1000/G))})()}return I},stop:function(){var a=this.el;if(a){clearTimeout(this.timeout);if(a.parentNode){a.parentNode.removeChild(a)}this.el=undefined}return this},lines:function(h,n){var i=0,f=(n.lines-1)*(1-n.direction)/2,c;function o(d,a){return x(j(),{position:"absolute",width:n.length+n.width+"px",height:n.width+"px",background:d,boxShadow:a,transformOrigin:"left",transform:"rotate("+~~(360/n.lines*i+n.rotate)+"deg) translate("+n.radius+"px,0)",borderRadius:(n.corners*n.width>>1)+"px"})}for(;i<n.lines;i++){c=x(j(),{position:"absolute",top:1+~(n.width/2)+"px",transform:n.hwaccel?"translate3d(0,0,0)":"",opacity:n.opacity,animation:v&&E(n.opacity,n.trail,f+i*n.direction,n.lines)+" "+1/n.speed+"s linear infinite"});if(n.shadow){m(c,x(o("#000","0 0 4px #000"),{top:2+"px"}))}m(h,m(c,o(n.color,"0 0 1px rgba(0,0,0,.1)")))}return h},opacity:function(c,d,a){if(d<c.childNodes.length){c.childNodes[d].style.opacity=a}}});function A(){function a(c,d){return j("<"+c+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',d)}b.addRule(".spin-vml","behavior:url(#default#VML)");g.prototype.lines=function(p,n){var f=n.length+n.width,c=2*f;function H(){return x(a("group",{coordsize:c+" "+c,coordorigin:-f+" "+-f}),{width:c,height:c})}var F=-(n.width+n.length)*2+"px",h=x(H(),{position:"absolute",top:F,left:F}),t;function G(l,i,d){m(h,m(x(H(),{rotation:360/n.lines*l+"deg",left:~~i}),m(x(a("roundrect",{arcsize:n.corners}),{width:f,height:n.width,left:n.radius,top:-n.width>>1,filter:d}),a("fill",{color:n.color,opacity:n.opacity}),a("stroke",{opacity:0}))))}if(n.shadow){for(t=1;t<=n.lines;t++){G(t,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)")}}for(t=1;t<=n.lines;t++){G(t)}return m(p,h)};g.prototype.opacity=function(d,f,c,h){var l=d.firstChild;h=h.shadow&&h.lines||0;if(l&&f+h<l.childNodes.length){l=l.childNodes[f+h];l=l&&l.firstChild;l=l&&l.firstChild;if(l){l.opacity=c}}}}var w=x(j("group"),{behavior:"url(#default#VML)"});if(!B(w,"transform")&&w.adj){A()}else{v=B(w,"animation")}return g});!function(b){"function"==typeof define&&define.amd?define(["jquery"],b):b("object"==typeof exports?require("jquery"):jQuery)}(function(f){function e(P,O){function N(){return G.update(),L(),G}function M(){B.css(a,G.contentPosition/G.trackRatio),E.css(a,-G.contentPosition),D.css(c,G.trackSize),C.css(c,G.trackSize),B.css(c,G.thumbSize)}function L(){y?F[0].ontouchstart=function(b){1===b.touches.length&&(b.stopPropagation(),K(b.touches[0]))}:(B.bind("mousedown",K),C.bind("mousedown",I)),f(window).resize(function(){G.update("relative")}),G.options.wheel&&window.addEventListener?P[0].addEventListener(d,J,!1):G.options.wheel&&(P[0].onmousewheel=J)}function K(i){f("body").addClass("noSelect"),A=z?i.pageX:i.pageY,G.thumbPosition=parseInt(B.css(a),10)||0,y?(document.ontouchmove=function(b){b.preventDefault(),I(b.touches[0])},document.ontouchend=H):(f(document).bind("mousemove",I),f(document).bind("mouseup",H),B.bind("mouseup",H))}function J(l){if(G.contentRatio<1){var j=l||window.event,i="delta"+G.options.axis.toUpperCase(),b=-(j[i]||j.detail||-1/3*j.wheelDelta)/40;G.contentPosition-=b*G.options.wheelSpeed,G.contentPosition=Math.min(G.contentSize-G.viewportSize,Math.max(0,G.contentPosition)),P.trigger("move"),B.css(a,G.contentPosition/G.trackRatio),E.css(a,-G.contentPosition),(G.options.wheelLock||G.contentPosition!==G.contentSize-G.viewportSize&&0!==G.contentPosition)&&(j=f.event.fix(j),j.preventDefault())}}function I(b){if(G.contentRatio<1){var l=z?b.pageX:b.pageY,j=l-A;G.options.scrollInvert&&y&&(j=A-l);var i=Math.min(G.trackSize-G.thumbSize,Math.max(0,G.thumbPosition+j));G.contentPosition=i*G.trackRatio,P.trigger("move"),B.css(a,i),E.css(a,-G.contentPosition)}}function H(){f("body").removeClass("noSelect"),f(document).unbind("mousemove",I),f(document).unbind("mouseup",H),B.unbind("mouseup",H),document.ontouchmove=document.ontouchend=null}this.options=f.extend({},g,O),this._defaults=g,this._name=h;var G=this,F=P.find(".viewport"),E=P.find(".overview"),D=P.find(".scrollbar"),C=D.find(".track"),B=D.find(".thumb"),A=0,z="x"===this.options.axis,y="ontouchstart" in document.documentElement,d="onwheel" in document||document.documentMode>=9?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",c=z?"width":"height",a=z?"left":"top";return this.contentPosition=0,this.viewportSize=0,this.contentSize=0,this.contentRatio=0,this.trackSize=0,this.trackRatio=0,this.thumbSize=0,this.thumbPosition=0,this.update=function(j){var i=c.charAt(0).toUpperCase()+c.slice(1).toLowerCase();switch(this.viewportSize=F[0]["offset"+i],this.contentSize=E[0]["scroll"+i],this.contentRatio=this.viewportSize/this.contentSize,this.trackSize=this.options.trackSize||this.viewportSize,this.thumbSize=Math.min(this.trackSize,Math.max(0,this.options.thumbSize||this.trackSize*this.contentRatio)),this.trackRatio=this.options.thumbSize?(this.contentSize-this.viewportSize)/(this.trackSize-this.thumbSize):this.contentSize/this.trackSize,A=C.offset().top,D.toggleClass("disable",this.contentRatio>=1),j){case"bottom":this.contentPosition=this.contentSize-this.viewportSize;break;case"relative":this.contentPosition=Math.min(Math.max(this.contentSize-this.viewportSize,0),Math.max(0,this.contentPosition));break;default:this.contentPosition=parseInt(j,10)||0}return M(),G},N()}var h="tinyscrollbar",g={axis:"y",wheel:!0,wheelSpeed:40,wheelLock:!0,scrollInvert:!1,trackSize:!1,thumbSize:!1};f.fn[h]=function(a){return this.each(function(){f.data(this,"plugin_"+h)||f.data(this,"plugin_"+h,new e(f(this),a))})}});