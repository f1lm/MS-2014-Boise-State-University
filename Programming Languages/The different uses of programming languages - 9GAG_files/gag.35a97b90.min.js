jQuery.noConflict(),function(a,b){GAG={},b.GAG=GAG,GAG.GA={track:function(a,c,d,e){try{if(void 0==e&&(e=1),ga("send","event",a,c,d,e),b._ga&&b._ga instanceof Array)for(var f=0;f<b._ga.length;f++){var g=b._ga[f];ga(g+".send","event",a,c,d,e)}}catch(h){}}},b.console||(b.console={log:function(){}}),shortcut={all_shortcuts:{},add:function(a,c,d){var e={type:"keydown",propagate:!1,disable_in_input:!1,target:document,keycode:!1};if(d)for(var f in e)"undefined"==typeof d[f]&&(d[f]=e[f]);else d=e;var g=d.target;"string"==typeof d.target&&(g=document.getElementById(d.target));a=a.toLowerCase();var h=function(e){if(e=e||b.event,d.disable_in_input){var f;if(e.target?f=e.target:e.srcElement&&(f=e.srcElement),3==f.nodeType&&(f=f.parentNode),"INPUT"==f.tagName||"TEXTAREA"==f.tagName)return}e.keyCode?code=e.keyCode:e.which&&(code=e.which);var g=String.fromCharCode(code);188==code&&(g=","),190==code&&(g=".");var h=a.split("+"),i=0,j={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},l={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},m={shift:{wanted:!1,pressed:!1},ctrl:{wanted:!1,pressed:!1},alt:{wanted:!1,pressed:!1},meta:{wanted:!1,pressed:!1}};e.ctrlKey&&(m.ctrl.pressed=!0),e.shiftKey&&(m.shift.pressed=!0),e.altKey&&(m.alt.pressed=!0),e.metaKey&&(m.meta.pressed=!0);for(var n=0;k=h[n],n<h.length;n++)"ctrl"==k||"control"==k?(i++,m.ctrl.wanted=!0):"shift"==k?(i++,m.shift.wanted=!0):"alt"==k?(i++,m.alt.wanted=!0):"meta"==k?(i++,m.meta.wanted=!0):k.length>1?l[k]==code&&i++:d.keycode?d.keycode==code&&i++:g.toLowerCase()==k.toLowerCase()?i++:j[g]&&e.shiftKey&&(g=j[g],g==k&&i++);return i!=h.length||m.ctrl.pressed!=m.ctrl.wanted||m.shift.pressed!=m.shift.wanted||m.alt.pressed!=m.alt.wanted||m.meta.pressed!=m.meta.wanted||(c(e),d.propagate)?void 0:(e.cancelBubble=!0,e.returnValue=!1,e.stopPropagation&&(e.stopPropagation(),e.preventDefault()),!1)};this.all_shortcuts[a]={callback:h,target:g,event:d.type},g.addEventListener?g.addEventListener(d.type,h,!1):g.attachEvent?g.attachEvent("on"+d.type,h):g["on"+d.type]=h},remove:function(a){a=a.toLowerCase();var b=this.all_shortcuts[a];if(delete this.all_shortcuts[a],b){var c=b.event,d=b.target,e=b.callback;d.detachEvent?d.detachEvent("on"+c,e):d.removeEventListener?d.removeEventListener(c,e,!1):d["on"+c]=!1}}},GAG.Utils={loadScript:function(a,b){!function(){var c=document.createElement("script");c.type="text/javascript",c.async=!0,c.src=a,c.async=b;var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d)}()},scriptLoaded:function(b){var c=a("script").filter(function(){return a(this).attr("src")==b}).length;return c>0},parseJsonString:function(b){try{return a.parseJSON(b)}catch(c){}return{}},formatPostLink:function(a){return"http://"+GAG.Page.getDomain()+"/gag/"+a},formatProtocolForUrl:function(a){return a.replace(/(^.*http:)|(^.*https:)/g,location.protocol)},textSearch:function(b,c,d,e){"undefined"==typeof e&&(e={}),a(b).keyup(function(){var b=a(this).val(),f=0;a(c).each(function(){var c=-1,g=a(this).find(d).text();if((c=g.search(new RegExp(b,"i")))<0)a(this).hide();else{if(a(this).show(),"undefined"!=typeof e.highlight&&e.highlight){var h=g.substr(0,c)+"<strong>",i=g.substr(c,b.length)+"</strong>"+g.substr(c+b.length,g.length);a(this).find(d).html(h+i)}f++}})})},getUrlParam:function(a){return decodeURI((RegExp(a+"=(.+?)(&|$)").exec(location.search)||[,null])[1])},isCurrentlyFocusedInTypeable:function(){var b=a(document.activeElement).prop("tagName").toLowerCase();return"input"==b||"textarea"==b},formatNumber:function(a,b,c,d){"undefined"==typeof b&&(b=0),a=(a+"").replace(/[^0-9+\-Ee.]/g,"");var e,f=isFinite(+a)?+a:0,g=isFinite(+b)?Math.abs(b):0,h="undefined"==typeof d?",":d,i="undefined"==typeof c?".":c,j=function(a,b){var c=Math.pow(10,b);return""+Math.round(a*c)/c};return e=(g?j(f,g):""+Math.round(f)).split("."),e[0].length>3&&(e[0]=e[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,h)),(e[1]||"").length<g&&(e[1]=e[1]||"",e[1]+=new Array(g-e[1].length+1).join("0")),e.join(i)},cookieCheckKey:"cchk",isCookieEnabled:function(){var b=a.cookie(GAG.Utils.cookieCheckKey);return null!=b?!0:(a.cookie(GAG.Utils.cookieCheckKey,1,{duration:1e3}),b=a.cookie(GAG.Utils.cookieCheckKey),null!=b?!0:!1)}},GAG.Validator={isValidLoginKey:function(a){return this.isValidUsername(a)||this.isValidEmail(a)},isValidUsername:function(a){return a.test("^[0-9a-zA-Z_]{3,15}$")},isValidEmail:function(a){return null!=a.match("^([a-zA-Z0-9._-]+)@([a-zA-Z0-9.-]+)\\.([a-zA-Z]{2,4})$")},isValidFullName:function(b){return a.trim(b).length>0},isValidPassword:function(a,b,c){var d=!0;return void 0!=b&&a.length<b&&(d=!1),void 0!=c&&a.length>c&&(d=!1),0==a.length&&(d=!1),d},isValidGender:function(a){return"F"==a||"M"==a},MONTH_DAYS:[31,29,31,30,31,30,31,31,30,31,30,31],isValidDateValues:function(a,b,c){var d=a%400==0||a%100!=0&&a%4==0;this.MONTH_DAYS[1]=d?29:28;var e=c>=1&&31>=c&&b>=1&&12>=b&&a>=1900,f=c<=this.MONTH_DAYS[b-1];return e&&f},isValidPostLink:function(a){var b=new RegExp("^http(s?)://"+GAG.Page.getDomain()+"/gag/([1-9])([0-9]*)(\\?[^ ]*)?$");return a.trim().test(b)},lookLikeURL:function(a){var b=new RegExp("^http(s?)://");return a.trim().test(b)}},GAG.Response=function(){this._isSuccess=!1,this._keys={},this.setKey(GAG.Response.Constants.RESPONSE_MESSAGE,"")},GAG.Response.Constants={RESPONSE_MESSAGE:"RESPONSE_MESSAGE",RESPONSE_CODE:"RESPONSE_CODE",RESPONSE_DATA:"RESPONSE_DATA"},GAG.Response.prototype.succeeded=function(a){return this._isSuccess=!0,this.setKey(GAG.Response.Constants.RESPONSE_MESSAGE,a),this},GAG.Response.prototype.failed=function(a){return this._isSuccess=!1,this.setKey(GAG.Response.Constants.RESPONSE_MESSAGE,a),this},GAG.Response.prototype.isSuccess=function(){return this._isSuccess},GAG.Response.prototype.setKey=function(a,b){return this._keys[a]=b,this},GAG.Response.prototype.getKey=function(a){return this._keys[a]},GAG.Response.prototype.setCode=function(a){return this.setKey(GAG.Response.Constants.RESPONSE_CODE,a),this},GAG.Response.prototype.getCode=function(){return this.getKey(GAG.Response.Constants.RESPONSE_CODE)},GAG.Response.prototype.setData=function(a){return this.setKey(GAG.Response.Constants.RESPONSE_DATA,a),this},GAG.Response.prototype.getData=function(){return this.getKey(GAG.Response.Constants.RESPONSE_DATA)},GAG.Response.prototype.setMessage=function(a){return this.setKey(GAG.Response.Constants.RESPONSE_MESSAGE,a),this},GAG.Response.prototype.getMessage=function(){return this.getKey(GAG.Response.Constants.RESPONSE_MESSAGE)},GAG.BaseObject=function(){this._namespace=""},GAG.BaseObject.prototype.setNamespace=function(a){this._namespace=a},GAG.BaseObject.prototype.log=function(a,b){console.log(this._namespace+" "+(b?b+" ":"")+a)},GAG.BaseObject.prototype.failed=function(a){return(new GAG.Response).failed(a)},GAG.BaseObject.prototype.succeeded=function(a){return(new GAG.Response).succeeded(a)},GAG.Model=function(){this._base=this},GAG.Model.prototype=new GAG.BaseObject,GAG.Model.prototype.getBase=function(){return this._base},GAG.Model.prototype.init=function(){},GAG.Configs={_configs:{},init:function(){},load:function(a){this._configs=a?a:{}},get:function(a){for(var b=a.split("."),c=this._configs,d="";c&&b.length>0;)c=c[b.shift()],d=c;return d},Facebook:{init:function(){},getAppId:function(){return GAG.Configs.get("configs.facebook.app_id")}}},GAG.State={fbAsyncInited:!1},GAG.Page={_domain:"9gag.com",_backUrl:"",_pageKey:"",init:function(){this._domain=GAG.Configs.get("page.domain"),this._backUrl=GAG.Configs.get("page.back_url"),this._pageKey=GAG.Configs.get("page.page_key")},getProtocol:function(){return"https:"==document.location.protocol?"https":"http"},getDomain:function(){return this._domain},getCookieOptions:function(){return{path:"/",expires:7300}},getPageKey:function(){return this._pageKey},load:function(a){b.location=a},preloadImage:function(a){var b=new Image;b.src=a;var c=document.getElementById("tmp-img");c&&c.appendChild(b)},getBackUrl:function(){return this._backUrl},KEYS:{NEW_VOTE_PAGE:"v",POST_PAGE:"post",LANDING_PAGE:"landing",PROFILE_PAGE:"profile",MEMBER_PAGE:"member",HOT_PAGE:"hot",TRENDING_PAGE:"trending",VOTE_PAGE:"vote",INVITE_FACEBOOK_PAGE:"invite",CONTACT_PAGE:"contact",UPLOAD_PAGE:"page-zone-submit",SIGNUP_PAGE:"signup"},isNewVotePage:function(){return this._pageKey==this.KEYS.NEW_VOTE_PAGE},isPostPage:function(){return this._pageKey==this.KEYS.POST_PAGE},isLandingPage:function(){return this._pageKey==this.KEYS.LANDING_PAGE},isListingPage:function(){return jQuery.inArray(this._pageKey,[this.KEYS.HOT_PAGE,this.KEYS.TRENDING_PAGE,this.KEYS.VOTE_PAGE])>=0?!0:!1},isProfilePage:function(){return this._pageKey==this.KEYS.PROFILE_PAGE},isMemberPage:function(){return this._pageKey==this.KEYS.MEMBER_PAGE},isInviteFacebookPage:function(){return this._pageKey==this.KEYS.INVITE_FACEBOOK_PAGE},isUploadPage:function(){return this._pageKey==this.KEYS.UPLOAD_PAGE},isContactPage:function(){return this._pageKey==this.KEYS.CONTACT_PAGE},isSignupPage:function(){return this._pageKey==this.KEYS.SIGNUP_PAGE}},GAG.Facebook={_xfbmlRenderItems:[],_fbInitedCallbacks:[],init:function(){},asyncInit:function(){GAG.State.fbAsyncInited=!0,this.initApp(),this.executeRenderQueue()},initApp:function(){FB.init({appId:GAG.Configs.Facebook.getAppId(),version:"v2.2",xfbml:!1,status:!0,cookie:!0}),this._checkFacebookLoginStatus()},addInitCallback:function(a,b){GAG.Facebook._fbInitedCallbacks.push({callbackType:a,callback:b})},_executeFbInitedCallbacks:function(a){for(var b=0;b<this._fbInitedCallbacks.length;b++){var c=this._fbInitedCallbacks[b];-1===a.indexOf(c.callbackType)||"function"!=typeof c.callback||this._fbInitedCallbacks[b].executed||(this._fbInitedCallbacks[b].executed=!0,c.callback())}},sessionChangeHandler:function(a){a&&("connected"===a.status?a.authResponse&&(GAG.Facebook.autoLogin(),GAG.Facebook._executeFbInitedCallbacks("connected,logged-in,all")):GAG.Facebook._executeFbInitedCallbacks("not_authorized"===a.status?"logged-in,all":"logged-out,all"))},_checkFacebookLoginStatus:function(){FB.getLoginStatus(GAG.Facebook.sessionChangeHandler),FB.Event.subscribe("auth.authResponseChange",GAG.Facebook.sessionChangeHandler)},executeRenderQueue:function(){for(var a=0;a<this._xfbmlRenderItems.length;a++){var b=this._xfbmlRenderItems[a];this.parseElement(b.elementId,b.callback)}},renderElement:function(a,b){GAG.State.fbAsyncInited?this.parseElement(a,b):this._xfbmlRenderItems.push({elementId:a,callback:b})},parseElement:function(a,b){var c=document.getElementById(a);if(c)try{b?FB.XFBML.parse(c,b):FB.XFBML.parse(c)}catch(d){}},login:function(a){FB.login(function(b){return b.authResponse&&("function"==typeof a?a.call(b):alert("it is not a callback")),b.authResponse})},autoConnectKey:"auto_log",autoConnectDuration:{path:"/",duration:7300},autoLogin:function(){if(!GAG.User.isLoggedIn()&&GAG.Utils.isCookieEnabled()){var b=a.cookie(GAG.Facebook.autoConnectKey),c={a:!1,d:!1,lo:!1,dl:!1};if((b||b===!1)&&(c=JSON.parse(b)),null!=c){if(c.a)return;if(!c.dl&&(c.lo||c.d))return}GAG.GA.track("Facebook-Login","Auto",""),c.a=!0;{var d=JSON.stringify(c);a.cookie(GAG.Facebook.autoConnectKey,d,GAG.Facebook.autoConnectDuration)}GAG.Facebook.Connect.autoLogin(location.href)}},renderLike:function(b,c,d){{var e=this.Plugins.Like.getElement(d);a("#"+b).html("").append(e)}this.renderElement(b,c)},Plugins:{Like:{getElement:function(b){var c={"class":"fb-like","data-href":"","data-layout":"button_count","data-show-faces":"false","data-font":"arial","data-width":300};b=a.extend(c,b);var d=a("<div/>");for(var e in b)d.attr(e,b[e]);return d}}},Connect:{FB_CONNECT_CALLBACK_URL:"/connect/facebook-callback",_additionalParams:{},addParam:function(a,b){this._additionalParams[a]=b},_getConnectParamsString:function(){var a="",b=0;for(k in this._additionalParams)a+=(0==b?"":"&")+k+"="+encodeURIComponent(this._additionalParams[k]),b++;return a},_getConnectUrl:function(){var a=GAG.Facebook.Connect.FB_CONNECT_CALLBACK_URL;return a+="?"+this._getConnectParamsString()},autoLogin:function(a){try{(void 0==a||null==a)&&(a="/");var c="https://"+GAG.Page.getDomain()+"/connect/auto-login",d="next="+encodeURIComponent(a+"&"+this._getConnectParamsString());c+="?"+d,b.location=c}catch(e){return}},connect:function(a){try{(void 0==a||null==a)&&(a="/");var c="https://"+GAG.Page.getDomain()+"/connect/facebook",d="next="+encodeURIComponent(a+"&"+this._getConnectParamsString());c+="?"+d,b.location=c}catch(e){return}}}},b.fbAsyncInit=function(){GAG.Facebook.asyncInit()},GAG.GPlus={btnClicked:!1,_asyncInited:!1,_renderQueue:[],init:function(){this._checkAsyncInit()},_checkAsyncInit:function(){"undefined"!=typeof gapi?this.asyncInit():setTimeout(a.proxy(this._checkAsyncInit,this),100)},asyncInit:function(){this._asyncInited=!0,this._executeQueue()},renderButton:function(a,b){var c=this._getRenderOptions();c.callback=b,this._asyncInited?gapi.signin.render(a,c):this._renderQueue.push({domId:a,options:c})},_executeQueue:function(){for(;this._renderQueue.length>0;){var a=this._renderQueue.shift();gapi.signin.render(a.domId,a.options)}},_getRenderOptions:function(){var a={clientid:GAG.Configs.get("configs.gplus.client_id"),cookiepolicy:"single_host_origin",accesstype:"offline",scope:"https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/userinfo.email"},b=GAG.Configs.get("configs.gplus.app_package_name");return b&&(a.apppackagename=b),a}},b.gplusRender=function(){},GAG.User=a.extend({},new GAG.Model,function(){var a={_isLoggedIn:null,_user:null};return{init:function(){a._user=GAG.Configs.get("user")},isLoggedIn:function(b,c){if(a._isLoggedIn=this.getUserId()>0,b&&!a._isLoggedIn){var d="https://"+GAG.Page.getDomain()+"/login";c&&(d+="?next="+c),GAG.Page.load(d)}return a._isLoggedIn},getUsername:function(){return a._user&&a._user.username?a._user.username:""},getUserId:function(){return a._user&&a._user.id?a._user.id:0}}}()),GAG.Login=a.extend({},new GAG.Model,{userId:""}),GAG.Entry=function(){var b={API:{REPORT_ENTRY_URI:"/report-post"},init:function(){},_isRequesting:!1,report:function(c,d,e,f,g){if(GAG.User.isLoggedIn(!0,GAG.Page.getBackUrl())&&!b._isRequesting){var h={entryId:c,type:d,link:e},i=b.API.REPORT_ENTRY_URI;a.ajax({type:"POST",url:i,data:h,beforeSend:function(){GAG.Entry._isRequesting=!0},complete:function(){GAG.Entry._isRequesting=!1},success:function(a){var b=GAG.Utils.parseJsonString(a);b.okay?f(c):g(c)},error:function(){g(c)}})}}};return{init:b.init,report:b.report}}(),GAG.Vote=a.extend({},new GAG.Model,{API:{URL_LIKE:"/vote/like",URL_DISLIKE:"/vote/dislike",URL_UNLIKE:"/vote/unlike"},_requests:{},_isRequesting:!1,init:function(){},_submitRequest:function(b,c,d,e){if(void 0!==c){this._isRequesting;var f={id:c};a.ajax({type:"POST",url:b,data:f,beforeSend:function(){GAG.Vote._isRequesting=!0,"function"==typeof d&&d(c)},complete:function(){GAG.Vote._isRequesting=!1},success:function(a){var b=GAG.Utils.parseJsonString(a);b.id&&b.msg?"function"==typeof d&&d(c):"function"==typeof e&&e(c)},error:function(){"function"==typeof e&&e(c)}})}},like:function(a,b,c){this._submitRequest(this.API.URL_LIKE,a,b,c)},unlike:function(a,b,c){this._submitRequest(this.API.URL_UNLIKE,a,b,c)},dislike:function(a,b,c){this._submitRequest(this.API.URL_DISLIKE,a,b,c)}}),GAG.Track={tuvCookie:"_tuv",tuvCookieMax:100,baseUrl:"http://t.9gag.com",imageUrl:"/img.gif",_entryIDsBuffer:{},init:function(){var a=GAG.Configs.get("configs.t.domain");a&&(GAG.Track.baseUrl=a)},_saveHistory:function(b,c){var d=c.join(",");a.cookie(b,d,{expires:1e4,path:"/",domain:GAG.Configs.get("page.cookie_domain")})},_checkUnique:function(b,c,d){if(d.length>32)var d=a.md5(d);if(GAG.Track._entryIDsBuffer[d])return!1;GAG.Track._entryIDsBuffer[d]=1;var e=a.cookie(b),f=[];return e&&(f=e.split(",")),-1==f.indexOf(d)?(f.length>=c&&f.shift(),f.push(d),GAG.Track._saveHistory(b,f),!0):!1},uniqueViewed:function(a){var b="unique-viewed";if("undefined"!=typeof a.entry){for(var c=a.entry+""||"",d=c.split(","),e=[],f=0;f<d.length;f++)GAG.Track._checkUnique(GAG.Track.tuvCookie,GAG.Track.tuvCookieMax,d[f])&&e.push(d[f]);d.length>0&&e.length>0&&(a.entry=e.join(","),GAG.Track.event(b,"v",a))}},read:function(b){a.ajax({type:"POST",url:"/read/ids",data:{ids:b.join(",")},dataType:"json",success:function(){},error:function(){}})},markReadInCookie:function(a){GAG.Track._checkUnique("viewed_ids",GAG.Track.tuvCookieMax,a)},event:function(a,b,c){var d=c.user?c.user:GAG.Configs.get("user.id");d||(d="");var e={action:a,value:b,ref:"",label:"undefined"==typeof c.label?"":c.label,labelValue:"undefined"==typeof c.labelValue?"":c.labelValue,platform:"undefined"==typeof c.platform?"":c.platform,entry:"undefined"==typeof c.entry?"":c.entry,user:d,view:"undefined"==typeof c.view?"":c.view};e.ref=GAG.Track._getQueryStringParam("ref");var f=GAG.Track._formatUrl(e),g=new Image;g.src=f},_getUrl:function(){return location.href},_getReferrer:function(){return document.referrer},_getTime:function(){var a=new Date,b=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds()),c=Math.round(b.getTime()/1e3);return c},_getQueryStringParam:function(a){for(var c=b.location.href,d=c.split(/[\?&]+/),e=0;e<d.length;e++){var f=d[e].split("=");if(f[0]==a)return f[1]}return""},_formatUrl:function(a){var b=GAG.Track.baseUrl+GAG.Track.imageUrl,c="",d=[];a&&(void 0!=a.action&&null!=a.action&&d.push("a="+encodeURIComponent(a.action)),void 0!=a.value&&null!=a.value&&d.push("v="+encodeURIComponent(a.value)),void 0!=a.ref&&null!=a.ref&&d.push("ref="+encodeURIComponent(a.ref)),void 0!=a.label&&null!=a.label&&d.push("lbl="+encodeURIComponent(a.label)),void 0!=a.labelValue&&null!=a.labelValue&&d.push("lblv="+encodeURIComponent(a.labelValue)),void 0!=a.platform&&null!=a.platform&&d.push("p="+encodeURIComponent(a.platform)),void 0!=a.entry&&null!=a.entry&&d.push("e="+encodeURIComponent(a.entry)),void 0!=a.user&&null!=a.user&&d.push("u="+encodeURIComponent(a.user)),void 0!=a.view&&null!=a.view&&d.push("w="+encodeURIComponent(a.view))),d.push("url="+encodeURIComponent(GAG.Track._getUrl())),d.push("referrer="+encodeURIComponent(GAG.Track._getReferrer())),d.push("t="+encodeURIComponent(GAG.Track._getTime()));for(var e=0;e<d.length;e++)c+=d[e]+"&";return b+="?"+c}},GAG.Toast=function(){var b={_toastMsgCookieKey:"toastMsg",init:function(){},getToast:function(){if(!navigator.cookieEnabled)return{};var c=a.cookie(b._toastMsgCookieKey);if(a.cookie(b._toastMsgCookieKey,null,{domain:GAG.Configs.get("page.cookie_domain"),path:"/"}),!c)return{};if(c=c.split(","),0==c.length)return{};c=c[0];var d=b.mapToastCode(c);return"undefined"!=typeof d?d:{}},mapToastCode:function(a){var c=b.COLOR,d=b.TEXT,e=b.MAPPING,f={SAFE_MODE_DISABLED:{color:c.COLOR_RED,text:d.SAFE_MODE_DISABLED},POST_REMOVED:{color:c.COLOR_YELLOW,text:d.POST_REMOVED},WELCOME_BACK:{color:c.COLOR_YELLOW,text:d.WELCOME_BACK},WELCOME_TO_9GAG:{color:c.COLOR_YELLOW,text:d.WELCOME_TO_9GAG},POST_DELETED:{color:c.COLOR_YELLOW,text:d.POST_DELETED},POST_DISASSOCIATED:{color:c.COLOR_YELLOW,text:d.POST_DISASSOCIATED},PROFILE_SETTING_SAVED:{color:c.COLOR_GREEN,text:d.PROFILE_SETTING_SAVED},PROFILE_SETTING_ERROR:{color:c.COLOR_RED,text:d.PROFILE_SETTING_ERROR},PROFILE_LANGUAGE_CHANGED:{color:c.COLOR_YELLOW,text:d.PROFILE_LANGUAGE_CHANGED},CONTACT_FORM_SENT:{color:c.COLOR_GREEN,text:d.CONTACT_FORM_SENT},CONTACT_FORM_ERROR:{color:c.COLOR_RED,text:d.CONTACT_FORM_ERROR},LOGIN_FAILED:{color:c.COLOR_RED,text:d.LOGIN_FAILED},PRIVACY_SETTING_NOTICE:{color:c.COLOR_YELLOW,text:d.PRIVACY_SETTING_NOTICE},ACCOUNT_DELETED:{color:c.COLOR_YELLOW,text:d.ACCOUNT_DELETED}};return f[e[a]]},COLOR:{COLOR_RED:"red",COLOR_YELLOW:"yellow",COLOR_GREEN:"green",COLOR_BLUE:"blue"},TEXT:{SAFE_MODE_DISABLED:"NSFW Posts are shown",POST_REMOVED:"Ooooops! The post you're looking for has been reported by the community and removed.",WELCOME_BACK:"Awww Yeah! Welcome back.",WELCOME_TO_9GAG:"Me Gusta! Welcome to 9GAG, go have fun now!",POST_DELETED:"The post is removed.",POST_DISASSOCIATED:"The post is removed from your profile.",PROFILE_SETTING_SAVED:"Your settings have been saved.",PROFILE_SETTING_ERROR:"Ooooops! There is an error.",PROFILE_LANGUAGE_CHANGED:"Language have been changed.",CONTACT_FORM_SENT:"Your email have been sent.",CONTACT_FORM_ERROR:"Ooooops! There is an error.",LOGIN_FAILED:"Ooooops! There is an error logging in.",PRIVACY_SETTING_NOTICE:"You can now control your profile privacy in settings.",ACCOUNT_DELETED:"Your account has been deleted."},MAPPING:{1:"SAFE_MODE_DISABLED",2:"WELCOME_BACK",3:"POST_REMOVED",4:"WELCOME_TO_9GAG",5:"POST_DELETED",6:"POST_DISASSOCIATED",7:"PROFILE_SETTING_SAVED",8:"PROFILE_SETTING_ERROR",9:"PROFILE_LANGUAGE_CHANGED",10:"CONTACT_FORM_SENT",11:"CONTACT_FORM_ERROR",12:"LOGIN_FAILED",13:"PRIVACY_SETTING_NOTICE",14:"ACCOUNT_DELETED"}};return{init:b.init,getToast:b.getToast}}(),GAG.CacheFactory=a.extend({},new GAG.Model,{storageImpl:{},sessionStorageImpl:{},nonPersistentLS:{structureLocalStorage:{},setItem:function(a,b){this.structureLocalStorage[a]=b},getItem:function(a){return"undefined"!=typeof this.structureLocalStorage[a]?this.structureLocalStorage[a]:null},removeItem:function(a){this.structureLocalStorage[a]=void 0}},init:function(){var a="9gagTestStorage";try{localStorage.setItem(a,""),localStorage.removeItem(a),this.storageImpl=localStorage}catch(c){GAG.CacheableAbstract.log("Local Storage is not available, use non-persistent storage instead"),this.storageImpl=this.nonPersistentLS}var d=!1;try{b.sessionStorage&&(sessionStorage.setItem(a,""),sessionStorage.removeItem(a),this.sessionStorageImpl=sessionStorage,d=!0)}catch(c){GAG.CacheableAbstract.log("Session Storage is not available, use non-persistent storage instead")}d||(this.sessionStorageImpl=this.nonPersistentLS)}}),GAG.CacheableAbstract=a.extend({},new GAG.Model,{remoteHandler:null,cacheKey:"",cacheTTL:3600,remoteKey:"",init:function(a){this.remoteHandler=a},get:function(a){return this.getFromCache(a)},formatRemoteParams:function(){return{}},getFromCache:function(){if(""==this.cacheKey)return GAG.CacheableAbstract.log("getFromCache: empty cache key"),null;var a=GAG.CacheFactory.storageImpl.getItem(this.cacheKey);return null==a?null:(a=JSON.parse(a),void 0==a.expireAt?(GAG.CacheableAbstract.log("getFromCache: invalid cache. Reason: no expire time.  do clear:"+this.cacheKey),GAG.CacheFactory.storageImpl.removeItem(this.cacheKey),null):a.expireAt<this.getCurrentTime()?(GAG.CacheableAbstract.log("getFromCache: invalid cache. Reason: expired.  do clear:"+this.cacheKey),GAG.CacheFactory.storageImpl.removeItem(this.cacheKey),null):a.data)},addToCache:function(){return!1},removeFromCache:function(){return!1},updateCache:function(a){if(""==this.cacheKey)return GAG.CacheableAbstract.log("updateCache: empty cache key"),!1;var b={};return b.data=a,b.expireAt=this.cacheTTL+this.getCurrentTime(),GAG.CacheFactory.storageImpl.setItem(this.cacheKey,JSON.stringify(b)),!0},clearCache:function(){return""==this.cacheKey?(GAG.CacheableAbstract.log("clearCache: empty cache key"),null):(GAG.CacheFactory.storageImpl.removeItem(this.cacheKey),!0)},getCurrentTime:function(){return Math.floor(Date.now()/1e3)},log:function(){}}),GAG.CacheableRemoteHandler=a.extend({},new GAG.Model,{remoteUrl:"/cacheable",queue:[],graceCookieKey:"cacheableGrace",addToQueue:function(a,b){this.queue.push({params:a,callback:b})},processQueue:function(){var b=this;if(0==this.queue.length)return void GAG.CacheableAbstract.log("Skip call remoteUrl. Reason: empty queue");if(!GAG.CacheableRemoteHandler.issetPhpSessionId()||GAG.CacheableRemoteHandler.isInGracePeriod())return GAG.CacheableRemoteHandler.issetPhpSessionId()||GAG.CacheableAbstract.log("GAG.CacheableRemoteHandler php session id is not set. Bye!!"),void(GAG.CacheableRemoteHandler.isInGracePeriod()&&GAG.CacheableAbstract.log("GAG.CacheableRemoteHandler is in grace period. Bye!!"));GAG.CacheableAbstract.log("calling cacheable");var c=[],d=[];a.each(this.queue,function(a,b){c[a]=b.params,d[a]=b.callback}),a.ajax({url:b.remoteUrl,type:"POST",dataType:"json",data:{json:JSON.stringify(c)},success:function(b){a.each(d,function(a,c){c(b)})},complete:function(){a.each(d,function(a,b){b(c)})}}),this.queue=[]},isInGracePeriod:function(){return a.cookie(GAG.CacheableRemoteHandler.graceCookieKey)},issetPhpSessionId:function(){return a.cookie("PHPSESSID")}}),GAG.CacheableVote=a.extend({},GAG.CacheableAbstract,{cacheKey:"cacheableVote",cacheTTL:1800,formatRemoteParams:function(){return{action:"vote",params:{}}},get:function(){var a=this.getFromCache();return null===a?a:a},addToCache:function(b){var c=this.getFromCache();return null===c&&(c={}),a.each(b,function(a,b){c[a]=b}),this.updateCache(c)},removeFromCache:function(){return!1}}),GAG.CacheableUser=a.extend({},GAG.CacheableAbstract,{cacheKey:"cacheableUser",cacheTTL:1800,formatRemoteParams:function(){return{action:"user",params:{}}},get:function(){var a=this.getFromCache();return null===a?a:a},addToCache:function(){return!1},removeFromCache:function(){return!1}}),GAG.CacheableUserPreference=a.extend({},GAG.CacheableAbstract,{cacheKey:"cacheableUserPreference",cacheTTL:1800,formatRemoteParams:function(){return{action:"user-preference",params:{}}},get:function(){return this.getFromCache()},addToCache:function(){return!1},removeFromCache:function(){return!1}}),GAG.CacheableUserUpload=a.extend({},GAG.CacheableAbstract,{cacheKey:"cacheableUserUpload",cacheTTL:1800,formatRemoteParams:function(){return{action:"user-upload",params:{}}},get:function(){return this.getFromCache()},addToCache:function(){return!1},removeFromCache:function(){return!1}}),GAG.CacheableUserQuota=a.extend({},GAG.CacheableAbstract,{cacheKey:"cacheableUserQuota",cacheTTL:1800,formatRemoteParams:function(){return{action:"user-quota",params:{}}},get:function(){return this.getFromCache()},addToCache:function(){return!1},removeFromCache:function(){return!1}}),GAG.Controller=function(){this._base=this},GAG.Controller.prototype=new GAG.BaseObject,GAG.Controller.prototype.getBase=function(){return this._base},GAG.Controller.prototype.init=function(){},GAG.Controller.prototype.onLoad=function(){},GAG.Controller.prototype.onResize=function(){},GAG.Controller.prototype.onScroll=function(){},GAG.Controller.prototype.onDomReady=function(){},GAG.CacheController=a.extend({},new GAG.Controller,{_dataMap:{},_updateQueue:[],_entryUpdateQueue:[],init:function(){this._dataMap.entryInfo={}},keys:{ENTRY_LIST:"entryList",ENTRY_INFO:"entryInfo",FEATURED_LIST:"featuredList",FEATURED_INFO:"featuredInfo"},getValue:function(a){return this._dataMap[a]},setValue:function(a,b){this._dataMap[a]=b},invalidate:function(a){delete this._dataMap[a]},reset:function(){this._dataMap={}},notifyForCacheUpdate:function(a){this._updateQueue.push(a)},isUpdateNeeded:function(b){return a.inArray(b,this._updateQueue)>=0},notifyForCacheUpdateCompleted:function(b){var c=a.inArray(b,this._updateQueue);c>=0&&this._updateQueue.splice(c,1)},setList:function(a,b){a instanceof Array&&(this._dataMap[b]=a)},getList:function(a){return this._dataMap[a]||(this._dataMap[a]=[]),this._dataMap[a]},addItemsToList:function(b,c){for(var d=0;d<b.length;d++)a.inArray(b[d],this.getList(c))===!1&&this.getList(c).push(b[d])},setItemInfoForList:function(a,b,c){this.getList(c)[a]=b},getItemInfoForList:function(a,b){return this.getList(b)||(this.getList(b)[a]={}),this.getList(b)[a]},getItemInfoForKeyInList:function(a,b,c){return this.getItemInfoForList(a,c)?this.getItemInfoForList(a,c)[b]:null},handlers:{getEntryInfoFromDOM:function(b){var c={offset:a(b).offset(),height:a(b).height(),outerHeight:a(b).outerHeight()};return c},getFeaturedItemInfoFromDOM:function(b){var c={top:a(b).offset().top,height:a(b).height()};return c},featuredItemHandler:{setFeaturedList:function(a){var b=GAG.CacheController;b.setList(a,b.keys.FEATURED_LIST)},getFeaturedList:function(){var a=GAG.CacheController;return a.getList(a.keys.FEATURED_LIST)},addFeaturedItemsToList:function(a){var b=GAG.CacheController;b.addItemsToList(a,b.keys.FEATURED_LIST)},setFeaturedItemInfo:function(a,b){var c=GAG.CacheController;c.setItemInfoForList(a,b,c.keys.FEATURED_INFO)},getFeaturedItemInfo:function(a){var b=GAG.CacheController;return b.getItemInfoForList(a,b.keys.FEATURED_INFO)},getFeaturedItemInfoForKey:function(a,b){var c=GAG.CacheController;return c.getItemInfoForKeyInList(a,b,c.keys.FEATURED_INFO)}},entryHandler:{_self:GAG.CacheController,setEntryList:function(a){var b=GAG.CacheController;b.setList(a,b.keys.ENTRY_LIST)},getEntryList:function(){var a=GAG.CacheController;return a.getList(a.keys.ENTRY_LIST)},addEntriesToList:function(a){var b=GAG.CacheController;b.addItemsToList(a,b.keys.ENTRY_LIST)},setEntryInfo:function(a,b){var c=GAG.CacheController;c.setItemInfoForList(a,b,c.keys.ENTRY_INFO)},getEntryInfo:function(a){var b=GAG.CacheController;return b.getItemInfoForList(a,b.keys.ENTRY_INFO)},getEntryInfoForKey:function(a,b){var c=GAG.CacheController;return c.getItemInfoForKeyInList(a,b,c.keys.ENTRY_INFO)}}},getFeaturedItemHandler:function(){var a=GAG.CacheController;return a.handlers.featuredItemHandler},getEntryHandler:function(){var a=GAG.CacheController;return a.handlers.entryHandler},parseEntryInfo:function(){var b=GAG.CacheController,c=[];a(GAG.ListController.selectors.ENTRY_CONTAINER).each(function(){var d=a(this).data("entry-id");c.push(d);var e=b.handlers.getEntryInfoFromDOM(a(this));b.handlers.entryHandler.setEntryInfo(d,e)}),b.handlers.entryHandler.setEntryList(c)},updateEntryInfoForEntryIds:function(b){for(var c=0;c<b.length;c++){var d=a("#jsid-entry-entity-"+b[c]);d&&1==d.length&&this.handlers.getEntryInfoFromDOM(d)}}}),GAG.AdsController=a.extend({},new GAG.Controller,{_ADS_TAG_HTML:"",_mode:"",_modeAvailable:["","nsfw"],_postSeries:0,_googleTags:{"list-featured-sidebar-300x250":{id:"div-gpt-ad-1386120113080-0",width:300,height:250,tag:"/16921351/9gag-list-featured-sidebar-300x250"},"list-instream-300x250":{id:"div-gpt-ad-1386120113080-1",width:300,height:250,tag:"/16921351/list-instream-300x250"},"list-sidebar1-300x250-atf":{id:"div-gpt-ad-1386120113080-2",width:300,height:250,tag:"/16921351/9gag-list-sidebar1-300x250-atf"},"list-sidebar2-300x250-sticky":{id:"div-gpt-ad-1386120113080-3",width:300,height:250,tag:"/16921351/9gag-list-sidebar2-300x250-sticky"},"nsfw-list-featured-sidebar-300x250":{id:"div-gpt-ad-1386120474498-0",width:300,height:250,tag:"/16921351/9gag-nsfw-list-featured-sidebar-300x250"},"nsfw-list-instream-300x250":{id:"div-gpt-ad-1386120474498-1",width:300,height:250,tag:"/16921351/9gag-nsfw-list-instream-300x250"},"nsfw-list-sidebar1-300x250-atf":{id:"div-gpt-ad-1386120474498-2",width:300,height:250,tag:"/16921351/9gag-nsfw-list-sidebar1-300x250-atf"},"nsfw-list-sidebar2-300x250-sticky":{id:"div-gpt-ad-1386120474498-3",width:300,height:250,tag:"/16921351/9gag-nsfw-list-sidebar2-300x250-sticky"},"post-featured-sidebar-300x250":{id:"div-gpt-ad-1386120438705-0",width:300,height:250,tag:"/16921351/9gag-post-featured-sidebar-300x250"},"post-footer-728x90":{id:"div-gpt-ad-1386120438705-1",width:728,height:90,tag:"/16921351/9gag-post-footer-728x90"},"post-sidebar1-300x250-atf":{id:"div-gpt-ad-1386120438705-2",width:300,height:250,tag:"/16921351/9gag-post-sidebar1-300x250-atf"},"post-sidebar2-300x250-btf":{id:"div-gpt-ad-1386120438705-3",width:300,height:250,tag:"/16921351/9gag-post-sidebar2-300x250-btf"},"post-leaderboard-728x90-atf":{id:"div-gpt-ad-1403086688513-0",width:728,height:90,tag:"/16921351/9gag-post-leaderboard-728x90-atf"},"nsfw-post-featured-sidebar-300x250":{id:"div-gpt-ad-1386120515685-0",width:300,height:250,tag:"/16921351/9gag-nsfw-post-featured-sidebar-300x250"},"nsfw-post-footer-728x90":{id:"div-gpt-ad-1386120515685-1",width:728,height:90,tag:"/16921351/9gag-nsfw-post-footer-728x90"},"nsfw-post-sidebar1-300x250-atf":{id:"div-gpt-ad-1386120515685-2",width:300,height:250,tag:"/16921351/9gag-nsfw-post-sidebar1-300x250-atf"},"nsfw-post-sidebar2-300x250-btf":{id:"div-gpt-ad-1386120515685-3",width:300,height:250,tag:"/16921351/9gag-nsfw-post-sidebar2-300x250-btf"},"nsfw-post-leaderboard-728x90-atf":{id:"div-gpt-ad-1418869746635-0",width:728,height:90,tag:"/16921351/9gag-nsfw-post-leaderboard-728x90-atf"},"9gaghouse-post-featured-sidebar-300x250":{id:"div-gpt-ad-1410317119151-0",width:300,height:250,tag:"/16921351/9gaghouse-post-featured-sidebar-300x250"},"9gaghouse-post-footer-728x90":{id:"div-gpt-ad-1410317119151-1",width:728,height:90,tag:"/16921351/9gaghouse-post-footer-728x90"},"9gaghouse-post-leaderboard-728x90-atf":{id:"div-gpt-ad-1410317119151-2",width:728,height:90,tag:"/16921351/9gaghouse-post-leaderboard-728x90-atf"},"9gaghouse-post-sidebar1-300x250-atf":{id:"div-gpt-ad-1410317119151-3",width:300,height:250,tag:"/16921351/9gaghouse-post-sidebar1-300x250-atf"},"9gaghouse-post-sidebar2-300x250-btf":{id:"div-gpt-ad-1410317119151-4",width:300,height:250,tag:"/16921351/9gaghouse-post-sidebar2-300x250-btf"},"m-9gag-adx-top10-list-300x250":{id:"div-gpt-ad-1365732552334-0",width:300,height:250,tag:"/16921351/m.9gag-adx-top10-list-300x250"},"cosplay-list-featured-sidebar-300x250":{id:"div-gpt-ad-1401866442620-0",width:300,height:250,tag:"/16921351/9gag-cosplay-list-featured-sidebar-300x250"},"cosplay-list-sidebar1-300x250-atf":{id:"div-gpt-ad-1401866442620-1",width:300,height:250,tag:"/16921351/9gag-cosplay-list-sidebar1-300x250-atf"},"cosplay-list-sidebar2-300x250-sticky":{id:"div-gpt-ad-1401866442620-2",width:300,height:250,tag:"/16921351/9gag-cosplay-list-sidebar2-300x250-sticky"},"9gagothers-post-footer-728x90":{id:"div-gpt-ad-1421047791690-0",width:728,height:90,tag:"/16921351/9gag-728x90-others"}},init:function(){var b=a("#gag-ads-init-mode");
b.length>0&&(this._mode=b.data("mode"),b.remove()),this.checkAdTags(),this.renderAllAds()},selectors:{ADS_CONTAINER:".badge-gag-ads-container",ADS_DATA_TAG:"gag-ads"},handlers:{renderAds:function(b,c){var d=GAG.AdsController;a(b+" "+d.selectors.ADS_CONTAINER).each(function(){var b=a(this).data(d.selectors.ADS_DATA_TAG);if(!(c&&a(this).html().length>0)){if(void 0==d._googleTags[b])return void console.log("undefined ads:"+b);var e=d._googleTags[b];if(b&&b.length>0){var f=d.handlers.generateUniqueDivId(e);a(this).html('<div id="'+f+'" ></div>'),d.handlers.pushGoogleTag(e,f)}}})},generateUniqueDivId:function(b){var c=GAG.AdsController,d=b.id+"-"+Math.floor(1e5*Math.random());return a("#"+d).length?c.handlers.generateUniqueDivId(b):d},pushGoogleTag:function(a,b){GAG.AdsController;googletag.cmd.push(function(){googletag.pubads().disableInitialLoad();var c=googletag.defineSlot(a.tag,[a.width,a.height],b).addService(googletag.pubads());googletag.display(b),googletag.pubads().refresh([c])})}},getMode:function(){var a=GAG.AdsController;return a._mode},setMode:function(a){var b=GAG.AdsController;b._modeAvailable.indexOf(a)>=0&&b._mode!=a&&(b._mode=a,b.renderAllAds())},checkAdTags:function(){var a=GAG.AdsController,b=GAG.Configs.get("ads");void 0!==b&&(a._googleTags=JSON.parse(b))},renderAllAds:function(){var a=GAG.AdsController;a.handlers.renderAds("")},notifyForAdsUpdate:function(a){var b=GAG.AdsController;b.handlers.renderAds(a)},notifyForAdsInsert:function(a){var b=GAG.AdsController;b.handlers.renderAds(a,!0)}}),GAG.FacebookController=a.extend({},new GAG.Controller,function(){var c={BADGE_FACEBOOK_RENDER:".badge_facebook_render",FB_RENDER_PREFIX:"jsid-fb-render",_pushFbElementsToQueue:function(){a(c.BADGE_FACEBOOK_RENDER).each(function(b,c){var d=a(c).attr("id");d||(d=GAG.PageController.getUniqueDomId(GAG.FacebookController.FB_RENDER_PREFIX),a(c).attr("id",d)),GAG.Facebook.renderElement(d)})},_bindAddToTimelineButtons:function(){a(".badge-add-fb-timeline").on("click",function(b){b.preventDefault();var c=a(this).hasClass("switch_on");if(c)return void GAG.FacebookController.enableFbTimelineAck(!1);var d="email";try{FB.login(function(a){var b=a.authResponse?!0:!1;GAG.FacebookController.enableFbTimelineAck(b)},{scope:d})}catch(b){}})}};return{init:function(){c._pushFbElementsToQueue(),c._bindAddToTimelineButtons()},enableFbTimelineAck:function(c){var d="/member/facebook-timeline",e={on:c?"on":"off",platform:"facebook"};c||(d="/connect/unlink"),a.ajax({type:"POST",dataType:"json",url:d,data:e,success:function(){b.location.reload()}})}}}()),GAG.FeaturedController=a.extend({},new GAG.Controller,{_isLoading:!1,_isLoadingHidden:!1,_page:1,_hiddenItemData:{},_noMoreItem:!1,_currentPosition:0,_endPoint:"",_cacheKey:"featured",_cacheExpireKey:"featured_expire",_cacheFeaturedMaxItemCount:300,_pageOneExpired:!1,_cacheTtl:900,_lastInsertIsAd:!1,_dataResult:[],init:function(){this._endPoint=GAG.Configs.get("configs.endPoint"),this._endPoint=GAG.Utils.formatProtocolForUrl(this._endPoint),this.bindScrollEvents(),this.bindClickEvents(),a.proxy(this.handlers.loadMoreScrollHandler,this)()},selectors:{SIDEBAR_CONTAINER:"#sidebar-content",SIDEBAR_ITEMS:".badge-featured-item",SIDEBAR_ITEM_PREFIX:"#featured-item-",ITEM_CONTAINER:"#jsid-featured-item-container",FEATURED_AD:"#jsid-featured-sidebar-ad",DIV_GET_THE_APP:".get-the-app",LOADING_DIALOG:"#block-feature-cover .loading",SIDEBAR_FOOTER:"#sidebar .footer",POST_ENTRY_INFO:".badge-entry-info",MAIN_WRAPPER:".main-wrap",FEATURED_TAIL:"#jsid-featured-sidebar-tail",LOADING_SPINNER:".block-feature-cover .loading"},handlers:{windowScrollHandler:function(){a.proxy(this.handlers.loadMoreScrollHandler,this)()},resetSidebarToTop:function(){var b=GAG.FeaturedController,c=a(b.selectors.SIDEBAR_CONTAINER);c.removeClass("sticky"),c.css({position:"",top:""})},loadMoreScrollHandler:function(){if(a(GAG.FeaturedController.selectors.ITEM_CONTAINER).length>0){var c=GAG.FeaturedController,d=a(b).height()-GAG.PageController._topStickyElementHeight,e=GAG.PageController.getWindowEffectiveScrollTop(),f=e+d,g=a(c.selectors.SIDEBAR_CONTAINER),h=g.offset().top+g.height(),i=h-f,j=a(c.selectors.FEATURED_TAIL),k=50,l=+j.height()-k,m=a(".badge-page").offset().top+g.height()-l-(GAG.Page.isPostPage()?0:GAG.PageController._topStickyElementHeight),n=a(".badge-page").offset().top+a(".badge-page").height()+(d-l),o=a(c.selectors.MAIN_WRAPPER).height(),p=o>g.height()&&d<g.height()&&GAG.FeaturedController._noMoreItem&&!g.hasClass("sticky");e>=m&&n>=f&&p?(g.css({position:"fixed",top:-m+(GAG.Page.isPostPage()?46:49)+a(".badge-page").offset().top+"px",width:"inherit"}),g.addClass("sticky")):m>e&&g.hasClass("sticky")?(c.handlers.resetSidebarToTop(),GAG.CacheController.notifyForCacheUpdate(GAG.CacheController.keys.FEATURED_LIST)):f>n&&g.hasClass("sticky")&&(g.css({position:"absolute",top:a(".badge-page").offset().top+a(".badge-page").height()-g.height()-90+"px",width:"inherit"}),g.removeClass("sticky")),3*d>i&&GAG.FeaturedController.loadMorePosts()}},loadMoreAjaxCallbackHandler:function(b){if(b&&b.okay){var c=GAG.FeaturedController,d=c.getClickedItemIds();if(!b.result||0==b.result.length){if(!b.areHiddenItems&&!c._isLoadingHidden){var e=[];for(s=0;s<d.length;s++)c._hiddenItemData[d[s]]&&e.push(c._hiddenItemData[d[s]]);var f={okay:!0,result:e,areHiddenItems:!0};c._isLoadingHidden=!0,c.handlers.loadMoreAjaxCallbackHandler(f)}c._noMoreItem=!0}var g=a(c.selectors.ITEM_CONTAINER),h=g.data("load-more-trigger"),i=g.data("item-displayed"),j=i/h,k=g.data("ads-position")+"",l=new Array;l=k.split(",");var m=new Array;l.forEach(function(a){for(s=0;j>s;s++)m.push(parseInt(a)+parseInt(h)*s+"")});for(var n=g.data("ads-tag"),o=g.data("list-key"),p='<section class="badge-block-ad block-ad">                <div class="badge-gag-ads-container img-container" data-gag-ads="'+n+'"></div>            </section>',q=0,r="",s=0;s<b.result.length;s++){var t=b.result[s];a.inArray(c._currentPosition+"",m)>=0&&(c._lastInsertIsAd||(r+=p,q++,c._lastInsertIsAd=!0));var u='<li class="badge-featured-item" data-item-id="'+t.itemId+'" id="featured-item-'+t.itemId+'">                    <div class="img-container" data-item-id="'+t.itemId+'">                        <a href="'+t.url+'?ref=fsidebar" class="badge-evt" target="_blank" data-evt="Featured-Sidebar,'+o+"ImageClicked,"+t.url+'">                        <img src="'+t.imageURL+'" /></a>                    </div>                    <div class="info-container" data-item-id="'+t.itemId+'">                        <h3><a href="'+t.url+'?ref=fsidebar" class="badge-evt" target="_blank" data-evt="Featured-Sidebar,'+o+"TitleClicked,"+t.url+'">'+t.title+"</a></h3>                    </div>                </li>";0==a("#featured-item-"+t.itemId).length&&(GAG.Page.isPostPage()&&t.url.indexOf(GAG.PostController._fastCurrentEntryKey)>-1?c.appendClickedItemId(parseInt(t.itemId)):b.areHiddenItems||-1==a.inArray(parseInt(t.itemId),d)?(r+=u,c._currentPosition++,c._lastInsertIsAd=!1):c._hiddenItemData[t.itemId]=t)}r.length>0&&g.append(r),q>0&&g.ready(function(){GAG.AdsController.notifyForAdsInsert(c.selectors.SIDEBAR_CONTAINER)}),GAG.CacheController.notifyForCacheUpdate(GAG.CacheController.keys.FEATURED_LIST),c._page++,c._isLoading=!1,a.proxy(c.handlers.loadMoreScrollHandler(),c)}}},loadMorePosts:function(){var b=GAG.FeaturedController;if(!b._isLoading&&!b._noMoreItem){b._isLoading=!0;var c=a(b.selectors.ITEM_CONTAINER),d=+c.data("load-more-trigger");if(b._page>1&&b._dataResult.length>0){var e=b._dataResult.slice((b._page-1)*d,b._page*d);return void a.proxy(b.handlers.loadMoreAjaxCallbackHandler.call(b,{okay:!0,result:e}),b)}var f=c.data("list-key"),g=b._endPoint+"/read/ajax-featured?pageType="+f;if(!GAG.CacheFactory.sessionStorageImpl||!GAG.CacheFactory.sessionStorageImpl.getItem(g)||b._pageOneExpired||1==b._page&&b.isCacheExpired(f))a(b.selectors.LOADING_SPINNER).removeClass("hide"),a.ajax({type:"GET",crossDomain:!0,dataType:"jsonp",jsonpCallback:"data",cache:"true",url:b._endPoint+"/read/ajax-featured?pageType="+f,success:function(c){a(b.selectors.LOADING_SPINNER).addClass("hide"),GAG.CacheFactory.sessionStorageImpl&&(1==b._page&&(b.checkAndUpdateCacheExpireTime(f),b._pageOneExpired=!0),GAG.CacheFactory.sessionStorageImpl.setItem(g,JSON.stringify(c))),c&&c.okay&&c.result&&c.result.length>0&&(b._dataResult=c.result,c.result=c.result.slice((b._page-1)*d,b._page*d)),a.proxy(b.handlers.loadMoreAjaxCallbackHandler.call(b,c),b)},error:function(){b._noMoreItem=!0,b._isLoading=!1,a(b.selectors.LOADING_SPINNER).addClass("hide")}});else{var h=JSON.parse(GAG.CacheFactory.sessionStorageImpl.getItem(g));b._dataResult=h.result,h.result=h.result.slice((b._page-1)*d,b._page*d),a.proxy(b.handlers.loadMoreAjaxCallbackHandler.call(b,h),b)}}},getCacheExpireTimes:function(){var a={};return GAG.CacheFactory.sessionStorageImpl.getItem(GAG.FeaturedController._cacheExpireKey)&&(a=JSON.parse(GAG.CacheFactory.sessionStorageImpl.getItem(GAG.FeaturedController._cacheExpireKey))),a?a:{}},setCacheExpireTime:function(a,b){var c=GAG.FeaturedController,d=c.getCacheExpireTimes();d[a]=b,GAG.CacheFactory.sessionStorageImpl.setItem(GAG.FeaturedController._cacheExpireKey,JSON.stringify(d))},checkAndUpdateCacheExpireTime:function(b){var c=GAG.FeaturedController;c.isCacheExpired(b)&&c.setCacheExpireTime(b,a.now()+1e3*c._cacheTtl)},isCacheExpired:function(b){var c=GAG.FeaturedController,d=c.getCacheExpireTimes(),e=!0;return d[b]>a.now()&&(e=!1),e},appendClickedItemId:function(b){var c=GAG.FeaturedController.getClickedItemIds();if(c){var d=a.inArray(b,c);-1==d?c.push(b):(c.splice(d,1),c.push(b)),c.length>GAG.FeaturedController._cacheFeaturedMaxItemCount&&(c=c.slice(c.length-GAG.FeaturedController._cacheFeaturedMaxItemCount))}else{var c=[];c.push(b)}GAG.CacheFactory.storageImpl.setItem(GAG.FeaturedController._cacheKey,JSON.stringify(c))},getClickedItemIds:function(){var a=GAG.CacheFactory.storageImpl.getItem(GAG.FeaturedController._cacheKey),b=JSON.parse(a);return b?b:[]},bindScrollEvents:function(){a(b).on("scroll resize",null,null,a.proxy(this.handlers.windowScrollHandler,this))},bindClickEvents:function(){a("#jsid-featured-item-container").on("click",".badge-featured-item",function(){var b=a(this).data("itemId");GAG.FeaturedController.appendClickedItemId(b)})}}),GAG.GPlusController=a.extend({},new GAG.Controller,{init:function(){this._bindElements(),this._bindSocialTransfer()},_bindProfile:function(c){if(GAG.GPlus.btnClicked&&c.access_token){var d=c.code,e={platform:"google-plus"};d&&(e.code=d),a.ajax({url:"/connect/social",type:"POST",dataType:"json",data:e,success:function(){b.location.reload()},error:function(a){console.log(a)}})}},_bindSocialTransfer:function(){var c=a("#social-transfer form");0!=c.length&&GAG.GPlus.renderButton("jsid-confirm-transfer",function(d){GAG.GPlus.btnClicked&&(d.access_token?(a("input[name=code]",c).val(d.code),c.submit()):b.location.reload())})},_doLogin:function(a){if(GAG.GPlus.btnClicked&&a.access_token){var c=a.code,d="https://"+GAG.Page.getDomain()+"/connect/google-plus-callback?code="+encodeURIComponent(c);b.location.href=d}},_bindElements:function(){GAG.GPlus.renderButton("jsid-gplus-btn-settings",this._bindProfile),a(".badge-gplus-connect").each(function(b,c){var d=a(c),e=d.attr("id");e||(e=GAG.PageController.getUniqueDomId("gplus"),d.attr("id",e)),GAG.GPlus.renderButton(e,GAG.GPlusController._doLogin)})}}),GAG.ShareController=a.extend({},new GAG.Controller,function(){var c={selectors:{CLICK_EVENT_SELECTOR_DELEGATE:"#container"},_openFacebookShareDialog:function(b){b.preventDefault();var d=a(this),e=d.attr("data-share"),f="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(e);c._openWindow(f)},_openTwitterShareDialog:function(b){b.preventDefault();var d=a(this),e=d.attr("data-share"),f=d.attr("data-title"),g="https://twitter.com/intent/tweet?via=9GAG&source=tweetbutton&original_referer="+encodeURIComponent(e)+"&text="+f+"&url="+encodeURIComponent(e);c._openWindow(g)},_openGPlusShareDialog:function(b){b.preventDefault();var d=a(this),e=d.attr("data-share"),f=(d.attr("data-title"),"https://plus.google.com/share?url="+encodeURIComponent(e));c._openWindow(f)},_openPinterestShareDialog:function(b){b.preventDefault();var d=a(this),e=d.attr("data-share"),f=d.attr("data-img"),g=d.attr("data-title"),h="//pinterest.com/pin/create/button/?url="+encodeURIComponent(e)+"&media="+encodeURIComponent(f)+"&description="+g;c._openWindow(h)},_openWindow:function(a){{var c=640,d=460,e=b.screen.height/2-d/2,f=b.screen.width/2-c/2;b.open(a,"Share","status=1,height="+d+",width="+c+",top="+e+",left="+f+",resizable=0")}},_bindElements:function(){a(c.selectors.CLICK_EVENT_SELECTOR_DELEGATE).on("click",".badge-facebook-share",c._openFacebookShareDialog),a(c.selectors.CLICK_EVENT_SELECTOR_DELEGATE).on("click",".badge-twitter-share",c._openTwitterShareDialog),a(c.selectors.CLICK_EVENT_SELECTOR_DELEGATE).on("click",".badge-gplus-share",c._openGPlusShareDialog),a(c.selectors.CLICK_EVENT_SELECTOR_DELEGATE).on("click",".badge-pinterest-share",c._openPinterestShareDialog)}};return{init:function(){c._bindElements()}}}()),GAG.HeadbarController=a.extend({},new GAG.Controller,function(){var b={_bindElements:function(){b._bindSearchIcon()},_bindSearchIcon:function(){var c=a("#jsid-search-icon");c.on("click",function(a){a.preventDefault(),b._toggleSearchBar()})},SLIDE_DURATION:300,_toggleSearchBar:function(){var c=a("#header_searchbar");c.slideToggle(b.SLIDE_DURATION)}};return{init:function(){b._bindElements();var c=a(".nav-wrap"),d=c.find("h1"),e=c.find(".headbar-items"),f=e.find("#jsid-header-funny-menu").parent(),g=a("#jsid-header-funny-menu-items"),h=d.width()+e.width()-f.width();g.css("margin-left",h+"px"),g.css("left","0")}}}()),GAG.ListController=a.extend({},new GAG.Controller,{_scrollDuration:100,_focusMinimumInViewPortion:150,_entryReadTimeout:800,_playGifTimeout:50,_scrollFaultTolerance:20,_lastScrolledTop:-500,_scrollAutoPlayGifTimeoutObject:!1,_scrollAutoPlayGifRatio:.6,selectors:{LIST_VIEW:".badge-list-view-element",ENTRY_CONTAINER:".badge-entry-container",IN_VIEW_ELEMENTS:".badge-in-view",IN_FOCUS_ELEMENTS:".badge-in-view-focus",IN_VIEW_CLASS:"badge-in-view",IN_FOCUS_CLASS:"badge-in-view-focus",ENTRY_CONTAINER_ID_PREFIX:"#jsid-entry-entity-"},customEvents:{IN_FOCUS_SET:"inViewFocusSet",IN_FOCUS_UNSET:"inViewFocusUnset",ENTRY_READ:"entryRead"},init:function(){this.bindElements(),a.proxy(this.handlers.listViewScrollHandler,this)()},bindElements:function(){this.bindInViewTrackerEvents(),this._bindViewHistoryTrackingEvents()},handlers:{recalculateInViewEntries:function(){var c=GAG.ListController,d=GAG.PageController.getWindowEffectiveScrollTop(),e=d+a(b).height();c._lastScrolledTop=d;var f=GAG.CacheController,g=f.getEntryHandler(),h=g.getEntryList();(!h||0==h.length||f.isUpdateNeeded(f.keys.ENTRY_LIST))&&(f.parseEntryInfo(),h=g.getEntryList());for(var i=[],j=[],k=0;k<h.length;k++){var l=h[k],m=g.getEntryInfoForKey(l,"offset").top-GAG.PageController._topStickyElementHeight,n=g.getEntryInfoForKey(l,"outerHeight");e>m&&m+n>d&&(i.push(l),m+n>=d+c._focusMinimumInViewPortion&&m+c._focusMinimumInViewPortion<=e&&j.push(l))}c._updateEntriesInView(i),c._updateEntriesInViewFocus(j),!GAG.Page.isPostPage()&&GAG.PageController.getScrollAutoPlayMp4State()>0&&c.scrollAutoPlayGifHandler(j)},listViewScrollHandler:function(){var a=this,b=GAG.PageController.getWindowEffectiveScrollTop();Math.abs(b-a._lastScrolledTop)>200&&a.handlers.recalculateInViewEntries()}},bindInViewTrackerEvents:function(){a(b).on("scroll resize",null,null,a.proxy(this.handlers.listViewScrollHandler,this)),a("body").on(this.customEvents.IN_FOCUS_SET,this.selectors.ENTRY_CONTAINER,null,a.proxy(function(b){var c=a(b.target),d=setTimeout(a.proxy(function(){a(c).trigger(a.Event(this.customEvents.ENTRY_READ))},this),this._entryReadTimeout);a(c).data("entry-read-timeout-object",d)},this)),a("body").on(this.customEvents.IN_FOCUS_UNSET,this.selectors.ENTRY_CONTAINER,null,a.proxy(function(b){var c=a(b.target);clearTimeout(a(c).data("entry-read-timeout-object"))},this))},scrollAutoPlayGifHandler:function(b){this._scrollAutoPlayGifTimeoutObject&&clearTimeout(this._scrollAutoPlayGifTimeoutObject);var c=setTimeout(a.proxy(function(){this.autoPlayFocusedVideos(b)},this),this._playGifTimeout);this._scrollAutoPlayGifTimeoutObject=c},autoPlayFocusedVideos:function(c){for(var d=[],e=GAG.CacheController,f=e.getEntryHandler(),g=GAG.PageController.getWindowEffectiveScrollTop(),h=a(b).scrollTop()+a(b).height(),i=GAG.PageController.getScrollAutoPlayMp4State(),j=-1,k=0;k<c.length;k++){var l=c[k],m=f.getEntryInfoForKey(l,"offset").top,n=m+f.getEntryInfoForKey(l,"outerHeight"),o=0;g>m&&n>h?o=h-g:m>g&&h>n?o=n-m:g>m&&n>g?o=n-g:h>m&&m>g&&(o=h-m);var p=o/(n-m);1==i?p>j&&(j=p,d=[l]):2==i&&this._scrollAutoPlayGifRatio<p&&d.push(l)}GAG.PostController.playVideosAndPauseOthersByEntryIds(d)},_updateEntriesInView:function(a){var b=GAG.ListController,c=b.selectors.IN_VIEW_CLASS;b._unsetEntriesInViewInFocus(c,a,!1),b._setEntriesInViewInFocus(c,a,!1)},_updateEntriesInViewFocus:function(a){var b=GAG.ListController,c=b.selectors.IN_FOCUS_CLASS;b._unsetEntriesInViewInFocus(c,a,!0),b._setEntriesInViewInFocus(c,a,!0)},_unsetEntriesInViewInFocus:function(b,c,d){var e=GAG.ListController;a("."+b).each(function(){var f=a(this).data("entry-id"),g=a.inArray(f,c);0>g&&(a(this).removeClass(b),d&&a(this).trigger(a.Event(e.customEvents.IN_FOCUS_UNSET)))})},_setEntriesInViewInFocus:function(b,c,d){for(var e=GAG.ListController,f=[],g=0;g<c.length;g++)f.push(e.selectors.ENTRY_CONTAINER_ID_PREFIX+c[g]);a(f.join(", ")).each(function(){a(this).addClass(b),d===!0&&a(this).trigger(a.Event(e.customEvents.IN_FOCUS_SET))})},findCurrentlyInViewEntries:function(){return a(this.selectors.IN_VIEW_ELEMENTS)},findCurrentlyInViewEntry:function(){return this.findCurrentlyInViewEntries().first()},findCurrentlyInFocusEntries:function(){return a(this.selectors.IN_FOCUS_ELEMENTS)},findCurrentlyInFocusEntry:function(){return this.findCurrentlyInFocusEntries().first()},scrollToNextEntry:function(b){"undefined"==typeof b&&(b=this.findCurrentlyInViewEntry());var c=GAG.ListController,d=a(this.selectors.ENTRY_CONTAINER),e=d.index(b),f=e+1>=d.length?e:e+1,g=a(d[f]);if(e+1>=d.length){var h=GAG.ListScrollingController;if(h._loadedCount>=h._loadCountMax){var i=a(h.selectors.LOAD_MORE_BUTTON);i&&i.length>0&&i[0].click()}}g.offset()&&a("html,body").animate({scrollTop:g.offset().top-GAG.PageController._topStickyElementHeight},this._scrollDuration,"swing",function(){c.handlers.recalculateInViewEntries()})},scrollToPrevEntry:function(c){var d=GAG.ListController;if("undefined"==typeof c&&(c=this.findCurrentlyInViewEntry()),0!=a(b).scrollTop()&&c.offset()){var e=a(c),f=!1;if(Math.abs(c.offset().top-GAG.PageController.getWindowEffectiveScrollTop())<this._scrollFaultTolerance){var g=a(this.selectors.ENTRY_CONTAINER),h=g.index(c),i=0>h-1?0:h-1;e=a(g[i]),f=0==i}e.offset()&&a("html,body").animate({scrollTop:f?0:e.offset().top-GAG.PageController._topStickyElementHeight},this._scrollDuration,"swing",function(){d.handlers.recalculateInViewEntries()})}},_readIds:{},_readIdsBuffer:[],_readIdsBufferFlushThreshold:5,_bindViewHistoryTrackingEvents:function(){a("body").on(this.customEvents.ENTRY_READ,this.selectors.ENTRY_CONTAINER,null,a.proxy(function(b){var c=a(b.target),d=a(c).data("entry-id"),e=GAG.Configs.get("page.page_pool");if(!this._readIds[d]&&(this._readIds[d]=1,this._readIdsBuffer.push(d),e&&GAG.Track.markReadInCookie(d),this._readIdsBuffer.length>=this._readIdsBufferFlushThreshold)){e&&GAG.Track.read(this._readIdsBuffer);var f={label:"",labelValue:"",platform:"d",entry:this._readIdsBuffer.join(","),view:"l"};GAG.Track.uniqueViewed(f),this._readIdsBuffer=[]}},this))}}),GAG.ListScrollingController=a.extend({},new GAG.Controller,{_isLoading:!1,_listViewElement:null,_bottomReached:!1,_loadCountMax:20,_loadItemCount:0,_loadedCount:1,_lastScrollEntryPoint:0,_lastScrollFeaturedPoint:0,_disableAutoHiding:!1,selectors:{LOAD_MORE_BUTTON:".badge-load-more-post",ENTRY_LIST_CONTAINER:".badge-entry-collection",ENTRY_CONTAINER:".badge-entry-container",ENTRY_LIST_VIEW:".badge-list-view-element",ADS_CONTAINER_FEATURED:"#jsid-featured-item-container section"},init:function(){this._listViewElement=a(this.selectors.ENTRY_LIST_VIEW),navigator.userAgent.match(/(iPhone|iPod|iPad)/i)?this._disableAutoHiding=!0:GAG.Page.isPostPage()&&(this._disableAutoHiding=!0),this.bindElements()},bindElements:function(){this.bindScrollEvents(),this.bindLastEntryInFocus()},handlers:{windowScrollHandler:function(){a.proxy(this.handlers.loadMoreScrollHandler,this)(),this._disableAutoHiding||a.proxy(this.handlers.autoHidingScrollHandler,this)()},loadMoreScrollHandler:function(){var c=a(b).height();a(b).scrollTop()+c>=a(document).height()-3*c&&this.loadMorePosts()},loadMoreLastEntryFocusHandler:function(b){var c=a(b.target);a(this.selectors.ENTRY_CONTAINER).last().is(c)&&this.loadMorePosts()},archiveContainer:function(a,b){""!=a.html()&&(GAG.PostController.postCallback("postWillArchive",a),a.css("min-height",b+"px"),a.data("stored-html",a.html()),a.empty(),a.addClass("archived"),GAG.PostController.postCallback("postDidArchive",a))},extractContainer:function(a){null!=a.data("stored-html")&&(GAG.PostController.postCallback("postWillRestore",a),a.html(a.data("stored-html")),a.data("stored-html",null),a.removeClass("archived"),GAG.PostController.postCallback("postDidRestore",a))},scanEntriesForArchive:function(){var c=GAG.ListScrollingController,d=GAG.CacheController,e=d.getEntryHandler(),f=GAG.ListController,g=e.getEntryList(),h=a(b).height(),i=3*h,j=4*h,k=GAG.PageController.getWindowEffectiveScrollTop();(!g||0==g.length||d.isUpdateNeeded(d.keys.ENTRY_LIST))&&(d.parseEntryInfo(),g=e.getEntryList(),d.notifyForCacheUpdateCompleted(d.keys.ENTRY_LIST)),a(f.selectors.ENTRY_CONTAINER+":not(.archived)").each(function(){var b=a(this),d=b.data("entry-id"),f=e.getEntryInfoForKey(d,"height"),g=e.getEntryInfoForKey(d,"offset"),h=g.top,l=g.top+f;(k-i-f>l||h>k+j+f)&&c.handlers.archiveContainer(b,f)});for(var l=0;l<g.length;l++){var m=g[l],n=e.getEntryInfoForKey(m,"height"),o=e.getEntryInfoForKey(m,"offset"),p=o.top,q=o.top+n;if(q>=k-i-n&&k+j+n>=p){var r=a(f.selectors.ENTRY_CONTAINER_ID_PREFIX+m);c.handlers.extractContainer(r)}}},scanFeaturedItemForArchive:function(){var c=GAG.ListScrollingController,d=GAG.CacheController,e=d.getFeaturedItemHandler(),f=GAG.FeaturedController,g=a(b).height(),h=2*g,i=3*g,j=GAG.PageController.getWindowEffectiveScrollTop(),k=e.getFeaturedList();if(!k||0==k.length||d.isUpdateNeeded(d.keys.FEATURED_LIST)){var l=[];a(f.selectors.SIDEBAR_ITEMS).each(function(){var b=a(this).data("item-id"),c=d.handlers.getFeaturedItemInfoFromDOM(a(this));e.setFeaturedItemInfo(b,c),l.push(b)}),e.setFeaturedList(l),k=l,d.notifyForCacheUpdateCompleted(d.keys.FEATURED_LIST)}a(f.selectors.SIDEBAR_ITEMS+":not(.archived)").each(function(){var b=a(this),f=b.data("item-id"),g=e.getFeaturedItemInfo(f);g||(g=d.handlers.getFeaturedItemInfoFromDOM(b),e.setFeaturedItemInfo(f,g));var k=g.top,l=k+g.height;(l<j-h-g.height||k>j+i+g.height)&&c.handlers.archiveContainer(b,g.height)});for(var m=0;m<k.length;m++){var n=k[m],o=e.getFeaturedItemInfo(n);o||(o=d.handlers.getFeaturedItemInfoFromDOM(r),e.setFeaturedItemInfo(n,o));var p=o.top,q=p+o.height;if(q>=j-h-o.height&&p<=j+i+o.height){var r=a(f.selectors.SIDEBAR_ITEM_PREFIX+n);c.handlers.extractContainer(r)}}},autoHidingScrollHandler:function(){var a=this,b=GAG.PageController.getWindowEffectiveScrollTop(),c=Math.abs(b-this._lastScrollEntryPoint),d=Math.abs(b-this._lastScrollFeaturedPoint);c>1e3&&(a._lastScrollEntryPoint=b,a.handlers.scanEntriesForArchive()),d>1e3&&(a._lastScrollFeaturedPoint=b,a.handlers.scanFeaturedItemForArchive())},loadMoreAjaxHandler:function(b){if(b.okay){for(var c=a("#jsid-gat-interval").data("post-interval")+"",d=c.split(","),e="",f=!1,g=0;g<b.ids.length;g++){var h=b.ids[g];0==a("#jsid-entry-entity-"+h).length&&(d.indexOf(g+"")>-1&&(e+='<div class="banner-block stream-naughty">                                    <div class="naughty-background">                                        <div class="badge-gag-ads-container naughty-container" data-gag-ads="list-instream-300x250"></div>                                    </div>                                </div>',f=!0),e+=b.items[h],this._loadItemCount++)}var i=this.findLastEntryElement();a(i).append(e),GAG.PageController.loadAnimatedGif();var j=GAG.CacheController;j.notifyForCacheUpdate(j.keys.ENTRY_LIST),GAG.CacheableVoteController.process(),GAG.CacheableVoteController.remoteHandler.processQueue(),f&&GAG.AdsController.notifyForAdsInsert(this.selectors.ENTRY_LIST_CONTAINER),GAG.GA.track("load-more",GAG.Configs.get("page.page_list"),"load-"+this._loadedCount),this._loadedCount++,a(this.selectors.LOAD_MORE_BUTTON).data("load-count-max")&&(this._loadCountMax=a(this.selectors.LOAD_MORE_BUTTON).data("load-count-max")),this._loadedCount==this._loadCountMax&&GAG.GA.track("load-more",GAG.Configs.get("page.page_list"),"i-want-more-fun");var k=a(this.selectors.LOAD_MORE_BUTTON);this._loadedCount<this._loadCountMax?""!=b.loadMoreUrl?(k.prop("href",b.loadMoreUrl),k.text(k.data("original-text")),k.data("original-text",""),k.removeClass("spin")):(k.removeAttr("href"),k.text("No more posts"),k.removeClass("spin").addClass("end"),this._bottomReached=!0):(k.text("I want more fun"),k.prop("href",b.loadMoreUrl),k.removeClass("spin").addClass("blue"),this._bottomReached=!0),this._isLoading=!1}}},loadMorePosts:function(){if(!this._isLoading&&!this._bottomReached){var b=a(this.selectors.LOAD_MORE_BUTTON);b.data("original-text",b.text()),b.text(b.data("loading-text")),b.addClass("spin");var c=b.prop("href");if(this._isLoading=!0,"undefined"!=typeof c&&""!=c)if(navigator.userAgent.match(/(iPhone|iPod|iPad)/i)){var d=new XMLHttpRequest;d.open("GET",c,!0),d.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.onreadystatechange=a.proxy(function(){if(4==d.readyState&&200==d.status){var a=jQuery.parseJSON(d.responseText);console.log("loading more success"),this.handlers.loadMoreAjaxHandler.call(this,a)}else 4==d.readyState&&console.log("loading more error")},this),d.send()}else a.getJSON(c,null,a.proxy(this.handlers.loadMoreAjaxHandler,this))}},findLastEntryElement:function(){return this._listViewElement.find(this.selectors.ENTRY_LIST_CONTAINER).last()},bindScrollEvents:function(){a(b).scroll(a.proxy(this.handlers.windowScrollHandler,this))},bindLastEntryInFocus:function(){a("body").on(GAG.ListController.customEvents.IN_FOCUS_SET,this.selectors.ENTRY_CONTAINER,null,a.proxy(this.handlers.loadMoreLastEntryFocusHandler,this))}}),GAG.PostController=a.extend({},new GAG.Controller,{_entryStickyElementMarginTop:20,_entryStickyElementMarginTopProfile:20,_reportInProgress:!1,_voteUp:"up",_voteDown:"down",_fastInitLoad:!0,_domReady:!1,CLASS_STICKY:"sticked",init:function(){this._domReady=!0,this.bindElements(),this.trackPostUV()},availableCallbacks:["postWillArchive","postDidArchive","postWillRestore","postDidRestore"],selectors:{CONTAINER:"div#container",ENTRY_CONTAINER:".badge-entry-container",ENTRY_CONTAINER_RAW:"badge-entry-container",ENTRY_ENTITY:".badge-entry-entity",ENTRY_STICKY_ELEMENTS:".badge-entry-sticky",ENTRY_STICKY_ELEMENTS_SHADOW:".badge-entry-sticky-shadow",ENTRY_TITLE:".badge-item-title",ENTRY_IMG:".badge-item-img",ENTRY_LOVE_COUNT:".badge-item-love-count",ENTRY_COMMENT_COUNT:".badge-item-comment-count",ENTRY_SHARE_COUNT:".badge-item-share-count",ENTRY_SHARE:".badge-item-share",ENTRY_SHARE_MENU:".badge-item-share-menu",ENTRY_FB_SHARE:".badge-facebook-share",ENTRY_FB_BOT_SHARE:".badge-facebook-bot-share",ENTRY_TW_SHARE:".badge-twitter-share",ENTRY_TW_BOT_SHARE:".badge-twitter-bot-share",ENTRY_GPLUS_SHARE:".badge-gplus-share",ENTRY_PIN_SHARE:".badge-pinterest-share",ENTRY_EMAIL_SHARE:".badge-email-share",ENTRY_NSFW_COVER:".badge-nsfw-entry-cover",ENTRY_VIDEO_CONTAINER:".badge-video-container",ENTRY_VIDEO_COVER:".badge-video-cover",ENTRY_ANIMATED_COVER:".badge-animated-cover",ENTRY_ANIMATED_CONTAINER_ANIMATED:".badge-animated-container-animated",ENTRY_ANIMATED_VIDEO_PLAYER:"video",ENTRY_ANIMATED_CONTAINER_STATIC:".badge-animated-container-static",ENTRY_ANIMATED_SPINNER:".gif-spinner",ENTRY_ANIMATED_PLAY_BUTTON:".badge-gif-play",ENTRY_ANIMATED_PLAYING:"badge-gif-playing",ENTRY_NEXT_POST_ENTRY:".badge-next-post-entry",ENTRY_PREV_POST_ENTRY:".badge-prev-post-entry",ENTRY_POST_GRID_ENTRY:".badge-post-grid-entry",ENTRY_CONTENT:".badge-entry-content",ENTRY_INFO:".badge-entry-info",ENTRY_UPVOTE_BUTTON:".badge-item-vote-up",ENTRY_DOWNVOTE_BUTTON:".badge-item-vote-down",ENTRY_COMMENT_BUTTON:".badge-item-comment",ENTRY_VOTE_CONTAINER:".badge-item-vote-container",ENTRY_COMMENT_SYS:"#jsid-comment-sys",ENTRY_POST_ZOOM:".badge-post-zoom",ENTRY_POST_CONTAINER:".badge-post-container",COMMENT_SWITCH_9GAG:".badge-comment-switch-9gag",MODAL_POST_ZOOM_CONTAINER:"#jsid-modal-post-zoom",SEARCH_ENTRY_ENTITY:".badge-search-entry-entity",MODAL_REPORT_CONTAINER:".badge-overlay-report",MODAL_REPORT_TYPE:"input[name=radio-report]",MODAL_REPORT_SUBMIT:".badge-report-submit-btn",REPORT_LINK:".badge-item-report",MORE_SHARE_BUTTON:".badge-more-share-button",MORE_SHARE_MENU:".badge-more-share-menu",POST_DOWNLOAD_FOOTER:"badge-download-footer",POST_SOCIAL_FOOTER:"badge-social-footer",GROUP_TW_SHARE:"twitter-post-share",GROUP_GPLUS_SHARE:"gplus-post-share",ENTRY_TOOLBAR_PRE:".badge-toolbar-pre",ENTRY_TOOLBAR_STICKY:".badge-entry-toolbar-sticky",FEATURED_SIDEBAR_BOTTOM_ADS:"#jsid-featured-sidebar-ad .img-container"},bindElements:function(){this.bindVoteUpElements(),this.bindVoteDownElements(),this.bindCommentElements(),this.bindToggleShareMenu(),this.bindReportElements(),this.bindEntryCoverElements(),this.bindStickyEntryBars(),this.bindZoomElements(),this.bindSearchResultElements(),this.bindFastElements()},_fastItems:null,_fastEntryIds:[],_fastCurrentEntryKey:null,_fastLastEntryKey:null,_fastForwardDirection:!0,_fastTriggerLoadThreshold:9,_fastPostGridSize:6,_fastTimer:null,_fastReloadAdsThreshold:5,_fastReloadAdsCount:1,_fastSkipBackward:[],_fastSkipForward:[],_fastForwardByButton:!1,initLoadFastEntries:function(){var b=GAG.Configs.get("data");this._fastCurrentEntryKey=a(this.selectors.ENTRY_ENTITY).data("entry-id"),null!=b.fast_entries&&this.extractFastEntries(b.fast_entries)},getFastEntriesJson:function(b){var c="next";if(!this._fastForwardDirection)var c="prev";b=b+"?direction="+c+"&c=13",GAG.Configs.get("configs").from_section&&GAG.Configs.get("configs").section_url&&(b+="&sc="+GAG.Configs.get("configs").section_url),a.getJSON(b,null,a.proxy(this.extractFastEntries,this))},extractFastEntries:function(b){if(b.okay){null==this._fastItems?this._fastItems=b.items:a.extend(this._fastItems,b.items);var c=b.entryIds;this._fastForwardDirection||c.reverse();for(var d=0,e=0;e<c.length;e++)a.inArray(c[e],this._fastEntryIds)<0&&(this._fastForwardDirection?this._fastEntryIds.push(c[e]):this._fastEntryIds.unshift(c[e]),d++);var f=a.inArray(this._fastCurrentEntryKey,this._fastEntryIds);this.updatePrevNextButtons(f),c.length>0&&0==d&&(this._fastForwardDirection?this._fastSkipForward.push(b.entryIds[0]):this._fastSkipBackward.push(b.entryIds[0]))}},fastEntriesMapElements:function(a,c){if(null!=this._fastItems[a]){var d=this._fastItems[a];this.mapPostContent(d),this._fastReloadAdsCount>=this._fastReloadAdsThreshold?(GAG.AdsController.renderAllAds(),this._fastReloadAdsCount=1):this._fastReloadAdsCount++}else b.location.href=c},bindFastElements:function(){GAG.Page.isPostPage()&&(this.initLoadFastEntries(),a(this.selectors.CONTAINER).on("click",".badge-fast-entry",a.proxy(function(b){b.preventDefault();var c=a(b.currentTarget);if(!c.hasClass("disabled")){var d=c.data("entry-key"),e=c.attr("href"),f="";if(c.hasClass("badge-next-post-entry")?(f="NEXT_ENTRY",this._fastForwardDirection=!0):c.hasClass("badge-prev-post-entry")?(f="PREV_ENTRY",this._fastForwardDirection=!1):f="GRID_ENTRY",this._fastLastEntryKey=this._fastCurrentEntryKey,this._fastCurrentEntryKey=d,this._fastForwardByButton=!0,e){this.fastEntriesMapElements(d,e);
var g=a.inArray(this._fastCurrentEntryKey,this._fastEntryIds),h=this._fastTriggerLoadThreshold,i=this._fastEntryIds.length-this._fastTriggerLoadThreshold,j=a.makeArray(this._fastEntryIds);if(!this._fastForwardDirection&&h>=g){var k=j[1];a.inArray(k,this._fastSkipBackward)<0&&(e=this._fastItems[k].entryRelativeUrl,this.getFastEntriesJson(e))}else if(this._fastForwardDirection&&g>=i){var l=j[j.length-2];a.inArray(l,this._fastSkipForward)<0&&(e=this._fastItems[l].entryRelativeUrl,this.getFastEntriesJson(e))}GAG.GA.track("fast-entry",f,GAG.Page.getPageKey());var m={label:"",labelValue:"",platform:"d",entry:d,view:"p"};GAG.Track.uniqueViewed(m)}}},this)),GAG.Page.isPostPage()&&(b.onpopstate=a.proxy(function(){this.trackPostUV();var a=b.location.href,c=a.split("/");if(jQuery.inArray("gag",c)>=0)if(this._fastInitLoad)this._fastInitLoad=!1;else{var d=c[jQuery.inArray("gag",c)+1],e=b.location.hash&&b.location.hash.length>0;e||this.fastEntriesMapElements(d,a)}},this)))},updatePrevNextButtons:function(b){GAG.FeaturedController.handlers.resetSidebarToTop(),GAG.PostController.handlers.resetEntryStickyToolbar();var c=this._fastItems[this._fastEntryIds[b+1]];a(this.selectors.ENTRY_NEXT_POST_ENTRY).removeData("entry-key"),"undefined"!=typeof c?(a(this.selectors.ENTRY_NEXT_POST_ENTRY).removeClass("disabled"),a(this.selectors.ENTRY_NEXT_POST_ENTRY).data("entry-key",c.entryId),a(this.selectors.ENTRY_NEXT_POST_ENTRY).attr("href",c.entryRelativeUrl)):(a(this.selectors.ENTRY_NEXT_POST_ENTRY).addClass("disabled"),a(this.selectors.ENTRY_NEXT_POST_ENTRY).attr("href",""));var d=this._fastItems[this._fastEntryIds[b-1]];a(this.selectors.ENTRY_PREV_POST_ENTRY).removeData("entry-key"),"undefined"!=typeof d?(a(this.selectors.ENTRY_PREV_POST_ENTRY).removeClass("disabled"),a(this.selectors.ENTRY_PREV_POST_ENTRY).data("entry-key",d.entryId),a(this.selectors.ENTRY_PREV_POST_ENTRY).attr("href",d.entryRelativeUrl)):(a(this.selectors.ENTRY_PREV_POST_ENTRY).addClass("disabled"),a(this.selectors.ENTRY_PREV_POST_ENTRY).attr("href",""))},mapPostContent:function(b){a("html, body").animate({scrollTop:0},0);var c=a(this.selectors.ENTRY_ENTITY),d=a.inArray(b.entryId,this._fastEntryIds);if(this._fastCurrentEntryKey=b.entryId.toString(),this._fastForwardByButton)this._fastLastEntryKey&&(this.replacePostUrl(this._fastLastEntryKey),this.updatePostUrl(this._fastCurrentEntryKey));else{for(var e=a.makeArray(this._fastEntryIds),f=0;f<e.length;f++)e[f]=e[f].toString();var g=c.data("entry-id").toString();this._fastForwardDirection=e.indexOf(g)>e.indexOf(this._fastCurrentEntryKey)?!1:!0}this._fastForwardByButton=!1,c.removeData("entry-id"),c.removeData("entry-url"),c.removeData("entry-votes"),c.removeData("entry-comments"),c.attr("id","jsid-entry-entity-"+b.entryId),c.attr("data-entry-id",b.entryId),c.data("entry-id",b.entryId),c.data("entry-url",b.entryUrl),c.data("entry-votes",b.votes),c.data("entry-comments",b.comments),a(this.selectors.ENTRY_TITLE).text(b.title),GAG.PageController.setPageTitleWithSpecialChars(b.pageTitle);var h=a(this.selectors.ENTRY_LOVE_COUNT).parent().attr("id","love-count-"+b.entryId);a(this.selectors.ENTRY_LOVE_COUNT,h).text(GAG.Utils.formatNumber(b.votes)),a(this.selectors.ENTRY_COMMENT_COUNT).text(b.comments),a(this.selectors.ENTRY_SHARE).attr("data-entry-id",b.entryId),a(this.selectors.ENTRY_SHARE_MENU).attr("id","share-menu-"+b.entryId),a(this.selectors.ENTRY_CONTENT).html(b.entryContent),1==b.currentVote?this.handlers.likeHandler(b.entryId):-1==b.currentVote?this.handlers.dislikeHandler(b.entryId):this.handlers.unlikeHandler(b.entryId),GAG.CacheableVoteController.process(),GAG.CacheableVoteController.remoteHandler.processQueue(),"link"==b.entryType?a(this.selectors.ENTRY_CONTENT).addClass("with-button"):a(this.selectors.ENTRY_CONTENT).removeClass("with-button"),a(this.selectors.ENTRY_INFO).html(b.entryInfo),this.updatePrevNextButtons(d),a("link[rel=image_src]").attr("href",b.entryUrl),a("link[rel=canonical]").attr("href",b.entryUrl),a("meta[name=title]").attr("href",b.title),a(this.selectors.ENTRY_SHARE_COUNT).text(b.totalShares),a(this.selectors.ENTRY_FB_SHARE).removeAttr("data-track").attr("data-track",b.fbTrack),a(this.selectors.ENTRY_FB_SHARE).removeAttr("data-evt").attr("data-evt",b.fbEvt),a(this.selectors.ENTRY_FB_SHARE).removeAttr("data-share").attr("data-share",b.fbShare),a(this.selectors.ENTRY_FB_BOT_SHARE).removeAttr("data-evt").attr("data-evt",b.fbBotEvt),a(this.selectors.ENTRY_TW_SHARE).removeAttr("data-track").attr("data-track",b.twTrack),a(this.selectors.ENTRY_TW_SHARE).removeAttr("data-evt").attr("data-evt",b.twEvt),a(this.selectors.ENTRY_TW_SHARE).removeAttr("data-title").attr("data-title",b.twTitle),a(this.selectors.ENTRY_TW_SHARE).removeAttr("data-share").attr("data-share",b.twShare),a(this.selectors.ENTRY_TW_BOT_SHARE).removeAttr("data-evt").attr("data-evt",b.twBotEvt),a(this.selectors.ENTRY_GPLUS_SHARE).removeAttr("data-track").attr("data-track",b.gPlusTrack),a(this.selectors.ENTRY_GPLUS_SHARE).removeAttr("data-evt").attr("data-evt",b.gPlusEvt),a(this.selectors.ENTRY_GPLUS_SHARE).removeAttr("data-share").attr("data-share",b.gPlusShare),a(this.selectors.ENTRY_PIN_SHARE).removeAttr("data-track").attr("data-track",b.pinTrack),a(this.selectors.ENTRY_PIN_SHARE).removeAttr("data-evt").attr("data-evt",b.pinEvt),a(this.selectors.ENTRY_PIN_SHARE).removeAttr("data-title").attr("data-title",b.pinTitle),a(this.selectors.ENTRY_PIN_SHARE).removeAttr("data-share").attr("data-share",b.pinShare),a(this.selectors.ENTRY_PIN_SHARE).removeAttr("data-img").attr("data-img",b.pinImg),a(this.selectors.ENTRY_EMAIL_SHARE).attr("href",b.emailHref),a(this.selectors.ENTRY_EMAIL_SHARE).removeAttr("data-track").attr("data-track",b.emailTrack),a(this.selectors.ENTRY_EMAIL_SHARE).removeAttr("data-evt").attr("data-evt",b.emailEvt),this.renderCommentElement(b.entryUrl,this._currentCommentType,b.commentOpClientId,b.commentOpSignature);var i=b.isNsfw,j=i>0?"nsfw":"";GAG.AdsController.getMode()!=j&&(GAG.AdsController.setMode(j),this._fastReloadAdsCount=1),"undefined"!=b.entryAdminMeta&&a("#jsid-admin-meta").html(b.entryAdminMeta),GAG.PageController.loadAnimatedGif()},renderPendingComment:function(){b.csAsyncInited&&this._domReady&&b.pendingComment&&this.renderCommentElement(b.pendingComment.url,b.pendingComment.commentType)},renderCommentElement:function(c,d,e,f){(this._currentEntryUrl!=c||this._currentCommentType!=d)&&(d||(d=GAG.Configs.get("page.default_comment_type")),this._currentEntryUrl=c,this._currentCommentType=d,"9gag"==d&&(a(this.selectors.COMMENT_SWITCH_9GAG).addClass("selected").css({cursor:"default"}),a(".badge-comment").removeAttr("data-href").attr("data-href",c),b.CS2.setLoginUrl&&b.CS2.setLoginUrl("https://"+GAG.Configs.get("page.domain")+"/login?next="+encodeURIComponent(c)+"#comment"),void 0!=e&&void 0!=f&&b.CS2.setOriginalPosterParam(e,f),b.CS2.load(c),a(".badge-comment").show()),a(this.selectors.CONTAINER).one("mouseenter",this.selectors.ENTRY_COMMENT_SYS,null,a.proxy(function(){GAG.GA.track("Comment","Viewed","CommentDiv")},this)))},handlers:{likeHandler:function(a){GAG.PostController.handlers.loveHandler(a,1)},dislikeHandler:function(a){GAG.PostController.handlers.loveHandler(a,-1)},unlikeHandler:function(a){GAG.PostController.handlers.loveHandler(a,0)},loveHandler:function(b,c){var d=a("#jsid-entry-entity-"+b),e=d.find(GAG.PostController.selectors.ENTRY_VOTE_CONTAINER),f=d.find(GAG.PostController.selectors.ENTRY_DOWNVOTE_BUTTON),g=d.find(GAG.PostController.selectors.ENTRY_UPVOTE_BUTTON);e.removeClass(GAG.PostController._voteDown),e.removeClass(GAG.PostController._voteUp),f.removeClass("active"),g.removeClass("active"),c>0?(e.addClass(GAG.PostController._voteUp),g.addClass("active")):0>c&&(e.addClass(GAG.PostController._voteDown),f.addClass("active")),GAG.PostController.updateFastItem(b,"currentVote",c)},reportHandler:function(b){return GAG.User.isLoggedIn()?(a(this.selectors.MODAL_REPORT_CONTAINER).data("entry-id",a(b.currentTarget).closest(this.selectors.ENTRY_ENTITY).data("entry-id")),void GAG.OverlayController.showOverlay(GAG.OverlayController.selectors.OVERLAY_COMPONENT_REPORT)):(b.preventDefault(),void GAG.AccountController.presentSignupForm())},reportSubmitHandler:function(b){if(!this._reportInProgress){this._reportInProgress=!0;var c=a(b.currentTarget),d=a(this.selectors.MODAL_REPORT_CONTAINER),e=d.data("entry-id"),f=a(this.selectors.MODAL_REPORT_TYPE+":checked",d),g=f.val(),h=a("#jsid-repost-link").val();c.data("text-normal",c.val()),c.val(c.data("text-loading")),GAG.Entry.report(e,g,h,a.proxy(function(){c.val(c.data("text-normal")),GAG.OverlayController.hideOverlay(GAG.OverlayController.selectors.OVERLAY_COMPONENT_REPORT),f.prop("checked",!1),this._reportInProgress=!1},this),a.proxy(function(){c.val(c.data("text-normal")),alert("Something went wrong, please try again"),this._reportInProgress=!1},this))}},resetEntryStickyToolbar:function(){var b=GAG.PostController,c=a(b.selectors.ENTRY_TOOLBAR_STICKY);c&&c.length>0&&(c.css({position:"","z-index":"",top:""}),c.removeClass("sticked"))},entryStickyToolbarHandler:function(){var c=GAG.PostController,d=a(b).scrollTop(),e=(a(b).height(),a(c.selectors.ENTRY_CONTAINER)),f=e.find(c.selectors.ENTRY_TOOLBAR_PRE),g=e.find(c.selectors.ENTRY_TOOLBAR_STICKY);if(g&&g.length>0){var h=f.offset().top,i=g.height(),j=(g.height(),10),k=a(c.selectors.ENTRY_POST_CONTAINER),l=k.offset().top+k.height()-i-2*j;h>d&&g.hasClass("sticked")?c.handlers.resetEntryStickyToolbar():d>=h&&l>=d&&!g.hasClass("sticked")&&(g.css({position:"fixed","z-index":"3",top:"0"}),g.addClass("sticked"))}},entryStickElementHandler:function(){var c=GAG.PostController,d=GAG.CacheController,e=GAG.ListController,f=a(b).scrollTop(),g=a(b).height(),h=d.getEntryHandler(),i=h.getEntryList();(!i||0==i.length||d.isUpdateNeeded(d.keys.ENTRY_LIST))&&(d.parseEntryInfo(),i=h.getEntryList(),d.notifyForCacheUpdateCompleted(d.keys.ENTRY_LIST));for(var j=[],k=0;k<i.length;k++){var l=i[k],m=h.getEntryInfoForKey(l,"height"),n=h.getEntryInfoForKey(l,"offset"),o=n.top,p=n.top+m;if(p>=f-g-m&&f+g+m>=o){var q=a(e.selectors.ENTRY_CONTAINER_ID_PREFIX+l),r=q.find(c.selectors.ENTRY_STICKY_ELEMENTS_SHADOW),s=q.find(c.selectors.ENTRY_STICKY_ELEMENTS);if(r&&r.length>0&&s&&s.length>0){var t=r.offset().top,u=s.height()||s.outerHeight();if(t-c._entryStickyElementMarginTop>=GAG.PageController.getWindowEffectiveScrollTop())s.css({position:"relative","z-index":1,top:""}),s.removeClass(c.CLASS_STICKY);else if(t-c._entryStickyElementMarginTop<GAG.PageController.getWindowEffectiveScrollTop()&&o+m+parseFloat(q.css("paddingTop"))-u-c._entryStickyElementMarginTop>GAG.PageController.getWindowEffectiveScrollTop()){var v=GAG.PageController._topStickyElementHeight+c._entryStickyElementMarginTop+"px";s.css({position:"fixed","z-index":2,top:v}),s.addClass(c.CLASS_STICKY),j.push(l)}else{var v=m+parseFloat(q.css("paddingTop"))-(t-o)-u+"px";s.css({position:"relative","z-index":2,top:v}),s.removeClass(c.CLASS_STICKY)}}}}var w=!1,x="entrySticked",y=d.getValue(x);if(y&&y.length>0)for(var k=0;k<y.length;k++)if(a.inArray(y[k],j)<0){var l=y[k],q=a(e.selectors.ENTRY_CONTAINER_ID_PREFIX+l),s=q.find(c.selectors.ENTRY_STICKY_ELEMENTS);s.hasClass(c.CLASS_STICKY)&&(s.css({position:"","z-index":"",top:""}),s.removeClass(c.CLASS_STICKY),needUpdate=!0)}d.setValue(x,j),w&&c.handlers.entryStickElementHandler()}},onVoteUp:function(b){var c=a(b.currentTarget),d=c.closest(this.selectors.ENTRY_ENTITY).data("entry-id"),e=c.closest(this.selectors.ENTRY_ENTITY).data("entry-url"),f=c.closest(this.selectors.ENTRY_VOTE_CONTAINER);if(GAG.PageController.ensureLoggedIn(e)){var g=f.hasClass(this._voteUp)||c.hasClass("up active"),h=f.hasClass(this._voteDown)||c.hasClass("down active");h&&this.addLoveCount(d);var i={};g?(GAG.Vote.unlike(d,function(){},function(){}),this.minusLoveCount(d),this.handlers.unlikeHandler(d),i[d]=0,GAG.GA.track("EntryAction","UndoUpvote",this._getPageTrackKey())):(GAG.Vote.like(d,function(){},function(){}),this.addLoveCount(d),this.handlers.likeHandler(d),i[d]=1,GAG.GA.track("EntryAction","Upvote",this._getPageTrackKey())),GAG.CacheableVote.addToCache(i)}},_getPageTrackKey:function(){var a="ListPage";return GAG.Page.isPostPage()?a="PostPage":GAG.Page.isProfilePage()&&(a="ProfilePage"),a},onVoteDown:function(b){var c=a(b.currentTarget),d=c.closest(this.selectors.ENTRY_ENTITY).data("entry-id"),e=c.closest(this.selectors.ENTRY_ENTITY).data("entry-url"),f=c.closest(this.selectors.ENTRY_VOTE_CONTAINER);if(GAG.PageController.ensureLoggedIn(e)){var g=f.hasClass(this._voteDown);f.hasClass(this._voteUp)&&this.minusLoveCount(d);var h={};g?(GAG.Vote.unlike(d,function(){},function(){}),this.addLoveCount(d),this.handlers.unlikeHandler(d),h[d]=0,GAG.GA.track("EntryAction","UndoDownvote",this._getPageTrackKey())):(GAG.Vote.dislike(d,function(){},function(){}),this.minusLoveCount(d),this.handlers.dislikeHandler(d),h[d]=-1,GAG.GA.track("EntryAction","Downvote",this._getPageTrackKey())),GAG.CacheableVote.addToCache(h)}},addLoveCount:function(b){var c=this.getLoveCounter(b),d=a("#jsid-entry-entity-"+b),e=parseInt(d.data("entry-votes"));isNaN(e)||(e++,a(this.selectors.ENTRY_LOVE_COUNT,c).text(GAG.Utils.formatNumber(e)),d.data("entry-votes",e),GAG.PostController.updateFastItem(b,"votes",e))},minusLoveCount:function(b){var c=this.getLoveCounter(b),d=a("#jsid-entry-entity-"+b),e=parseInt(d.data("entry-votes"));isNaN(e)||(e--,a(this.selectors.ENTRY_LOVE_COUNT,c).text(GAG.Utils.formatNumber(e)),d.data("entry-votes",e),GAG.PostController.updateFastItem(b,"votes",e))},updateFastItem:function(a,b,c){null!=GAG.PostController._fastItems&&"undefined"!=GAG.PostController._fastItems[a]&&(GAG.PostController._fastItems[a][b]=c)},getLoveCounter:function(b){return a("#love-count-"+b)},trackPostUV:function(){if(GAG.Page.isPostPage()){var b=a(this.selectors.ENTRY_ENTITY).data("entry-id"),c={label:"",labelValue:"",platform:"d",entry:b,view:"p"};GAG.Track.uniqueViewed(c)}},bindStickyEntryBars:function(){GAG.Page.isPostPage()?a(b).on("scroll resize",null,null,a.proxy(this.handlers.entryStickyToolbarHandler,this)):(GAG.Page.isProfilePage()&&(this._entryStickyElementMarginTop=this._entryStickyElementMarginTopProfile),a(b).on("scroll resize",null,null,a.proxy(this.handlers.entryStickElementHandler,this)))},bindVoteUpElements:function(){a(this.selectors.CONTAINER).on("click",this.selectors.ENTRY_UPVOTE_BUTTON,a.proxy(this.onVoteUp,this))},bindVoteDownElements:function(){a(this.selectors.CONTAINER).on("click",this.selectors.ENTRY_DOWNVOTE_BUTTON,a.proxy(this.onVoteDown,this))},_currentCommentType:"",_currentEntryUrl:"",bindCommentElements:function(){this._currentCommentType="",this._currentEntryUrl=GAG.Configs.get("page.entry_url"),this.renderPendingComment()},bindSearchResultElements:function(){a(this.selectors.CONTAINER).on("click",this.selectors.SEARCH_ENTRY_ENTITY,null,a.proxy(function(c){c.preventDefault();var d=a(c.currentTarget),e=d.data("entry-url");b.open(e,"_blank")},this)),a(this.selectors.CONTAINER).on("click",this.selectors.SEARCH_ENTRY_ENTITY+" "+this.selectors.ENTRY_NSFW_COVER,null,a.proxy(function(a){a.stopPropagation()},this))},bindEntryCoverElements:function(){a(this.selectors.CONTAINER).on("click",this.selectors.ENTRY_NSFW_COVER,null,a.proxy(function(b){b.preventDefault();var c=a(b.currentTarget).parents(this.selectors.ENTRY_ENTITY).data("entry-url");c||(c=a(b.currentTarget).parents(this.selectors.SEARCH_ENTRY_ENTITY).data("entry-url")),GAG.AccountController.setSafeMode(0,c)},this)),a(this.selectors.CONTAINER).on("click",this.selectors.ENTRY_VIDEO_COVER,null,a.proxy(function(b){b.preventDefault();var c=a(b.currentTarget),d=c.closest(this.selectors.ENTRY_ENTITY),e=a(b.currentTarget).parents(this.selectors.ENTRY_VIDEO_CONTAINER),f="500",g="277";if(d.hasClass("post-page"))var f="600",g="340";var h='<iframe width="'+f+'" height="'+g+'" src="http://www.youtube.com/embed/'+e.data("video-id")+'?autoplay=1&controls=1&iv_load_policy=3" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" allowfullscreen></iframe>';e.html(h)},this)),a(this.selectors.CONTAINER).on("click",this.selectors.ENTRY_ANIMATED_COVER,null,a.proxy(function(b){b.preventDefault();var c=GAG.PostController,d=a(b.currentTarget);if(void 0!=d.data("web-post")&&"1"==d.data("web-post"))return!1;var e=d.find(c.selectors.ENTRY_ANIMATED_CONTAINER_STATIC),f=d.find(c.selectors.ENTRY_ANIMATED_CONTAINER_ANIMATED),g=d.find(c.selectors.ENTRY_ANIMATED_VIDEO_PLAYER),h=e.parent(),i=f.find("video"),j=e.find(".badge-item-img");if(0==i.length){var k='alt="'+j.attr("alt")+'"';a.browser&&a.browser.mozilla&&(k="");var l=e.find("img").attr("style"),m="width:"+h.css("width")+"; height:"+h.css("height")+";";f.append(Modernizr.video?'<video preload="none" poster="'+j[0].src+'" style="'+m+'" loop><source src="'+f.data("mp4")+'" type="video/mp4"><source src="'+f.data("webm")+'" type="video/webm"><div class="badge-item-animated-img"></div></video>':'<img src="'+f.data("image")+'" '+k+' style="'+l+'"/>'),f.removeData("image"),f.attr("data-image",""),f.removeData("mp4"),f.attr("data-mp4",""),f.removeData("webm"),f.attr("data-webm",""),c.bindImageLoadedEvent(h)}else if(e.hasClass("loading")||!e.hasClass("presenting")&&!e.hasClass("hide")||b&&"click"===b.type&&(a(g)[0].paused&&(e.hasClass("presenting")||e.hasClass("hide"))?(a(g)[0].play(),h.addClass(c.selectors.ENTRY_ANIMATED_PLAYING),e.addClass("hide"),e.removeClass("presenting")):(a(g)[0].pause(),h.removeClass(c.selectors.ENTRY_ANIMATED_PLAYING),e.removeClass("hide"),e.addClass("presenting"),j.css("visibility","hidden"))),e.hasClass("presenting"))a(GAG.PostController.selectors.ENTRY_ANIMATED_PLAY_BUTTON).removeClass("hide");else{var n=f.find("img");n.prop("src",n.prop("src"))}},this))},bindImageLoadedEvent:function(b){var c=GAG.PostController,d=b.find(c.selectors.ENTRY_ANIMATED_CONTAINER_STATIC),e=b.find(c.selectors.ENTRY_ANIMATED_CONTAINER_ANIMATED),f=b.find(".badge-item-img");e.find("img").load(function(){d.removeClass("loading"),d.addClass("hide"),d.removeClass("presenting"),e.removeClass("hide"),Modernizr.video&&(d.css("padding-left",f.css("padding-left")),f.css("padding-left",""),f.css("visibility","hidden"));var b=a(this);b.prop("src",b.prop("src")),e.find("img").unbind()}).each(function(){this.complete&&a(this).load()})},bindReportElements:function(){a(this.selectors.CONTAINER).on("click",this.selectors.REPORT_LINK,null,a.proxy(this.handlers.reportHandler,this)),a(this.selectors.MODAL_REPORT_SUBMIT).on("click",null,null,a.proxy(this.handlers.reportSubmitHandler,this))},bindToggleShareMenu:function(){a(this.selectors.CONTAINER).on("click",this.selectors.MORE_SHARE_BUTTON,a.proxy(function(b){b.stopPropagation();var c=a(b.currentTarget),d=c.closest(this.selectors.ENTRY_ENTITY),e=d.find(".badge-more-share-menu");e.hasClass("hide")?(GAG.PageController.hidePopupMenu(this.selectors.MORE_SHARE_MENU),e.removeClass("hide"),GAG.GA.track("EntryAction","ShareMenuOpened",this._getPageTrackKey())):(GAG.PageController.hidePopupMenu(),GAG.GA.track("EntryAction","ShareMenuClosed",this._getPageTrackKey()))},this))},bindShortcutKeys:function(){GAG.KeyboardController.bindAction("l",a.proxy(this.onVoteUp,this)),GAG.KeyboardController.bindAction("h",a.proxy(this.onVoteDown,this))},bindZoomElements:function(){a(this.selectors.CONTAINER).on("click",this.selectors.ENTRY_POST_ZOOM,a.proxy(function(b){b.preventDefault();var c=a(b.currentTarget),d=c.closest(this.selectors.ENTRY_ENTITY);this.showPostZoomOverlay(d)},this))},replacePostUrl:function(a){var c="http://"+document.location.hostname+"/gag/"+a;"undefined"!=typeof b.history.pushState&&b.history.pushState({},"",c)},updatePostUrl:function(a){var c="http://"+document.location.hostname+"/gag/"+a;"undefined"!=typeof b.history.replaceState&&b.history.replaceState({},"",c)},recoverOrginialUrl:function(){b.history.go(-1)},showPostZoomOverlay:function(b){var c=b.find("img").first().clone().removeAttr("class");a(this.selectors.MODAL_POST_ZOOM_CONTAINER).find(".badge-post-zoom-img").html("").append(c),GAG.OverlayController.showOverlay(this.selectors.MODAL_POST_ZOOM_CONTAINER)},hidePostZoomOverlay:function(){a(this.selectors.MODAL_POST_ZOOM_CONTAINER).addClass("hide"),a("body").removeClass("no-scroll")},scrollToComment:function(){var b=a("#comment");a("html,body").animate({scrollTop:b.offset().top},100)},pauseAllVideos:function(){for(var b=this,c=document.getElementsByTagName("video"),d="",e=0;e<c.length;e++)c[e].pause(),d.closest("."+b.selectors.ENTRY_ANIMATED_PLAYING).removeClass(b.selectors.ENTRY_ANIMATED_PLAYING),d=a(c[e]).parent().parent().find(b.selectors.ENTRY_ANIMATED_CONTAINER_STATIC),d.removeClass("hide"),d.addClass("presenting"),d.find(".badge-item-img").css("visibility","hidden")},playVideosAndPauseOthersByEntryIds:function(b){self=this;var c=[];a("."+self.selectors.ENTRY_ANIMATED_PLAYING).each(function(){var d=a(this).closest("article").data("entry-id");if(a.inArray(d,b)<0){var e=a(this).find("video");e&&e.length>0&&e[0].pause();var f=a(this).find(self.selectors.ENTRY_ANIMATED_CONTAINER_STATIC);f.removeClass("hide"),f.addClass("presenting"),f.find(".badge-item-img").css("visibility","hidden"),a(this).removeClass(self.selectors.ENTRY_ANIMATED_PLAYING)}else c.push(d)}),GAG.ListController.findCurrentlyInFocusEntries().each(function(){var d=a(this).closest("article").data("entry-id");a.inArray(d,b)>=0&&a.inArray(d,c)<0&&a(this).find(self.selectors.ENTRY_ANIMATED_COVER).click()})},upvoteEntry:function(b){a(b).find(this.selectors.ENTRY_UPVOTE_BUTTON).first().click()},downvoteEntry:function(b){a(b).find(this.selectors.ENTRY_DOWNVOTE_BUTTON).first().click()},commentEntry:function(c){a(c).first();if(GAG.Page.isPostPage())this.scrollToComment();else if(c.length>0){var d=a(c).find(this.selectors.ENTRY_COMMENT_BUTTON).first();d.click(),b.open(d.attr("href"),"_blank")}},playEntry:function(b){var c=a(b).first(),d=c.find(this.selectors.ENTRY_VIDEO_COVER),e=c.find(this.selectors.ENTRY_ANIMATED_COVER);d.length?d.click():e.length&&e.click()},prevEntry:function(){a(this.selectors.ENTRY_PREV_POST_ENTRY).click()},nextEntry:function(){a(this.selectors.ENTRY_NEXT_POST_ENTRY).click()},postCallback:function(b,c){var d=GAG.PostController;a.inArray(b,d.availableCallbacks)>=0&&d[b](c)},postWillArchive:function(a){var b=GAG.PostController;if(a.hasClass(b.selectors.ENTRY_CONTAINER_RAW)){var c=a.find(b.selectors.ENTRY_ANIMATED_CONTAINER_STATIC);if(c&&c.length>0&&c.hasClass("loading")){var d=a.find(b.selectors.ENTRY_ANIMATED_CONTAINER_ANIMATED+" img"),e=a.find(b.selectors.ENTRY_ANIMATED_CONTAINER_ANIMATED+" video");d&&d.length>0&&d.unbind(),e&&e.length>0&&e.unbind()}}},postDidArchive:function(){},postWillRestore:function(){},postDidRestore:function(a){var b=GAG.PostController;if(a.hasClass(b.selectors.ENTRY_CONTAINER_RAW)){var c=a.find(b.selectors.ENTRY_ANIMATED_CONTAINER_STATIC),d=(a.find(b.selectors.ENTRY_ANIMATED_CONTAINER_ANIMATED),a.find(b.selectors.ENTRY_ANIMATED_CONTAINER_ANIMATED+" img")),e=a.find(b.selectors.ENTRY_ANIMATED_CONTAINER_ANIMATED+" video"),f=d&&d.length>0,g=e&&e.length>0;f&&d[0].complete&&c.hasClass("loading")?(c.removeClass("loading"),c.removeClass("presenting"),c.addClass("hide")):f&&!d[0].complete&&c.hasClass("loading")&&(c.addClass("loading"),c.removeClass("presenting"),b.bindImageLoadedEvent(a)),g&&(c.removeClass("loading"),c.removeClass("hide"),c.addClass("presenting"))}}}),GAG.PageController=a.extend({},new GAG.Controller,{docTitle:"",init:function(){this.bindElements(),this.updateTimeZoneOffset(),this.updateSignUpReferrer(),this.setCustomizeElementValues(),this.checkCustomizeElementsShowStatus(),this.loadAnimatedGif(),this.syncAccountSystemSession(),this.docTitle=document.title},getUniqueDomId:function(a){for(var b;!b||document.getElementById(b);)b=(a?a:"jsid_dom")+"_"+parseInt(999999*Math.random(),10);return b},_toastFadeDuration:500,_showFooterNavAfter:600,_sidebarStickyElementMarginTop:20,_sidebarStickyHeight:0,_topVolatileElementHeight:0,_topStickyElementHeight:0,_autoCompleteMinLength:2,_autoCompleteMaxResult:10,_isNotificationShown:!1,_lastNotificationUpdateTs:!1,_isUpdatingNotification:!1,_isMarkingNotificationAsRead:!1,_notificationLoadCount:0,_isChatNotificationShown:!1,_lastChatNotificationUpdateTs:!1,_isUpdatingChatNotification:!1,_isMarkingChatNotificationAsRead:!1,_isSigningUpEmailSubscription:!1,_CLASS_STICKY:"sticked",_CLASS_SHOW_BACK_TO_TOP:"show",_themeIdCookieKey:"themeId",_signUpReferrerCookieKey:"sign_up_referer",_sidePersonalizeCookieKey:"side_personalize",_safeModeCookieKey:"safemode",selectors:{THEME_FILES:".badge-theme-file",FOOTER_NAV:"a.badge-scroll-to-top",SCROLL_TO_TOP:"a.badge-scroll-to-top",HEADER_TOP_NAV:".badge-sticky-nav",HEADER_TOP_BANNER:".badge-volatile-banner",HEADER_USER_FUNCTION_PLACEHOLDER:".badge-user-function-placeholder",HEADER_USER_FUNCTION:"#jsid-user-function",HEADER_VISITOR_FUNCTION:"#jsid-visitor-function",HEADER_USER_MENU:"#jsid-header-user-menu",HEADER_USER_ITEM:"#jsid-header-user-menu-items",HEADER_BANNER_CONFIRM_EMAIL:"#jsid-banner-confirm-email",HEADER_BANNER_CONFIRM_EMAIL_USERNAME:"#jsid-banner-confirm-email-username",HEADER_FUNNY_MENU:"#jsid-header-funny-menu",HEADER_FUNNY_ITEM:"#jsid-header-funny-menu-items",HEADER_NOTIFICATION_MENU:"#jsid-header-notification-menu",HEADER_NOTIFICATION_ITEM:"#jsid-header-notification-items",HEADER_NOTIFICATION_CONTAINER:"#jsid-header-notification-items-container",HEADER_NOTIFICATION_SEE_ALL:"#jsid-header-notification-see-all",HEADER_CHAT_NOTIFICATION_MENU:"#jsid-header-chat-notification-menu",HEADER_CHAT_NOTIFICATION_ITEM:"#jsid-header-chat-notification-items",HEADER_CHAT_NOTIFICATION_CONTAINER:"#jsid-header-chat-notification-items-container",HEADER_UPLOAD_ITEM:".badge-upload-items",HEADER_UPLOAD_MENU:"#jsid-upload-menu",HEADER_DOWNLOAD_MENU:"#jsid-header-download-menu",HEADER_DOWNLOAD_ITEM:"#jsid-header-download-menu-items",HEADER_DOWNLOAD_BTN_CONTAINER:".badge-download-function-container",HEADER_SEARCH:".badge-header-search",HEADER_SEARCH_INPUT:"#jsid-search-input",HEADER_TOAST:".badge-toast-container",HEADER_TOAST_MESSAGE:".badge-toast-message",HEADER_TOAST_CLOSE:".badge-toast-close",SUBNAV_STICKY_STATIC:".badge-sticky-subnav-static",PERSONALISE_BTN_SHOW:".badge-personalise-btn",PERSONALISE_OPTION:".badge-personalise-options",PERSONALISE_SELECTOR:"#jsid-personalise-selector",PERSONALISE_OPTION_NSFW:".badge-personalise-option-nsfw",PERSONALISE_BTN_SAVE:"#jsid-personalise-btn-save",PERSONALISE_BTN_RESET:"#jsid-personalise-btn-reset",PERSONALISE_FORM:"#jsid-personalise-form",SIDEBAR_EMAIL_SCRIPTION_ELEM:".badge-email-subscription",SIDEBAR_EMAIL_SCRIPTION_INPUT:".badge-email-subscription-input",SIDEBAR_EMAIL_SCRIPTION_BTN:".badge-email-subscription-btn",SIDEBAR_EMAIL_SCRIPTION_TOGGLE_HIDE:".badge-toggle-hide-when-done",CONTAINTER:"#container",PAGE:".badge-page",CLICK_EVENT_SELECTOR:".badge-evt, .badge-track",CLICK_EVENT_NOFOLLOW_SELECTOR:".badge-track-no-follow"},onScroll:function(){this.checkFooterNavElements()},bindElements:function(){this.calculateHeights(),this.bindStickyNav(),this.bindFooterNavElements(),this.bindCustomizeElements(),this.bindUploadElements(),this.bindUserSettingElements(),this.bindGroupElements(),this.bindDownloadElements(),this.bindSearchElements(),this.bindToastElements(),this.bindEmailSubscription(),this.bindEventTracking(),this.bindCloseAdvice(),this.bindContactElements(),this.bindEditorDashboardElements(),this.bindPopupMenu()},calculateHeights:function(){this._topStickyElementHeight=a(this.selectors.HEADER_TOP_NAV).height(),GAG.PageController._topVolatileElementHeight=0,a(this.selectors.HEADER_TOP_BANNER).each(function(){a(this).hasClass("hide")||(GAG.PageController._topVolatileElementHeight+=a(this).height())})},bindEditorDashboardElements:function(){a(".badge-period-dropdown-control .period").on("click",function(){event.preventDefault(),a(this).next(".period-dropdown").toggleClass("hide")}),a("#jsid-period-dropdown-from").datepicker({minDate:"-30D",maxDate:"+0D",changeMonth:!0,numberOfMonths:2,onClose:function(b){a("#jsid-period-dropdown-to").datepicker("option","minDate",b)}}),a("#jsid-period-dropdown-to").datepicker({minDate:"-30D",maxDate:"+0D",changeMonth:!0,numberOfMonths:2,onClose:function(b){a("#jsid-period-dropdown-from").datepicker("option","maxDate",b)}}),a("#jsid-period-dropdown-from, #jsid-period-dropdown-to, #ui-datepicker-div").click(function(a){a.stopPropagation()}),a(".badge-load-more-entry").on("click",function(b){b.preventDefault();var c=a(this);c.data("original-text",c.text()),c.text(c.data("loading-text"));var d=c.prop("href");"undefined"!=typeof d&&""!=d&&a.ajax({url:d,dataType:"json",success:function(b){for(var d="",e=0;e<b.ids.length;e++){var f=b.ids[e];d+=b.items[f]}a(".badge-posts-items").append(d),""!=b.loadMoreUrl?(c.prop("href",b.loadMoreUrl),c.text(c.data("original-text")),c.data("original-text",""),c.data("original-url",b.loadMoreUrl)):(c.removeAttr("href"),c.text("No more posts"))}})}),a(".badge-second-col").on("change",function(){"r"==a(this).val()?(a(".badge-comment-col").addClass("hide"),a(".badge-report-col").removeClass("hide")):"c"==a(this).val()&&(a(".badge-comment-col").removeClass("hide"),a(".badge-report-col").addClass("hide")),a(".badge-update-url").each(function(){var b=a(".badge-second-col").val(),c="&scol=";"r"==b?c+="r":"c"==b&&(c+="c");var d=a(this).data("original-url")+c;a(this).attr("href",d)})})},bindContactElements:function(){GAG.Page.isContactPage()&&(this.showCaptcha("contact"),a("#jsid-contact-form").on("submit",a.proxy(function(){if(!a("#jsid-interaction-name").val().length)return a("#jsid-contact-name-error").removeClass("hide"),!1;if(a("#jsid-contact-name-error").addClass("hide"),!GAG.Validator.isValidEmail(a("#jsid-interaction-email").val()))return a("#jsid-contact-email-error").removeClass("hide"),!1;if(a("#jsid-contact-email-error").addClass("hide"),0==a("#jsid-email-category").val())return a("#jsid-contact-category-error").removeClass("hide"),!1;if(a("#jsid-contact-category-error").addClass("hide"),!a("#jsid-email-subject").val().length)return a("#jsid-contact-subject-error").removeClass("hide"),!1;if(a("#jsid-contact-subject-error").addClass("hide"),!a("#jsid-email-message").val().length)return a("#jsid-contact-message-error").removeClass("hide"),!1;a("#jsid-contact-message-error").addClass("hide");var b=!0;try{if(Recaptcha){var c=Recaptcha.get_challenge(),d=Recaptcha.get_response();a("#jsid-contact-recaptcha_challenge").val(c),a("#jsid-contact-recaptcha_response").val(d)}}catch(e){}return b?!0:(event.preventDefault(),!1)},this)))},bindSearchElements:function(){var b=a(this.selectors.HEADER_SEARCH),c=a(this.selectors.HEADER_SEARCH_INPUT),d=c.attr("id");if(a("body").on("mousedown",function(a){c.length&&a.target.id!==d&&b.hasClass("selected")&&!c.val().length&&(b.removeClass("selected"),c.removeAttr("placeholder"))}),b.click(function(){return b.hasClass("selected")?void 0:(b.addClass("selected"),c.attr("placeholder",c.data("placeholder")).focus(),!1)}),c.length){var e={url:"/tags/suggest",appendTo:this.selectors.HEADER_SEARCH,menuClass:"search-suggestion small"};this.loadAutoComplete(this.selectors.HEADER_SEARCH_INPUT,e)}},loadAutoComplete:function(b,c){var d={url:"undefined"==typeof c.url?"":c.url,appendTo:"undefined"==typeof c.appendTo?"":c.appendTo,minLength:"undefined"==typeof c.minLength?this._autoCompleteMinLength:c.minLength,maxResult:"undefined"==typeof c.maxResult?this._autoCompleteMaxResult:c.maxResult,menuClass:"undefined"==typeof c.menuClass?"":c.menuClass};a(b).autocomplete({source:function(b,c){a.ajax({url:d.url,dataType:"json",data:{tag:b.term},success:function(e){var f=e.slice(0,d.maxResult),g="<strong>"+b.term+"</strong>";c(a.map(f,function(a){return{label:g+a.substr(b.term.length),value:a}})),a(".ui-helper-hidden-accessible").addClass("hide")}})},minLength:d.minLength,appendTo:d.appendTo,open:function(){var b=a(".ui-autocomplete");b.removeAttr("class").addClass(d.menuClass).removeAttr("style"),a(".ui-helper-hidden-accessible").addClass("hide")},select:function(b){var c=a(b.currentTarget);
a(GAG.PageController.selectors.HEADER_SEARCH_INPUT).val(c.find(".ui-state-focus").first().text()),c.closest("form").submit()}}).data("ui-autocomplete")._renderItem=function(b,c){return a("<li></li>").data("ui-autocomplete-item",c).append("<a>"+c.label+"</a>").appendTo(b)}},toggleMenu:function(b){return!a(b).toggleClass("hide").hasClass("hide")},showMenu:function(b){a(b).removeClass("hide")},hideMenu:function(b){a(b).addClass("hide")},loadSpinner:function(a,b){{var c={lines:"undefined"==typeof b.lines?10:b.lines,length:"undefined"==typeof b.length?8:b.length,width:"undefined"==typeof b.width?4:b.width,radius:"undefined"==typeof b.radius?10:b.radius,corners:"undefined"==typeof b.corners?1:b.corners,rotate:"undefined"==typeof b.rotate?0:b.rotate,color:"undefined"==typeof b.color?"#555":b.color,speed:"undefined"==typeof b.speed?1:b.speed,trail:"undefined"==typeof b.trail?60:b.trail,shadow:"undefined"==typeof b.shadow?!1:b.shadow,hwaccel:"undefined"==typeof b.hwaccel?!1:b.hwaccel,className:"undefined"==typeof b.className?"spinner":b.className,zIndex:"undefined"==typeof b.zIndex?2e9:b.zIndex,top:"undefined"==typeof b.top?"auto":b.top,left:"undefined"==typeof b.left?"auto":b.left},d=document.getElementById(a);new Spinner(c).spin(d)}},updateLanguage:function(a){var c=GAG.Page.getBackUrl(),d="http://"+GAG.Page.getDomain()+"/profile/setlanguage/lang/"+a+"?url="+c;b.location.href=d},bindStickyNav:function(){GAG.Page.isPostPage()||a(b).scroll(a.proxy(function(){var c=a(this.selectors.HEADER_TOP_NAV);a(this.selectors.SUBNAV_STICKY_STATIC).height(c.height()+1),a(b).scrollTop()>this._topVolatileElementHeight&&!c.hasClass(this._CLASS_STICKY)?(c.css({top:0,position:"fixed","z-index":3}),c.addClass(this._CLASS_STICKY)):a(b).scrollTop()<=this._topVolatileElementHeight&&c.hasClass(this._CLASS_STICKY)&&(c.removeClass(this._CLASS_STICKY),c.removeAttr("style"))},this))},bindUserSettingElements:function(){a(this.selectors.HEADER_USER_MENU+", "+this.selectors.HEADER_USER_ITEM).click(a.proxy(function(a){a.stopPropagation();var b=this.toggleMenu(this.selectors.HEADER_USER_ITEM);this.hidePopupMenu(b?this.selectors.HEADER_USER_ITEM:null)},this))},hidePopupMenu:function(b){var c=[this.selectors.HEADER_FUNNY_ITEM,this.selectors.HEADER_DOWNLOAD_ITEM,this.selectors.HEADER_USER_ITEM,this.selectors.HEADER_NOTIFICATION_ITEM,this.selectors.HEADER_CHAT_NOTIFICATION_ITEM,this.selectors.HEADER_UPLOAD_ITEM,GAG.PostController.selectors.MORE_SHARE_MENU],d={};d[this.selectors.HEADER_FUNNY_ITEM]=this.selectors.HEADER_FUNNY_MENU,d[this.selectors.HEADER_DOWNLOAD_ITEM]=this.selectors.HEADER_DOWNLOAD_MENU,d[this.selectors.HEADER_USER_ITEM]=this.selectors.HEADER_USER_MENU,d[this.selectors.HEADER_NOTIFICATION_ITEM]=this.selectors.HEADER_NOTIFICATION_MENU,d[this.selectors.HEADER_CHAT_NOTIFICATION_ITEM]=this.selectors.HEADER_CHAT_NOTIFICATION_MENU,d[this.selectors.HEADER_UPLOAD_ITEM]=this.selectors.HEADER_UPLOAD_MENU,d[GAG.PostController.selectors.MORE_SHARE_MENU]=GAG.PostController.selectors.MORE_SHARE_BUTTON,b!=this.selectors.HEADER_NOTIFICATION_ITEM&&(GAG.PageController._isNotificationShown=!1),b!=this.selectors.HEADER_CHAT_NOTIFICATION_ITEM&&(GAG.PageController._isChatNotificationShown=!1),c=a.grep(c,function(a){return a!=b}),a(c.join(",")).addClass("hide");for(var e in d){var f=d[e],g="";switch(e){case this.selectors.HEADER_FUNNY_ITEM:g="selected-alt";break;case this.selectors.HEADER_USER_ITEM:g="selected",f+=" a";break;case this.selectors.HEADER_DOWNLOAD_ITEM:g="selected";break;case this.selectors.HEADER_NOTIFICATION_ITEM:g="selected",f+=" a";break;case this.selectors.HEADER_CHAT_NOTIFICATION_ITEM:g="selected",f+=" a"}e!=b?a(f).removeClass("selected-alt").removeClass("selected"):a(f).addClass(g)}},bindPopupMenu:function(){a("body").on("click",a.proxy(function(b){this.hidePopupMenu((b.ctrlKey||b.metaKey)&&a(b.target).parents(this.selectors.HEADER_NOTIFICATION_ITEM).length>0?this.selectors.HEADER_NOTIFICATION_ITEM:null)},this))},bindGroupElements:function(){a(this.selectors.HEADER_FUNNY_MENU+", "+this.selectors.HEADER_FUNNY_ITEM).click(a.proxy(function(a){a.stopPropagation();var b=this.toggleMenu(this.selectors.HEADER_FUNNY_ITEM,this.selectors.HEADER_FUNNY_MENU);this.hidePopupMenu(b?this.selectors.HEADER_FUNNY_ITEM:null)},this))},bindDownloadElements:function(){a(this.selectors.HEADER_DOWNLOAD_MENU+", "+this.selectors.HEADER_DOWNLOAD_ITEM).click(a.proxy(function(a){a.stopPropagation();var b=this.toggleMenu(this.selectors.HEADER_DOWNLOAD_ITEM);this.hidePopupMenu(b?this.selectors.HEADER_DOWNLOAD_ITEM:null)},this))},bindNotificationElements:function(){a(this.selectors.HEADER_NOTIFICATION_ITEM).on("click",this.selectors.CLICK_EVENT_SELECTOR,a.proxy(this._handelClickEventTracking,this)),GAG.PageController.bindNotificationScrollbar(),GAG.PageController.getNotifications(),a(document).click(a.proxy(function(b){GAG.PageController._isNotificationShown&&(GAG.PageController._isNotificationShown=!GAG.PageController._isNotificationShown,(b.ctrlKey||b.metaKey)&&a(b.target).parents(this.selectors.HEADER_NOTIFICATION_ITEM).length>0||(this.hideMenu(this.selectors.HEADER_NOTIFICATION_ITEM),a(this.selectors.HEADER_NOTIFICATION_MENU).removeClass("menu"),a(this.selectors.HEADER_NOTIFICATION_MENU+" a").removeClass("selected")))},this)),a(this.selectors.HEADER_NOTIFICATION_MENU).click(a.proxy(function(b){b.stopPropagation(),b.preventDefault(),GAG.PageController._isNotificationShown?(this.hideMenu(this.selectors.HEADER_NOTIFICATION_ITEM),a(this.selectors.HEADER_NOTIFICATION_MENU).removeClass("menu"),a(this.selectors.HEADER_NOTIFICATION_MENU+" a").removeClass("selected"),this._handelClickEventTracking(b)):(this.showMenu(this.selectors.HEADER_NOTIFICATION_ITEM),a(this.selectors.HEADER_NOTIFICATION_MENU).addClass("menu"),a(this.selectors.HEADER_NOTIFICATION_MENU+" a").addClass("selected"),GAG.PageController.bindNotificationScrollbar(),GAG.PageController.markNotificationsAsRead(),this._handelClickEventTracking(b),this.hidePopupMenu(this.selectors.HEADER_NOTIFICATION_ITEM)),GAG.PageController._isNotificationShown=!GAG.PageController._isNotificationShown},this))},bindNotificationScrollbar:function(){var b=a(GAG.PageController.selectors.HEADER_NOTIFICATION_ITEM).data("plugin_tinyscrollbar");b?a(GAG.PageController.selectors.HEADER_NOTIFICATION_ITEM).data("plugin_tinyscrollbar").update("relative"):(a(GAG.PageController.selectors.HEADER_NOTIFICATION_ITEM).tinyscrollbar({invertscroll:!0}),a(GAG.PageController.selectors.HEADER_NOTIFICATION_ITEM).bind("move",function(){GAG.PageController.bindNotificationLoadMore()}))},bindNotificationLoadMore:function(){var b=a(GAG.PageController.selectors.HEADER_NOTIFICATION_ITEM).data("plugin_tinyscrollbar"),c=.9,d=b.contentPosition+b.viewportSize,e=b.contentSize*c,f=a(this.selectors.HEADER_NOTIFICATION_CONTAINER),g=f.data("didEndOfList");!g&&!GAG.PageController._isUpdatingNotification&&d>=e&&(GAG.GA.track("Notification-Badge","load-more","count",++GAG.PageController._notificationLoadCount),GAG.PageController.getNotifications(f.data("nextKey")))},bindChatNotificationElements:function(){a(this.selectors.HEADER_CHAT_NOTIFICATION_ITEM).on("click",this.selectors.CLICK_EVENT_SELECTOR,a.proxy(this._handelClickEventTracking,this)),a(this.selectors.HEADER_CHAT_NOTIFICATION_ITEM).tinyscrollbar({invertscroll:!0}),GAG.PageController.getChatNotifications(),a(document).click(a.proxy(function(b){GAG.PageController._isChatNotificationShown&&(GAG.PageController._isChatNotificationShown=!GAG.PageController._isChatNotificationShown,(b.ctrlKey||b.metaKey)&&a(b.target).parents(this.selectors.HEADER_CHAT_NOTIFICATION_ITEM).length>0||(this.hideMenu(this.selectors.HEADER_CHAT_NOTIFICATION_ITEM),a(this.selectors.HEADER_CHAT_NOTIFICATION_MENU).removeClass("menu"),a(this.selectors.HEADER_CHAT_NOTIFICATION_MENU+" a").removeClass("selected")))},this)),a(this.selectors.HEADER_CHAT_NOTIFICATION_MENU).click(a.proxy(function(b){b.stopPropagation(),b.preventDefault(),GAG.PageController._isChatNotificationShown?(this.hideMenu(this.selectors.HEADER_CHAT_NOTIFICATION_ITEM),a(this.selectors.HEADER_CHAT_NOTIFICATION_MENU).removeClass("menu"),a(this.selectors.HEADER_CHAT_NOTIFICATION_MENU+" a").removeClass("selected"),this._handelClickEventTracking(b)):(this.showMenu(this.selectors.HEADER_CHAT_NOTIFICATION_ITEM),a(this.selectors.HEADER_CHAT_NOTIFICATION_MENU).addClass("menu"),a(this.selectors.HEADER_CHAT_NOTIFICATION_MENU+" a").addClass("selected"),a(this.selectors.HEADER_CHAT_NOTIFICATION_ITEM).data("plugin_tinyscrollbar").update({invertscroll:!0}),GAG.PageController.markChatNotificationsAsRead(),this._handelClickEventTracking(b),this.hidePopupMenu(this.selectors.HEADER_CHAT_NOTIFICATION_ITEM)),GAG.PageController._isChatNotificationShown=!GAG.PageController._isChatNotificationShown},this))},bindUploadElements:function(){a(this.selectors.HEADER_UPLOAD_MENU).click(a.proxy(function(a){a.stopPropagation(),this.toggleMenu(this.selectors.HEADER_UPLOAD_ITEM),this.hidePopupMenu(this.selectors.HEADER_UPLOAD_ITEM),GAG.Configs.get("user.showCaptcha")&&GAG.PageController.preloadCaptchaScript()},this)),a(".badge-upload-url").on("click",function(b){b.preventDefault(),a("#jsid-upload-url-btn").trigger("click")}),a(".badge-upload-image").on("click",function(b){b.preventDefault(),a("#jsid-upload-file-btn").trigger("click")}),a(".badge-upload-selector").on("click",function(b){b.preventDefault(),a(GAG.UploadController.selectors.UPLOAD_TITLE_INPUT).val(""),a("#jsid-source-input").addClass("hide").val(""),a("#upload-file input[type=checkbox]").removeAttr("checked"),a("#upload-file p.error-message").text(""),GAG.OverlayController.showOverlay("#modal-upload")})},bindCustomizeElements:function(){a(this.selectors.PERSONALISE_BTN_SHOW).on("click",function(b){b.preventDefault(),a(this).toggleClass("selected"),a(GAG.PageController.selectors.PERSONALISE_SELECTOR).slideToggle("fast",function(){})}),a(this.selectors.PERSONALISE_OPTION).on("click",function(b){b.preventDefault(),a(this).toggleClass("on");var c=a(this).find("input");c.val("1"==c.val()?"":"1")}),a(this.selectors.PERSONALISE_OPTION_NSFW).on("click",function(c){c.preventDefault();var d="1"==a(this).find("input").val()?0:1;if(!GAG.User.isLoggedIn()){var e=GAG.Page.getCookieOptions();e.domain=GAG.Configs.get("page.cookie_domain"),a.cookie(GAG.PageController._sidePersonalizeCookieKey,1,e),GAG.AccountController.setSafeMode(d,b.location.href)}}),a(this.selectors.PERSONALISE_BTN_SAVE).on("click",function(b){b.preventDefault(),a(GAG.PageController.selectors.PERSONALISE_SELECTOR).slideUp("fast",function(){GAG.PageController._personaliseFormSubmit()})}),a(this.selectors.PERSONALISE_BTN_RESET).on("click",function(b){b.preventDefault();var c="This will remove all your manual personalisation settings.";confirm(c)&&(a(GAG.PageController.selectors.PERSONALISE_FORM+" input[name=customize_reset]").val("1"),a(GAG.PageController.selectors.PERSONALISE_SELECTOR).slideUp("fast",function(){GAG.PageController._personaliseFormReset()}))})},_personaliseFormReset:function(){var b=GAG.Page.getCookieOptions();b.domain=GAG.Configs.get("page.cookie_domain"),a(GAG.PageController.selectors.PERSONALISE_FORM).submit()},_personaliseFormSubmit:function(){var b=GAG.Page.getCookieOptions();b.domain=GAG.Configs.get("page.cookie_domain"),a(GAG.PageController.selectors.PERSONALISE_FORM).submit()},resetCustomize:function(){a("#form-modal-customize").find("input:checkbox").each(function(){var b=a(this);b.data("checked")?b.attr("checked","checked"):b.removeAttr("checked")})},bindFooterNavElements:function(){var b=a(this.selectors.SCROLL_TO_TOP);b.on("click",function(a){a.preventDefault(),GAG.KeyboardController.scrollToTop()})},checkFooterNavElements:function(){var c=a(b).scrollTop();c>this._showFooterNavAfter&&!a(this.selectors.FOOTER_NAV).hasClass(this._CLASS_SHOW_BACK_TO_TOP)?a(this.selectors.FOOTER_NAV).addClass(this._CLASS_SHOW_BACK_TO_TOP):c<=this._showFooterNavAfter&&a(this.selectors.FOOTER_NAV).hasClass(this._CLASS_SHOW_BACK_TO_TOP)&&a(this.selectors.FOOTER_NAV).removeClass(this._CLASS_SHOW_BACK_TO_TOP)},bindToastElements:function(){if(a(this.selectors.HEADER_TOAST).is(":hidden")){var b=GAG.Toast.getToast();jQuery.isEmptyObject(b)||this.showToast(b.text,b.color,5e3)}},bindCloseAdvice:function(){a(".badge-advice-close").click(a.proxy(function(b){b.preventDefault();a(b.currentTarget);a(".badge-announcement-banner").addClass("hide"),a(".badge-advice").removeClass("before"),a.cookie("announcement_banner",0,GAG.Page.getCookieOptions())},this))},bindEmailSubscription:function(){a(this.selectors.CONTAINTER).on("click",this.selectors.SIDEBAR_EMAIL_SCRIPTION_BTN,a.proxy(this._emailSubscriptionButtonHandler,this)),a(this.selectors.CONTAINTER).on("keypress",this.selectors.SIDEBAR_EMAIL_SCRIPTION_INPUT,a.proxy(this._emailSubscriptionKeypressHandler,this))},_emailSubscriptionKeypressHandler:function(a){13==a.which&&(a.preventDefault(),this._emailSubscriptionButtonHandler(a))},_emailSubscriptionButtonHandler:function(b){if(!this._isSigningUpEmailSubscription){this._isSigningUpEmailSubscription=!0;var c=a(b.target),d=c.parents(this.selectors.SIDEBAR_EMAIL_SCRIPTION_ELEM),e=d.find(this.selectors.SIDEBAR_EMAIL_SCRIPTION_INPUT).val();d.find(this.selectors.SIDEBAR_EMAIL_SCRIPTION_INPUT).removeClass("error");var f=GAG.Configs.get("user.id");f||(f="");var g={email:e,userId:f},h=this,i=new RegExp("^([a-zA-Z0-9._-]+)@([a-zA-Z0-9.-]+)\\.([a-zA-Z]{2,4})$");if(i.test(e)){a.ajax({url:"/email-subscription",data:g,dataType:"json",type:"POST",success:function(){d.find(h.selectors.SIDEBAR_EMAIL_SCRIPTION_TOGGLE_HIDE).toggleClass("hide"),h._isSigningUpEmailSubscription=!1},error:function(){h._isSigningUpEmailSubscription=!1}})}else d.find(this.selectors.SIDEBAR_EMAIL_SCRIPTION_INPUT).addClass("error"),this._isSigningUpEmailSubscription=!1}},_trackGaEvent:function(a){var b=a.attr("data-evt");if(b){b+="";var c=b.split(","),d="",e="",f="",g=1;d=c.shift(),e=c.shift(),f=c.shift(),GAG.GA.track(d,e,f,g)}},_trackEvent:function(a){var b=a.attr("data-track");if(b&&void 0!=b){b+="";var c=b.split(","),d=c.shift(),e=c.shift(),f=c.shift(),g=c.shift(),h=c.shift(),i=c.shift(),j=c.shift(),k={label:f,labelValue:g,platform:h,entry:i,view:j};GAG.Track.event(d,e,k)}},_handelClickEventTracking:function(c){var d=a(c.currentTarget);this._trackGaEvent(d),this._trackEvent(d);var e=d.prop("tagName"),f=d.attr("href")+"",g=d.attr("target"),h=d.is(this.selectors.CLICK_EVENT_NOFOLLOW_SELECTOR);if(!(h||"A"!=e||0!==f.indexOf("http")&&0!==f.indexOf("/")||g)){c&&c.preventDefault();var i="window.location.href = '"+f+"';";b.setTimeout(i,100)}},bindEventTracking:function(){a(this.selectors.CONTAINTER).on("click",this.selectors.CLICK_EVENT_SELECTOR,a.proxy(this._handelClickEventTracking,this))},_cleanToastColor:function(b){b=a(b);for(var c=b.attr("class").split(/\s+/),d=0;d<c.length;d++)"toast-color-"==c[d].substr(0,12)&&b.removeClass(c[d])},setPageTitle:function(a){this.docTitle=a;var b=GAG.PushController.unreadCount,c=b>0?"("+b+") ":"";document.title=c+a},setPageTitleWithSpecialChars:function(a){var b=document.createElement("div");b.innerHTML=a,this.setPageTitle(b.firstChild.nodeValue)},refreshPageTitle:function(){this.setPageTitle(this.docTitle)},getWindowEffectiveScrollTop:function(){return a(b).scrollTop()<this._topVolatileElementHeight?this._topVolatileElementHeight+this._topStickyElementHeight:a(b).scrollTop()+this._topStickyElementHeight},scrollToTop:function(){a("html, body").animate({scrollTop:0},300)},ensureLoggedIn:function(a){return GAG.User.isLoggedIn()?!0:(GAG.AccountController.presentSignupForm(a),!1)},setCustomizeElementValues:function(){a(this.selectors.PERSONALISE_OPTION).each(function(){var b=a(this).closest("li"),c=!0;a(this).find("input[name=show_nsfw]").length>0&&b&&(c=!GAG.PageController.isSafeModeEnabled(),a(this).find("input[name=show_nsfw]").val(c?1:0)),c?(a(b).addClass("selected"),a(this).addClass("on")):(a(b).removeClass("selected"),a(this).removeClass("on"))})},checkCustomizeElementsShowStatus:function(){if(GAG.Page.isListingPage()){var b="hot"==GAG.Page.getPageKey()&&null==a.cookie(this._sidePersonalizeCookieKey);if(b=b||1==a.cookie(this._sidePersonalizeCookieKey)){a(this.selectors.PERSONALISE_SELECTOR).show(),a(this.selectors.PERSONALISE_BTN_SHOW).addClass("selected");var c=GAG.Page.getCookieOptions();c.domain=GAG.Configs.get("page.cookie_domain"),a.cookie(this._sidePersonalizeCookieKey,0,c)}}},isAutoAnimatedGifEnabled:function(){return!0},isMp4AutoPlay:function(){{var a=!!b.opera||navigator.userAgent.indexOf(" OPR/")>=0,c="undefined"!=typeof InstallTrigger,d=(Object.prototype.toString.call(b.HTMLElement).indexOf("Constructor")>0,!!b.chrome&&!a),e=!1||!!document.documentMode,f=navigator.userAgent.toLowerCase(),g=f.indexOf("android")>-1;f.indexOf("android")>-1&&f.indexOf("mobile"),null!=navigator.userAgent.match(/iPad/i),null!=navigator.userAgent.match(/iPhone/i)||null!=navigator.userAgent.match(/iPod/i)}return d&&!g?!0:c?!0:e?!0:a?!0:!1},getScrollAutoPlayMp4State:function(){var a=!!b.opera||navigator.userAgent.indexOf(" OPR/")>=0,c="undefined"!=typeof InstallTrigger,d=Object.prototype.toString.call(b.HTMLElement).indexOf("Constructor")>0,e=!!b.chrome&&!a,f=!1||!!document.documentMode,g=navigator.userAgent.toLowerCase(),h=g.indexOf("android")>-1,i=(g.indexOf("android")>-1&&g.indexOf("mobile"),null!=navigator.userAgent.match(/iPad/i)),j=null!=navigator.userAgent.match(/iPhone/i)||null!=navigator.userAgent.match(/iPod/i);return i||j||h?0:d?1:e&&!h?2:c?2:f?2:a?2:0},isSafeModeEnabled:function(){return"0"!==a.cookie(GAG.PageController._safeModeCookieKey)},loadAnimatedGif:function(){GAG.Page.isPostPage()&&this.isMp4AutoPlay()?a(GAG.PostController.selectors.ENTRY_ANIMATED_COVER).each(function(){a(this).hasClass("badge-auto-clicked")||(a(this).click(),a(this).addClass("badge-auto-clicked"))}):a(GAG.PostController.selectors.ENTRY_ANIMATED_PLAY_BUTTON).each(function(){a(this).hasClass("badge-auto-clicked")||(a(this).removeClass("hide"),a(this).addClass("badge-auto-clicked"))})},showConfirmEmailBanner:function(b){a(this.selectors.HEADER_BANNER_CONFIRM_EMAIL_USERNAME).text(b),a(this.selectors.HEADER_BANNER_CONFIRM_EMAIL).removeClass("hide"),this.calculateHeights()},showToast:function(b,c,d){var e=a(this.selectors.HEADER_TOAST);e.hide(),this._cleanToastColor(e),a(this.selectors.HEADER_TOAST).addClass("toast-color-"+c),a(this.selectors.HEADER_TOAST_MESSAGE).text(b),a(this.selectors.HEADER_TOAST_CLOSE).click(a.proxy(function(a){a.preventDefault(),this.hideToast()},this)),a(this.selectors.HEADER_TOAST).fadeIn(this._toastFadeDuration),"undefined"!=typeof d&&setTimeout(a.proxy(function(){this.hideToast()},this),d)},hideToast:function(){a(this.selectors.HEADER_TOAST).fadeOut(this._toastFadeDuration)},switchToTheme:function(b){a(this.selectors.THEME_FILES).attr("media","none"),a(this.selectors.THEME_FILES+"[data-theme-id="+b+"]").attr("media","screen,projection")},getNotifications:function(b){if(!GAG.PageController._isUpdatingNotification){GAG.PageController._isUpdatingNotification=!0;var c='<li class="loading badge-notification-loader"><a class="btn spin">Loading </a></li>';a(this.selectors.HEADER_NOTIFICATION_CONTAINER).append(c),GAG.PageController.bindNotificationScrollbar();var d="/notifications",e={};(b||!GAG.PushController._lastBadgetTs)&&(e.includeReadState=1),b&&(e.refKey=b);{a.ajax({url:d,data:e,dataType:"json",success:function(a){GAG.PageController._isUpdatingNotification=!1,GAG.PageController._lastNotificationUpdateTs=(new Date).getTime(),GAG.PageController.updateNotification(a),a["read-state"]&&GAG.PushController.getNsReadStateCb({status:"OK",payload:a["read-state"],doNotGetNoti:!0,error:""})},error:function(){GAG.PageController._isUpdatingNotification=!1},complete:function(){a(GAG.PageController.selectors.HEADER_NOTIFICATION_CONTAINER).find(".badge-notification-loader").remove(),GAG.PageController.bindNotificationScrollbar()}})}}},getChatNotifications:function(){if(!GAG.PageController._isUpdatingChatNotification){GAG.PageController._isUpdatingChatNotification=!0;var b="/chat_notifications";GAG.PushController._lastBadgetTs||(b+="?includeReadState=1");{a.ajax({url:b,dataType:"json",success:function(a){GAG.PageController._isUpdatingChatNotification=!1,GAG.PageController._lastChatNotificationUpdateTs=(new Date).getTime(),GAG.PageController.updateChatNotification(a),a["read-state"]&&GAG.PushController.getChatNsReadStateCb({status:"OK",payload:a["read-state"],doNotGetNoti:!0,error:""})},error:function(){GAG.PageController._isUpdatingChatNotification=!1}})}}},markNotificationsAsRead:function(){if(!GAG.PageController._isMarkingNotificationAsRead){GAG.PageController._isMarkingNotificationAsRead=!0;{var b=GAG.Configs.get("user.noti.read_state_url"),c=GAG.Configs.get("user.noti.read_state_params");a.ajax({url:b,data:c,dataType:"json",type:"POST",success:function(a){GAG.PageController._isMarkingNotificationAsRead=!1,"OK"==a.status&&GAG.PushController.updateNotificationUnreadCount(0)},error:function(){GAG.PageController._isMarkingNotificationAsRead=!1}})}}},markChatNotificationsAsRead:function(){if(!GAG.PageController._isMarkingChatNotificationAsRead){GAG.PageController._isMarkingChatNotificationAsRead=!0;{var b=GAG.Configs.get("user.chat_noti.read_state_url"),c=GAG.Configs.get("user.chat_noti.read_state_params");a.ajax({url:b,data:c,dataType:"json",type:"POST",success:function(a){GAG.PageController._isMarkingChatNotificationAsRead=!1,"OK"==a.status&&GAG.PushController.updateChatNotificationUnreadCount(0)},error:function(){GAG.PageController._isMarkingChatNotificationAsRead=!1}})}}},markNotificationItemAsRead:function(b,c,d){a(b).data("markedRead")||a.ajax({url:"/notifications/mark-item",data:{actionType:c,objectId:d,state:1},dataType:"json",type:"POST",success:function(c){"OK"==c.status&&a(b).data("markedRead",!0).removeClass("new")},error:function(){}})},markChatNotificationItemAsRead:function(b,c,d){a(b).data("markedRead")||a.ajax({url:"/chat_notifications/mark-item",data:{actionType:c,objectId:d,state:1},dataType:"json",type:"POST",success:function(c){"OK"==c.status&&a(b).data("markedRead",!0).removeClass("new")},error:function(){}})},updateNotification:function(b){var c=a(this.selectors.HEADER_NOTIFICATION_CONTAINER);if("OK"==b.status)if(c.find(".empty").remove(),b.items.length>0){for(var d=0;d<b.items.length;d++)c.append(b.items[d].message);a(this.selectors.HEADER_NOTIFICATION_SEE_ALL).text(GAG.PushController.unreadCount>20?"See "+(GAG.PushController.unreadCount-20)+" more":"See all"),c.data("didEndOfList",b.didEndOfList),c.data("nextKey",b.nextKey)}else 0==c.find(".badge-evt").length&&c.append(b.message),c.data("didEndOfList",1);else c.append(b.message),c.data("didEndOfList",1);GAG.PageController.bindNotificationScrollbar()},updateChatNotification:function(b){var c=a(this.selectors.HEADER_CHAT_NOTIFICATION_CONTAINER);if(c.empty(),"OK"==b.status)if(b.items.length>0)for(var d=0;d<b.items.length;d++)c.append(b.items[d].message);else c.append(b.message);else c.append(b.message);a(this.selectors.HEADER_CHAT_NOTIFICATION_ITEM).tinyscrollbar({invertscroll:!0})},updateTimeZoneOffset:function(){var b=(new Date).getTimezoneOffset()/-60;a.cookie("gag_tz",b,{domain:GAG.Configs.get("page.cookie_domain"),expires:365,path:"/"})},syncAccountSystemSession:function(){if(GAG.User.isLoggedIn()){var b=GAG.Configs.get("user.acs_url");if(b){var c=new Image;c.src=b,a.cookie("__ssid","0",{domain:GAG.Configs.get("page.cookie_domain"),expires:1,path:"/"})}}},initUserFunction:function(){a(this.selectors.HEADER_USER_FUNCTION_PLACEHOLDER).addClass("hide"),GAG.User.isLoggedIn()?(a(this.selectors.HEADER_USER_FUNCTION).hasClass("hide")&&(GAG.PageController.bindNotificationElements(),GAG.Configs.get("user.chat_noti.show_chat_notification")&&GAG.PageController.bindChatNotificationElements()),a(this.selectors.HEADER_VISITOR_FUNCTION).addClass("hide"),GAG.Configs.get("user.chat_noti.show_chat_notification")?a(this.selectors.HEADER_DOWNLOAD_BTN_CONTAINER).addClass("hide"):a(this.selectors.HEADER_DOWNLOAD_BTN_CONTAINER).removeClass("hide"),a(this.selectors.HEADER_USER_FUNCTION).removeClass("hide")):(a(this.selectors.HEADER_USER_FUNCTION).addClass("hide"),a(this.selectors.HEADER_VISITOR_FUNCTION).removeClass("hide"),a(this.selectors.HEADER_DOWNLOAD_BTN_CONTAINER).removeClass("hide"))},updateSignUpReferrer:function(){GAG.User.isLoggedIn()||null!=a.cookie(this._signUpReferrerCookieKey)||a.cookie(this._signUpReferrerCookieKey,document.referrer,{domain:GAG.Configs.get("page.cookie_domain"),expires:365,path:"/"})},captchaLoaded:[],showCaptcha:function(b){if(!this.captchaLoaded[b]){a("#jsid-"+b+"-captchawrapper").show();var c=a("#jsid-"+b+"-captchadiv").attr("data-apiKey");a("#recaptcha_image").attr("id",a("#recaptcha_image").data("id")),a("#recaptcha_response_field").attr("id",a("#recaptcha_response_field").data("id")),a("#jsid-"+b+"-recaptcha_image").attr("id","recaptcha_image"),a("#jsid-"+b+"-recaptcha_response_field").attr("id","recaptcha_response_field");try{Recaptcha&&Recaptcha.create(c,"#jsid-"+b+"-captchadiv",{tabindex:1,theme:"custom",custom_theme_widget:"jsid-"+b+"-recaptcha_widget",lang:"en",custom_translations:{instructions_visual:"Type the two words:"},callback:function(){GAG.PageController.captchaLoaded[b]=!0}})}catch(d){}}},preloadCaptchaScript:function(){var a="//www.google.com/recaptcha/api/js/recaptcha_ajax.js";GAG.Utils.scriptLoaded(a)||GAG.Utils.loadScript(a,!1)}}),GAG.WebNotiController=a.extend({},new GAG.Controller,{COOKIE_SLEEP_KEY:"web-not-sleep-key",init:function(){},requestPermission:function(a){Notification.requestPermission(function(b){Notification.permission!==b&&(Notification.permission=b),a&&"granted"===Notification.permission&&GAG.WebNotiController.initNotification(a)})},show:function(a){return b.Notification?"granted"===Notification.permission?void GAG.WebNotiController.initNotification(a):void("denied"!==Notification.permission&&GAG.WebNotiController.requestPermission(a)):void console.log("No notification")},initNotification:function(b){var c=a.cookie(GAG.WebNotiController.COOKIE_SLEEP_KEY);if(c)return console.log("WebNoti skipped"),void GAG.GA.track("Notification-Web","Skipped","",0);var d=new Notification(b,{tag:"nineGAGNotification",icon:GAG.Configs.get("page.assets_url")+"/logo-noti-black.png"});d.onclick=GAG.WebNotiController.clickHandler,d.onclose=GAG.WebNotiController.closeHandler,d.onerror=GAG.WebNotiController.errorHandler,GAG.GA.track("Notification-Web","Sent","",0)},clickHandler:function(){try{GAG.PageController.showMenu(GAG.PageController.selectors.HEADER_NOTIFICATION_ITEM),a(GAG.PageController.selectors.HEADER_NOTIFICATION_MENU).addClass("menu"),a(GAG.PageController.selectors.HEADER_NOTIFICATION_MENU+" a").addClass("selected"),a(GAG.PageController.selectors.HEADER_NOTIFICATION_ITEM).data("plugin_tinyscrollbar").update({invertscroll:!0}),GAG.PageController.markNotificationsAsRead(),GAG.PageController.hidePopupMenu(GAG.PageController.selectors.HEADER_NOTIFICATION_ITEM),b.focus(),a("html, body").animate({scrollTop:a(GAG.PageController.selectors.HEADER_NOTIFICATION_ITEM).offset().top},200),GAG.GA.track("Notification-Web","Clicked","",0)}catch(c){console.log(c.message)}},closeHandler:function(){var b=new Date;b.setTime(b.getTime()+1e3*GAG.Configs.get("page.webNotiSleepTtl")),a.cookie(GAG.WebNotiController.COOKIE_SLEEP_KEY,1,{path:"/",expires:b}),GAG.GA.track("Notification-Web","Closed","",0)},errorHandler:function(){}}),GAG.PushController=a.extend({},new GAG.Controller,{DELAY:1e3,INIT_DELAY:2e3,_lastBadgetTs:!1,_minBadgeInterval:5e3,_regularLongPollingInterval:18e4,_checkUpdateQueueInterval:1e3,_isRequestingUpdate:!1,_isRequestingChatUpdate:!1,unreadCount:0,chatUnreadCount:0,init:function(){},onWindowLoad:function(){GAG.Configs.get("user.id")&&setTimeout(a.proxy(function(){this._initPush(),GAG.Configs.get("user.chat_noti.show_chat_notification")&&this._initChatPush(),this._initBadgeUpdate()},this),this.INIT_DELAY)},selectors:{NOTIFICATION_UNREAD_COUNT:"#jsid-notification-unread-count",CHAT_NOTIFICATION_UNREAD_COUNT:"#jsid-chat-notification-unread-count"},_log:function(){},_pullNotificatons:function(b){var c=a(this.selectors.NOTIFICATION_UNREAD_COUNT);c&&this.putToUpdateQueue(b)},_initPush:function(){function a(a,b,c){var d={type:"noti",message:a,id:b,channel:c};GAG.PushController._log(d),GAG.PushController._pullNotificatons(d)}var b={host:GAG.Configs.get("user.noti.host"),port:GAG.Configs.get("user.noti.port"),modes:GAG.Configs.get("user.noti.modes")};if(b.host&&b.port){var c=new PushStream(b);c.onmessage=a;var d=GAG.Configs.get("user.noti.channels");if(d instanceof Array)for(var e=0;e<d.length;e++)c.addChannel(d[e]),GAG.PushController._log(d[e]);c.connect()}},_initChatPush:function(){function a(a,b,c){var d={type:"noti",message:a,id:b,channel:c};GAG.PushController._log(d),GAG.PushController._pullNotificatons(d)}var b={host:GAG.Configs.get("user.chat_noti.host"),port:GAG.Configs.get("user.chat_noti.port"),modes:GAG.Configs.get("user.chat_noti.modes")};if(b.host&&b.port&&GAG.Configs.get("user.chat_noti.show_chat_notification")){var c=new PushStream(b);c.onmessage=a;var d=GAG.Configs.get("user.chat_noti.channels");if(d instanceof Array)for(var e=0;e<d.length;e++)c.addChannel(d[e]),GAG.PushController._log(d[e]);c.connect()}},_updateQueue:[],putToUpdateQueue:function(a){this._updateQueue.push(a)},getNsReadStateCb:function(b){GAG.PushController._isRequestingUpdate=!1,GAG.PushController._lastBadgetTs=(new Date).getTime(),b&&"OK"==b.status?(GAG.PushController.unreadCount!=b.payload.unreadCount&&(b.doNotGetNoti||(a(GAG.PageController.selectors.HEADER_NOTIFICATION_CONTAINER).empty(),GAG.PageController.getNotifications())),GAG.PushController.updateNotificationUnreadCount(b.payload.unreadCount)):GAG.PushController._isRequestingUpdate=!1},getChatNsReadStateCb:function(a){GAG.PushController._isRequestingChatUpdate=!1,GAG.PushController._lastBadgetTs=(new Date).getTime(),a&&"OK"==a.status?(GAG.PushController.chatUnreadCount!=a.payload.unreadCount&&(a.doNotGetNoti||GAG.PageController.getChatNotifications()),GAG.PushController.updateChatNotificationUnreadCount(a.payload.unreadCount)):GAG.PushController._isRequestingChatUpdate=!1},_getNsReadState:function(){var b=GAG.Configs.get("user.noti.read_state_url")+"?"+GAG.Configs.get("user.noti.read_state_params");this._isRequestingUpdate=!0;a.ajax({url:b,type:"GET",dataType:"jsonp",jsonpCallback:"GAG.PushController.getNsReadStateCb"})},_getChatNsReadState:function(){var b=GAG.Configs.get("user.chat_noti.read_state_url")+"?"+GAG.Configs.get("user.chat_noti.read_state_params");this._isRequestingUpdate=!0;a.ajax({url:b,type:"GET",dataType:"jsonp",jsonpCallback:"GAG.PushController.getChatNsReadStateCb"})},getNotificationBadge:function(){return this._isRequestingUpdate?void 0:this._getNsReadState()},getChatNotificationBadge:function(){return this._isRequestingChatUpdate?void 0:this._getChatNsReadState()},updateNotificationUnreadCount:function(b){var c=a(this.selectors.NOTIFICATION_UNREAD_COUNT);if(c){if(b>0){GAG.PushController.unreadCount=b,c.text(b),c.removeClass("hide");var d=b+" unread messages. \nClick to read detail.";1==b&&(d=b+" unread message. \nClick to read detail."),GAG.WebNotiController.show(d)}else GAG.PushController.unreadCount=0,c.text("0"),c.addClass("hide");GAG.PageController.refreshPageTitle()}},updateChatNotificationUnreadCount:function(b){var c=a(this.selectors.CHAT_NOTIFICATION_UNREAD_COUNT);c&&(b>0?(GAG.PushController.chatUnreadCount=b,c.text(b),c.removeClass("hide")):(GAG.PushController.chatUreadCount=0,c.text("0"),c.addClass("hide")))},checkUpdateQueue:function(){this._updateQueue.length>0&&(this._updateQueue=[],this.getNotificationBadge(),this.getChatNotificationBadge())},processUpdateQueue:function(){var a=(new Date).getTime();(!this._lastBadgetTs||a-this._lastBadgetTs>=this._minBadgeInterval)&&this.checkUpdateQueue()},addRegularLongPolling:function(){this.putToUpdateQueue({})},scheduleRegularLongPolling:function(){this.addRegularLongPolling(),this._regularLongPollingInterval=1.5*this._regularLongPollingInterval,setTimeout("GAG.PushController.scheduleRegularLongPolling();",this._regularLongPollingInterval)
},_initBadgeUpdate:function(){setInterval("GAG.PushController.processUpdateQueue();",this._checkUpdateQueueInterval),setTimeout("GAG.PushController.scheduleRegularLongPolling();",this._regularLongPollingInterval)}}),GAG.ProfileController=a.extend({},new GAG.Controller,{init:function(){this.bindElements()},selectors:{PROFILE_CHAT_BTN:"#jsid-profile-chat-btn"},_bindProfileChatButton:function(){a(this.selectors.PROFILE_CHAT_BTN).click(function(){var b=a(this).data("profilename"),c=a(this).data("viewername");a(this).attr("active",""),GAG.GA.track("profile","chat-click","click"),GAG.GA.track("profile","chat-receive",b),GAG.GA.track("profile","chat-sent",c),"__GUEST__"!=c&&a.ajax({url:"/notification/invite-chat",data:{profileName:b},dataType:"json",type:"POST",success:function(){},error:function(){}})})},bindElements:function(){this._bindProfileChatButton()}}),GAG.ProfileSettingController=a.extend({},new GAG.Controller,{init:function(){this.bindElements()},selectors:{SETTING_SOCIAL_UNLINK_BTNS:".badge-social-unbind",PROFILE_AVATAR_IMAGE:"#jsid-profile-avatar",PROFILE_AVATAR_UPLOAD:"input[name=avatar]",PROFILE_DEFAULT_AVATAR:"input[name=default_avatar]",PROFILE_COLOR_BTN:".badge-profile-color",PROFILE_COLOR:"input[name=profile_color]",RANDOM_AVATAR_BTN:"#jsid-random-avatar-btn"},_bindSocialUnlinkButtons:function(){a(this.selectors.SETTING_SOCIAL_UNLINK_BTNS).on("click",function(){var c=a(this),d=c.attr("data-platform");a.ajax({url:"/connect/unlink",data:{platform:d},dataType:"json",success:function(a){a&&a.okay&&b.location.reload()},error:function(){}})})},_bindRandomAvatarButton:function(){var b=a(this.selectors.PROFILE_AVATAR_IMAGE),c=a(this.selectors.PROFILE_DEFAULT_AVATAR),d=a(this.selectors.RANDOM_AVATAR_BTN);a(d).click(a.proxy(function(){var e=d.data("path"),f=d.data("max"),g=Math.floor(Math.random()*f+1),h=e.replace("%random%",g);if(b.attr("src")!=h){b.attr("src",h),c.val(g);var i=a(this.selectors.PROFILE_AVATAR_UPLOAD);i.replaceWith(i.clone())}else d.click();return!1},this)),a(document).on("change",this.selectors.PROFILE_AVATAR_UPLOAD,function(){c.val("")})},_bindProfileColorButton:function(){a(this.selectors.PROFILE_COLOR_BTN).click(function(b){a(GAG.ProfileSettingController.selectors.PROFILE_COLOR_BTN).removeClass("selected"),a(this).addClass("selected"),a(GAG.ProfileSettingController.selectors.PROFILE_COLOR).val(a(this).data("color")),GAG.GA.track("profile","change-color",a(this).data("color")),b.preventDefault()})},bindElements:function(){this._bindSocialUnlinkButtons(),this._bindRandomAvatarButton(),this._bindProfileColorButton()}}),GAG.OverlayController=a.extend({},new GAG.Controller,{_isShown:!1,_hideUsingBackground:!0,selectors:{OVERLAY:"#overlay-container",OVERLAY_COMPONENT:"section",OVERLAY_CLOSE_BUTTON:".badge-overlay-close",OVERLAY_COMPONENT_REPORT:".badge-overlay-report",OVERLAY_COMPONENT_LOGIN:".badge-overlay-signin",OVERLAY_COMPONENT_SIGNUP_FB:".badge-overlay-signup-fb",OVERLAY_COMPONENT_SIGNUP_EMAIL:".badge-overlay-signup-email"},init:function(){this.bindOverlayCloseButtons()},handlers:{closeButtonClickedHandler:function(b){this.hideOverlay(a(b.currentTarget).closest(this.selectors.OVERLAY_COMPONENT)),b.preventDefault()},overlayBackgroundClickedHandler:function(){this._hideUsingBackground&&this.hideAllOverlay()},overlayComponentClickedHandler:function(a){a.stopPropagation()}},setHideUsingBackground:function(a){this._hideUsingBackground=a!==!1},showOverlay:function(b){this.hideAllOverlay(),this._isShown=!0,a(this.selectors.OVERLAY).removeClass("hide"),a("body").addClass("no-scroll"),"undefined"!=typeof b&&a(b).removeClass("hide")},hideOverlay:function(b){this._isShown=!1,a(this.selectors.OVERLAY).addClass("hide"),a("body").removeClass("no-scroll"),"undefined"!=typeof b&&a(b).addClass("hide"),GAG.PageController.resetCustomize()},hideAllOverlay:function(){this.hideOverlay(a(this.selectors.OVERLAY).children())},bindOverlayCloseButtons:function(){a(this.selectors.OVERLAY).find(this.selectors.OVERLAY_CLOSE_BUTTON).click(a.proxy(this.handlers.closeButtonClickedHandler,this)),a(this.selectors.OVERLAY).click(a.proxy(this.handlers.overlayBackgroundClickedHandler,this)),a(this.selectors.OVERLAY).find(this.selectors.OVERLAY_COMPONENT).click(a.proxy(this.handlers.overlayComponentClickedHandler,this))},isInsideOverlay:function(b){return a(b).is(this.selectors.OVERLAY+" *")}}),GAG.KeyboardController=a.extend({},new GAG.Controller,function(){var b={JUMP_PREV:"JUMP_PREV",JUMP_NEXT:"JUMP_NEXT",VOTE_UP:"VOTE_UP",VOTE_DOWN:"VOTE_DOWN",UNVOTE:"UNVOTE",JUMP_COMMENT:"JUMP_COMMENT",LEFT_ARROW:37,RIGHT_ARROW:39,KEY_END:35,KEY_HOME:36,_track:function(a){GAG.GA.track("keyboard",a,GAG.Page.getPageKey())},_bindHomeEnd:function(){a(document).keydown(function(c){if(GAG.Utils.isCurrentlyFocusedInTypeable())return!0;if(c.keyCode==b.KEY_HOME||c.keyCode==b.KEY_END){c.preventDefault();var d=GAG.PostController;return a("html,body").animate({scrollTop:c.keyCode==b.KEY_END?a(document).height():0},100,"swing",function(){GAG.ListController.handlers.recalculateInViewEntries(),a(d.selectors.ENTRY_CONTAINER+" "+d.selectors.ENTRY_STICKY_ELEMENTS).each(function(){a(this).css({position:"","z-index":"",top:""}),a(this).removeClass(d.CLASS_STICKY)}),GAG.PostController.handlers.entryStickElementHandler(),GAG.ListScrollingController.handlers.scanFeaturedItemForArchive()}),!1}})},_bindJumpPrev:function(c){b.bindAction(c,function(){b._track("prev"),GAG.Page.isPostPage()?GAG.PostController.prevEntry():b.jump(b.JUMP_PREV)}),GAG.Page.isPostPage()&&a(document).keydown(function(a){return GAG.Utils.isCurrentlyFocusedInTypeable()?!0:a.keyCode==b.LEFT_ARROW?(GAG.PostController.prevEntry(),!1):void 0})},_bindJumpNext:function(c){b.bindAction(c,function(){b._track("next"),GAG.Page.isPostPage()?(GAG.GA.track("Next-Post-Toolbar-keyboard","PostClicked",1),GAG.PostController.nextEntry()):b.jump(b.JUMP_NEXT)}),GAG.Page.isPostPage()&&a(document).keydown(function(a){return GAG.Utils.isCurrentlyFocusedInTypeable()?!0:a.keyCode==b.RIGHT_ARROW?(GAG.PostController.nextEntry(),!1):void 0})},_bindPostVoteUp:function(c){b.bindAction(c,function(){b._track("upvote");var c=GAG.PostController,d=GAG.Page.isPostPage()?a(c.selectors.ENTRY_CONTAINER):GAG.ListController.findCurrentlyInFocusEntry();c.upvoteEntry(d)})},_bindPostVoteDown:function(c){b.bindAction(c,function(){b._track("downvote");var c=GAG.PostController,d=GAG.Page.isPostPage()?a(c.selectors.ENTRY_CONTAINER):GAG.ListController.findCurrentlyInFocusEntry();c.downvoteEntry(d)})},_bindPostComment:function(a){b.bindAction(a,function(){b._track("comment"),GAG.PostController.commentEntry(GAG.ListController.findCurrentlyInFocusEntry())})},_bindScrollToTop:function(a){b.bindAction(a,function(){b._track("back-to-top"),b.scrollToTop()})},_bindRandomEntry:function(a){b.bindAction(a,function(){b._track("random"),b.randomEntry()})},_bindPostPlay:function(c){b.bindAction(c,function(){b._track("play");var c=GAG.Page.isPostPage()?a(GAG.PostController.selectors.ENTRY_CONTAINER):GAG.ListController.findCurrentlyInFocusEntry();GAG.PostController.playEntry(c)})},_bindElements:function(){b._bindScrollToTop("b"),b._bindJumpPrev("k"),b._bindJumpNext("j"),b._bindRandomEntry("r"),b._bindPostVoteUp("l"),b._bindPostVoteDown("h"),b._bindPostComment("c"),b._bindPostPlay("p"),b._bindHomeEnd()},_getKeyOptions:function(){return{type:"keypress",propagate:!1,target:document,disable_in_input:!0}},bindAction:function(a,c){shortcut.add(a,c,b._getKeyOptions())},jump:function(a){a==b.JUMP_PREV?GAG.ListController.scrollToPrevEntry():GAG.ListController.scrollToNextEntry()},scrollToTop:function(){GAG.PageController.scrollToTop()},randomEntry:function(){GAG.Page.load("http://"+GAG.Page.getDomain()+"/random")}};return{init:function(){b._bindElements()},jump:b.jump,bindAction:b.bindAction,scrollToTop:b.scrollToTop,randomEntry:b.randomEntry}}()),GAG.AccountController=a.extend({},new GAG.Controller,{init:function(){this.bindElements()},selectors:{HEADER_LOGIN_BUTTON:".badge-login-button",HEADER_SIGNUP_BUTTON:".badge-signup-button",LOGIN_FORM_NEXT_URL:"#jsid-login-form-next-url",LOGIN_FACEBOOK_CONNECT_BUTTON:".badge-facebook-connect",LOGIN_GPLUS_CONNECT_BUTTON:".badge-gplus-connect",SIGNUP_FB:"#signup-fb",SIGNUP_EMAIL:"#signup-email",SIGNUP_EMAIL_LINK:".badge-signup-email-link",SIGNUP_LOGIN_LINK:".badge-signup-login-link",SIGNUP_FORM_NEXT_URL:".badge-signup-form-next-url",DELETE_CONFIRM_FORM:".badge-delete-confirm-form",SHOW_DELETE_FORM_BTN:"#jsid-show-form-btn",RESET_SUBMIT_BTN:".badge-reset-submit",RESET_SUBMIT_FROM:"#jsid-form-reset",RESET_NEW_PWD:"#jsid-reset-new-pwd",RESET_RETYPE_NEW_PWD:"#jsid-reset-retype-new-pwd"},bindElements:function(){this.bindSignupElements(),this.bindLoginElements(),this.bindDeleteConfirmElements(),this.bindFacebookConnectElements(),this.bindGplusConnectElements(),this.bindResetForm(),this.bindSignupPageElements()},bindSignupPageElements:function(){GAG.Page.isSignupPage()&&GAG.PageController.showCaptcha("signup")},bindSignupElements:function(){var b=this;a(this.selectors.HEADER_SIGNUP_BUTTON).on("click",a.proxy(function(a){a.preventDefault(),this.presentSignupForm()},this)),a(this.selectors.SIGNUP_EMAIL_LINK).click(a.proxy(function(a){a.preventDefault(),this.switchToEmailSignup()},this)),a(this.selectors.SIGNUP_LOGIN_LINK).each(function(){GAG.OverlayController.isInsideOverlay(a(this))&&a(this).click(a.proxy(function(b){b.preventDefault(),this.presentLoginForm(a(this.selectors.SIGNUP_FORM_NEXT_URL).val())},b))}),a(this.selectors.SIGNUP_EMAIL).on("submit",a.proxy(function(b){a(".badge-input-tzo").val(this._getTimezoneOffset());var c=!0;try{if(Recaptcha){var d=Recaptcha.get_challenge(),e=Recaptcha.get_response();a("#jsid-signup-recaptcha_challenge").val(d),a("#jsid-signup-recaptcha_response").val(e)}}catch(f){}return c?void 0:(b.preventDefault(),!1)},this))},bindLoginElements:function(){a(this.selectors.HEADER_LOGIN_BUTTON).on("click",a.proxy(function(a){a.preventDefault(),this.presentLoginForm()},this))},bindDeleteConfirmElements:function(){a(this.selectors.SHOW_DELETE_FORM_BTN).on("click",a.proxy(function(){a(this.selectors.DELETE_CONFIRM_FORM).removeClass("hide")},this))},bindFacebookConnectElements:function(){a(this.selectors.LOGIN_FACEBOOK_CONNECT_BUTTON).on("click",a.proxy(function(b){b.preventDefault();var c=a(this.selectors.LOGIN_FORM_NEXT_URL).val(),d={a:!1,d:!1,lo:!1,dl:!1},e=JSON.stringify(d);a.cookie("auto_log",e,{path:"/"}),GAG.Facebook.Connect.connect(c)},this))},bindGplusConnectElements:function(){},bindResetForm:function(){a(this.selectors.RESET_SUBMIT_FROM).submit(a.proxy(function(){return this.validateReset()?!0:!1},this))},validateReset:function(){var b=a(this.selectors.RESET_NEW_PWD).val(),c=a(this.selectors.RESET_RETYPE_NEW_PWD).val();if(b!=c)return a(".badge-error-message").text("Your new password doesn't seem to be matching.").removeClass("hide"),!1;var d=GAG.Validator.isValidPassword(b,6,30);return d?a(".badge-error-message").text("").addClass("hide"):a(".badge-error-message").text("Invalid password.").removeClass("hide"),d},_getTimezoneOffset:function(){return(new Date).getTimezoneOffset()/-60},presentLoginForm:function(b){GAG.GA.track("login-signup","shown","login-form"),GAG.OverlayController.showOverlay(GAG.OverlayController.selectors.OVERLAY_COMPONENT_LOGIN),a("#jsid-login-email-name").focus(),"undefined"!=typeof b?(a(this.selectors.LOGIN_FORM_NEXT_URL).val(b),a(this.selectors.SIGNUP_FORM_NEXT_URL).val(b)):(a(this.selectors.LOGIN_FORM_NEXT_URL).val(location.href),a(this.selectors.SIGNUP_FORM_NEXT_URL).val(location.href))},presentSignupForm:function(b){GAG.PageController.preloadCaptchaScript(),GAG.GA.track("login-signup","shown","signup-form"),GAG.OverlayController.showOverlay(GAG.OverlayController.selectors.OVERLAY_COMPONENT_SIGNUP_FB),"undefined"!=typeof b?(a(this.selectors.LOGIN_FORM_NEXT_URL).val(b),a(this.selectors.SIGNUP_FORM_NEXT_URL).val(b)):(a(this.selectors.LOGIN_FORM_NEXT_URL).val(location.href),a(this.selectors.SIGNUP_FORM_NEXT_URL).val(location.href)),this.switchToFacebookSignup()},switchToEmailSignup:function(){GAG.GA.track("login-signup","shown","email-signup-form"),GAG.PageController.showCaptcha("signup"),a(this.selectors.SIGNUP_FB).addClass("hide"),a(this.selectors.SIGNUP_EMAIL).removeClass("hide")},switchToFacebookSignup:function(){a(this.selectors.SIGNUP_EMAIL).addClass("hide"),a(this.selectors.SIGNUP_FB).removeClass("hide")},setSafeMode:function(c,d){if("undefined"==typeof d&&(d=""),GAG.User.isLoggedIn()){var e=GAG.Page.getCookieOptions();e.domain=GAG.Configs.get("page.cookie_domain"),a.cookie(GAG.PageController._safeModeCookieKey,c,e)}var f="/profile/safe-browse?enable="+c+"&url="+encodeURIComponent(d);b.location=f}}),GAG.UploadController=a.extend({},new GAG.Controller,{TITLE_LENGTH_WARNING_THRESHOLD:20,_sectionsCountMax:0,init:function(){this._bindElements(),this._sectionsCountMax=a("#jsid-section-list").data("sections-count-max")},selectors:{UPLOAD_URL_BTN:"#jsid-upload-url-btn",UPLOAD_FILE_BTN:"#jsid-upload-file-btn",UPLOAD_URL_INPUT:"#jsid-upload-url-input",UPLOAD_FILE_INPUT:"#jsid-upload-file-input",UPLOAD_CHAR_COUNT:"#jsid-char-count",UPLOAD_TITLE_INPUT:"#jsid-upload-title",UPLOAD_SOURCE_CHECKBOX:"#jsid-source-checkbox",UPLOAD_SOURCE_CHECKBOX_LABEL:"#jsid-source-checkbox-label",UPLOAD_SOURCE_INPUT:"#jsid-source-input",UPLOAD_SUBMIT_BTN:"#jsid-submit-btn",UPLOAD_DISABLE_MASK:"#jsid-disable-mask",UPLOAD_CONTENT_ERROR_LABEL:"#jsid-upload-content-error",UPLOAD_TITLE_ERROR_LABEL:"#jsid-upload-title-error",UPLOAD_ERROR_LABEL:"#jsid-upload-error",UPLOAD_SECTION_ERROR_LABEL:"#jsid-upload-section-error",UPLOAD_SECTION:"badge-upload-section",SECTION_LIST:"#jsid-section-list"},css:{METHOD_SELECTED:"upload-selected",TITLE_WARNING:"warn"},_resetElement:function(a){a.wrap("<form>").closest("form").get(0).reset(),a.unwrap()},_resetStyle:function(){a("."+this.selectors.UPLOAD_SECTION).parent().removeClass("selected")},_selectFileInput:function(){GAG.Configs.get("user.showCaptcha")?GAG.PageController.showCaptcha("upload"):a("#jsid-upload-recaptcha_skip").attr("value","yes"),a(this.selectors.UPLOAD_URL_INPUT).addClass("hide").val(""),a(this.selectors.UPLOAD_FILE_INPUT).removeClass("hide"),this._resetStyle(),a(this.selectors.UPLOAD_URL_BTN).removeClass(this.css.METHOD_SELECTED),a(this.selectors.UPLOAD_FILE_BTN).addClass(this.css.METHOD_SELECTED)},_selectUrlInput:function(){GAG.Configs.get("user.showCaptcha")?GAG.PageController.showCaptcha("upload"):a("#jsid-upload-recaptcha_skip").attr("value","yes");var b=a(this.selectors.UPLOAD_FILE_INPUT).addClass("hide");this._resetElement(b),this._resetStyle(),a(this.selectors.UPLOAD_URL_INPUT).removeClass("hide"),a(this.selectors.UPLOAD_FILE_BTN).removeClass(this.css.METHOD_SELECTED),a(this.selectors.UPLOAD_URL_BTN).addClass(this.css.METHOD_SELECTED)},verifyCaptcha:function(){try{if(Recaptcha){var b=Recaptcha.get_challenge(),c=Recaptcha.get_response();a("#jsid-upload-recaptcha_challenge").val(b),a("#jsid-upload-recaptcha_response").val(c)}}catch(d){}},_setCharCount:function(b){var c=a(b.currentTarget),d=parseInt(c.data("maxlength"),10),e=c.val().length,f=d-e,g=a(this.selectors.UPLOAD_CHAR_COUNT).text(f);f<=this.TITLE_LENGTH_WARNING_THRESHOLD?g.addClass(this.css.TITLE_WARNING):g.removeClass(this.css.TITLE_WARNING)},_updateSourceFields:function(){var b=a(this.selectors.UPLOAD_SOURCE_CHECKBOX),c=a(this.selectors.UPLOAD_SOURCE_INPUT);b.is(":checked")?c.removeClass("hide"):c.addClass("hide")},_updateSections:function(b){var c=GAG.UploadController,d=jQuery(c.selectors.SECTION_LIST+" input:checked").length;if(d<=c._sectionsCountMax){var e=a(this);e.is(":checked")?e.parent().addClass("selected"):e.parent().removeClass("selected")}else b.preventDefault()},_getContentError:function(){var b=a(this.selectors.UPLOAD_URL_INPUT).val(),c=a(this.selectors.UPLOAD_FILE_INPUT+" input").val();return b||c?void 0:"Please select a file or paste an image URL."},_getTitleError:function(){var b=a(this.selectors.UPLOAD_TITLE_INPUT).val(),c=6,d=a(this.selectors.UPLOAD_TITLE_INPUT).data("maxlength");return!b||b.length<c?"Your title doesn't look funny enough. Be creative!":b.length>d?"Your title is a bit long. Be concise!":void 0},_isValidImageUrl:function(a){var b=/^http(s?):\/\//i;return a.toLowerCase().match(b)},_isValidImageExtension:function(a){a+="";var b=a.split(".").pop(),c=/(jpeg|jpg|gif|png)/i;return b.match(c)},initialize:function(){GAG.Page.isUploadPage()&&(GAG.Configs.get("user.showCaptcha")?GAG.PageController.showCaptcha("upload"):a("#jsid-upload-recaptcha_skip").attr("value","yes"))},validateForm:function(){var b=this._getContentError(),c=this._getTitleError(),d=!0,e=a(this.selectors.UPLOAD_CONTENT_ERROR_LABEL),f=a(this.selectors.UPLOAD_TITLE_ERROR_LABEL);b?(e.removeClass("hide").text(b),d=!1):e.addClass("hide").text(""),c?(f.removeClass("hide").text(c),d=!1):f.addClass("hide").text(""),a(this.selectors.UPLOAD_ERROR_LABEL).addClass("hide").text("");a("."+this.selectors.UPLOAD_SECTION+":checked:enabled"),a(this.selectors.UPLOAD_SECTION_ERROR_LABEL);if(d){var g={className:"upload-spinner",top:"200px",left:"205px"};GAG.PageController.loadSpinner("spinner-here",g),a(this.selectors.UPLOAD_SUBMIT_BTN).val("Uploading..."),a(this.selectors.UPLOAD_DISABLE_MASK).addClass("disabled"),a(GAG.OverlayController.selectors.OVERLAY).unbind("click"),this.verifyCaptcha()}return d},_pad:function(a,b){return void 0==b&&(b="0"),10>a?b+""+a:a},_convertTime:function(a){var b=0,c=0,d=0,e=0;0>a&&(a=0),b=parseInt(a/86400),a-=86400*b,c=parseInt(a/3600),a-=3600*c,d=parseInt(a/60),a-=60*d,e=a;var f="";return b>0&&(f+=this._pad(b)+":"),f+=this._pad(c)+":",f+=this._pad(d)+":",f+=this._pad(e)},_updateDisplay:function(a){var b=a.data("timestamp"),c=Math.round((new Date).getTime()/1e3),d=a.data("start");null==d&&(d=c,a.data("start",d));var e=c-d;a.text(this._convertTime(b-e))},_updateAll:function(){a(".badge-countdown").each(function(){GAG.UploadController._updateDisplay(a(this))})},_bindElements:function(){var b=a(".badge-countdown");b.length>0&&(GAG.UploadController._updateAll(),setInterval("GAG.UploadController._updateAll();",1e3)),a(this.selectors.UPLOAD_URL_BTN).on("click",a.proxy(function(a){a.preventDefault(),this._selectUrlInput()},this)),a(this.selectors.UPLOAD_FILE_BTN).on("click",a.proxy(function(a){a.preventDefault(),this._selectFileInput()},this)),a(this.selectors.UPLOAD_TITLE_INPUT).on("keydown",a.proxy(function(b){setTimeout(a.proxy(this._setCharCount,this,b),50)},this)),a(this.selectors.UPLOAD_SOURCE_CHECKBOX).on("change",a.proxy(this._updateSourceFields,this)),a("."+this.selectors.UPLOAD_SECTION).on("click",this._updateSections)}}),GAG.CacheableVoteController=a.extend({},new GAG.Controller,{selectors:{ENTRY:"article[data-entry-id]"},handler:null,remoteHandler:null,init:function(a){this.handler=GAG.CacheableVote,this.remoteHandler=a},process:function(){var a=this.handler.get();a&&(GAG.CacheableAbstract.log("found cache. update ui"),this.updateUI(a)),a||(GAG.CacheableAbstract.log("empty cache. try to retrieve from server"),this.remoteHandler.addToQueue(this.handler.formatRemoteParams(),this.responseCallback))},responseCallback:function(b){if(void 0!=b.vote){var c=GAG.CacheableVote.getFromCache();null==c&&(c={}),a.each(b.vote,function(a,b){c[a]=parseInt(b)}),GAG.CacheableVote.updateCache(c),GAG.CacheableVoteController.updateUI(b.vote)}},updateUI:function(b){a(GAG.CacheableVoteController.selectors.ENTRY).each(function(c,d){var e=a(d).data("entry-id");if(void 0!=b[e]){var f=parseInt(b[e]);f>0?GAG.PostController.handlers.likeHandler(e):0>f?GAG.PostController.handlers.dislikeHandler(e):GAG.PostController.handlers.unlikeHandler(e)}})}}),GAG.CacheableUserController=a.extend({},new GAG.Controller,{selectors:{},handler:null,remoteHandler:null,_unverifiedCookieKey:"unverified",init:function(a){this.handler=GAG.CacheableUser,this.remoteHandler=a},process:function(){var a=this.handler.get();a&&(GAG.CacheableAbstract.log("found cache cachedUser. update ui"),this.updateUI(a)),a||(GAG.CacheableAbstract.log("empty cache cachedUser. try to retrieve from server"),this.remoteHandler.addToQueue(this.handler.formatRemoteParams(),this.responseCallback))},responseCallback:function(b){if(void 0!=b.user){var c=GAG.CacheableUser.getFromCache();null==c&&(c={}),a.each(b.user,function(a,b){c[a]=b}),GAG.CacheableUser.updateCache(c),GAG.CacheableUserController.updateUI(b)}else GAG.PageController.initUserFunction()},updateUI:function(b){if(b.user)var c=b.user;else var c=b;var d=c.username,e=c.userId,f=c.avatar,g=c.webPush,h=c.notiOptions,i=c.chatNotiOptions,j=c.commentSso;if(GAG.Configs._configs.user.username=d,GAG.Configs._configs.user.id=e,GAG.Configs._configs.user.avatar=f,GAG.Configs._configs.configs.web_push.key=g,GAG.Configs._configs.user.noti=h,GAG.Configs._configs.user.chat_noti=i,GAG.Configs._configs.user.comment_auth=j,GAG.User.init(),GAG.PageController.initUserFunction(),1==a.cookie(GAG.CacheableUserController._unverifiedCookieKey)&&GAG.PageController.showConfirmEmailBanner(GAG.Configs._configs.user.username),d&&document.getElementById("jsid-my-profile")){var k=document.getElementById("jsid-my-profile");k.href="/u/"+d}if(f&&document.getElementById("jsid-avatar")){var l=document.getElementById("jsid-avatar");l.src=f}}}),GAG.CacheableUserPreferenceController=a.extend({},new GAG.Controller,{selectors:{},handler:null,remoteHandler:null,init:function(a){this.handler=GAG.CacheableUserPreference,this.remoteHandler=a},process:function(){var a=this.handler.get();a||this.remoteHandler.addToQueue(this.handler.formatRemoteParams(),this.responseCallback)},responseCallback:function(a){void 0!=a["user-preference"]&&(preference=a["user-preference"],GAG.CacheableUserPreferenceController._updateCookies(preference),GAG.CacheableUserPreferenceController._updateUI(),GAG.CacheableUserPreference.updateCache(preference))},_updateCookies:function(b){var c=GAG.Page.getCookieOptions();c.domain=GAG.Configs.get("page.cookie_domain"),void 0!==b.isAutoAnimatedGifOn&&a.cookie(GAG.PageController._autoAnimatedGifCookieKey,b.isAutoAnimatedGifOn?"1":"0",c),void 0!==b.isSafeModeOn&&a.cookie(GAG.PageController._safeModeCookieKey,b.isSafeModeOn?"1":"0",c)},_updateUI:function(){GAG.PageController.setCustomizeElementValues()}}),GAG.CacheableUserUploadController=a.extend({},new GAG.Controller,{selectors:{DELETE_SEPARATOR:".badge-item-delete-dot",DELETE_LINK:".badge-item-delete",REPORT_SEPARATOR:".badge-item-report-dot",REPORT_LINK:".badge-item-report",ARTICLE:"#individual-post article"},handler:null,remoteHandler:null,init:function(a){this.handler=GAG.CacheableUserUpload,this.remoteHandler=a},process:function(){if("post"==GAG.Configs.get("page.page_key")){var b=this.handler.get(),c=a.cookie(GAG.CacheableController.lastUploadCookieKey);b&&(GAG.CacheableAbstract.log("found cacheUserUpload. update ui"),null!=c&&-1==b.indexOf(c)&&(b.push(c),GAG.CacheableUserUpload.updateCache(b)),this.updateUI(b)),b||(GAG.CacheableAbstract.log("empty cacheUserUpload. try to retrieve from server"),this.remoteHandler.addToQueue(this.handler.formatRemoteParams(),this.responseCallback)),null!=c&&a.cookie(GAG.CacheableController.lastUploadCookieKey,"",{domain:GAG.Configs.get("page.cookie_domain"),expires:-1,path:"/"})}},responseCallback:function(a){void 0!=a["user-upload"]&&(GAG.CacheableUserUpload.updateCache(a["user-upload"]),GAG.CacheableUserUploadController.updateUI(a["user-upload"]))},updateUI:function(b){var c=this,d=a(c.selectors.ARTICLE).data("entry-id");-1!=b.indexOf(d)&&(a(c.selectors.DELETE_SEPARATOR).removeClass("hide"),a(c.selectors.DELETE_LINK).removeClass("hide"),a(c.selectors.REPORT_SEPARATOR).addClass("hide"),a(c.selectors.REPORT_LINK).addClass("hide"))}}),GAG.CacheableUserQuotaController=a.extend({},new GAG.Controller,{handler:null,remoteHandler:null,init:function(a){this.handler=GAG.CacheableUserQuota,this.remoteHandler=a},process:function(){var a=this.handler.get();a?(GAG.Configs._configs.user.showCaptcha=a.restricted!==!1,this.updateUI()):(GAG.CacheableAbstract.log("empty cacheUserQuota. try to retrieve from server"),this.remoteHandler.addToQueue(this.handler.formatRemoteParams(),this.responseCallback))},responseCallback:function(a){void 0!=a["user-quota"]&&(GAG.CacheableUserQuota.updateCache(a["user-quota"]),GAG.Configs._configs.user.showCaptcha=a["user-quota"].restricted!==!1,GAG.CacheableUserQuotaController.updateUI())},updateUI:function(){GAG.UploadController.initialize()}}),GAG.CacheableController=a.extend({},new GAG.Controller,{cacheableControllers:[GAG.CacheableVoteController,GAG.CacheableUserController,GAG.CacheableUserPreferenceController,GAG.CacheableUserUploadController,GAG.CacheableUserQuotaController],clearCookieKey:"cacheableClear",lastUploadCookieKey:"cacheableLastUpload",remoteHandler:null,selectors:{BTN_LOGOUT:".badge-logout-btn"},init:function(){this.remoteHandler=GAG.CacheableRemoteHandler;var b=this;a.each(this.cacheableControllers,function(a,c){c.init(b.remoteHandler)});var c=a.cookie(this.clearCookieKey);return c&&(this.clearAllCache(),GAG.CacheableController.isHttps()||a.cookie(this.clearCookieKey,0,{domain:GAG.Configs.get("page.cookie_domain"),expires:-1,path:"/"})),!GAG.CacheableRemoteHandler.issetPhpSessionId()||GAG.CacheableRemoteHandler.isInGracePeriod()?(GAG.CacheableRemoteHandler.issetPhpSessionId()||GAG.CacheableAbstract.log("GAG.CacheableRemoteHandler php session id is not set. Bye!!"),GAG.CacheableRemoteHandler.isInGracePeriod()&&GAG.CacheableAbstract.log("GAG.CacheableRemoteHandler is in grace period. Bye!!"),void GAG.PageController.initUserFunction()):(GAG.CacheableAbstract.log("calling cacheable"),this.bindDomReady(),void this.bindLogoutBtn())},clearAllCache:function(){GAG.CacheableAbstract.log("GAG.CacheableController clear all cache"),a.each(GAG.CacheableController.cacheableControllers,function(a,b){b.handler.clearCache()}),GAG.PageController.initUserFunction()},bindDomReady:function(){var b=this;a(function(){a.each(b.cacheableControllers,function(a,b){b.process()}),b.remoteHandler.processQueue()})},bindLogoutBtn:function(){var b=this;a(this.selectors.BTN_LOGOUT).on("click",function(){b.clearAllCache()})},isHttps:function(){return"https:"==location.protocol}}),GAG.NotificationsScrollingController=a.extend({},new GAG.Controller,{_isLoading:!1,_bottomReached:!1,_loadCount:0,selectors:{NOTIFICATION_LIST:".badge-notification-list",END_OF_LIST:".badge-notification-eol",NEXT_KEY:".badge-notification-nextKey",LOADER:".badge-notification-loader"},init:function(){var b=a(this.selectors.NOTIFICATION_LIST);0!=b.length&&this.bindElements()},bindElements:function(){this.bindScrollEvents()},bindScrollEvents:function(){a(b).scroll(a.proxy(this.handlers.windowScrollHandler,this))},loadMorePosts:function(){if(!this._isLoading&&!this._bottomReached){GAG.GA.track("Notification-Page","load-more","count",++this._loadCount);var b=this,c=a(b.selectors.NOTIFICATION_LIST).find(b.selectors.NEXT_KEY).last().text();a(b.selectors.NOTIFICATION_LIST).find(b.selectors.LOADER).removeClass("hide"),this._isLoading=!0,a.ajax({url:"/notification/load-more",data:{refKey:c},dataType:"html",success:function(c){if(b._isLoading=!1,c){a(b.selectors.NOTIFICATION_LIST).find("ul").find(b.selectors.LOADER).before(c);var d=a(b.selectors.NOTIFICATION_LIST).find(b.selectors.END_OF_LIST);d.length>0&&(b._bottomReached=!0,GAG.GA.track("Notification-Page","end-of-list"))}else b._bottomReached=!0,GAG.GA.track("Notification-Page","blank")},error:function(){b._isLoading=!1,b._bottomReached=!0,GAG.GA.track("Notification-Page","error")},complete:function(){a(b.selectors.NOTIFICATION_LIST).find(b.selectors.LOADER).addClass("hide")}})}},handlers:{windowScrollHandler:function(){a.proxy(this.handlers.loadMoreScrollHandler,this)()},loadMoreScrollHandler:function(){var c=a(b).height();a(b).scrollTop()+c>=a(this.selectors.NOTIFICATION_LIST).height()&&this.loadMorePosts()}}}),GAG.App=function(){var c={_data:{},_models:[],_controllers:[],init:function(){var d=c;a(document).ready(function(){d._onDomReady()}),a(b).on("load",function(){d._onWindowLoad()}),a(b).on("scroll",function(){d._runOnControllers("onScroll")}),a(b).on("resize",function(){d._runOnControllers("onResize")})},_onDomReady:function(){c._runOnModels("init"),c._runOnControllers("init")},_onWindowLoad:function(){c._runOnModels("onWindowLoad"),c._runOnControllers("onWindowLoad")},_runOnObjects:function(a,b){if(!(!a instanceof Array))for(var c=0;c<a.length;c++)a[c][b]&&"function"==typeof a[c][b]&&a[c][b]()},_runOnModels:function(a){c._runOnObjects(c._models,a)},_runOnControllers:function(a){c._runOnObjects(c._controllers,a)},addModel:function(a){if(a instanceof Array)for(var b=0;b<a.length;b++)c._models.push(a[b]);else c._models.push(a);return this},addController:function(a){if(a instanceof Array)for(var b=0;b<a.length;b++)c._controllers.push(a[b]);else c._controllers.push(a);return this},setData:function(a,b){c._data[a]=b},_scriptMap:{facebook:"//connect.facebook.net/en_US/sdk.js",twitter:"//platform.twitter.com/widgets.js","client:plusone":"https://apis.google.com/js/client:plusone.js?onload=gplusRender",ga:("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js"},_loadAsyncScript:function(a){!function(){var b=document.createElement("script");b.type="text/javascript",b.async=!0,b.src=a,b.async=!0;var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}()},loadAsynScripts:function(a){for(var b=0;b<a.length;b++)c._scriptMap[a[b]]&&c._loadAsyncScript(c._scriptMap[a[b]])},loadConfigs:function(a){return GAG.Configs.load(a),this}};return{init:c.init,loadConfigs:c.loadConfigs,loadAsynScripts:c.loadAsynScripts,addModel:c.addModel,addController:c.addController}}();var c=[GAG.CacheFactory,GAG.User,GAG.Vote,GAG.Configs,GAG.Page,GAG.Facebook,GAG.GPlus,GAG.Track,GAG.Toast],d=[GAG.CacheableController,GAG.CacheController,GAG.AdsController,GAG.ProfileSettingController,GAG.ProfileController,GAG.ListController,GAG.OverlayController,GAG.FacebookController,GAG.GPlusController,GAG.ShareController,GAG.PostController,GAG.PageController,GAG.KeyboardController,GAG.HeadbarController,GAG.AccountController,GAG.ListScrollingController,GAG.FeaturedController,GAG.UploadController,GAG.PushController,GAG.WebNotiController,GAG.NotificationsScrollingController];GAG.App.addModel(c).addController(d).init()}(jQuery,window),window.Modernizr=function(a,b,c){function d(a){t.cssText=a}function e(a,b){return d(x.join(a+";")+(b||""))}function f(a,b){return typeof a===b}function g(a,b){return!!~(""+a).indexOf(b)}function h(a,b){for(var d in a){var e=a[d];if(!g(e,"-")&&t[e]!==c)return"pfx"==b?e:!0}return!1}function i(a,b,d){for(var e in a){var g=b[a[e]];if(g!==c)return d===!1?a[e]:f(g,"function")?g.bind(d||b):g}return!1}function j(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+z.join(d+" ")+d).split(" ");return f(b,"string")||f(b,"undefined")?h(e,b):(e=(a+" "+A.join(d+" ")+d).split(" "),i(e,b,c))}function k(){o.input=function(c){for(var d=0,e=c.length;e>d;d++)E[c[d]]=c[d]in u;return E.list&&(E.list=!!b.createElement("datalist")&&!!a.HTMLDataListElement),E}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),o.inputtypes=function(a){for(var d,e,f,g=0,h=a.length;h>g;g++)u.setAttribute("type",e=a[g]),d="text"!==u.type,d&&(u.value=v,u.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(e)&&u.style.WebkitAppearance!==c?(q.appendChild(u),f=b.defaultView,d=f.getComputedStyle&&"textfield"!==f.getComputedStyle(u,null).WebkitAppearance&&0!==u.offsetHeight,q.removeChild(u)):/^(search|tel)$/.test(e)||(d=/^(url|email)$/.test(e)?u.checkValidity&&u.checkValidity()===!1:u.value!=v)),D[a[g]]=!!d;return D}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var l,m,n="2.6.2",o={},p=!0,q=b.documentElement,r="modernizr",s=b.createElement(r),t=s.style,u=b.createElement("input"),v=":)",w={}.toString,x=" -webkit- -moz- -o- -ms- ".split(" "),y="Webkit Moz O ms",z=y.split(" "),A=y.toLowerCase().split(" "),B={svg:"http://www.w3.org/2000/svg"},C={},D={},E={},F=[],G=F.slice,H=function(a,c,d,e){var f,g,h,i,j=b.createElement("div"),k=b.body,l=k||b.createElement("body");
if(parseInt(d,10))for(;d--;)h=b.createElement("div"),h.id=e?e[d]:r+(d+1),j.appendChild(h);return f=["&#173;",'<style id="s',r,'">',a,"</style>"].join(""),j.id=r,(k?j:l).innerHTML+=f,l.appendChild(j),k||(l.style.background="",l.style.overflow="hidden",i=q.style.overflow,q.style.overflow="hidden",q.appendChild(l)),g=c(j,a),k?j.parentNode.removeChild(j):(l.parentNode.removeChild(l),q.style.overflow=i),!!g},I=function(){function a(a,e){e=e||b.createElement(d[a]||"div"),a="on"+a;var g=a in e;return g||(e.setAttribute||(e=b.createElement("div")),e.setAttribute&&e.removeAttribute&&(e.setAttribute(a,""),g=f(e[a],"function"),f(e[a],"undefined")||(e[a]=c),e.removeAttribute(a))),e=null,g}var d={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return a}(),J={}.hasOwnProperty;m=f(J,"undefined")||f(J.call,"undefined")?function(a,b){return b in a&&f(a.constructor.prototype[b],"undefined")}:function(a,b){return J.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var c=G.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(G.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(G.call(arguments)))};return d}),C.flexbox=function(){return j("flexWrap")},C.canvas=function(){var a=b.createElement("canvas");return!!a.getContext&&!!a.getContext("2d")},C.canvastext=function(){return!!o.canvas&&!!f(b.createElement("canvas").getContext("2d").fillText,"function")},C.webgl=function(){return!!a.WebGLRenderingContext},C.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:H(["@media (",x.join("touch-enabled),("),r,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=9===a.offsetTop}),c},C.geolocation=function(){return"geolocation"in navigator},C.postmessage=function(){return!!a.postMessage},C.websqldatabase=function(){return!!a.openDatabase},C.indexedDB=function(){return!!j("indexedDB",a)},C.hashchange=function(){return I("hashchange",a)&&(b.documentMode===c||b.documentMode>7)},C.history=function(){return!!a.history&&!!history.pushState},C.draganddrop=function(){var a=b.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a},C.websockets=function(){return"WebSocket"in a||"MozWebSocket"in a},C.rgba=function(){return d("background-color:rgba(150,255,150,.5)"),g(t.backgroundColor,"rgba")},C.hsla=function(){return d("background-color:hsla(120,40%,100%,.5)"),g(t.backgroundColor,"rgba")||g(t.backgroundColor,"hsla")},C.multiplebgs=function(){return d("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(t.background)},C.backgroundsize=function(){return j("backgroundSize")},C.borderimage=function(){return j("borderImage")},C.borderradius=function(){return j("borderRadius")},C.boxshadow=function(){return j("boxShadow")},C.textshadow=function(){return""===b.createElement("div").style.textShadow},C.opacity=function(){return e("opacity:.55"),/^0.55$/.test(t.opacity)},C.cssanimations=function(){return j("animationName")},C.csscolumns=function(){return j("columnCount")},C.cssgradients=function(){var a="background-image:",b="gradient(linear,left top,right bottom,from(#9f9),to(white));",c="linear-gradient(left top,#9f9, white);";return d((a+"-webkit- ".split(" ").join(b+a)+x.join(c+a)).slice(0,-a.length)),g(t.backgroundImage,"gradient")},C.cssreflections=function(){return j("boxReflect")},C.csstransforms=function(){return!!j("transform")},C.csstransforms3d=function(){var a=!!j("perspective");return a&&"webkitPerspective"in q.style&&H("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b){a=9===b.offsetLeft&&3===b.offsetHeight}),a},C.csstransitions=function(){return j("transition")},C.fontface=function(){var a;return H('@font-face {font-family:"font";src:url("https://")}',function(c,d){var e=b.getElementById("smodernizr"),f=e.sheet||e.styleSheet,g=f?f.cssRules&&f.cssRules[0]?f.cssRules[0].cssText:f.cssText||"":"";a=/src/i.test(g)&&0===g.indexOf(d.split(" ")[0])}),a},C.generatedcontent=function(){var a;return H(["#",r,"{font:0/0 a}#",r,':after{content:"',v,'";visibility:hidden;font:3px/1 a}'].join(""),function(b){a=b.offsetHeight>=3}),a},C.video=function(){var a=b.createElement("video"),c=!1;try{(c=!!a.canPlayType)&&(c=new Boolean(c),c.ogg=a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),c.h264=a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),c.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""))}catch(d){}return c},C.audio=function(){var a=b.createElement("audio"),c=!1;try{(c=!!a.canPlayType)&&(c=new Boolean(c),c.ogg=a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),c.mp3=a.canPlayType("audio/mpeg;").replace(/^no$/,""),c.wav=a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),c.m4a=(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,""))}catch(d){}return c},C.localstorage=function(){try{return localStorage.setItem(r,r),localStorage.removeItem(r),!0}catch(a){return!1}},C.sessionstorage=function(){try{return sessionStorage.setItem(r,r),sessionStorage.removeItem(r),!0}catch(a){return!1}},C.webworkers=function(){return!!a.Worker},C.applicationcache=function(){return!!a.applicationCache},C.svg=function(){return!!b.createElementNS&&!!b.createElementNS(B.svg,"svg").createSVGRect},C.inlinesvg=function(){var a=b.createElement("div");return a.innerHTML="<svg/>",(a.firstChild&&a.firstChild.namespaceURI)==B.svg},C.smil=function(){return!!b.createElementNS&&/SVGAnimate/.test(w.call(b.createElementNS(B.svg,"animate")))},C.svgclippaths=function(){return!!b.createElementNS&&/SVGClipPath/.test(w.call(b.createElementNS(B.svg,"clipPath")))};for(var K in C)m(C,K)&&(l=K.toLowerCase(),o[l]=C[K](),F.push((o[l]?"":"no-")+l));return o.input||k(),o.addTest=function(a,b){if("object"==typeof a)for(var d in a)m(a,d)&&o.addTest(d,a[d]);else{if(a=a.toLowerCase(),o[a]!==c)return o;b="function"==typeof b?b():b,"undefined"!=typeof p&&p&&(q.className+=" "+(b?"":"no-")+a),o[a]=b}return o},d(""),s=u=null,function(a,b){function c(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function d(){var a=r.elements;return"string"==typeof a?a.split(" "):a}function e(a){var b=q[a[o]];return b||(b={},p++,a[o]=p,q[p]=b),b}function f(a,c,d){if(c||(c=b),k)return c.createElement(a);d||(d=e(c));var f;return f=d.cache[a]?d.cache[a].cloneNode():n.test(a)?(d.cache[a]=d.createElem(a)).cloneNode():d.createElem(a),f.canHaveChildren&&!m.test(a)?d.frag.appendChild(f):f}function g(a,c){if(a||(a=b),k)return a.createDocumentFragment();c=c||e(a);for(var f=c.frag.cloneNode(),g=0,h=d(),i=h.length;i>g;g++)f.createElement(h[g]);return f}function h(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return r.shivMethods?f(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+d().join().replace(/\w+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(r,b.frag)}function i(a){a||(a=b);var d=e(a);return r.shivCSS&&!j&&!d.hasCSS&&(d.hasCSS=!!c(a,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),k||h(a,d),a}var j,k,l=a.html5||{},m=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,n=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,o="_html5shiv",p=0,q={};!function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",j="hidden"in a,k=1==a.childNodes.length||function(){b.createElement("a");var a=b.createDocumentFragment();return"undefined"==typeof a.cloneNode||"undefined"==typeof a.createDocumentFragment||"undefined"==typeof a.createElement}()}catch(c){j=!0,k=!0}}();var r={elements:l.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:l.shivCSS!==!1,supportsUnknownElements:k,shivMethods:l.shivMethods!==!1,type:"default",shivDocument:i,createElement:f,createDocumentFragment:g};a.html5=r,i(b)}(this,b),o._version=n,o._prefixes=x,o._domPrefixes=A,o._cssomPrefixes=z,o.hasEvent=I,o.testProp=function(a){return h([a])},o.testAllProps=j,o.testStyles=H,o.prefixed=function(a,b,c){return b?j(a,b,c):j(a,"pfx")},q.className=q.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(p?" js "+F.join(" "):""),o}(this,this.document),function(a,b,c){function d(a){return"[object Function]"==q.call(a)}function e(a){return"string"==typeof a}function f(){}function g(a){return!a||"loaded"==a||"complete"==a||"uninitialized"==a}function h(){var a=r.shift();s=1,a?a.t?o(function(){("c"==a.t?m.injectCss:m.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):s=0}function i(a,c,d,e,f,i,j){function k(b){if(!n&&g(l.readyState)&&(t.r=n=1,!s&&h(),l.onload=l.onreadystatechange=null,b)){"img"!=a&&o(function(){v.removeChild(l)},50);for(var d in A[c])A[c].hasOwnProperty(d)&&A[c][d].onload()}}var j=j||m.errorTimeout,l=b.createElement(a),n=0,q=0,t={t:d,s:c,e:f,a:i,x:j};1===A[c]&&(q=1,A[c]=[]),"object"==a?l.data=c:(l.src=c,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,q)},r.splice(e,0,t),"img"!=a&&(q||2===A[c]?(v.insertBefore(l,u?null:p),o(k,j)):A[c].push(l))}function j(a,b,c,d,f){return s=0,b=b||"j",e(a)?i("c"==b?x:w,a,b,this.i++,c,d,f):(r.splice(this.i++,0,a),1==r.length&&h()),this}function k(){var a=m;return a.loader={load:j,i:0},a}var l,m,n=b.documentElement,o=a.setTimeout,p=b.getElementsByTagName("script")[0],q={}.toString,r=[],s=0,t="MozAppearance"in n.style,u=t&&!!b.createRange().compareNode,v=u?n:p.parentNode,n=a.opera&&"[object Opera]"==q.call(a.opera),n=!!b.attachEvent&&!n,w=t?"object":n?"script":"img",x=n?"script":w,y=Array.isArray||function(a){return"[object Array]"==q.call(a)},z=[],A={},B={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}};m=function(a){function b(a){var b,c,d,a=a.split("!"),e=z.length,f=a.pop(),g=a.length,f={url:f,origUrl:f,prefixes:a};for(c=0;g>c;c++)d=a[c].split("="),(b=B[d.shift()])&&(f=b(f,d));for(c=0;e>c;c++)f=z[c](f);return f}function g(a,e,f,g,h){var i=b(a),j=i.autoCallback;i.url.split(".").pop().split("?").shift(),i.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split("/").pop().split("?")[0]]),i.instead?i.instead(a,e,f,g,h):(A[i.url]?i.noexec=!0:A[i.url]=1,f.load(i.url,i.forceCSS||!i.forceJS&&"css"==i.url.split(".").pop().split("?").shift()?"c":c,i.noexec,i.attrs,i.timeout),(d(e)||d(j))&&f.load(function(){k(),e&&e(i.origUrl,h,g),j&&j(i.origUrl,h,g),A[i.url]=2})))}function h(a,b){function c(a,c){if(a){if(e(a))c||(l=function(){var a=[].slice.call(arguments);m.apply(this,a),n()}),g(a,l,b,0,j);else if(Object(a)===a)for(i in h=function(){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c}(),a)a.hasOwnProperty(i)&&(!c&&!--h&&(d(l)?l=function(){var a=[].slice.call(arguments);m.apply(this,a),n()}:l[i]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),n()}}(m[i])),g(a[i],l,b,i,j))}else!c&&n()}var h,i,j=!!a.test,k=a.load||a.both,l=a.callback||f,m=l,n=a.complete||f;c(j?a.yep:a.nope,!!k),k&&c(k)}var i,j,l=this.yepnope.loader;if(e(a))g(a,0,l,0);else if(y(a))for(i=0;i<a.length;i++)j=a[i],e(j)?g(j,0,l,0):y(j)?m(j):Object(j)===j&&h(j,l);else Object(a)===a&&h(a,l)},m.addPrefix=function(a,b){B[a]=b},m.addFilter=function(a){z.push(a)},m.errorTimeout=1e4,null==b.readyState&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",l=function(){b.removeEventListener("DOMContentLoaded",l,0),b.readyState="complete"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var k,l,n=b.createElement("script"),e=e||m.errorTimeout;n.src=a;for(l in d)n.setAttribute(l,d[l]);c=j?h:c||f,n.onreadystatechange=n.onload=function(){!k&&g(n.readyState)&&(k=1,c(),n.onload=n.onreadystatechange=null)},o(function(){k||(k=1,c(1))},e),i?n.onload():p.parentNode.insertBefore(n,p)},a.yepnope.injectCss=function(a,c,d,e,g,i){var j,e=b.createElement("link"),c=i?h:c||f;e.href=a,e.rel="stylesheet",e.type="text/css";for(j in d)e.setAttribute(j,d[j]);g||(p.parentNode.insertBefore(e,p),o(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Spinner=b()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=j.substring(0,j.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return l[e]||(m.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",m.cssRules.length),l[e]=1),e}function d(a,b){var c,d,e=a.style;if(void 0!==e[b])return b;for(b=b.charAt(0).toUpperCase()+b.slice(1),d=0;d<k.length;d++)if(c=k[d]+b,void 0!==e[c])return c}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a){for(var b={x:a.offsetLeft,y:a.offsetTop};a=a.offsetParent;)b.x+=a.offsetLeft,b.y+=a.offsetTop;return b}function h(a){return"undefined"==typeof this?new h(a):void(this.opts=f(a||{},h.defaults,n))}function i(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}m.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:j+" "+j,coordorigin:-i+" "+-i}),{width:j,height:j})}function g(a,g,h){b(l,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~g}),b(e(c("roundrect",{arcsize:d.corners}),{width:i,height:d.width,left:d.radius,top:-d.width>>1,filter:h}),c("fill",{color:d.color,opacity:d.opacity}),c("stroke",{opacity:0}))))}var h,i=d.length+d.width,j=2*i,k=2*-(d.width+d.length)+"px",l=e(f(),{position:"absolute",top:k,left:k});if(d.shadow)for(h=1;h<=d.lines;h++)g(h,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(h=1;h<=d.lines;h++)g(h);return b(a,l)},h.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var j,k=["webkit","Moz","ms","O"],l={},m=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),n={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};h.defaults={},f(h.prototype,{spin:function(b){this.stop();var c,d,f=this,h=f.opts,i=f.el=e(a(0,{className:h.className}),{position:h.position,width:0,zIndex:h.zIndex}),k=h.radius+h.length+h.width;if(b&&(b.insertBefore(i,b.firstChild||null),d=g(b),c=g(i),e(i,{left:("auto"==h.left?d.x-c.x+(b.offsetWidth>>1):parseInt(h.left,10)+k)+"px",top:("auto"==h.top?d.y-c.y+(b.offsetHeight>>1):parseInt(h.top,10)+k)+"px"})),i.setAttribute("role","progressbar"),f.lines(i,f.opts),!j){var l,m=0,n=(h.lines-1)*(1-h.direction)/2,o=h.fps,p=o/h.speed,q=(1-h.opacity)/(p*h.trail/100),r=p/h.lines;!function s(){m++;for(var a=0;a<h.lines;a++)l=Math.max(1-(m+(h.lines-a)*r)%p*q,h.opacity),f.opacity(i,a*h.direction+n,l,h);f.timeout=f.el&&setTimeout(s,~~(1e3/o))}()}return f},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function g(b,c){return e(a(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*i+f.rotate)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.corners*f.width>>1)+"px"})}for(var h,i=0,k=(f.lines-1)*(1-f.direction)/2;i<f.lines;i++)h=e(a(),{position:"absolute",top:1+~(f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:j&&c(f.opacity,f.trail,k+i*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(h,e(g("#000","0 0 4px #000"),{top:"2px"})),b(d,b(h,g(f.color,"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var o=e(a("group"),{behavior:"url(#default#VML)"});return!d(o,"transform")&&o.adj?i():j=d(o,"animation"),h}),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){"use strict";function b(b,e){function f(){return m.update(),h(),m}function g(){r.css(x,m.contentPosition/m.trackRatio),o.css(x,-m.contentPosition),p.css(w,m.trackSize),q.css(w,m.trackSize),r.css(w,m.thumbSize)}function h(){u?n[0].ontouchstart=function(a){1===a.touches.length&&(a.stopPropagation(),i(a.touches[0]))}:(r.bind("mousedown",i),q.bind("mousedown",k)),a(window).resize(function(){m.update("relative")}),m.options.wheel&&window.addEventListener?b[0].addEventListener(v,j,!1):m.options.wheel&&(b[0].onmousewheel=j)}function i(b){a("body").addClass("noSelect"),s=t?b.pageX:b.pageY,m.thumbPosition=parseInt(r.css(x),10)||0,u?(document.ontouchmove=function(a){a.preventDefault(),k(a.touches[0])},document.ontouchend=l):(a(document).bind("mousemove",k),a(document).bind("mouseup",l),r.bind("mouseup",l))}function j(c){if(m.contentRatio<1){var d=c||window.event,e=-(d.deltaY||d.detail||-1/3*d.wheelDelta)/40,f=1===d.deltaMode?m.options.wheelSpeed:1;m.contentPosition-=e*f*m.options.wheelSpeed,m.contentPosition=Math.min(m.contentSize-m.viewportSize,Math.max(0,m.contentPosition)),b.trigger("move"),r.css(x,m.contentPosition/m.trackRatio),o.css(x,-m.contentPosition),(m.options.wheelLock||m.contentPosition!==m.contentSize-m.viewportSize&&0!==m.contentPosition)&&(d=a.event.fix(d),d.preventDefault())}}function k(a){if(m.contentRatio<1){var c=t?a.pageX:a.pageY,d=c-s;m.options.scrollInvert&&u&&(d=s-c);var e=Math.min(m.trackSize-m.thumbSize,Math.max(0,m.thumbPosition+d));m.contentPosition=e*m.trackRatio,b.trigger("move"),r.css(x,e),o.css(x,-m.contentPosition)}}function l(){a("body").removeClass("noSelect"),a(document).unbind("mousemove",k),a(document).unbind("mouseup",l),r.unbind("mouseup",l),document.ontouchmove=document.ontouchend=null}this.options=a.extend({},d,e),this._defaults=d,this._name=c;var m=this,n=b.find(".viewport"),o=b.find(".overview"),p=b.find(".scrollbar"),q=p.find(".track"),r=p.find(".thumb"),s=0,t="x"===this.options.axis,u="ontouchstart"in document.documentElement,v="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",w=t?"width":"height",x=t?"left":"top";return this.contentPosition=0,this.viewportSize=0,this.contentSize=0,this.contentRatio=0,this.trackSize=0,this.trackRatio=0,this.thumbSize=0,this.thumbPosition=0,this.update=function(a){var b=w.charAt(0).toUpperCase()+w.slice(1).toLowerCase();switch(this.viewportSize=n[0]["offset"+b],this.contentSize=o[0]["scroll"+b],this.contentRatio=this.viewportSize/this.contentSize,this.trackSize=this.options.trackSize||this.viewportSize,this.thumbSize=Math.min(this.trackSize,Math.max(0,this.options.thumbSize||this.trackSize*this.contentRatio)),this.trackRatio=this.options.thumbSize?(this.contentSize-this.viewportSize)/(this.trackSize-this.thumbSize):this.contentSize/this.trackSize,s=q.offset().top,p.toggleClass("disable",this.contentRatio>=1),a){case"bottom":this.contentPosition=Math.max(this.contentSize-this.viewportSize,0);break;case"relative":this.contentPosition=Math.min(Math.max(this.contentSize-this.viewportSize,0),Math.max(0,this.contentPosition));break;default:this.contentPosition=parseInt(a,10)||0}return g(),m},f()}var c="tinyscrollbar",d={axis:"y",wheel:!0,wheelSpeed:40,wheelLock:!0,scrollInvert:!1,trackSize:!1,thumbSize:!1};a.fn[c]=function(d){return this.each(function(){a.data(this,"plugin_"+c)||a.data(this,"plugin_"+c,new b(a(this),d))})}});