window.JSON||(window.JSON={}),function(){function f(a){return a<10?"0"+a:a;}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return typeof b=="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+a+'"';}function str(a,b){var c,d,e,f,g=gap,h,i=b[a];i&&typeof i=="object"&&typeof i.toJSON=="function"&&(i=i.toJSON(a)),typeof rep=="function"&&(i=rep.call(b,a,i));switch(typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i){return"null";}gap+=indent,h=[];if(Object.prototype.toString.apply(i)==="[object Array]"){f=i.length;for(c=0;c<f;c+=1){h[c]=str(c,i)||"null";}return e=h.length===0?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]",gap=g,e;}if(rep&&typeof rep=="object"){f=rep.length;for(c=0;c<f;c+=1){d=rep[c],typeof d=="string"&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));}}else{for(d in i){Object.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));}}return e=h.length===0?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}",gap=g,e;}}"use strict",typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null;},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf();});var JSON=window.JSON,cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(a,b,c){var d;gap="",indent="";if(typeof c=="number"){for(d=0;d<c;d+=1){indent+=" ";}}else{typeof c=="string"&&(indent=c);}rep=b;if(!b||typeof b=="function"||typeof b=="object"&&typeof b.length=="number"){return str("",{"":a});}throw new Error("JSON.stringify");}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e=="object"){for(c in e){Object.hasOwnProperty.call(e,c)&&(d=walk(e,c),d!==undefined?e[c]=d:delete e[c]);}}return reviver.call(a,b,e);}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;}throw new SyntaxError("JSON.parse");});}(),function(a,b){var c=a.History=a.History||{},d=a.jQuery;if(typeof c.Adapter!="undefined"){throw new Error("History.js Adapter has already been loaded...");}c.Adapter={bind:function(a,b,c){d(a).bind(b,c);},trigger:function(a,b,c){d(a).trigger(b,c);},extractEventData:function(a,c,d){var e=c&&c.originalEvent&&c.originalEvent[a]||d&&d[a]||b;return e;},onDomLoad:function(a){d(a);}},typeof c.init!="undefined"&&c.init();}(window),function(a,b){var c=a.document,d=a.setTimeout||d,e=a.clearTimeout||e,f=a.setInterval||f,g=a.History=a.History||{};if(typeof g.initHtml4!="undefined"){throw new Error("History.js HTML4 Support has already been loaded...");}g.initHtml4=function(){if(typeof g.initHtml4.initialized!="undefined"){return !1;}g.initHtml4.initialized=!0,g.enabled=!0,g.savedHashes=[],g.isLastHash=function(a){var b=g.getHashByIndex(),c;return c=a===b,c;},g.saveHash=function(a){return g.isLastHash(a)?!1:(g.savedHashes.push(a),!0);},g.getHashByIndex=function(a){var b=null;return typeof a=="undefined"?b=g.savedHashes[g.savedHashes.length-1]:a<0?b=g.savedHashes[g.savedHashes.length+a]:b=g.savedHashes[a],b;},g.discardedHashes={},g.discardedStates={},g.discardState=function(a,b,c){var d=g.getHashByState(a),e;return e={discardedState:a,backState:c,forwardState:b},g.discardedStates[d]=e,!0;},g.discardHash=function(a,b,c){var d={discardedHash:a,backState:c,forwardState:b};return g.discardedHashes[a]=d,!0;},g.discardedState=function(a){var b=g.getHashByState(a),c;return c=g.discardedStates[b]||!1,c;},g.discardedHash=function(a){var b=g.discardedHashes[a]||!1;return b;},g.recycleState=function(a){var b=g.getHashByState(a);return g.discardedState(a)&&delete g.discardedStates[b],!0;},g.emulated.hashChange&&(g.hashChangeInit=function(){g.checkerFunction=null;var b="",d,e,h,i;return g.isInternetExplorer()?(d="historyjs-iframe",e=c.createElement("iframe"),e.setAttribute("id",d),e.style.display="none",c.body.appendChild(e),e.contentWindow.document.open(),e.contentWindow.document.close(),h="",i=!1,g.checkerFunction=function(){if(i){return !1;}i=!0;var c=g.getHash()||"",d=g.unescapeHash(e.contentWindow.document.location.hash)||"";return c!==b?(b=c,d!==c&&(h=d=c,e.contentWindow.document.open(),e.contentWindow.document.close(),e.contentWindow.document.location.hash=g.escapeHash(c)),g.Adapter.trigger(a,"hashchange")):d!==h&&(h=d,g.setHash(d,!1)),i=!1,!0;}):g.checkerFunction=function(){var c=g.getHash();return c!==b&&(b=c,g.Adapter.trigger(a,"hashchange")),!0;},g.intervalList.push(f(g.checkerFunction,g.options.hashChangeInterval)),!0;},g.Adapter.onDomLoad(g.hashChangeInit)),g.emulated.pushState&&(g.onHashChange=function(b){var d=b&&b.newURL||c.location.href,e=g.getHashByUrl(d),f=null,h=null,i=null,j;return g.isLastHash(e)?(g.busy(!1),!1):(g.doubleCheckComplete(),g.saveHash(e),e&&g.isTraditionalAnchor(e)?(g.Adapter.trigger(a,"anchorchange"),g.busy(!1),!1):(f=g.extractState(g.getFullUrl(e||c.location.href,!1),!0),g.isLastSavedState(f)?(g.busy(!1),!1):(h=g.getHashByState(f),j=g.discardedState(f),j?(g.getHashByIndex(-2)===g.getHashByState(j.forwardState)?g.back(!1):g.forward(!1),!1):(g.pushState(f.data,f.title,f.url,!1),!0))));},g.Adapter.bind(a,"hashchange",g.onHashChange),g.pushState=function(b,d,e,f){if(g.getHashByUrl(e)){throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");}if(f!==!1&&g.busy()){return g.pushQueue({scope:g,callback:g.pushState,args:arguments,queue:f}),!1;}g.busy(!0);var h=g.createStateObject(b,d,e),i=g.getHashByState(h),j=g.getState(!1),k=g.getHashByState(j),l=g.getHash();return g.storeState(h),g.expectedStateId=h.id,g.recycleState(h),g.setTitle(h),i===k?(g.busy(!1),!1):i!==l&&i!==g.getShortUrl(c.location.href)?(g.setHash(i,!1),!1):(g.saveState(h),g.Adapter.trigger(a,"statechange"),g.busy(!1),!0);},g.replaceState=function(a,b,c,d){if(g.getHashByUrl(c)){throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");}if(d!==!1&&g.busy()){return g.pushQueue({scope:g,callback:g.replaceState,args:arguments,queue:d}),!1;}g.busy(!0);var e=g.createStateObject(a,b,c),f=g.getState(!1),h=g.getStateByIndex(-2);return g.discardState(f,e,h),g.pushState(e.data,e.title,e.url,!1),!0;}),g.emulated.pushState&&g.getHash()&&!g.emulated.hashChange&&g.Adapter.onDomLoad(function(){g.Adapter.trigger(a,"hashchange");});},typeof g.init!="undefined"&&g.init();}(window),function(a,b){var c=a.console||b,d=a.document,e=a.navigator,f=a.sessionStorage||!1,g=a.setTimeout,h=a.clearTimeout,i=a.setInterval,j=a.clearInterval,k=a.JSON,l=a.alert,m=a.History=a.History||{},n=a.history;k.stringify=k.stringify||k.encode,k.parse=k.parse||k.decode;if(typeof m.init!="undefined"){throw new Error("History.js Core has already been loaded...");}m.init=function(){return typeof m.Adapter=="undefined"?!1:(typeof m.initCore!="undefined"&&m.initCore(),typeof m.initHtml4!="undefined"&&m.initHtml4(),!0);},m.initCore=function(){if(typeof m.initCore.initialized!="undefined"){return !1;}m.initCore.initialized=!0,m.options=m.options||{},m.options.hashChangeInterval=m.options.hashChangeInterval||100,m.options.safariPollInterval=m.options.safariPollInterval||500,m.options.doubleCheckInterval=m.options.doubleCheckInterval||500,m.options.storeInterval=m.options.storeInterval||1000,m.options.busyDelay=m.options.busyDelay||250,m.options.debug=m.options.debug||!1,m.options.initialTitle=m.options.initialTitle||d.title,m.intervalList=[],m.clearAllIntervals=function(){var a,b=m.intervalList;if(typeof b!="undefined"&&b!==null){for(a=0;a<b.length;a++){j(b[a]);}m.intervalList=null;}},m.debug=function(){(m.options.debug||!1)&&m.log.apply(m,arguments);},m.log=function(){var a=typeof c!="undefined"&&typeof c.log!="undefined"&&typeof c.log.apply!="undefined",b=d.getElementById("log"),e,f,g,h,i;a?(h=Array.prototype.slice.call(arguments),e=h.shift(),typeof c.debug!="undefined"?c.debug.apply(c,[e,h]):c.log.apply(c,[e,h])):e="\n"+arguments[0]+"\n";for(f=1,g=arguments.length;f<g;++f){i=arguments[f];if(typeof i=="object"&&typeof k!="undefined"){try{i=k.stringify(i);}catch(j){}}e+="\n"+i+"\n";}return b?(b.value+=e+"\n-----\n",b.scrollTop=b.scrollHeight-b.clientHeight):a||l(e),!0;},m.getInternetExplorerMajorVersion=function(){var a=m.getInternetExplorerMajorVersion.cached=typeof m.getInternetExplorerMajorVersion.cached!="undefined"?m.getInternetExplorerMajorVersion.cached:function(){var a=3,b=d.createElement("div"),c=b.getElementsByTagName("i");while((b.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->")&&c[0]){}return a>4?a:!1;}();return a;},m.isInternetExplorer=function(){var a=m.isInternetExplorer.cached=typeof m.isInternetExplorer.cached!="undefined"?m.isInternetExplorer.cached:Boolean(m.getInternetExplorerMajorVersion());return a;},m.emulated={pushState:!Boolean(a.history&&a.history.pushState&&a.history.replaceState&&!/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(e.userAgent)&&!/AppleWebKit\/5([0-2]|3[0-2])/i.test(e.userAgent)),hashChange:Boolean(!("onhashchange" in a||"onhashchange" in d)||m.isInternetExplorer()&&m.getInternetExplorerMajorVersion()<8)},m.enabled=!m.emulated.pushState,m.bugs={setHash:Boolean(!m.emulated.pushState&&e.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(e.userAgent)),safariPoll:Boolean(!m.emulated.pushState&&e.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(e.userAgent)),ieDoubleCheck:Boolean(m.isInternetExplorer()&&m.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(m.isInternetExplorer()&&m.getInternetExplorerMajorVersion()<7)},m.isEmptyObject=function(a){for(var b in a){return !1;}return !0;},m.cloneObject=function(a){var b,c;return a?(b=k.stringify(a),c=k.parse(b)):c={},c;},m.getRootUrl=function(){var a=d.location.protocol+"//"+(d.location.hostname||d.location.host);if(d.location.port||!1){a+=":"+d.location.port;}return a+="/",a;},m.getBaseHref=function(){var a=d.getElementsByTagName("base"),b=null,c="";return a.length===1&&(b=a[0],c=b.href.replace(/[^\/]+$/,"")),c=c.replace(/\/+$/,""),c&&(c+="/"),c;},m.getBaseUrl=function(){var a=m.getBaseHref()||m.getBasePageUrl()||m.getRootUrl();return a;},m.getPageUrl=function(){var a=m.getState(!1,!1),b=(a||{}).url||d.location.href,c;return c=b.replace(/\/+$/,"").replace(/[^\/]+$/,function(a,b,c){return/\./.test(a)?a:a+"/";}),c;},m.getBasePageUrl=function(){var a=d.location.href.replace(/[#\?].*/,"").replace(/[^\/]+$/,function(a,b,c){return/[^\/]$/.test(a)?"":a;}).replace(/\/+$/,"")+"/";return a;},m.getFullUrl=function(a,b){var c=a,d=a.substring(0,1);return b=typeof b=="undefined"?!0:b,/[a-z]+\:\/\//.test(a)||(d==="/"?c=m.getRootUrl()+a.replace(/^\/+/,""):d==="#"?c=m.getPageUrl().replace(/#.*/,"")+a:d==="?"?c=m.getPageUrl().replace(/[\?#].*/,"")+a:b?c=m.getBaseUrl()+a.replace(/^(\.\/)+/,""):c=m.getBasePageUrl()+a.replace(/^(\.\/)+/,"")),c.replace(/\#$/,"");},m.getShortUrl=function(a){var b=a,c=m.getBaseUrl(),d=m.getRootUrl();return m.emulated.pushState&&(b=b.replace(c,"")),b=b.replace(d,"/"),m.isTraditionalAnchor(b)&&(b="./"+b),b=b.replace(/^(\.\/)+/g,"./").replace(/\#$/,""),b;},m.store={},m.idToState=m.idToState||{},m.stateToId=m.stateToId||{},m.urlToId=m.urlToId||{},m.storedStates=m.storedStates||[],m.savedStates=m.savedStates||[],m.normalizeStore=function(){m.store.idToState=m.store.idToState||{},m.store.urlToId=m.store.urlToId||{},m.store.stateToId=m.store.stateToId||{};},m.getState=function(a,b){typeof a=="undefined"&&(a=!0),typeof b=="undefined"&&(b=!0);var c=m.getLastSavedState();return !c&&b&&(c=m.createStateObject()),a&&(c=m.cloneObject(c),c.url=c.cleanUrl||c.url),c;},m.getIdByState=function(a){var b=m.extractId(a.url),c;if(!b){c=m.getStateString(a);if(typeof m.stateToId[c]!="undefined"){b=m.stateToId[c];}else{if(typeof m.store.stateToId[c]!="undefined"){b=m.store.stateToId[c];}else{for(;;){b=(new Date).getTime()+String(Math.random()).replace(/\D/g,"");if(typeof m.idToState[b]=="undefined"&&typeof m.store.idToState[b]=="undefined"){break;}}m.stateToId[c]=b,m.idToState[b]=a;}}}return b;},m.normalizeState=function(a){var b,c;if(!a||typeof a!="object"){a={};}if(typeof a.normalized!="undefined"){return a;}if(!a.data||typeof a.data!="object"){a.data={};}b={},b.normalized=!0,b.title=a.title||"",b.url=m.getFullUrl(m.unescapeString(a.url||d.location.href)),b.hash=m.getShortUrl(b.url),b.data=m.cloneObject(a.data),b.id=m.getIdByState(b),b.cleanUrl=b.url.replace(/\??\&_suid.*/,""),b.url=b.cleanUrl,c=!m.isEmptyObject(b.data);if(b.title||c){b.hash=m.getShortUrl(b.url).replace(/\??\&_suid.*/,""),/\?/.test(b.hash)||(b.hash+="?"),b.hash+="&_suid="+b.id;}return b.hashedUrl=m.getFullUrl(b.hash),(m.emulated.pushState||m.bugs.safariPoll)&&m.hasUrlDuplicate(b)&&(b.url=b.hashedUrl),b;},m.createStateObject=function(a,b,c){var d={data:a,title:b,url:c};return d=m.normalizeState(d),d;},m.getStateById=function(a){a=String(a);var c=m.idToState[a]||m.store.idToState[a]||b;return c;},m.getStateString=function(a){var b,c,d;return b=m.normalizeState(a),c={data:b.data,title:a.title,url:a.url},d=k.stringify(c),d;},m.getStateId=function(a){var b,c;return b=m.normalizeState(a),c=b.id,c;},m.getHashByState=function(a){var b,c;return b=m.normalizeState(a),c=b.hash,c;},m.extractId=function(a){var b,c,d;return c=/(.*)\&_suid=([0-9]+)$/.exec(a),d=c?c[1]||a:a,b=c?String(c[2]||""):"",b||!1;},m.isTraditionalAnchor=function(a){var b=!/[\/\?\.]/.test(a);return b;},m.extractState=function(a,b){var c=null,d,e;return b=b||!1,d=m.extractId(a),d&&(c=m.getStateById(d)),c||(e=m.getFullUrl(a),d=m.getIdByUrl(e)||!1,d&&(c=m.getStateById(d)),!c&&b&&!m.isTraditionalAnchor(a)&&(c=m.createStateObject(null,null,e))),c;},m.getIdByUrl=function(a){var c=m.urlToId[a]||m.store.urlToId[a]||b;return c;},m.getLastSavedState=function(){return m.savedStates[m.savedStates.length-1]||b;},m.getLastStoredState=function(){return m.storedStates[m.storedStates.length-1]||b;},m.hasUrlDuplicate=function(a){var b=!1,c;return c=m.extractState(a.url),b=c&&c.id!==a.id,b;},m.storeState=function(a){return m.urlToId[a.url]=a.id,m.storedStates.push(m.cloneObject(a)),a;},m.isLastSavedState=function(a){var b=!1,c,d,e;return m.savedStates.length&&(c=a.id,d=m.getLastSavedState(),e=d.id,b=c===e),b;},m.saveState=function(a){return m.isLastSavedState(a)?!1:(m.savedStates.push(m.cloneObject(a)),!0);},m.getStateByIndex=function(a){var b=null;return typeof a=="undefined"?b=m.savedStates[m.savedStates.length-1]:a<0?b=m.savedStates[m.savedStates.length+a]:b=m.savedStates[a],b;},m.getHash=function(){var a=m.unescapeHash(d.location.hash);return a;},m.unescapeString=function(b){var c=b,d;for(;;){d=a.unescape(c);if(d===c){break;}c=d;}return c;},m.unescapeHash=function(a){var b=m.normalizeHash(a);return b=m.unescapeString(b),b;},m.normalizeHash=function(a){var b=a.replace(/[^#]*#/,"").replace(/#.*/,"");return b;},m.setHash=function(a,b){var c,e,f;return b!==!1&&m.busy()?(m.pushQueue({scope:m,callback:m.setHash,args:arguments,queue:b}),!1):(c=m.escapeHash(a),m.busy(!0),e=m.extractState(a,!0),e&&!m.emulated.pushState?m.pushState(e.data,e.title,e.url,!1):d.location.hash!==c&&(m.bugs.setHash?(f=m.getPageUrl(),m.pushState(null,null,f+"#"+c,!1)):d.location.hash=c),m);},m.escapeHash=function(b){var c=m.normalizeHash(b);return c=a.escape(c),m.bugs.hashEscape||(c=c.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),c;},m.getHashByUrl=function(a){var b=String(a).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return b=m.unescapeHash(b),b;},m.setTitle=function(a){var b=a.title,c;b||(c=m.getStateByIndex(0),c&&c.url===a.url&&(b=c.title||m.options.initialTitle));try{d.getElementsByTagName("title")[0].innerHTML=b.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ");}catch(e){}return d.title=b,m;},m.queues=[],m.busy=function(a){typeof a!="undefined"?m.busy.flag=a:typeof m.busy.flag=="undefined"&&(m.busy.flag=!1);if(!m.busy.flag){h(m.busy.timeout);var b=function(){var a,c,d;if(m.busy.flag){return;}for(a=m.queues.length-1;a>=0;--a){c=m.queues[a];if(c.length===0){continue;}d=c.shift(),m.fireQueueItem(d),m.busy.timeout=g(b,m.options.busyDelay);}};m.busy.timeout=g(b,m.options.busyDelay);}return m.busy.flag;},m.busy.flag=!1,m.fireQueueItem=function(a){return a.callback.apply(a.scope||m,a.args||[]);},m.pushQueue=function(a){return m.queues[a.queue||0]=m.queues[a.queue||0]||[],m.queues[a.queue||0].push(a),m;},m.queue=function(a,b){return typeof a=="function"&&(a={callback:a}),typeof b!="undefined"&&(a.queue=b),m.busy()?m.pushQueue(a):m.fireQueueItem(a),m;},m.clearQueue=function(){return m.busy.flag=!1,m.queues=[],m;},m.stateChanged=!1,m.doubleChecker=!1,m.doubleCheckComplete=function(){return m.stateChanged=!0,m.doubleCheckClear(),m;},m.doubleCheckClear=function(){return m.doubleChecker&&(h(m.doubleChecker),m.doubleChecker=!1),m;},m.doubleCheck=function(a){return m.stateChanged=!1,m.doubleCheckClear(),m.bugs.ieDoubleCheck&&(m.doubleChecker=g(function(){return m.doubleCheckClear(),m.stateChanged||a(),!0;},m.options.doubleCheckInterval)),m;},m.safariStatePoll=function(){var b=m.extractState(d.location.href),c;if(!m.isLastSavedState(b)){c=b;}else{return;}return c||(c=m.createStateObject()),m.Adapter.trigger(a,"popstate"),m;},m.back=function(a){return a!==!1&&m.busy()?(m.pushQueue({scope:m,callback:m.back,args:arguments,queue:a}),!1):(m.busy(!0),m.doubleCheck(function(){m.back(!1);}),n.go(-1),!0);},m.forward=function(a){return a!==!1&&m.busy()?(m.pushQueue({scope:m,callback:m.forward,args:arguments,queue:a}),!1):(m.busy(!0),m.doubleCheck(function(){m.forward(!1);}),n.go(1),!0);},m.go=function(a,b){var c;if(a>0){for(c=1;c<=a;++c){m.forward(b);}}else{if(!(a<0)){throw new Error("History.go: History.go requires a positive or negative integer passed.");}for(c=-1;c>=a;--c){m.back(b);}}return m;};if(m.emulated.pushState){var o=function(){};m.pushState=m.pushState||o,m.replaceState=m.replaceState||o;}else{m.onPopState=function(b,c){var e=!1,f=!1,g,h;return m.doubleCheckComplete(),g=m.getHash(),g?(h=m.extractState(g||d.location.href,!0),h?m.replaceState(h.data,h.title,h.url,!1):(m.Adapter.trigger(a,"anchorchange"),m.busy(!1)),m.expectedStateId=!1,!1):(e=m.Adapter.extractEventData("state",b,c)||!1,e?f=m.getStateById(e):m.expectedStateId?f=m.getStateById(m.expectedStateId):f=m.extractState(d.location.href),f||(f=m.createStateObject(null,null,d.location.href)),m.expectedStateId=!1,m.isLastSavedState(f)?(m.busy(!1),!1):(m.storeState(f),m.saveState(f),m.setTitle(f),m.Adapter.trigger(a,"statechange"),m.busy(!1),!0));},m.Adapter.bind(a,"popstate",m.onPopState),m.pushState=function(b,c,d,e){if(m.getHashByUrl(d)&&m.emulated.pushState){throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");}if(e!==!1&&m.busy()){return m.pushQueue({scope:m,callback:m.pushState,args:arguments,queue:e}),!1;}m.busy(!0);var f=m.createStateObject(b,c,d);return m.isLastSavedState(f)?m.busy(!1):(m.storeState(f),m.expectedStateId=f.id,n.pushState(f.id,f.title,f.url),m.Adapter.trigger(a,"popstate")),!0;},m.replaceState=function(b,c,d,e){if(m.getHashByUrl(d)&&m.emulated.pushState){throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");}if(e!==!1&&m.busy()){return m.pushQueue({scope:m,callback:m.replaceState,args:arguments,queue:e}),!1;}m.busy(!0);var f=m.createStateObject(b,c,d);return m.isLastSavedState(f)?m.busy(!1):(m.storeState(f),m.expectedStateId=f.id,n.replaceState(f.id,f.title,f.url),m.Adapter.trigger(a,"popstate")),!0;};}if(f){try{m.store=k.parse(f.getItem("History.store"))||{};}catch(p){m.store={};}m.normalizeStore();}else{m.store={},m.normalizeStore();}m.Adapter.bind(a,"beforeunload",m.clearAllIntervals),m.Adapter.bind(a,"unload",m.clearAllIntervals),m.saveState(m.storeState(m.extractState(d.location.href,!0))),f&&(m.onUnload=function(){var a,b;try{a=k.parse(f.getItem("History.store"))||{};}catch(c){a={};}a.idToState=a.idToState||{},a.urlToId=a.urlToId||{},a.stateToId=a.stateToId||{};for(b in m.idToState){if(!m.idToState.hasOwnProperty(b)){continue;}a.idToState[b]=m.idToState[b];}for(b in m.urlToId){if(!m.urlToId.hasOwnProperty(b)){continue;}a.urlToId[b]=m.urlToId[b];}for(b in m.stateToId){if(!m.stateToId.hasOwnProperty(b)){continue;}a.stateToId[b]=m.stateToId[b];}m.store=a,m.normalizeStore(),f.setItem("History.store",k.stringify(a));},m.intervalList.push(i(m.onUnload,m.options.storeInterval)),m.Adapter.bind(a,"beforeunload",m.onUnload),m.Adapter.bind(a,"unload",m.onUnload));if(!m.emulated.pushState){m.bugs.safariPoll&&m.intervalList.push(i(m.safariStatePoll,m.options.safariPollInterval));if(e.vendor==="Apple Computer, Inc."||(e.appCodeName||"")==="Mozilla"){m.Adapter.bind(a,"hashchange",function(){m.Adapter.trigger(a,"popstate");}),m.getHash()&&m.Adapter.onDomLoad(function(){m.Adapter.trigger(a,"hashchange");});}}},m.init();}(window);function initFollowing(){var followingThickBoxJsData=$("#followingThickBoxJsData");var followingEntityType=followingThickBoxJsData.attr("data-entity-type");var followingEntityUri=followingThickBoxJsData.attr("data-entity-uri");var isFollowing=followingThickBoxJsData.attr("data-is-following");var elt=$("div[data-entity-type='"+followingEntityType+"'][data-entity-url='"+followingEntityUri+"']");if(isFollowing){if(elt.find(".buttoncount").attr("class")=="buttoncount follow"){changeFollowing(this,elt);}}$("[name=type]").click(function(){var a=$(this);var signupuri="/following/signup/"+followingEntityType+"/"+followingEntityUri+"/"+$(this).attr("id");$.ajax({url:encodeURI(signupuri),cache:false,success:function(b){$("[name=type]").attr("class","greybuttonlink");a.attr("class","buttonlink");if($(".buttoncount").attr("class")=="buttoncount follow"){changeFollowing(this,elt);}}});return false;});$("#done").click(function(){tb_remove();return false;});addMemberInfo(followingThickBoxJsData);}function addMemberInfo(followingThickBoxJsData){var memberName=followingThickBoxJsData.attr("data-member-name");if(isMember()){if($("#login").size()>0){$("#header_userinfo").html('<b><a href="http://www.forbes.com/membership/editprofile.jhtml">'+memberName+'</a></b>&nbsp;&nbsp;|&nbsp;&nbsp;<a id="myalerts" href="/places/following">Following</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a id="logout" href="http://www.forbes.com/membership/external_logout.jhtml">Logout</a>');}}}function changeFollowing(obj,elt){var followingEntityUri=elt.attr("data-entity-url");var followingEntityType=elt.attr("data-entity-type");var followingEntityName=elt.attr("data-entity-name");var followingButtonEntityName=elt.attr("data-button-entity-name");var count=getCount(this,elt);var elt=$("div[data-entity-type='"+followingEntityType+"'][data-entity-url='"+followingEntityUri+"']");var bchtml='<a href="" class="buttonlink plusmore tooltip" title="'+followingEntityName+'">Following '+followingButtonEntityName+'</a><div class="box-left"></div><span class="count">'+(count+1)+"</span>";elt.find(".buttoncount").html(bchtml);elt.find(".buttoncount").attr("class","buttoncount following");elt.find(".following .tooltip").toggle(function(){return followingClick(this,elt);},function(){$(this).find("#tooltip").remove();});}function followingClick(obj,elt){var manageFollowingUri=elt.attr("data-manage-following-uri");$(obj).append('<span id="tooltip" class="iconoverlay">You follow '+$(obj).attr("title")+'.<ul><li><a id="unfollow" href="">Unfollow</a></li><li><a id="manageLink" href="'+manageFollowingUri+'">Manage who you follow</a></li></ul></span>');$(obj).find("#manageLink").click(function(){location.href=$("#manageLink").attr("href");});$(obj).find("#unfollow").click(function(){return unfollowClick(this,elt);});var b=($(obj).find(".tooltip").width()+16);$(this).find("#tooltip").css("width",b+"px").fadeIn("fast");return false;}function unfollowClick(obj,elt){var followingEntityUri=elt.attr("data-entity-url");var followingEntityType=elt.attr("data-entity-type");var followingEntityName=elt.attr("data-entity-name");var followingButtonEntityName=elt.attr("data-button-entity-name");var unfollowuri="/following/remove/"+followingEntityType+"/"+followingEntityUri;var count=getCount(this,elt);$.ajax({url:encodeURI(unfollowuri),cache:false,success:function(d){var followingHtml='<a href="" class="buttonlink plusmore tooltip tooltipLeft" title="Receive email updates for new stories on '+followingEntityName+'">Follow '+followingButtonEntityName+"</a>";if(count-1!=0){followingHtml+='<div class="box-left"></div><span class="count">'+(count-1)+"</span>";}elt.find(".buttoncount").html(followingHtml);elt.find(".buttoncount").attr("class","buttoncount follow");elt.find(".follow .buttonlink").click(function(){return followClick(obj,elt);});}});return false;}function followClick(obj,elt){var followingEntityUri=elt.attr("data-entity-url");var followingEntityType=elt.attr("data-entity-type");var followingEntityName=elt.attr("data-entity-name");$("#genericFollowing").remove();$("body").append("<div id='genericFollowing' data-value='true'></div>");var signuri="/following/genericView/"+followingEntityType+"/"+followingEntityUri+"?keepThis=true&height=482&width=750";var reguri="/redirect/membership/regbubble/member_req_handler?req_action=following_login&signupRedirectURL="+location.href+"&name="+followingEntityName.replace("&#38;","%26")+"&path="+followingEntityUri+"&category="+followingEntityType+"&keepThis=true&height=482&width=750";if(isMember()){tb_show("",encodeURI(signuri),"");}else{tb_show("",encodeURI(reguri),"");}return false;}function getCount(obj,elt){var count=0;if(elt.find(".count").size()>0){count=parseInt(elt.find(".count").html());}return count;}var forbes=(function(app,$){app.comments_v2=(function($){var debug=null,$collections=null;function _init(){debug=forbes.util.debug;$collections=$(".comments_collection");if($collections.length>0){$collections.each(function(){var $this=$(this);if(!$this.hasClass("initialized")){_init_no_called_out($this);_init_main_comment_nav($this);_init_badges($this);_init_threading($this);_init_collapsable_comments($this);_init_comment_bugs($this);_init_abuse_flags($this);_init_reply_links($this);_init_page_ui($this);$this.data("allow_init_collapse",1);if(!$("body").hasClass("mobile_mode")){_check_for_selected_comment_id($this);_setup_initial_state($this);_init_body_comment_links($this);}else{_check_for_selected_comment_id_mobile($this);}_admin_init($this);$this.addClass("initialized");}else{}});}}function _init_page_ui($target){forbes.pagination_controls.init($target);_init_pagination_links($target);}function _check_for_selected_comment_id($target){var selected_id=$target.attr("data-selected-comment-id");if(typeof selected_id!="undefined"){if(selected_id.length>0&&selected_id!==""){$target.data("allow_init_collapse",0);var $target_comment=$("li.comment[data-comment-wp-id="+selected_id+"]");if($target_comment.length<1){return false;}_check_comment_mode($target);setTimeout(function(){forbes.util.scroll_to_obj($target_comment,{duration:800,valign:true,highlight:true});},2000);$("li.collapsable.grouped[data-comment-wp-id="+selected_id+"]").css("background","whiteSmoke").css("background-color","whiteSmoke");}}}function _check_for_selected_comment_id_mobile($target){var selected_id=$target.attr("data-selected-comment-id");if(typeof selected_id!="undefined"){if(selected_id.length>0&&selected_id!==""){$target.data("allow_init_collapse",0);var $target_comment=$("li.comment[data-comment-wp-id="+selected_id+"]");if($target_comment.length<1){return false;}_check_comment_mode($target);$(document).ready(function(){$(window).load(function(){var $show_more=$target_comment.parents(".comments_well").find(".show_more");if($show_more.length==1){$show_more.click();}forbes.util.scroll_to_obj($target_comment,{duration:800,highlight:true});});});$("li.collapsable.grouped[data-comment-wp-id="+selected_id+"]").css("background","whiteSmoke").css("background-color","whiteSmoke");}}}function _update($target){_init_threading($target);_init_badges($target);_init_collapsable_comments($target);_init_abuse_flags($target);_check_comment_mode($target);_init_comment_bugs($target);_init_reply_links($target);_admin_init($target);}function _init_abuse_flags($target){$target.find(".comment_controls a.flag_link").unbind("click").bind("click",function(){var $this=$(this),br="%0A",mailto="mailto:blogadmin@forbes.com";mailto+="?subject="+encodeURIComponent("Flag comment abuse");mailto+="&body=Flagged Comment:"+br+encodeURIComponent($this.parent().find("a.permalink").attr("href"));var username=$this.parents("li").find(".entity_block a.user_name");if(username.length>0){mailto+=br+br+"Comment authored by: "+username.text();}mailto+=br+br+"--"+br+br+"Please describe your concern with this comment:";mailto+=br+br+br+"--"+br+br+"Your Name:";mailto+=br+br+br+"--"+br+br+"Thank you for reporting this issue. Forbes staff will review your concern.";window.location=mailto;return false;});}function _init_reply_links($target){var $comment_reply=$target.find(".comment_reply");$target.find("li.comment .comment_controls a.reply").unbind("click").bind("click",function(){var $parent_comment=$(this).parents("li.comment"),parent_id=$parent_comment.attr("data-comment-wp-id"),$insert_anchor,$resize_parent_group;$comment_reply.find('form.comment_reply_form input[name="comment_parent"]').val(parent_id);if($parent_comment.length>0){$comment_reply.addClass("inline").find("div.reply_header").show();if($parent_comment.parents("li.collapsable_group.level1").length>0){$insert_anchor=$parent_comment.parents("li.collapsable_group.level1");}else{$insert_anchor=$parent_comment;}if($comment_reply.parents("li.collapsable_group").length>0){if($comment_reply.parents("li.collapsable_group").index()!=$parent_comment.parents("li.collapsable_group").index()){$resize_parent_group=$comment_reply.parents("li.collapsable_group");}}$comment_reply.detach().insertAfter($insert_anchor);if(typeof $resize_parent_group!="undefined"){_expand_group($resize_parent_group);}if($insert_anchor.parents("li.collapsable_group").length>0){var group=$parent_comment.parents("li.collapsable_group");group.height(parseInt(group.attr("data-expanded-height"),10)+$comment_reply.outerHeight()+15);}}forbes.util.scroll_to_obj($target.find(".comment_reply"),{duration:250,valign:true});return false;});$comment_reply.find("a.cancel_reply").unbind("click").bind("click",function(){var parent_comment=$target.find(".comment_reply").prev();_reset_comment_reply($target);if(parent_comment.parents("li.collapsable_group").length>0){_expand_group(parent_comment.parents("li.collapsable_group"));}if(parent_comment.length>0){forbes.util.scroll_to_obj(parent_comment,{duration:250,valign:true});}return false;});}function _reset_comment_reply($target){var $comment_reply=$target.find(".comment_reply");if($comment_reply.hasClass("inline")){$comment_reply.find(".reply_header").hide();$comment_reply.find('form.comment_reply_form input[name="comment_parent"]').val("0");$comment_reply.removeClass("inline").detach().appendTo($target.find(".comment_form_orig_position"));}}function _init_badges($target){$target.find('.comment[data-badges-init!="true"]').each(function(index){var $this=$(this),advoice_badge=$this.attr("data-badges-advoice");if($this.hasClass("advoice")){if($this.hasClass("author")){$this.prepend('<div class="badge">'+advoice_badge+"Voice Author</div>");}else{$this.prepend('<div class="badge">'+advoice_badge+"Voice</div>");}}if($this.hasClass("author")){if($this.hasClass("advoice")){}else{$this.prepend('<div class="badge">'+advoice_badge+"Author</div>");}}$this.attr("data-badges-init","true");});}function _init_threading($target){$target.find('.comment[data-threading-init!="true"]').each(function(index){var $this=$(this);if($this.hasClass("level0")&&$this.next().hasClass("level1")){$this.next().addClass("first_reply");}$this.attr("data-threading-init","true");});}function _admin_init($target){var edit_post_link=$target.find(".comments_well").attr("data-edit-post-link");if(typeof edit_post_link!=="undefined"&&edit_post_link!==""){$target.find(".comments_well .comments_stream li.comment").each(function(){_init_call_out_button($target,this);});}}function _init_call_out_button($target,comment_obj){var called_out_state=$(comment_obj).find(".comment_controls").attr("data-called-out-state");if(called_out_state=="on"){$(comment_obj).find(".comment_controls .right_col").prepend('<a href="#" class="call_out_control" data-action="undo_call_out">Undo Call Out</a>');}else{if(called_out_state=="off"){$(comment_obj).find(".comment_controls .right_col").prepend('<a href="#" class="call_out_control" data-action="call_out">Call Out</a>');}}$(comment_obj).find(".comment_controls .right_col .call_out_control").unbind("click").click(function(){var call_out_control_obj=this,id=$(comment_obj).attr("data-comment-id");id=id.replace("comment_blogAndPostId/blog/comment/","");var id_parts=id.split("-"),action=$(call_out_control_obj).attr("data-action");var ppi_action=null;if(action=="call_out"){ppi_action="on";}else{if(action=="undo_call_out"){ppi_action="off";}}if(!!ppi_action){$.post("/wp-admin/admin-ajax.php",{action:"ppi_cicero_comment_callout",callout:ppi_action,blogid:id_parts[0],postid:id_parts[1],commentid:id_parts[2]},function(data){if(!!data){if(action=="call_out"){$(call_out_control_obj).attr("data-action","undo_call_out");$(call_out_control_obj).html("Undo Call Out");$(comment_obj).removeClass("collapsable").addClass("calledOut");}else{if(action=="undo_call_out"){$(call_out_control_obj).attr("data-action","call_out");$(call_out_control_obj).html("Call Out");$(comment_obj).removeClass("calledOut").addClass("collapsable");}}$target.find(".comments_stream .collapsable_group").not(".collapsed").find(".comment").addClass("expanded");$target.find("li.comment").removeClass("grouped").removeClass("initialized");var commentElements=$target.find("li.comment").detach();$target.find(".comments_stream").empty().append(commentElements);commentElements=null;$target.find(".comments_stream .comment_events").remove();_init_collapsable_comments($target);$target.find("li.comment.grouped.expanded").parents(".collapsable_group").each(function(){_expand_group($(this));});}else{forbes.util.debug("ERROR: Received negative AJAX response.");}return false;});}return false;});}function _init_collapsable_comments($target){var html="";html+='<li class="collapsable_group round_bottom_corners">';html+='<div class="header controls">';html+='<div class="expand_control">';html+="<span>[expandmessage]</span>";html+="</div>";html+='<div class="collapse_control" style="display:none;">';html+="<span>[collapsemessage]</span>";html+="</div>";html+="</div>";html+="<ul></ul>";html+="</li>";for(var i=0,len=$target.find("li.comment").length;i<len;i++){var $this=$target.find("li.comment").eq(i);if($this.hasClass("grouped")){continue;}if($this.hasClass("collapsable")){var found_match=true,grouping=[];grouping.push($this);$this.addClass("grouped");var first_level=($this.hasClass("level0"))?"level0":"level1";while(found_match){i++;var $next=$target.find("li.comment").eq(i);if($next.hasClass("collapsable")&&$next.hasClass(first_level)){grouping.push($next);$next.addClass("grouped");}else{if($next.hasClass("collapsable")){i=(i-1);}found_match=false;}}var expand_message="+ expand comment",collapse_message="- collapse comment";if(grouping.length>1){expand_message="+ expand "+grouping.length+" comments";collapse_message+="s";}var new_html=html.replace("[expandmessage]",expand_message);new_html=new_html.replace("[collapsemessage]",collapse_message);var collapsable_group=$(new_html).insertBefore($this);if($this.hasClass("level1")){collapsable_group.addClass("level1");}if($this.hasClass("first_reply")){$this.removeClass("first_reply");collapsable_group.addClass("first_reply");collapsable_group.prepend('<div class="reply_arrow"></div>');}collapsable_group.attr("data-num-collapsed",grouping.length);for(var cur=0;cur<grouping.length;cur++){grouping[cur].detach().appendTo(collapsable_group.find("ul"));}collapsable_group.find(".comment:first").css({"margin-top":0});collapsable_group.attr("data-expanded-height",collapsable_group.height());if(collapsable_group.prev().length===0||(!collapsable_group.hasClass("level1")&&collapsable_group.prev().hasClass("level1"))){collapsable_group.addClass("needs_top_margin");}if(!collapsable_group.hasClass("level1")){collapsable_group.find(".header");}}}$target.find("li.collapsable_group").each(function(){var _self=$(this);_self.css({overflow:"hidden",height:_self.find(".header").position().top+_self.find(".header").outerHeight()});_self.addClass("collapsed");_self.addClass("initialized");_self.find(".header.controls span").unbind("click").bind("click",function(){var group=$(this).parent().parent().parent();if(!group.hasClass("collapsed")){_collapse_group(group);}else{_expand_group(group);}return false;});});var comment_events_html='<ul class="comment_events"><li class="call_outs"><div class="icon"></div>Called-out comment</li></ul>';$target.find("li.comment.calledOut .comment_content").after(comment_events_html);}function _init_no_called_out($target){$target.find("li.no_calledout .no_calledout_header span").off("click").on("click",function(event){var expand_li=$(this).parent().parent().parent(),expand_url=expand_li.attr("data-expand-url");if($target.hasClass("loading_mode")){return false;}$target.find("ul.horznav li").removeClass("active");$target.find("ul.horznav li").last().addClass("active");_load_comments_stream($target,expand_url);return false;});}function _init_main_comment_nav($target){$target.find("ul.horznav li").off("click").on("click",function(event){var $this=$(this),nav_group_url=$this.find("a").attr("href");if($target.hasClass("loading_mode")){return false;}$target.find("ul.horznav li").removeClass("active");$(this).addClass("active");_load_comments_stream($target,nav_group_url);return false;});}function _expand_group(group){var header=group.find(".header");group.removeClass("collapsed");group.find(".expand_control").hide();group.find(".collapse_control").show();group.stop().animate({height:parseInt(group.attr("data-expanded-height"),10)+"px"},{duration:parseInt(group.attr("data-num-collapsed"),10)*65,easing:"easeInCubic"});}function _collapse_group(group){var header=group.find(".header");group.addClass("collapsed");group.find(".expand_control").show();group.find(".collapse_control").hide();group.stop().animate({height:header.position().top+header.outerHeight()},{duration:parseInt(group.attr("data-num-collapsed"),10)*65,easing:"easeOutCubic"});}function _check_comment_mode($target){var stream_flag=$target.find("ul.horznav li.active a").attr("rel");if(stream_flag=="calledOut"){$target.find("li.collapsable_group").each(function(){_collapse_group($(this));});}else{if(stream_flag=="allComments"){$target.find("li.collapsable_group").each(function(){_expand_group($(this));});_expand_collapsed_comments($target);}}}function _init_pagination_links($target){$target.find("nav.pagination ul li a").off("click").on("click",function(event){var $this=$(this),is_disabled=$this.parent().hasClass("disabled");if(is_disabled!==true){_load_comments_stream($target,$this.attr("href"));}return false;});}function _load_comments_stream($target,ajax_url){forbes.util.scroll_to_obj($target,{duration:300});$.ajax({type:"get",url:ajax_url,data:{ajax:"true"},dataType:"html",timeout:10*1000,cache:false,error:function(e,textStatus,errorThrown){debug("error loading: "+ajax_url);debug("error textStatus: "+textStatus);debug("error errorThrown: "+errorThrown);},success:function(data){$target.find(".comments_well").html(data);_update($target);_init_page_ui($target);_init_no_called_out($target);_check_comment_mode($target);}});}function _init_comment_bugs($target){if($(".comment_bug").length<1){return false;}$(".comment_bug").each(function(i){var $bug=$(this);if($bug.hasClass("initialized")){return true;}_draw_comment_bugs($target,$bug);if($bug.find(".called_out_sampling a.head").length<1){$bug.children().each(function(){var $child=$(this);if($child.is("div")){$child.hide();}});$bug.find(".no_comment_bugs_exist_yet").show();$bug.css({height:"auto"});return true;}if($bug.parent().prop("tagName").toLowerCase()==="hgroup"){$bug.addClass("article_header");}else{$bug.addClass("article_footer");}$bug.find("a.head").unbind("mouseenter").bind("mouseenter",function(){_expand_comment_bug($(this));});$bug.find(".called_out_sampling").unbind("mouseleave").bind("mouseleave",function(){$(this).parent().parent().removeClass("show_teaser");$(this).find("a.head").each(function(){$(this).css({opacity:1});});});$bug.addClass("initialized");});}function _draw_comment_bugs($target,$bug){var i=0,feature_limit=$bug.hasClass("comment_bug_2")?4:7;$bug.find(".called_out_sampling").html("");$target.find("li.comment").each(function(){if(i>=feature_limit){return false;}if($(this).hasClass("collapsable")){return true;}var $this=$(this),avatar_src=$this.find('a.avatar img[class!="favicon"]').attr("src"),user_name=$this.find(".entity_block a.user_name").text();var feature_html="";feature_html+='<a class="head" href="#'+$this.attr("id")+'" data-comment-wp-id="'+$this.attr("data-comment-wp-id")+'">';feature_html+='<img height="20" width="20" src="'+avatar_src+'" />';feature_html+='<span class="name">'+user_name+"</span>";if($this.find(".entity_block span.desc").length>0){feature_html+='<span class="desc">'+$this.find(".entity_block span.desc").text()+"</span>";}var excerpt_html="",comment_content=$this.find(".comment_content p:first-child").text();if(comment_content.length>155){excerpt_html+=comment_content.substring(0,155);excerpt_html+=" [...]";}else{excerpt_html+=comment_content;}feature_html+='<span class="comment">';feature_html+=excerpt_html;feature_html+="</span>";feature_html+="</a>";$bug.find(".called_out_sampling").append(feature_html);i++;});$bug.find(".called_out_sampling a").unbind("click").bind("click",function(e){var $this=$(this);e.preventDefault();forbes.util.scroll_to_obj($("li.comment[data-comment-wp-id="+$this.attr("data-comment-wp-id")+"]"),{duration:800,valign:true,highlight:true});_expand_collapsed_comments($target);});$bug.show();}function _expand_comment_bug(target_obj){var comment_bug=target_obj.parent().parent().parent(),cur_head=target_obj;comment_bug.find("a.head").each(function(){$(this).css({opacity:0.3});});cur_head.css({opacity:1});comment_bug.find(".bottom_border").width(parseInt(comment_bug.find(".wrapper").width(),10));var new_html="";new_html+='<img src="'+cur_head.find("img").attr("src")+'" alt="" />';new_html+="<p>";new_html+="<strong>"+cur_head.find("span.name").text()+"</strong>";if(cur_head.find("span.desc").text().length>2){new_html+="<em>"+cur_head.find("span.desc").text()+"</em> ";}new_html+="</p>";new_html+="<p>";new_html+=cur_head.find("span.comment").text();new_html+="</p>";comment_bug.find(".comment_teaser").html(new_html);if(comment_bug.hasClass("show_teaser")&&!comment_bug.hasClass("article_footer")){return false;}comment_bug.addClass("show_teaser");if(!comment_bug.hasClass("article_footer")){comment_bug.find(".comment_teaser").stop().css({opacity:0}).animate({opacity:1},200);}}function _setup_initial_state($module){if($module.data("allow_init_collapse")===1){_collapse_content($module);}}function _collapse_content($module){var height=0;$module.css({overflow:"hidden",height:height});}function _expand_collapsed_comments($module){$module.css({height:"auto"});}function _init_body_comment_links($comments_collection){var $article_container=$comments_collection.parents(".article_container");$article_container.find(".body_inner").on("click",'a[href="#comment_reply"]',function(e){e.preventDefault();_expand_collapsed_comments($comments_collection);forbes.util.scroll_to_obj($comments_collection,{duration:500});});}return{init:_init,expand_collapsed_comments:_expand_collapsed_comments};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register(forbes.comments_v2.init);var forbes=(function(app,$){app.comment_form_v2=(function($){var _imagesBaseCdn=null,debug=null;function _init(){debug=forbes.util.debug;_imagesBaseCdn=$("body").attr("data-images-base-cdn");_init_comment_auth_links();_init_comment_textarea();_init_form();}function _init_form(){forbes.auth.init();if(!forbes.auth.user().logged_in){return false;}$(".comment_reply form .control_bar").show();$(".comment_reply").each(function(){var $this=$(this),$form=$this.find("form.comment_reply_form"),on_success_reload_url=$form.data("reload-url");if($this.hasClass("initialized")){return true;}$form.prepend("<input type='hidden' name='_comment_nonce' value='"+$form.attr("data-comment-nonce")+"'/>");forbes.forms.init({selector:$form,on_complete:function(json){forbes.util.debug("comment submitted:");forbes.util.debug(json);if(typeof json.success!="undefined"){_comment_success({comment:json.comment_text_escaped,comment_approved:json.comment_approved,on_success_reload_url:on_success_reload_url,social_share:json.social_share});}return true;}});$this.addClass("initialized");});}function _init_comment_auth_links(){$(".comment_reply_form a.ajaxify").not(".unireg_logout").unbind("click").bind("click",forbes.auth.handle_auth_links);}function _init_comment_textarea(){var comment_ta=$("textarea.user_comment");comment_ta.unbind("focus").bind("focus",function(){if(!forbes.auth.user().logged_in){forbes.auth.login({reason:{task:"commenting"}});return false;}var $this=$(this);if($this.hasClass("initial_text")&&$this.val()==$this.attr("data-initial-text")){$this.val("");$this.removeClass("initial_text");}});comment_ta.unbind("blur").bind("blur",function(){var $this=$(this);if(!$this.hasClass("initial_text")&&($this.val()==$this.attr("data-initial-text")||$this.val()===""||$this.val()==" ")){$this.addClass("initial_text");$this.val($this.attr("data-initial-text"));}});if(comment_ta.hasClass("initial_text")&&comment_ta.val()!=comment_ta.attr("data-initial-text")){comment_ta.removeClass("initial_text");}}function _comment_success(results){var on_success_reload_url=results.on_success_reload_url;var success_html="";success_html+='<div class="modal_screen comment_success">';success_html+='<div class="main">';success_html+='<p class="large">';success_html+="Thank you for submitting your comment:";success_html+="</p>";if(results.comment_approved){success_html+="<p>";success_html+="New comments typically appear within 30 seconds.";success_html+="</p>";}success_html+="<blockquote>";success_html+="<p>";success_html+=results.comment.replace(/\n\r?/g,"<br />");success_html+="</p>";success_html+="</blockquote>";if(!results.comment_approved){success_html+='<p class="large">';success_html+="<strong>Please note:</strong> Your comment will be reviewed by Forbes staff before appearing on the site.";success_html+="</p>";}if(!!results.social_share){success_html+=results.social_share;}success_html+='<div id="dfp-sociallogo"></div>';success_html+="</div>";success_html+="</div>";forbes.modal_window.load({html:success_html,parse_rules:null,params:null,on_cancel:function(){window.location=on_success_reload_url;},on_complete:function(load_target){if($("body").hasClass("body_article")===false){_init_ad();}else{forbes.util.debug("new template");}}});}function _init_ad(){if(forbes.ad_manager){forbes.ad_manager.display([{id:"sociallogo",sizes:[[120,40]]}]);}else{return false;}}return{init:_init,comment_success:_comment_success};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register(forbes.comment_form_v2.init);"use strict";var forbes=(function(app,$){app.share_comment_with=function(share_with,comment_id,blog_id,btn){$.ajax({url:"/wp-admin/admin-ajax.php",dataType:"json",data:{action:"share-comment",share_with:share_with,comment_id:comment_id,blog_id:blog_id},success:function(r){btn.removeClass("clicked").addClass("completed");},error:function(){btn.removeClass("clicked").addClass("error");}});};return app;}(forbes||{},jQuery));jQuery("body").on("click",".forum-share-my-comment .forum-btn",function(e){var is_linked=jQuery(this).hasClass("linked"),share_with=jQuery(this).attr("data-share-with"),comment_id=jQuery(this).parents(".forum-share-my-comment").attr("data-comment-id"),blog_id=jQuery(this).parents(".forum-share-my-comment").attr("data-blog-id"),btn=jQuery(this);if(btn.hasClass("clicked")||btn.hasClass("completed")){return;}btn.addClass("clicked");if(!is_linked){gigya.socialize.addConnection({callback:function(r){if(r.errorCode==0){forbes.share_comment_with(share_with,comment_id,blog_id,btn);}else{btn.removeClass("clicked").addClass("error");}},provider:share_with});}else{if("facebook"===share_with){if(jQuery(this).hasClass("no-perm")){gigya.socialize.requestPermissions({callback:function(r){if(r.errorCode==0){forbes.share_comment_with(share_with,comment_id,blog_id,btn);}else{btn.removeClass("clicked").addClass("error");}},permissions:"publish_actions",provider:share_with});}else{forbes.share_comment_with(share_with,comment_id,blog_id,btn);}}else{forbes.share_comment_with(share_with,comment_id,blog_id,btn);}}});var forbes=(function(app,$){app.email_contributor=(function($){function _init(){debug=forbes.util.debug;_init_email_contrib_launchers();}function _init_email_contrib_launchers(){$("a.ajaxify.launch_email_contrib").unbind("click").bind("click",function(){var contact_allowed=$(this).data("enable-contact");debug("contact_allowed"+contact_allowed);debug("contact_allowed"+typeof contact_allowed);if(contact_allowed==true){if(!forbes.auth.user().logged_in){forbes.auth.login({reason:{task:"emailContributor"}});return false;}var contrib_name=$(this).data("contrib-name");var contrib_email=$(this).data("contrib-email");var user_email=$(this).data("user-email");var user_name=$(this).data("user-name");_launch(contrib_name,contrib_email,user_email,user_name);}return false;});}function validateEmail(){var uemail=$("#email_form_user_email").val();var mailformat=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;if(uemail==""){return true;}if(uemail.match(mailformat)){$("label[for='user_email']").html("Email");$("#email_form_subject").css("background","#fff").focus();return true;}else{$("label[for='user_email']").html('Email <span class="error">Please enter a valid email</span>');$("#email_form_user_email").css("background","#ffc").focus();return false;}}function check_subject(){if($("#email_form_subject").val().length>0){$("label[for='email_subject']").html("Subject*");$("#email_form_subject").css("background","#fff").focus();return true;}else{$("label[for='email_subject']").html('Subject*  <span class="error">Please enter a subject line for your email</span>');$("#email_form_subject").css("background","#ffc").focus();return false;}}function check_message(){if($("#email_form_body").val().length>0){$("label[for='email_body']").html("Message*");$("#email_form_subject").css("background","#fff").focus();return true;}else{$("label[for='email_body']").html('Message*  <span class="error">Please enter a message for your email</span>');$("#email_form_body").css("background","#ffc").focus();return false;}}function _launch(contrib_name,contrib_email,user_email,user){_mode="modal";var email_form_html="";email_form_html+='<div class="modal_screen email_contributor">';email_form_html+='<div class="heading">';email_form_html+="	<h2>Contact "+contrib_name+"</h2>";email_form_html+='	<div class="shelf_shadow"></div>';email_form_html+="</div>";email_form_html+='<div class="main">';email_form_html+='	<form id="following_form" class="forbes_forms v1" name="user" action="/add" method="post">';email_form_html+='		<div class="input_block clearfix">';email_form_html+='			<div class="col1">';email_form_html+='				<label for="user_name">Name</label>';email_form_html+='				<input class="textbox user_name" type="text"  name="user_name" value="'+user+'" id="email_form_user_name">';email_form_html+="			</div>";email_form_html+='			<div class="col2">';email_form_html+='				<label for="user_email">Email </label>';email_form_html+='				<input class="textbox email" type="text" name="user_email" value="'+user_email+'" id="email_form_user_email">';email_form_html+="			</div>";email_form_html+="		</div>";email_form_html+='		<div class="input_block">';email_form_html+='			<label for="email_subject">Subject* </label>';email_form_html+='			<input class="textbox subject" type="text" name="email_subject" value="" id="email_form_subject">';email_form_html+="		</div>";email_form_html+='		<div class="input_block">';email_form_html+='			<label for="email_body">Message* </label>';email_form_html+='			<textarea class="textarea" name="email_body" value="" id="email_form_body"></textarea>';email_form_html+='			<input type ="hidden" name="contrib_email" value="'+contrib_email+'"/>';email_form_html+='			<input type ="hidden" name="contrib_author" value="'+contrib_name+'"/>';email_form_html+="		</div>";email_form_html+='		<a data-submit-button="true" class="fancy_button submit">';email_form_html+='			<span class="outer">';email_form_html+='				<span class="inner">';email_form_html+='					<span class="icon"></span>';email_form_html+='					<span class="label">Send</span>';email_form_html+="				</span>";email_form_html+="			</span>";email_form_html+="		</a>";email_form_html+='		<div class="small_required">*Required field</div>';email_form_html+="	</form>";email_form_html+="</div>";email_form_html+="</div>";var success_html="";success_html+='<div class="modal_screen email_contributor">';success_html+='<div class="heading">';success_html+="	<h2>Thank You</h2>";success_html+='	<div class="shelf_shadow"></div>';success_html+="</div>";success_html+='<div class="main">';success_html+="	<h3>Your email has been sent to "+contrib_name+".</h3>";success_html+='		<a data-submit-button="true" class="fancy_button close_win">';success_html+='			<span class="outer">';success_html+='				<span class="inner">';success_html+='					<span class="icon"></span>';success_html+='					<span class="label">Close</span>';success_html+="				</span>";success_html+="			</span>";success_html+="		</a>";success_html+="</div>";success_html+="</div>";var error_html="";error_html+='<div class="modal_screen email_contributor">';error_html+='<div class="heading">';error_html+="	<h2>Sorry</h2>";error_html+='	<div class="shelf_shadow"></div>';error_html+="</div>";error_html+='<div class="main">';error_html+="	<h3>Your email could not be sent to "+contrib_name+". Please try again.</h3>";error_html+='		<a data-submit-button="true" class="fancy_button close_win">';error_html+='			<span class="outer">';error_html+='				<span class="inner">';error_html+='					<span class="icon"></span>';error_html+='					<span class="label">Close</span>';error_html+="				</span>";error_html+="			</span>";error_html+="		</a>";error_html+="</div>";error_html+="</div>";var booleanValidateEmail=false;var booleanValidateSubject=false;var booleanValidateMessage=false;forbes.modal_window.load({html:email_form_html,on_cancel:function(){forbes.modal_window.destroy();},on_complete:function(load_target){load_target.find("#email_form_user_email").change(function(){validateEmail();});load_target.find("#email_form_subject").change(function(){check_subject();});load_target.find("#email_form_body").change(function(){check_message();});load_target.find(".fancy_button.submit").unbind("click").bind("click",function(){booleanValidateEmail=validateEmail();booleanValidateSubject=check_subject();booleanValidateMessage=check_message();if(booleanValidateEmail&&booleanValidateSubject&&booleanValidateMessage){var url="/add";$.ajax({type:"POST",url:url,data:$("#following_form").serialize(),success:function(response){if(response=="success"){forbes.modal_window.load({html:success_html,on_cancel:function(){forbes.modal_window.destroy();}});}else{forbes.modal_window.load({html:error_html,on_cancel:function(){forbes.modal_window.destroy();}});}$(".fancy_button.close_win").unbind("click").bind("click",function(){forbes.modal_window.destroy();});}});}else{}return false;});}});}return{init:_init,init_email_contrib_launchers:_init_email_contrib_launchers};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register(forbes.email_contributor.init);var forbes=(function(app,$){app.article_responsive_vestpocket=(function($){var $log=_log_wrapper,$log_group=_log_group_wrapper,$log_group_end=_log_group_end_wrapper,_log_enabled=false,_initialized=false;function _init(){if(_initialized){return;}var $article_container_0=$("#article_container_0"),word_count=$article_container_0.find(".body_inner").text().split(" ").length-1;$article_container_0.data("word-count",word_count);_initialized=true;}function _log_wrapper(input){if(_log_enabled){forbes.util.log(input);}}function _log_group_wrapper(input){if(_log_enabled){forbes.util.log_group(input);}}function _log_group_end_wrapper(input){if(_log_enabled){forbes.util.log_group_end(input);}}function _init_vestpocket_items($context){var $vp_wrapper=$context.find(".vp-wrapper");if($vp_wrapper.hasClass("initialized")){return;}var $vp_holder=$context.find(".vestpocket"),$vp_boxes=$vp_holder.find(".vp-box"),vp_count=$vp_boxes.length;if(vp_count<1){$vp_wrapper.addClass("initialized");return;}forbes.event_tracking.track_ga_event(["VestPocket","Impression","curated-"+vp_count]);$vp_boxes.each(function(idx){var $link=$(this).find("a"),vp_url=$link.attr("href"),vp_number=idx+1;$link.on("click",function(){forbes.event_tracking.track_ga_event(["VestPocket","StoryClick-"+vp_number,vp_url]);});});$vp_wrapper.append($vp_boxes);$vp_wrapper.addClass("initialized");_update_vestpocket_nodes($context);}function _update_vestpocket_nodes($context){var $vp_wrapper=$context.find(".vp-wrapper"),$vp_box=$vp_wrapper.find(".vp-box"),vp_box_count=$vp_box.length,word_count=$context.data("word-count"),wide_ads=false,$comments;if(vp_box_count===0){return;}word_count=$context.data("word-count");$log($context.find(".topx_ad_wide"));if($context.find(".topx_ad_wide").length>0){wide_ads=true;}$comments=$vp_wrapper.find(".vp-comment");if($comments.length>0){$comments.addClass("vp-visible");}if(word_count<650||wide_ads){_toggle_excess_vestpockets($context,wide_ads);}else{_space_out_vestpockets($context);}}function _toggle_excess_vestpockets($context,wide_ads){var content_height=$context.find(".article_content").height(),entity_height=$context.find(".article_entity").height(),$vp_wrapper=$context.find(".vp-wrapper"),$vp_box=$vp_wrapper.find(".vp-box"),vp_wrapper_height=0,first_wide_ad_position=0;if(wide_ads){first_wide_ad_position=$context.find(".topx_ad_wide").first().position().top;vp_wrapper_height=first_wide_ad_position-entity_height-50;$vp_box.css({"margin-top":0});}else{vp_wrapper_height=content_height-entity_height-50;}$vp_wrapper.height(vp_wrapper_height);$vp_box.each(function(idx){var $this=$(this),height=$this.outerHeight(true),position=$this.position().top;if(idx===0||idx===1){return;}if((position+height)>vp_wrapper_height){$this.removeClass("vp-visible");}else{$this.addClass("vp-visible");}});}function _space_out_vestpockets($context){var content_height=$context.find(".article_content").height(),entity_height=$context.find(".article_entity").height(),$vp_wrapper=$context.find(".vp-wrapper"),$vp_box=$vp_wrapper.find(".vp-box"),$vp_boxes=null,remaining_height=0,native_ad_height=$vp_box.filter(".vp-native").outerHeight(true),comment_height=$vp_box.filter(".vp-comment").outerHeight(true),vp_box_height=0,vp_box_count=0,top_margin=0;remaining_height=content_height-(entity_height+native_ad_height+comment_height);$vp_boxes=$vp_box.filter(function(idx){return idx!==0&&idx!==1;});$vp_boxes.each(function(idx){var $this=$(this);vp_box_height+=$this.height()+parseInt($this.css("margin-bottom"),10);vp_box_count++;});if(vp_box_count===0){return;}if(vp_box_count===1){top_margin=0;}else{top_margin=((remaining_height-vp_box_height)/vp_box_count)/1.5+100;}$vp_boxes.animate({"margin-top":top_margin},200).addClass("vp-visible");}return{init:_init,init_vestpocket_items:_init_vestpocket_items,update_vestpocket_nodes:_update_vestpocket_nodes};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register(forbes.article_responsive_vestpocket.init);var forbes=(function(app,$){app.article_responsive=(function($){var debug=null,_push_state=_has_push_state(),_initialized=false;function _init(){if(_initialized){return;}debug=forbes.util.debug;var _cookie_name="_forbes_overlay";_init_scroll_to_links();$("iframe.youtube-player").each(function(){var url=$(this).attr("src");$(this).attr("src",url+"?wmode=transparent");});forbes.util.prevent_widows();_strip_empty_paragraphs({"$target":$(".article_body .body")});forbes.article_responsive_vestpocket.init_vestpocket_items($("#article_container_0"));forbes.article_responsive_entity_block.init();_on_resize();_on_scroll();_init_window_events();_init_report_corrections();}function _init_from_around_the_web(){var $ca_location=$(".ca_location"),elPos,windowPos,elInWindow;$.each($ca_location,function(key,value){if(!$(this).hasClass("ca_loaded")){$("#contentad9177").html("");$(this).addClass("ca_loaded");$("#contentad9177").insertAfter($(this));var params={id:"c50e9959-4275-437e-adfc-0f52839111b0",d:"Zm9yYmVzLmNvbQ==",wid:"9177",cb:(new Date()).getTime(),url:"http://forbes.com/",loadMultiple:1},querystring="";for(var param_key in params){querystring+=param_key+"="+params[param_key]+"&";}querystring=querystring.substring(0,querystring.length-1);var scriptelem=document.createElement("script");scriptelem.type="text/javascript";scriptelem.src="http://api.content.ad/Scripts/widget.aspx?"+querystring;scriptelem.async=true;this.appendChild(scriptelem);}});}function _init_window_events(){$(window).on("resize",$.throttle(250,_on_resize)).on("scroll",$.throttle(250,_on_scroll));}function _init_media_net_related_links($target){var $link_holder=$target.find(".media_net_related_links"),parent_id=$target.attr("id"),id_marker="article_container_",id_num=parent_id.substring(id_marker.length),new_id="media_net_"+id_num,data_uri="/"+$target.data("uri");if($link_holder.hasClass("initialized")){return;}$link_holder.attr("id",new_id).addClass("initialized");try{window._mNHandle.queue.push(function(){window.medianet_requrl=data_uri;window._mNDetails.loadTag(new_id,"800x200","692537066");});}catch(error){debug("error attempting to run window._mNDetails.loadTag in related links");debug("error:");debug(error);}}function _init_media_net_speed_bump($target){var $link_holder=$target.find(".media_net_moreon"),parent_id=$target.attr("id"),id_marker="article_container_",id_num=parent_id.substring(id_marker.length),new_id="media_net_speed_bump_"+id_num,data_uri="/"+$target.data("uri");if($link_holder.hasClass("initialized")){return;}$link_holder.attr("id",new_id).addClass("initialized");try{window._mNHandle.queue.push(function(){window.medianet_requrl=data_uri;window._mNDetails.loadTag(new_id,"970x250","671845155");});}catch(error){debug("error attempting to run window._mNDetails.loadTag in more on");debug("error:");debug(error);}}function _on_scroll(){var scroll_pos=$(window).scrollTop(),win_height=$(window).height(),$body=$("body");if(win_height<500&&scroll_pos<100){if(!$body.hasClass("mini_height_mode")){$(".next_article_tab").stop().animate({opacity:0},{duration:100,easing:"easeInOutQuad"});$(".sticky_sharing").stop().animate({opacity:0},{duration:100,easing:"easeInOutQuad"});$body.addClass("mini_height_mode");}}else{if($body.hasClass("mini_height_mode")){$(".next_article_tab").stop().animate({opacity:1},{duration:100,easing:"easeInOutQuad"});$(".sticky_sharing").stop().animate({opacity:1},{duration:100,easing:"easeInOutQuad"});$body.removeClass("mini_height_mode");}}}function _on_resize(){var win_width=$(window).width();if(win_width<1200){$(".speed_bump").find(".row .col-sm-4").removeClass("col-sm-4").addClass("col-sm-6");}else{$(".speed_bump").find(".row .col-sm-6").removeClass("col-sm-6").addClass("col-sm-4");}if(win_width<980){$(".next_article_tab").addClass("force_left");}else{$(".next_article_tab").removeClass("force_left");}if(forbes.article_responsive_entity_block){forbes.article_responsive_entity_block.update_ui();}$(".article_container.container").each(function(){var $this=$(this);forbes.article_responsive_vestpocket.update_vestpocket_nodes($this);});}function _filter_article_lead_images($target){var $body=$target.find(".article_body .body");$body.children().each(function(i){var $child=$(this);if(($child.is("div.wp-caption"))&&i===0){if(i===0){if($child.width()>($body.width()/2)){$child.addClass("revealed");}else{$child.remove();}}else{$child.addClass("revealed");}}else{if($child.is("div.zemanta-img")){if(i===0){if($child.find(".wp-caption").length>0){$child.remove();}else{if($child.find(".wp-caption").width()>($body.width()/2)){$child.addClass("revealed");}else{$child.remove();}}}else{$child.addClass("revealed");}}else{if($child.is("p")){if(i===0){if($child.find("img.alignright").length>0){var $img_node=$child.find("img.alignright");if($img_node.width()<($body.width()/2)){if($img_node.parent().is("a")){$img_node.parent().remove();}else{$img_node.remove();}}}}}}}});$body.find(".alignright, .alignleft").addClass("revealed");}function _init_scroll_to_links(){if($("a.scroll_to").length<1){return false;}$("a.scroll_to[href*=#][data-initialized!=true]").each(function(e){_scroll_to_link($(this));});}function _scroll_to_link($link){var $this=$link,hash=$this.attr("href").slice(1),$parent_article=$this.parents("div.article_container"),$target=$parent_article.find("."+hash);$this.off("click").on("click",function(){var find_container=_pre_open_container($link);forbes.util.scroll_to_obj($target,{duration:500});return false;});$this.attr("data-initialized","true");}function _pre_open_container($link){var container_found=false,$this=$link,$parent_article=$this.parents("div.article_container"),$comments_collection=null;if(typeof forbes.comments_v2==="undefined"){return;}if($this.hasClass("post_your_comment")||$this.hasClass("post_first_comment")){container_found=true;$comments_collection=$parent_article.find(".comments_collection");forbes.comments_v2.expand_collapsed_comments($comments_collection);}else{if($this.attr("href")==="#comments_header"){$comments_collection=$parent_article.find(".comments_collection");forbes.comments_v2.expand_collapsed_comments($comments_collection);}}return container_found;}function _init_report_corrections(){$(".article_actions .corrections a").unbind("click").bind("click",function(){var $this=$(this),br="%0D%0A",mailto="mailto:corrections@forbes.com",title=encodeURIComponent($this.parents(".row").find("hgroup h1").text()),url=encodeURIComponent($(location).attr("href"));mailto+="?subject="+encodeURIComponent("Report Correction");mailto+="&body=Reporting correction for:"+br+br;mailto+="Title: "+title;mailto+=br+"URL: "+url;mailto+=br+br+"--"+br+br;mailto+="Your Name:"+br;mailto+="Correction Request:";mailto+=br+br+br+"--"+br+br+"Thank you for reporting a correction. Forbes staff will review your concern.";window.location=mailto;return false;});}function _update_ui(options){var $scope=options.$target;debug($scope);_init_media_net_related_links($scope);_init_media_net_speed_bump($scope);_init_scroll_to_links();if(forbes.article_responsive_vestpocket){forbes.article_responsive_vestpocket.init_vestpocket_items($scope);}if(forbes.article_responsive_entity_block){forbes.article_responsive_entity_block.init();}if(forbes.email_contributor){forbes.email_contributor.init_email_contrib_launchers();}if(forbes.quotecard){forbes.quotecard.init();}if(forbes.comments_v2){forbes.comments_v2.init();}if(forbes.comment_form_v2){forbes.comment_form_v2.init();}if(forbes.most_popular){forbes.most_popular.init();}if(forbes.brightcove){forbes.brightcove.init();}if(forbes.advoice_specific){forbes.advoice_specific.init();}if(forbes.article_next_instructional){forbes.article_next_instructional.init();}if(forbes.following){forbes.following.init_existing_following();forbes.following.init_followable_blocks({"$parent_scope":$scope});}_init_report_corrections();_on_resize();if(forbes.info_card){forbes.info_card.deleg($scope.find(".enable_info_card"));}if(forbes.galleries){$.each($scope.find(".gallery_embedded_launcher"),function(index,node){if($(node).hasClass("initialized")){return;}forbes.galleries.embedded.init_gallery($(node));});}}function _strip_empty_paragraphs(options){options.$target.find("p").each(function(){var $this=$(this);if($this.html()=="&nbsp;"){$this.remove();}});}function _init_instructional_modal(){var instructional_html="",arrow_html="",next_tab_selector=$("body").find(".next_article_tab");now=new Date(),time=now.getTime(),_cookie_expiration=30,_cookie_overlay="_forbes_overlay";instructional_html+='<div class="modal_screen modal_instructions">';instructional_html+='	<div class="modal_contain">';instructional_html+="		<h5>New on Forbes</h5>";instructional_html+="		<p><strong>Click</strong> or <strong>scroll down</strong> for next post</p>";instructional_html+='		<a href="http://onforb.es/14J9V2x">Learn more &raquo;</a>';instructional_html+="	</div>";instructional_html+="</div>";if($.cookie(_cookie_overlay)==null){$.cookie(_cookie_overlay,time,{path:"/",expires:_cookie_expiration});debug("forbes.article_responsive set cookie _forbes_overlay");}forbes.modal_window.load({html:instructional_html,allow_scrim_click_to_cancel:true,animate:true,on_cancel:function(){forbes.modal_window.destroy();$("body").removeClass("instructional_mode");},on_complete:function(){$("body").addClass("instructional_mode");forbes.event_tracking.track_ga_event(["Article","InstructionalRevealed","impression"]);next_tab_selector.on("click",function(){forbes.modal_window.destroy();$("body").removeClass("instructional_mode");forbes.event_tracking.track_ga_event(["Article","InstructionalRevealed","next"]);});setTimeout(function(){forbes.modal_window.destroy();},8000);}});}function _has_push_state(){if(window.history.pushState){return true;}return false;}return{init:_init,update_ui:_update_ui,init_media_net_related_links:_init_media_net_related_links,init_media_net_speed_bump:_init_media_net_speed_bump,has_push_state:_has_push_state};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register(forbes.article_responsive.init);var forbes=(function(app,$){app.article_next_prev_desktop=(function($){var debug=null,_button=null,_push_state=null,_initialized=false;function _init(){if(_initialized){return;}debug=forbes.util.debug;_push_state=forbes.article_responsive.has_push_state();_init_html();if(_push_state){_init_stream();}else{_init_next();}_show_next_button();_initialized=true;}function _init_html(){var html="";html+='<div class="next_article_tab"><a>';html+='<div class="next_article_button">';html+='<div class="arrow_icon"></div>';html+='<div class="next_label">Next Post</div>';html+="</div>";html+="</a></div>";_button=$(html);$("body").append(_button);}function _show_next_button(){_button.show();}function _hide_next_button(){_button.hide();}function _init_stream(){$(".next_article_tab").on("click",function(e){e.preventDefault();if($("body").data("stream-loading")===true){debug("*** bailing on next button while we wait for the stream to load");return;}$(".article_container.container").last().find(".event_tracking_scroll_latch").addClass("has_been_triggered");forbes.util.scroll_to_obj($(".loading_spinner_holder"),{duration:400});forbes.event_tracking.track_ga_event(["Article","NavClick","next"]);});}function _init_next(){var stats_data=$("#article_container_0").find(".article_stats_data").data("stats"),current_url=stats_data.page_meta.natural_id,params={oi:current_url},pepe_url=$("body").data("stream-data-url");$.ajax({url:pepe_url,data:params,dataType:"json",success:function(data){$(".next_article_tab").addClass("next_article_tab_right").show().find("a").attr("href",data.uri);},error:function(data){debug("!!! load stream: error !!!");debug(data);}});}return{init:_init,show_next_button:_show_next_button,hide_next_button:_hide_next_button};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register(forbes.article_next_prev_desktop.init);var forbes=(function(app,$){app.article_next_instructional=(function($){var debug=null,_initialized=false;function _init(){if(_initialized){return;}debug=forbes.util.debug;$(".next_post_inline").off("click").on("click",function(e){e.preventDefault();forbes.event_tracking.track_ga_event(["Article","TextClick","next"]);if($("body").data("stream-loading")===true){debug("*** bailing on next button while we wait for the stream to load");return;}$(".article_container.container").last().find(".event_tracking_scroll_latch").addClass("has_been_triggered");forbes.util.scroll_to_obj($(".loading_spinner_holder"),{duration:400});forbes.event_tracking.track_ga_event(["InfinitePage","ClickScroll","Scroll Next"]);});_initialized=true;}return{init:_init};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register(forbes.article_next_instructional.init);var forbes=(function(app,$){app.footer_drawer=(function($){var $footer_drawer=null,tab_text=null,_footer_height=0,_push_state=null;_initialized=false;function _init(){if(_initialized){return;}debug=forbes.util.debug;$footer_drawer=$("footer.universal-footer");tab_text="Conferences and more";_footer_height=$footer_drawer.height();_push_state=forbes.article_responsive.has_push_state();if(!_push_state){$footer_drawer.addClass("stationary");_initialized=true;return;}if($footer_drawer&&$("body").hasClass("infinite")){_create_sticky_footer_tab();_enable_footer_drawer();}_initialized=true;}function _enable_footer_drawer(){var $sticky_footer_tab=$(".sticky_footer_tab"),_footer_tab_height=$sticky_footer_tab.outerHeight();$sticky_footer_tab.animate({top:-_footer_tab_height,},400);$footer_drawer.css({bottom:-_footer_height,});$sticky_footer_tab.unbind("click").bind("click",function(){_toggle_footer_drawer();});$(document).click(function(e){if($(e.target).is($footer_drawer)||$(e.target).parents().is($footer_drawer)){return;}_close_footer_drawer();});if(Modernizr.touch){$footer_drawer.on("touchmove",function(e){e.preventDefault();if($footer_drawer.hasClass("footer_drawer_open")){_close_footer_drawer();}});}$(window).on("scroll",_close_footer_drawer);}function _toggle_footer_drawer(){if($footer_drawer.hasClass("footer_drawer_open")){_close_footer_drawer();}else{_open_footer_drawer();}}function _close_footer_drawer(){if($footer_drawer.hasClass("footer_drawer_open")){$footer_drawer.stop().animate({bottom:-_footer_height},250,"easeOutQuad",function(){$footer_drawer.removeClass("footer_drawer_open");});}}function _open_footer_drawer(){if(!$footer_drawer.hasClass("footer_drawer_open")){$footer_drawer.addClass("footer_drawer_open").stop().animate({bottom:0},500,"easeOutQuad");}}function _create_sticky_footer_tab(){$footer_drawer.find(".footer-center").prepend('<div class="sticky_footer_tab"><span class="arrow"></span>'+tab_text+"</div>");}return{init:_init,open_footer_drawer:_open_footer_drawer,close_footer_drawer:_close_footer_drawer};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register(forbes.footer_drawer.init);var forbes=(function(app,$){app.article_responsive_entity_block=(function($){var debug=null,_mode="hover",_hover_reveal_mode="recent_posts",_margin=10,_timeout_mouse_enter_leave_=null,_timeout_mouseenter_delay=400,_timeout_mouseleave_delay=400,_single_col_breakpoint=1200,_initialized=false;function _init(){if(_initialized){return;}debug=forbes.util.debug;_init_entitity_blocks();_update_ui();}function _init_entitity_blocks(){$(".article_entity.entity_block").each(function(){var $this=$(this);if($this.hasClass("initialized")){return;}$this.append('<div class="entity_scrim"></div>');_init_interactions($this);$this.addClass("initialized");});}function _on_mouseenter($target){if(_mode=="drawer"){return;}if(!$target.hasClass("revealed")){$target.find(".entity_scrim").stop().show().css({top:_margin*-1,left:_margin*-1,opacity:1}).height($target.outerHeight()+(_margin*4)).width($target.outerWidth()+(_margin*2));}$target.addClass("hovering");clearTimeout(_timeout_mouse_enter_leave_);_timeout_mouse_enter_leave_=setTimeout(function(){if($target.hasClass("hovering")){_reveal_expanded($target);}else{$target.find(".entity_scrim").stop().animate({opacity:0,width:($target.outerWidth()+(_margin*2))},{duration:150,easing:"easeInOutCubic"});}},_timeout_mouseenter_delay);}function _on_mouseleave($target){if(_mode=="drawer"){return;}if(!$target.hasClass("revealed")){_hide_expanded($target);$target.removeClass("hovering");return;}$target.removeClass("hovering");clearTimeout(_timeout_mouse_enter_leave_);_timeout_mouse_enter_leave_=setTimeout(function(){if(!$target.hasClass("hovering")){_hide_expanded($target);}},_timeout_mouseenter_delay);}function _hide_expanded($target){if(!$target.hasClass("revealed")){return;}$target.removeClass("revealed");$target.find(".entity_dive").hide();$target.find(".entity_scrim").stop().animate({opacity:0,width:($target.outerWidth()+(_margin*2))},{duration:150,easing:"easeInOutCubic"});}function _reveal_expanded($target){if($target.hasClass("revealed")){return;}forbes.event_tracking.track_ga_event(["Article","ContribBlockRevealed"]);_load_ajax_content($target);var margin=25,min_height=400,preview_width=$target.find(".entity_preview").width(),content_height=$target.outerHeight()+60,revealed_height=(content_height>min_height)?content_height:min_height;$target.addClass("revealed");_change_hover_reveal_state($target);$target.find(".entity_dive").stop().show().css({left:preview_width+30,height:revealed_height-(margin*2),width:0,overflow:"hidden"});$target.find(".entity_dive .masked_content").stop().css({height:revealed_height-(margin*2)});$target.find(".entity_scrim").stop().animate({opacity:1,width:preview_width+560,top:margin*-1,left:margin*-1,height:revealed_height},{duration:100,easing:"easeInOutCubic"});$target.find(".entity_dive").stop().animate({opacity:1,width:$target.find(".entity_dive .masked_content").outerWidth(),},{duration:100,easing:"easeInOutCubic"});}function _reveal_drawer($target){$target.addClass("revealed");_load_ajax_content($target);forbes.event_tracking.track_ga_event(["Article","ContribBlockRevealed"]);_change_hover_reveal_state($target);_animate_drawer_height($target);}function _hide_drawer($target){var $block=$target.find(".type_article_block");$target.removeClass("revealed");$block.stop().animate({height:$block.data("orig-height")},{duration:100,easing:"easeOutCubic"});}function _animate_drawer_height($target){var $block=$target.find(".type_article_block"),$dive=$target.find(".entity_dive"),new_height=$dive.position().top+$dive.height()+20;if(!$block.data("orig-height")){$block.data("orig-height",$block.height());}$block.stop().animate({height:new_height},{duration:150,easing:"easeInOutCubic"});}function _truncate_full_bio_if_necessary($target){if(_hover_reveal_mode!="bio"){return;}var $masked_content=$target.find(".masked_content"),masked_content_height=$masked_content.height(),$full_bio=$target.find(".entity_dive .full_bio"),bio_top=$full_bio.position().top,bio_height=$full_bio.height(),profile_url,$profile_link=$target.find("ul.entity_links li.profile a");if($profile_link&&$profile_link.attr("href")){profile_url=$profile_link.attr("href");}if((bio_top+bio_height+20)>masked_content_height){var truncation_results=_truncate_copy({"$source":$full_bio,more_text:"full&nbsp;profile&nbsp;&rarr;",length_limit:850});$full_bio.html("<p>"+truncation_results.html+"</p>");$full_bio.find("span.show_more_copy").on("click",function(){if(!profile_url){return;}forbes.event_tracking.track_ga_event(["Article","ContribBlockClick","profile"]);window.location=profile_url;});}}function _change_hover_reveal_state($target){if(_hover_reveal_mode=="recent_posts"){$target.find(".entity_dive .full_bio").hide();$target.find(".entity_dive .entity_popular_posts").hide();$target.find(".entity_dive .entity_recent_posts").show();$target.find(".entity_dive nav.toggles li").removeClass("active");$target.find('.entity_dive nav.toggles li[data-mode="'+_hover_reveal_mode+'"]').addClass("active");}else{if(_hover_reveal_mode=="popular_posts"){$target.find(".entity_dive .full_bio").hide();$target.find(".entity_dive .entity_recent_posts").hide();$target.find(".entity_dive .entity_popular_posts").show();$target.find(".entity_dive nav.toggles li").removeClass("active");$target.find('.entity_dive nav.toggles li[data-mode="'+_hover_reveal_mode+'"]').addClass("active");}else{if(_hover_reveal_mode=="bio"){$target.find(".entity_dive .entity_recent_posts").hide();$target.find(".entity_dive .entity_popular_posts").hide();$target.find(".entity_dive .full_bio").show();$target.find(".entity_dive nav.toggles li").removeClass("active");$target.find('.entity_dive nav.toggles li[data-mode="'+_hover_reveal_mode+'"]').addClass("active");if(_mode=="hover"){_truncate_full_bio_if_necessary($target);}}}}if(_mode=="drawer"){_animate_drawer_height($target);}}function _init_social_icons_rollovers(){if($(".social_icons li").length<1){return false;}$(".social_icons li").each(function(){$(this).unbind("mouseover").bind("mouseover",function(){var container=$(this).parents(".social_icons");container.find(".label").show();container.find(".label .text").text($(this).find("a").text());container.find(".label").css({left:0,width:"auto"});container.find(".label").css({width:(container.find(".label").width()+3)});container.find(".label").css({left:$(this).position().left-(container.find(".label").width()/2)+($(this).width()/2)-10});container.find(".label").css({top:$(this).position().top-(container.find(".label").height())-15});});$(this).unbind("mouseout").bind("mouseout",function(){$(this).parents(".social_icons").find(".label").hide();});});}function _init_ga_events($target){$target.find("a").each(function(i){var $this=$(this),label="";if($this.hasClass("user_name")||$this.hasClass("avatar")){$this.on("click",function(){forbes.event_tracking.track_ga_event(["Article","ContribBlockClick","home"]);});}});}function _update_ga_events($target){$target.find(".entity_recent_posts ul").children().each(function(i){var $this=$(this),label="";label="recent-";label=label+$this.index();$this.find("a").on("click",function(){forbes.event_tracking.track_ga_event(["Article","ContribBlockClick",label]);});});$target.find(".entity_popular_posts ul").children().each(function(i){var $this=$(this),label="";label="popular-";label=label+$this.index();$this.find("a").on("click",function(){forbes.event_tracking.track_ga_event(["Article","ContribBlockClick",label]);});});}function _init_interactions($target){$target.off("mouseenter, mouseover").on("mouseenter, mouseover",function(){_on_mouseenter($(this));});$target.off("mouseleave").on("mouseleave",function(){_on_mouseleave($(this));});$target.find("nav.toggles li").off("click").on("click",function(){_hover_reveal_mode=$(this).data("mode");_change_hover_reveal_state($target);});$target.find(".preview_bio .show_more_copy").off("click").on("click",function(){_hover_reveal_mode="bio";_change_hover_reveal_state($target);});$target.find(".drawer_arrow_down").off("click").on("click",function(){if(_mode=="hover"){return;}if(!$target.hasClass("revealed")){_reveal_drawer($target);}else{_hide_drawer($target);}});_init_ga_events($target);_init_social_icons_rollovers();}function _update_ui($target){var win_width=$(window).width(),new_mode="hover";if(win_width<_single_col_breakpoint){new_mode="drawer";}$(".article_entity.entity_block").each(function(){var $this=$(this);if(new_mode==_mode){return;}$this.addClass("mode_"+new_mode);$this.removeClass("revealed");if(new_mode=="drawer"){$this.find(".entity_dive, .full_bio, .entity_recent_posts, .masked_content, .entity_popular_posts").stop().attr("style","");$this.find(".entity_scrim").stop().hide();if($this.find("p.preview_bio").prev().is(".followable_block")){$this.find("p.preview_bio").detach().insertBefore($this.find(".entity_preview .followable_block"));if($this.find(".entity_preview > p.disclaimer").length>0){$this.find("p.preview_bio").css({margin:0});$this.find(".entity_preview .followable_block").css({margin:"2px 0 0"});$this.find(".entity_preview > p.disclaimer").detach().css({margin:"2px 0 3px"}).insertBefore($this.find(".entity_preview .followable_block"));}}$this.find(".entity_preview .followable_block").show();}else{$this.find(".entity_dive").hide();$this.find(".type_article_block").stop().attr("style","");if($this.find("p.preview_bio").next().is(".followable_block")||$this.find("p.preview_bio").next().next().is(".followable_block")){$this.find("p.preview_bio").detach().insertAfter($this.find(".entity_preview .followable_block"));if($this.find(".entity_preview > p.disclaimer").length>0){$this.find("p.preview_bio").css({margin:"8px 0 0"});$this.find(".entity_preview .followable_block").css({margin:"15px 0 0"});$this.find(".entity_preview > p.disclaimer").detach().css({margin:"10px 0 0"}).insertAfter($this.find(".entity_preview p.preview_bio"));}}$this.find(".entity_preview .followable_block").show();}});_mode=new_mode;}function _truncate_copy(options){var stripped_source=options.$source.text(),length_limit=options.length_limit,ellipses_text="&hellip;",more_text=options.more_text,trimmed=null,required_truncation=false,html=stripped_source;if(stripped_source.length>length_limit){trimmed=$.trim(stripped_source.substr(0,length_limit));trimmed=trimmed.substr(0,trimmed.lastIndexOf(" "));trimmed=trimmed.substr(0,trimmed.lastIndexOf(" "));html='<span class="trimmed_bio">'+trimmed+ellipses_text+'</span>&nbsp; <span class="show_more_copy">'+more_text+"</span>";required_truncation=true;}return{required:required_truncation,html:html};}function _load_ajax_content($target){if(!($($target).hasClass("info-loading")||$($target).hasClass("info-loaded"))){$($target).addClass("info-loading");var json=$($target).closest(".article_container").find(".article_stats_data").data("stats");var data={authorId:json.page_meta.author.natural_id,authorType:json.page_meta.author.type,contentId:json.page_meta.natural_id};if(data.authorType=="ad"){data.adPrefix=$($target).find("span.brandvoice").html();}$.get("/ajax/article/author_recent_popular/",data).success(function(response){$($target).find(".entity_recent_posts").html($(response)[0]);$($target).find(".entity_popular_posts").html($(response)[2]);_update_ga_events($target);if(_mode=="drawer"){_animate_drawer_height($target);}$($target).addClass("info-loaded").removeClass("info-loading");}).error(function(){$($target).find(".entity_recent_posts").html("Load failed. Hover to try again.");$($target).find(".entity_popular_posts").html("Load failed. Hover to try again.");$($target).removeClass("info-loading");});}}return{init:_init,update_ui:_update_ui};}($));return app;}(forbes||{},jQuery));var forbes=(function(app,$){app.most_popular=(function($){function _init(){var url=$(".most_popular .popular_wrapper").attr("data-url");if(!url){return;}$.get(url,{},function(data){$(".most_popular .popular_wrapper").html(data);$(".most_popular .loading_spinner").hide();_init_type();});}function _init_type(){$(".most_popular").each(function(){var $this=$(this),type=$this.find("ul.toggle li.active").attr("data-id"),$popular_wrapper=$this.find(".popular_wrapper"),$show_more_less=$this.find(".show_more_less"),target_ul=$popular_wrapper.find("ul."+type);$popular_wrapper.find("a").on("click",function(){forbes.event_tracking.track_ga_event(["RRail","MostRead","posts"]);});$this.find(".popular_wrapper ul").hide();target_ul.show();if(target_ul.find("li").length>5){var middle_item=target_ul.find("li:eq(4)");var init_height=middle_item.position().top+middle_item.height();$popular_wrapper.css({height:init_height,overflow:"hidden"});}else{$show_more_less.hide();var last_item=target_ul.find("li:last");if(last_item.length>0){var wrapper_height=last_item.position().top+last_item.height();$popular_wrapper.css({height:wrapper_height,overflow:"hidden"});}return false;}$show_more_less.show();$show_more_less.removeClass("expanded");$show_more_less.find("span").text("+ show more");$show_more_less.unbind("click").bind("click",function(){if(!$(this).hasClass("expanded")){var total_height=$this.outerHeight()+(target_ul.height()-$popular_wrapper.height());var window_height=$(window).height();if(total_height<window_height){var new_scrolltop=$this.offset().top-Math.round((window_height-total_height)/2);}else{var new_scrolltop=$this.offset().top;}$("html,body").animate({scrollTop:new_scrolltop},{duration:500,easing:"easeInOutCubic"});if($.browser.msie&&parseInt($.browser.version)<8){$(this).css("opacity",0);}$popular_wrapper.stop().animate({height:target_ul.height()},{duration:500,easing:"easeInOutCubic",complete:function(){if($.browser.msie&&parseInt($.browser.version)<8){$show_more_less.css("position","absolute").css("position","relative").css("opacity",1);}}});$(this).find("span").text("show less");$(this).addClass("expanded");}else{if($.browser.msie&&parseInt($.browser.version)<8){$(this).css("opacity",0);}$popular_wrapper.stop().animate({height:init_height},{duration:500,easing:"easeInOutCubic",complete:function(){if($.browser.msie&&parseInt($.browser.version)<8){$show_more_less.css("position","absolute").css("position","relative").css("opacity",1);}}});$(this).find("span").text("+ show more");$(this).removeClass("expanded");}});});}return{init:_init};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register(forbes.most_popular.init);var forbes=(function(app,$){app.infinite=(function($){var debug=_debug_wrapper,_debug_enabled=true,_name="infinite",$spinner=null,$scroll_threshold=null,$scroll_threshold_control=null,_allow_auto_scroll=true,_programmatic_state_change=false,_scroll_detect_enabled=true,_stream={id:"",landing_natural_id:"",min_queue:1,max_reached:false,data_url:"",rendered_page_count:1,max_pages:0,last_page_no:0,last_page_loaded:0,last_page_loaded_index:0,preload_delay:3000,pages:[]},_history={state_changes:0},_scroll_threshold_offset=150,_article_containers_y=[],_render_delay_ms=50,_threshold_y=0,_last_stored_page_no=0,_mini_header_height_offset=80,_max_page_load_wait=7000,_max_page_render_wait=5000,$tooltip=null,History=null,_share_control_stub=null,_push_state=null,_is_touch_device=Modernizr.touch,_touch_device_threshold=4;function _init(){var stats_data=null;History=window.History;_push_state=forbes.article_responsive.has_push_state();debug("Initializing page loader module.");$tooltip=$(".left_right_page_nav .left_right_page_nav_tooltip");$spinner=$("#page_loading_spinner");$spinner.data("ready_to_render",true);$spinner.data("ready_to_load",true);$("body").attr("data-last-scroll-top",0);$("body").attr("data-viewing-current-page",0);$("body").data("auto-scrolling",false);$("body").data("stream-loading",false);_share_control_stub=$(".control_wrapper .controls").html();$(".controls").addClass("controls_0");_stream.url=$("body").attr("data-stream-data-url");_stream.max_pages=parseInt($("body").attr("data-max-stream-pages"),10);_stream.last_page_no=0;var initial_uri=window.location.href;initial_uri=initial_uri.replace(/^http:\/\/([a-zA-Z0-9\-\.^\/]*\.)?forbes\.com([:]{1}[0-9]{2,4})?/,"");_stream.pages[0]={};_stream.pages[0].content="";_stream.pages[0].rendered=false;_stream.pages[0].$container=$("#article_container_0");_stream.pages[0].loaded=true;_stream.pages[0].rendered=true;_stream.pages[0].read_start_time=_get_time_now();_stream.pages[0].uri=initial_uri;_stream.pages[0].page_no=0;$("#article_container_0").attr("data-view-tracked",true);$("#article_container_0").attr("data-uri",initial_uri);stats_data=$("#article_container_0").find(".article_stats_data").data("stats");_stream.landing_natural_id=stats_data.page_meta.natural_id;_stream.pages[0].naturalId=stats_data.page_meta.natural_id;_stream.landing_time=_get_time_now();$scroll_threshold=$(".current_page_threshold");$scroll_threshold.data("animating",false);if(_push_state){$(window).scroll($.throttle(250,_on_scroll));_on_scroll();_update_scroll_threshold();}else{$("#page_loading_spinner").hide();}debug(">>>In infinite");_capture_article_container_positions();_init_history();_init_spinner();forbes.article_responsive.init_media_net_related_links($("#article_container_0"));forbes.article_responsive.init_media_net_speed_bump($("#article_container_0"));_prepare_ads($("#article_container_0"));}function _update_metadata(uri){var metadata={};return metadata;}function _init_spinner(){var opts={lines:13,length:20,width:10,radius:30,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:false,hwaccel:false,className:"spinner",zIndex:2000000000,top:"auto",left:"auto"};var target=document.getElementById("pagespinner");var spinner=new Spinner(opts).spin(target);}function _bind_user_scroll_event(){$("html, body").bind("scroll mousedown wheel DOMMouseScroll mousewheel keyup",function(evt){if(evt.type==="DOMMouseScroll"||evt.type==="keyup"||evt.type==="mousewheel"){}});}function _check_stream_queue(){var last_page_id=_stream.pages[_stream.pages.length-1].page_no,last_rendered_page_id=_get_last_page_rendered(),current_queue_length=last_page_id-last_rendered_page_id;if((_stream.pages[_stream.pages.length-1].loaded===true)&&(_stream.pages[_stream.pages.length-1].rendered===false)){debug("Last page loaded and not rendered");debug("Render check");if($spinner.data("ready_to_render")===true){debug("Render check");_render_check();}}else{if((current_queue_length<=_stream.min_queue)||(current_queue_length<=1)){if(_stream.max_reached===false){_load_stream();}}}debug("current_queue_length: "+current_queue_length);debug("_stream.min_queue: "+_stream.min_queue);}function _load_stream(){var params={},url=_stream.url,stream_request=null;if($("body").data("stream-loading")===true){debug(">>> Exit load stream 1");return;}if(_stream.pages[_stream.last_page_loaded_index].loaded===false){debug(">>> Exit load stream 2");return;}$("body").data("stream-loading",true);params.i=_get_last_loaded_natural_id();params.n=_stream.last_page_no+1;params.oi=_stream.landing_natural_id;params.t=_stream.landing_time;params.st=_get_last_loaded_read_start();params.et=_get_last_loaded_read_end();params.wc=_get_last_loaded_word_count();params.ah=_get_last_loaded_page_height();debug("# # # # # # # # # # begin _load_stream: # # # # # # # # # #");debug(params);debug(url);debug("# # # # # # # # # # end _load_stream: # # # # # # # # # #");debug("========== GET ARTICLE LINK :: SEND PARAMS ==========");debug(params);stream_request=$.ajax({url:url,data:params,dataType:"json",success:function(data){debug("++++++++++ ON STREAM LOADED ++++++++++");debug(data);_on_stream_loaded(data);},error:function(){debug("!!! load stream: error !!!");_disable_further_stream_loading();}});}function _disable_further_stream_loading(){debug("Disable further stream loading.");$("#page_loading_spinner").css({overflow:"hidden"}).stop().animate({height:0,opacity:0},{duration:250,complete:function(){$("#page_loading_spinner").remove();}});}function _get_previous_page_loaded_uri(){var $articles=$(".article_container.container"),prev_article=$(".article_container.container").get($articles.length-2),prev_article_uri=$(prev_article).attr("data-uri");debug("Previous Article URI:"+prev_article_uri);return prev_article_uri;}function _get_last_loaded_natural_id(){return _stream.pages[_stream.last_page_loaded_index].naturalId;}function _get_last_loaded_read_start(){return _stream.pages[_stream.last_page_loaded_index].read_start_time;}function _get_last_loaded_read_end(){return _stream.pages[_stream.last_page_loaded_index].read_end_time;}function _get_last_loaded_word_count(){var word_count=0;if(_stream.last_page_loaded_index===0){word_count=$("#article_container_0").data("word-count");}else{word_count=_stream.pages[_stream.last_page_loaded_index].word_count;}return word_count;}function _get_last_loaded_page_height(){var page_height=0;if(_stream.last_page_loaded_index===0){page_height=$("#article_container_0").height();}else{page_height=_stream.pages[_stream.last_page_loaded_index].page_height;}return page_height;}function _get_time_now(){var date_now=new Date(),time_now=date_now.getTime();return time_now;}function _log_stream(){forbes.util.debug(_stream);return true;}function _log_pages(){debug(_stream.pages);return true;}function _log_history(){debug(_history);return true;}function _on_stream_loaded(data){var temp_uri=null,new_page_object=data;new_page_object.loaded=false;new_page_object.rendered=false;new_page_object.page_no=_stream.last_page_no+1;new_page_object.$container=null;new_page_object.content=null;new_page_object.word_count=0;new_page_object.page_height=0;new_page_object.read_start_time=0;var protocol_domain_segments=["http://forbes.com","http://www.forbes.com"];temp_uri=new_page_object.uri;new_page_object.uri=temp_uri;for(var i=0;i<protocol_domain_segments.length;i++){var segment=protocol_domain_segments[i],start_pos=segment.length;if(temp_uri.indexOf(segment)!==-1){temp_uri=temp_uri.substring(start_pos);new_page_object.uri=temp_uri;}}forbes.event_tracking.track_ga_event(["InfinitePage","EnginePepe",(_stream.last_page_no+1)+""]);debug("    ====== STREAM ITEM LOADED ======");debug(data);debug("    ======/STREAM ITEM LOADED ======");_stream.last_page_no+=1;_stream.pages.push(new_page_object);_load_page();}function _load_page(args){debug("==================== LOAD PAGE: ATTEMPT ====================");var params=(args&&args.params&&(typeof args.params!=="undefined"))?args.params:{},uri="",url="",page_request=null;params.stream=true;if($spinner.data("ready_to_load")===false){debug("_load_page: abort");return;}debug("==================== LOAD PAGE: PROCEED ====================");$spinner.data("ready_to_load",false);for(var i=0;i<_stream.pages.length;i++){if(_stream.pages[i].page_no===(_get_set_last_page_loaded()+1)){uri=_stream.pages[i].uri;}}debug(">>>>> URI:");debug("uri: "+uri);if(uri===""){debug("Abort: load page: no uri found");return;}page_request=$.ajax({url:uri,data:params,dataType:"text",success:function(data){debug("_load_stream: success: page loaded");_on_page_loaded(data,uri);},error:function(){debug("!!! load page: error !!!");_disable_further_stream_loading();}});}function _get_rendered_page_count(){var count=$(".article_container").length;return count;}function _on_page_loaded(data,uri){var start=data.indexOf("<!--start:ajax_content_inner-->"),end=data.indexOf("<!--end:ajax_content_inner-->"),content_html=data.substring(start,end);_update_stream({uri:uri,content:content_html});_get_set_last_page_loaded();_render_check();_get_set_last_page_loaded_index();}function _render_page(args){var title="",uri=args.uri,this_index=null,new_page_no=_get_last_page_rendered()+1,article_container_id="article_container_"+new_page_no,article_container_html='<div id="'+article_container_id+'" class="article_container container"></div>',content_html="",$container_found=$("#"+article_container_id);if($container_found.length>0){return;}$spinner.before(article_container_html);for(var i=0;i<_stream.pages.length;i++){if(_stream.pages[i].uri===uri){this_index=i;_stream.pages[i].rendered=true;_stream.pages[i].$container=$("#article_container_"+new_page_no);title=_stream.pages[i].title;content_html=_stream.pages[i].content;$container_found=$("#article_container_"+new_page_no);}}$("#"+article_container_id).attr("data-uri",uri).html(content_html);_update_spinner();_update_new_leaderboard();_capture_article_container_positions();$spinner.data("ready_to_render",true);var date_now=new Date(),time_now=date_now.getTime();_stream.pages[this_index].read_start_time=time_now;_stream.pages[this_index].page_height=_stream.pages[this_index].$container.height();var word_count=$container_found.find(".body").text().split(" ").length-1;$container_found.data("word-count",word_count);debug(">>> WORD COUNT: "+word_count);_stream.pages[this_index].word_count=word_count;$spinner.data("ready_to_load",true);$("body").data("stream-loading",false);if(!_is_touch_device){_unload_page();}_detect_current_page();_switch_statechange("disable");_prepare_ads($("#"+article_container_id));if(_is_touch_device&&(new_page_no===_touch_device_threshold)){debug("touchy");debug(new_page_no);_disable_further_stream_loading();_ipad_next();}}function _ipad_next(){var stats_data=$("#article_container_1").find(".article_stats_data").data("stats"),current_url=stats_data.page_meta.natural_id,params={oi:current_url},pepe_url=$("body").data("stream-data-url");$.ajax({url:pepe_url,data:params,dataType:"json",success:function(data){var $next_touch_btn=$("<a />",{"class":"next_touch_btn",href:data.uri,text:"Load More Stories"});$("body").append($next_touch_btn);$(".next_article_tab").off("click").find("a").attr("href",data.uri);},error:function(data){debug("!!! ipad button: error !!!");debug(data);}});}function _prepare_ads($context){if(forbes.infinite_ads_redux){forbes.infinite_ads_redux.init_ads($context);}}function _check_pages(args){debug(":::::::::: Check pages to be unloaded :::::::::");var stream_page=null,date_start=new Date(),time_start=date_start.getTime();for(var i=0;i<_stream.pages.length;i++){if(_stream.pages[i].uri===args.uri){stream_page=_stream.pages[i];}}$spinner.data("ready_to_render",false);$spinner.data("try_render_start",time_start);clearInterval($spinner.data("try_render_int"));debug("//// check pages: has not reached max page count");$spinner.data("try_render_int",setInterval(function(){var date_now=new Date(),time_now=date_now.getTime()-$spinner.data("try_render_start");if(stream_page.loaded===true){clearInterval($spinner.data("try_render_int"));_render_page(args);}else{if(time_now>=_max_page_render_wait){clearInterval($spinner.data("try_render_int"));if((stream_page.content===null)||(stream_page.content==="")){var real_value=(stream_page.content===null)?"null":"empty";}}}},250));}function _render_check(){var uri="";if(_get_last_page_rendered()<_stream.last_page_no){if($spinner.data("ready_to_render")===false){return;}for(var i=0;i<_stream.pages.length;i++){if(_stream.pages[i].page_no===(_get_last_page_rendered()+1)){uri=_stream.pages[i].uri;}}_check_pages({uri:uri});}}function _unload_page(){var extra_pages=_get_rendered_page_count()-_stream.max_pages;if(extra_pages<1){debug("Abort remove page.");return;}var $page_to_remove=$(".article_container").first(),uri=$page_to_remove.attr("data-uri"),page_info_to_remove={page_no:null,title:null,uri:uri},scroll_offset=0;debug("$page_to_remove:");debug($page_to_remove.attr("id"));for(var i=0;i<_stream.pages.length;i++){var test_uri=_stream.pages[i].uri;test_uri=test_uri.replace(/^http:\/\/([a-zA-Z0-9\-\.^\/]*\.)?forbes\.com([:]{1}[0-9]{2,4})?/,"");if(test_uri===uri){page_info_to_remove.page_no=_stream.pages[i].page_no;page_info_to_remove.title=_stream.pages[i].title;_stream.pages.splice(i,1);}}$(".controls_"+page_info_to_remove.page_no).remove();debug(">>>>>------>>>>> Remove a page ");$spinner.data("ready_to_render",false);scroll_offset=$(document).scrollTop()-($page_to_remove.height());var last_page_id="#article_container_"+_get_last_page_rendered();$page_to_remove.remove();$(document).scrollTop(scroll_offset);$spinner.data("ready_to_render",true);extra_pages=(_get_rendered_page_count()-_stream.max_pages);if(extra_pages>0){_unload_page();}}function _update_stream(args){if(args.uri&&args.content){for(var i=0;i<_stream.pages.length;i++){if(_stream.pages[i].uri==args.uri){_stream.pages[i].loaded=true;_stream.pages[i].content=args.content;}}}}function _update_new_leaderboard(){$(".article_body .leaderboard").height(90);}function _scroll_up(){var current_page_id=_get_current_page(),prev_page_id=(current_page_id-1),$prev_container=$("#article_container_"+prev_page_id);if(current_page_id===0){_scroll_to({"$element":$("html, body")});}else{_scroll_to({"$element":$prev_container});}}function _scroll_down(){var dest_y=$("#page_loading_spinner").offset().top,current_page_id=_get_current_page(),$next_container=$("#article_container_"+(current_page_id+1));if(current_page_id===_stream.last_page_no){$("body").data("auto-scrolling",true);$("html, body").stop().animate({scrollTop:dest_y},{duration:500,easing:"easeInOutQuad"}).promise().done(function(){$("body").data("auto-scrolling",false);});}else{if($next_container.length>0){_scroll_to({"$element":$next_container});}else{$("body").data("auto-scrolling",true);$("html, body").stop().animate({scrollTop:dest_y},{duration:500,easing:"easeInOutQuad"}).promise().done(function(){$("body").data("auto-scrolling",false);});}}}function _capture_article_container_positions(){for(var i=0;i<_stream.last_page_no;i++){var selector="#article_container_"+i;if($(selector).length>0){_article_containers_y[i]=$(selector).offset().top;}}}function _scroll_to(args){var $element=args.$element,offset_y=_mini_header_height_offset,dest_y=$element.offset().top-offset_y,animation_duration=(args.duration)?args.duration:500,queue=(args.queue)?args.queue:true;_scroll_detect_enabled=false;if(_allow_auto_scroll===false){return;}if($("body").data("auto-scrolling")===true){debug("_scroll_to - already scrolling.");return;}$("body").data("auto-scrolling",true);$("html, body").stop().animate({scrollTop:dest_y},{duration:animation_duration,easing:"easeInOutQuad",queue:queue}).promise().done(function(){$("body").data("auto-scrolling",false);try{if(args.callback){args.callback();}else{}}catch(e){debug(e.message);}_scroll_detect_enabled=true;});}function _update_back_forward(){var end_container_y=0,last_page_height=(_article_containers_y[_article_containers_y.length-1]-_article_containers_y[_article_containers_y.length-2]),viewing_current_page=_get_current_page();if($(".left_right_page_nav .button_group").hasClass("static")){return;}end_container_y=$("#page_loading_spinner").offset().top-last_page_height;if((_get_last_page_rendered()===_stream.last_page_no)&&($(document).scrollTop()>end_container_y)){$(".left_right_page_nav .button_2").addClass("right").removeClass("down");}else{$(".left_right_page_nav .button_2").addClass("down").removeClass("right");}if($("#article_container_1").length<1){return;}if(viewing_current_page>0){$(".left_right_page_nav .right_button .button_group").addClass("double").removeClass("single");}else{$(".left_right_page_nav .right_button .button_group").addClass("single").removeClass("double");}}function _update_spinner(){}function _get_scroll_direction(){var last_scroll_top=parseInt($("body").attr("data-last-scroll-top"),10),current_scroll_top=$(document).scrollTop(),direction=$("body").attr("data-scroll-direction");if(current_scroll_top>last_scroll_top){direction="down";}else{if(current_scroll_top<last_scroll_top){direction="up";}}$("body").attr("data-scroll-direction",direction);$("body").attr("data-last-scroll-top",current_scroll_top);return direction;}function _log_last_page_as_read(){var date_now=new Date(),time_now=date_now.getTime(),last_page_loaded_index=_get_set_last_page_loaded_index(),metrics=null;metrics={read_start_time:_stream.pages[last_page_loaded_index].read_start_time,read_end_time:_stream.pages[last_page_loaded_index].read_end_time,dur_ms:null,dur_sec:null,dur_min:null,dur_sec_remain:null,dur_readable:null};if(typeof metrics.read_end_time==="undefined"){metrics.read_end_time=time_now;_stream.pages[_stream.last_page_loaded_index].read_end_time=metrics.read_end_time=metrics.read_end_time;debug("read_start_time: "+metrics.read_start_time);debug("read_end_time: "+metrics.read_end_time);metrics.dur_ms=_stream.pages[_stream.last_page_loaded_index].read_end_time-metrics.read_start_time;metrics.dur_sec=metrics.dur_ms/1000;metrics.dur_min=Math.floor(metrics.dur_sec/60);metrics.dur_sec_remain=Math.round(metrics.dur_sec%60);metrics.dur_readable=metrics.dur_min+"m "+metrics.dur_sec_remain+"s";debug("page read time: "+metrics.dur_readable);}}function _on_scroll(){var page_scroll=parseInt($(document).scrollTop(),10),threshold_y=0,spinner_y=($spinner.offset().top-page_scroll),direction="",$context=null;_update_scroll_threshold();threshold_y=$(window).height();_detect_current_page();direction=_get_scroll_direction();if((spinner_y<=threshold_y)&&(($("#page_loading_spinner").length>0))){_log_last_page_as_read();if($spinner.data("ready_to_render")===true){_check_stream_queue();}else{debug("_get_queued_loaded_page_count() 1:"+_get_queued_loaded_page_count());if(_get_queued_loaded_page_count()>0){$spinner.data("ready_to_render",true);clearTimeout($spinner.data("try_render_again_timeout"));$spinner.data("try_render_again_timeout",setTimeout(function(){_on_scroll();},2000));}else{if($("body").data("stream-loading")===false){_check_stream_queue();}debug("Last load has not completed.");}}}}function _get_queued_loaded_page_count(){var last_page_loaded_index=_get_set_last_page_loaded_index(),current_page_index=_get_current_page_index(),queued_loaded_page_count=last_page_loaded_index-current_page_index;return queued_loaded_page_count;}function _get_set_last_page_loaded_index(){var page_index=0;for(var i=(_stream.pages.length-1);i>=0;i--){if(_stream.pages[i].loaded===true){page_index=i;break;}}_stream.last_page_loaded_index=page_index;return page_index;}function _get_set_last_page_loaded(){var page_no=0;for(var j=0;j<_stream.pages.length;j++){if(_stream.pages[j].loaded===false){break;}else{page_no=_stream.pages[j].page_no;}}_stream.last_page_loaded=page_no;return page_no;}function _get_last_page_rendered_index(){var page_index=0;for(var i=(_stream.pages.length-1);i>=0;i--){if(_stream.pages[i].rendered===true){page_index=i;break;}}return page_index;}function _get_last_page_rendered(){var page_no=0;for(var j=0;j<_stream.pages.length;j++){if(_stream.pages[j].rendered===false){break;}else{page_no=_stream.pages[j].page_no;}}return page_no;}function _update_scroll_threshold(){var page_scroll=parseInt($(document).scrollTop(),10),page_scroll_minus_window_height=page_scroll+$(window).height(),body_height=$(document).height()-300;if(page_scroll_minus_window_height>=body_height){_threshold_y=Math.round($(window).height());}else{if(_get_scroll_direction()==="down"){_threshold_y=Math.round($(window).height()/2);}else{_threshold_y=Math.round(($(window).height()-_scroll_threshold_offset));}}if(typeof $(".current_page_threshold").data("animating")==="undefined"){$(".current_page_threshold").data("animating",false);}if($(".current_page_threshold").data("animating")===false){$(".current_page_threshold").data("animating",true).animate({top:_threshold_y},{duration:150,easing:"easeInOutQuad",complete:function(){$(".current_page_threshold").data("animating",false);}});}return _threshold_y;}function _detect_current_page(options){var current_page_no=_get_current_page(),threshold_y=_threshold_y,offset=0,stats_data=null,args={page_no:_stream.pages[0].page_no,uri:"",title:"",url:""},last_page_index_rendered=_get_last_page_rendered_index(),last_direction=null,this_direction=null,$context=null;for(var i=0;i<=last_page_index_rendered;i++){var $container=_stream.pages[i].$container,container_y=$container.offset().top-($(window).scrollTop()-offset);if(container_y<=threshold_y){stats_data=$container.find(".article_stats_data").data("stats");if($container.find(".article_stats_data").length<1){return;}args.page_no=_stream.pages[i].page_no;args.uri=_stream.pages[i].uri;args.title=stats_data.page_meta.title;}}this_direction=_get_scroll_direction();last_direction=$("body").attr("data-last-direction");if((current_page_no!==args.page_no)&&(this_direction!==last_direction)){$("body").attr("data-viewing-current-page",args.page_no);_update_history(args);_on_page_change({new_page_no:args.page_no});_share_init(args.page_no);$context=$("#article_container_"+_get_last_page_rendered());debug("===== last page rendered: #article_container_"+_get_last_page_rendered()+" =====");if(args.page_no===_get_last_page_rendered()){debug("Last page detected.");_prepare_ads($context);}}else{if(options&&(options.force===true)){debug("Force update statechange.");$("body").attr("data-viewing-current-page",args.page_no);_update_history(args);_on_page_change({new_page_no:args.page_no});}}}function _share_init(page_no){var $controls=$(".controls_"+page_no);var $article_container=$("#article_container_"+page_no);if(forbes.gigya_share){if($controls.length==0){$article_container.find("div.gigya_settings .gigya_buttonContainerPrefixArray").attr("data-value","gigya_share_button_"+page_no+",gigya_inline_share_button_"+page_no);$article_container.find("div.gigya_settings .gigya_counterContainerPrefixArray").attr("data-value","gigya_share_counter_"+page_no+",gigya_inline_share_counter_"+page_no);var share_controls_div="<div>"+_share_control_stub+"</div>";share_controls_div=share_controls_div.replace(/gigya_share_button_/g,"gigya_share_button_"+page_no+"_");share_controls_div=share_controls_div.replace(/gigya_share_counter_/g,"gigya_share_counter_"+page_no+"_");share_controls_div=share_controls_div.replace(/gigya_inline_share_button_/g,"gigya_inline_share_button_"+page_no+"_");share_controls_div=share_controls_div.replace(/gigya_inline_share_counter_/g,"gigya_inline_share_counter_"+page_no+"_");$controls=$(share_controls_div);$controls.addClass("controls");$controls.addClass("controls_"+page_no);$(".position_reference").append($controls);forbes.gigya_share.init({target:$article_container});$controls.find(".gigya_inline_share_button-email_icon").click(function(e){$(e.target).parent().find(".gig-share-button").click();});}$(".controls").hide();$controls.show();}}function _detect_actual_page_in_view(options){var threshold_y=_threshold_y,offset=0,stats_data=null,page_attributes={page_no:_stream.pages[0].page_no,uri:"",title:"",url:""},last_page_index_rendered=_get_last_page_rendered_index(),$context=null;for(var i=0;i<=last_page_index_rendered;i++){var $container=_stream.pages[i].$container,container_y=$container.offset().top-($(window).scrollTop()-offset);if(container_y<=threshold_y){stats_data=$container.find(".article_stats_data").data("stats");if($container.find(".article_stats_data").length<1){return;}page_attributes.page_no=_stream.pages[i].page_no;page_attributes.uri=_stream.pages[i].uri;page_attributes.title=stats_data.page_meta.title;}}return page_attributes;}function _on_page_change(args){debug("########## PAGE CHANGE");var new_page_no=args.new_page_no,$target=$("#article_container_"+new_page_no);debug("########## ADS OVERLAY INIT ATTEMPT");if(forbes.infinite_scroll_inread){forbes.infinite_scroll_inread.initialize_ad(new_page_no);}if(forbes.infinite_scroll_intx){forbes.infinite_scroll_intx.initialize_ad();}debug("########## END ADS OVERLAY INIT ATTEMPT");forbes.article_responsive.update_ui({"$target":$target});_on_page_view_event({"$target":$target});}function _get_current_page(){return parseInt($("body").attr("data-viewing-current-page"),10);}function _get_current_page_index(){var page_index=0;for(var i=0;i<_stream.pages.length;i++){if(_stream.pages[i].page_no===_get_current_page()){page_index=i;}}return page_index;}function _init_history(){_switch_statechange("enabled");if(_push_state){History.Adapter.bind(window,"statechange",function(){var State=History.getState(),$element=null;$element=$('.article_container[data-uri="'+State.data.uri+'"]');if(_programmatic_state_change===false){if($element.length>0){_scroll_detect_enabled=false;_scroll_to({"$element":$element,callback:function(){_scroll_detect_enabled=true;}});}else{window.location.href=State.url;}}else{}_programmatic_state_change=false;});}var args={page_no:0,title:_stream.pages[0].title,uri:_stream.pages[0].uri};if($(document).scrollTop()===0){_programmatic_state_change=true;}}function _switch_statechange(state){debug("_switch_statechange");debug(state);if(state==="enable"){$("body").attr("data-statechange","enabled");}else{if(state==="disable"){$("body").attr("data-statechange","disabled");}}}function _add_history(args){var title=args.title,url=args.uri;_programmatic_state_change=true;_last_stored_page_no=args.page_no;if(!_push_state){return;}History.pushState(args,title,url);}function _update_history(args){if($("body").attr("data-statechange")==="disabled"){debug("State change disabled");return;}if(_scroll_detect_enabled===false){}_programmatic_state_change=true;if(!_push_state){return;}History.pushState(args,args.title,args.uri);debug("add: "+args.uri);}function _debug_wrapper(input){if(_debug_enabled){forbes.util.debug(input);}}function _on_page_view_event(options){if(options.$target.attr("data-view-tracked")){return;}options.$target.attr("data-view-tracked",true);$(window).trigger("on_page_view");if(typeof options.$target=="undefined"){return false;}var data=options.$target.find(".article_stats_data").data("stats");var dfp_data=options.$target.find(".article_dfp_data").data("dfp");debug("Data is ***"+JSON.stringify(data));var uri_last_article=_get_previous_page_loaded_uri();if(uri_last_article.indexOf(".forbes.com")==-1){uri_last_article=window.location.host+uri_last_article;}var author=data.page_meta.author.display_name;var site_slug=data.page_meta.site_slug;var channel=data.page_meta.channel;var section=data.page_meta.section;if("forbeswoman"===section){channel=section;}if("markets"==channel||"personalFinance"==channel){channel="investing";}var page_type=data.page_meta.type;var special_slot=data.page_meta.special_slot;var template_type=data.page_meta.template_type;var sub_type=data.page_meta.sub_type;if(typeof sub_type!="undefined"&&null!==sub_type&&""!==sub_type){page_type=page_type+":"+sub_type;}else{if(typeof template_type!=="undefined"&&null!==template_type&&""!==template_type){page_type=page_type+":"+template_type;}}var brand_voice;var SUID=data.user_meta.user_id;var HUID=data.user_meta.user_id;var UUID=data.user_meta.user_id;var contrib_type=data.page_meta.contrib_type;var schedule=data.page_meta.schedule;var blog_type=data.page_meta.blog_type;var article_gallery=data.page_meta.article_gallery;var DFP_site=dfp_data.site;var DFP_zone=dfp_data.zone;var published=data.page_meta.published;var paragraphs=data.page_meta.paragraphs;var categories=data.page_meta.categories;var user_id=data.user_meta.user_id;if(typeof blog_type!=="undefined"&&null!==blog_type&&blog_type=="ad"){brand_voice=data.page_meta.site_slug;}if(typeof published!="undefined"&&null!==published){var published_date=new Date(published);var published_day=published_date.getDate();var published_month=published_date.getMonth()+1;var published_year=published_date.getFullYear();published=published_year+"-"+published_month+"-"+published_day;}var vpvData={url:data.page_meta.simple_reach.url,author:author,site:site_slug,channel:channel,slot:special_slot,HUID:HUID,SUID:SUID,UUID:UUID,contribType:contrib_type,schedule:schedule,blogType:blog_type,brandVoice:brand_voice,pageType:page_type,articleGallery:article_gallery,DFPSite:DFP_site,DFPZone:DFP_zone,published:published,paragraphs:paragraphs,categories:categories,userId:user_id,referrer:uri_last_article};forbes.util.analyticsVPV(vpvData);_comscore.push({c1:"2",c2:"6872493"});(function(){var s=document.createElement("script"),el=document.getElementsByTagName("script")[0];s.async=true;s.src=(document.location.protocol=="https:"?"https://sb":"http://b")+".scorecardresearch.com/beacon.js";el.parentNode.insertBefore(s,el);})();forbes.new_fast_pixel.drop_pixels({channel:data.page_meta.channel,section:data.page_meta.section,page_type:data.page_meta.type,page_id:data.page_meta.natural_id,url:data.page_meta.sitepage,referrer:data.page_meta.referrer,author:data.page_meta.author.natural_id,author_type:data.page_meta.author.type});var simplereach_config={iframe:true,pid:data.page_meta.simple_reach.pid,title:data.page_meta.simple_reach.title,url:data.page_meta.simple_reach.url,date:data.page_meta.simple_reach.date,authors:[data.page_meta.simple_reach.authors],channels:[data.page_meta.simple_reach.channels],tags:data.page_meta.simple_reach.tags,ref_url:uri_last_article,referrer:uri_last_article,landing_url:""};SPR.Reach.collect(simplereach_config);var site_page_chartBeat=data.page_meta.sitepage;if(site_page_chartBeat.indexOf("sites/")!=-1){var index_sites=site_page_chartBeat.indexOf("/sites/");site_page_chartBeat=site_page_chartBeat.substring(index_sites,site_page_chartBeat.length);}if(data.page_meta.section!=undefined){_sf_async_config.sections=data.page_meta.section;}else{if(data.page_meta.channel!=undefined){_sf_async_config.sections=data.page_meta.channel;}}_sf_async_config.authors=data.page_meta.author.display_name;pSUPERFLY.virtualPage(site_page_chartBeat,data.page_meta.title);window.Krux||((Krux=function(){Krux.q.push(arguments);}).q=[]);(function(){var k=document.createElement("script");k.type="text/javascript";k.async=true;var m,src=(m=location.href.match(/\bkxsrc=([^&]+)\b/))&&decodeURIComponent(m[1]);k.src=src||(location.protocol==="https:"?"https:":"http:")+"//cdn.krxd.net/controltag?confid=Hm5iiZ1t";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(k,s);})();}return{init:_init,on_scroll:_on_scroll,log_stream:_log_stream,log_pages:_log_pages,log_history:_log_history,get_last_page_rendered:_get_last_page_rendered,detect_current_page:_detect_current_page,switch_statechange:_switch_statechange,detect_actual_page_in_view:_detect_actual_page_in_view};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register(forbes.infinite.init);var forbes=(function(app,$){app.infinite_embeds=(function($){var $log=_log_wrapper,$log_group=_log_group_wrapper,$log_group_end=_log_group_end_wrapper,_log_enabled=false;function _log_wrapper(input){if(_log_enabled){forbes.util.log(input);}}function _log_group_wrapper(input){if(_log_enabled){forbes.util.log_group(input);}}function _log_group_end_wrapper(input){if(_log_enabled){forbes.util.log_group_end(input);}}var check={init:function($ad_node){if(!$ad_node){return;}var killer_index=null,ad_node_bottom=$ad_node.position().top+$ad_node.outerHeight(true),$next_all=$ad_node.nextAll(),ad_node_width=$ad_node.width(),ad_node_height=$ad_node.outerHeight(true),new_width=get.new_width(ad_node_width);$next_all.each(function(index,node){var $node=$(node);if($node.hasClass("article_body_ad")){killer_index=index;return;}else{if(killer_index!==null&&index>killer_index){return;}}if(ad_node_bottom>=$node.position().top){check.type_of_object($node,new_width,ad_node_height,$ad_node.position().top);}});},type_of_object:function($node,new_width,ad_node_height,ad_node_top){if($node.hasClass("youtube-player")){resize.height_and_width($node,new_width);}else{if($node.hasClass("brightcove_wrapper")){if(Modernizr.touch){resize.height_and_width($node.find("iframe"),new_width);}else{resize.height_and_width($node.find("object"),new_width);}}else{if($node.attr("src")&&($node.attr("src").indexOf("newsinc.com")!==-1)){}else{if($node.hasClass("guest_contributor_block")){$node.next().css("clear","left");resize.width_only($node,new_width);}else{if($node.attr("id")&&($node.attr("id").indexOf("wochit-player")!==-1)){resize.height_and_width($node,new_width);}else{if($node.attr("id")&&($node.attr("id").indexOf("twitter-widget")!==-1)){resize.width_only($node,new_width);}else{if($node.hasClass("wp-caption")){resize.width_only($node,new_width);}else{if($node.is("p")&&$.contains($node,"img")){$node.find("img, iframe").each(function(index){var $this=$(this),original_width=$this.attr("width"),$div;if($this.prev().is(".wp-image-positioner")){$div=$this.prev();}else{$div=$("<div />",{"class":"wp-image-positioner"});$div.css({"float":"left"});$this.before($div);}if($div.position().top<(ad_node_height+ad_node_top)){$this.css("margin-right",0);if((original_width>new_width)||!original_width){if($this.is("img")){$this.css("display","block");resize.width_only($this,new_width);}else{if($this.is("iframe")){resize.height_and_width($this,new_width);}}}}});}}}}}}}}}};var get={new_width:function(ad_node_width){var padding=40,new_width=$(".article_body").first().width()-(ad_node_width+padding);return new_width;},new_height:function(node_height,node_width,new_width){return Math.round((node_height*new_width)/node_width);}};var resize={height_and_width:function($node,new_width){var node_height=$node.attr("height"),node_width=$node.attr("width");$node.width(new_width).height(get.new_height(node_height,node_width,new_width));},width_only:function($node,new_width){$node.width(new_width);}};return{check:check};}($));return app;}(forbes||{},jQuery));var forbes=(function(app,$){app.infinite_ads_redux=(function($){var $log=_log_wrapper,$log_group=_log_group_wrapper,$log_group_end=_log_group_end_wrapper,_log_enabled=false,_initialized=false,_library_load_started=false,_library_loaded=false,_library_load_polling=false,_library_load_int=null,_library_loaded_int=null,_render_ended_initialized=false,_slot_objects=[],_reactivate_statechange_timeout=null,_breakpoints=[1150,1400];function _init(){if(_initialized===true){return;}setup.load_library(setup.render_ended_dispatch);resize.init();_initialized=true;}function _log_wrapper(input){if(_log_enabled){forbes.util.log(input);}}function _log_group_wrapper(input){if(_log_enabled){forbes.util.log_group(input);}}function _log_group_end_wrapper(input){if(_log_enabled){forbes.util.log_group_end(input);}}function _init_ads($context){setup.prepare_ads($context);}var setup={prepare_ads:function($context){this.load_library(this.render_ended_dispatch);if(_library_loaded===true){standard.init($context);}else{if(_library_load_polling===true){return;}_library_load_polling=true;_library_load_int=setInterval(function(){if(_library_loaded===true){clearInterval(_library_load_int);_library_load_polling=false;standard.init($context);}},250);}},load_library:function(callback){if(_library_loaded){if(callback){callback();}return;}else{if(_library_load_started===true){return;}}_library_loaded_int=setInterval(function(){if(window.googletag){clearInterval(_library_loaded_int);_library_loaded=true;if(callback){callback();}}},100);_library_load_started=true;},render_ended_dispatch:function(){if(_render_ended_initialized){return;}else{_render_ended_initialized=true;googletag.pubads().addEventListener("slotRenderEnded",function(event){var slot=event.slot,slot_id=slot.getSlotId(),position=event.slot.ab().pos[0],node_id=slot_id.getDomId();standard.post_process_ad({slot_id:position,node_id:node_id});});}}};var standard={types:{takeover:["topx"],multifeature:["topx"],standard:["rec","loge","recx"],shorty:["rec"]},ad_positions:{top:{sizes:[[728,90],[970,66],[970,250],[970,90],[1,1]]},"ntv-vest2":{sizes:[[170,240],[1,1]]},"spon-logo":{sizes:[[120,40],[300,170],[1,1]]},topx:{sizes:[[970,250],[728,90],[1,1]]},rec:{sizes:[[300,250],[300,600],[336,850],[336,280],[450,254],[1,1]]},loge:{sizes:[[300,250],[300,600],[336,850],[336,280],[450,254],[1,1]],queued:true},recx:{sizes:[[300,250],[300,600],[336,850],[336,280],[450,254],[1,1]],queued:true},"spon-promo":{sizes:[[670,210],[1,1]]},mnet:{sizes:[[803,119],[1,1]]}},init:function($context){var context_uri_matches_last_uri=url.compare_context_uri_against_last_uri($context);if(context_uri_matches_last_uri===false){if($("body").attr("data-statechange")==="disabled"){this.reactivate_statechange($context);}return;}if(!$context.data("ads")){if($context.attr("id").substr(-1)!=="0"){this.refresh_amazon();}this.preprocess_html($context);this.get_positions($context);}},refresh_amazon:function(){if(window.amznads){try{window.top.amznads.ads={};}catch(e){$log(e);}window.amznads.getAdsAsync("3038");}},preprocess_html:function($context){var $first_node=$context.find(".article_body .body_inner > *:nth-child(1)"),first_tag=$first_node[0].tagName.toLowerCase(),temp_html=null;if((first_tag==="div")&&(typeof $first_node.attr("class")==="undefined")&&(typeof $first_node.attr("id")==="undefined")){temp_html=$first_node.html();$first_node.after(temp_html);$first_node.remove();}$context.find(".article_body .body_inner").children().each(function(index){var $this=$(this),html;if(($this[0].tagName==="div")&&(typeof $this.attr("class")==="undefined")&&(typeof $this.attr("id")==="undefined")){html=$this.html();$this.after(html).remove();}});},insert_polar_vestpocket:function($context){var _dfp_data=$context.find(".article_dfp_data").data("dfp"),ads_data=$context.data("ads");ads_data.polar_initialized=true;if(typeof _dfp_data!="undefined"&&(typeof _dfp_data.advoice=="undefined"||_dfp_data.advoice==null)){_dfp_data.pos="ntv-vest";forbes.mediavoice.insert_article_vp({unit:{server:"dfp",id:"/7175/fdc.forbes/article-new",size:"2x3",targets:_dfp_data},selector:"#"+$context.attr("id")+" .vp-box.vp-polar-native",timeout:10000,label:"desktop-vestpocket"});}setTimeout(function(){$(window).resize();},3000);},get_positions:function($context){var article={},stats_data=$context.find(".article_stats_data").data("stats"),dfp_data=$context.find(".article_dfp_data").data("dfp"),mninst_param=dfp_data.mninst,brandvoice=stats_data.page_meta.brandvoice,special_slot=stats_data.page_meta.special_slot,template_type=stats_data.page_meta.template_type,positions,optional_ads=[],short_template_max=600;if(special_slot){optional_ads.push("spon-promo");}if(!brandvoice){optional_ads.push("spon-logo");}if(mninst_param=="2"){optional_ads.push("mnet");}else{if(mninst_param=="3"){optional_ads.push("top");optional_ads.push("mnet");}else{optional_ads.push("top");}}if(template_type==="standard"||template_type===undefined){if($context.find(".body_inner").height()<short_template_max){template_type="shorty";}else{template_type="standard";article.ad_spacing=rec.set_spacing($context);}}positions=$.merge(optional_ads,standard.types[template_type]);article.type=template_type;article.positions=this.create_position_object(positions,template_type);article.$last_inserted=null;article.polar_initialized=false;if(template_type==="takeover"){article.$ad_target=takeover.get_target_node($context);}else{if(template_type==="multifeature"){article.$ad_target=multifeature.get_first_target_node($context);}else{if(template_type==="shorty"||template_type==="standard"){article.$ad_target=rec.get_first_target_node($context,template_type);}else{$log("No template_type.");}}}$context.data("ads",article);this.define_slots($context);},create_position_object:function(positions,template_type){var ads=[],ad={};for(var i=0;i<positions.length;i++){ads.push(this.ad_positions[positions[i]]);ads[i].id=positions[i];ads[i].completed=false;ads[i].initialized=false;if(positions[i]==="topx"||positions[i]==="recx"){ads[i].dynamic=true;ads[i].count=0;}else{ads[i].dynamic=false;}}return ads;},define_slots:function($context){var ads=$context.data("ads"),positions=ads.positions;for(var i=0;i<positions.length;i++){if(!positions[i].queued){standard.define_slot($context,i);}}},define_slot:function($context,idx){var prefix=$context.attr("id")+"_",ads=$context.data("ads"),ad=ads.positions[idx],slot_id=ad.id,sizes=ad.sizes,completed=ad.completed,template_type=ads.type,ad_id=prefix+slot_id,current_article_no=$context.attr("id").substr(-1),$node=null,ad_count=ad.count,is_dynamic=ad.dynamic;if(ad.completed===true){$log("Ad type completed.");return;}if(slot_id==="topx"||slot_id==="recx"){ad_id=ad_id+"_"+ad.count;}if($("#"+ad_id).length>0){$log("Ad already inserted");return;}else{$node=this.create_node(ad_id,slot_id);if(!$node){return;}this.inject_node({"$context":$context,slot_id:slot_id,"$node":$node,template_type:template_type});this.push_to_google({"$context":$context,ad_id:ad_id,current_article_no:current_article_no,sizes:sizes,slot_id:slot_id,idx:idx,is_dynamic:is_dynamic,ad_count:ad_count});this.activate_ad({"$context":$context,slot_id:slot_id,ad_id:ad_id,idx:idx,is_dynamic:is_dynamic,"$node":$node});}},create_node:function(ad_id,slot_id){var $node=$("<div />",{id:ad_id});switch(slot_id){case"topx":case"rec":case"loge":case"recx":case"spon-logo":$node.addClass(slot_id+"_ad");break;case"ntv-vest2":$node.addClass("vp-native-ad");break;default:$log("different ad type");}return $node;},inject_node:function(args){var $context=args.$context,slot_id=args.slot_id,$node=args.$node,ads_data=$context.data("ads"),$ad_target=ads_data.$ad_target;switch(slot_id){case"top":$context.find(".leaderboard").append($node);break;case"ntv-vest2":$context.find(".vp-native").append($node);break;case"spon-logo":$context.find(".article_body.article").parent().prepend($node);break;case"rec":$ad_target.before($node);break;case"loge":case"recx":$ad_target.after($node);break;case"topx":if(ads_data.type==="takeover"){$ad_target.after($node);}else{element_test.is_bold($ad_target)?$ad_target.before($node):$ad_target.after($node);}break;case"spon-promo":$context.find(".sponsored_ad").append($node);break;case"mnet":$context.find(".mninst").append($node);break;default:$log("Unclassified Ad Type: "+slot_id);break;}},push_to_google:function(args){var $context=args.$context,ad_id=args.ad_id,current_article_no=parseInt(args.current_article_no,10)+1,sizes=args.sizes,slot_id=args.slot_id,ads_data=$context.data("ads"),idx=args.idx,ad_count=args.ad_count,is_dynamic=args.is_dynamic;googletag.cmd.push(function(){var unit_name="/7175/fdc.forbes/article-new",window_url=window.location.pathname.split("/"),directory=window_url[1],google_tag_swimlane=null,slot_object=null,data=$context.find(".article_dfp_data").data("dfp");if(directory=="sites"){google_tag_swimlane=url.get_vars()["ss"];}function checkCookie(key){if(key===undefined||key===null){return"0";}return key;}function setGPT(){slot_object=googletag.defineSlot(unit_name,sizes,ad_id).addService(googletag.pubads()).setTargeting("pos",[slot_id]);}function clearGPTTargetting(){googletag.pubads().setTargeting("id","");googletag.pubads().setTargeting("channel","");googletag.pubads().setTargeting("section","");googletag.pubads().setTargeting("swimlane","");googletag.pubads().setTargeting("specialslot","");googletag.pubads().setTargeting("displaychannel","");googletag.pubads().setTargeting("displaysection","");googletag.pubads().setTargeting("mninst","");}function csdisplay(){if(typeof data.channel!="undefined"){googletag.pubads().setTargeting("channel",data.channel);}if(typeof data.section!="undefined"){googletag.pubads().setTargeting("section",data.section);}if(typeof data.displaychannel!="undefined"){googletag.pubads().setTargeting("displaychannel",data.displaychannel);}if(typeof data.displaysection!="undefined"){googletag.pubads().setTargeting("displaysection",data.displaysection);}}clearGPTTargetting();if(typeof data.id!="undefined"){googletag.pubads().setTargeting("id",data.id);}if(typeof data.mninst!="undefined"&&data.mninst!=""){googletag.pubads().setTargeting("mninst",data.mninst);}if(current_article_no===1&&typeof data.swimlane!="undefined"){googletag.pubads().setTargeting("swimlane",data.swimlane);}else{if(typeof data.specialslot!="undefined"){googletag.pubads().setTargeting("specialslot",data.specialslot);}else{csdisplay();}}if(is_dynamic){ad_count=ad_count+1;googletag.pubads().setTargeting(slot_id,""+ad_count);}if(typeof amznads!="undefined"&&typeof amznads.getTokens=="function"){googletag.pubads().setTargeting("amznslots",amznads.getTokens());}var is_brandvoice=$context.find(".article_stats_data").data("stats").page_meta.brandvoice,jsontextprice,ox_cookie="";if(is_brandvoice){if(typeof is_brandvoice!=="undefined"&&is_brandvoice&&slot_id=="spon-logo"){forbes.util.debug("this is a brandvoice article so no spon-logo");}else{setGPT();}}else{if($.cookie("ox_zones")!==undefined&&$.cookie("ox_zones")!==null&&$.cookie("ox_cookie")!==undefined&&$.cookie("ox_cookie")!==null){var jsontext=$.cookie("ox_zones");window.ox_zones=JSON.parse(jsontext);jsontextprice=$.cookie("ox_cookie");ox_cookie=JSON.parse(jsontextprice);}if($.cookie("ox_zones")!==undefined&&$.cookie("ox_zones")!==null&&$.cookie("ox_cookie")!==undefined&&$.cookie("ox_cookie")!==null&&ox_zones.page_url===$(location).attr("href")){var slot_openx,openx_price="";if(slot_id=="top"||slot_id=="rec"||slot_id=="loge"||slot_id=="recx"&&ad_id==="article_container_0_recx_0"||slot_id=="topx"&&ad_id==="article_container_0_topx_0"){if(slot_id=="top"){slot_openx="ox";openx_price=checkCookie(ox_cookie.topPrice);forbes.util.debug("The price for top is :: "+openx_price);}if(slot_id=="rec"){slot_openx="ox";openx_price=checkCookie(ox_cookie.recPrice);forbes.util.debug("The price for rec is :: "+openx_price);}if(slot_id=="recx"&&ad_id==="article_container_0_recx_0"){slot_openx="1ox";openx_price=checkCookie(ox_cookie.recxPrice);forbes.util.debug("The price for recx is :: "+openx_price);}if(slot_id=="loge"){slot_openx="ox";openx_price=checkCookie(ox_cookie.logePrice);forbes.util.debug("The price for loge is :: "+openx_price);}if(slot_id=="topx"&&ad_id==="article_container_0_topx_0"){slot_openx="1ox";openx_price=checkCookie(ox_cookie.topxPrice);forbes.util.debug("The price for topx is :: "+openx_price);}slot_object=googletag.defineSlot(unit_name,sizes,ad_id).addService(googletag.pubads()).setTargeting("pos"+slot_id+""+slot_openx,openx_price).setTargeting("pos",slot_id);}else{setGPT();}}else{setGPT();}}if(Krux.dfppKeyValues&&Krux.segments&&Krux.segments.length>0){googletag.pubads().setTargeting("ksgmnt",Krux.segments);googletag.pubads().setTargeting("kuid",Krux.user);}googletag.enableServices();_slot_objects.push(slot_object);});},activate_ad:function(args){var $context=args.$context,ads_data=$context.data("ads"),slot_id=args.slot_id,ad_id=args.ad_id,idx=args.idx,$node=args.$node;googletag.cmd.push(function(){googletag.display(ad_id);});ads_data.positions[idx].initialized=true;this.render_ended_fallback($node);},all_ads_initialized:function($context){var all_initialized=false,ads_data=$context.data("ads"),ad_positions=ads_data.positions,loaded=0;for(var i=0;i<ad_positions.length;i++){if(ad_positions[i].completed===true){loaded=loaded+1;}}if(loaded===ad_positions.length){if(ads_data.polar_initialized===false){this.insert_polar_vestpocket($context);}this.reactivate_statechange($context);$(window).trigger("resize");}else{$log("Not all Ads initialized");}},get_ad_index:function(positions,slot_id){var idx=null;for(var i=0;i<positions.length;i++){if(positions[i].id===slot_id){idx=i;}}return idx;},post_process_ad:function(args){var node_id=args.node_id,slot_id=args.slot_id,next_position=(slot_id==="rec")?"loge":"recx",$node=$("#"+node_id),render_ended_start=$node.data("render_ended_start"),$context=$node.closest(".article_container"),ads_data=$context.data("ads"),positions=ads_data.positions,current_idx=standard.get_ad_index(positions,slot_id),completed=positions[current_idx].completed,is_dynamic=positions[current_idx].dynamic,template_type=null,$ad_target=null,idx=standard.get_ad_index(positions,next_position);if(render_ended_start){return;}$node.data("render_ended_start",true);if(completed){return;}$node.addClass("ad_initialized");if(is_dynamic){ads_data.positions[current_idx].count++;ads_data.$last_inserted=$node;}else{positions[current_idx].completed=true;}switch(slot_id){case"ntv-vest2":$node.closest(".vp-box").addClass("vp-visible");resize.exists.ntv_vp=true;resize.ntv_vp();break;case"topx":if(parseInt($node.find("div > iframe").attr("width"),10)===970){$node.addClass("topx_ad_wide");}resize.exists.topx=true;resize.topx();dynamic.insert_another($context,current_idx);break;case"rec":case"loge":case"recx":$node.addClass("article_body_ad");if(parseInt($node.find("div > iframe").attr("width"),10)>300){$node.addClass("rec_ad_wide");}resize.exists.rec=true;resize.rec();if(forbes.infinite_embeds){forbes.infinite_embeds.check.init($node);}template_type=ads_data.type;if(template_type!=="standard"){return;}else{$ad_target=rec.get_next_target_node($node,$context);if($ad_target===false){var recx_idx=standard.get_ad_index(positions,"recx");positions[recx_idx].completed=true;standard.all_ads_initialized($context);}else{ads_data.$ad_target=$ad_target;standard.define_slot($context,idx);}}break;default:break;}this.all_ads_initialized($context);},reactivate_statechange:function($context){var delay=1,page_in_view=forbes.infinite.detect_actual_page_in_view(),uri_match=null;uri_match=(page_in_view.uri===$context.attr("data-uri"));if(uri_match===false){delay=4500;}clearTimeout(_reactivate_statechange_timeout);_reactivate_statechange_timeout=setTimeout(function(){forbes.infinite.switch_statechange("enable");forbes.infinite.detect_current_page({force:true});},delay);},render_ended_fallback:function($node){var date_start=new Date(),time_start=date_start.getTime();$node.data("render_ended_time_start",time_start).data("render_ended_interval",setInterval(function(){var date_now=new Date(),time_now=date_now.getTime(),elapsed_now=time_now-$node.data("render_ended_time_start");if($node.children()){clearInterval($node.data("render_ended_interval"));var node_id=$node.attr("id"),slot_id=node_id.split("_");standard.post_process_ad({slot_id:slot_id[3],node_id:node_id});}else{if(elapsed_now>=10000){clearInterval($node.data("render_ended_interval"));}}},500));}};var dynamic={insert_interval:1200,insert_another:function($context,idx){var room=dynamic.enough_room($context),ads_data=$context.data("ads");if(room){dynamic.set_target_node($context);standard.define_slot($context,idx);}else{ads_data.positions[idx].completed=true;standard.all_ads_initialized($context);}},enough_room:function($context){var room=false,ads_data=$context.data("ads"),$last_inserted=ads_data.$last_inserted,last_inserted_height=$last_inserted.height(),position=$last_inserted.position().top,total=position+last_inserted_height,body_inner_height=$context.find(".body_inner").height();if((body_inner_height-total)>dynamic.insert_interval){room=true;}return room;},set_target_node:function($context){var ads_data=$context.data("ads"),$last_inserted=ads_data.$last_inserted,last_inserted_height=$last_inserted.height(),position=$last_inserted.position().top,total=position+last_inserted_height,next_position=total+dynamic.insert_interval,$body_inner_height=$context.find(".body_inner").height(),$targets=$context.find(".body_inner").children(),$target=null,matches=0;$targets.each(function(){var $this=$(this),position=$this.position().top,height=$this.height(),bottom_position=position+height;if(bottom_position>next_position){if(matches===0){$target=$this;matches=matches+1;}}});ads_data.$ad_target=$target;}};var rec={display_sizes:{small:{width:380},medium:{width:420},large:{width:600}},min_spacing:{small:250,medium:300,large:400},article_length_thresholds:[400,1600],minimum_remaining_height:300,set_spacing:function($context){var spacing,word_count=parseInt($context.attr("data-word-count"),10);if(word_count<rec.article_length_thresholds[0]){spacing=rec.min_spacing.small;}else{if(word_count<rec.article_length_thresholds[1]){spacing=rec.min_spacing.medium;}else{spacing=rec.min_spacing.large;}}return spacing;},get_first_target_node:function($context,template_type){var $body_inner=$context.find(".body_inner"),$first_child=$body_inner.find("> *:nth-child(1)"),featured_image=$first_child.is(".featured_image"),left_aligned_selectors="img.alignleft, .wp-caption.alignleft",$left_aligned=$first_child.find(left_aligned_selectors),left_aligned_height=null,right_aligned_selectors="img.alignright, .wp-caption.alignright",$right_aligned=$first_child.find(right_aligned_selectors),right_aligned_width=null,$resize_node=null,$node=null;if(featured_image){$node=$first_child.next();}else{if($left_aligned.length!==0||$first_child.is(left_aligned_selectors)){left_aligned_height=($left_aligned.length===0)?$first_child.outerHeight(true):$left_aligned.outerHeight(true);$node=$first_child.next();$node=rec.first_cleared_node($node,left_aligned_height);}else{if($right_aligned.length!==0||$first_child.is(right_aligned_selectors)){$resize_node=($right_aligned.length!==0)?$right_aligned:$first_child;right_aligned_width=$resize_node.width();if(right_aligned_width>180){$resize_node.css({width:180,height:"auto"});}$node=$first_child;}else{$node=$first_child;}}}return $node;},first_cleared_node:function($node,left_aligned_height){if($node.position().top>left_aligned_height){return $node;}else{return rec.first_cleared_node($node.next(),left_aligned_height);}},get_next_target_node:function($node,$context){var ad_spacing=$context.data("ads").ad_spacing,$candidate_node=rec.get_node_insertion_point($node,ad_spacing),body_ad_count=$context.find(".article_body_ad").length,distance_from_last_ad=null,remaining_height=0;if((typeof $candidate_node==="undefined")||($candidate_node===null)){$log("no more Nodes");return false;}distance_from_last_ad=$candidate_node.position().top-($node.position().top+$node.height());if(distance_from_last_ad>ad_spacing){if($candidate_node.prev().hasClass("gallery_embedded")){var $two_nodes_back=$candidate_node.prev().prev().prev();if($two_nodes_back.hasClass("article_body_ad")){}else{$candidate_node=$two_nodes_back;}}else{if($candidate_node.prev().hasClass("forbes_embedded_gallery")){var $one_node_back=$candidate_node.prev().prev();if($one_node_back.hasClass("article_body_ad")){}else{$candidate_node=$one_node_back;}}}}else{if($candidate_node.next().next().length>0){$candidate_node=$candidate_node.next().next();}else{if($candidate_node.next().length>0){$candidate_node=$candidate_node.next();}}}remaining_height=rec.get_remaining_content_height({"$node":$candidate_node.next()});if(remaining_height>=rec.minimum_remaining_height){distance_from_last_ad=$candidate_node.position().top-($node.position().top+$node.height());if(($candidate_node.nextAll().length<=2)&&(distance_from_last_ad<ad_spacing)){if(body_ad_count<2){var $prev_candidate=$candidate_node;if($candidate_node.hasClass("gallery_embedded")){$candidate_node=$candidate_node.prev().prev();}else{if($candidate_node.hasClass("forbes_embedded_gallery")){$candidate_node=$candidate_node.prev();}}if($candidate_node.hasClass("article_body_ad")){$candidate_node=$prev_candidate;}return $candidate_node;}else{return false;}}else{if($candidate_node.hasClass("forbes_embedded_gallery")){$candidate_node=$candidate_node.prev();}if($candidate_node.hasClass("article_body_ad")){return false;}if(($candidate_node.nextAll().length<=2)&&(distance_from_last_ad<ad_spacing)){return false;}$candidate_node=rec.test_trailing_position({"$candidate_node":$candidate_node});return $candidate_node;}}else{if(body_ad_count<2){var $temp_node=rec.test_trailing_position({"$candidate_node":$candidate_node});var $last_body_node=$context.find(".body_inner > *").last(),last_body_node_bot_y=$last_body_node.outerHeight(true)+$last_body_node.position().top,last_ad_bottom_y=($node.position().top+$node.height());if(last_body_node_bot_y>last_ad_bottom_y){$candidate_node=$temp_node;}return $candidate_node;}else{return false;}}},get_node_insertion_point:function($node,ad_spacing){var $context=$node.closest(".article_container"),$last_ad=$node,last_ad_height=parseInt($last_ad.find("iframe:nth-child(1)").attr("height"),10),next_all_count=null,$next_node=null,min_y=($last_ad.position().top+last_ad_height)+ad_spacing,ad_bottom_margin=30,bottom_y_of_ad=($last_ad.position().top+last_ad_height)+ad_bottom_margin;$.each($last_ad.nextAll(),function(index,node){var resized_dims=null,next_y=0;if(index===0){return;}if($(node).prev().find("img").length>0){next_y=$(node).prev().position().top;next_y+=rec.get_resized_image_dims({"$node":$(node).prev().find("img")});}else{next_y=($(node).prev().position().top+$(node).prev().height());}$next_node=$(node);if(next_y>=min_y){if(($next_node===null)&&($(node).prev().length>0)){$next_node=$(node).prev();}if(index>0){return false;}}if($(node).position().top<bottom_y_of_ad){if($(node)[0].tagName.toLowerCase()==="iframe"){resized_dims=rec.get_resized_iframe_dims({"$node":$(node)});node_height=resized_dims.height;}}});return $next_node;},get_resized_iframe_dims:function(args){var orig_dims={width:args.$node.width(),height:args.$node.height()},new_dims={};if($(window).width()<_breakpoints[0]){new_dims.width=rec.display_sizes.small.width;}else{if($(window).width()<_breakpoints[1]){new_dims.width=rec.display_sizes.medium.width;}else{new_dims.width=rec.display_sizes.large.width;}}new_dims.height=Math.round((orig_dims.height*new_dims.width)/orig_dims.width);return new_dims;},get_resized_image_dims:function(args){var orig_dims={width:args.$node.width(),height:args.$node.height()},new_dims={};if($(window).width()<_breakpoints[0]){new_dims.width=rec.display_sizes.small.width;}else{if($(window).width()<_breakpoints[1]){new_dims.width=rec.display_sizes.medium.width;}else{new_dims.width=rec.display_sizes.large.width;}}new_dims.height=Math.round((orig_dims.height*new_dims.width)/orig_dims.width);return new_dims;},get_remaining_content_height:function(args){var $node=args.$node,next_index_count=$node.nextAll().length,remaining_content_height=$node.outerHeight(true),$next_all=null;remaining_content_height-=20;if(next_index_count>0){$next_all=$node.nextAll();$.each($next_all,function(index,node){var tag_name=null,this_height=$(node).outerHeight(true);if($(node).hasClass("clearfix")){return true;}tag_name=$(node)[0].tagName.toLowerCase();if(tag_name==="p"){if($(node).find("> iframe").length>0){}}else{if((tag_name==="div")&&$(node).hasClass("gallery_embedded")){}}remaining_content_height+=this_height;});}return remaining_content_height;},test_trailing_position:function(args){var $candidate_node=args.$candidate_node,trailing_height=0,median_limit=(600-250),max_trailing_height=median_limit,$new_node=null;trailing_height=rec.get_trailing_height({"$candidate_node":$candidate_node});if(trailing_height<max_trailing_height){if($candidate_node.prev().hasClass("article_body_ad")!==true){$new_node=$candidate_node.prev();return rec.test_trailing_position({"$candidate_node":$new_node});}else{return $candidate_node;}}else{return $candidate_node;}},get_trailing_height:function(args){var trailing_height=0,$candidate_node=args.$candidate_node,height_factor=(100/75),median_limit=(600-250);$.each($candidate_node.nextAll(),function(index,node){trailing_height+=$(node).outerHeight(true);if(trailing_height<median_limit){trailing_height+=($(node).outerHeight(true)*height_factor);}});return trailing_height;},detect_window_width:function(){var new_size=null;if($(window).width()<_breakpoints[0]){new_size="small";}else{if($(window).width()<_breakpoints[1]){new_size="medium";}else{new_size="large";}}if(new_size!==$("body").attr("data-width-size")){$("body").attr("data-width-size",new_size);rec.update_ads_and_adjacencies();}},update_ads_and_adjacencies:function(){$.each($(".article_body_ad"),function(index,node){if(forbes.infinite_embeds){forbes.infinite_embeds.check.init($(node));}});}};var takeover={get_target_node:function($context){var $targets=$context.find(".body_inner").find("img, .storify, iframe"),$target=null,target_height=0;$targets.each(function(){var $this=$(this),height=$this.height(),$parent=null;if(height>target_height){target_height=height;if($this.is("img")){$parent=$this.parent();$target=$parent.is("a")?$parent.parent():$parent;}else{$target=$this;}}});return $target;}};var multifeature={first_insert_y:1020,get_first_target_node:function($context){var $targets=$context.find(".body_inner").children(),$target=null,matches=0;$targets.each(function(){var $this=$(this),position=$this.position().top,height=$this.height(),bottom_position=position+height;if(bottom_position>multifeature.first_insert_y){if(matches===0){$target=$this;matches=matches+1;}}});return $target;}};var url={get_vars:function(){var vars={},parts=window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(m,key,value){vars[key]=value;});return vars;},compare_context_uri_against_last_uri:function($context){var uri_match=false,last_page_no=forbes.infinite.get_last_page_rendered(),last_uri=$("#article_container_"+last_page_no).attr("data-uri");if((window.location.href.indexOf($context.attr("data-uri"))!==-1)&&(last_uri===$context.attr("data-uri"))){uri_match=true;}return uri_match;}};var element_test={is_bold:function($node){var bold=false,node_text,$child,child_text;if($node.is("h1, h2, h3, h4, h5, h6")){bold=true;}else{node_text=$.trim($node.text());$child=$node.children("b, strong");child_text=$.trim($child.text());if($child.length>0&&child_text===node_text){bold=true;}}return bold;}};var resize={exists:{ntv_vp:false,topx:false,rec:false},init:function(){$(window).on("resize",$.throttle(250,function(){resize.ntv_vp();resize.topx();resize.rec();}));},ntv_vp:function(){if(!resize.exists.ntv_vp){return;}var $native_ad_iframe=$(".vp-native-ad").find("div > iframe");if($native_ad_iframe.length>0){if($(window).width()<1400){$native_ad_iframe.css({width:136,opacity:1});}else{$native_ad_iframe.css({width:170,opacity:1});}}},topx:function(){if(!resize.exists.topx){return;}var $body=$("body"),body_data_width=$body.data("width-size"),body_width=$body.width(),body_center=$body.width()/2,$topx_ad_wide=$(".topx_ad_wide"),article_left=$(".article_body").first().offset().left,margin_left;if($(window).width()<_breakpoints[0]){margin_left=article_left/2;}else{if($(window).width()<_breakpoints[1]){margin_left=body_center/2-article_left/2;}else{margin_left=0;}}$topx_ad_wide.css({"margin-left":"-"+margin_left+"px"});},rec:function(){if(!resize.exists.rec){return;}rec.update_ads_and_adjacencies();}};return{init:_init,init_ads:_init_ads};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register(forbes.infinite_ads_redux.init);var forbes=(function(app,$){app.mediator=(function($){var _initialized=false,_components={},debug=null;function _init(){if(_initialized){return false;}_initialized=true;debug=forbes.util.debug;}_broadcast=function(event,args,source){var e=event||false;var a=args||[];if(!e){return;}for(var c in _components){if(typeof _components[c]["on"+e]=="function"){try{var s=source||_components[c];_components[c]["on"+e].apply(s,a);}catch(err){debug(["Mediator error.",e,a,s,err].join(" "));}}}};_add_component=function(name,component,replace_duplicate){if(name in _components){if(replace_duplicate){_remove_component(name);}else{throw new Error("Mediator name conflict: "+name);}}_components[name]=component;};_remove_component=function(name){if(name in _components){delete _components[name];}};_get_component=function(name){return _components[name]||false;};_contains_component=function(name){return(name in _components);};return{name:"mediator",init:_init,broadcast:_broadcast,add:_add_component,rem:_remove_component,get:_get_component,has:_contains_component};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register(forbes.mediator.init);var forbes=(function(app,$){app.ar_header=(function($){var debug=null,$header=null,$mini_header=null,$header_drawer=null,$search=null,$search_input=null,$user=null,_name="header",_mini_header_height=58,_header_mode_threshold=208,_toggle_menu=null,_search_input_short=null,_search_input_long=null;function _init(){debug=forbes.util.debug;$header=$("header.ar_global");$mini_header=$("header.mini_header");$header_drawer=$("header.mini_header .header_drawer");$search=$(".header_search");$search_input=$search.find("input.search_input");$user=$header.find(".user");_header_mode_threshold=$header.height();_search_input_short=$search_input.attr("data-placeholder-short");_search_input_long=$search_input.attr("data-placeholder-long");_on_window_resize();$(window).bind("resize",function(event){setTimeout(function(){_on_window_resize();},200);});$(window).focus(function(){setTimeout(function(){_on_window_resize();},200);});$(window).blur(function(){setTimeout(function(){_on_window_resize();},200);});_set_mode({mode:"mini"});$header.css("z-index","1000");_register_mediator_events();forbes.mediator.broadcast("Initialized");}function _on_window_resize(){var wrapper_width=$("header.mini_header .wrap").width(),mini_logo_width=$("header.mini_header .logo").outerWidth(),search_width=$search.parent('li[data-id="global_search"]').width(),user_width=$user.outerWidth(),header_drawer_width=wrapper_width-mini_logo_width-search_width-30-user_width,placeholder_text=null;placeholder_text=(search_width<=250)?_search_input_short:_search_input_long;$search_input.attr("placeholder",placeholder_text);if(wrapper_width>=980){$header_drawer.css({width:header_drawer_width});}else{$header_drawer.css({width:503});}$search.css({width:search_width,position:"fixed",top:13});}function _set_mode(args){if($("body").attr("data-header-mode")!==args.mode){$("body").attr("data-header-mode",args.mode);if(args.mode==="mini"){_animate_tools({state:"mini"});forbes.mediator.broadcast("MiniHeaderActivated");}}}function _animate_tools(args){var search_width=$search.parent('li[data-id="global_search"]').width();if(args.state==="mini"){$search.css({position:"fixed",top:13,width:search_width});$user.css({position:"fixed",top:0});}}function _register_mediator_events(){forbes.mediator.add(_name,function(){return{name:_name,onInitialized:function(){},onDefaultHeaderActivated:function(){},onMiniHeaderActivated:function(){}};}());}return{init:_init};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register(forbes.ar_header.init);var forbes=(function(app,$){app.header_toggle_menu=(function($){var debug=null,$modules=null,_name="header_toggle_menu",_leave_delay=500;function _init(){debug=forbes.util.debug;$modules=$(".togglable");_bind_events();_register_mediator_events();forbes.mediator.broadcast("Initialized");}function _bind_events(){$.each($modules,function(index,node){var $module=$(node);var $inner_containers=[$("header.ar_global .rollover"),$("header.ar_global .dropdown"),$("header.ar_global .toggle_dropdown"),$("header.mini_header .dropdown"),$(".ar_global_logo_rollover .rollover")];$.each($inner_containers,function(index,node){$(node).on("click",function(e){e.stopPropagation();});});if($module.hasClass("hover")){$module.data("hovering",false);$module.find(".toggle").off("mouseenter").on("mouseenter",function(){$module.data("hovering",true);clearInterval($module.data("leave_timeout"));_toggle_menu({"$link":$(this),action:"open"});});$module.find(".toggle_dropdown").off("mouseenter").on("mouseenter",function(){if($module.hasClass("expanded")===true){clearInterval($module.data("leave_timeout"));$module.data("hovering",true);}});$module.find(".toggle, .toggle_dropdown").off("mouseleave").on("mouseleave",function(){var $this=$(this);clearInterval($module.data("leave_timeout"));$module.data("leave_timeout",setTimeout(function(){_toggle_menu({"$link":$this,action:"close"});},_leave_delay));$module.data("hovering",false);});}else{$module.find(".toggle").off("click").on("click",function(){_toggle_menu({"$link":$(this)});return false;});$("body").on("click",function(){_close_all();});}});}function _close_all(args){var exclude_array=args||[];$.each($modules,function(index,node){var content_outer_selector=$(node).find(".toggle").attr("data-content-outer"),content_inner_selector=$(node).find(".toggle").attr("data-content-inner");for(var i=0;i<exclude_array.length;i++){if(exclude_array[i]===node){return;}}_close({"$module":$(node),"$content_outer":$(node).find(content_outer_selector),"$content_inner":$(node).find(content_inner_selector)});});}function _toggle_menu(args){var $link=args.$link,$module=$link.closest(".togglable"),content_outer_selector=$module.find(".toggle").attr("data-content-outer"),content_inner_selector=$module.find(".toggle").attr("data-content-inner"),params={"$module":$module,"$content_outer":$module.find(content_outer_selector),"$content_inner":$module.find(content_inner_selector)},brandvoice_found=false;if($module.length<1){return false;}if(!content_outer_selector){return false;}if(!content_inner_selector){return false;}if(args.action&&(args.action==="open")){_open(params);}else{if(args.action&&(args.action==="close")){_close(params);}else{if($module.hasClass("collapsed")){_open(params);brandvoice_found=(forbes.header_drawer&&forbes.header_drawer.contains_brandvoice(params.$content_outer));if(!$module.hasClass("hover")&&brandvoice_found){forbes.event_tracking.track_ga_event(["Header","HeaderExpandViewed","CollapsedHeaderExpanded"]);}}else{if($module.hasClass("expanded")){_close(params);}}}}}function _open(args){$(args.$module).addClass("expanded").removeClass("collapsed");_animate_menu({state:"open","$content_outer":args.$content_outer,"$content_inner":args.$content_inner});forbes.mediator.broadcast("ToggleMenuOpened",[args.$module]);}function _close(args){_animate_menu({"$module":args.$module,state:"close","$content_outer":args.$content_outer,"$content_inner":args.$content_inner});forbes.mediator.broadcast("ToggleMenuClosed",[args.$module]);}function _animate_menu(args){var $module=args.$module,content_outer_height=0,$content_outer=args.$content_outer,$content_inner=args.$content_inner;content_outer_height=(args.state==="open")?$content_inner.outerHeight():0;if(args.state==="open"){$content_outer.css({opacity:1});}$content_outer.stop().animate({height:content_outer_height},{duration:100,easing:"easeOutQuad",complete:function(){if(args.state==="close"){$content_outer.css({opacity:0});$module.addClass("collapsed").removeClass("expanded");}}});}function _register_mediator_events(){forbes.mediator.add(_name,function(){return{name:_name,onInitialized:function(){},onToggleMenuOpened:function(exception_array){_close_all(exception_array);}};}());}return{init:_init,open:_open,close:_close,close_all:_close_all};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register(forbes.header_toggle_menu.init);var forbes=(function(app,$){app.logo_rollover=(function($){var debug=null,_initialize=false,_name="logo_menu",_leave_delay=500,$toggle=null,$menu=null,$channels=null,_logo_nav_html_loaded=false,_channel_rollover_delay,_start_logo_nav_load_time=null,_logo_nav_delay_time=500,_rollover_list={columnWidth:210,columnMarginRight:20,maxRowCount:6,rowHeight:30},_toggle_selector=null,_menu_selector=null,_menu_anchor_selector=null,_combined_selector=null,_combined_selector_2=null,_delay_longer=500,_delay=250,_is_ipad=Modernizr.touch;function _init(){debug=forbes.util.debug;_initialized=true;_toggle_selector=".logo_menu_toggle";_menu_selector=".ar_global_logo_rollover";_menu_anchor_selector=".ar_global_logo_rollover .channels a";_combined_selector=_toggle_selector+","+_menu_selector;_combined_selector_2=_menu_selector+","+_menu_anchor_selector;$toggle=$(_toggle_selector);$menu=$(_menu_selector);$menu.data("hovering",false);_bind_events();}function _bind_events(){$menu.data("hovering",false);if(_is_ipad){var $header_bg=$("<div />",{"class":"ar_global_logo_rollover_bg"});$menu.before($header_bg);$header_bg.on("click",function(){_close();$header_bg.hide();});$toggle.on("click",function(e){_open();$header_bg.show();e.preventDefault();});}else{$toggle.off("mouseenter").on("mouseenter",function(){$menu.data("hovering",true);clearInterval($menu.data("logo_hover_html_poll"));clearTimeout($menu.data("leave_timeout"));_open();return false;});$(_combined_selector_2).off("mouseenter").on("mouseenter",function(){clearInterval($menu.data("logo_hover_html_poll"));clearTimeout($menu.data("leave_timeout"));_show_hide_feature({state:"hide"});if($menu.hasClass("expanded")===true){$menu.data("hovering",true);_open();}});$(_combined_selector).off("mouseleave").on("mouseleave",function(){var $this=$(this);clearTimeout($menu.data("leave_timeout"));$menu.data("leave_timeout",setTimeout(function(){_close();_show_hide_feature({state:"show"});},_leave_delay));$menu.data("hovering",false);});$("html").on("click",function(){_close();});}}function _show_hide_feature(args){if(args.state==="show"){$(".primary_feature").fadeIn(100);}else{if(args.state==="hide"){if($("body").attr("data-header-mode")==="default"){$(".primary_feature").fadeOut(100);}}}}function _open(){if($menu.hasClass("collapsed")){$menu.addClass("expanded").removeClass("collapsed");}var now=new Date();_start_logo_nav_load_time=now.getTime();if(!_logo_nav_html_loaded){if(!$menu.hasClass("loading_started")){$menu.addClass("loading_started");_load_logo_nav_html();}$menu.data("logo_hover_html_poll",setInterval(function(){if(_logo_nav_html_loaded===true){clearInterval($menu.data("logo_hover_html_poll"));_animate_menu({state:"open"});}},250));}else{_animate_menu({state:"open"});}}function _close(){clearInterval($menu.data("logo_hover_html_poll"));_animate_menu({state:"close"});$toggle.removeClass("active");}function _animate_menu(args){var content_outer_height=0,$content_outer=$menu,$content_inner=$menu.find(".rollover"),menu_offset_top=0,menu_offset_left=$toggle.offset().left;if($('body[data-header-mode="default"]').length>0){menu_offset_top=$toggle.offset().top+$toggle.outerHeight();}else{menu_offset_top=58;}if(!$("body").hasClass("editOn")){content_outer_height=(args.state==="open")?420:0;if(args.state==="open"){$content_outer.css({opacity:1,top:menu_offset_top,left:menu_offset_left});$content_inner.css({display:"block"});if($menu.hasClass("expanded")){}_show_hide_feature({state:"hide"});$toggle.addClass("active");}}$content_outer.stop().animate({height:content_outer_height},{duration:1,easing:"easeOutQuad",complete:function(){if(args.state==="close"){$content_outer.css({opacity:0});$content_inner.css({display:"none"});$menu.addClass("collapsed").removeClass("expanded");}else{_update_channel_layout();}}});}function _load_logo_nav_html(){var ajax_url=$menu.attr("data-nav-ajax-url");$.ajax({type:"get",url:ajax_url,data:{},dataType:"html",timeout:10*1000,error:function(e,textStatus,errorThrown){forbes.util.debug("error loading: "+ajax_url);forbes.util.debug("error textStatus: "+textStatus);forbes.util.debug("error errorThrown: "+errorThrown);},success:function(data){$menu.find(".rollover").html(data);_init_channel_nav();$channels.find("li:first").addClass("selected");_logo_nav_html_loaded=true;}});}function _init_channel_nav(){$channels=$menu.find(".rollover ul.channels");$channel=$menu.find(".rollover ul.channels li");$channel_list=$menu.find(".rollover .channel ul");$channels.find("a").on("click",function(){forbes.event_tracking.track_ga_event(["Header","LinkFollowed","tab"]);});$menu.find(".channel_detail ul a").on("click",function(){forbes.event_tracking.track_ga_event(["Header","LinkFollowed","tablink"]);});$menu.find(".channel_detail .headline a").on("click",function(){forbes.event_tracking.track_ga_event(["Header","LinkFollowed","tabpromo"]);});$(".channel").find("ul").css({height:"1px",overflow:"hidden"});if(_is_ipad){var $b=$("<b />");$channel.append($b);$channel.css({position:"relative"});$channel.find("b").bind("click",function(e){var linkId=$(this).parent().attr("data-id");_channel_rollover(linkId);e.preventDefault();});}else{$channel.on("mouseenter",function(){var linkId=$(this).attr("data-id");_channel_rollover(linkId);});}$(".right_column").on("mouseenter",function(){clearTimeout(_channel_rollover_delay);});var maxRowCount=_rollover_list.maxRowCount;$menu.find(".rollover").css({display:"block"});$.each($channel_list,function(thisListKey,thisList){var $thisList=$(thisList),$thisListItems=$(thisList).find("li"),totalCount=$thisList.children().length,currentRowHeight=0;if(totalCount>maxRowCount){if(totalCount>_rollover_list.maxRowCount){maxRowCount=Math.ceil(totalCount/2);}}for(var i=0;i<$thisList.children().length;i++){var thisListItem=$thisList.find('li[data-id="'+(i+1)+'"]'),columnId=Math.floor(i/maxRowCount),rowId=Math.floor(i%maxRowCount),x=columnId*(_rollover_list.columnWidth+_rollover_list.columnMarginRight),y=(Math.floor(i%maxRowCount)*_rollover_list.rowHeight);y=currentRowHeight;if(rowId<(maxRowCount-1)){currentRowHeight+=(thisListItem.height()+13);}else{currentRowHeight=0;}$(thisListItem).css({position:"absolute",top:y,left:x});}});if($(".channel.visible").length<1){_expand_channel($menu.find(".rollover ul.channels li:first").attr("data-id"));}}function _channel_rollover(linkId){clearTimeout(_channel_rollover_delay);_channel_rollover_delay=setTimeout(function(){_channel_rollover_id=linkId;_expand_channel(linkId);},_delay_longer);}function _expand_channel(linkId){var $this=$menu.find('.channels li[data-id="'+linkId+'"]'),$channel_list_items=$channels.find("li"),$channel_detail=$menu.find(".channel_detail .channel");$.each($channel_list_items,function(listItemKey,listItemElement){if($this.attr("data-id")===$(listItemElement).attr("data-id")){$(listItemElement).removeClass("unselected").addClass("selected");}else{$(listItemElement).removeClass("selected").addClass("unselected");}});$.each($channel_detail,function(channelDetailKey,channelDetailElement){if($this.attr("data-id")===$(channelDetailElement).attr("data-id")){$(channelDetailElement).addClass("visible").css({display:"block"});}else{$(channelDetailElement).removeClass("visible").css({display:"none"});}});_update_channel_layout();}function _update_channel_layout(){var $thisList=$(".channel.visible").find("ul"),$thisListItems=$thisList.find("li"),maxRowCount=_rollover_list.maxRowCount,totalCount=$thisList.children().length,currentRowHeight=0;if(totalCount>maxRowCount){maxRowCount=Math.ceil(totalCount/2);}for(var i=0;i<$thisList.children().length;i++){var $thisListItem=$thisList.find('li[data-id="'+(i+1)+'"]'),columnId=Math.floor(i/maxRowCount),rowId=Math.floor(i%maxRowCount),x=columnId*(_rollover_list.columnWidth+_rollover_list.columnMarginRight),y=(rowId*_rollover_list.rowHeight);y=currentRowHeight;if(rowId<(maxRowCount-1)){currentRowHeight+=($thisListItem.height()+13);}else{currentRowHeight=0;}if($("html").hasClass("touch")){$thisListItem.css({position:"static",padding:"7px 0","float":"left",width:"210px"}).addClass("clearfix");}else{$thisListItem.css({position:"absolute",top:y,left:x,opacity:1});}}$thisList.css({height:"auto",overflow:"visible"});}function _register_mediator_events(){forbes.mediator.add(_name,function(){return{name:_name,onInitialized:function(){},onToggleMenuOpened:function(){}};}());}return{init:_init,open:_open,close:_close};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register(forbes.logo_rollover.init);var forbes=(function(app,$){app.sharing_controls_v2=(function($){var debug=null,_initialized=false,$sticky_sharing=null,$sticky_sharing_bg=null,$share_icon=null,_tab_width=0,_is_touch_device=Modernizr.touch,_is_mouse_over=false,_is_interaction_started=false,_is_interaction_complete=false;function _init(){debug=forbes.util.debug;$sticky_sharing=$(".sticky_sharing_v2");$sticky_sharing_bg=$(".sticky_sharing_bg");$share_icon=$(".share_icon");_tab_width=_get_tab_width();_init_events();$(window).resize(_on_resize);$sticky_sharing.show();}function _on_resize(){_tab_width=_get_tab_width();$sticky_sharing.find(".share_tab").css("width",_tab_width);}function _get_tab_width(){return($(window).width()<=1200)?70:80;}function _init_events(){$sticky_sharing_bg.on("click",function(){$sticky_sharing.trigger("mouseleave");});$share_icon.on("click",function(){if(_is_touch_device&&$sticky_sharing.hasClass("active")){$sticky_sharing.trigger("mouseleave");}});$sticky_sharing.on("mouseenter",function(){_is_mouse_over=true;$sticky_sharing.addClass("hovering");setTimeout(function(){if($sticky_sharing.hasClass("hovering")){$sticky_sharing_bg.show();$sticky_sharing.addClass("active").find(".share_tab").stop().animate({width:"700px"},150,"easeOutCubic");}},100);}).on("mouseleave",function(){_is_mouse_over=false;_collapse_check();});$("#gigya_inline_share_button_email_icon").on("click",function(){$("#gigya_inline_share_button_email-reaction0").trigger("click");});}function _collapse_check(){if(!_is_mouse_over&&(!_is_interaction_started||_is_interaction_complete)){_is_interaction_started=false;_is_interaction_complete=false;$sticky_sharing_bg.hide();$sticky_sharing.removeClass("hovering active").find(".share_tab").stop().animate({width:_tab_width},150,"easeOutCubic");}}function _set_interaction_started(value){_is_interaction_started=value;_collapse_check();}function _set_interaction_complete(value){_is_interaction_complete=value;_collapse_check();}return{init:_init,set_interaction_started:_set_interaction_started,set_interaction_complete:_set_interaction_complete};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register(forbes.sharing_controls_v2.init);var forbes=(function(app,$){app.native_ads=(function($){var debug=null;function _init(options){debug=forbes.util.debug;}return{init:_init};}($));return app;}(forbes||{},jQuery));var forbes=(function(app,$){app.pepe2=(function(){var url_base="http://www.forbes.com/pepe2/track.php?";function _init(){var params={pt:app.analytics.get_var("forbes.page_meta.type"),i:app.analytics.get_var("forbes.page_meta.natural_id"),re:get_referrer(),ts:+(new Date())};_drop_pixels(params);}function _drop_pixels(_meta_data){var image=new Image();image.src=generate_url(_meta_data);}function generate_url(params){var query=[];for(var key in params){if(null==params[key]||""==params[key]){continue;}query.push(encodeURIComponent(key)+"="+encodeURIComponent(params[key]));}return url_base+query.join("&");}function get_referrer(){var url=document.createElement("a");url.href=$.cookie("refURL")||document.referrer;if(document.location.host==url.host){return null;}return url.href;}return{init:_init,drop_pixels:_drop_pixels};}());return app;}(forbes||{},jQuery));forbes.bootstrap.register(forbes.pepe2.init);var forbes=(function(app,$){app.external_intx_ad_manager=(function($){var debug=null,_debug_enabled=true,_library_loaded=false,_library_load_started=false,_library_loaded_int=null,_active_units=[];function _debug_wrapper(input){if(_debug_enabled){forbes.util.debug(input);}}function _init(){debug=forbes.util.debug;}function _load_library(callback){debug("load_library");if(_library_loaded){if(callback){callback();}return;}else{if(_library_load_started===true){return;}}_library_loaded_int=setInterval(function(){if(window.googletag){clearInterval(_library_loaded_int);_library_loaded=true;if(callback){callback();}}},100);_library_load_started=true;}function get_url_vars(){var vars={},parts=window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(m,key,value){vars[key]=value;});return vars;}function _init_publisher_tag(adslot_array){googletag.cmd.push(function(){pa=googletag.pubads();var unitName="/7175/fdc.forbes/";var window_url=window.location.pathname.split("/");var directory=window_url[1];if(directory==="sites"){var google_tag_swimlane=get_url_vars()["ss"];}if(typeof google_tag_channel!=="undefined"){googletag.pubads().setTargeting("channel",google_tag_channel);debug("SET traget channel"+google_tag_channel);}if(typeof google_tag_section!=="undefined"){googletag.pubads().setTargeting("section",google_tag_section);debug("SET traget section"+google_tag_section);}if(typeof google_tag_swimlane!=="undefined"){googletag.pubads().setTargeting("swimlane",google_tag_swimlane);debug("SET traget swimlane"+google_tag_swimlane);}if(typeof google_tag_specialslot!=="undefined"){googletag.pubads().setTargeting("specialslot",google_tag_specialslot);debug("SET traget specialslot"+google_tag_specialslot);}if(typeof google_tag_display_channel!=="undefined"){googletag.pubads().setTargeting("displaychannel",google_tag_display_channel);debug("SET traget displaychannel"+google_tag_display_channel);}if(typeof google_tag_display_section!=="undefined"){googletag.pubads().setTargeting("displaysection",google_tag_display_section);debug("SET traget displaysection"+google_tag_display_section);}for(var i=0;i<adslot_array.length;i++){debug("\n adslot array "+[adslot_array[i].id]);if([adslot_array[i].id]=="intx"||[adslot_array[i].id]=="inread"){if(typeof google_tag_zone!=="undefined"){unitName="/7175/fdc.forbes/"+google_tag_zone;}debug("\n *** unitName "+unitName);}googletag.defineSlot(unitName,adslot_array[i].sizes,"dfp-"+adslot_array[i].id).addService(pa).setTargeting("pos",[adslot_array[i].id]);}pa.enableAsyncRendering();pa.collapseEmptyDivs();googletag.enableServices();});}function _display(adslot_array){if(!_library_loaded){_load_library(function(){_display(adslot_array);});return false;}_init_publisher_tag(adslot_array);for(var i=0;i<adslot_array.length;i++){var is_already_active=false;for(var n=0;n<_active_units.length;n++){if(_active_units[n]==adslot_array[i].id){is_already_active=true;}}if(is_already_active){debug("**** is already active");googletag.pubads().refresh("dfp-"+adslot_array[i].id);}else{debug("**** NOT active, need to display");googletag.cmd.push(function(){var element_id="dfp-"+adslot_array[i].id;googletag.display(element_id);});_active_units.push(adslot_array[i].id);}}}return{init:_init,display:_display};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register(forbes.external_intx_ad_manager.init);var forbes=(function(app,$){app.infinite_scroll_intx=(function($){var debug=_debug_wrapper,_debug_enabled=false,_polling_interval=250,_max_polling_time=4000,_polling_time=0,_cookie_intX="_forbes_intX",_display_timeout=null,_initialized=false;function _debug_wrapper(input){if(_debug_enabled){forbes.util.debug(input);}}function _initialize_ad(){debug("Attempt to start intX init");if(document.all&&!document.addEventListener){debug("IE8 detected - bailing");return;}if(_initialized){return;}if(_display_timeout!==null){debug("PAGE CHANGE DETECTED. Resetting intX ad slot.");clearTimeout(_display_timeout);_display_timeout=null;}if($.cookie(_cookie_intX)===null){debug("Check krux vars if intX can display");_show_intX();}}function _init_layout(){$("body").append('<div class="external_interstitial_ad" id="dfp-intx"></div>');}function _init_ad(){if($.cookie(_cookie_intX)===null){$.cookie(_cookie_intX,$.now(),{path:"/",domain:".forbes.com"});}if(forbes.external_intx_ad_manager){forbes.infinite_scroll_inread.update_last_article();forbes.external_intx_ad_manager.display([{id:"intx",sizes:[[1,1]]}]);}_initialized=true;}function _show_intX(){if("undefined"!=typeof forbesSecondsBetweenIntXTriggerOverride){debug("krux vars loaded. Continuing init of intX");if(!forbes.infinite_scroll_inread.can_intx_show()){return;}debug("inread allows intx now");var overrideIntX=parseInt(forbesSecondsBetweenIntXTriggerOverride,10);if(overrideIntX==-1){return;}if(overrideIntX>0&&overrideIntX!==-1){overrideIntX=overrideIntX*1000;if($("#dfp-intx").length==0){_init_layout();}debug("IntX scheduled to display. Setting timeout.");_display_timeout=setTimeout(_init_ad,overrideIntX);}}else{if(_polling_time<_max_polling_time){_polling_time+=_polling_interval;setTimeout(function(){_show_intX();},_polling_interval);}}}return{initialize_ad:_initialize_ad};}($));return app;}(forbes||{},jQuery));var forbes=(function(app,$){app.infinite_scroll_inread=(function($){var debug=_debug_wrapper,_debug_enabled=false,_polling_interval=250,_max_polling_time=4000,_polling_time=0,_cookie_intX="_forbes_intX",_cookie_inread="_forbes_inread",_current_page_no=0,_ad_state=null,_display_timeout=null;function _debug_wrapper(input){if(_debug_enabled){forbes.util.debug(input);}}function _init(){_load_ad_state();}function _initialize_ad(page_no){debug("Attempt to start inread init");if(document.all&&!document.addEventListener){debug("IE8 detected - bailing");return;}_current_page_no=page_no;if(_display_timeout!==null){debug("PAGE CHANGE DETECTED. Resetting inread ad slot.");clearTimeout(_display_timeout);_display_timeout=null;}debug("Last displayed "+($.now()-_ad_state._last_display)+"ms ago");debug("Must be at least "+(30*60*1000)+"ms ago");if(_ad_state._last_display===null||(_ad_state._times_displayed<2&&($.now()-_ad_state._last_display)>(30*60*1000))){debug("Inread within time constraints. Try to init.");_show_inread();}}function _show_inread(){if("undefined"!=typeof forbesSecondsBetweenInReadTriggerOverride){debug("krux vars loaded. Continuing init of inread");if($("#dfp-inread").length==0){_init_layout();}if(_ad_state._times_displayed==0){_display_timeout=setTimeout(_init_ad,100);}else{if(_ad_state._times_displayed==1){if($.cookie(_cookie_intX)===null&&forbesSecondsBetweenIntXTriggerOverride!==-1){return;}_display_timeout=setTimeout(_init_ad,100);}}}else{if(_polling_time<_max_polling_time){_polling_time+=_polling_interval;setTimeout(function(){_show_inread();},_polling_interval);}else{debug("krux timed out! Bailing on intx/inread");}}}function _load_ad_state(){var _cookie=$.cookie(_cookie_inread);if(_cookie===null){_ad_state={_times_displayed:0,_last_display:null,_last_article:null};}else{_ad_state=$.parseJSON(_cookie);}}function _save_ad_state(){$.cookie(_cookie_inread,JSON.stringify(_ad_state),{path:"/",domain:".forbes.com"});}function _init_layout(){$("body").append('<div class="external_interstitial_ad" id="dfp-inread"></div>');}function _init_ad(){debug("inread - DISPLAYING AD.");var _article_url=_is_blacklisted();if(_article_url===null){return;}_ad_state._times_displayed++;_ad_state._last_display=$.now();_ad_state._last_article=_article_url;_save_ad_state();debug("inread - saved.");if(forbes.external_intx_ad_manager){debug("inread - Pushing to ad manager");forbes.external_intx_ad_manager.display([{id:"inread",sizes:[[1,1]]}]);}}function _is_blacklisted(){var _article_container=$("#article_container_"+_current_page_no),_data_stats=(_article_container.length>0)?_article_container.find(".article_stats_data").data("stats"):null;debug("inread - loaded vars");_display_timeout=null;if(_data_stats==null){return null;}debug("inread - had data stats");if(_data_stats.page_meta.brandvoice){return null;}if(_data_stats.page_meta.special_slot){return null;}if(forbes.article_responsive.has_push_state()){if(forbes.util.get_url_param_by_name("ss",History.getState().url)){return null;}}else{if(forbes.util.get_url_param_by_name("ss",location.href)){return null;}}debug("inread - passed blacklist.");debug("inread - checking brightcove");var _video_data=_article_container.find(".brightcove_wrapper .video_data");if(_video_data.length>0){var _halt=false;_video_data.each(function(i,v){if($(v).attr("data-video-autostart")=="true"){_halt=true;}});if(_halt){return null;}}debug("inread - brightcove pass");if(_ad_state._last_article==_data_stats.page_meta.sitepage){return null;}return _data_stats.page_meta.sitepage;}function _can_intx_show(){debug("inread - Checking if intx is allowed");var _article_url=_is_blacklisted();if(_article_url===null){return false;}debug("inread - Not page ad played on previously");return(_ad_state._times_displayed==1)?true:false;}function _update_last_article(){var _article_url=_is_blacklisted();if(_article_url===null){return;}_ad_state._last_article=_article_url;_save_ad_state();}return{init:_init,can_intx_show:_can_intx_show,update_last_article:_update_last_article,initialize_ad:_initialize_ad};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register(forbes.infinite_scroll_inread.init);(function(){window.gravityInsightsParams={type:"content",action:"",site_guid:"df51572e4a248537619f3b6b11928388"};var adServerReq,bUrl,cburl,doUseGravityUserGuid,includeJs,jq,pfurl,type,ug,wlPrefix,wlUrl,_ref,_ref1,_ref2;includeJs=function(a){var b;b=document.createElement("script");b.async=!0;b.src=a;a=document.getElementsByTagName("script")[0];return a.parentNode.insertBefore(b,a);};bUrl="https:"===document.location.protocol?"https://b-ssl.grvcdn.com/moth-min.js":"http://b.grvcdn.com/moth-min.js";ug=(doUseGravityUserGuid=!0===gravityInsightsParams.useGravityUserGuid?1:0)?"":gravityInsightsParams.user_guid||(null!=(_ref=/grvinsights=([^;]+)/.exec(document.cookie))?_ref[1]:void 0)||"";wlUrl=(wlPrefix="","");bUrl&&includeJs(bUrl);wlUrl&&(window.gravityInsightsParams.sidebar&&(window.gravityInsightsParams.wlStartTime=(new Date).getTime()),includeJs(wlUrl));})();var forbes=(function(app,$){app.horizon=(function($){var debug=null;function _init(){debug=forbes.util.debug;loadHorizon();}function loadHorizon(){$LAB.script("http://ak.sail-horizon.com/horizon/v1.js").wait(function(){if(Sailthru){Sailthru.setup({domain:"horizon.forbes.com",cookieDomain:".forbes.com"});}else{debug("horizon did not load");}});}return{init:_init};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register(forbes.horizon.init);