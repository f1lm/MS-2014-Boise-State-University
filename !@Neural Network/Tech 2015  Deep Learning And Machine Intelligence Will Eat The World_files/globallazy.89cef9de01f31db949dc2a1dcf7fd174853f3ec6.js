var forbes=(function(app,$){app.typeahead=(function($){var debug=null,_typeahead_objects=[],_minimum_string_length=1,_in_focus=false,_query_cache_limit=500,_datasource_size_limit=1000,_max_num_of_visible_results=12;function _init(options){debug=forbes.util.debug;var $input=$(options.$input);if($input.length<1){return false;}if($input.hasClass("typeahead_initialized")){return false;}_typeahead_objects.push(options);_activate(_typeahead_objects.length-1);$input.addClass("typeahead_initialized");$(window).resize(_on_window_resize);}function _activate(object_id){var typeahead_obj=_typeahead_objects[object_id],$input=$(typeahead_obj.$input),$form=$input.parents("form");typeahead_obj.use_prefetch=(typeahead_obj.url_prefetch)?true:false;typeahead_obj.prefetch_loaded=false;typeahead_obj.datasource=[];typeahead_obj.query_cache=[];typeahead_obj.shown=false;typeahead_obj.$anchor=$input.parents(".typeahead_anchor");typeahead_obj.$results=typeahead_obj.$anchor.find(".typeahead_results_holder");$input.on("blur.typeahead",$.proxy(_on_blur,typeahead_obj)).on("focus.typeahead",$.proxy(_on_focus,typeahead_obj)).on("keydown.typeahead",$.proxy(_on_keydown,typeahead_obj)).on("keyup.typeahead",$.proxy(_on_keyup,typeahead_obj));$form.on("submit",function(){forbes.event_tracking.track_ga_event(["SearchTypeahead","CustomQuery",$input.val()]);});}function _on_blur(){var that=this,$active_items=this.$results.find("li").filter(".hovering");this._in_focus=false;if($active_items.length<1){setTimeout(function(){_hide_results(that);},150);}}function _on_focus(){this._in_focus=true;if(this.use_prefetch&&!this.prefetch_loaded){_load_prefetch(this);forbes.event_tracking.track_ga_event(["SearchTypeahead","Focused"]);}}function _on_keydown(e){if(!this.shown){return;}switch(e.keyCode){case 9:case 27:e.preventDefault();break;case 13:_keydown_active_state(this);e.preventDefault();break;case 38:if(e.type!="keydown"){break;}e.preventDefault();_prev(this);break;case 40:if(e.type!="keydown"){break;}e.preventDefault();_next(this);break;}e.stopPropagation();}function _on_keyup(e){switch(e.keyCode){case 40:case 38:break;case 13:if(!this.shown){return;}_keyup_active_state(this);_select(this);break;case 27:if(!this.shown){return;}_hide_results(this);break;default:_lookup(this);}e.stopPropagation();e.preventDefault();}function _on_results_mouseenter(e){var $this=$(this);$this.parents("ul").find("li").removeClass("active");$this.addClass("active hovering");}function _on_results_mouseleave(e){var $this=$(this),that=this;if(!this._in_focus){setTimeout(function(){_hide_results(that);},150);}$this.removeClass("hovering");}function _next(typeahead_obj){if(!typeahead_obj.shown||typeahead_obj.$results.find("li.result").length<1){return false;}var $items=typeahead_obj.$results.find("li"),$current=$items.filter(".active"),$next=$items.first();if($current.length>0&&!$current.hasClass("full_results_link")){$next=$current.next();if($next.hasClass("hidden_result")){$next=typeahead_obj.$results.find("li.full_results_link");}}$current.removeClass("active");$next.addClass("active");}function _prev(typeahead_obj){if(!typeahead_obj.shown||typeahead_obj.$results.find("li.result").length<1){return false;}var $items=typeahead_obj.$results.find("li"),$current=$items.filter(".active"),$prev=typeahead_obj.$results.find("li.full_results_link");if($current.length>0&&$current.index()!==0){$prev=$current.prev();if($prev.hasClass("hidden_result")){$prev=typeahead_obj.$results.find("li.result").not(".hidden_result").last();}}$current.removeClass("active");$prev.addClass("active");}function _on_window_resize(){if(_typeahead_objects.length<1){return false;}for(var i=0;i<_typeahead_objects.length;i++){if(_typeahead_objects[i].shown){_position_and_resize_results(_typeahead_objects[i]);}}}function _keydown_active_state(typeahead_obj){var $active=typeahead_obj.$results.find("li.active");if($active.length<1){return false;}$active.addClass("keydown");}function _keyup_active_state(typeahead_obj){var $active=typeahead_obj.$results.find("li.active");if($active.length<1){return false;}$active.removeClass("keydown");}function _lookup(typeahead_obj){var term=typeahead_obj.$input.val(),results;term=term.replace("<script","");if(term.length<_minimum_string_length){_hide_results(typeahead_obj);return false;}if(!_is_in_cache(term,typeahead_obj)){debug("_lookup: need to load term");_load_term(term,typeahead_obj);}results=_get_matches(term,typeahead_obj);if(!results){_hide_results(typeahead_obj);return false;}typeahead_obj.shown=true;_render_results(term,results,typeahead_obj);}function _render_results(term,results,typeahead_obj){if(!typeahead_obj.shown){return false;}var $results_list=typeahead_obj.$results.find("ul");var html="";for(var i=0;i<results.length;i++){if(i>_max_num_of_visible_results){break;}html+=_render_result_item_html(term,results[i]);}html+=_render_fullresults_html(term);$results_list.html(html);$results_list.find("li").off("mouseenter.typeahead");if(results.length>0){$results_list.find("li").on("mouseenter.typeahead",_on_results_mouseenter);$results_list.find("li").on("mouseleave.typeahead",_on_results_mouseleave);$results_list.find("li a").on("click.typeahead",function(){_select(typeahead_obj);return false;});}typeahead_obj.$anchor.addClass("show_typeahead_results");_position_and_resize_results(typeahead_obj);}function _position_and_resize_results(typeahead_obj){if(!typeahead_obj.shown){return false;}if($("body").hasClass("infinite")){var top_position=typeahead_obj.$anchor.height()+1;var left_position=0;}else{var top_position=typeahead_obj.$anchor.height()-9;var left_position=typeahead_obj.$anchor.position().left;}typeahead_obj.$results.width(typeahead_obj.$anchor.width()).css({top:top_position,left:left_position});var $items=typeahead_obj.$results.find("li"),available_height=_get_available_screen_height();available_height-=30;$items.removeClass("hidden_result");if(typeahead_obj.$results.height()<available_height){debug("Results fit. No limiting required");return false;}var $full_results_link=typeahead_obj.$results.find("li.full_results_link"),full_results_link_height=$full_results_link.height();$items.each(function(){var $this=$(this),new_y_endpoint=$this.position().top+$this.height()+full_results_link_height;if(new_y_endpoint>available_height&&!$this.hasClass("full_results_link")){$this.addClass("hidden_result");}else{$this.removeClass("hidden_result");}});}function _get_available_screen_height(){if($("body").hasClass("infinite")){var $header=$("header.ar_global");}else{var $header=$("header.global");}var $follow_bar=$("div#follow_bar"),follow_bar_height=(($follow_bar.length>0)?$follow_bar.height():0),header_mode=forbes.header.get_mode(),header_pos_top=$header.position().top,header_height=$header.height(),window_scroll_top=$(window).scrollTop(),header_position_offset=(header_mode=="fixed")?0:($header.offset().top-window_scroll_top),available_height=$(window).height();available_height-=(follow_bar_height+header_height);if(header_mode=="relative"){available_height-=header_position_offset;}return available_height;}function _hide_results(typeahead_obj){if(typeof typeahead_obj=="undefined"||typeof typeahead_obj.$anchor=="undefined"){return false;}typeahead_obj.shown=false;typeahead_obj.$anchor.removeClass("show_typeahead_results");}function _hide_all(){for(var i=0;i<_typeahead_objects.length;i++){if(_typeahead_objects[i].shown){_hide_results(_typeahead_objects[i]);}}}function _select(typeahead_obj){var $active=typeahead_obj.$results.find("li.active"),$loading_msg=typeahead_obj.$anchor.find(".loading_msg");_hide_results(typeahead_obj);typeahead_obj.$anchor.addClass("typeahead_loading");if($active.length>0&&!$active.hasClass("full_results_link")){var dest_url=$active.find("a").attr("href");if($active.find('a[data-type="company"]').length>0){if(typeahead_obj.$input.val().toLowerCase()==$active.find("a").data("ticker").toLowerCase()){dest_url+="/financial/"+$active.find("a").data("ticker")+"/";}}$loading_msg.html("Loading &#8220;"+forbes.util.html_escape($active.find("a span.label").text())+"&#8221;");forbes.event_tracking.track_ga_event(["SearchTypeahead","SelectedSuggestion",dest_url]);window.location=dest_url;}else{$loading_msg.html("Loading &#8220;"+forbes.util.html_escape(typeahead_obj.$input.val())+"&#8221;");typeahead_obj.$input.parents("form").submit();}}function _load_prefetch(typeahead_obj){var typeahead=typeahead_obj;$.ajax({type:"get",url:typeahead.url_prefetch,data:{},dataType:"json",timeout:10*1000,error:function(e,textStatus,errorThrown){debug("error loading: "+typeahead.url_prefetch);debug("error textStatus: "+textStatus);debug("error errorThrown: "+errorThrown);typeahead.use_prefetch=false;},success:function(data){_populate_datasource(data,typeahead);typeahead.prefetch_loaded=true;}});}function _load_term(term,typeahead_obj){var typeahead=typeahead_obj;_cache_save(term,typeahead);$.ajax({type:"get",url:typeahead.url_search,data:{term:term},dataType:"json",timeout:10*1000,error:function(e,textStatus,errorThrown){debug("error loading: "+typeahead.url_search);debug("error textStatus: "+textStatus);debug("error errorThrown: "+errorThrown);},success:function(data){if(typeof data!="object"){return false;}if(data.length<1){return false;}_populate_datasource(data,typeahead);}});}function _is_in_cache(term,typeahead_obj){if(typeahead_obj.query_cache.length<1){return false;}for(var i=typeahead_obj.query_cache.length-1;i>=0;i--){if(typeahead_obj.query_cache[i]==term){return true;}}return false;}function _cache_save(term,typeahead_obj){debug("_cache_save: "+term);typeahead_obj.query_cache.push(term);if(typeahead_obj.query_cache.length>_query_cache_limit){typeahead_obj.query_cache.shift();}}function _populate_datasource(data,typeahead_obj){for(var i=data.length-1;i>=0;i--){if(typeahead_obj.datasource.length>_datasource_size_limit){debug("_populate_datasource: went over limit of "+_datasource_size_limit);return false;}var found_existing_match_in_datasource=false;if(typeahead_obj.datasource.length>0){for(var n=typeahead_obj.datasource.length-1;n>=0;n--){if(data[i].label===typeahead_obj.datasource[n].label&&data[i].type===typeahead_obj.datasource[n].type&&data[i].naturalId===typeahead_obj.datasource[n].naturalId){found_existing_match_in_datasource=true;break;}}}if(!found_existing_match_in_datasource){typeahead_obj.datasource.push(data[i]);}}_on_datasource_updated(typeahead_obj);}function _on_datasource_updated(typeahead_obj){_lookup(typeahead_obj);}function _get_matches(term,typeahead_obj){if(typeahead_obj.datasource.length<1){return false;}var matches=$.grep(typeahead_obj.datasource,function(item,indexInArray){if(typeof item.label=="undefined"){return false;}if(item.label.toLowerCase().indexOf(term.toLowerCase())!=-1){return true;}if(item.advoiceBrand!="undefined"&&item.advoiceBrand!==null&&item.advoice!="null"){var voiceItem=item.label+"voice";if(voiceItem.toLowerCase().indexOf(term.toLowerCase())!=-1){return true;}}if(typeof item.ticker!="undefined"&&item.ticker!==null&&item.ticker!="null"){if(item.ticker.toLowerCase().indexOf(term.toLowerCase())!=-1){return true;}}return false;});return _sort_matches(term,matches);}function _sort_matches(term,matches){var new_matches=[];for(var i=0;i<matches.length;i++){var this_length=matches[i].label.length-term.length,number_of_shorter_matches=0;for(var n=0;n<matches.length;n++){var that_length=matches[n].label.length-term.length;if(that_length<this_length){number_of_shorter_matches++;}}while(typeof new_matches[number_of_shorter_matches]!="undefined"){number_of_shorter_matches++;}new_matches[number_of_shorter_matches]=matches[i];}return new_matches;}function _render_result_item_html(term,item){if(typeof item=="undefined"){debug("_render_result_item_html failure:");debug(item);return false;}var html="",desc_html="",highlighted_label=forbes.util.highlighter(term,item.label,"typeahead_highlight");html+='<li class="result">';html+='<a href="'+item.url+'" data-type="'+item.type+'" data-ticker="'+item.ticker+'">';html+='<span class="entity_img">';html+='<span class="img" style="background-image:url('+item.icon+')"></span>';html+='<span class="loading_spinner"><img src="'+imagesBaseCdn+'/assets/img/loading_spinners/16px_grey.gif" height="16" width="16" alt=""></span>';html+="</span>";if(item.type!="author"&&item.advoiceBrand!=null){label_html='<span class="label"><span class="typeahead_highlight"><span class="advoice"><span class="brandvoice">'+item.advoiceBrand+"</span>Voice</span></span></span>";}else{label_html='<span class="label">'+highlighted_label+"</span>";}html+=label_html;if(typeof item.desc!=="undefined"&&item.desc!==""&&item.desc!=="null"&&item.desc!==null){if(item.desc.toLowerCase()=="advoice"){if(item.type=="author"){if(item.advoiceBrand!=null){desc_html='<span class="desc advoice"><span class="brandvoice">'+item.advoiceBrand+"</span>Voice</span>";}else{if(item.advoiceBrand==null){desc_html='<span class="desc advoice"><span class="brandvoice"></span>BrandVoice</span>';}}}else{desc_html='<span class="desc">'+item.tagName+"</span>";}}else{desc_html='<span class="desc">'+item.desc+"</span>";}html+=desc_html;}html+="</a>";html+="</li>";return html;}function _render_fullresults_html(term){var html="";html+='<li class="full_results_link">';html+='<a href="'+_gen_search_link(term)+'" class="link">See all results<span class="collapsable"> for &#8220;<span class="term">'+forbes.util.html_escape(term)+"</span>&#8221;</span> Â»</span>";html+="</li>";return html;}function _gen_search_link(term){return"/search/?q="+encodeURIComponent(term);}return{init:_init,hide_all:_hide_all};}($));return app;}(forbes||{},jQuery));var forbes=(function(app,$){app.global_search_control=(function($){var $global_search,$search_input,$header_search_li,_initialized=false;function _init(){if($(".global_search_control").length<1){return false;}if(_initialized){return false;}$global_search=$(".global_search_control");$header_search_li=$global_search.parents("li.search");$search_input=$global_search.find("input.search_input");$search_input.bind("focus",_on_input_focus).bind("blur",_on_input_blur).bind("keypress",_on_keypress);$global_search.find("input.search_input").addClass("initialized");forbes.typeahead.init({"$input":$search_input,url_prefetch:"/typeahead/prefetchData",url_search:"/typeahead/search"});_initialized=true;}function _on_input_focus(){var $this=$(this);$header_search_li.addClass("focused");$global_search.addClass("focused");if($search_input.val()==""||$search_input.val()==" "){$global_search.removeClass("has_value");}}function _on_input_blur(){$header_search_li.removeClass("focused");$global_search.removeClass("focused");if($search_input.val()==""||$search_input.val()==" "){$global_search.removeClass("has_value");}}function _on_keypress(){setTimeout(function(){if($search_input.val()!=""){$global_search.addClass("has_value");}},20);}return{init:_init};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register_lazy_callback(forbes.global_search_control.init);var forbes=(function(app,$){app.galleries=(function(module,$){module.embedded=(function($){var debug=null,_speed=200,_engine=null,_behavior=null,_is_touch_device=false,_hover_manager={enter_delay:350,leave_delay:350,leave_time:0,enter_time:0,"$current_gallery":null},_gallery_width={default_size:620,mini:410,super_mini:325},_time_of_last_display_ad_update=null,_min_amount_of_display_ad_time=(1000*2),_time_of_last_interstitial_ad_update=null,_time_in_between_interstitial_ads=(1000*5);function _init(){debug=forbes.util.debug;if($("html").hasClass("touch")){_is_touch_device=true;}_engine=forbes.galleries.engine;_behavior=forbes.galleries.behavior_desktop;$.each($(".gallery_embedded_launcher"),function(key,launcher_link){_init_gallery($(launcher_link));});if(typeof forbes.article_pages!="undefined"){forbes.article_pages.process_embeddables();}}function _bind_gallery_events($gallery_embedded){var $drawer=$($gallery_embedded).find(".drawer"),$gallery=$gallery_embedded.find(".gallery"),$gallery_content=$gallery_embedded.find(".gallery_embedded_content");if(!$gallery_embedded.hasClass("mini")){$gallery_embedded.off("mouseenter").on("mouseenter",function(e){_gallery_mouseenter($(this));});$gallery_embedded.off("mouseleave").on("mouseleave",function(e){_gallery_mouseleave($(this));});}$gallery_embedded.find(".copy_box").on("mouseleave",function(e){$(this).removeClass("hover");});$(window).resize(function(){_on_window_resize();});if(_is_touch_device){return;}$gallery_embedded.find(".slides a").off("click:left").on("click:left",function(e){var this_url=forbes.util.get_forbes_link($(this).attr("href"));if(this_url.length>1){forbes.event_tracking.track_ga_event(["Gallery_Activity","Hover_Embed_Engaged",$('meta[property="og:url"]').attr("content")]);if(!forbes.state_manager.is_available()){return true;}return true;_engine.change_state({module_id:"galleries.engine",request_url:this_url});}e.preventDefault();return false;});$gallery_embedded.find(".main_link").off("click:left").on("click:left",function(e){var this_url=forbes.util.get_forbes_link($(this).attr("href"));forbes.event_tracking.track_ga_event(["Gallery_Activity","Hover_Embed_Engaged",$('meta[property="og:url"]').attr("content")]);if(!forbes.state_manager.is_available()){return true;}return true;_engine.change_state({module_id:"galleries.engine",request_url:this_url});e.preventDefault();return false;});$gallery_content.off("click:left").on("click:left",function(e){if($gallery_embedded.hasClass("mini")){var this_url=forbes.util.get_forbes_link($gallery_embedded.find("a.main_link").attr("href"));forbes.event_tracking.track_ga_event(["Gallery_Activity","Hover_Embed_Engaged",$('meta[property="og:url"]').attr("content")]);if(!forbes.state_manager.is_available()){return true;}return true;_engine.change_state({module_id:"galleries.engine",request_url:this_url});return false;}});}function _on_window_resize(){$(".gallery_embedded").each(function(){_reposition_gallery_index({"$gallery":$(this)});});_update();}function _gallery_mouseenter($gallery_embedded){var time_object=new Date(),time_since_mouseleave,$drawer=$gallery_embedded.find(".drawer"),last_url=(_hover_manager.$current_gallery)?_hover_manager.$current_gallery.attr("data-url"):null,this_url=$gallery_embedded.attr("data-url");if($gallery_embedded.hasClass("mini")||$gallery_embedded.hasClass("super_mini")){return false;}_hover_manager.enter_time=time_object.getTime();clearInterval($gallery_embedded.data("enter_timeout"));clearInterval($gallery_embedded.data("leave_timeout"));$gallery_embedded.data("hovering",true);if(last_url&&last_url===this_url&&$gallery_embedded.hasClass("opened")){return false;}time_since_mouseleave=_hover_manager.enter_time-_hover_manager.leave_time;_hover_manager.$current_gallery=$gallery_embedded;if(time_since_mouseleave>=_hover_manager.leave_delay){}else{if(time_since_mouseleave<_hover_manager.leave_delay){}}}function _gallery_mouseleave($gallery_embedded){_reset_hover_variables($gallery_embedded);if($gallery_embedded.hasClass("mini")||$gallery_embedded.hasClass("super_mini")){return false;}var d=new Date();_hover_manager.leave_time=d.getTime();}function _open_drawer(){var $gallery_embedded=$(this),$drawer=$gallery_embedded.find(".drawer"),$drawer_content=$gallery_embedded.find(".drawer .content"),gallery_original_width=$gallery_embedded.parent().width(),drawer_width=$drawer_content.width(),drawer_height=$gallery_embedded.height(),z_index=11,last_url=(_hover_manager.$current_gallery)?_hover_manager.$current_gallery.attr("data-url"):null,this_url=$gallery_embedded.attr("data-url"),gallery_max_width=gallery_original_width+drawer_width;if(last_url&&(last_url===this_url)&&$gallery_embedded.data("hovering")){$gallery_embedded.addClass("opened");$drawer_content.height(drawer_height);if($gallery_embedded.width()===gallery_max_width){return false;}$gallery_embedded.css({top:0,zIndex:z_index}).animate({width:gallery_max_width},{duration:_speed*0.7,easing:"easeInOutQuad",complete:function(){$drawer.show();$drawer_content.show();_behavior.update_display_ads({"$target":$gallery_embedded,adslot_flag:"drawer_ad"});forbes.event_tracking.track_ga_event(["Gallery_Activity","Hover_Embed",$('meta[property="og:url"]').attr("content")]);}});}}function _close_drawer(options){var $gallery_embedded=$(this),$drawer=$gallery_embedded.find(".drawer"),target_width=0,transition_speed=_speed*0.7;$drawer.find(".content").hide();if(options&&options.animate&&options.animate===false){transition_speed=0;}$gallery_embedded.removeClass("opened");_reset_hover_variables($gallery_embedded);if($gallery_embedded.hasClass("mini")){target_width=_gallery_width.mini;}else{if($gallery_embedded.hasClass("super_mini")){target_width=_gallery_width.super_mini;}else{target_width=_gallery_width.default_size;}}$drawer.fadeOut(0,function(){$gallery_embedded.stop().animate({width:target_width},{duration:transition_speed,easing:"easeInOutQuad",complete:function(){_update();}});});}function _reset_hover_variables($gallery_embedded){_hover_manager.$current_gallery=null;$gallery_embedded.data("hovering",false);}function _reset_drawer(){$(".gallery_embedded .drawer").hide();}function _init_gallery($launcher_link){debug("_init_gallery()");var $launcher_container=$launcher_link.closest(".forbes_embedded_gallery"),$gallery=_create_container($launcher_container);$launcher_link.addClass("initialized");_set_gallery_size($launcher_link,$gallery);_load_gallery.call($gallery);}function _set_gallery_size($launcher_link,$gallery_embedded){var $parent_container=$gallery_embedded.parent(),$launcher_container=$launcher_link.closest(".forbes_embedded_gallery"),parent_container_width=$parent_container.width(),launcher_link_width=0,available_width=0,$sticky_sharing=$parent_container.find("#sticky_sharing"),has_sticky_sharing=($sticky_sharing.length>0)?true:false,clears_sticky_sharing=true,current_gallery_mode="",new_gallery_mode="";if($gallery_embedded.hasClass("super_mini")){current_gallery_mode="super_mini";}else{if($gallery_embedded.hasClass("mini")){current_gallery_mode="mini";}else{current_gallery_mode="default_size";}}$gallery_embedded.removeClass("opened");$launcher_container.css("display","block");$launcher_link.css("display","inline");if(has_sticky_sharing===true){if($launcher_container.position().top<=$sticky_sharing.height()){clears_sticky_sharing=false;}}launcher_link_width=parent_container_width-$launcher_link.position().left,available_width=launcher_link_width-5;$gallery_embedded.removeClass("super_mini");$gallery_embedded.removeClass("mini");$gallery_embedded.removeClass("default_size");if(($launcher_link.position().left===0)&&(has_sticky_sharing===false)){available_width=_gallery_width.default_size;new_gallery_mode="default_size";}else{if(($launcher_link.position().left>0)&&(has_sticky_sharing===true)){available_width=_gallery_width.super_mini;new_gallery_mode="super_mini";_reset_drawer();}else{if(($launcher_link.position().left>0)&&(has_sticky_sharing===false)){available_width=_gallery_width.mini;new_gallery_mode="mini";_reset_drawer();}else{if(($launcher_link.position().left===0)&&(has_sticky_sharing===true)){available_width=_gallery_width.mini;new_gallery_mode="mini";_reset_drawer();}}}}$gallery_embedded.addClass(new_gallery_mode);if($gallery_embedded.hasClass("mini")||$gallery_embedded.hasClass("super_mini")){if($gallery_embedded.find(".drawer").css("display")=="block"){_close_drawer.call($gallery_embedded,{animate:false});}}$launcher_container.css("display","none");$launcher_link.css("display","none");if($gallery_embedded.width()==available_width){return false;}if($("body").hasClass("infinite")&&forbes.infinite_ads){debug("GALLERY INFINITE - EDGE CASE?");}}function _load_gallery(){var $gallery=$(this),this_url=forbes.util.get_forbes_link($gallery.attr("data-url"));var data=_engine.get_slide_data({url:this_url,after_ajax_load:function(data){_engine.save_cache_data(this_url,data);_load_gallery.call($gallery);}});if(typeof data.loading!="undefined"&&data.loading){return false;}_on_loaded.call($gallery,data.data,this_url);}function _create_container($launcher_container){var html="",$gallery=null,gallery_url=$launcher_container.find("a").attr("href");html+='<div class="gallery_embedded" data-url>';html+='	<div class="gallery_embedded_border"></div>';html+='	<div class="gallery_embedded_content">';html+='		<div class="content gallery">';html+="		</div>";html+='		<div class="loading_state">';html+='			<div class="spinner">';html+="			</div>";html+="		</div>";html+="	</div>";html+='	<div class="drawer">';html+='		<div class="content">';html+="		</div>";html+="	</div>";html+="</div>";$launcher_container.after(html);$gallery=$launcher_container.next();$gallery.attr("data-url",gallery_url);if($launcher_container.index()===0){$gallery.addClass("first_element");}return $gallery;}function _on_loaded(data,gallery_url){var $gallery_embedded=$(this),$gallery=$gallery_embedded.find(".gallery"),$loading_state=$gallery_embedded.find(".loading_state"),gallery_title="",gallery_image_box="",gallery_index="",gallery_copy_box="",gallery_sharing="",gallery_html="",drawer_html="",next_gallery_url="",brandIndex="",bvBrand="",bvVoice="",bvTitle="";$loading_state.hide();var title_text=forbes.util.parse_ajax_content(data,"title_box");title_text=$(title_text).find("a").text();brandIndex=title_text.search("Voice:");if(brandIndex===-1){bvTitle=title_text;}else{bvBrand=title_text.substring(0,brandIndex);bvVoice=title_text.substring(brandIndex,brandIndex+6);bvTitle=title_text.substring(brandIndex+6,title_text.length);}gallery_title="<h1>"+bvBrand+'<span class="advoice">'+bvVoice+"</span>"+bvTitle+"</h1>";gallery_image_box+=forbes.util.parse_ajax_content(data,"image_box");gallery_index+=forbes.util.parse_ajax_content(data,"gallery_index");gallery_copy_box+='<div class="copy_box_outer">';gallery_copy_box+=forbes.util.parse_ajax_content(data,"copy_box");gallery_copy_box+="</div>";gallery_html=gallery_title+gallery_image_box+gallery_copy_box;if(!$gallery_embedded.hasClass("mini")){gallery_html+=gallery_sharing;}gallery_html+=gallery_index;drawer_html=forbes.util.parse_ajax_content(data,"right_rail");$gallery.empty();$gallery.append(gallery_html);$gallery.find(".copy_box").wrapInner('<div class="copy_box_inner"/>');$gallery.find(".permalink a").attr("href","http://onforb.es/OvFUUV");$gallery.find(".permalink a .url").text("http://onforb.es/OvFUUV");$gallery.find(".copy_box").append('<div class="gradient"></div>');$gallery.find(".copy_box_inner").wrapInner('<div class="copy_box_content"></div>');if(!$gallery_embedded.hasClass("mini")){forbes.copy_box.init_copy_box($gallery);}$gallery_embedded.find(".drawer .content").html(drawer_html);next_gallery_url=forbes.util.get_forbes_link($(gallery_index).find(".slides li:nth-child(2) a").attr("href"));_init_gallery_index($gallery_embedded,next_gallery_url);if($gallery.find(".credit").html().length<2){$gallery.find(".credit").hide();}else{$gallery.find(".credit").show();}_add_main_image_link($gallery_embedded,gallery_url);_init_prev_next_links($gallery_embedded);_bind_gallery_events($gallery_embedded);_update_prev_next_buttons($gallery_embedded);_on_window_resize();}function _add_main_image_link($gallery_embedded,gallery_url){$gallery_embedded.find(".image_box img.main").wrap('<a class="main_link">');$gallery_embedded.find(".image_box a.main_link").attr("href",gallery_url);}function _init_gallery_mini_index(gallery_url,next_gallery_url){var url_index=[];url_index.push(gallery_url,next_gallery_url);_engine.set_index(url_index,gallery_url);}function _init_gallery_index($gallery_embedded,next_gallery_url){var $gallery=$gallery_embedded.find(".gallery"),$gallery_index=$gallery.find(".gallery_index"),max_thumb_count=8,button_widths=102,thumb_width=59;max_thumb_count=Math.floor(($gallery_embedded.width()-button_widths)/thumb_width);$gallery_index.find("ul.slides li").each(function(i){if(i>max_thumb_count){$(this).remove();}});var url_index=[],init_url="";$gallery_index.find("ul.slides li a").each(function(){var $this=$(this),this_href=forbes.util.get_forbes_link($this.attr("href"));url_index.push(this_href);if($this.parent().hasClass("active")){init_url=this_href;}});_engine.set_index(url_index,init_url);_engine.init_img_preloading();_engine.prefetch_upcoming_slide_data();$gallery_index.find("ul.slides a").each(function(){$(this).off("click:left").on("click:left",function(e){var $this=$(this);forbes.event_tracking.track_ga_event(["Gallery_Activity","Hover_Embed_Engaged",$('meta[property="og:url"]').attr("content")]);if(!forbes.state_manager.is_available()){return true;}return true;_engine.change_state({module_id:"galleries.engine",request_url:forbes.util.get_forbes_link($this.attr("href"))});e.preventDefault();return false;});});$gallery_index.find("ul.slides li img").each(function(i){var $this=$(this);if(!$this.hasClass("initialized")){$this.attr("src",$this.data("img-src"));$this.css("opacity",1);$this.addClass("initialized");}});if(!$gallery_index.hasClass("initialized")){$gallery_index.css("opacity",1).height(parseInt($gallery_index.data("target-height"),10));$gallery_index.addClass("initialized");}}function _init_prev_next_links($gallery_embedded){var $gallery_index=$gallery_embedded.find(".gallery_index"),$image_box=$gallery_embedded.find(".image_box");$image_box.find(".prev_next a").add($gallery_index.find("span.prev_next a")).each(function(){$(this).off("click:left").on("click:left",function(e){if(_is_touch_device){return;}var $this=$(this),this_href=$this.attr("href");if($this.parent().hasClass("disabled")){return false;}if(!forbes.state_manager.is_available()){return true;}return true;forbes.event_tracking.track_ga_event(["Gallery_Activity","Hover_Embed_Engaged",$('meta[property="og:url"]').attr("content")]);if($this.parent().hasClass("next")){_engine.change_state({module_id:"galleries.engine",request_url:forbes.util.get_forbes_link($this.attr("href"))});}else{_engine.goto_prev_slide();}e.preventDefault();return false;});});if(_is_touch_device){$image_box.swipe({swipeLeft:_engine.goto_next_slide,swipeRight:_engine.goto_prev_slide});}}function _update_prev_next_buttons($gallery_embedded){var next_url=_engine.get_next_url(),prev_url=_engine.get_prev_url(),$image_box=$gallery_embedded.find(".image_box"),$gallery_index=$gallery_embedded.find(".gallery_index"),$gallery_index_prev=$gallery_index.find("span.prev"),$gallery_index_next=$gallery_index.find("span.next"),$image_prev=$image_box.find(".prev_next.prev"),$image_next=$image_box.find(".prev_next.next"),auto_advance=$gallery_index.data("auto-advance-to-next-gallery");if($gallery_embedded.hasClass("mini")){auto_advance=true;}$gallery_index_prev.removeClass("disabled active");$gallery_index_next.removeClass("disabled active");$image_prev.removeClass("disabled active");$image_next.removeClass("disabled active");if(prev_url===false){$gallery_index_prev.addClass("disabled");$image_prev.addClass("disabled");prev_url="#";}else{$gallery_index_prev.addClass("active");$image_prev.addClass("active");}if(next_url===false){$gallery_index_next.addClass("disabled");if(!auto_advance){$image_next.addClass("disabled");}else{$image_next.addClass("active");}next_url="#";}else{$gallery_index_next.addClass("active");$image_next.addClass("active");}$gallery_index_next.find("a").attr("href",next_url);$gallery_index_prev.find("a").attr("href",prev_url);}function _reposition_gallery_index(options){var $gallery=options.$gallery;if($gallery.hasClass("mini")||$gallery.hasClass("super_mini")){return false;}var index_width=0,$gallery_index=$gallery.find(".gallery_index"),available_width=Math.round($gallery_index.width()),$container=$gallery_index.find(".container"),$active=$gallery_index.find("ul.slides li.active"),skip_animation=(typeof options!="undefined"&&typeof options.skip_animation!="undefined")?true:false;$gallery_index.find("ul.slides li").each(function(){index_width+=$(this).width();if($(this).index()<($gallery_index.find("ul.slides li").length-1)){index_width+=parseInt($(this).css("margin-right"),10);}});index_width+=$gallery_index.find("span.prev").width()+$gallery_index.find("span.next").width();if(index_width<available_width){$container.width(index_width);}else{$container.width(available_width);}var $slides=$gallery_index.find("ul.slides");$slides.find("li").last().css("margin-right",0);var viewport_width=$gallery_index.find(".ul_holder .column").width(),total_width=$slides.width(),active_width=$active.width(),active_left_x=$active.position().left,active_middle_x=(active_width/2)+active_left_x,diff_x=(viewport_width/2)-active_middle_x,start_x=0,end_x=(total_width-viewport_width)*-1;if(diff_x>start_x){diff_x=start_x;}if(diff_x<end_x){diff_x=end_x;}if(!_is_touch_device&&!skip_animation){$slides.stop().animate({left:diff_x},{duration:400,easing:"easeOutCubic"});}else{$slides.stop().css("left",diff_x);}}function _update(){$.each($(".gallery_embedded"),function(key,gallery){if($("body").hasClass("body_article")==true){$(gallery).prev().css("display","block");var $launcher_container=$(gallery).prev();}else{var $launcher_container=$(gallery).prevUntil(".forbes_embedded_gallery").prev();}var $launcher_link=$launcher_container.find(".gallery_embedded_launcher"),$gallery_embedded=$(gallery);if($gallery_embedded.hasClass("bypass_default_resize")){return;}_set_gallery_size($launcher_link,$gallery_embedded);});if($("body").hasClass("body_article")==true){_update_floated();}}function _update_floated(){$.each($(".gallery_embedded"),function(key,gallery){var $launcher_container=$(gallery).prev(),$launcher_link=$launcher_container.find(".gallery_embedded_launcher"),$adjacent_recad=$("#rec"),$adjacent_logead=$("#loge"),$adjacent_medianetad=$("#218291818"),adjacent_recad_height=$adjacent_recad.height(),adjacent_logead_top=($adjacent_logead.length>0)?$adjacent_logead.position().top:0,adjacent_logead_range=adjacent_logead_top+$adjacent_medianetad.height(),adjacent_medianetad_top=($adjacent_medianetad.length>0)?$adjacent_medianetad.position().top:0,adjacent_medianetad_range=adjacent_medianetad_top+$adjacent_medianetad.height(),launcher_link_top=$launcher_link.position().top;if($adjacent_recad.length<1||$adjacent_logead.length<1||$adjacent_medianetad.length<1){return true;}debug("adjacent_recad_height: "+adjacent_recad_height);debug("adjacent_logead_height: "+adjacent_logead_range);debug("adjacent_medianetad_height: "+adjacent_medianetad_range);debug("launcher_link_top : "+launcher_link_top);if(launcher_link_top<=adjacent_recad_height||launcher_link_top<=adjacent_logead_range||launcher_link_top<=adjacent_medianetad_range){$(gallery).addClass("mini small").removeClass("default_size");}forbes.copy_box.update_copy_box($(gallery));});}return{init:_init,update:_update,update_floated:_update_floated,init_gallery:_init_gallery};})($);return module;}(app.galleries||{},$));return app;}(forbes||{},jQuery));var forbes=(function(app,$){app.galleries=(function(module,$){module.behavior_desktop=(function($){var _engine=null,debug=null,_using_overlay_share_controls=true,_view_mode=null,_is_touch_device=false,_time_of_last_display_ad_update=null,_min_amount_of_display_ad_time=(1000*1),_time_of_last_interstitial_ad_update=null,_time_in_between_interstitial_ads=(1000*9),_min_amount_of_slide_turns_before_first_interstitial_fires=5,_number_of_slide_turns_since_last_interstitial=0,_min_number_of_slide_turns_between_interstitials=2,_count_for_intx=0;_interstitial_is_engaged=false,_display_ads_revealed_once_before_interstitial=false,_timeout_ad_resizing=null,_timeout_gigya_refresh=null,_lazy_loaded_ad_interval=null;_updated_tracking_iframe_once=false,$gallery=null,$inline_sharing_fallback=null,$gallery_index=null,$gallery_index_prev=null,$gallery_index_next=null,$loading_state=null,$image_box=null,$gigya_settings_container=null,$copy_box=null,$title_box=null;function _init(){debug=forbes.util.debug;if($("body").hasClass("body_search")){}_engine=forbes.galleries.engine;if($("body.galleries").length>0){_view_mode="standalone";$gallery=$("body.galleries");_standalone_gallery_brandvoice_treatment();_init_gallery();}else{_view_mode="overlay";}if($("html").hasClass("touch")){_is_touch_device=true;}forbes.galleries.preview.init();forbes.galleries.embedded.init();forbes.state_manager.init({init_module:"galleries.engine"});_init_gallery_launchers();}function _init_overlay_gallery(){$gallery=$("#forbes_modal_window");_time_of_last_display_ad_update=0;_time_of_last_interstitial_ad_update=0;_display_ads_revealed_once_before_interstitial=false;_init_gallery();}function _init_gallery_launchers(){var $launcher_links=null;if($("body").hasClass("enable_overlay_galleries")){$launcher_links=$(".body_contrib_pages li.stream_item a");if($launcher_links.length<1){return false;}$launcher_links.each(function(){var $this=$(this);if($this.attr("href").indexOf("/pictures/")!=-1){$this.off("click:left").on("click:left",function(e){if(!forbes.state_manager.is_available()){return true;}return true;_engine.reset_history_variable();_engine.change_state({module_id:"galleries.engine",request_url:forbes.util.get_forbes_link($(this).attr("href"))});return false;});}});}}function _standalone_gallery_brandvoice_treatment(){var ans="",brandIndex="",bvBrand="",bvVoice="",bvTitle="";var galleryTitle=$gallery.find("li.tab.title h1 a").text();if(galleryTitle.search("Voice:")!=-1){ans=$gallery.find("li.tab.title h1 a").html();brandIndex=ans.search("Voice:");bvBrand=ans.substring(0,brandIndex);bvVoice=ans.substring(brandIndex,brandIndex+6);bvTitle=ans.substring(brandIndex+6,ans.length);gallery_html_bv='<span class="advoice"><span class="brandvoice"> '+bvBrand+"</span>&#8203;"+bvVoice+"</span>"+bvTitle;$gallery.find("li.tab.title h1 a").html(gallery_html_bv);}}function _init_gallery(options){debug("_init_gallery");if(typeof options=="undefined"){options={};}$inline_sharing_fallback=$gallery.find(".inline_sharing_fallback");forbes.util.init_lazy_load_image_sources({"$target":$gallery});_init_ui(options);_engine.init_img_preloading();_engine.prefetch_upcoming_slide_data();_reposition_gallery_index(options);_update_prev_next_buttons();$(window).off("resize.galleries").on("resize.galleries",_on_window_resize);}function _init_ui(options){var suppress_sharing_reload=(options&&options.suppress_sharing_reload)?options.suppress_sharing_reload:false;$image_box=$gallery.find(".image_box");$title_box=$gallery.find("li.tab.title");$copy_box=$gallery.find(".copy_box");$loading_state=$image_box.find(".loading_state");$gigya_settings_container=$gallery.find(".gigya_settings_container");if($gigya_settings_container.html().length<10){$gigya_settings_container.html(forbes.util.parse_ajax_content($gallery.html(),"gigya_settings"));}if(typeof options=="undefined"){options={};}if(_view_mode=="overlay"){_init_overlay_ui();}if(suppress_sharing_reload===false){_update_share_controls();}_init_gallery_index(options);_init_prev_next_links();_init_key_bindings();var title=(typeof options!="undefined"&&typeof options.title!="undefined")?options.title:false;_update_page_title({title:title});_engine.set_cur_gallery($gallery_index.data("gallery-id"));if($gallery.find(".credit").html().length<2){$gallery.find(".credit").hide();}else{$gallery.find(".credit").show();}_update_ads({num_history_pushes:options.num_history_pushes});if(_view_mode=="overlay"){var update_image=_update_image_size();_update_tab_nav();}}function _init_overlay_ui(){if(_view_mode!="overlay"){return false;}$gallery_index=$gallery.find(".gallery_index");if(!$inline_sharing_fallback.hasClass("repositioned_for_overlay")){$inline_sharing_fallback.detach().insertAfter($gallery.find(".copy_and_adsense_row")).addClass("repositioned_for_overlay");}if(!_using_overlay_share_controls){$inline_sharing_fallback.hide();}$gallery_index.show();$gallery_index.detach().insertAfter($gallery.find(".inline_sharing_fallback"));$gallery.find(".tab_nav .tab.mostpopular a").css("cursor","pointer");$gallery.find(".tab_nav .tab a").off("click").on("click",function(){var $this=$(this),$parent=$this.parents(".tab"),$all_tabs=$this.parents(".tab_nav").find(".tab");if($parent.hasClass("active")){return false;}$all_tabs.removeClass("active");$all_tabs.find("a").css("cursor","pointer");$parent.find("a").css("cursor","default");$parent.addClass("active");if($parent.hasClass("mostpopular")){_reveal_most_popular($this);}else{_hide_most_popular($this);}return false;});_init_copy_box();}function _init_copy_box(){$copy_box.append('<div class="gradient"></div>');$copy_box.wrapInner('<div class="copy_box_content"></div>');forbes.copy_box.init_copy_box($gallery);}function _reveal_most_popular($this){if(_view_mode!="overlay"){return false;}var $popular_box=$gallery.find(".popular_box");if($popular_box.length<1){var popular_box_html="";popular_box_html+='<div class="popular_box">';popular_box_html+="<ul>";popular_box_html+=$gallery.find("aside.most_popular_galleries ul").html();popular_box_html+="</ul>";popular_box_html+="</div>";$(popular_box_html).insertAfter($gallery.find("ul.tab_nav"));$popular_box=$gallery.find(".popular_box");$popular_box.find("li a").each(function(){$(this).attr("href",forbes.util.get_forbes_link($(this).attr("href")));$(this).on("click:left",function(){});});}$popular_box.stop().show(0,function(){_reposition_popular_box({animate:true});}).css({opacity:1});$popular_box.addClass("active");}function _hide_most_popular($this){if(_view_mode!="overlay"){return false;}var $popular_box=$gallery.find(".popular_box");if($popular_box.length<1&&!$popular_box.hasClass("active")){return false;}$popular_box.stop().animate({opacity:0},{duration:300,easing:"easeOutCubic",complete:function(){$(this).removeClass("active").hide();}});}function _reposition_popular_box(options){var $popular_box=$gallery.find(".popular_box");if($popular_box.length<1&&$popular_box.hasClass("active")){return false;}var new_top=$image_box.position().top,new_left=0,new_width=$image_box.outerWidth(),tabs_height=$gallery.find(".tab_nav").height(),gallery_position_top=$gallery.find(".main_container").position().top,modal_inner_height=$gallery.closest(".window_contents").height(),new_height=(((modal_inner_height-gallery_position_top)-tabs_height)-10)-20;$popular_box.css({width:new_width+"px",height:new_height+"px",top:new_top+"px",left:new_left+"px"});var left_margin=parseInt($popular_box.find("li").eq(2).css("margin-left"),10);$popular_box.find("li").eq(3).addClass("new_row");$popular_box.find("li").stop().css({width:Math.floor(((((new_width-40))-(left_margin*2))/3))+"px",opacity:0});var max_box_aspect_ratio=(1185/700),box_aspect_ratio=(new_width/new_height);if((($popular_box.find("ul").height()+20)>new_height)&&(box_aspect_ratio>max_box_aspect_ratio)){var li_height=Math.floor((new_height-40)/2)+"px",li_width=Math.floor(((((new_width-40))-(left_margin*2))/3))+"px";$popular_box.find("li").css("height",li_height);$popular_box.find("li").css("width",li_width);$popular_box.find("img").css("height","70%");$popular_box.find("img").css("width","auto");}else{$popular_box.find("li").css("height","auto");$popular_box.find("img").css("height","auto");$popular_box.find("img").css("width","100%");}$.each($popular_box.find("a span"),function(){$(this).width($(this).prev("img").width());});if(typeof options!="undefined"&&typeof options.animate!="undefined"&&!options.animate){$popular_box.find("li").css("opacity",1);}else{$popular_box.find("li").each(function(i){var $this=$(this);$this.stop().delay(i*50).animate({opacity:1},{duration:200,easing:"easeInOutCubic"});});}}function _update_page_title(options){if(typeof options=="undefined"||typeof options.title=="undefined"){return false;}var new_page_title=options.title;if(new_page_title.length>0){document.title=new_page_title;}}function _on_window_resize(){_reposition_gallery_index();if(_view_mode=="overlay"){var update_image=_update_image_size();if($("#forbes_modal_window .copy_box.expandable.expanded").length>0){var $copy_box=$("#forbes_modal_window .copy_box");forbes.copy_box.collapse_copy_box($copy_box);}forbes.copy_box.update_copy_box($gallery);_update_tab_nav();_reposition_popular_box({animate:false});if(forbes.copy_box){forbes.copy_box.check_copy_box($gallery);}}}function _detect_modal_height(){if(_view_mode!="overlay"){return false;}if(!forbes.modal_window.is_active()){return false;}var minimum_mode_threshold=787;minimum_mode_threshold+=104;if($(window).height()<=minimum_mode_threshold){$("#forbes_modal_window").addClass("minimum_mode");}else{$("#forbes_modal_window").removeClass("minimum_mode");}}function _update_share_controls(){if(_view_mode=="overlay"&&!_using_overlay_share_controls){return false;}clearTimeout(_timeout_gigya_refresh);_timeout_gigya_refresh=setTimeout(function(){$gallery.find(".inline_sharing_fallback").css("opacity",1).show();forbes.gigya_share.init({target:$gigya_settings_container});},10);}function _update_tab_nav(){var tab_margin=10,max_width=$("#forbes_modal_window .image_box").width(),other_tab_widths=tab_margin,adjusted_title_width=0,all_widths=tab_margin,$title_tab=$("#forbes_modal_window .tab_nav li.tab.title");$.each($("#forbes_modal_window .tab_nav li"),function(key,value){$(this).css({overflow:"visible",width:"auto"});if(!$(value).hasClass("title")){other_tab_widths+=$(value).width();}all_widths+=$(value).width();});adjusted_title_width=max_width-(other_tab_widths-tab_margin);if(all_widths>max_width){$title_tab.css({overflow:"hidden",width:adjusted_title_width}).addClass("truncated");if($title_tab.find(".gradient").length<1){$title_tab.append('<div class="gradient"/>');}}else{$title_tab.removeClass("truncated");}}function _update_image_size(){var leaderboard_height=108,other_heights=362,social_sharing_height=33,min_virtual_window_height=720,window_height=$(window).height(),available_image_height=0;if(window_height>min_virtual_window_height){available_image_height=(window_height-other_heights);}else{available_image_height=(min_virtual_window_height-other_heights);}if($("#forbes_modal_window #leaderboard2").css("display")=="block"){available_image_height-=leaderboard_height;}if($("#forbes_modal_window .image_box img.main").length>0){var max_aspect_ratio=0.6667,max_width,max_height,window_aspect_ratio=$(window).height()/$(window).width();if(window_aspect_ratio>0.75){max_width=$("#forbes_modal_window .image_box").width();max_height=Math.round(max_width*max_aspect_ratio);$("#forbes_modal_window .image_box").css({height:max_height});}else{max_width=$("#forbes_modal_window .image_box").width();max_height=available_image_height;$("#forbes_modal_window .image_box").css({height:available_image_height});}$("#forbes_modal_window .image_box img.main").css({maxHeight:max_height,minHeight:0,maxWidth:max_width});}return"success";}function _update_ads(options){if(_check_if_interstitial_should_engage(options)){_trigger_interstitial_ad();return true;}_number_of_slide_turns_since_last_interstitial++;_update_adwords();if(_check_if_ads_were_visible_long_enough()){_update_display_ads();}}function _check_if_interstitial_should_engage(options){debug("*** _update_display_ads & flag from int is "+forbes.interstitial_ad.is_enabled());debug("forbes.page_meta.brandvoice "+forbes.page_meta.brandvoice);if(!forbes.interstitial_ad.is_enabled()){debug("*** no interstitial for brandvoice gallery ");return;}var now=new Date(),elapsed=now.getTime()-_time_of_last_interstitial_ad_update,override;if(!_display_ads_revealed_once_before_interstitial){return false;}if(options.num_history_pushes<=_min_amount_of_slide_turns_before_first_interstitial_fires){return false;}if(options.num_history_pushes<=_min_amount_of_slide_turns_before_first_interstitial_fires){return false;}if(_number_of_slide_turns_since_last_interstitial<_min_number_of_slide_turns_between_interstitials){return false;}if(_time_of_last_interstitial_ad_update===null){_time_of_last_interstitial_ad_update=now.getTime();}if(typeof forbesSecondsBetweenIntTriggerOverrideGallery!="undefined"){override=parseInt(forbesSecondsBetweenIntTriggerOverrideGallery,10);if(override==-1){return false;}if(override===0){_number_of_slide_turns_since_last_interstitial=0;return true;}if(override>0){override=override*1000;_time_in_between_interstitial_ads=override;}}else{return false;}if(elapsed>_time_in_between_interstitial_ads){_number_of_slide_turns_since_last_interstitial=0;return true;}return false;}function _trigger_interstitial_ad(){var now=new Date();_time_of_last_interstitial_ad_update=now.getTime();_time_of_last_display_ad_update=0;$gallery.find(".dynamic_adslot").html("").hide();$("#sticky_sharing").hide();_interstitial_is_engaged=true;_display_ads_revealed_once_before_interstitial=false;var interstitial_context=".content.gallery .main_container";if(_view_mode=="overlay"){interstitial_context="#forbes_modal_window .window_contents";forbes.modal_window.hide_close_btn();}if(typeof forbes.interstitial_ad!="undefined"){forbes.interstitial_ad.trigger({context:interstitial_context,in_modal:((_view_mode=="overlay")?true:false),events:{advance:function(){var now=new Date(),time=now.getTime();_interstitial_is_engaged=false;_display_ads_revealed_once_before_interstitial=false;_time_of_last_interstitial_ad_update=time;forbes.modal_window.show_close_btn();_update_ads({});if(forbes.sharing_controls){$("#sticky_sharing").show();forbes.sharing_controls.update();}_on_window_resize();}}});}}function _check_if_ads_were_visible_long_enough(){var now=new Date(),elapsed=now.getTime()-_time_of_last_display_ad_update;if(elapsed>_min_amount_of_display_ad_time){return true;}return false;}function _update_display_ads(options){var $target=$gallery,adslot_flag=_view_mode,now=new Date();_time_of_last_display_ad_update=now.getTime(),lazy_ads=[];_detect_modal_height();if(typeof options!="undefined"&&typeof options.$target!="undefined"&&options.$target.length>0){$target=options.$target;}if(typeof options!="undefined"&&typeof options.adslot_flag!="undefined"&&options.adslot_flag.length>0){adslot_flag=options.adslot_flag;}if($target.length<1){return false;}_display_ads_revealed_once_before_interstitial=true;var previous_url=_engine.get_url_status().prev;if(previous_url!==null){var cur_url=_engine.get_url_status().cur,referral_url=(previous_url!==null)?previous_url:document.referrer,tracking_iframe_url=(cur_url!==null)?cur_url:window.location.href,tracking_html="";var a=document.createElement("a");a.href=referral_url;referral_url=a.href;tracking_iframe_url+=(cur_url.indexOf("?")==-1)?"?":"&";tracking_iframe_url+="referrerUrl="+encodeURIComponent(referral_url);if(!_updated_tracking_iframe_once){tracking_iframe_url+="&firstLoad=true";}tracking_html='<iframe src="'+tracking_iframe_url+'" scrolling="no" marginheight="0" marginwidth="0"></iframe>';$("#hidden_tracking_iframe").show().css({width:0,height:0,overflow:"hidden"}).html(tracking_html);_updated_tracking_iframe_once=true;}}function _resize_ad(options){if(typeof options.selector!="undefined"){if($(options.selector).length>0){var $target=$(options.selector).find("iframe");if($target.length>0&&typeof options.width!="undefined"&&typeof options.height!="undefined"){if($target.parent().hasClass("above_header")){var $parent=$target.parent(),parent_height=$parent.height(),height_difference=(parent_height-options.height),scroll_start=$(document).scrollTop(),scroll_end=$(document).scrollTop()-height_difference,resize_delay=0;if(options.height<parent_height){resize_delay=750;}clearTimeout(_timeout_ad_resizing);_timeout_ad_resizing=setTimeout(function(){if(options.height>10){$parent.stop().animate({height:options.height},{duration:10,easing:"linear",step:function(now,fx){var ratio=Math.abs((fx.now-fx.start)/(fx.end-fx.start)),new_top=scroll_start+((scroll_end-scroll_start)*ratio);},complete:function(){$parent.addClass("initialized_height");}});}},resize_delay);}if(options.height<10&&$target.parent().data("slot-type")=="logo"){$target.parent().hide();}else{$target.parent().show();}$target.width(options.width).height(options.height);}}}}function _update_adwords(){if(_view_mode=="standalone"){var adsense_pos_id="adsense_pos",adsense_width=Math.floor($gallery.find(".copy_and_adsense_row").width()-$gallery.find(".adsense_box").width()),query_text=$gallery.find("h2").text();if(query_text.length<1){return false;}if($("#"+adsense_pos_id).length<1){return false;}var pageOptions={pubId:"pub-5683427718992637",query:$gallery.find("h2").text(),hl:"en"};var adblock1={container:adsense_pos_id,width:adsense_width,lines:"3",minTop:1,maxTop:1,fontFamily:"Verdana,Arial",fontSizeTitle:"13px",fontSizeDescription:"11px",fontSizeDomainLink:"11px",colorTitleLink:"#ffffff",colorDomainLink:"#cccccc",colorText:"#cccccc",colorBackground:"#383838",colorBorder:"#383838"};new google.ads.search.Ads(pageOptions,adblock1);}}function _init_prev_next_links(){$image_box.find(".prev_next a").add($gallery_index.find("span.prev_next a")).each(function(){$(this).off("click:left").on("click:left",function(e){var $this=$(this),this_href=$this.attr("href");if($this.parent().hasClass("disabled")){return false;}if(!forbes.state_manager.is_available()){return true;}if($this.parent().hasClass("next")){_engine.goto_next_slide();}else{_engine.goto_prev_slide();}e.preventDefault();return false;});});if(_is_touch_device){$image_box.swipe({swipeLeft:function(){_engine.goto_next_slide();},swipeRight:function(){_engine.goto_prev_slide();}});}}function _render(data,options){var suppress_sharing_reload=true;if(typeof options.gallery_changed!="undefined"&&options.gallery_changed){$title_box.replaceWith(forbes.util.parse_ajax_content(data.data,"title_box"));$gallery_index.replaceWith(forbes.util.parse_ajax_content(data.data,"gallery_index"));suppress_sharing_reload=false;}$image_box.replaceWith(forbes.util.parse_ajax_content(data.data,"image_box"));$copy_box.replaceWith(forbes.util.parse_ajax_content(data.data,"copy_box"));$gigya_settings_container.html(forbes.util.parse_ajax_content(data.data,"gigya_settings"));_init_ui({title:data.meta.title,suppress_sharing_reload:suppress_sharing_reload,num_history_pushes:options.num_history_pushes});_update_gallery_index({url:data.url});}function _state_change(state_data){var dest_url=(typeof state_data.request_url!="undefined")?state_data.request_url:_engine.get_init_slide(),history_pushed_once=state_data.history_pushed_once,num_history_pushes=state_data.num_history_pushes;if(_view_mode=="standalone"||forbes.modal_window.is_active()){if(typeof state_data.request_url=="undefined"&&forbes.modal_window.is_active()&&_view_mode!="standalone"){forbes.modal_window.destroy();}else{_engine.goto_slide(dest_url,{history_pushed_once:history_pushed_once,num_history_pushes:num_history_pushes});}}else{if(_view_mode=="overlay"){forbes.modal_window.load({url:dest_url,custom_class:"gallery_overlay",datasource:{getter:_engine.get_slide_data,after:function(options){_engine.save_cache_data(options.url,options.data);}},use_black_loading_spinner:true,allow_scrim_click_to_cancel:true,size_rules:{min_width:964,min_height:640,prefer_fullscreen:true,edge_padding:60},animate:true,on_cancel:function(){_destroy_overlay(function(){if(forbes.sharing_controls){forbes.sharing_controls.update();}});return false;},on_complete:function($load_target){debug("loaded modal");_engine.set_cur_slide(dest_url);_init_overlay_gallery();_engine.set_cur_gallery($gallery_index.data("gallery-id"));},on_reposition:function(){_on_window_resize();}});}}}function _init_key_bindings(){$(document).unbind("keydown").keydown(function(e){if(e.keyCode==37){if(_interstitial_is_engaged){return false;}if($gallery.find(".tab_nav .tab.mostpopular").hasClass("active")){return false;}_engine.goto_prev_slide();return false;}else{if(e.keyCode==39){if(_interstitial_is_engaged){return false;}if($gallery.find(".tab_nav .tab.mostpopular").hasClass("active")){return false;}_engine.goto_next_slide();return false;}else{if(e.keyCode==27){if(forbes.modal_window.is_active()){_destroy_overlay();}}}}});}function _init_gallery_index(options){$gallery_index=$gallery.find(".gallery_index");$gallery_index_prev=$gallery_index.find("span.prev");$gallery_index_next=$gallery_index.find("span.next");if($gallery_index.length<1||$gallery_index.hasClass("initialized")){return false;}var skip_animation=(typeof options!="undefined"&&typeof options.skip_animation!="undefined")?true:false;var url_index=[],init_url="";$gallery_index.find("ul.slides li a").each(function(){var $this=$(this),this_href=forbes.util.get_forbes_link($this.attr("href"));url_index.push(this_href);if($this.parent().hasClass("active")){init_url=this_href;}});_engine.set_index(url_index,init_url);if($gallery_index.data("auto-advance-to-next-gallery")===true){_engine.set_next_gallery_url($gallery_index.data("next-gallery-url"));}$gallery_index.find("ul.slides a").each(function(i){$(this).off("click:left").on("click:left",function(e){var $this=$(this);if($this.parent().hasClass("active")){return false;}if(!forbes.state_manager.is_available()){return true;}_engine.change_state({module_id:"galleries.engine",request_url:forbes.util.get_forbes_link($this.attr("href"))});return false;});});$gallery_index.find("ul.slides li img").each(function(i){var $this=$(this);if(!$this.hasClass("initialized")){$this.attr("src",$this.data("img-src"));if(!_is_touch_device&&!skip_animation){$this.css("opacity",0);$this.delay(i*40).animate({opacity:1},{duration:200,easing:"easeInOutCubic"});}else{$this.css("opacity",1);}$this.addClass("initialized");}});if(!$gallery_index.hasClass("initialized")){if(!_is_touch_device&&_view_mode!="overlay"&&!skip_animation){$gallery_index.css("opacity",0);$gallery_index.animate({height:0,opacity:1},{duration:400,easing:"easeInOutQuad"});}else{$gallery_index.css({opacity:1,height:0});}$gallery_index.addClass("initialized");}}function _update_gallery_index(options){$gallery_index.find("li").removeClass("active");var url_no_query_string=(options.url.indexOf("?")!=-1)?options.url.split("?")[0]:options.url,url_cleaned=forbes.util.get_forbes_link(url_no_query_string),$active=null;$gallery_index.find("ul.slides a").each(function(){var $this=$(this),this_href=forbes.util.get_forbes_link($this.attr("href"));if(this_href.indexOf("?")!=-1){this_href=this_href.split("?")[0];}if(this_href==url_cleaned){$active=$this.parent();}});if($active){$active.addClass("active");}_update_prev_next_buttons();_reposition_gallery_index();}function _update_prev_next_buttons(){var next_url=_engine.get_next_url(),prev_url=_engine.get_prev_url(),$image_prev=$image_box.find(".prev_next.prev"),$image_next=$image_box.find(".prev_next.next"),auto_advance=$gallery_index.data("auto-advance-to-next-gallery");$gallery_index_prev.removeClass("disabled active");$gallery_index_next.removeClass("disabled active");$image_prev.removeClass("disabled active");$image_next.removeClass("disabled active");if(prev_url===false){$gallery_index_prev.addClass("disabled");$image_prev.addClass("disabled");prev_url="#";}else{$gallery_index_prev.addClass("active");$image_prev.addClass("active");}if(next_url===false){$gallery_index_next.addClass("disabled");if(!auto_advance){$image_next.addClass("disabled");}else{$image_next.addClass("active");}next_url="#";}else{$gallery_index_next.addClass("active");$image_next.addClass("active");}$gallery_index_next.find("a").attr("href",next_url);$gallery_index_prev.find("a").attr("href",prev_url);}function _reposition_gallery_index(options){var index_width=0,available_width=Math.round($gallery_index.width()),$container=$gallery_index.find(".container"),$active=$gallery_index.find("ul.slides li.active"),skip_animation=(typeof options!="undefined"&&typeof options.skip_animation!="undefined")?true:false;if($active.length<1){return false;}$gallery_index.find("ul.slides li").each(function(){index_width+=$(this).width();if($(this).index()<($gallery_index.find("ul.slides li").length-1)){index_width+=parseInt($(this).css("margin-right"),10);}});index_width+=$gallery_index.find("span.prev").width()+$gallery_index.find("span.next").width();if(index_width<available_width){$container.width(index_width);}else{$container.width(available_width);}var $slides=$gallery_index.find("ul.slides");$slides.find("li").last().css("margin-right",0);var viewport_width=$gallery_index.find(".ul_holder .column").width(),total_width=$slides.width(),active_width=$active.width(),active_left_x=$active.position().left,active_middle_x=(active_width/2)+active_left_x,diff_x=(viewport_width/2)-active_middle_x,start_x=0,end_x=(total_width-viewport_width)*-1;if(diff_x>start_x){diff_x=start_x;}if(diff_x<end_x){diff_x=end_x;}if(!_is_touch_device&&!skip_animation){$slides.stop().animate({left:diff_x},{duration:400,easing:"easeOutCubic"});}else{$slides.stop().css("left",diff_x);}}function _reveal_loading_state(){$loading_state.stop().show().css("opacity",0).delay(0.3).animate({opacity:1},{duration:250,easing:"easeInOutQuad"});}function _hide_loading_state(){$loading_state.stop().hide();}function _destroy_overlay(callback){if(_view_mode=="overlay"){$(document).unbind("keydown");_engine.set_cur_slide(_engine.get_first_url());if(typeof window.History!="undefined"){window.History.back();}if(callback){callback();}}}function _get_view_mode(){return _view_mode;}return{init:_init,render:_render,reveal_loading_state:_reveal_loading_state,hide_loading_state:_hide_loading_state,state_change:_state_change,get_view_mode:_get_view_mode,on_window_resize:_on_window_resize,resize_ad:_resize_ad,update_display_ads:_update_display_ads,destroy_overlay:_destroy_overlay,init_gallery_launchers:_init_gallery_launchers,count_for_intx:_count_for_intx};})($);return module;}(app.galleries||{},$));return app;}(forbes||{},jQuery));var forbes=(function(app,$){app.copy_box=(function($){var debug=null,_inner_top_padding=10,_speed=150,_toggle_text={collapsed:"show more",expanded:"show less"},_toggle_icon={collapsed:"+",expanded:"&ndash;"},_copy_box_height={default_size:155,mini:95,super_mini:95};function _init(){debug=forbes.util.debug;}function _init_copy_box($gallery){var $selector=$gallery.find(".copy_box"),this_height,content_height,more_button="",is_tall_enough=false;more_button='<span class="more">';more_button+='	<span class="more_contents">';more_button+='		<span class="more_scrim"></span>';more_button+='		<span class="icon">'+_toggle_icon.collapsed+"</span>";more_button+='		<span class="label">'+_toggle_text.collapsed+"</span>";more_button+="	</span>";more_button+="</span>";$selector.each(function(){var $this=$(this);_set_copy_box_height($gallery,$this);this_height=$(this).height();content_height=$(this).find(".copy_box_content").height()+12;is_tall_enough=_check_content_height(content_height,this_height);if(is_tall_enough===true){$(this).find(".gradient").show();$(this).find(".copy_box_content .gradient").remove();if(!$(this).parent().hasClass("copy_box_outer")){$(this).wrap('<div class="copy_box_outer"/>');}else{$(this).parent(".copy_box_outer").removeClass("expanded");}if($(this).find(".copy_box_inner").length===0){$(this).find(".copy_box_content").wrap('<div class="copy_box_inner"/>');}if($(this).find(".copy_box_scrim").length===0){$(this).find(".copy_box_inner").before('<div class="copy_box_scrim"></div>');}if($(this).find(".gradient").length===0){$(this).find(".copy_box_inner").after('<div class="gradient"></div>');}$(this).data("gradientheight",45);$(this).addClass("expandable");_bind_events($(this));}else{$(this).removeClass("expandable");}});}function _check_content_height(content_height,container_height){var is_tall_enough=false,difference_height=(content_height-container_height);if((content_height>container_height)&&(difference_height>10)){is_tall_enough=true;}return is_tall_enough;}function _check_copy_box($gallery){var $selector=$gallery.find(".copy_box"),this_height,content_height,is_tall_enough=false;$selector.each(function(){var $this=$(this);_set_copy_box_height($gallery,$this);this_height=$(this).height();content_height=$(this).find(".copy_box_content").height()+12;is_tall_enough=_check_content_height(content_height,this_height);if(is_tall_enough===true){$(this).addClass("expandable");_bind_events($(this));}else{$(this).find(".gradient").hide();$(this).removeClass("expandable");}});}function _set_copy_box_height($gallery,$copy_box){var container_height=0;if($gallery.hasClass("default_size")){container_height=_copy_box_height.default_size;}else{if($gallery.hasClass("mini")||$gallery.hasClass("super_mini")){container_height=_copy_box_height.mini;}else{container_height=_copy_box_height.mini;}}}function _update_copy_box($gallery){var $copy_box=$gallery.find(".copy_box"),this_height,content_height;if($copy_box.hasClass("expandable")){_set_copy_box_height($gallery,$copy_box);this_height=$copy_box.height();content_height=$copy_box.find(".copy_box_content").height()+12;if(content_height>this_height){$copy_box.data("gradientheight",45);$copy_box.find(".gradient").show();}else{$copy_box.find(".gradient").hide();$copy_box.removeClass("expandable");}}else{_init_copy_box($gallery);}}function _bind_events($copy_box){var $copy_box_outer=$copy_box.closest(".copy_box_outer");$copy_box_outer.off("mouseenter").on("mouseenter",function(e){$(this).addClass("hover");});$copy_box_outer.off("mouseleave").on("mouseleave",function(e){$(this).removeClass("hover");});$copy_box_outer.off("click:left").on("click:left",function(e){var $copy_box=$(this).find(".copy_box");if($copy_box.hasClass("expandable")){if($(this).closest(".gallery_embedded").hasClass("default_size")||$(this).closest(".content.gallery").hasClass("modal_screen")){if($copy_box.hasClass("expanded")){_collapse_copy_box($copy_box);}else{_expand_copy_box($copy_box);}}}});}function _expand_copy_box($copy_box){var $gallery=$copy_box.closest(".gallery_embedded"),$inner_box=$copy_box.find(".copy_box_inner"),$content_box=$copy_box.find(".copy_box_content"),$copy_box_outer=$copy_box.closest(".copy_box_outer"),original_height=0,delta_y=0,$gradient=$copy_box.find(".gradient"),$more_link=$copy_box.find(".more");if($gallery.hasClass("default_size")){original_height=_copy_box_height.default_size;}else{original_height=_copy_box_height.mini;}delta_y=-(($content_box.height()-original_height)+_inner_top_padding),$copy_box.stop();$copy_box.addClass("expanded").animate({top:delta_y,height:$content_box.height()+_inner_top_padding},{duration:_speed,easing:"easeOutQuad",step:function(){$copy_box.css("overflow","visible");$inner_box.height($copy_box.height());},complete:function(){$inner_box.height($content_box.height()+_inner_top_padding);}});$gradient.stop();$gradient.animate({height:1},{duration:_speed,easing:"easeOutQuad",queue:false});$more_link.find(".label").html(_toggle_text.expanded);$more_link.find(".icon").html(_toggle_icon.expanded);}function _collapse_copy_box($copy_box){var $gallery=$copy_box.closest(".gallery_embedded"),$inner_box=$copy_box.find(".copy_box_inner"),$copy_box_outer=$copy_box.closest(".copy_box_outer"),original_height=0,delta_y=0,$gradient=$copy_box.find(".gradient"),$more_link=$copy_box.find(".more");if($gallery.hasClass("default_size")){original_height=_copy_box_height.default_size;}else{original_height=_copy_box_height.mini;}$copy_box.stop();$copy_box.removeClass("expanded").animate({top:delta_y,height:original_height},{duration:_speed,easing:"easeOutQuad",step:function(){$copy_box.css("overflow","visible");}});$inner_box.stop();$inner_box.animate({top:delta_y,height:original_height},{duration:(_speed*0.75),easing:"easeOutQuad"});$gradient.css({height:Number($copy_box.data("gradientheight"))});$more_link.find(".label").html(_toggle_text.collapsed);$more_link.find(".icon").html(_toggle_icon.collapsed);}return{init:_init,init_copy_box:_init_copy_box,collapse_copy_box:_collapse_copy_box,update_copy_box:_update_copy_box,check_copy_box:_check_copy_box};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register_lazy_callback(forbes.copy_box.init);var forbes=(function(app,$){app.galleries=(function(module,$){module.preview=(function($){var debug=null,_speed=200,_config={loading_width:41,loading_height:37,loaded_width:251,loaded_height:0,min_margin:5,min_height:288},_gallery={enter_timeout:null,enter_delay:500,leave_timeout:null,leave_delay:500,hovering:false,"$launch_link":null,loading_done:false,leave_time:0,enter_time:0,url:"",pos:{}},_engine=null,$loading_state=null,$gallery=null,$gallery_preview=null,$gallery_index=null,$gallery_index_prev=null,$gallery_index_next=null;function _init(){debug=forbes.util.debug;if($("html").hasClass("touch")){return false;}_engine=forbes.galleries.engine;$gallery_preview=_create_container();$gallery=$gallery_preview.find(".content");$loading_state=$gallery_preview.find(".loading_state");_init_launchers({"$selector":$(".article .body")});$gallery_preview.hide();if(forbes.search_behavior){forbes.search_behavior.bind_gallery_events();}}function _init_launchers(options){var $launcher_links=$(),scopes=[{"$selector":options.$selector,exceptions:{ignore_if_parent_has_class:"wp-caption-text",ignore_if_has_class:"bloggalleryicon",ignore_if_in_vestpocket:true}}];$.each(scopes,function(key,scope){var $selector=scope.$selector,exceptions=(typeof scope.exceptions!="undefined")?scope.exceptions:false;$selector.find("a").each(function(){var $this=$(this),href=$this.attr("href"),matches=false;if(typeof href!="undefined"&&href.length>0){matches=$this.attr("href").match(/\/pictures\//i);if(matches&&matches.length>0){if(exceptions!==false){if(typeof exceptions.ignore_if_parent_has_class!="undefined"){if($this.parent().hasClass(exceptions.ignore_if_parent_has_class)){return;}}if(typeof exceptions.ignore_if_has_class!="undefined"){if($this.hasClass(exceptions.ignore_if_has_class)){return;}}if(typeof exceptions.ignore_if_in_vestpocket!="undefined"){if($this.parents("aside.vestpocket").length>0){return;}}}_bind_launcher_link_events($this);}}});});}function _bind_launcher_link_events($launcher){$launcher.on("mouseenter",function(){var $this=$(this),time_object=new Date(),time_since_mouseleave;_gallery.enter_time=time_object.getTime();clearInterval(_gallery.leave_timeout);clearInterval(_gallery.enter_timeout);_gallery.hovering=true;if(_gallery.$launch_link&&$this.get(0)===_gallery.$launch_link.get(0)&&$gallery_preview.css("display")==="block"){return false;}time_since_mouseleave=_gallery.enter_time-_gallery.leave_time;if((_gallery.$launch_link===null)||((time_since_mouseleave>=_gallery.leave_delay)&&($this!==_gallery.$launch_link))){_gallery.enter_timeout=setTimeout(function(){_show_it.call($this,{reset:true});},_gallery.enter_delay);}else{if(time_since_mouseleave<_gallery.leave_delay){_show_it.call($this,{reset:false});}}});$launcher.on("mouseleave",function(){var d=new Date();_gallery.leave_time=d.getTime();_gallery.hovering=false;_gallery.leave_timeout=setTimeout(function(){_hide_it();},_gallery.leave_delay);});}function _bind_gallery_events(){$(document).off("mouseenter",".gallery_preview").on("mouseenter",".gallery_preview",function(){_gallery.hovering=true;clearInterval(_gallery.leave_timeout);});$(document).off("mouseleave",".gallery_preview").on("mouseleave",".gallery_preview",function(){var d=new Date();_gallery.leave_time=d.getTime();_gallery.hovering=false;_gallery.leave_timeout=setTimeout(function(){_hide_it();},_gallery.leave_delay);});$(document).on("click:left",".gallery_preview .image_box",function(e){if(!forbes.state_manager.is_available()){return true;}return true;forbes.event_tracking.track_ga_event(["Gallery_Activity","Hover_TextLink_Engaged",$('meta[property="og:url"]').attr("content")]);_engine.change_state({module_id:"galleries.engine",request_url:forbes.util.get_forbes_link(_gallery.url.replace("#gallerycontent",""))});return false;});}function _load_gallery(){var this_url=_gallery.url;if(!forbes.util.in_production_mode()){this_url=forbes.util.get_forbes_link(this_url);}var data=_engine.get_slide_data({url:this_url,after_ajax_load:function(data){_engine.save_cache_data(this_url,data);_load_gallery();}});if(typeof data.loading!="undefined"&&data.loading){return false;}_on_loaded(data.data);}function _create_container(){var html="";if($(".gallery_preview").length>0){return $(".gallery_preview");}html+='<div class="gallery_preview">';html+='	<div class="gallery_preview_border"></div>';html+='	<div class="gallery_preview_content">';html+='		<div class="content gallery">';html+="		</div>";html+='		<div class="loading_state">';html+='			<div class="spinner">';html+="			</div>";html+="		</div>";html+="	</div>";html+='	<div class="outer_arrow"></div>';html+="</div>";$("body").append(html);return $(".gallery_preview");}function _show_it(options){if(_gallery.hovering){$gallery.empty();if(options.reset===true){$gallery_preview.css({width:_config.loading_width,height:_config.loading_height,display:"block",opacity:0});}else{$gallery_preview.css({display:"block"});}_gallery.$launch_link=this;_update_init_position.call(this);_gallery.loading_done=false;_gallery.url=this.attr("href");_reveal_container();_load_gallery();forbes.event_tracking.track_ga_event(["Gallery_Activity","Hover_TextLink",$('meta[property="og:url"]').attr("content")]);}}function _on_loaded(data){var gallery_title="",gallery_image_box="",gallery_index="";_gallery.loading_done=true;$loading_state.hide();if(!_gallery.hovering){return false;}var galleryTitle=$(data).find(".gallery_main h1 a").text();var brandIndex=galleryTitle.search("Voice:");var bvBrand=galleryTitle.substring(0,brandIndex);var bvVoice=galleryTitle.substring(brandIndex,brandIndex+6);var bvTitle=galleryTitle.substring(brandIndex+6,galleryTitle.length);gallery_title="<h1>"+bvBrand+'<span class="advoice">'+bvVoice+"</span>"+bvTitle+"</h1>";gallery_image_box+=forbes.util.parse_ajax_content(data,"image_box");gallery_index+=forbes.util.parse_ajax_content(data,"gallery_index");var empt=$("<div></div>");empt.append(gallery_image_box);empt.find(".container .prev_next").remove();empt.find(".prev_next .bg").remove();empt.find(".container .border").remove();empt.find(".credit").remove();var string1=$.trim(empt.find(".image_box").html());var string2=$.trim($gallery.find(".image_box").html());if($gallery.find(".image_box").get(0)&&string1===string2){return false;}$gallery.empty();$gallery.append(gallery_title+gallery_image_box+gallery_index);$gallery.find(".container .prev_next").remove();$gallery.find(".prev_next .bg").remove();$gallery.find(".container .border").remove();$gallery.find(".credit").remove();_init_gallery_index();_update_size_position_loaded();_bind_gallery_events();}function _init_gallery_index(){$gallery_index=$gallery.find(".gallery_index");$gallery_index.find("ul.slides li").each(function(i){$(this).removeClass("active");if(i>3){$(this).remove();}});if($gallery_index.length<1||$gallery_index.hasClass("initialized")){return false;}$gallery_index.find("ul.slides a").each(function(){$(this).off("click:left").on("click:left",function(e){var $this=$(this);if(!forbes.state_manager.is_available()){return true;}return true;forbes.event_tracking.track_ga_event(["Gallery_Activity","Hover_TextLink_Engaged",$('meta[property="og:url"]').attr("content")]);_engine.change_state({module_id:"galleries.engine",request_url:forbes.util.get_forbes_link($this.attr("href"))});e.preventDefault();return false;});});$gallery_index.find("ul.slides li img").each(function(i){var $this=$(this);if(!$this.hasClass("initialized")){$this.attr("src",$this.data("img-src"));$this.css("opacity",1);$this.addClass("initialized");}});if(!$gallery_index.hasClass("initialized")){$gallery_index.css("opacity",1).height(parseInt($gallery_index.data("target-height"),10));$gallery_index.addClass("initialized");}}function _update_size_position_loaded(){var new_arrow_x=0,$outer_arrow=$gallery_preview.find(".outer_arrow"),link_x=_gallery.$launch_link.offset().left,link_y=_gallery.$launch_link.offset().top,link_width=_gallery.$launch_link.width(),link_height=_gallery.$launch_link.height(),gallery_width=_config.loaded_width+20,gallery_height=$gallery.height(),max_x=($(window).width()-gallery_width)-_config.min_margin,min_y=_config.min_margin+$(window).scrollTop();_gallery.pos.x=(link_width/2)-(_config.loaded_width/2)+link_x;_gallery.pos.y=(link_y-gallery_height);if(_gallery.pos.x<0){new_arrow_x=(link_x+(link_width/2))+_config.min_margin;new_arrow_x-=($outer_arrow.width()/2);_gallery.pos.x=_config.min_margin;$outer_arrow.css({left:new_arrow_x});}else{if(_gallery.pos.x>=max_x){new_arrow_x=Math.floor(($(window).width()-link_x)/2);$outer_arrow.css({right:new_arrow_x,left:"auto"});_gallery.pos.x=max_x;}else{$outer_arrow.css({left:"50%",right:"auto"});}}if(_gallery.pos.y<=min_y){_gallery.pos.y=link_y-_config.min_margin+link_height+40;$outer_arrow.css({top:0,bottom:"auto"});$gallery_preview.addClass("up");}else{$outer_arrow.css({top:"auto",bottom:0});$gallery_preview.removeClass("up");}$gallery_preview.find(".content.gallery").css("opacity",0);$gallery_preview.animate({width:_config.loaded_width,height:$gallery.height(),top:_gallery.pos.y,left:_gallery.pos.x},{duration:_speed/3,queue:false,easing:"easeInOutQuad",complete:function(){$gallery_preview.find(".content.gallery").css("opacity",1);}});}function _update_init_position(){var min_y=_config.min_margin+$(window).scrollTop(),link_y=_gallery.$launch_link.offset().top,link_height=_gallery.$launch_link.height(),min_possible_y=(link_y-_config.min_height),$outer_arrow=$gallery_preview.find(".outer_arrow");_gallery.pos.x=$(this).offset().left+($(this).width()/2)-($gallery_preview.width()/2);_gallery.pos.y=($(this).offset().top-$gallery_preview.height());if(min_possible_y<=min_y){_gallery.pos.y=link_y-_config.min_margin+link_height+40;$outer_arrow.css({top:0,bottom:"auto"});$gallery_preview.addClass("up");}else{$outer_arrow.css({top:"auto",bottom:0});$gallery_preview.removeClass("up");}$gallery_preview.css({top:_gallery.pos.y,left:_gallery.pos.x});}function _hide_it(){clearInterval(_gallery.enter_timeout);_gallery.enter_timeout=null;_gallery.$launch_link=null;$gallery.empty();if(!_gallery.hovering){$gallery_preview.fadeOut(_speed);}}function _reveal_container(){$loading_state.show();$gallery_preview.stop().animate({opacity:1},{duration:_speed,easing:"easeInOutQuad"});}return{init:_init,init_launchers:_init_launchers};})($);return module;}(app.galleries||{},$));return app;}(forbes||{},jQuery));var forbes=(function(app,$){app.galleries=(function(module,$){module.engine=(function($){var ref_url_test=window.location.href;var _initialized=false,_mode=null,_prev_slide=null,_cur_slide=null,_cur_gallery=null,_init_slide=null,debug=null,_is_loading=false,_is_phone=false,_index=null,_first_index=null,_num_history_pushes=0,_history_has_been_pushed_at_least_once=false,_behavior=null,_next_gallery_url=null,_ajax_cache=[],_ajax_cache_limit=10,_intx_flag=false;$img_preloading_bin=null;function _init(){debug=forbes.util.debug;if(_is_initialized()){return false;}if(_is_phone){_mode="mobile";_behavior=forbes.galleries.behavior_mobile;}else{_mode="desktop";_behavior=forbes.galleries.behavior_desktop;}_behavior.init();_initialized=true;}function _is_initialized(){return _initialized;}function check_pos_intx(){if(googletag.pubads()!=undefined){slots=googletag.pubads().getSlots();for(var i=0;i<slots.length;i++){var slot=slots[i];var params=slot.getTargetingMap();debug(params.pos[0]);if(params.pos[0]=="intx"){_intx_flag=true;_behavior.count_for_intx++;break;}}}debug("_behavior.count_for_intx"+_behavior.count_for_intx);}function _sr_gallery_next_prev(_get_ref_url){var next_url=_get_next_url();if(next_url===false&&_next_gallery_url!==null){forbes.util.debug("You are on last slide");sessionStorage.setItem("ref",window.location.href);}var sr_object=forbes.page_meta.simple_reach;var set_ref_url=_get_ref_url;var _ajax_reach_config={iframe:sr_object.iframe,pid:sr_object.pid,url:sr_object.url,title:sr_object.title,date:sr_object.date,authors:sr_object.authors,channels:sr_object.channels,tags:sr_object.tags,ref_url:set_ref_url};SPR.Reach.collect(_ajax_reach_config);}function _goto_next_slide(){var next_url=_get_next_url();if(next_url===false&&_next_gallery_url!==null){forbes.event_tracking.track_ga_event(["Gallery","LastSlide",encodeURI(_next_gallery_url)]);window.location=_next_gallery_url;return false;}if(next_url){_change_state({module_id:"galleries.engine",request_url:next_url});}check_pos_intx();if(_intx_flag&&_behavior.count_for_intx==2){debug("removing cache");location.reload();debug("removed cache");}else{googletag.pubads().refresh();}return false;}function _goto_prev_slide(){var prev_url=_get_prev_url();if(prev_url){_change_state({module_id:"galleries.engine",request_url:prev_url});}check_pos_intx();if(_intx_flag&&_behavior.count_for_intx==2){debug("removing cache");location.reload();debug("removed cache");}else{googletag.pubads().refresh();}}function _goto_slide(url,options){if(_is_loading){return false;}if(typeof options=="undefined"){options={};}var this_url=url,this_options=options,data=_get_slide_data({url:this_url,after_ajax_load:function(data){_is_loading=false;_save_cache_data(this_url,data);_goto_slide(this_url,this_options);}});if(typeof data.loading!="undefined"&&data.loading){_toggle_loading(true);return false;}_toggle_loading(false);_render_slide(data,options);_sr_gallery_next_prev(ref_url_test);ref_url_test=window.location.href;_prefetch_upcoming_slide_data();}function _toggle_loading(is_loading){_is_loading=is_loading;if(_is_loading){_behavior.reveal_loading_state();}else{_behavior.hide_loading_state();}}function _render_slide(data_obj,options){_set_cur_slide(data_obj.url);var gallery_id=data_obj.data.match(/data-gallery-id="([a-zA-Z0-9_]*)"/i)[1];if(_cur_gallery===null){_cur_gallery=gallery_id;}if(gallery_id!=_cur_gallery){options.gallery_changed=true;_set_cur_gallery(gallery_id);}_behavior.render(data_obj,options);}function _get_slide_data(options){var this_url=options.url;if(_ajax_cache.length>0){for(var i=_ajax_cache.length-1;i>=0;i--){if(_ajax_cache[i].url==this_url){return _ajax_cache[i];}}}forbes.util.load_ajax({url:this_url,success:options.after_ajax_load,error:function(){_is_loading=false;}});return{loading:true};}function _prefetch_upcoming_slide_data(){var upcoming_urls=[];for(var i=0;i<_index.length;i++){if(_index[i]==_cur_slide){if(typeof _index[i+1]!="undefined"){upcoming_urls.push(_index[i+1]);}break;}}$.each(upcoming_urls,function(index,value){var this_url=value;_get_slide_data({url:this_url,after_ajax_load:function(data){_save_cache_data(this_url,data);var img_tag=forbes.util.parse_ajax_content(data,"main_image");_preload_img(img_tag);}});});}function _save_cache_data(url,data){var cache_obj={url:url,data:forbes.util.parse_ajax_content(data,"ajax_content"),meta:{title:data.match(/<title>(.+)<\/title>/i)[1]}};_ajax_cache.push(cache_obj);if(_ajax_cache.length>_ajax_cache_limit){_ajax_cache.remove(0);}}function _change_state(state_data){if(!forbes.state_manager.is_available()){return false;}state_data.module_id="galleries.engine";if(_behavior.get_view_mode()=="overlay"&&_history_has_been_pushed_at_least_once){state_data.replace_state=true;forbes.state_manager.add_to_history(state_data);}else{_history_has_been_pushed_at_least_once=true;forbes.state_manager.add_to_history(state_data);}}function _state_change(state_data){_num_history_pushes++;if(typeof state_data.request_url=="undefined"){_history_has_been_pushed_at_least_once=false;_num_history_pushes=0;}state_data.num_history_pushes=_num_history_pushes;state_data.history_pushed_once=_history_has_been_pushed_at_least_once;_behavior.state_change(state_data);}function _set_index(url_array,init_url){_index=url_array;if(_first_index===null){_first_index=_index;}if(typeof _cur_slide!="string"){_cur_slide=init_url;_init_slide=init_url;}}function _set_cur_gallery(id){_cur_gallery=id;}function _set_next_gallery_url(next_url){_next_gallery_url=forbes.util.get_forbes_link(next_url);}function _get_first_url(){return _first_index[0];}function _get_url_status(){return{cur:_cur_slide,prev:_prev_slide};}function _get_prev_url(){for(var i=0;i<_index.length;i++){if(_index[i]==_cur_slide&&i!==0){if(typeof _index[i-1]!="undefined"){return _index[i-1];}}}return false;}function _get_next_url(){if(!_index){return false;}for(var i=0;i<_index.length;i++){var cur_clean=(_cur_slide.indexOf("?")!=-1)?_cur_slide.split("?")[0]:_cur_slide,this_clean=(_index[i].indexOf("?")!=-1)?_index[i].split("?")[0]:_index[i];if(cur_clean.substr(-1)=="/"){cur_clean=cur_clean.substr(0,cur_clean.length-1);}if(this_clean.substr(-1)=="/"){this_clean=this_clean.substr(0,this_clean.length-1);}if(this_clean==cur_clean){if(typeof _index[i+1]!="undefined"){return _index[i+1];}}}return false;}function _get_init_slide(){return _init_slide;}function _set_cur_slide(new_slide){_prev_slide=_cur_slide;_cur_slide=forbes.util.get_forbes_link(new_slide);}function _init_img_preloading(){var preloading_class="image_preloading_bin";if($("div."+preloading_class).length>0){$("div."+preloading_class).remove();}$("body").append("<div class='"+preloading_class+"'></div>");$img_preloading_bin=$("div."+preloading_class);$img_preloading_bin.css({position:"absolute",top:0,left:0,width:"0",height:"0",overflow:"hidden",opacity:0.7,display:"none"});}function _reset_history_variable(){_num_history_pushes=0;_history_has_been_pushed_at_least_once=false;}function _preload_img(img_tag){$img_preloading_bin.append(img_tag);var $images=$img_preloading_bin.find("img");if($images.length>5){$images.first().remove();}}return{init:_init,get_slide_data:_get_slide_data,goto_slide:_goto_slide,goto_prev_slide:_goto_prev_slide,goto_next_slide:_goto_next_slide,set_index:_set_index,get_prev_url:_get_prev_url,get_next_url:_get_next_url,get_url_status:_get_url_status,init_img_preloading:_init_img_preloading,prefetch_upcoming_slide_data:_prefetch_upcoming_slide_data,change_state:_change_state,set_next_gallery_url:_set_next_gallery_url,get_init_slide:_get_init_slide,set_cur_slide:_set_cur_slide,save_cache_data:_save_cache_data,set_cur_gallery:_set_cur_gallery,is_initialized:_is_initialized,get_first_url:_get_first_url,state_change:_state_change,reset_history_variable:_reset_history_variable};})($);return module;}(app.galleries||{},$));return app;}(forbes||{},jQuery));forbes.bootstrap.register_lazy_callback(forbes.galleries.engine.init);var forbes=(function(app,$){app.clipboards=(function($){var _clip_class_name="clipboard-button",_clipboard=null,_instances=[];function _init(){ZeroClipboard.setMoviePath("/assets/swf/ZeroClipboard.swf");}_clipboard=function(){this.$element=arguments[0];this.id="clipboard-"+(_instances.length+1);this.$element.attr("id",this.id);this.link_url=this.$element.attr("href");this.zero_clipboard=new ZeroClipboard.Client();this.zero_clipboard.setText(this.link_url);this.zero_clipboard.setHandCursor(true);this.zero_clipboard.setCSSEffects(false);this.zero_clipboard.glue(this.id);this.register();this.bind_events();var t=setTimeout(function(){_reposition_all();},500);};_clipboard.prototype={};_clipboard.prototype.register=function(){_instances.push(this);};_clipboard.prototype.bind_events=function(){var $element=this.$element,this_url=this.link_url,$confirmation=$element.find(".confirmation");this.zero_clipboard.addEventListener("onComplete",function(client,text){$confirmation.addClass("show");$confirmation.timeout_interval=setTimeout(function(){$confirmation.removeClass("show");},1200);});this.zero_clipboard.addEventListener("onMouseDown",function(client){});this.zero_clipboard.addEventListener("onMouseOver",function(client){$element.addClass("hover");});this.zero_clipboard.addEventListener("onMouseOut",function(client){$element.removeClass("hover");});};_clipboard.prototype.set_text=function(link_url){this.link_url=link_url;};function _create_clipboard(){var link_element=arguments[0].$element,clipboard_reference=new _clipboard(link_element);return clipboard_reference;}function _reposition_all(){for(var i=0;i<_instances.length;i++){_instances[i].zero_clipboard.reposition();}}return{init:_init,create_clipboard:_create_clipboard,reposition_all:_reposition_all};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register(forbes.clipboards.init);var ZeroClipboard={version:"1.0.8",clients:{},moviePath:"ZeroClipboard.swf",nextId:1,$:function(a){return typeof a=="string"&&(a=document.getElementById(a)),a.addClass||(a.hide=function(){this.style.display="none";},a.show=function(){this.style.display="";},a.addClass=function(a){this.removeClass(a),this.className+=" "+a;},a.removeClass=function(a){var b=this.className.split(/\s+/),c=-1;for(var d=0;d<b.length;d++){b[d]==a&&(c=d,d=b.length);}return c>-1&&(b.splice(c,1),this.className=b.join(" ")),this;},a.hasClass=function(a){return !!this.className.match(new RegExp("\\s*"+a+"\\s*"));}),a;},setMoviePath:function(a){this.moviePath=a;},newClient:function(){return new ZeroClipboard.Client;},dispatch:function(a,b,c){var d=this.clients[a];d&&d.receiveEvent(b,c);},register:function(a,b){this.clients[a]=b;},getDOMObjectPosition:function(a,b){var c={left:0,top:0,width:a.width?a.width:a.offsetWidth,height:a.height?a.height:a.offsetHeight};while(a&&a!=b){c.left+=a.offsetLeft,c.top+=a.offsetTop,a=a.offsetParent;}return c;},Client:function(a){this.handlers={},this.id=ZeroClipboard.nextId++,this.movieId="ZeroClipboardMovie_"+this.id,ZeroClipboard.register(this.id,this),a&&this.glue(a);}};ZeroClipboard.Client.prototype={id:0,ready:!1,movie:null,clipText:"",handCursorEnabled:!0,cssEffects:!0,handlers:null,zIndex:99,glue:function(a,b,c){this.domElement=ZeroClipboard.$(a),this.domElement.style.zIndex&&(this.zIndex=parseInt(this.domElement.style.zIndex,10)+1),typeof b=="string"?b=ZeroClipboard.$(b):typeof b=="undefined"&&(b=document.getElementsByTagName("body")[0]);var d=ZeroClipboard.getDOMObjectPosition(this.domElement,b);this.div=document.createElement("div");var e=this.div.style;e.position="absolute",e.left=""+d.left+"px",e.top=""+d.top+"px",e.width=""+d.width+"px",e.height=""+d.height+"px",e.zIndex=this.zIndex;if(typeof c=="object"){for(var f in c){e[f]=c[f];}}b.appendChild(this.div),this.div.innerHTML=this.getHTML(d.width,d.height);},getHTML:function(a,b){var c="",d="id="+this.id+"&width="+a+"&height="+b;if(navigator.userAgent.match(/MSIE/)){var e=location.href.match(/^https/i)?"https://":"http://";c+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+e+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+a+'" height="'+b+'" id="'+this.movieId+'" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+ZeroClipboard.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+d+'"/><param name="wmode" value="transparent"/></object>';}else{c+='<embed id="'+this.movieId+'" src="'+ZeroClipboard.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+a+'" height="'+b+'" name="'+this.movieId+'" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+d+'" wmode="transparent" />';}return c;},hide:function(){this.div&&(this.div.style.left="-2000px");},show:function(){this.reposition();},destroy:function(){if(this.domElement&&this.div){this.hide(),this.div.innerHTML="";var a=document.getElementsByTagName("body")[0];try{a.removeChild(this.div);}catch(b){}this.domElement=null,this.div=null;}},reposition:function(a){a&&(this.domElement=ZeroClipboard.$(a),this.domElement||this.hide());if(this.domElement&&this.div){var b=ZeroClipboard.getDOMObjectPosition(this.domElement),c=this.div.style;c.left=""+b.left+"px",c.top=""+b.top+"px";}},setText:function(a){this.clipText=a,this.ready&&this.movie.setText(a);},addEventListener:function(a,b){a=a.toString().toLowerCase().replace(/^on/,""),this.handlers[a]||(this.handlers[a]=[]),this.handlers[a].push(b);},setHandCursor:function(a){this.handCursorEnabled=a,this.ready&&this.movie.setHandCursor(a);},setCSSEffects:function(a){this.cssEffects=!!a;},receiveEvent:function(a,b){a=a.toString().toLowerCase().replace(/^on/,"");switch(a){case"load":this.movie=document.getElementById(this.movieId);if(!this.movie){var c=this;setTimeout(function(){c.receiveEvent("load",null);},1);return;}if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/)){var c=this;setTimeout(function(){c.receiveEvent("load",null);},100),this.ready=!0;return;}this.ready=!0,this.movie.setText(this.clipText),this.movie.setHandCursor(this.handCursorEnabled);break;case"mouseover":this.domElement&&this.cssEffects&&(this.domElement.addClass("hover"),this.recoverActive&&this.domElement.addClass("active"));break;case"mouseout":this.domElement&&this.cssEffects&&(this.recoverActive=!1,this.domElement.hasClass("active")&&(this.domElement.removeClass("active"),this.recoverActive=!0),this.domElement.removeClass("hover"));break;case"mousedown":this.domElement&&this.cssEffects&&this.domElement.addClass("active");break;case"mouseup":this.domElement&&this.cssEffects&&(this.domElement.removeClass("active"),this.recoverActive=!1);}if(this.handlers[a]){for(var d=0,e=this.handlers[a].length;d<e;d++){var f=this.handlers[a][d];typeof f=="function"?f(this,b):typeof f=="object"&&f.length==2?f[0][f[1]](this,b):typeof f=="string"&&window[f](this,b);}}}},typeof module!="undefined"&&(module.exports=ZeroClipboard);var forbes=(function(app,$){app.quotecard=(function($){var debug=null,_mouseenter_timer=null,_mouseenter_delay=350,_mouseleave_timer=null,_mouseleave_delay=200,$expanded=null,_quote_cache=[];function _init(){debug=forbes.util.debug;if($("span.quotecard_hook").length<1){return false;}if($.browser.msie&&$.browser.version<8){return false;}$("span.quotecard_hook").each(function(){var $this=$(this);if($this.hasClass("initialized")){return true;}var hook_html="",ticker=$this.data("ticker"),exchange=$this.data("exchange"),closing_price=$this.data("quotes-closing"),current_price=$this.data("quotes-now"),amount_changed=current_price-closing_price,amount_changed_rounded=_round_to_two_decimals(amount_changed),percent_change=_round_to_two_decimals((amount_changed/closing_price)*100),direction=(current_price>closing_price)?"increase":"decrease",plus_or_minus=(current_price>closing_price)?"+":"";if(parseInt(current_price,10)===0){return true;}hook_html+='<span class="ticker">'+ticker+"</span>";hook_html+=' <span class="change">'+plus_or_minus+percent_change+"%</span>";$this.find(".wrapper").addClass(direction);$this.find("a").html(hook_html);$this.addClass("initialized");forbes.event_tracking.track_ga_event(["Quotecard","LinkRevealed",exchange+":"+ticker]);$this.on("mouseenter",_on_hook_mouseenter);$this.on("mouseleave",_on_hook_mouseleave);});}function _on_hook_mouseenter(){var $this=$(this),hook_data=_get_quotehook_data($this);$this.addClass("hovering");if(!$this.hasClass("loaded")&&!$this.hasClass("loading")){_load_quote_json($this);}if($()){}clearTimeout(_mouseenter_timer);_mouseenter_timer=setTimeout(function(){_reveal($this);},_mouseenter_delay);}function _on_hook_mouseleave(){$(this).removeClass("hovering");clearTimeout(_mouseleave_timer);_mouseleave_timer=setTimeout(function(){if(!_mouse_is_hovering()){_hide();}},_mouseleave_delay);}function _mouse_is_hovering(options){if($expanded.hasClass("hovering")){return true;}var ticker=$expanded.data("ticker"),exchange=$expanded.data("exchange");if($('span.quotecard_hook.hovering[data-ticker="'+ticker+'"][data-exchange="'+exchange+'"]').length>0){return true;}return false;}function _load_quote_json($target){var hook_data=_get_quotehook_data($target),infocard_url="/json/get_info_card",already_in_cache=false;if(_quote_cache.length>0){for(var i=0;i<_quote_cache.length;i++){if(_quote_cache[i].id==hook_data.id&&_quote_cache[i].loaded){if(_quote_cache[i].loaded){return false;}else{already_in_cache=true;}}}}if(typeof forbes.page_meta!="undefined"&&typeof forbes.page_meta.natural_id!="undefined"){hook_data.natural_id=forbes.page_meta.natural_id;}if(!already_in_cache){_quote_cache.push({id:hook_data.id,loaded:false});}$target.addClass("loading");forbes.util.load_ajax({url:infocard_url,data:hook_data,dataType:"json",success:function(data){if(typeof data.quotes=="undefined"||data.quotes===null||typeof data.quotes.results=="undefined"||typeof data.quotes.results.length<1){debug("Quotecard Error: Incomplete data. Likely quote data unavailable.");$target.removeClass("loading");_hide();return false;}for(var n=0;n<_quote_cache.length;n++){if(_quote_cache[n].id==hook_data.id){_quote_cache[n].loaded=true;_quote_cache[n].data=data;_update_hook_data(hook_data,data);_mark_as_loaded(hook_data);_reveal($target);break;}}},error:function(){debug("error loading infocard: "+infocard_url);}});}function _update_hook_data(hook_data,data){var closing_price=data.quotes.results[0].D20,current_price=data.quotes.results[0].D2;$('span.quotecard_hook[data-ticker="'+hook_data.ticker+'"][data-exchange="'+hook_data.exchange+'"]').each(function(){var $this=$(this);$this.data("quotes-closing",closing_price);$this.data("quotes-now",current_price);var hook_html="",amount_changed=current_price-closing_price,amount_changed_rounded=_round_to_two_decimals(amount_changed),percent_change=_round_to_two_decimals((amount_changed/closing_price)*100),direction=(current_price>closing_price)?"increase":"decrease",plus_or_minus=(current_price>closing_price)?"+":"";if(parseInt(current_price,10)===0){return true;}hook_html+='<span class="ticker">'+hook_data.ticker+"</span>";hook_html+=' <span class="change">'+plus_or_minus+percent_change+"%</span>";$this.find(".wrapper").removeClass("increase").removeClass("decrease").addClass(direction);$this.find("a").html(hook_html);});}function _mark_as_loaded(hook_data){$('span.quotecard_hook[data-ticker="'+hook_data.ticker+'"][data-exchange="'+hook_data.exchange+'"]').each(function(){$(this).addClass("loaded").removeClass("loading");});}function _get_quotehook_data($target){return{id:$target.data("naturalid"),type:$target.data("type"),ticker:$target.data("ticker"),exchange:$target.data("exchange")};}function _get_quotecard_data(id){for(var n=0;n<_quote_cache.length;n++){if(_quote_cache[n].id==id){return _quote_cache[n];}}}function _round_to_two_decimals(value){return(Math.round(value*100)/100);}function _reveal($target){var hook_data=_get_quotehook_data($target),quotecard_data=_get_quotecard_data(hook_data.id);if($expanded===null){_init_expanded();}$expanded.data("ticker",hook_data.ticker).data("exchange",hook_data.exchange);if(!_mouse_is_hovering()){return false;}if(!quotecard_data.loaded){$expanded.show().addClass("loading").removeClass("loaded");$expanded.find(".content").hide();_position_card($target);return false;}_render_card_contents(quotecard_data.data);$expanded.removeClass("loading").addClass("loaded").show();_position_card($target);if(forbes.ad_manager){forbes.ad_manager.display([{id:"ticker",sizes:[[120,60]]}]);}forbes.event_tracking.track_ga_event(["Quotecard","CardRevealed",hook_data.exchange+":"+hook_data.ticker]);}function _hide(){$expanded.removeClass("hovering").hide();}function _render_card_contents(data){var content_html="",title=data.name,ticker=data.quotes.results[0].H1,closing_price=data.quotes.results[0].D20,current_price=data.quotes.results[0].D2,stories=data.stories,company_url=data.url,tearsheet_url=company_url+"financial/"+ticker+"/",amount_changed=current_price-closing_price,amount_changed_rounded=_round_to_two_decimals(amount_changed),percent_change=_round_to_two_decimals((amount_changed/closing_price)*100),direction=(current_price>closing_price)?"increase":"decrease",plus_or_minus=(current_price>closing_price)?"+":"",timestamp="As of "+data.quotes.results[0].D782,_articles_ul=null;$container=$(".quotecard_expanded");$container.find("h4 a").attr("href",tearsheet_url).html(title);$container.find("a.ticker").attr("href",tearsheet_url).html(ticker);$container.find(".price").html('<span class="dollar_symbol">$</span>'+current_price);$container.find(".change").removeClass("increase").removeClass("decrease").addClass(direction);$container.find(".amount").html("$"+amount_changed_rounded);$container.find(".percentage").html("("+plus_or_minus+percent_change+"%)");$container.find(".timestamp").html(timestamp);_articles_ul=$container.find(".articles");_articles_ul.empty();for(var i=0;i<stories.length;i++){var story_title=stories[i].title,story_url=stories[i].url,just_published=stories[i].justPublished,type=stories[i].type,advoice_brand=stories[i].advoiceBrand;_articles_ul.append('<li><a href="'+story_url+'">'+story_title+"</a></li>");}$expanded.find(".content").show();$expanded.find("a").each(function(){$(this).unbind("click").on("click",function(e){var $this_link=$(this);if(typeof $this_link.attr("href")!="undefined"&&$this_link.attr("href")!="#"&&$this_link.attr("href").length>1){forbes.event_tracking.track_ga_event(["Quotecard","CardClick",$this_link.attr("href")]);}});});}function _init_expanded(){if($(".quotecard_expanded").length<1){var loading_spinner=imagesBaseCdn+"/assets/img/loading_spinners/43px_grey_on_white.gif";$("body").append('<div class="quotecard_expanded" data-ticker="" data-exchange="" style="display:none;"><div class="wrapper"><div class="loading_spinner"><img src="'+loading_spinner+'" height="16" width="16" alt="" /></div><div class="content"><h4><a></a></h4><a class="ticker"></a><div class="quote"><span class="price"><span class="dollar_symbol">$</span></span> <span class="change"><span class="arrow_icon"></span><span class="amount"></span> <span class="percentage"></span></span></div><span class="timestamp"></span><hr /><ul class="articles"></ul><div class="quotecard_ad_pos_wrapper"><div id="dfp-ticker"></div></div></div></div></div>');$expanded=$(".quotecard_expanded");if($.browser.msie&&parseInt($.browser.version,10)<9){$expanded.addClass("noshadow");}$expanded.on("mouseenter",function(){var $this=$(this);$this.addClass("hovering");});$expanded.on("mouseleave",function(){var $this=$(this);$this.removeClass("hovering");clearTimeout(_mouseleave_timer);_mouseleave_timer=setTimeout(function(){if(!_mouse_is_hovering()){_hide();}},_mouseleave_delay);});}}function _position_card($target){if($expanded===null){return false;}if(($target.offset().top-$(document).scrollTop())>($(window).height()/2)){$expanded.css({display:"block",left:$target.offset().left,top:$target.offset().top-$expanded.outerHeight()-3});$expanded.removeClass("below_anchor");$expanded.addClass("above_anchor");}else{$expanded.css({display:"block",left:$target.offset().left,top:$target.offset().top+15});$expanded.addClass("below_anchor");$expanded.removeClass("above_anchor");}}return{init:_init};}($));return app;}(forbes||{},jQuery));forbes.bootstrap.register_lazy_callback(forbes.quotecard.init);