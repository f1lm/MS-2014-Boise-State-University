define("appkit/utils/emoji_regex",["exports"],function(a){"use strict";var b=/(\ud83c\uddef\ud83c\uddf5|\ud83c\uddf0\ud83c\uddf7|\ud83c\udde9\ud83c\uddea|\ud83c\udde8\ud83c\uddf3|\ud83c\uddfa\ud83c\uddf8|\ud83c\uddeb\ud83c\uddf7|\ud83c\uddea\ud83c\uddf8|\ud83c\uddee\ud83c\uddf9|\ud83c\uddf7\ud83c\uddfa|\ud83c\uddec\ud83c\udde7|\x23([\u20e3])|\x30([\u20e3])|\x31([\u20e3])|\x32([\u20e3])|\x33([\u20e3])|\x34([\u20e3])|\x35([\u20e3])|\x36([\u20e3])|\x37([\u20e3])|\x38([\u20e3])|\x39([\u20e3])|\ud83c([\udc04]|[\udccf]|[\udd70-\udd71]|[\udd7e-\udd7f]|[\udd8e]|[\udd91-\udd9a]|[\udde6-\uddff]|[\ude01-\ude02]|[\ude1a]|[\ude2f]|[\ude32-\ude3a]|[\ude50-\ude51]|[\udf00-\udf20]|[\udf30-\udf35]|[\udf37-\udf7c]|[\udf80-\udf93]|[\udfa0-\udfc4]|[\udfc6-\udfca]|[\udfe0-\udff0])|\ud83d([\udc00-\udc3e]|[\udc40]|[\udc42-\udcf7]|[\udcf9-\udcfc]|[\udd00-\udd3d]|[\udd50-\udd67]|[\uddfb-\ude40]|[\ude45-\ude4f]|[\ude80-\udec5])|[\u2712]|[\u2714]|[\u2716]|[\u2728]|[\u2733-\u2734]|[\u2744]|[\u2747]|[\u274c]|[\u274e]|[\u2753-\u2755]|[\u2757]|[\u2764]|[\u2795-\u2797]|[\u27a1]|[\u27b0]|[\u27bf]|[\u2934-\u2935]|[\u2b05-\u2b07]|[\u2b1b-\u2b1c]|[\u2b50]|[\u2b55]|[\u3030]|[\u303d]|[\u3297]|[\u3299]|[\ue50a]|[\u203c]|[\u2049]|[\u2139]|[\u2194-\u2199]|[\u21a9-\u21aa]|[\u231a-\u231b]|[\u23e9-\u23ec]|[\u23f0]|[\u23f3]|[\u24c2]|[\u25aa-\u25ab]|[\u25b6]|[\u25c0]|[\u25fb-\u25fe]|[\u2600-\u2601]|[\u260e]|[\u2611]|[\u2614-\u2615]|[\u261d]|[\u263a]|[\u2648-\u2653]|[\u2660]|[\u2663]|[\u2665-\u2666]|[\u2668]|[\u267b]|[\u267f]|[\u2693]|[\u26a0-\u26a1]|[\u26aa-\u26ab]|[\u26bd-\u26be]|[\u26c4-\u26c5]|[\u26ce]|[\u26d4]|[\u26ea]|[\u26f2-\u26f3]|[\u26f5]|[\u26fa]|[\u26fd]|[\u2702]|[\u2705]|[\u2708-\u270c]|[\u270f])[\uFE00-\uFE0F]?/g;a["default"]=b}),define("appkit/utils/emojify",["./emoji_regex","exports"],function(a,b){"use strict";function c(a){for(var b=0;b<a.length;b++)if(a.charCodeAt(b)>255)return a.replace(d,'<span class="emoji" data-emoji="$1">$1</span>');return a}var d=a["default"];b["default"]=c}),define("appkit/embed",["./utils/emojify","./player","./loop-tracker","./loop-renderer","./related-videos","./sharing","exports"],function(a,b,c,d,e,f,g){"use strict";function h(a){if(!window.player){var b=window.POST_DATA,c=$(".video-container"),d=$('<video id="video" muted type="video/mp4" preload="auto"></video>').attr({poster:b.thumbnailUrl,src:b.videoUrl}).prependTo(c);$(document.body).one("playerReady",function(b,c,d){j(b,c,d,a)}),window.player=new n({$container:$("body>.embed"),$video:d,$muteButton:$(".mute-button"),$explicit:$(".warning-overlay:visible"),audioEnabled:k("audio=1")})}}function i(){window.player&&!window.player.mobile&&window.player.destroy()}function j(a,b,c,d){b.mobile?$(c).one("canplay",function(){$(document.body).removeClass("play-button-visible")}):(d||!$(document.body).hasClass("play-button-visible")&&!b.options.$explicit.length)&&b.play(),window.loaded||(window.parent.postMessage("loaded::"+window.location.href,"*"),window.loaded=!0),window.RELATED_VIDEO_DATA&&window.RELATED_VIDEO_DATA.length&&$(".video-container").width()>=375&&!k("related=0")&&(window.relatedVideos||(window.relatedVideos=new q(b.mobile)),b.showRelatedVideos=window.mostlyInView,b.showRelatedVideos||$(document.body).one("mostlyInView",function(){b.showRelatedVideos=!0}));var e=new o(c,window.POST_DATA.postIdStr,$(".loop-count"));window.hostScriptPresent?e.canRecordLoops=!0:$(document.body).stickyEventListener("hostScriptDetected",function(){e.canRecordLoops=!0})}function k(a){return new RegExp("\\?(.*&|)"+a+"(&|$)","g").test(window.location.href)}function l(){var a,b=Math.floor((new Date).getTime()-s.getTime())/1e3,c=b;return 1>b?"Now":(60>b?a="seconds":3600>b?(c=Math.floor(b/60),a="minute"):86400>b?(c=Math.floor(b/60/60),a="hour"):2678400>b?(c=Math.floor(b/60/60/24),a="day"):31536e3>b?(c=Math.floor(b/60/60/24/30),a="month"):(c=Math.floor(b/60/60/24/365),a="year"),c+" "+a+(1!==c?"s":"")+" ago")}var m=a["default"],n=b["default"],o=c["default"],p=d["default"],q=e["default"],r=f["default"];!function(){var a=[];$.fn.extend({stickyEventListener:function(b,c){var d=("data-fired-"+b).toLowerCase();this[0].hasAttribute(d)?c?c.apply(this[0],a[parseInt(this[0].getAttribute(d),10)]):null:$(this).one(b,function(){a.push(Array.prototype.slice.call(arguments,this)),this.setAttribute(d,a.length-1),c?c.apply(this,a[a.length-1]):null})}})}(),$(document.body).stickyEventListener("hostScriptDetected"),$(document.body).stickyEventListener("hostScriptTimeout"),function(){function a(){c++===b&&$(document.body).trigger("hostScriptTimeout"),window.parent.postMessage("ping::"+window.location.href,"*"),d||setTimeout(a,100)}var b=10,c=0,d=!1;a(),$(document.body).stickyEventListener("hostScriptDetected",function(){d=!0})}(),$(document.body).stickyEventListener("hostScriptTimeout",function(){$(document.body).addClass("play-button-visible").one("click",function(){h(!0)}),window.mostlyInView=!0}),window.history.length>1&&/fromRelatedVideo/.test(window.location.href)&&($(document.body).addClass("has-history"),$(".back-button").click(function(){window.history.back()}));var s=new Date(1e3*parseInt(window.POST_DATA.created,10));$(".post-metadata .time").html(l(s));var t;$(window).on("resize",function(){var a=Math.min($("body>.embed").width(),$(window).height());if("simple"===window.EMBED_TYPE)$("body>.embed").height(a);else{$(".video-wrapper").height(a);var b=$("body>.embed").height()+2;t||(t=!0,window.parent.postMessage("height::"+window.location.href+"::"+b,"*"))}$("body>.embed").css({width:a})}).resize(),$(".embed").mouseenter(function(){$(document.body).addClass("embed-hover")}).mouseleave(function(){$(document.body).removeClass("embed-hover"),$(document.body).removeClass("related-videos-collapsed")});var u=$(".description").html();r(window.POST_DATA.shareUrl,(u||"").trim()),u&&$(".description").html(m(u)),new p($(".loop-count")),window[window.addEventListener?"addEventListener":"attachEvent"]("message",function(a){switch(a.data){case"scrolledInToView":$(document.body).addClass("in-viewport"),h();break;case"scrolledOutOfView":$(document.body).removeClass("in-viewport"),i();break;case"mute":player.mute();break;case"unmute":player.unmute();break;case"pong":$(document.body).trigger("hostScriptDetected");break;case"mostlyInView":window.mostlyInView=!0,$(document.body).trigger("mostlyInView")}}),g["default"]=function(){}}),define("appkit/loop-renderer",["exports"],function(a){"use strict";function b(a){this.el=a,this.count=parseInt(a.attr("data-count"),10),this.velocity=parseInt(a.attr("data-velocity"),10),this.asOfTime=Date.now(),a.on("looped",function(){this.count++,this.render()}.bind(this)),setInterval(this.updateCounts.bind(this),1e3/d)}function c(a){return Math.round(a).toString().replace(e,",")}var d=.5,e=new RegExp("\\B(?=(\\d{3})+(?!\\d))","g");b.prototype.updateCounts=function(){var a=Date.now(),b=(a-this.asOfTime)/1e3;this.count+=b*this.velocity,this.asOfTime=a,this.render()},b.prototype.render=function(){var a=""+c(this.count),b=this.el.find(".counter"),d=b.find(".spinner");b.hasClass("seeded")&&b.empty().removeClass("seeded");var e=a.length-d.length;if(0>e)d.slice(0,Math.abs(e)).remove();else for(;e--;)this.createDigit(b);$(b).find(".spinner").toArray().forEach(function(b,c){b.className=","===a[c]?"spinner comma":"spinner digit-"+a[c]})},b.prototype.createDigit=function(){for(var a=-1,b=$('<div class="spinner"></div>').appendTo(this.el.find(".counter"));a++<9;)b.append("<div>"+a+"</div>");b.append("<div>,</div>")},a["default"]=b}),define("appkit/loop-tracker",["exports"],function(a){"use strict";function b(a,b,c){var d=.5,e=!1;a.addEventListener("ended",function(){e=!1}),a.addEventListener("timeupdate",function(){!e&&a.currentTime>d&&(this.recordLoop(),e=!0)}.bind(this)),window.onunload=function(){this.flush(!0)}.bind(this),this.unsentLoops=0,this.flushCount=0,this.lastLoopTime=0,this.enabled=1,this.recordLoop=function(){if(this.enabled&&this.canRecordLoops){c&&c.trigger("looped");var a=Date.now();if(a-this.lastLoopTime<2e3)return void(this.enabled=0);this.lastLoopTime=a,this.unsentLoops++,this.flush()}},this.flush=function(a){if(!(this.flushCount>2||0==this.unsentLoops||!a&&this.unsentLoops<Math.pow(2,this.flushCount))){var c=this.unsentLoops;this.unsentLoops=0,this.flushCount++;var d=this.generateRequestId();$.ajax({url:"/api/loops",async:!a,type:"post",headers:{"X-Vine-Client":window.VINE_CLIENT,"X-Request-Id":d},contentType:"application/json",data:JSON.stringify({loops:[{postId:b,count:c,ts:Date.now()/1e3}]})})}},this.generateRequestId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})}}a["default"]=b}),define("appkit/player",["./tracking","exports"],function(a,b){"use strict";function c(a){this.options=a,this.hasEmbedScript=!1,this.showRelatedVideos=!1,this.android=/android/i.test(navigator.userAgent),this.ipad=/ipad/i.test(navigator.userAgent),this.ios=this.ipad||/iphone|ipod/i.test(navigator.userAgent),this.windowsPhone=/Windows Phone/i.test(navigator.userAgent),this.mobile=this.ios||this.android||this.windowsPhone||/blackberry|mini|palm/i.test(navigator.userAgent),this.mobile||a.$container.addClass("not-mobile"),this.setupMuteButton(),this.bindEvents(),this.createMediaElement()}var d=a["default"];c.prototype.setupMuteButton=function(){(this.ios||this.android||this.windowsPhone)&&this.options.$muteButton.hide(),this.shouldMute=!(this.options.$muteButton.is(":visible")&&this.options.audioEnabled),this.shouldMute?this.options.$muteButton.addClass("muted"):this.options.$muteButton.removeClass("muted")},c.prototype.createMediaElement=function(){var a=Math.min(this.options.$container.width(),$(window).height()),b=this.options.$video.attr("src"),c={defaultVideoWidth:a,defaultVideoHeight:a,videoWidth:a,videoHeight:a,features:[],plugins:["flash"],pluginPath:"/assets/swf/",enablePluginSmoothing:!0,flashName:"flashmediaelement.2.swf",success:function(a){this.mediaEl=a;var c=$(document.body);a.addEventListener("ended",function(){a.setCurrentTime(0),a.play(),this.showRelatedVideos&&(c.hasClass("related-videos-opened")||c.find(">.embed").hasClass("share-open")||(c.addClass(0===window.VINE_CLIENT.indexOf("tw_web")?"related-videos-opened related-videos-open":"related-videos-opened related-videos-collapsed"),d.relatedVideoEvent("impression",{nonInteraction:!0,mobile:this.mobile})))}.bind(this)),$(window).on("webkitendfullscreen",function(){this.pause()}.bind(this)),(this.ipad||this.android)&&this.options.$video.attr("controls","controls"),a.setSrc([{src:b,type:"video/mp4"}]),this.$pauseTarget=$(".embed, .card"),this.$pauseTarget.on("click","#video, .me-plugin, .bottom-shade, .content-creator.simple",function(b){$(b.currentTarget).is(".content-creator.simple")&&b.target!==b.currentTarget||(b.preventDefault(),b.stopPropagation(),a.paused?this.play():this.pause())}.bind(this));var e=this.options.$explicit;e.length&&e.find("button").click(function(){e.hide(),this.play()}.bind(this)),c.trigger("playerReady",[this,a])}.bind(this),error:function(a){console.log("Player initialization failed.",a)}};new window.MediaElement(this.options.$video[0],c)},c.prototype.destroy=function(){this.unbindEvents(),$("#video, .me-plugin").remove(),delete window.player},c.prototype.bindEvents=function(){this.options.$muteButton.click(function(){this.mediaEl.muted?this.unmute():this.mute()}.bind(this)),$(".play-button").click(function(){this.play()}.bind(this))},c.prototype.unbindEvents=function(){this.options.$muteButton.add(this.$pauseTarget).add($(".play-button")).add($(".warning-overlay")).unbind("click"),$(window).unbind("webkitendfullscreen")},c.prototype.play=function(){$(document.body).removeClass("play-button-visible"),this.mediaEl.setMuted(this.shouldMute?!0:!1),this.mediaEl&&this.mediaEl.paused&&(this.mediaEl.play(),this.addCanPlayListener())},c.prototype.addCanPlayListener=function(){this.canPlayListenerAdded||(this.mediaEl.addEventListener("canplay",function(){this.mediaEl.setMuted(this.shouldMute),this.mediaEl.play()}.bind(this)),this.canPlayListenerAdded=!0)},c.prototype.pause=function(){$(document.body).addClass("play-button-visible"),this.mediaEl&&this.mediaEl.pause()},c.prototype.mute=function(){this.shouldMute=!0,this.options.$muteButton.addClass("muted"),this.mediaEl&&this.mediaEl.setMuted(this.shouldMute)},c.prototype.unmute=function(){this.shouldMute=!1,this.options.$muteButton.removeClass("muted"),parent.postMessage("unmute::"+location.href,"*"),this.mediaEl&&(this.mediaEl.setMuted(this.shouldMute),this.mediaEl.setCurrentTime(0))},b["default"]=c}),define("appkit/related-videos",["./tracking","exports"],function(a,b){"use strict";function c(a){var b=this;this.mediaElementShims={},window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),a||$(".related-videos").on("mouseenter",".related-video:not(.load-more)",function(){var a=$('<video src="'+$(this).attr("data-videoUrl")+'" poster="'+$(this).attr("data-thumbnailUrl")+'"></video>').appendTo(this);b.createPlayer(a,function(a){a.play()})}).on("mouseleave",".related-video:not(.load-more)",function(){$(this).find("video, .me-plugin").remove()}),$(".related-videos").on("click",".related-video:not(.load-more)",function(){d.relatedVideoEvent("click",{label:$(this).attr("data-index"),mobile:a});var b=window.location.origin+"/v/"+$(this).attr("data-postId");if(/\/embed/.test(window.location.href))b+="/embed/"+window.EMBED_TYPE+"?"+$.param({fromRelatedVideo:!0,audio:window.player.mediaEl.muted?0:1});else{if(!/\/card/.test(window.location.href))return;b+="/card?"+$.param({audio:window.player.mediaEl.muted?0:1})}window.location.href=b}),$(".related-videos .load-more").click(function(){d.relatedVideoEvent("load more"),this.injectVideos()}.bind(this)),$(".related-videos-header").click(function(){var b=$(document.body).hasClass("related-videos-open")?"collapse":"expand";d.relatedVideoEvent(b,{mobile:a}),$(document.body).toggleClass("related-videos-open")}),this.data=window.RELATED_VIDEO_DATA.map(function(a){return a.videoUrl=a.videoUrl.replace(/^http:/,"https:"),a.thumbnailUrl=a.thumbnailUrl.replace(/^http:/,"https:"),a}),this.currentIdx=0,this.injectVideos()}var d=a["default"];c.prototype.injectVideos=function(){var a=[];$(".related-videos").find(">div:not(.load-more)").remove();for(var b=0;b<this.numberToShow();b++)a.push(this.data[this.currentIdx++]),this.currentIdx===this.data.length-1&&(this.currentIdx=0);a.reverse(),a.forEach(function(a){var b=$('<img class="thumbnail">').attr("src",a.thumbnailUrl),c=$('<div class="related-video"></div>').append(b);c.attr({"data-postId":a.shortId,"data-videoUrl":a.videoUrl,"data-thumbnailUrl":a.thumbnailUrl,"data-index":a.index}),$(".related-videos").prepend(c)}),this.sizeRelatedVideos()},c.prototype.numberToShow=function(){var a=$(".video-container").width(),b=100,c=20;return Math.floor(a/(b+c))-1},c.prototype.sizeRelatedVideos=function(){var a=$(".related-videos .related-video:not(.hidden):not(.load-more)"),b=a.length,c=20,d=100,e=$(".video-container").width(),f=(e-2*c-d*(b+1))/b;a.css("marginRight",f)},c.prototype.createPlayer=function(a,b){var c=a.parent().width(),d=a.attr("src"),e={defaultVideoWidth:c,defaultVideoHeight:c,videoWidth:c,videoHeight:c,features:[],plugins:["flash"],pluginPath:"/assets/swf/",enablePluginSmoothing:!0,flashName:"flashmediaelement.2.swf",success:function(a){a.addEventListener("ended",function(){a.setCurrentTime(0),a.play()}),a.setSrc([{src:d,type:"video/mp4"}]),a.setMuted(!0),b(a)}};new window.MediaElement(a.get(0),e)},b["default"]=c}),define("appkit/sharing",["exports"],function(a){"use strict";function b(a,b){var c=!1;$("button.share, .share-close").click(function(){c=!c,$(document.body).toggleClass("share-open",c)}),$(document.body).click(function(a){c&&0===$(a.target).closest(".badges, button.share").length&&$(".share-close").click()});var f=$(".embed-share-overlay .badges").get(0).cloneNode(!0),g=$(".embed-share-overlay .share-url").get(0).cloneNode(!0);$(".tr-quadrant").append(f).append(g),$(".embed-share-overlay").on("click",".share-badge",function(){window._gaq.push(["_trackEvent","Share",this.className.replace(/share-badge/,"").trim(),"Embed"])}),d(a),e(a,b)}function c(a){var b=a/1e3;if(1>b)return a;if(10>b){var c=a+"";return[c.substr(0,1),c.substr(1,3)].join(",")}return Math.floor(10*b)/10+"K"}function d(a){$.get("https://graph.facebook.com/?ids="+a,function(b){b&&b[a]&&b[a].shares&&$(".share-badge.facebook .count").html(c(b[a].shares))}),$.get("https://cdn.api.twitter.com/1/urls/count.json?url="+a,function(a){a&&a.count&&$(".share-badge.twitter .count").html(c(a.count))},"jsonp")}function e(a,b){b&&b.length>116&&(b=b.substr(0,115).trim()+"…");var c={url:a,text:b,related:"vine",via:"vine"},d={embed:a,caption:b};$(".share-badge.twitter").click(function(a){a.preventDefault();var b=550,d=380,e="https://twitter.com/share?"+$.param(c),f=window.open(e,"tweetWindow","width="+b+",height="+d);f.moveTo((screen.width-b)/2,(screen.height-d)/2)}),$(".share-badge.facebook").click(function(b){b.preventDefault();var c=670,d=350,e="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(a),f=window.open(e,"tweetWindow","width="+c+",height="+d);f.moveTo((screen.width-c)/2,(screen.height-d)/2)}),$(".share-badge.tumblr").click(function(a){a.preventDefault();var b=550,c=380,e="http://www.tumblr.com/share/video?"+$.param(d),f=window.open(e,"tumblrWindow","width="+b+",height="+c);f.moveTo((screen.width-b)/2,(screen.height-c)/2)})}a["default"]=b}),define("appkit/tracking",["exports"],function(a){"use strict";function b(a,b){b=b||{},b.mobile&&(a+="Mobile"),window._gaq.push(["_trackEvent","Related Videos",a,b.label,b.value,!!b.nonInteraction])}a["default"]={relatedVideoEvent:b}});