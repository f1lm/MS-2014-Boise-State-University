YUI.add("squarespace-audio-player",function(b){var g=b.namespace("Squarespace.Widgets").AudioPlayer=b.Base.create("audioPlayer",b.Squarespace.Widgets.SSWidget,[],{initializer:function(a){a=this.get("render");b.Lang.isBoolean(a)?a=null:b.Lang.isString(a)&&(a=b.one(a));a&&(a._audioPlayer&&a._audioPlayer.destroy(),a._audioPlayer=this,b.Object.each(a.getData(),function(a,c){a&&this.set(c,a)},this))},destructor:function(){this._audio&&(this.stop(),this._audio.destroy())},renderUI:function(){g.superclass.renderUI.apply(this,
arguments);var a=this.get("boundingBox"),d=a.one(".placeholder"),c=this.get("title"),f=this.get("author");c&&f?d.setContent(b.Node.create('<div class="wrapper"><div class="audio-author">'+f+'</div><div class="audio-title">'+c+"</div></div>")):c?d.setContent(b.Node.create('<div class="wrapper"><div class="audio-title">'+c+"</div></div>")):d.setContent(b.Node.create('<div class="wrapper">'+this.get("strings.placeholder")+"</div>"));"true"===this.get("show-download")&&(d='<div class="download"><a href="'+
b.Squarespace.UrlUtils.addQueryParam(this.get("url"),"download","true")+'" target="_blank">Download</a></div>',this.get("contentBox").append(d),a.addClass("download"));a.one(".progress-inner").setStyle("width","0px");d=this._volumeNode=a.one(".volume");if(!d)throw this.name+": No div.volume in template.";for(c=this.get("volumeLevels");0<c;c--)d.prepend('<div class="bar level-"'+c+'" data-volume-level="'+c+'"></div>');a.one(".duration").setContent(this.get("strings.durationPlaceHolder"))},bindUI:function(){var a=
this.get("id");this.get("boundingBox").on(a+"|click",this._onClick,this);this.after(a+"|volumeChange",function(a){this._setVolume(a.newVal)},this);this.after(a+"|playStateChange",this._uiUpdateWrapperClass,this);this.after(a+"|readyStateChange",this._afterReadyStateChange,this);this.after(a+"|disabledChange",function(a){a.newVal&&this.stop()},this);b.on(a+"|audioPlayer:stopAll",function(a){var c=a?a.container:null;c&&b.Lang.isString(c)&&(c=b.one(c));(!a||!a.hasOwnProperty("container")||c instanceof
b.Node&&c.contains(this.get("boundingBox")))&&this.stop()},this);this.get("boundingBox").plug(b.Squarespace.NodeDestroyNotifier,{onDestroy:this.destroy,context:this})},syncUI:function(){this._uiUpdateWrapperClass();this._uiUpdateVolumeLevel();var a=this.get("boundingBox");a.toggleClass("tiny",300>a.get("offsetWidth"))},play:function(){var a=this.getProperty("PLAY_STATES");this._audio?this.get("playState")!==a.PLAYING&&this._audio.play():(this._registerTrack(),this._audio.play());this._set("playState",
a.PLAYING)},pause:function(){this._audio&&this._audio.pause()},stop:function(){var a=this.get("playState"),b=this.getProperty("PLAY_STATES");a===b.PLAYING&&this._audio&&this._audio.pause()},seek:function(a){100<a||0>a?console.warn(this.name+": seek() - Percentage between 0-100 required."):(this._audio||(this._registerTrack(),this.play()),this._audio.seek(this.get("trueDuration")*(a/100)))},setVolume:function(a){this.set("volume",a)},_setVolume:function(a){this._audio&&b.Squarespace.Singletons.Audio.set("volume",
a/100);this._set("volume",a);this._uiUpdateVolumeLevel()},_setVolumeLevel:function(a){this._setVolume(Math.round(100*(a/this.get("volumeLevels"))))},_registerTrack:function(){if(!this._audio){var a=this.get("boundingBox"),d=this.get("fixedUrl");a.addClass("loading");if(!d){this._showError("No URL provided.");return}this._audio=b.Squarespace.Singletons.Audio.register({url:d,pause:b.bind(this._onPause,this),ended:b.bind(this._onStop,this),playing:b.bind(this._onWhilePlaying,this),ready:b.bind(this._onLoad,
this)});return!!this._audio}return!1},_uiUpdateVolumeLevel:function(){var a=this._volumeNode.get("children"),b=this.get("volumeLevels"),c=this.get("volume"),f=Math.round(c/100*b);a.each(function(a){parseInt(a.getAttribute("data-volume-level"),10)<=f?a.addClass("active"):a.removeClass("active")},this)},_uiUpdateWrapperClass:function(){var a=this.getProperty("READY_STATES"),b=this.getProperty("PLAY_STATES"),c=this.get("boundingBox"),f=c.getAttribute("class").split(" "),e;for(e in b)f.remove("play-state-"+
b[e]);for(e in a)f.remove("ready-state-"+a[e]);c.addClass("ready-state-"+this.get("readyState"));c.setAttribute("class",f.join(" ")).addClass("play-state-"+this.get("playState")).addClass("ready-state-"+this.get("readyState"))},_onClick:function(a){if(b.UA.ios)window.location.href=this.get("url");else if(!a.target.ancestor().hasClass("download")&&(a.halt(),a.stopImmediatePropagation(),!this.get("disabled")&&!a.target.hasClass("duration")))if(a.target.ancestor(".volume"))this._setVolumeLevel(parseInt(a.target.getAttribute("data-volume-level"),
10));else if(a.target.ancestor(".placeholder",!0))this.play();else{if(a.target.ancestor(".controls",!0)){a=this.get("playState");var d=this.getProperty("PLAY_STATES");switch(a){case d.PLAYING:this.pause();return;case d.PAUSED:case d.STOPPED:this.play();return;default:console.warn(this.name+": Wait, what? How did you get here? Case was ",a);return}}d=this.get("boundingBox").one(".progress").get("region");a.pageX>=d.left&&a.pageX<=d.right&&this.seek(100*((a.pageX-d.left)/d.width))}},_afterReadyStateChange:function(a){a=
this.getProperty("READY_STATES");var b=this.get("readyState"),c=this.get("strings"),f=!1;switch(b){case a.INITIALIZED:this.enable();break;case a.FLASH_BLOCKED:f=c.soundManagerFlashFail;break;case a.SECURITY_ERROR:f=c.soundManagerSecurityFail;this._reportAudioError(a.SECURITY_ERROR);break;case a.SOUND_LOAD_FAILED:f=c.soundManagerURLFail;this._reportAudioError(a.SOUND_LOAD_FAILED);break;case a.SOUND_LOADED:break;default:console.warn(this.name+": Invalid ready state ("+b+").")}f&&(console.warn("AUDIO ERROR: "+
f),this._showError(f),this.disable());this._uiUpdateWrapperClass()},_reportAudioError:function(a){try{var d=this.get("url");0<d.indexOf("static.squarespace.com")&&b.Squarespace.Analytics.trackInternal("system_audio_play_error",{readyState:this.get("readyState"),url:d})}catch(c){}},_getPlaytimeString:function(a){if(!this._audio)return this.get("strings.durationPlaceHolder");var b="0:00",c="0:00",b=this._getMinSecString(this.get("trueDuration"));a&&(c=this._getMinSecString(a));return c+" / "+b},_getMinSecString:function(a){return b.Squarespace.DateUtils.humanizeDuration(a)},
_showError:function(a){this.get("boundingBox").addClass("error");this.get("boundingBox").one(".placeholder").setContent("Error: "+a)},_onWhilePlaying:function(a){if(!this.get("destroyed")&&a.isTarget){var b=this.get("boundingBox");b.one(".duration").setContent(this._getPlaytimeString(a.position));if(this._audio.get("duration")){var c=this.getProperty("READY_STATES");this.get("readyState")!==c.SOUND_LOADED&&this._set("readyState",c.SOUND_LOADED);c=b.one(".progress-inner");a=100*(a.position/this.get("trueDuration"));
b.removeClass("loading");c&&c.setStyle("width",a+"%")}}},_onStop:function(a){this._set("playState",this.getProperty("PLAY_STATES").STOPPED)},_onPause:function(){this._set("playState",this.getProperty("PLAY_STATES").PAUSED)},_onDataError:function(){this.stop();this._set("playState",this.getProperty("PLAY_STATES").STOPPED)},_onLoad:function(a){a||(this._loadFailTimer=b.later(1E4,this,function(){this.stop();this._set("readyState",this.getProperty("READY_STATES").SOUND_LOAD_FAILED)}))}},{CSS_PREFIX:"sqs-audio-player",
PLAY_STATES:{PLAYING:"playing",PAUSED:"paused",STOPPED:"stopped"},READY_STATES:{INITIALIZED:"initialized",FLASH_BLOCKED:"flash-blocked",SECURITY_ERROR:"security-error",SOUND_LOAD_FAILED:"sound-load-failed",SOUND_LOADED:"sound-loaded"},TEMPLATE:'<div class="controls"></div><div class="placeholder"></div><div class="progress"><div class="progress-inner"><div class="scrubber"></div></div></div><div class="duration"></div><div class="volume"></div>',ATTRS:{strings:{value:{placeholder:"Click to play...",
durationPlaceHolder:"0:00 / 0:00",loadFail:"Unable to load sound at the URL",soundManagerFlashFail:"Sorry, could not load because flash is blocked.",soundManagerSecurityFail:"Sorry, there was a JavaScript security error.",soundManagerURLFail:"Unable to access audio stream."}},fixedUrl:{getter:function(){var a=this.get("url");0<a.indexOf(Static.SQUARESPACE_CONTEXT.appDomain)&&(a=a.replace(/^(http:\/\/|https:\/\/|\/\/)/i,window.location.protocol+"//"));return a},readOnly:!0},trueDuration:{getter:function(){var a=
this.get("duration-in-ms");return b.Lang.isString(a)&&""!==a?a:this._audio.get("duration")}},playState:{lazyAdd:!1,valueFn:function(){return this.getProperty("PLAY_STATES").STOPPED},readOnly:!0},readyState:{lazyAdd:!1,valueFn:function(){return this.getProperty("READY_STATES").INITIALIZED},readOnly:!0},url:{value:null},volume:{validator:function(a){(0>a||100<a)&&console.warn(this.name+": Volume must be between 0 and 100, volume remains unchanged.");return!0},value:66},volumeLevels:{value:6,writeOnce:"initOnly"},
stopOthersOnPlay:{value:!0},render:{value:!0}}});b.config.win.Squarespace.onInitialize(b,function(){b.all(".sqs-audio-embed").each(function(a){if(!(0<a.get("children").size())&&!b.Widget.getByNode(a.one("."+b.Squarespace.Widgets.AudioPlayer.CSS_PREFIX)))switch(b.Object.getValue(a.getData(),"design-style")||"minimal"){case "legacy":new b.Squarespace.Widgets.AudioPlayer({render:a});break;default:new b.Squarespace.Widgets.AudioPlayerMinimal({render:a})}})})},"1.0",{requires:"node event squarespace-audio squarespace-date-utils squarespace-dombuilder squarespace-ss-widget squarespace-album-player squarespace-album-block-player squarespace-url-utils squarespace-widgets-audio-player".split(" ")});
YUI.add("squarespace-audio",function(b){var g=function(){},a={timeupdate:"playing",loadstart:"load",loadeddata:"ready",pause:"pause",ended:"ended"},d=b.Base.create("track",b.Base,[],{initializer:function(){this.LOG=new b.Squarespace.Debugger({name:this.name,output:!1});this.publish("play");this.publish("pause");this.publish("seek")},play:function(){this.fire("play",{track:this})},pause:function(){this.fire("pause",{track:this})},seek:function(a){this.fire("seek",{track:this,position:a})},notify:function(c,
f,e){var d=a[c.type];b.Lang.isValue(d)||this.LOG.warn("Event type caught, but not mapped.",c.type,d);var g=this.get(d);c=b.merge(c,{type:d,target:f,isTarget:f===this});c.isTarget&&(c.position=1E3*e.currentTime);"load"===d&&!c.isTarget&&this.get("pause")(c);"ready"===d&&c.isTarget&&this._updateDuration(e.duration);g(c)},_updateDuration:function(a){isNaN(a)&&(a=0);this.set("duration",1E3*a)}},{ATTRS:{url:{validator:b.Squarespace.AttrValidators.isNullOrString},duration:{value:0,validator:b.Squarespace.AttrValidators.isNumber},
playing:{value:g,validator:b.Squarespace.AttrValidators.isFunction},pause:{value:g,validator:b.Squarespace.AttrValidators.isFunction},load:{value:g,validator:b.Squarespace.AttrValidators.isFunction},ended:{value:g,validator:b.Squarespace.AttrValidators.isFunction},ready:{value:g,validator:b.Squarespace.AttrValidators.isFunction}}}),g=b.Base.create("audio",b.Base,[],{initializer:function(){this.LOG=new b.Squarespace.Debugger({name:this.name,output:!1});this._tracks={};this._trackEvents={};this._bindAudioEvents()},
destructor:function(){var c=this.get("audio"),f=b.Object.keys(a),e=this._notify.bind(this);b.Object.each(f,function(a){this.removeEventListener(a,e)},c);b.one(c).remove(!0)},play:function(a){b.Lang.isValue(a)?url=a.get("url"):(this.LOG.warn("`deliver` called with no track, stopping playback."),url="");a=this.get("audio");a.src=url;a.load();var f=function(){var a=this.get("audio");a.play();a.removeEventListener("loadstart",f)}.bind(this);a.addEventListener("loadstart",f)},pause:function(){this.get("audio").pause()},
stop:function(){throw Error("You can't stop the funk.");},register:function(a){if(!b.Lang.isValue(a.url))return this.LOG.warn("`register` called with no url, ignoring."),null;var f=this._tracks[a.url];b.Lang.isValue(f)&&(this.LOG.warn("This source has already been registered, cleaning.",a.url),this.remove(f));f=new d(a);this._tracks[a.url]=f;this._bindTrackEvents(f);return f},remove:function(a){b.Array.invoke(this._trackEvents[a.url],"detach");delete this._tracks[a.url]},_notify:function(a){var f=
this.get("audio"),e=this._tracks[f.currentSrc];b.Object.each(this._tracks,function(b){b.notify(a,e,f)})},_bindAudioEvents:function(){var c=b.Object.keys(a),f=this._notify.bind(this);b.Array.each(c,function(a){this.addEventListener(a,f)},this.get("audio"))},_bindTrackEvents:function(a){this._trackEvents[a.get("url")]=[a.on("play",this._playTrack,this),a.on("pause",this.pause,this),a.on("seek",this._seekTrack,this),a.on("destroy",this._removeTrack,this)]},_playTrack:function(a){this.play(a.track)},
_seekTrack:function(a){this.get("audio").currentTime=a.position/1E3},_removeTrack:function(a){this.remove(a.target)}},{ATTRS:{audio:{valueFn:function(){return b.Node.create('<audio id="the-funk"></audio>').getDOMNode()},readOnly:!0,writeOnce:!0},volume:{getter:function(){return this.get("audio").volume},setter:function(a){if(!b.Lang.isValue(a)||0>a||1<a)this.LOG.warn("Volume must be between 0 and 1. Normalizing."),a=1;return this.get("audio").volume=a}}}});b.namespace("Squarespace.Singletons");b.Lang.isValue(b.Squarespace.Singletons.Audio)||
(b.Squarespace.Singletons.Audio=new g);b.config.win.Squarespace.onDestroy(b,b.bind(function(a){a.destroy()},b,b.Squarespace.Singletons.Audio))},"1.0",{requires:["base","event","node","squarespace-attr-validators","squarespace-debugger"]});
YUI.add("squarespace-album-player",function(b){function g(){b.Array.each(a,function(a){b.Lang.isFunction(a.adjustAlbumImage)&&a.adjustAlbumImage()})}var a=[],d=!1,c=b.namespace("Squarespace.Widgets").AlbumPlayer=b.Base.create("albumPlayer",b.Squarespace.Widgets.SSWidget,[],{initializer:function(){this.playingTrackPosition=0},render:function(){a.push(this);c.superclass.render.apply(this,arguments)},renderUI:function(){this.playerNode=this.get("contentBox");this.albumImage=this.playerNode.one(".album-cover img");
this.adjustAlbumImage();d?g():(d=!0,b.one("window").on("resize",g));this.trackListNode=this.playerNode.one(".tracks");this.tracksNode=this.trackListNode.all(".track");this.numberOfTracks=this.tracksNode.size();this.controlsNode=this.playerNode.one(".album-controls");this.timerNode=this.playerNode.one(".timer");this.volumeBarNode=this.playerNode.one(".volume-bar");this.artistNameNode=this.playerNode.one(".now-playing .track-info .artist");this.trackTitleNode=this.playerNode.one(".now-playing .track-info .title");
this.setupUniversalPlaybarIfExists();this.setupAudioFiles()},adjustAlbumImage:function(){if(!this.get("destroyed")){this.updateSizeClasses();var a=this.get("contentBox");this.albumImage&&ImageLoader.load(this.albumImage,{load:!0});a.hasClass("loading")&&a.removeClass("loading")}},updateSizeClasses:function(){if(!this.get("destroyed")){var a=this.get("contentBox"),b=a.getComputedStyle("width"),b=parseInt(b,10);800>b?a.addClass("tablet"):a.removeClass("tablet");480>b?a.addClass("phone"):a.removeClass("phone")}},
setupUniversalPlaybarIfExists:function(){this.playerNode.one(".now-playing")&&(this.set("hasUniversalPlaybar",!0),this.timeBarNode=this.playerNode.one(".universal-progress.track-progress-bar"),this.loadingBarNode=this.timeBarNode.one(".load-bar"),this.playingBarNode=this.timeBarNode.one(".play-bar"),this.durationNode=this.playerNode.one(".timers .duration"),this.elapsedNode=this.playerNode.one(".timers .elapsed"),this._registerEvent(b.Squarespace.Utils.onPointerAction(this.timeBarNode,this.onTimebarClick,
this,null)))},bindUI:function(){var a=this.get("contentBox");this._registerEvent(a.delegate("click",this.onPlayButtonClick,this.get("playButton"),this),a.delegate("click",this.onPauseButtonClick,this.get("pauseButton",this)),a.delegate("click",this.onPlayPauseButtonClick,this.get("playPauseButton"),this),a.delegate("click",this.onStopButtonClick,this.get("stopButton"),this),a.delegate("click",this.onPrevButtonClick,this.get("prevButton"),this),a.delegate("click",this.onNextButtonClick,this.get("nextButton"),
this),a.delegate("click",this.onVolumeBarClick,this.get("volumeBar"),this))},onPlayPauseButtonClick:function(a){a.halt();this.get("currentTrack")||this.setCurrentTrackByKey(0,!0);this.isTrackPlaying()?(this.pausePlayer(),this._pausedTime=this.playingTrackPosition):this.playCurrentTrack()},onPlayButtonClick:function(a){a.halt();this.get("currentTrack")||this.setCurrentTrackByKey(0,!0);this.isTrackPlaying()||this.playCurrentTrack()},onPauseButtonClick:function(a){a.halt();this.pausePlayer()},onStopButtonClick:function(a){a.halt();
this._pausedTime=null;this.stopPlayBarAndTimer();this.get("currentTrack").audio.pause();this.playerNode.addClass("paused").removeClass("playing")},onPrevButtonClick:function(a){a.halt();this._pausedTime=null;a=this.get("currentTrack").index;0<a&&a--;this.setCurrentTrackByKey(a)},onNextButtonClick:function(a){a.halt();this._pausedTime=null;a=this.get("currentTrack").index;a!==this.numberOfTracks-1&&a++;this.setCurrentTrackByKey(a)},onVolumeBarClick:function(a){a.halt();var c=this.volumeBarNode.getX(),
d=parseInt(this.volumeBarNode.getComputedStyle("width"),10);b.Squarespace.Singletons.Audio.set("volume",100*((a.clientX-c)/d)/100)},setCurrentTrackByKey:function(a,b){this.setCurrentTrack(this.get("trackArray")[a],b)},toggleTimerFunction:function(a){a.halt();this.countingDown.set(!this.countingDown)},setupAudioFiles:function(){var a=this.tracksNode.size();this.tracksNode.each(function(b,c){this.setupAudioTrack(b,c);c+1===a&&this.setCurrentTrackByKey(0,!0)},this)},setupAudioTrack:function(a,b){var c=
a.getAttribute("id"),d=a.one(".link").getAttribute("href"),d=-1!==d.indexOf("?")?d+("&"+c):d+("?"+c),c={artist:a.getData("artist"),title:a.getData("title"),src:d,index:b,domNode:a,duration:a.getData("duration"),hasTimebar:!1};c.audio=this._registerTrack(c);this.setupTrackTimeCnnr(c);this.get("trackArray").push(c);this.bindTrackLink(c);return c},parseTrackFromHash:function(){var a=b.QueryString.parse(window.location.hash.replace("#","")).track,a=parseInt(a,10);return b.Lang.isNumber(a)?a:0},setupTrackTimeCnnr:function(a){a.domNode.one(".track-progress-bar")&&
(a.hasTimebar=!0,a.timeBarNode=a.domNode.one(".track-progress-bar"),a.loadingBarNode=a.domNode.one(".load-bar"),a.playingBarNode=a.domNode.one(".play-bar"),a.timerNode=a.domNode.one(".track-time"),a.elapsedNode=a.domNode.one(".timers .elapsed"),a.durationNode=a.domNode.one(".timers .duration"),this._registerEvent(a.timeBarNode.on("click",this.onTimebarClick,this,a)))},onTimebarClick:function(a,c){a.halt();b.Lang.isNull(c)&&(c=this.get("currentTrack"));var d=a.target,g=d.getX(),d=parseInt(d.getComputedStyle("width"),
10),g=(a.clientX-g)/d,d=c.audio.get("duration");this.get("currentTrack")!==c?(this._pausedTime=null,this.setCurrentTrack(c)):this.isTrackPlaying()?c.audio.seek(d*g):this.playCurrentTrack()},_registerTrack:function(a){var c=a.src;8<c.split("/").length&&(c=c.split("/").slice(0,8).join("/"));return b.Squarespace.Singletons.Audio.register({url:c,playing:b.bind(this.whilePlayingDOMUpdates,this),ready:b.bind(this.finishLoading,this),pause:b.bind(function(a){a.isTarget&&this.pausePlayer()},this),ended:b.bind(function(b){b.isTarget&&
this.get("currentTrack").index===a.index&&this.playNextTrackOnList()},this)})},playNextTrackOnList:function(){this.get("currentTrack").index!==this.numberOfTracks-1?this.setCurrentTrack(this.get("trackArray")[this.get("currentTrack").index+1],!1):this.pausePlayer()},whilePlayingDOMUpdates:function(a){if(a.isTarget){var b=a.position;a=a.target.get("duration");var c=100*(b/a)+"%";this.playingTrackPosition=b;this.get("hasUniversalPlaybar")&&this.playingBarNode.setStyle("width",c);this.get("currentTrack.hasTimebar")&&
this.get("currentTrack").playingBarNode.setStyle("width",c);this.updateCurrentTrackTimer(b,a)}},updateCurrentTrackTimer:function(a,c){this.countingDown&&(a=c-a);var d=Math.floor(a/1E3%60),g=Math.floor(a/6E4);10>d&&(d="0"+d);d=g+":"+d;this.get("hasUniversalPlaybar")&&this.elapsedNode&&this.elapsedNode.set("text",d);this.get("currentTrack.hasTimebar")&&this.get("currentTrack.timerNode").set("text",b.Lang.isValue(d)?d:"")},stopPlayBarAndTimer:function(){this.get("hasUniversalPlaybar")&&this.playingBarNode.setStyle("width",
"0%");this.get("currentTrack.timeCnnrNode")&&this.get("currentTrack.timeCnnrNode.playingBarNode").setStyle("width","0%");this.updateCurrentTrackTimer(0,this.get("currentTrack").audio.get("duration"))},finishLoading:function(a){b.Lang.isValue(this._pausedTime)&&a.target.seek(this._pausedTime);this.get("hasUniversalPlaybar")&&this.durationNode&&this.durationNode.set("text",a.target.get("duration"))},resetTimebars:function(){b.Array.each(this.get("trackArray"),function(a,c){if(a.hasTimebar&&a.audio){var d=
b.Lang.isValue(a.duration)?a.duration:"";a.playingBarNode.setStyle("width",0);a.domNode.one(".track-time").set("innerHTML",d)}},this)},setCurrentTrack:function(a,b){a&&(this.set("currentTrack",a),this.get("hasUniversalPlaybar")&&(this.artistNameNode.set("text",a.domNode.getData("artist")),this.trackTitleNode.set("text",a.domNode.getData("title")),this.durationNode.set("text",a.duration),this.elapsedNode.set("text","0:00")),this.trackListNode.all(".track").removeClass("selected"),a.domNode.addClass("selected"),
b||this.playCurrentTrack())},isTrackPlaying:function(a){return this.playerNode.hasClass("playing")},bindTrackLink:function(a){this._registerEvent(a.domNode.one(".track-info").on("click",function(b){b.halt();this._pausedTime=null;this.get("currentTrack")===a?a.audio.seek(0):this.resetTimebars();this.setCurrentTrack(a,!1)},this));this._registerEvent(a.domNode.on("dblclick",function(a){a.halt();this._pausedTime=null;this.get("currentTrack").audio.seek(0)},this))},playCurrentTrack:function(){this.pausePlayer();
b.Squarespace.Singletons.Audio.set("volume",100);this.playerNode.addClass("playing").removeClass("paused");this.get("currentTrack").audio.play()},stopPlayer:function(){this.playerNode.removeClass("playing").removeClass("paused");this.get("currentTrack").audio.pause();this.stopPlayBarAndTimer()},pausePlayer:function(){var a=this.get("currentTrack");this.playerNode&&(a&&a.audio)&&(this.playerNode.addClass("paused").removeClass("playing"),a.audio.pause())},setVolume:function(a){this.volumeBarNode&&this.volumeScrubNode.setStyle("left",
a+"%");b.Squarespace.Singletons.Audio.set("volume",a/100)}},{ATTRS:{playButton:{},pauseButton:{},playPauseButton:{value:"a.button"},stopButton:{},volumeBar:{},nowPlaying:{},prevButton:{},nextButton:{},hasUniversalPlaybar:{value:!1},currentTrack:{value:{}},trackArray:{value:[]},countingDown:{value:!1}}});b.config.win.Squarespace.onInitialize(b,function(){b.all(".sqs-audio-playlist").each(function(a,c){new b.Squarespace.Widgets.AlbumPlayer({contentBox:a,render:!0})})})},"1.0",{requires:["querystring",
"widget","squarespace-audio","squarespace-util"]});
YUI.add("squarespace-album-block-player",function(b){var g=b.namespace("Squarespace.Widgets").AlbumBlockPlayer=b.Base.create("AlbumBlockPlayer",b.Squarespace.Widgets.AlbumPlayer,[],{updateSizeClasses:function(){var a=this.get("contentBox");g.updateSizeClass(a)},resetTimebars:function(){},updateCurrentTrackTimer:function(a,b){var c=Math.floor(a/1E3%60),f=Math.floor(a/6E4);10>c&&(c="0"+c);c=f+":"+c;this.get("hasUniversalPlaybar")&&this.elapsedNode&&this.elapsedNode.set("text",c);this.get("currentTrack.hasTimebar")&&
this.get("currentTrack.elapsedNode").set("text",c)}},{updateSizeClass:function(a){var b=parseInt(a.getComputedStyle("width"),10);return a.removeClass("sm").removeClass("md").removeClass("lg").addClass(640>b?"sm":800>b?"md":"lg")},ATTRS:{}});b.config.win.Squarespace.onInitialize(b,function(){b.all(".sqs-album-block").each(function(a,d){new b.Squarespace.Widgets.AlbumBlockPlayer({contentBox:a,render:!0,playPauseButton:".album-controls .playpause",playButton:".universal-controls .play",pauseButton:".universal-controls .pause",
prevButton:".universal-controls .prev",nextButton:".universal-controls .next"})})})},"1.0",{requires:["squarespace-album-player","base"]});
YUI.add("squarespace-widgets-audio-player",function(b){var g=b.namespace("Squarespace.Widgets").AudioPlayerMinimal=b.Base.create("audioPlayer",b.Squarespace.Widgets.SSWidget,[],{initializer:function(){this.setAttrs(this.get("render").getData());""===this.get("title")&&this.set("title","Untitled");this.set("showDownload","true"===this.get("show-download"));this.set("colorTheme",this.get("color-theme"));this.set("artistName",this.get("author"));this._resizeEmitter=new b.Squarespace.ResizeEmitter;this._registerTrack()},
destructor:function(){b.Lang.isValue(this._funk)&&(this._funk.destroy(),this._funk=null);b.Lang.isValue(this._resizeEmitter)&&(this._resizeEmitter.destroy(),this._resizeEmitter=null)},renderUI:function(){g.superclass.renderUI.call(this);this.get("showDownload")&&this._renderDownloadLink();this.get("boundingBox").addClass(this.get("colorTheme"))},bindUI:function(){var a=this.get("contentBox");a.one(".action").on("click",function(){this.get("firstPlay")||this.set("playing",!this.get("playing"))},this);
this.after("playingChange",this._playingChange,this);this.after("progressChange",function(a){var b=this.get("contentBox").one(".player .time .progress");b.setContent(a.newVal);b.addClass("loaded");this._updateTracker(this.get("position"))},this);this.after("durationChange",function(a){var b=this.get("contentBox").one(".player .time .total");b.setContent(a.newVal);b.addClass("loaded");this.syncUI()},this);this.after("titleChange",function(a){this.get("contentBox").one(".player .labels .title").setContent(a.newVal)},
this);this.after("artistNameChange",function(a){this.get("contentBox").one(".player .labels .artistName").setContent(a.newVal)},this);this._registerEvent(this._resizeEmitter.on("resize:end",this.syncUI,this));this.get("boundingBox").plug(b.Squarespace.NodeDestroyNotifier,{onDestroy:this.destroy,context:this});var d=a.on("click",function(a){!(this.get("showDownload")&&a.target===this._downloadNode.one("a"))&&this.get("firstPlay")&&(a.halt(),d.detach(),d=null,this._setupScrubber(),this.set("firstPlay",
!1),this.set("playing",!0))},this)},syncUI:function(){var a=this.get("boundingBox"),b=a.get("offsetWidth");a.one(".player .track").setStyle("width",b);a.toggleClass("playing",this.get("playing"));a.toggleClass("tiny",300>b);a.toggleClass("no-artist",""===this.get("artistName"));a.toggleClass("first-play",this.get("firstPlay"));a=a.one(".player .labels .title");b=a.get("offsetWidth")<a.get("scrollWidth");a.toggleClass("marquee-mark",b)},_renderNativeAudio:function(){var a=b.Lang.sub(g.NATIVE_TEMPLATE,
this.getAttrs());this.get("contentBox").replace(b.Node.create(a))},_renderDownloadLink:function(){var a=this.get("contentBox").one(".player"),d='<div class="download"><a href="'+b.Squarespace.UrlUtils.addQueryParam(this.get("url"),"download","true")+'" target="_blank">Download</a></div>';this._downloadNode=a.one(".secondary-controls").appendChild(d);a.addClass("download")},_renderVisualizer:function(){for(var a=this.get("contentBox").one(".visualizer"),b="",c=0;100>c;c++)b+='<div class="eq-bar"><div class="height"></div></div>';
a.append(b)},_playingChange:function(a){var d=this.get("fixedUrl");b.UA.ios?window.location.href=d:(b.Lang.isValue(this._funk)||this._registerTrack(),a.newVal?this._funk.play():this._funk.pause(),this.syncUI())},_registerTrack:function(){var a=b.bind(function(a){!a.isTarget&&this.get("playing")&&this.set("playing",!1)},this),d=b.bind(function(a){if(a.isTarget){a=this.get("position");var c=this._funk.get("duration");b.Lang.isValue(a)&&this._funk.seek(this.get("position"));0<c&&(c=this._durationToStr(c),
this.set("duration",c))}},this),c=b.bind(function(a){a.isTarget&&(this.set("playing",!1),this.set("position",0))},this);this._funk=b.Squarespace.Singletons.Audio.register({url:this.get("fixedUrl"),ready:d,ended:c,pause:a,playing:b.bind(this._whilePlaying,this)})},_whilePlaying:function(a){this.get("playing")&&(this.set("position",a.position),this.set("progress",this._durationToStr(a.position)))},_updateTracker:function(a){var b=this.get("contentBox").one(".track .played");a=100*(a/this.get("trueDuration"));
b.setStyle("width",a+"%")},_mergeEQData:function(){for(var a=theSound.eqData,b=a.left,a=a.right,c=b.length,f=[],e=0;e<c;e++)f.push((parseFloat(b[e])+parseFloat(a[e]))/2);return f},_calculateEQChunks:function(){for(var a=this._mergeEQData(),d=[],c=0;c<length;c+=2){var f=0;b.Array.each(a.slice(c,c+2),function(a){f+=a});d.push(75*(f/2))}return d},_drawEQBars:function(){var a=this.get("contentBox").all(".eq-bar .height"),d=this._calculateEQChunks();b.Array.each(d,function(c,f){var e=a.item(f);b.Lang.isValue(e)&&
e.setStyle("height",Math.min(45,d[f]))},this);this.syncUI()},_setupScrubber:function(){var a=b.Node.create('<div class="scrubber-shim"></div>'),d;a.setStyles({position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:Math.pow(10,7),cursor:"none"});this.get("contentBox").one(".player .track").on("mousedown",function(c){this._updatePosition(c);var f=b.Squarespace.Singletons.Audio.get("volume");d=this.get("contentBox").one(".track").get("region");b.Squarespace.Singletons.Audio.set("volume",0.25*f);b.one("body").append(a);
a.once("mouseup",function(){b.Squarespace.Singletons.Audio.set("volume",f);a.remove()},this)},this);a.on("mousemove",function(a){a=this._getRelativePosition(d,a.pageX);this._funk.seek(a);this.get("playing")||(this.set("progress",this._durationToStr(a)),this.set("position",a))},this)},_updatePosition:function(a){if(!this.get("firstPlay")){var b=this.get("contentBox").one(".track").get("region"),c=this.get("contentBox").one(".track .played .icon").get("offsetWidth")/2;this._funk.seek(this._getRelativePosition(b,
a.pageX-c))}},_durationToStr:function(a){var b=Math.floor(a/1E3%60);a=Math.floor(a/6E4);10>b&&(b="0"+b);return a+":"+b},_getRelativePosition:function(a,b){return this.get("trueDuration")*Math.min(1,Math.max(0,(b-a.left)/a.width))},_selectVolume:function(a){var d=this.get("contentBox").all(".player .volume .bar");d.removeClass("active");d.filter(function(b){return parseInt(b.getAttribute("data-level"),10)<=a}).addClass("active");b.Squarespace.Singletons.Audio.set("volume",a)}},{CSS_PREFIX:"sqs-widgets-audio-player",
HANDLEBARS_TEMPLATE:"block-audio-player.html",ATTRS:{fixedUrl:{getter:function(){var a=this.get("url");0<a.indexOf(Static.SQUARESPACE_CONTEXT.appDomain)&&(a=a.replace(/^(http:\/\/|https:\/\/|\/\/)/i,window.location.protocol+"//"));return a},readOnly:!0},firstPlay:{value:!0,validator:b.Squarespace.AttrValidators.isBoolean},position:{value:0,validator:b.Squarespace.AttrValidators.isNumber},progress:{validator:b.Squarespace.AttrValidators.isNullOrString},duration:{validator:b.Squarespace.AttrValidators.isNullOrString},
trueDuration:{getter:function(){var a=this.get("duration-in-ms");return b.Lang.isString(a)&&""!==a?a:b.Lang.isValue(this._funk)?this._funk.get("duration"):0}},title:{value:"",validator:b.Squarespace.AttrValidators.isString},artistName:{value:"",validator:b.Squarespace.AttrValidators.isString},playing:{value:!1,validator:b.Squarespace.AttrValidators.isBoolean},volume:{value:100,validator:b.Squarespace.AttrValidators.isNumber}}})},"1.0",{requires:"base node widget squarespace-block-audio-player-template squarespace-audio squarespace-url-utils".split(" ")});
YUI.add("squarespace-block-audio-player-template",function(b){var g=b.Handlebars;(function(){var a=g.template;(g.templates=g.templates||{})["block-audio-player.html"]=a(function(a,b,f,e,g){this.compilerInfo=[4,">= 1.0.0"];f=this.merge(f,a.helpers);g=g||{};var h=this.escapeExpression;a='<div class="player">\n  <div class="action">\n    <div class="play">\n      <div class="play-button"></div>\n    </div>\n    <div class="pause">\n      <div class="pause-button"></div>\n    </div>\n  </div>\n  <div class="labels">\n    <div class="title-wrapper">\n      <div class="title" title="';
(e=f.title)?e=e.call(b,{hash:{},data:g}):(e=b.title,e="function"===typeof e?e.apply(b):e);a+=h(e)+'" data-title="';(e=f.title)?e=e.call(b,{hash:{},data:g}):(e=b.title,e="function"===typeof e?e.apply(b):e);a+=h(e)+'">';(e=f.title)?e=e.call(b,{hash:{},data:g}):(e=b.title,e="function"===typeof e?e.apply(b):e);a+=h(e)+'</div>\n    </div>\n    <div class="artistName" title="';(e=f.artistName)?e=e.call(b,{hash:{},data:g}):(e=b.artistName,e="function"===typeof e?e.apply(b):e);a+=h(e)+'">';(e=f.artistName)?
e=e.call(b,{hash:{},data:g}):(e=b.artistName,e="function"===typeof e?e.apply(b):e);a+=h(e)+'</div>\n  </div>\n  <div class="secondary-controls">\n    <div class="time">\n      <span class="progress"></span>\n      <span class="total">';(e=f.duration)?e=e.call(b,{hash:{},data:g}):(e=b.duration,e="function"===typeof e?e.apply(b):e);return a+=h(e)+'</span>\n    </div>\n  </div>\n  <div class="track">\n    <span class="played"><span class="icon"></span></span>\n  </div>\n</div>\n'})})();b.Handlebars.registerPartial("block-audio-player.html".replace("/",
"."),g.templates["block-audio-player.html"])},"1.0",{requires:["handlebars-base"]});
