YUI.add("bepress.follow",function(h){var j=h.namespace("bepress.follow"),g="message_overlay",l='{message}            	<p class="close-window"><button type="button" class="follow_cancel close">x</button></p>            	<p>Please log in with your bepress Digital Commons or SelectedWorks account.</p>            	<p> <a             			class="btn btn-mini pull-right"            			href="{signup_url}"><strong>Create a free account <i class="icon-arrow-right"></i></strong></a>            	</p>            	<hr />            	<form class="login-form">            		<p class="row-fluid">            			<label for="email" class="span4">Email:</label>            			<input class="follow_login span8" type="text" id="email" placeholder="you@email.com">            		</p>                	<p class="row-fluid">                		<label for="password" class="span4">Password:</label>                		<input type="password" class="follow_password span8" id="password">                	</p>                	<p class="row-fluid">                		<label for="save_password" class="span4">Remember Me:</label>                		<input type="checkbox" class="save_password" id="save_password" value="1">                	</p>                	<p class="row-fluid">                		<span class="forgot span8"><input                			type="submit"                			class="follow do_login btn btn-primary btn-mini"                			value="Sign in"><a                					href="{reset_url}" target="_new"><small>Forgot Password?</small></a></span>                	</p>                </form>',E="<p><strong>Log in to {target}</strong></p>",w=/(http(?:s)?):\/\/(.+?)\//,z='<b class="{message_class}">{message}</b><p style="{style}">{details}</p>',s="bp",r="net",d=".followable",A=100,o,a=h.bepress.webservice.SWSRequest,i=h.bepress.webservice.ConfigLoader,p=h.bepress.webservice.getMessagePanel;new i(function(I){o=I;if(h.bepress.webservice.shouldDelayForTesting("__dflw")){setTimeout(function(){q();},5000);}else{q();}}).run();function b(M){var L=M.getAttribute("data-follow-set").split(/[ ;]/),J={},I,K;for(K=0;K<L.length;K++){I=L[K].split(":");J[I[0]]=I[1];}return J;}function f(I){var L=h.getLocation(),J=L.host,K={path:"/"};if(I){if(I.expires){K.expires=new Date(I.expires);}if(!/\bbepress\.com$/.exec(J)){h.bepress.webservice.setAuthCookie(I.cookie_name,I.cookie_value,K);}}}function k(M,J,Q,K){var I=M.target,O=I.one(".follow_login").get("value"),P=I.one(".follow_password").get("value"),L=I.one(".save_password").get("checked"),N="email="+encodeURIComponent(O)+"&password="+encodeURIComponent(P);if(L){N+="&save_password=1";}swsRequestConfig={method:"POST",data:N,"arguments":{eventNode:J,followSet:Q,eventDate:K,loginName:O},on:{success:function(R,S){if(R.status=="OK"){f(R.update_authn);y(S.eventNode);panel=p(S.eventNode);panel.hide();}else{e("E_REJECTED",S.eventNode,S.followSet,S.eventDate,S.loginName);}},failure:function(R){panel=p(R.eventNode);panel.setMessage({message:c("E_GENERAL"),classnames:"error",details:""});panel.show(5000);}}};M.halt();new a(o[s].sw_wsurl+"/login/login",swsRequestConfig);}var m={E_REJECTED:'<i class="icon-exclamation-sign"></i> The email address and/or password you entered is invalid.',E_GENERAL:"Oops!  An error occurred processing your<br>request.  Our team is investigating and will<br>fix the problem as soon as possible."};var v='<div class="{message_class}">{message}</div>';function c(K,J){var I=K?K:"";if(m[K]){I=h.substitute(v,{message_class:J?J:K.match(/^E_/)?"error":"note",message:m[K]});}return I;}function u(J){var I=h.stamp(J);h.all(".followable").each(function(L){if(h.stamp(L)!==I){var K=p(L);if(K){K.hide();}}});}function e(J,K,Q,L,N){var M,O=c(J),I=b(K),P;u(K);panel=p(K);P=o[s].sw_wsurl+"/signup/?return_to="+escape(window.location)+"&follow_subscribe="+escape(h.QueryString.stringify(I))+"&login_site="+window.location.host;panel.set("bodyContent",h.substitute(l,{signup_url:P,reset_url:o[s].sw_wsurl+"/reset",message:O}));panel.set("headerContent",h.substitute(E,{target:K.get("title")}));panel.show();M=panel.getOverlay().getStdModNode(h.WidgetStdMod.BODY);M.one("form.login-form").on("submit",k,null,K,Q,L);M.one(".follow_cancel").on("click",function(){panel.hide();});if(N){M.one(".follow_login").set("value",N);M.one(".follow_password").focus();}else{M.one(".follow_login").focus();}}function B(I,J){if(I.reason==="NOT_AUTHORIZED"){e("",J.eventNode,J.followSet,J.eventDate);}else{panel=p(J.eventNode);panel.setMessage({message:c("E_GENERAL"),classnames:"error",details:h.dump(I),showDetails:I.is_dev?true:false});panel.show(5000);}}function x(J){var I=J.getData("initialClasses");if(I&&I.indexOf("followable-unsubscribe")>-1){J.set("innerHTML",J.getData("initialContent"));J.setAttribute("class",J.getData("initialClasses"));J.setAttribute("title",J.getData("initialTitle"));}else{J.set("innerHTML",'<i class="icon-ok"></i> Following');J.removeClass("btn-primary");J.addClass("following");}}function G(I){I.set("innerHTML",'<i class="icon-exclamation-sign icon-white"></i> Removed');I.removeClass("btn-danger");I.removeClass("followable-unsubscribe");I.addClass("btn-warning");I.set("title","Click to follow again.");}function y(M){var J=b(M),I=h.bepress.webservice.getAuthCookie(),K,L=new Date();if(M.getData(g)){M.getData(g).hide();if(M.getData("hideTimer")){clearTimeout(M.getData("hideTimer"));M.setData("hideTimer",null);}}if(I){J.auth_cookie=I;}K=o[r].wsurl+"/follow/subscribe?"+h.QueryString.stringify(J);new a(K,{"arguments":{eventNode:M,followSet:J,eventDate:L},on:{success:function(N,O){f(N.update_authn);if(N.status==="OK"){x(O.eventNode);}else{B(N,O);}},failure:function(N){B({status:"ERROR_HTTP"},N);}}});}function F(M){var J=b(M),I=h.bepress.webservice.getAuthCookie(),K,L=new Date();if(M.getData(g)){M.getData(g).hide();if(M.getData("hideTimer")){clearTimeout(M.getData("hideTimer"));M.setData("hideTimer",null);}}if(I){J.auth_cookie=I;}K=o[r].wsurl+"/follow/unsubscribe?"+h.QueryString.stringify(J);new a(K,{"arguments":{eventNode:M,followSet:J,eventDate:L},on:{success:function(N,O){f(N.update_authn);if(N.status==="OK"){G(O.eventNode);}else{B(N,O);}},failure:function(N){B({status:"ERROR_HTTP"},N);}}});}function H(P,N){var J=P.get("winHeight"),M=P.get("winWidth"),L,R,I=n(P),K=n(N),Q,O;if(document.documentElement&&typeof(document.documentElement.scrollTop)=="number"){L=document.documentElement.scrollTop;R=document.documentElement.scrollLeft;}else{L=document.body.scrollTop;R=document.body.scrollLeft;}if((I.left+I.width)+(K.width)<M-R){Q=I.left+I.width;}else{if(I.left+(I.width/2)+K.width<M-R){Q=I.left+(I.width/2);}else{Q=(I.left+(I.width/2))-K.width;}}if(I.top+I.height+K.height<J+L){O=I.top+I.height;}else{O=I.top-K.height;}return[Q,O];}function n(J){var I={left:J.getX(),top:J.getY(),width:parseInt(J.get("offsetWidth")),height:parseInt(J.get("offsetHeight"))};return I;}function D(J){var K=J.target;while(K.get("nodeName")!=="A"){K=K.ancestor("a");}if(K.hasClass("followable-unsubscribe")){J.halt();F(K);}else{if(K.hasClass("following")){var I=h.substitute("{proto}//{host}/do/dcn/mgr/follows",{proto:o.protocol,host:o[s].host});K.setAttribute("href",I);K.setAttribute("target","_blank");}else{J.halt();y(K);}}}function C(I){if(!I.hasClass("followable-enabled")){I.addClass("followable-enabled");I.removeAttribute("onclick");I.on("click",D);I.setData("initialClasses",I.getAttribute("class"));I.setData("initialTitle",I.getAttribute("title"));I.setData("initialContent",I.get("innerHTML"));if(I.hasClass("followable-unsubscribe")){I.setData("canUnsubscribe",true);}I.setStyle("opacity",1);if(window.queuedFollows){h.Array.each(window.queuedFollows,function(J){if(J==I.getDOMNode()){y(I);}});}}}function t(){var I=h.all(d);I.each(C);if(!j.domReadyFired){h.later(A,null,t);}}function q(){var I=h.bepress.webservice.getAuthCookie(),J=h.all(d),K=o[r].wsurl+"/follow/list";t();if(I&&J.size()){new a(K,{data:"auth_cookie="+encodeURIComponent(I),on:{success:function(Q,O){f(Q.update_authn);if(Q.status==="OK"){var P=0,M,L,N=h.all(d);for(P=0;P<Q.content.subscriptions.length;P++){M=Q.content.subscriptions[P].split(";");L=M.join(" ");N.each(function(R){if(R.getAttribute("data-follow-set")===L){x(R);}});}}},failure:function(L){}}});}}h.on("domready",function(){j.domReadyFired=true;});},"0.3",{requires:["bepress.webservice","bepress.followcss","dump"]});