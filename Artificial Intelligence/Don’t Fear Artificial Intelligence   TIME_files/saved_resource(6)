var _TgxAdBridgeGetSlotScript=window.TgxAdBridgeGetSlotScript;window.TgxAdBridgeGetSlotScript=function(){return"try {"+_TgxAdBridgeGetSlotScript.apply(this,arguments)+"} catch (e) { console.error(e) }"},function($){"use strict";var TimeAdFactory={},Time=window.Time||{};getParameterByName("debugads")&&localStorage&&(localStorage.debugads=getParameterByName("debugads")),getParameterByName("noads")&&localStorage&&(localStorage.noads=getParameterByName("noads")),getParameterByName("nodisplay")&&localStorage&&(localStorage.nodisplay=getParameterByName("nodisplay")),getParameterByName("notaboola")&&localStorage&&(localStorage.notaboola=getParameterByName("notaboola")),getParameterByName("testads")&&sessionStorage&&(sessionStorage.testads=getParameterByName("testads")),window.TiiAdsIsDebugMode=function(){return localStorage&&"1"===localStorage.debugads};var IS_ADS_DISABLED=!1;"undefined"==typeof TiiAdConfig&&(console.error("time-dfp -- TiiAdConfig/TGX not defined"),IS_ADS_DISABLED=!0),localStorage&&"true"===localStorage.noads&&(console.error("time-dfp -- localstorage.noads is true"),IS_ADS_DISABLED=!0),window.TGX_SITE_CONFIG={gpt_sync_mode:"async",refresh_oop_slot:!0};var size,prevent_pointer_event_timeout,adFactory,cmAd,current_page_type,doc=document,$window=$(window),window_app_height=$window.height(),window_app_width=$window.width(),$html=$("html"),$body=$html.find("body"),ad_sizes={desktop:{"homepage-pushdown":["101x1","970x1","970x66","970x90","970x250"],pushdown:["101x1","970x66","970x90","970x250","970x418","994x250"],navigation:["900x250","900x500","970x418","1024x768"],"homepage-content-well":["900x250","900x500","970x418","994x250"],"homepage-cm-banner":["268x54"],"homepage-cm-brief":["454x40"],"ad-divider":["300x251","450x375","728x90","900x250","900x500","970x418","994x250"],"collection-ad-divider":["300x251","450x375","728x90","900x250","900x500","970x418","994x250"],"content-ad":["300x251","1000x5"],"left-rail":["300x250"],sub:["300x50","320x50"],"sub-cm":["268x54"],"in-article":["300x600"],list:["300x250"],"list-top-10":["300x250","818x450"],"magazine-cm-subscribe":["142x70"],"magazine-cm-module":["840x264"],"special-article-logo":["170x30"],"special-article-small":["300x250"],"special-article-xsmall":["300x250","300x600"],"special-article-large":["728x90","900x250","900x500","970x418","994x250"],"special-article-banner":["101x1","728x90","970x66","970x250"],"collection-logo":["88x31"],"money-homepage-content-well":["300x251","728x90","900x250","900x500","970x418","994x250"],"money-homepage-right-rail":["300x250","300x600"],"money-homepage-cm-banner":["268x54"],"market-data-sponsor":["155x30","170x30"],"topic-logo":["170x30","300x50"],"right-rail":["120x60"],nativo:["320x80"],parents__subscribeabv:["142x70"]},tablet:{pushdown:["101x1","970x66","970x90","970x250"],"homepage-content-well":["450x375","300x251"],"homepage-cm-banner":["268x54"],"homepage-cm-brief":["454x40"],"ad-divider":["450x375","300x251"],"collection-ad-divider":["450x375","300x251"],"content-ad":["300x251","1000x5"],"left-rail":["300x250"],sub:["320x50","300x50"],"sub-cm":["268x54"],"in-article":["300x600"],list:["450x375","300x251"],"list-top-10":["450x375","300x251","818x450","616x400"],"magazine-cm-subscribe":["142x70"],"magazine-cm-module":["840x264"],"special-article-logo":["170x30"],"special-article-small":["300x250"],"special-article-xsmall":["300x250","300x600"],"special-article-large":["300x250"],"special-article-banner":["320x50"],"collection-logo":["88x31"],"money-homepage-content-well":["450x375","300x251"],"money-homepage-right-rail":["300x250"],"money-homepage-cm-banner":["268x54"],"market-data-sponsor":["170x30","155x30"],"topic-logo":["170x30","300x50"],"right-rail":["120x60"],nativo:["320x80"],parents__subscribeabv:["142x70"]},mobile:{"article-top-ad":["300x50","320x50"],"sub-cm":["300x50"],"homepage-content-well":["300x50","320x50","300x250","320x240"],"homepage-cm-banner":["300x50","320x50"],"homepage-cm-brief":["454x40"],"ad-divider":["300x50","320x50","300x250","320x240"],"collection-ad-divider":["300x50","320x50","300x250","320x240"],"content-ad":["300x50","320x50","300x250","320x240"],"left-rail":["300x50","320x50","300x250","320x240"],sub:["300x50","320x50"],"in-article":["300x250"],list:["300x50","320x50","300x250","320x240"],"list-top-10":["450x375","300x251","616x400"],"magazine-cm-subscribe":["142x70"],"magazine-cm-module":["840x264"],"special-article-logo":["170x30"],"special-article-small":["300x250"],"special-article-xsmall":["300x250"],"special-article-large":["300x250","320x50"],"special-article-banner":["300x50","320x50"],"collection-logo":["88x31"],"money-mobile-homepage-ad-before-section":["300x50","320x50","300x250","320x240"],"money-homepage-top":["300x50","320x50"],"money-homepage-content-well":["300x50","320x50","300x250","320x240"],"money-homepage-right-rail":["300x250"],"market-data-sponsor":["170x30","155x30"],"topic-logo":["170x30","300x50"],nativo:["320x80"],parents__subscribeabv:["142x70"]}},left_rail_ad_timeout={},display_ad_timeouts={},$content_rail_ad_el_divs={},$left_rail_ad_el_divs={},$ad_left_rail_placeholders={},$article_viewport=$body.find(".article-viewport"),$notTheHeader=$body.find("#notTheHeader"),$pushdown_ad=$body.find("#pushdown-ad"),$left_rail_topper=$body.find(".left-rail-topper").eq(0),$top_banner=$body.find(".top-banner"),top_banner_height=$top_banner.eq(0).height(),ad_left_rail_binded_events={},ad_content_rail_binded_events={},device=Time.device,is_ie=$.browser.msie,is_greater_than_ie_11=is_ie&&parseInt($.browser.version,10)>=11,is_webkit_or_ie_11=$.browser.webkit||is_greater_than_ie_11,is_ff=$.browser.mozilla,is_pc=-1!==navigator.appVersion.indexOf("Win"),disable_pointer_events=!1,is_tablet_portrait_mode="tablet"===device&&window_app_height>window_app_width,is_tablet_landscape_mode="tablet"===device&&window_app_width>window_app_height,can_have_pushdown_ad="desktop"===device||is_tablet_landscape_mode,initial_app_load=!0,initial_ad_page_load=!0,article_sub_ad_render=!1,section_sub_ad_render=!1,pushdown_rendered=!1,is_topic=function(){var $topic=$left_rail_topper.find("#topic");return $topic.length&&$topic.hasClass("active")},page_type=function(){var type=Time.application.active_route&&"rail"===Time.application.active_route?"article":Time.application.active_route;return is_topic()&&(type="topic"),type},in_content_well_viewport=function($el,partial){if($el.length<=0)return!1;var content_well_top=top_banner_height,content_well_bottom=window_app_height,el_rect=$el.get(0)?$el.get(0).getBoundingClientRect():!1,el_top=el_rect?el_rect.top-400:0,el_bottom=el_rect?el_rect.bottom:0;return partial?content_well_top>el_top&&el_bottom>content_well_top||el_top>content_well_top&&content_well_bottom>=el_top:el_top>=content_well_top&&content_well_bottom>=el_bottom},get_page_data=function(model){var page_data={$el:$("#article-"+model.get("id")).eq(0),title:model.get("title"),url:model.get("url"),format:model.get("format"),section:model.get("section")?model.get("section").name:null,magazine_article:model.get("magazine_article")?!0:!1,paid:model.get("paid")?!0:!1,available:model.get("available")?!0:!1,id:model.get("id"),list_items:model.get("list_items")?model.get("list_items").length:0,neg:model.get("ads")?model.get("ads").neg:!1},modules=model.get("omniture")&&model.get("omniture").modules,right_rail_ad_id="right-rail-ad-"+page_data.id;return model.collection&&(page_data.env=model.collection.active_env,model.collection.sub&&(page_data.sub=model.collection.sub)),modules&&-1!==modules.indexOf("rr-ad")&&(page_data.right_rail_ad_id=right_rail_ad_id),page_data},get_active_rail=function(){return Time.application&&Time.application.active_rail?Time.application.active_rail:!1},get_active_article_id=function(){var active_rail=get_active_rail();return active_rail&&Time.application.model.get("activeArticle")?Time.application.model.get("activeArticle").get("id"):active_rail&&active_rail.models[0]?active_rail.models[0].id:Time.bootstrap.single_article?Time.bootstrap.single_article.id:TIME_DFP.aid?TIME_DFP.aid:TIME_DFP.params&&TIME_DFP.params.aid?TIME_DFP.params.aid:!1},render_cmAd=function(ad_placeholder_id,size,pos,type){if(IS_ADS_DISABLED)return void console.debug("IS_ADS_DISABLED is TRUE",arguments);var dim,$ad_el_divs_obj,$el=$("#"+ad_placeholder_id);return $el.length?($ad_el_divs_obj=-1!==ad_placeholder_id.indexOf("sub-ad")?$left_rail_ad_el_divs:$content_rail_ad_el_divs,$ad_el_divs_obj[ad_placeholder_id]=$el,dim=size[0].split("x"),cmAd=adFactory.getCmAd(dim[0],dim[1],pos,type),size.length>1&&cmAd.setParam("sz",size.join(",")),cmAd.setParam("ad_div",ad_placeholder_id),void cmAd.write(ad_placeholder_id)):!1},delete_ad=function(ad_placeholder_id,is_left_rail_ad){is_left_rail_ad||remove_pre_render_content_rail_ad_events(ad_placeholder_id),Time.trigger("dfpAdManager:deleteAd",ad_placeholder_id)},delete_left_rail_ad=function(ad_placeholder_id){delete_ad(ad_placeholder_id,!0)},display_ads=function(arr_ids,display_immediately){if(IS_ADS_DISABLED)return console.debug("-- IS_ADS_DISABLED is TRUE",arguments),!1;if("true"===localStorage.nodisplay)return!1;if(arr_ids.length>0){var articleModel=Time.application.model.get("activeArticle");Time.trigger("dfpAdManager:refreshAds",articleModel,arr_ids,display_immediately)}},get_$ad_el_div=function(ad_placeholder_id){return $("#"+ad_placeholder_id)},get_$ad_left_rail_placeholder=function(ad_spacer_id){var $ad_spacer;return $ad_left_rail_placeholders[ad_spacer_id]?$ad_left_rail_placeholders[ad_spacer_id]:($ad_spacer=$("#"+ad_spacer_id),$ad_spacer.length?($ad_left_rail_placeholders[ad_spacer_id]=$("#"+ad_spacer_id),$ad_spacer):!1)},adding_pre_render_ad_events=function(ad_placeholder_id,$rail,data,handler,ad_location){var ad_bind_event_obj;ad_bind_event_obj="left-rail"===ad_location?ad_left_rail_binded_events:"content-rail"===ad_location?ad_content_rail_binded_events:ad_content_rail_binded_events,console.log("binding event handlers for "+ad_placeholder_id),$rail.bind("scroll."+ad_placeholder_id,data,handler),ad_bind_event_obj["scroll."+ad_placeholder_id]=$rail,$notTheHeader.bind("scroll."+ad_placeholder_id+"_notTheHeader",data,handler),ad_bind_event_obj["scroll."+ad_placeholder_id+"_notTheHeader"]=$notTheHeader,$window.bind("resize."+ad_placeholder_id,data,handler),ad_bind_event_obj["resize."+ad_placeholder_id]=$window,"tablet"===device&&($window.bind("orientationchange."+ad_placeholder_id,data,handler),ad_bind_event_obj["orientationchange."+ad_placeholder_id]=$window)},adding_pre_render_content_rail_ad_events=function(ad_placeholder_id,$rail,data,handler){adding_pre_render_ad_events(ad_placeholder_id,$rail,data,handler,"content-rail")},remove_pre_render_events=function(ad_placeholder_id,ad_location){console.log("removing ad events for "+ad_placeholder_id);var ad_bind_event_obj;ad_bind_event_obj="left-rail"===ad_location?ad_left_rail_binded_events:"content-rail"===ad_location?ad_content_rail_binded_events:ad_content_rail_binded_events,ad_bind_event_obj["scroll."+ad_placeholder_id]&&(ad_bind_event_obj["scroll."+ad_placeholder_id].unbind("scroll."+ad_placeholder_id),delete ad_bind_event_obj["scroll."+ad_placeholder_id]),ad_bind_event_obj["scroll."+ad_placeholder_id+"_notTheHeader"]&&(ad_bind_event_obj["scroll."+ad_placeholder_id+"_notTheHeader"].unbind("scroll."+ad_placeholder_id+"_notTheHeader"),delete ad_bind_event_obj["scroll."+ad_placeholder_id+"_notTheHeader"]),ad_bind_event_obj["resize."+ad_placeholder_id]&&(ad_bind_event_obj["resize."+ad_placeholder_id].unbind("resize."+ad_placeholder_id),delete ad_bind_event_obj["resize."+ad_placeholder_id]),"tablet"===device&&ad_bind_event_obj["orientationchange."+ad_placeholder_id]&&(ad_bind_event_obj["orientationchange."+ad_placeholder_id].unbind("orientationchange."+ad_placeholder_id),delete ad_bind_event_obj["orientationchange."+ad_placeholder_id])},remove_pre_render_content_rail_ad_events=function(ad_placeholder_id){remove_pre_render_events(ad_placeholder_id,"content-rail")},clear_bind_events_maker=function(bind_events_obj){return function(){var prop;for(prop in bind_events_obj)bind_events_obj.hasOwnProperty(prop)&&(bind_events_obj[prop].unbind(prop),delete bind_events_obj[prop])}},clear_timeout_maker=function(timeout_obj){return function(){var prop;for(prop in timeout_obj)timeout_obj.hasOwnProperty(prop)&&(clearTimeout(timeout_obj[prop]),delete timeout_obj[prop])}},clear_content_rail_bind_events=clear_bind_events_maker(ad_content_rail_binded_events),clear_left_rail_bind_events=clear_bind_events_maker(ad_left_rail_binded_events),clear_left_rail_timeouts=clear_timeout_maker(left_rail_ad_timeout),clear_display_ads_timeouts=clear_timeout_maker(display_ad_timeouts),remove_left_rail_ads=function(){for(var prop in $left_rail_ad_el_divs)if($left_rail_ad_el_divs.hasOwnProperty(prop)){-1===prop.indexOf("ad-unit")?$left_rail_ad_el_divs[prop].empty():($left_rail_ad_el_divs[prop].remove(),$("#"+prop).remove());try{delete $left_rail_ad_el_divs[prop],delete tgxDo.slots[prop]}catch(e){console.error("time-dfp -- remove_ads - couldn't delete "+prop)}Time.trigger("dfpAdManager:deleteAd",prop)}if(section_sub_ad_render=!1,article_sub_ad_render=!1,"desktop"===Time.device)for(var prop2 in $ad_left_rail_placeholders)if($ad_left_rail_placeholders.hasOwnProperty(prop2)){try{delete $ad_left_rail_placeholders[prop2]}catch(e){}Time.trigger("dfpAdManager:deleteAd",prop2)}},remove_ads=function(){var prop;if(initial_app_load)return!1;clear_left_rail_bind_events(),clear_left_rail_timeouts(),clear_content_rail_bind_events(),remove_left_rail_ads(),clear_display_ads_timeouts(),Time.trigger("dfpAdManager:removeAds"),pushdown_rendered&&($pushdown_ad.empty(),pushdown_rendered=!1);for(prop in $content_rail_ad_el_divs)try{delete $content_rail_ad_el_divs[prop],delete tgxDo.slots[prop]}catch(e){}},clean_ad_key_value=function(value){return value.replace(/[^\w,]/g,"").toLowerCase()},get_adFactory_data=function(model){if(!model)return!1;var adFactory_data={},type=Time.application.active_route&&"rail"===Time.application.active_route?"article":Time.application.active_route;return adFactory_data.params={},model.get("section")&&model.get("section").name?(adFactory_data.params.ch=model.get("section").name,adFactory_data.zone=adFactory_data.params.ch):(adFactory_data.zone="",adFactory_data.params.ch=""),adFactory_data.zone=model.get("collection_meta")?/money_collection|money_collectionpost|money_article/.test(model.get("post_type"))?"money/collections/"+model.get("collection_meta").ad_zone:"collections/"+model.get("collection_meta").ad_zone:/money_collection|money_collectionpost|money_article/.test(model.get("post_type"))?"money/"+adFactory_data.params.ch:adFactory_data.params.ch,model.get("format")&&(adFactory_data.params.ctype=model.get("format")),model.get("id")&&(adFactory_data.params.aid=model.get("id")),model.get("ads")&&(adFactory_data.params.neg=model.get("ads").neg),model.get("tags")&&(adFactory_data.params.tags=clean_ad_key_value(model.get("tags").replace(/\|/g,","))),model.get("topic")&&model.get("topic").slug&&(adFactory_data.params.topic=clean_ad_key_value(model.get("topic").slug)),model.get("hub_meta")&&(adFactory_data.params.subch=model.get("hub_meta").slug),model.get("is_nativo")&&model.get("sponsor")&&model.get("sponsor").slug&&(adFactory_data.params.spons=clean_ad_key_value(model.get("sponsor").slug)),is_topic()?adFactory_data.params.ptype="topic":Time.application.active_route&&(adFactory_data.params.ptype=type),model.get("topic")&&model.get("topic").is_vault&&(adFactory_data.zone="vault"),adFactory_data.url=model.get("url"),adFactory_data},content_well_ad_sync=function(ad_placeholder_id,display_immediately){var activate_model,modules,right_rail_ad_id,ads=[],active_article_id=get_active_article_id(),active_rail=get_active_rail();Time.application.model.get("isRailOpen")&&(ads=push_visible_left_rail_ads_to_arr(ads),initial_ad_page_load&&can_have_pushdown_ad&&!pushdown_rendered&&(pushdown_rendered=!0,render_pushdown_ad("pushdown-ad"),ads.push("pushdown-ad"))),ads.push(ad_placeholder_id),active_article_id&&active_rail&&(activate_model=active_rail.get(active_article_id),modules=activate_model.get("omniture")&&activate_model.get("omniture").modules,modules&&-1!==modules.indexOf("rr-ad")&&(right_rail_ad_id="right-rail-ad-"+active_article_id,tgxDo.slots[right_rail_ad_id]&&ads.push(right_rail_ad_id))),display_ads(ads,display_immediately)},push_visible_left_rail_ads_to_arr=function(ads){var $sub_ad_unit,active_rail=get_active_rail(),sub_ad_unit=null,sub_ad_size=null,$visibleLeftRailAds=active_rail.view.getAdsInViewport();return $.each($visibleLeftRailAds,function(i,d){var placeholderId=$(d).attr("id"),is_ad_unit_ad=-1!==placeholderId.indexOf("ad-unit"),adId="desktop"===Time.device&&is_ad_unit_ad?placeholderId+"_ad":placeholderId,pos=$(d).data("pos");is_ad_unit_ad&&!$(d).hasClass("collapsed")&&((tgxDo.slots[adId]&&!Time.tgxAdapter.model.get("isInitialLeftRailCycle")||!Time.tgxAdapter.model.get("isInitialLeftRailCycle"))&&(delete_left_rail_ad(adId),Time.trigger("dfpAdManager:activateAd",null,{id:adId,size:size["left-rail"],position:pos,group:"leftRail",isTethered:!0,tetherTo:placeholderId})),ads.push(adId))}),"article"!==current_page_type&&"popular"!==current_page_type&&"videos"!==current_page_type||"mobile"===device?"section"===current_page_type&&(sub_ad_unit="section-sub-ad",sub_ad_size="sub"):(sub_ad_unit="sub-ad",sub_ad_size="sub-cm"),sub_ad_unit&&($sub_ad_unit=get_$ad_el_div(sub_ad_unit),(tgxDo.slots[sub_ad_unit]&&!Time.tgxAdapter.model.get("isInitialLeftRailCycle")||!Time.tgxAdapter.model.get("isInitialLeftRailCycle"))&&(Time.trigger("dfpAdManager:deleteAd",sub_ad_unit),"sub-ad"===sub_ad_unit?render_sub_cm_ad(sub_ad_unit):Time.trigger("dfpAdManager:activateAd",null,{id:sub_ad_unit,size:size[sub_ad_size],position:1,group:"leftRailTop",subgroup:"top"})),ads.push(sub_ad_unit)),ads},reload_left_rail_ads=function(){var ads=[];ads=push_visible_left_rail_ads_to_arr(ads),Time.tgxAdapter.model.get("isInitialLeftRailCycle")?display_ads(ads):display_ads(ads,!0)},content_well_ad_handler=function(e){var data=e.data,ad_placeholder_id=data.ad_placeholder_id,$ad_placeholder_id=$("#"+ad_placeholder_id),ad_sizes=data.ad_sizes,pos=data.pos?data.pos:1,id=data.id,active_article_id=get_active_article_id();(in_content_well_viewport($ad_placeholder_id,!0)||Time.tgxAdapter.model.get("isInitialLeftRailCycle"))&&active_article_id===id&&(Time.trigger("dfpAdManager:activateAd",null,{id:ad_placeholder_id,size:ad_sizes,position:pos,group:"contentWell"}),remove_pre_render_content_rail_ad_events(ad_placeholder_id),content_well_ad_sync(ad_placeholder_id,!0))},init=function(){localStorage&&"1"===localStorage.debugads?$html.addClass("debugads"):$html.removeClass("debugads"),$body.addClass("hasAd"),"desktop"===Time.device&&$body.addClass("expandable-ad-enable"),$window.on("resize",function(){window_app_height=$window.height(),window_app_width=$window.width(),top_banner_height=$top_banner.eq(0).height()}),$window.on("orientationchange",function(){window_app_height=$window.height(),window_app_width=$window.width(),is_tablet_portrait_mode="tablet"===device&&window_app_height>window_app_width,size=is_tablet_portrait_mode?ad_sizes.mobile:ad_sizes.tablet}),$window.on("offscreen",function(e,data){var $ad,$ad_height,model=data.model,$el=data.$el,id=model.get("id"),list_ads=data?model.list_ads:!1,list_ads_length=list_ads?list_ads.length:0,i=0,available=model.get("available")?!0:!1,right_rail_ad_id="right-rail-ad-"+id;if(list_ads)for(i=0;list_ads_length>i;i+=1)$ad=get_$ad_el_div(list_ads[i]),$ad_height=$ad.height(),$ad.length&&$ad_height&&($ad.css({height:$ad_height}),delete_ad(list_ads[i]));right_rail_ad_id&&($ad=get_$ad_el_div(right_rail_ad_id),$ad.length&&($ad.css({height:$ad.height()}),delete_ad(right_rail_ad_id))),available||($el.addClass("rendered-cm-ad-module-removed"),delete_ad("magazine-cm-module-"+id))}),$window.on("onscreen",function(e,data){var list_ad_placeholder_id,$list_ad_placeholder_id,model=data.model,id=model.get("id"),list_ads=model.list_ads?model.list_ads:!1,list_ads_length=list_ads?list_ads.length:0,i=0,list_ad_data={id:id},modules=model.get("omniture")&&model.get("omniture").modules,right_rail_ad_id="right-rail-ad-"+id,collection_meta=model.get("collection_meta");if(list_ads&&!Time.tgxAdapter.model.get("isInitialLeftRailCycle"))for(i=0;list_ads_length>i;i+=1)list_ad_placeholder_id=list_ads[i],tgxDo.slots[list_ad_placeholder_id]||($list_ad_placeholder_id=get_$ad_el_div(list_ad_placeholder_id),list_ad_data.pos=$list_ad_placeholder_id.attr("pos"),list_ad_data.ad_placeholder_id=list_ad_placeholder_id,list_ad_data.isTop10=collection_meta&&"top-10-everything-of-2014"===collection_meta.ad_zone,render_list_ad(list_ad_data));modules&&-1!==modules.indexOf("rr-ad")&&render_right_rail_ad(right_rail_ad_id,id)}),(is_webkit_or_ie_11||is_pc&&is_ff)&&$window.bind("mousewheel.disable-pointer-events",function(){clearTimeout(prevent_pointer_event_timeout),disable_pointer_events||(disable_pointer_events=!0,$body.addClass("disable-pointer-events")),prevent_pointer_event_timeout=setTimeout(function(){disable_pointer_events&&(disable_pointer_events=!1,$body.removeClass("disable-pointer-events"))},300)})},activate_ads=function(article_model){if(console.debug("-------- ACTIVATE_ADS --------",article_model),IS_ADS_DISABLED)return void console.debug("-- IS_ADS_DISABLED is TRUE",arguments);var page_data=get_page_data(article_model),format=page_data.format,url=page_data.url,title=page_data.title,article_id=page_data.id,$el=page_data.$el,right_rail_ad_id=page_data.right_rail_ad_id,paid=page_data.paid,available=page_data.available,active_rail=get_active_rail(),ads=[],list_ads_length=article_model.list_ads?article_model.list_ads.length:0,list_ads=list_ads_length?article_model.list_ads:[],collection_meta=article_model.get("collection_meta"),isTop10=collection_meta&&"top-10-everything-of-2014"===collection_meta.ad_zone,i=0;if(current_page_type=page_type(),!article_id)return void console.error("no page data");if(console.debug("-- current page template is "+current_page_type),console.debug("-- current content type is "+format),url?console.debug("-- current page url is "+url.replace("http://","")):console.error("no page data"),console.debug("-- current page title is "+title),console.debug("-- current page article_id is "+article_id),console.debug("-- is paid content "+paid),console.debug("-- current device type is "+device),console.debug("-- using this ad server: "+adFactory.sitename),console.debug("-- current page_data",page_data),console.debug("-- factory",adFactory),available||($el.hasClass("rendered-cm-ad")?$el.hasClass("rendered-cm-ad-module-removed")&&($el.removeClass("rendered-cm-ad-module-removed"),render_magazine_cm_module("magazine-cm-module-"+article_id),display_ads(["magazine-cm-module-"+article_id])):($el.addClass("rendered-cm-ad"),render_magazine_cm_ads(article_id),display_magazine_cm_ads(article_id))),"mobile"===device&&"videos"!==Time.application.active_route&&"collection"!==Time.application.active_route&&initial_ad_page_load&&($("<div />",{id:"article-top-ad"}).prependTo(".article-viewport"),Time.trigger("dfpAdManager:activateAd",null,{id:"article-top-ad",size:size["article-top-ad"],position:1,group:"mobileTopAd",subgroup:"article",isMobileOnly:!0,renderOnce:!0}),ads.push("article-top-ad")),"article"===current_page_type||"popular"===current_page_type||"videos"===current_page_type?(console.debug("-- article, render_sub_cm_ads"),article_sub_ad_render||(Time.trigger("dfpAdManager:deleteAd","sub-ad"),render_sub_cm_ad("sub-ad"),article_sub_ad_render=!0)):"section"===current_page_type&&(console.debug("-- section, section sub ads"),section_sub_ad_render||(Time.trigger("dfpAdManager:deleteAd","section-sub-ad"),Time.trigger("dfpAdManager:activateAd",null,{id:"section-sub-ad",size:size.sub,position:1,group:"leftRailTop",subgroup:"section"}),section_sub_ad_render=!0)),Time.tgxAdapter.model.get("isInitialLeftRailCycle")&&"mobile"===device&&Time.application.model.get("isRailOpen"))console.debug("------ mobile initial left rail load, activate left rail ads"),activate_left_rail_ads();else if(Time.tgxAdapter.model.get("isInitialLeftRailCycle")&&"mobile"!==device||Time.tgxAdapter.model.get("isInitialLeftRailCycle")&&"mobile"!==device&&!Time.application.model.get("isRailOpen")&&"collection"!==current_page_type){if(console.debug("------ initial left rail load, ad.write left rail ads"),$body.find(".ad-unit").each(function(){var data,$placeholder=$(this),placeholderId=$placeholder.attr("id"),adId=placeholderId,pos=$placeholder.attr("pos");if("desktop"===Time.device){adId=placeholderId+"_ad";var options={id:adId,"class":"left-rail-ad","data-ad_placeholder_id":placeholderId,pos:pos};Time.trigger("dfpAdManager:createLeftRailAd",options)}data={ad_placeholder_id:placeholderId,$ad_placeholder_id:$placeholder,rail:active_rail,pos:pos},Time.trigger("dfpAdManager:activateAd",null,{id:adId,size:size["left-rail"],position:pos,group:"leftRail",isTethered:!0,tetherTo:placeholderId})}),ads=push_visible_left_rail_ads_to_arr(ads),console.debug("-- found these left rail ad units",ads),Time.tgxAdapter.model.get("isInitialLeftRailCycle")&&Time.application.model.get("isRailOpen")&&(console.debug("-- initial left rail cycle"),$("#ad-unit-1").length&&-1===ads.indexOf("ad-unit-1"))){console.debug("-- but didn't activate ad-unit-1...");var placeholderId="ad-unit-1",adId=placeholderId;"desktop"===Time.device&&(adId+="_ad"),Time.trigger("dfpAdManager:activateAd",null,{id:adId,size:size["left-rail"],position:1,group:"leftRail",isTethered:!0,tetherTo:placeholderId}),ads.push(adId),console.debug("-- ensured ad-unit-1")}if(console.debug("-- checking for unrendered pushdown ads"),can_have_pushdown_ad&&!pushdown_rendered&&(render_pushdown_ad("pushdown-ad"),pushdown_rendered=!0),console.debug("-- checking for pushdown ads",can_have_pushdown_ad),can_have_pushdown_ad&&ads.push("pushdown-ad"),console.debug("-- checking for list ads","list"===format),"list"===format&&list_ads_length)for(i=0;list_ads_length>i;i+=1)Time.trigger("dfpAdManager:activateAd",null,{id:list_ads[i],size:isTop10?size["list-top-10"]:size.list,position:i,group:"listAds"}),ads.push(list_ads[i]);return console.debug("-- checking for right rail ads: "+right_rail_ad_id),right_rail_ad_id&&(render_right_rail_ad(right_rail_ad_id,article_id),ads.push(right_rail_ad_id)),console.debug("-- is collection?","collection"===current_page_type),"collection"===current_page_type&&($top_banner.append('<div id="banner-ad"><div id="collection-banner-ad" data-cb-ad-id="collection-banner-ad"></div></div>'),Time.trigger("dfpAdManager:activateAd",null,{id:"collection-banner-ad",size:size["collection-logo"],position:1,group:"banners",subgroup:"collection"}),ads.push("collection-banner-ad")),console.debug("-- is topic?","topic"===current_page_type),"topic"===current_page_type&&($top_banner.append('<div id="banner-ad"><div id="topic-banner-ad" data-cb-ad-id="topic-banner-ad"></div></div>'),Time.trigger("dfpAdManager:activateAd",null,{id:"topic-banner-ad",size:size["topic-logo"],position:1,group:"banners",subgroup:"topic"}),ads.push("topic-banner-ad")),console.debug("-- old activate_ads rendered all of these ads: ",ads),Time.tgxAdapter.model.set("isInitialLeftRailCycle",!1),console.debug("--------- DONE ACTIVATE_ADS ---------"),ads}return console.debug("------ activate_ads -- mobile/l.rail already loaded/not initial load/scrolled to article"),"gallery"===format?(console.debug("--------- DONE ACTIVATE_ADS ---------"),ads):("collection"!==current_page_type&&(console.log("-- no ads are in the current content so just reload visible left rail ads"),ads=push_visible_left_rail_ads_to_arr(ads),right_rail_ad_id&&tgxDo.slots[right_rail_ad_id]&&ads.push(right_rail_ad_id)),console.debug("--------- DONE ACTIVATE_ADS ---------"),ads)},render_left_rail_ad=function(placeholderId){console.debug("---- render_left_rail_ad ----");var adId,$ad,ad_size,$placeholder,pos,data,left_rail_placeholder_el_rect_top,placeholderEl,active_rail=get_active_rail(),active_article_id=get_active_article_id(),ads=[];if(!active_rail)return console.debug("-- do not have a reference to a left rail"),!1;if(!active_article_id)return console.debug("-- do not have a active_article_id"),!1;if(Time.tgxAdapter.model.get("isInitialLeftRailCycle")&&"mobile"!==device)return console.debug("-- initial_left_rail_load is true so waiting for activate_ads to render: "+placeholderId),!1;if(adId=placeholderId,"desktop"===Time.device){$placeholder=$("#"+placeholderId),placeholderEl=$placeholder.get(0),left_rail_placeholder_el_rect_top=placeholderEl?placeholderEl.getBoundingClientRect().top:!1,adId=placeholderId+"_ad";var options={id:adId,"class":"left-rail-ad","data-ad_placeholder_id":placeholderId,"data-cb-ad-id":"left-rail-ad",pos:$placeholder.attr("pos")};Time.trigger("dfpAdManager:createLeftRailAd",options),$placeholder=$("#"+placeholderId).removeClass("hide-ad"),$ad=$(adId),$(".scroll-for-more").appendTo($body)}else $placeholder=get_$ad_el_div(placeholderId);if($placeholder.length){if(pos=$placeholder.attr("pos"),ad_size=size["left-rail"],data={ad_placeholder_id:placeholderId,$ad_placeholder_id:$placeholder,rail:active_rail,pos:pos},console.debug("-- the active_article is "+active_article_id+" and the adFactory.params.aid is "+adFactory.params.aid),active_article_id&&active_article_id!==adFactory.params.aid){var articleModel=active_rail.get(active_article_id)||Time.application.model.get("activeArticle");articleModel&&(console.debug("-- time-dfp - render_left_rail_ad - trigger dfpAdManager:factory:maybeReset"),Time.trigger("dfpAdManager:factory:maybeReset",adFactory,articleModel))}if(Time.trigger("dfpAdManager:activateAd",null,{id:adId,size:ad_size,position:pos,group:"leftRail",isTethered:!0,tetherTo:placeholderId}),Time.tgxAdapter.model.get("isInitialLeftRailCycle"))return;ads.push(adId),console.debug("-- render_left_rail_ad -- not initial left rail load, display_ads"),console.debug("time-dfp -- render_left_rail_ad -- display_ads",ads),display_ads(ads)}},render_content_well_ad=function(ad_placeholder_id,data){console.debug("render_content_well_ad",ad_placeholder_id,data);var $ad_placeholder_id=$("#"+ad_placeholder_id),id=data.id,active_article_id=get_active_article_id();if(Time.application.active_rail&&Time.application.model.get("isRailOpen")&&Time.tgxAdapter.model.get("isInitialLeftRailCycle"))return void console.log("-- initial_left_rail_load is true so waiting for activate_ads to render: "+ad_placeholder_id);if(in_content_well_viewport($ad_placeholder_id,!0)&&active_article_id===id){console.log("-- content well ad "+ad_placeholder_id+" in sight not on initial render and active article id is "+id),console.log("-- doing an ad sync for "+id);var adData=_.extend(data,{id:ad_placeholder_id,size:data.ad_sizes,position:data.pos,group:"contentWell",subgroup:data.group});Time.trigger("dfpAdManager:activateAd",null,adData),content_well_ad_sync(ad_placeholder_id)}else in_content_well_viewport($ad_placeholder_id,!0)||(console.log("-- content well ad not in sight on initial div ad render for "+ad_placeholder_id+" for active article "+id),adding_pre_render_content_rail_ad_events(ad_placeholder_id,$article_viewport,data,content_well_ad_handler))},render_list_ad=function(data){var ad_data={ad_placeholder_id:data.ad_placeholder_id,ad_sizes:data.isTop10?size["list-top-10"]:size.list,id:data.id,pos:data.ad_list_index,group:"listAds"};render_content_well_ad(data.ad_placeholder_id,ad_data)},render_right_rail_ad=function(ad_placeholder_id,id){var $article,$articleSection;$("#"+ad_placeholder_id).length<=0&&($article=$("#article-"+id),$articleSection=$article&&$article.find(".article-body"),$articleSection.length>0&&$articleSection.append('<aside class="right-rail-module rr-ad" data-name="rr-ad"><div class="right-rail-ad" id="'+ad_placeholder_id+'"></div></aside>')),Time.trigger("dfpAdManager:activateAd",null,{id:ad_placeholder_id,size:size["right-rail"],position:1,group:"rightRail"})
},render_homepage_left_rail_ad=function(ad_placeholder_id,data){var pos=data.pos,the_ad_id=ad_placeholder_id;if("desktop"===Time.device){the_ad_id=ad_placeholder_id+"_ad";var options={id:the_ad_id,"class":"left-rail-ad","data-ad_placeholder_id":ad_placeholder_id,"data-cb-ad-id":"left-rail-ad",pos:1};Time.trigger("dfpAdManager:createLeftRailAd",options),$(".scroll-for-more").appendTo($body)}Time.trigger("dfpAdManager:activateAd",null,{id:the_ad_id,size:size["left-rail"],position:pos,group:"leftRail",subgroup:"homepage",isTethered:!0,tetherTo:ad_placeholder_id})},render_homepage_cm_ad=function(ad_placeholder_id,vertical){var size_label,pos;"money"===vertical?(size_label="money-homepage-cm-banner",pos="globalheadermny"):(size_label="homepage-cm-banner",pos="globalheader"),render_cmAd(ad_placeholder_id,size[size_label],pos,"tout")},render_sub_cm_ad=function(ad_placeholder_id){var vertical=window.history&&history.pushState?doc.location.pathname.substring(1).split("/")[0]:doc.location.hash.substring(1).split("/")[0],pos="money"===vertical?"globalheadermny":"globalheader";render_cmAd(ad_placeholder_id,size["sub-cm"],pos,"tout")},render_pushdown_ad=function(ad_placeholder_id){var pushdownAdSizes=size.pushdown,position="0";Time.application.is_homepage&&(pushdownAdSizes=size["homepage-pushdown"],position="1"),Time.trigger("dfpAdManager:activateAd",null,{id:ad_placeholder_id,size:pushdownAdSizes,position:position,group:"pushdown",renderOnce:!0})},render_mobile_homepage_sub_ad=function(ad_placeholder_id){render_homepage_cm_ad(ad_placeholder_id)},render_homepage_content_well_ad=function(ad_placeholder_id,pos,vertical){var size_label=vertical?vertical+"-homepage-content-well":"homepage-content-well";Time.trigger("dfpAdManager:activateAd",null,{id:ad_placeholder_id,size:size[size_label],position:pos,group:"contentWell",subgroup:"homepage"})},render_market_data_sponsor_ad=function(ad_placeholder_id){Time.trigger("dfpAdManager:activateAd",null,{id:ad_placeholder_id,size:size["market-data-sponsor"],position:1,group:"sponsor"})},render_magazine_cm_subscribe_link=function(ad_placeholder_id,pos){console.debug("ad.write render_magazine_cm_subscribe_link for "+ad_placeholder_id),render_cmAd(ad_placeholder_id,size["magazine-cm-subscribe"],pos,"tout")},render_magazine_cm_module=function(ad_placeholder_id){console.debug("ad.write render_magazine_cm_module for "+ad_placeholder_id),render_cmAd(ad_placeholder_id,size["magazine-cm-module"],"submodule","tout")},display_magazine_cm_ads=function(id){var ads=[];tgxDo.slots["magazine-cm-subscribe-top-"+id]&&ads.push("magazine-cm-subscribe-top-"+id),tgxDo.slots["magazine-cm-subscribe-bottom-"+id]&&ads.push("magazine-cm-subscribe-bottom-"+id),tgxDo.slots["magazine-cm-module-"+id]&&ads.push("magazine-cm-module-"+id),display_ads(ads)},render_magazine_cm_ads=function(id){$article_viewport.find("#magazine-cm-subscribe-top-"+id).length&&render_magazine_cm_subscribe_link("magazine-cm-subscribe-top-"+id,"subscribeabv"),$article_viewport.find("#magazine-cm-subscribe-bottom-"+id).length&&render_magazine_cm_subscribe_link("magazine-cm-subscribe-bottom-"+id,"subscribeblw"),$article_viewport.find("#magazine-cm-module-"+id).length&&render_magazine_cm_module("magazine-cm-module-"+id)},activate_left_rail_ads=function(){console.log("activate left rail ads"),current_page_type=page_type();var active_rail=get_active_rail(),ads=[],active_rail_view=active_rail.view?active_rail.view:Time.page.rail_view,ad_suffix="desktop"===Time.device?"_ad":"";"section"===current_page_type&&(section_sub_ad_render||(Time.trigger("dfpAdManager:activateAd",null,{id:"section-sub-ad",size:size.sub,position:1}),section_sub_ad_render=!0)),active_rail_view&&"collection"!==current_page_type?(Time.application.is_homepage?("undefined"==typeof Time.application.is_money_homepage||!Time.application.is_money_homepage||Time.application.is_money_homepage.length<1)&&ads.push(["ad-unit-1"+ad_suffix]):""!==active_rail_view.$el.html()&&(Time.application.resizeContent(),ads=push_visible_left_rail_ads_to_arr(ads)),Time.tgxAdapter.model.get("isInitialLeftRailCycle")?(console.debug("time-dfp -- activate_left_rail_ads -- display_ads",ads),display_ads(ads)):(console.debug("time-dfp -- activate_left_rail_ads -- display_ads immediate",ads),display_ads(ads,!0))):"collection"===current_page_type&&$("#ad-unit-0").length&&(Time.trigger("dfpAdManager:activateAd",null,{id:"ad-unit-0_ad",size:size["left-rail"],position:"0",group:"leftRail",isTethered:!0,tetherTo:"ad-unit-0"}),display_ads(["ad-unit-0_ad"],!0))},activate_homepage_ads=function(){console.log("activate_homepage_ads");var ads=[],left_rail_ad="desktop"===Time.device?"ad-unit-1_ad":"ad-unit-1";ads.push(left_rail_ad),"mobile"!==device?(render_homepage_cm_ad("home-banner-ad"),render_homepage_content_well_ad("ad-homepage-content-well",1),render_market_data_sponsor_ad("market-data-sponsor"),render_cmAd("ad-homepage-post-brief",size["homepage-cm-brief"],"blwbriefsubhp","tout"),ads.push("ad-homepage-content-well"),ads.push("home-banner-ad"),ads.push("market-data-sponsor"),ads.push("ad-homepage-post-brief"),can_have_pushdown_ad&&!pushdown_rendered&&(pushdown_rendered=!0,render_pushdown_ad("pushdown-ad"),ads.push("pushdown-ad"))):(Time.application.model.get("isRailOpen")&&(render_mobile_homepage_sub_ad("sub-ad-head"),ads.push("sub-ad-head"),$(".scroll-for-more").appendTo("body"),$(".scroll-for-more").show()),render_homepage_content_well_ad("ad-homepage-content-well-1",1),render_homepage_content_well_ad("ad-homepage-content-well-2",2),render_homepage_content_well_ad("ad-homepage-content-well-3",3),ads.push("ad-homepage-content-well-1"),ads.push("ad-homepage-content-well-2"),ads.push("ad-homepage-content-well-3")),display_ads(ads)},activate_vertical_homepage_ads=function(){var ads=[];"mobile"!==device?(is_tablet_portrait_mode||(render_homepage_cm_ad("money-homepage-banner-ad","money"),ads.push("money-homepage-banner-ad"),Time.application.model.get("isRailOpen")&&($(".scroll-for-more").appendTo("body"),$(".scroll-for-more").show())),render_homepage_content_well_ad("money-homepage-content-well-ad",1,"money"),Time.trigger("dfpAdManager:activateAd",null,{id:"money-right-rail-ad",size:size["money-homepage-right-rail"],position:1,group:"rightRail",subgroup:"moneyHomepage"}),render_market_data_sponsor_ad("market-data-sponsor"),ads.push("money-right-rail-ad"),ads.push("money-homepage-content-well-ad"),ads.push("market-data-sponsor")):(Time.trigger("dfpAdManager:activateAd",null,{id:"money-homepage-top-ad",size:size["money-homepage-top"],position:1,group:"topAd",subgroup:"moneyMobile"}),ads.push("money-homepage-top-ad"),$('<div class="money-mobile-homepage-ad" id="money-mobile-homepage-ad-before-watch-now"></div>').insertBefore(".home-container .home-watch-now:first"),Time.trigger("dfpAdManager:activateAd",null,{id:"money-mobile-homepage-ad-before-watch-now",size:size["money-mobile-homepage-ad-before-section"],position:2,group:"homepageContentWell",subgroup:"moneyMobile"}),ads.push("money-mobile-homepage-ad-before-watch-now"),$('<div class="money-mobile-homepage-ad" id="money-mobile-homepage-ad-before-features"></div>').insertBefore(".home-container .home-features:first"),Time.trigger("dfpAdManager:activateAd",null,{id:"money-mobile-homepage-ad-before-features",size:size["money-mobile-homepage-ad-before-section"],position:3,group:"homepageContentWell",subgroup:"moneyMobile"}),ads.push("money-mobile-homepage-ad-before-features"),render_market_data_sponsor_ad("market-data-sponsor"),ads.push("market-data-sponsor")),can_have_pushdown_ad&&!pushdown_rendered&&(pushdown_rendered=!0,render_pushdown_ad("pushdown-ad"),ads.push("pushdown-ad")),display_ads(ads)},set_initial_app_load=function(val){initial_app_load=val},left_rail_ad_callback=function(adId){console.log("left_rail_ad_callback for: "+adId);var $ad,placeholderId,$placeholder,active_rail,active_rail_view,$scroll_container,placeholderEl,placeholderRect,ad_left,data;if("desktop"===Time.device)if($ad=$("#"+adId),$ad.length&&(placeholderId=$ad.data("ad_placeholder_id"),$placeholder=get_$ad_left_rail_placeholder(placeholderId)),$ad&&$ad.hasClass("hide-ad")&&$placeholder)$placeholder.addClass("hide-ad");else if($placeholder&&placeholderId&&$ad&&$ad.height()<270){console.log("going to update left rail ad postion"),active_rail=get_active_rail(),$scroll_container=active_rail.view?active_rail.view.$scroll_container:Time.page.rail_view.$scroll_container,active_rail_view=active_rail.view?active_rail.view:Time.page.rail_view,placeholderEl=$placeholder.get(0),placeholderRect=placeholderEl.getBoundingClientRect();var $adContainer=$ad.children().first(),$adEl=$adContainer.children().first(),$actualAd=$adEl.children().first();ad_left=$actualAd.width()>301?0:11,ad_left=Time.application.model.get("isRailOpen")?ad_left:-3360,data={left_rail_placeholder_id_el:placeholderEl,left_rail_placeholder_id:placeholderId,$the_ad_id:$ad,ad_left:ad_left};var adHeight=$actualAd.height(),placeholderHeight=adHeight+10;$placeholder.height(placeholderHeight).removeClass("hide-ad")}Time.trigger("dfpAdManager:callback",adId)},pushdown_ad_callback=function(){console.log("pushdown ad callback"),$pushdown_ad.hasClass("hide-ad")||$pushdown_ad.css({height:"auto",overflow:"visible"}),Time.trigger("pushdown:loaded")},hide_ad_div=function(ad_placeholder_id){var $ad_placeholder_id=get_$ad_el_div(ad_placeholder_id);if(console.log("time_dfp -- hide_ad_div from adCallbackFunction -- hiding "+ad_placeholder_id),$ad_placeholder_id.addClass("hide-ad"),-1!==ad_placeholder_id.indexOf("ad-unit-")){var $ad_spacer;"desktop"===Time.device&&($ad_spacer=get_$ad_left_rail_placeholder($ad_placeholder_id.data("ad_placeholder_id")),$ad_spacer.addClass("hide-ad"))}else-1!==ad_placeholder_id.indexOf("pushdown-ad")&&Time.trigger("pushdown:loaded");return Time.trigger("dfpAdManager:callback:hide",ad_placeholder_id),!1},adCallbackFunction=function(ad_placeholder_id){var $ad_placeholder_id=get_$ad_el_div(ad_placeholder_id);if($ad_placeholder_id.hasClass("hide-ad")||$ad_placeholder_id.length<=0)return console.log("adCallbackFunction for "+ad_placeholder_id+" but the ad is hidden or is no longer there"),!1;if(console.log("adCallbackFunction for "+ad_placeholder_id),-1!==ad_placeholder_id.indexOf("ad-unit-"))setTimeout(function(){left_rail_ad_callback(ad_placeholder_id)},50);else{if(-1===ad_placeholder_id.indexOf("pushdown-ad"))return"function"==typeof Time.trigger&&Time.trigger("dfpAdManager:callback",ad_placeholder_id),!1;pushdown_ad_callback(ad_placeholder_id)}},hide_left_rail_ads=function($arr_ad_divs){var prop,$the_ad_id,i,l,active_rail;if(active_rail=get_active_rail(),"desktop"===Time.device)if($arr_ad_divs&&$.isArray($arr_ad_divs))for(l=$arr_ad_divs.length,i=0;l>i;i+=1)$arr_ad_divs[i].css({left:"-3360px"});else for(prop in $left_rail_ad_el_divs)-1!==prop.indexOf("ad-unit-")&&($the_ad_id=get_$ad_el_div(prop),$the_ad_id.css({left:"-3360px"}))},update_sponsor_ad_position=function(ad_placeholder_id,top,left){var $ad_placeholder_id=get_$ad_el_div(ad_placeholder_id);top=parseInt(top,10),left=parseInt(left,10),top&&$ad_placeholder_id.css({top:top}),left&&$ad_placeholder_id.css({left:left})};if(TimeAdFactory.isInitialAdPageLoad=function(){return initial_ad_page_load},TimeAdFactory.isInitialAppLoad=function(){return initial_app_load},TimeAdFactory.getAdSizes=function(device){return ad_sizes[device]},TimeAdFactory.getAdSize=function(key){return size[key]},TimeAdFactory.getFactoryInstance=function(){return adFactory},TimeAdFactory.getLeftRailAds=function(){var ads=[],active_rail=get_active_rail();if(!Time.application.model.get("isRailOpen"))return[];var $visibleLeftRailAds=active_rail.view.getAdsInViewport(),isRailCollapsed=$(document).hasClass("collapsed");return $.each($visibleLeftRailAds,function(index,$el){$el instanceof jQuery||($el=$($el));var id=$el.attr("id"),isAdUnit=-1!==id.indexOf("ad-unit"),ad_placeholder_id="desktop"===Time.device&&isAdUnit?id+"_ad":id;isAdUnit&&!isRailCollapsed&&ads.push(ad_placeholder_id)}),"article"!==current_page_type&&"popular"!==current_page_type&&"videos"!==current_page_type||"mobile"===device?"section"===current_page_type&&ads.push("section-sub-ad"):ads.push("sub-ad"),ads},TimeAdFactory.getFactoryData=get_adFactory_data,TimeAdFactory.setGlobalFactory=function(newFactory){return adFactory=newFactory},TimeAdFactory.setGlobalAdSizes=function(newSizes){return size=newSizes},TimeAdFactory.setInitialAdPageLoad=function(isInitialAdPageLoad){initial_ad_page_load=isInitialAdPageLoad},TimeAdFactory.init=init,TimeAdFactory.render_left_rail_ad=render_left_rail_ad,TimeAdFactory.render_content_well_ad=render_content_well_ad,TimeAdFactory.render_list_ad=render_list_ad,TimeAdFactory.render_homepage_left_rail_ad=render_homepage_left_rail_ad,TimeAdFactory.render_mobile_homepage_sub_ad=render_mobile_homepage_sub_ad,TimeAdFactory.render_pushdown_ad=render_pushdown_ad,TimeAdFactory.set_initial_app_load=set_initial_app_load,TimeAdFactory.clear_left_rail_bind_events=clear_left_rail_bind_events,TimeAdFactory.clear_left_rail_timeouts=clear_left_rail_timeouts,TimeAdFactory.remove_left_rail_ads=remove_left_rail_ads,TimeAdFactory.remove_ads=remove_ads,TimeAdFactory.activate_ads=activate_ads,TimeAdFactory.activate_left_rail_ads=activate_left_rail_ads,TimeAdFactory.activate_homepage_ads=activate_homepage_ads,TimeAdFactory.activate_vertical_homepage_ads=activate_vertical_homepage_ads,TimeAdFactory.hide_left_rail_ads=hide_left_rail_ads,TimeAdFactory.reload_left_rail_ads=reload_left_rail_ads,TimeAdFactory.in_content_well_viewport=in_content_well_viewport,TimeAdFactory.display_ads=display_ads,TimeAdFactory.get_active_article_id=get_active_article_id,TimeAdFactory.get_active_rail=get_active_rail,TimeAdFactory.ad_content_rail_binded_events=ad_content_rail_binded_events,TimeAdFactory.ad_left_rail_binded_events=ad_left_rail_binded_events,TimeAdFactory.$content_rail_ad_el_divs=$content_rail_ad_el_divs,TimeAdFactory.$left_rail_ad_el_divs=$left_rail_ad_el_divs,TimeAdFactory.$ad_left_rail_placeholders=$ad_left_rail_placeholders,TimeAdFactory.get_$ad_left_rail_placeholder=get_$ad_left_rail_placeholder,TimeAdFactory.page_type=page_type,TimeAdFactory.left_rail_ad_timeout=left_rail_ad_timeout,TimeAdFactory.delete_ad=delete_ad,TimeAdFactory.display_ad_timeouts=display_ad_timeouts,TimeAdFactory.remove_pre_render_content_rail_ad_events=remove_pre_render_content_rail_ad_events,TimeAdFactory.adCallbackFunction=adCallbackFunction,TimeAdFactory.hide_ad_div=hide_ad_div,TimeAdFactory.update_sponsor_ad_position=update_sponsor_ad_position,IS_ADS_DISABLED)for(var key in TimeAdFactory)TimeAdFactory.hasOwnProperty(key)&&(TimeAdFactory[key]=function(){return!1});window.TimeAdFactory=TimeAdFactory}(jQuery);;
var last_taboola_article_id=!1,$last_taboola_divider=!1;window.Time=window.Time||{},window.Time.taboola=function($){"use strict";var Time=window.Time||{},sumElementsHeight=function(context){var height=0,elements=context.find(".landscape, .portrait, .video-wrapper");return elements.each(function(){var $el=$(this);$el.length>0&&(height+=$el.height())}),height},module={};return module.renderModules=function(){var article_id,$divider,$prev_divider,$next_divider,$last_article,$modules,$spacer,visibility,$article=$(".full-article.active");if($article.length&&(article_id=$article[0].id,article_id!==last_taboola_article_id)){if($modules=$article.find(".taboola:visible"),$next_divider=$article.next(".divider-taboola").find(".taboola"),$prev_divider=$article.prev(".divider-taboola").find(".taboola"),$divider=$next_divider.length?$next_divider:$prev_divider,$spacer=$(".rr-taboola-spacer"),last_taboola_article_id&&($last_article=$("#"+last_taboola_article_id),$last_article.find(".taboola").each(function(){$(this).html("").attr("class","taboola")}),$divider.length&&$last_taboola_divider&&$last_taboola_divider.html("").attr("class","taboola"),visibility=$modules.length?!0:!1,_taboola.push({notify:"newPageLoad"}),_taboola.push({article:article_id,url:Time.application.model.get("activeArticle").get("url")})),$modules.each(function(){var actualMode,actualPlacement,$self=$(this),$articleBody=$self.closest(".article-body");/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&"right-rail-bottom"===$self.data("placement")?(actualMode="mobile-thumbs-1r",actualPlacement="mobile-below-article-thumbs","time"!==Time.branding&&(actualPlacement="money-mobile-below-article-thumbs")):(actualMode=$self.data("mode"),actualPlacement=$self.attr("placement"),"time"!==Time.branding&&(actualPlacement="money-right-rail-bottom")),_taboola.push({mode:actualMode,container:$self.attr("id"),placement:actualPlacement,target_type:$self.data("type"),height:$articleBody.height()-sumElementsHeight($articleBody)})}),$divider.length&&(_taboola.push({mode:"thumbs-1r",container:$divider.attr("id"),placement:"mid-page"}),$last_taboola_divider=$divider),$spacer.length){var taboola_height=1.2*$spacer.width();$spacer.height($article.find("p:last").height()-taboola_height)}last_taboola_article_id=article_id}},module}(jQuery);;
!function($){Backbone.View.prototype.destroy=function(){return this.trigger("view:destroy"),this.unbind(),$(this.el).remove(),this.$el.remove(),this.remove(),this};var Time;Time=window.Time||(window.Time={}),null==Time.bootstrap&&(Time.bootstrap={}),null==Time.component&&(Time.component={}),null==Time.modules&&(Time.modules={}),null==Time.views&&(Time.views={}),null==Time.models&&(Time.models={}),null==Time.collections&&(Time.collections={}),null==Time.components&&(Time.components={});var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Time.modules.AdMediator=function(){function AdMediator(options){return this.ssv2ComscorePageview=__bind(this.ssv2ComscorePageview,this),this.ssv2OmniturePageview=__bind(this.ssv2OmniturePageview,this),this.ssv2RefreshAds=__bind(this.ssv2RefreshAds,this),this.specialStoryActivateAds=__bind(this.specialStoryActivateAds,this),this.tgxOnArticleActivated=__bind(this.tgxOnArticleActivated,this),this.app=options.app,this}return AdMediator.prototype.adapters={},AdMediator.prototype.rules=null,AdMediator.prototype.NATIVO_DISABLED_PAGETYPES=["collection","videos","nativo","magazine","sponsor","topic"],AdMediator.prototype.NATIVO_DISPLAY_DELAY=300,AdMediator.prototype.NATIVO_TIMEOUT_DELAY=2500,AdMediator.prototype.isNativoRenderable=!0,AdMediator.prototype.nativoTimeout=null,AdMediator.prototype.lastListItemFired=0,AdMediator.prototype.isArticleTopAdRemoved=!1,AdMediator.prototype.SSV2_AD_REFRESH_FREQUENCY=1,AdMediator.prototype.ssv2LastRefreshMarker=-1,AdMediator.prototype.addPeers=function(peers){_.extend(this.adapters,peers)},AdMediator.prototype.initialize=function(){return this.rules={"nativo:afterRefresh":{listener:Time,handlers:{nativo:function(_this){return function(){_this.isNativoRenderable=!0}}(this)}},"dfpAdManager:afterDisplay":{listener:Time,handlers:{tgx:function(_this){return function(adIds){var isInitialAdsDone;if(Time.Ad.isInitialAdPageLoad()&&(isInitialAdsDone="desktop"!==Time.device,isInitialAdsDone||(isInitialAdsDone=_this.isLeftRailAdsIncluded(adIds)),isInitialAdsDone||(isInitialAdsDone=null!=Time.page&&"object"==typeof Time.page),isInitialAdsDone))return Time.Ad.setInitialAdPageLoad(!1),window.TGX_SITE_CONFIG.refresh_oop_slot=!1,_this.initialAdsRefreshed(),_this}}(this)}},"nativo:render":{listener:Time,handlers:{tgx:function(_this){return function(){_this.isNativoRenderable?(_this.isNativoRenderable=!1,Time.Ad.isInitialAdPageLoad()||_this.adapters.tgx.deleteAd("nativo-trigger"),_this.adapters.tgx.activateAd(null,{id:"nativo-trigger",size:Time.Ad.getAdSize("nativo"),position:_this.adapters.nativo.totalTiles,isTrigger:!0,group:"nativo"}),window.setTimeout(function(){return _this.adapters.tgx.loadNativoTrigger()},_this.NATIVO_DISPLAY_DELAY),_this.adapters.nativo.totalTiles++):(window.clearTimeout(_this.nativoTimeout),_this.nativoTimeout=window.setTimeout(function(){return Time.trigger("nativo:render")},_this.NATIVO_TIMEOUT_DELAY))}}(this)}},"leftRail:tile:rendered":{listener:Time,handlers:{nativo:function(_this){return function(tileView){var collection,isNativoSpot;_this.isNativoDisabled()||null!=(null!=tileView?tileView.collection:void 0)&&(collection=tileView.collection,isNativoSpot=collection.real_article_index%_this.adapters.nativo.FREQUENCY===_this.adapters.nativo.OFFSET,isNativoSpot&&Time.trigger("nativo:render"))}}(this)}},"leftRail:flush":{listener:Time,handlers:{nativo:function(_this){return function(){_this.adapters.nativo.reset()}}(this)}},"special:ads:activate":{listener:Time,handlers:{tgx:this.specialStoryActivateAds}},"special:marker:passed":{listener:Time,handlers:{tgx:this.ssv2RefreshAds,omniture:this.ssv2OmniturePageview,comscore:this.ssv2ComscorePageview}},"article:activated":{listener:Time,handlers:{tgx:this.tgxOnArticleActivated}},"article:renderAds":{listener:Time,handlers:{tgx:function(_this){return function(article){switch(article.get("format")){case"list":return _this.renderListAds(article)}}}(this)}},"router:notFirst":{listener:Time,handlers:{tgx:function(){this.isArticleTopAdRemoved||($("#article-top-ad").remove(),this.isArticleTopAdRemoved=!0)}}},"readingPane:scrolled":{listener:Time,handlers:{tgx:function(_this){return function(){_this.ssv2ActivateNewAdsOnScroll(),_this.refreshListAds()}}(this)}},"comscore:pageview":{listener:Time,handlers:{comscore:function(_this){return function(){_this.adapters.comscore.firePageviewCandidate()}}(this)}}},this.bindRules(),this},AdMediator.prototype.bindRules=function(){return _.each(this.rules,function(_this){return function(settings,event){return _.each(settings.handlers,function(handler,adapter){_.has(_this.adapters,adapter)&&(settings.listener||(settings.listener=Time),Time.listenTo(settings.listener,event,function(){return console.debug("adMediator ",event," for ",adapter)}),Time.listenTo(settings.listener,event,handler))})}}(this)),this},AdMediator.prototype.isNativoDisabled=function(){var _ref;return"magazine"===(null!=(_ref=this.app.active_rail)?_ref.active_env:void 0)?!0:_.contains(this.NATIVO_DISABLED_PAGETYPES,this.app.model.get("pagetype"))},AdMediator.prototype.isLeftRailAdsIncluded=function(adDivIds){var leftRailAds;return leftRailAds=_.find(adDivIds,function(id){var isLeftRailAd;return isLeftRailAd=-1!==id.indexOf("ad-unit")}),null!=leftRailAds?leftRailAds.length:void 0},AdMediator.prototype.initialAdsRefreshed=function(){var pushdownAds;return pushdownAds=this.adapters.tgx.adCollection.where({group:"pushdown"}),_.each(pushdownAds,function(_this){return function(ad){return _this.adapters.tgx.adCollection.remove(ad)}}(this)),this.adapters.tgx.model.set("isInitialAdCycle",!1),Time.Ad.set_initial_app_load(!1),this},AdMediator.prototype.tgxOnArticleActivated=function(articleView){var activeAds,activeAdsSansLeft,adDivIds,articleModel,factoryInstance,leftRailAds,leftRailNonvisible,leftRailVisible,oldLeftRailAds;articleModel=articleView.model,factoryInstance=this.adapters.tgx.model.getFactory(),this.adapters.tgx.model.maybeResetFactory(factoryInstance,articleModel),articleView.$el.find(".content-ad").length&&this.adapters.tgx.activateContentAd(articleView),this.adapters.tgx.activateDividerAd(articleView),leftRailAds=this.adapters.tgx.adCollection.getIds({group:"leftRail"}),leftRailVisible=Time.Ad.getLeftRailAds(),leftRailNonvisible=_.difference(leftRailAds,leftRailVisible),activeAds=this.adapters.tgx.adCollection.getIds({isActive:!0,isTrigger:!1}),activeAdsSansLeft=_.difference(activeAds,leftRailNonvisible),this.app.active_rail&&(oldLeftRailAds=Time.Ad.activate_ads(articleModel)),adDivIds=activeAdsSansLeft.concat(oldLeftRailAds),this.adapters.tgx.refreshAds(articleModel,adDivIds)},AdMediator.prototype.refreshListAds=function(){var $listItems,$passed,activeArticle,items,itemsSelector,passed,totalPassed,_ref;if(activeArticle=null!=(_ref=this.app.model)?_ref.get("activeArticle"):void 0){if("list"===activeArticle.get("format"))items=activeArticle.get("list_items"),itemsSelector=".article-item";else{if("gallery"!==activeArticle.get("format")||"vertical"!==activeArticle.get("gallery").size)return;items=activeArticle.get("gallery").photos,itemsSelector=".galleryVertical__slide--image"}!(null!=items?items.length:void 0)>2||($listItems=$("#article-"+activeArticle.id+" "+itemsSelector),passed=$.grep($listItems,function(_this){return function(item){var $item;return $item=$(item),$item.offset().top+$item.outerHeight(!1)-_this.app.$main_header.outerHeight(!0)<=0}}(this)),$passed=$(passed),totalPassed=$passed.length,totalPassed&&totalPassed%2===0&&this.lastListItemFired!==$($listItems[totalPassed]).attr("id")&&(activeArticle.set("userAction","listItems"),Time.Tracking.article_view(activeArticle.toJSON()),Time.trigger("dfpAdManager:reloadLeftRailAds"),this.lastListItemFired=$($listItems[totalPassed]).attr("id")))}},AdMediator.prototype.renderListAds=function(article){var $articleItem,$el,adSizes,ad_list_index,collection_meta,id,numArticleItem,_ref,_ref1;$el=null!=(_ref=article.views)&&null!=(_ref1=_ref.singleView)?_ref1.$el:void 0,$el&&($el.find(".list_ad").length||(article.list_ads=[],ad_list_index=1,$articleItem=$el.find(".article-item"),numArticleItem=$articleItem.length,id=article.get("id"),$articleItem.each(function(i){var ad_placeholder_id,index;index=parseInt(i,10)+1,index%4===0&&numArticleItem>index&&(ad_placeholder_id="list_ad_"+id+"_"+ad_list_index,$('<li class="list_ad"><div class="list_ad_div" id="'+ad_placeholder_id+'" pos="'+ad_list_index+'"></div></li>').insertAfter($(this)),article.list_ads.push(ad_placeholder_id),ad_list_index+=1)})),adSizes=["300x250"],collection_meta=article.get("collection_meta"),"top-10-everything-of-2014"===(null!=collection_meta?collection_meta.ad_zone:void 0)&&("desktop"===Time.device?adSizes.push("818x450"):"tablet"===Time.device&&"landscape"===Time.application.model.get("orientation")?(adSizes.push("818x450"),adSizes.push("616x400")):("tablet"===Time.device&&"portrait"===Time.application.model.get("orientation")||"mobile"===Time.device)&&adSizes.push("616x400")),_.each(article.list_ads,function(_this){return function(listAdId){return _this.adapters.tgx.activateAd(null,{id:listAdId,size:adSizes,position:$("#"+listAdId).attr("pos"),isCmAd:!1})}}(this)),this.adapters.tgx.displayAds(null,article.list_ads,!0))},AdMediator.prototype.specialStoryActivateAds=function(specialPageView){var adIds;adIds=this.activateSpecialStoryBannerAd(specialPageView),adIds=adIds.concat(specialPageView.isV2?this.activateVisibleSpecialStoryShortcodeAds(specialPageView):this.activateSpecialStoryShortcodeAds(specialPageView)),adIds=adIds.concat(this.activateSpecialStoryCmAds(specialPageView)),this.adapters.tgx.displayAds(null,adIds,!1)},AdMediator.prototype.isVisible=function($parent,child,topBound,bottomBound){var elRect,isAboveBottom,isBelowTop,isBottomVisible,isPartiallyAboveBottom,isPartiallyBelowTop,isTopVisible;return null==topBound&&(topBound=this.app.sizes.headerBottom),null==bottomBound&&(bottomBound=this.app.$body.height()),child instanceof jQuery&&(child=child.get(0)),elRect=child.getBoundingClientRect(),isPartiallyAboveBottom=elRect.top<=bottomBound,isBelowTop=elRect.top-topBound>=0,isTopVisible=isPartiallyAboveBottom&&isBelowTop,isPartiallyBelowTop=elRect.bottom-topBound>=0,isAboveBottom=elRect.bottom<=bottomBound,isBottomVisible=isPartiallyBelowTop&&isAboveBottom,isTopVisible||isBottomVisible||this.isFullyVisible($parent,child,topBound,bottomBound)},AdMediator.prototype.isFullyVisible=function($parent,child,topBound,bottomBound){var elRect,isAboveBottom,isBelowTop,isCovering;return null==topBound&&(topBound=this.app.sizes.headerBottom),null==bottomBound&&(bottomBound=this.app.$body.height()),child instanceof jQuery&&(child=child.get(0)),elRect=child.getBoundingClientRect(),isBelowTop=elRect.top-topBound>=0,isAboveBottom=elRect.bottom<=bottomBound,isCovering=elRect.top<topBound&&elRect.bottom>bottomBound,isBelowTop&&isAboveBottom||isCovering},AdMediator.prototype.findVisibleAds=function($parent,adSelector,topBound,bottomBound){var $allContentAds,adElsInViewport,visibleAdIds;return null==topBound&&(topBound=this.app.sizes.headerBottom),null==bottomBound&&(bottomBound=this.app.$body.height()),$allContentAds=$parent.find(adSelector),adElsInViewport=$allContentAds.filter(function(_this){return function(i,el){return _this.isVisible($parent,el,topBound,bottomBound)}}(this)),visibleAdIds=_.map(adElsInViewport,function(adEl){return adEl.id})},AdMediator.prototype.activateSpecialStoryBannerAd=function(){var adIds;return adIds=[],this.adapters.tgx.activateAd(null,{id:"special-story-banner-ad",size:Time.Ad.getAdSize("special-article-logo"),position:1}),adIds.push("special-story-banner-ad"),adIds},AdMediator.prototype.activateSpecialStoryShortcodeAds=function(){var adIds;return adIds=[],$(".special-article-ad").each(function(_this){return function(index,el){var $ad,sizeKey;return $ad=$(el),sizeKey="special-article-"+$ad.data("size"),_this.adapters.tgx.activateAd(null,{id:el.id,size:Time.Ad.getAdSize(sizeKey),position:$ad.data("pos")}),adIds.push(el.id)}}(this)),adIds},AdMediator.prototype.activateVisibleSpecialStoryShortcodeAds=function(specialPageView){var adIds;return adIds=[],$(".special-article-ad").each(function(_this){return function(index,el){var $ad,sizeKey;if(_this.isVisible(specialPageView.$specialStory,el,specialPageView.headerBottom)&&($ad=$(el),!$ad.data("dfpActivated")))return $ad.data("dfpActivated",!0),sizeKey="special-article-"+$ad.data("size"),_this.adapters.tgx.activateAd(null,{id:el.id,size:Time.Ad.getAdSize(sizeKey),position:$ad.data("pos")}),adIds.push(el.id)}}(this)),adIds},AdMediator.prototype.activateSpecialStoryCmAds=function(){var $cmSubscribeAboveAd,adId,adIds,hasCmAd,hasCmSubscribeAboveAd,hasCmSubscribeAd,id;return adIds=[],id=Time.bootstrap.postID||0,adId="dfpCmadParentsSubscribeabv"+id,$cmSubscribeAboveAd=$("#"+adId),hasCmSubscribeAboveAd=$cmSubscribeAboveAd.length>0,hasCmSubscribeAboveAd&&(this.adapters.tgx.activateAd(null,{id:adId,size:Time.Ad.getAdSize("parents__subscribeabv"),position:"subscribeabv",type:"tout",isCmAd:!0}),adIds.push(adId)),hasCmAd=$("#magazine-cm-module-"+id).length>0,hasCmAd&&(this.adapters.tgx.activateAd(null,{id:"magazine-cm-module-"+id,size:Time.Ad.getAdSize("magazine-cm-module"),position:"submodule",type:"tout",isCmAd:!0}),adIds.push("magazine-cm-module-"+id)),hasCmSubscribeAd=$("#magazine-cm-subscribe-bottom-"+id).length>0,hasCmSubscribeAd&&(this.adapters.tgx.activateAd(null,{id:"magazine-cm-subscribe-bottom-"+id,size:Time.Ad.getAdSize("magazine-cm-subscribe"),position:"subscribeblw",type:"tout",isCmAd:!0}),adIds.push("magazine-cm-subscribe-bottom-"+id)),adIds},AdMediator.prototype.ssv2ActivateNewAdsOnScroll=function(){var adIdsToRefresh,newVisibleAdIds,specialPageView,_ref;if((null!=(_ref=Time.page)?_ref.isV2:void 0)&&(specialPageView=Time.page,newVisibleAdIds=this.activateVisibleSpecialStoryShortcodeAds(specialPageView),null!=newVisibleAdIds?newVisibleAdIds.length:void 0))return adIdsToRefresh=["special-story-banner-ad"].concat(newVisibleAdIds),this.adapters.tgx.displayAds(null,adIdsToRefresh,!1)},AdMediator.prototype.isSsv2AdRefreshNeeded=function(specialPageView,direction){var lpm,refreshDifference;return lpm=specialPageView.lastPassedMarker,lpm===this.ssv2LastRefreshMarker?!1:(refreshDifference=lpm>this.ssv2LastRefreshMarker?lpm-this.ssv2LastRefreshMarker:this.ssv2LastRefreshMarker-lpm,"up"===direction&&(refreshDifference-=this.SSV2_AD_REFRESH_FREQUENCY),refreshDifference<this.SSV2_AD_REFRESH_FREQUENCY?!1:(this.ssv2LastRefreshMarker=lpm,!0))},AdMediator.prototype.ssv2RefreshAds=function(specialPageView,direction,difference){var adIdsToRefresh,visibleAds;this.isSsv2AdRefreshNeeded(specialPageView,direction,difference)&&(visibleAds=this.findVisibleAds(specialPageView.$specialStory,".special-article-ad",specialPageView.headerBottom),(null!=visibleAds?visibleAds.length:void 0)&&(adIdsToRefresh=["special-story-banner-ad"].concat(visibleAds),this.adapters.tgx.displayAds(null,adIdsToRefresh,!1)))},AdMediator.prototype.ssv2OmniturePageview=function(specialPageView){var articleModel,editDate,friendlyUrl,fullUrl,props,_ref,_ref1;articleModel=specialPageView.articleModel,friendlyUrl=articleModel.get("url"),fullUrl=articleModel.get("url"),editDate=articleModel.getEditDate(),props={},props.prop5="",props.prop7="special story",props.prop8=articleModel.id,props.prop12="person of the year 2014",props.prop14=friendlyUrl,props.prop16=null!=(_ref=articleModel.get("section"))?_ref.slug:void 0,props.prop17=fullUrl,props.prop26=editDate,props.prop28=null!=(_ref1=articleModel.get("authors"))?_ref1.join("|"):void 0,props.prop30=articleModel.get("friendly_title"),props.prop64="v2",props.prop69="Person of the Year",props.pageName=props.prop16+"|"+props.prop7+"|"+props.prop30,props.channel="time",this.adapters.omniture.syntheticPageview({props:props})},AdMediator.prototype.ssv2ComscorePageview=function(){this.adapters.comscore.firePageviewCandidate()},AdMediator}();var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.modules.ChartbeatAdapter=function(_super){function ChartbeatAdapter(){return ChartbeatAdapter.__super__.constructor.apply(this,arguments)}return __extends(ChartbeatAdapter,_super),ChartbeatAdapter.prototype.initialChartbeat=!0,ChartbeatAdapter.prototype.initialize=function(options){return null==options&&(options={}),this.app=options.app,this.listenTo(Time,"homepage:initialized",function(_this){return function(){return _this.loadChartbeat()}}(this)),this.listenTo(Time,"vertical:initialized",function(_this){return function(){return _this.loadChartbeat()}}(this)),this.listenTo(Time,"special:ads:activate",function(_this){return function(){return _this.loadChartbeat()}}(this)),this.listenTo(Time,"article:chartbeat",function(_this){return function(url,title,sections,zone,authors){_this.loadChartbeat(url,title,sections,zone,authors)}}(this)),this},ChartbeatAdapter.prototype.loadChartbeat=function(url,title,sections,zone,authors){return Time.tgxAdapter.ENABLED?(window._sf_async_config.path=null!=url?url.replace(Time.home_url,""):void 0,null!=sections&&"money"===Time.branding&&(sections=_.map([sections],function(name){return"Money-"+name.charAt(0).toUpperCase()+name.slice(1)}),sections.unshift("Money"),JSON.stringify(sections),window._sf_async_config.sections=sections),yepnope([{test:window.pSUPERFLY,nope:"http://static.chartbeat.com/js/chartbeat_pub.js",complete:function(_this){return function(){var path;return window.pSUPERFLY&&!_this.initialChartbeat&&(path=url.replace(Time.home_url,""),window._sf_async_config.sections=sections,window._sf_async_config.zone=zone,window._sf_async_config.authors=authors,pSUPERFLY.virtualPage(path,title)),_this.initialChartbeat=!1}}(this)}]),this):void 0},ChartbeatAdapter}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.modules.ComscoreAdapter=function(_super){function ComscoreAdapter(options){return null==options&&(options={}),this.app=options.app,this}return __extends(ComscoreAdapter,_super),ComscoreAdapter.prototype.TAG_TYPE="2",ComscoreAdapter.prototype.CLIENT_ID="6035728",ComscoreAdapter.prototype.firePageviewCandidate=function(){var e,pv_url;try{COMSCORE.beacon({c1:this.TAG_TYPE,c2:this.CLIENT_ID})}catch(_error){return e=_error,console.error("failed to fire comscore beacon"),!1}return pv_url="money"===Time.branding?Time.home_url+"/wp-content/themes/vip/time2014/comscore/money/pageview_candidate.xml":Time.home_url+"/wp-content/themes/vip/time2014/comscore/time/pageview_candidate.xml",$.get(pv_url,{comscorekw:"pageview_candidate",rand:Math.floor(1e6*Math.random())}),!0},ComscoreAdapter}(Backbone.Events);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.modules.NativoAdapter=function(_super){function NativoAdapter(options){return this.app=options.app,this.reset(),this.injectScript(),this}return __extends(NativoAdapter,_super),NativoAdapter.prototype.nativo=null,NativoAdapter.prototype.RETRY_DELAY=2500,NativoAdapter.prototype.FREQUENCY=10,NativoAdapter.prototype.OFFSET=5,NativoAdapter.prototype.totalTiles=1,NativoAdapter.prototype.spotIndex=5,NativoAdapter.prototype.tileId=1e3,NativoAdapter.prototype.injectScript=function(){var articleUUID,nativoTag,rand,root,_base;return(_base=window.top).Nativo||(_base.Nativo={}),window.top.Nativo.pageURL="http://time.com",nativoTag=document.createElement("script"),nativoTag.type="text/javascript",rand=1e9*Math.random(),articleUUID=getParameterByName("ntv_a"),""!==articleUUID?(nativoTag.src="http://adserve.postrelease.com/index.js?async=true&prx_url="+window.top.Nativo.pageURL+"&ntv_a="+articleUUID+"&rand="+rand,window.top.Nativo.onArticlesReady=function(_this){return function(response){return _this.initOnArchiveReady(response)}}(this)):(nativoTag.src="http://adserve.postrelease.com/init.js?async=true&prx_url="+window.top.location.href+"&rand="+rand,window.top.Nativo.onArticlesReady=function(_this){return function(response){return _this.initOnToutsReady(response)}}(this)),root=document.body.getElementsByTagName("script")[0],root.parentNode.insertBefore(nativoTag,root),this},NativoAdapter.prototype.reset=function(){return this.spotIndex=this.OFFSET,this.totalTiles=1,this},NativoAdapter.prototype.initOnToutsReady=function(response){var article,data,_ref;return console.debug("nativo touts ready",response),article=(null!=(_ref=response.articles)?_ref[0]:void 0)||{},data=this.getArticleData(article),_.isEmpty(data)||null==this.app.active_rail||(data.placement=this.app.active_rail.first().get("sponsor")?this.spotIndex-1:this.spotIndex,data.is_nativo_page=!1,this.app.active_rail.add(data)),this.updateNativoSpot(),this},NativoAdapter.prototype.initOnArchiveReady=function(response){var articles,_ref,_ref1;return console.debug("nativo archive ready",response),articles=_.map(response.articles,function(_this){return function(article){var data;return data=_this.getArticleData(article),data.is_nativo_page=!0,data}}(this)),null!=(_ref=this.app.active_rail)&&_ref.add(articles),null!=(_ref1=this.app.active_rail)&&_ref1.reached_page_limit(),this},NativoAdapter.prototype.sanitizeKey=function(value){return value.replace(/[^\w,]/g,"").toLowerCase()},NativoAdapter.prototype.getArticleData=function(data){var advertiser_slug_name,articleUrl,datetime,encoded_title,encoded_url,id,relativePath,result,source,title,url;return _.isEmpty(data)?{}:(id=data.article_id,this.tileId&&(id="s"+this.tileId),this.tileId+=1,data.advertiser_name&&(advertiser_slug_name=this.sanitizeKey(data.advertiser_name)),data.article_title&&(encoded_title=encodeURIComponent(data.article_title)),articleUrl=[Time.home_url],this.app.isMoney()&&articleUrl.push("money"),relativePath=data.article_relative_url,relativePath=relativePath.replace(/^\/(money\/)?/,""),-1!==relativePath.indexOf("sponsored-from/")?(title=relativePath.replace(/\/?sponsored-from\//,""),articleUrl.push("content-from",advertiser_slug_name,id,title)):articleUrl.push(relativePath),url=articleUrl.join("/"),encoded_url=encodeURIComponent(url),source="TIME",this.app.isMoney()&&(source="MONEY"),result={},result.title=data.article_title,result.short_title=data.preview_headline,result.content=data.article,result.id=id,result.format="article",result.email_title=encodeURIComponent(data.article_title+" | "+source),result.email_body=encodeURIComponent(data.article_title+"\n"+data.preview_text+"...\n\n"+url),result.nativo_key=data.article_key,result.nativo_preview_image=data.preview_image,result.nativo_preview_text=data.preview_text,result.twitter_text=data.preview_headline,result.encoded_shortlink=url,result.url=url,result.twitter_via=Time.branding.toUpperCase(),result.encoded_url=encoded_url,result.encoded_title=encoded_title,result.is_nativo=!0,result.sponsor={url:data.advertiser_url,name:data.advertiser_name,color:"",slug:advertiser_slug_name,thumbnail:data.advertiser_logo},this.app.isMoney()&&(result.sponsor.vertical="money"),datetime=data.article_date+" "+data.article_time,result.time={pretty:datetime,published:datetime,updated:"",minute:"","short":""},result)},NativoAdapter.prototype.updateNativoSpot=function(){return this.spotIndex+=this.FREQUENCY,this.spotIndex},NativoAdapter}(Backbone.Events);var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.modules.OmnitureAdapter=function(_super){function OmnitureAdapter(options){return null==options&&(options={}),this.handlePinnionEvent=__bind(this.handlePinnionEvent,this),OmnitureAdapter.__super__.constructor.apply(this,arguments),this.app=options.app,this.isRailInitialized=!1,this.listenTo(this.app.model,"change:isRailOpen",function(_this){return function(){_this.isRailInitialized&&(_this.listenTo(Time,"leftRail:opened",function(){return omniTrackEv("mobi-expose")}),_this.listenTo(Time,"leftRail:closed",function(){return omniTrackEv("mobi-close")}),_this.stopListening(_this.app.model,"change:isRailOpen")),_this.isRailInitialized=!0}}(this)),this.app.$window.on("pinnionEvent",this.handlePinnionEvent),this}return __extends(OmnitureAdapter,_super),OmnitureAdapter.prototype.handlePinnionEvent=function(event){var POY_OMNITURE_MAP,eventData,isLeftRailModule,lrmPrefix,omniData,value,_base,_ref,_ref1,_ref2,_ref3,_ref4;null!=(null!=event&&null!=(_ref=event.originalEvent)?_ref.data:void 0)&&(eventData=JSON.parse(event.originalEvent.data),isLeftRailModule=-1!==eventData.location_href.indexOf("leftRailModule"),lrmPrefix="",isLeftRailModule&&(lrmPrefix="lr_"),POY_OMNITURE_MAP={12836:{url:"http://time.com/3562179/time-person-of-the-year-poll/",prefix:"ynpoll_",name:"Vote Now: Who Should Be TIME’s Person of the Year?",id:3562179},12833:{url:" http://time.com/3562166/time-person-of…-face-off-poll/",prefix:"fpoll_",name:"Face-Off: Who Should Be TIME’s Person of the Year?",id:3562166}},(null!=(_ref1=eventData.events)?_ref1.q_advance:void 0)||(null!=(_ref2=eventData.events)?_ref2.q_previous:void 0)?value="scroll":(null!=(_ref3=eventData.events)?_ref3.q_resp_change:void 0)?value="vote":(null!=(_ref4=eventData.events)?_ref4.link_clicked:void 0)&&(value="fb"),value&&"function"==typeof omniTrackEv&&omniTrackEv(lrmPrefix+POY_OMNITURE_MAP[eventData.survey_id].prefix+value),"scroll"!==value||isLeftRailModule||(omniData=this.model.get("activeArticle").toJSON(),omniData.userAction="poll",omniData.format="poll",omniData.url=POY_OMNITURE_MAP[eventData.survey_id].url,omniData.friendly_title=POY_OMNITURE_MAP[eventData.survey_id].name,omniData.id=POY_OMNITURE_MAP[eventData.survey_id].id,"function"==typeof(_base=Time.Tracking).article_view&&_base.article_view(omniData),Time.trigger("dfpAdManager:reloadLeftRailAds")))},OmnitureAdapter.prototype.syntheticPageview=function(data){null==data&&(data={}),"props"in data&&(window.s_time||(window.s_time={}),_.extend(window.s_time,data.props),s_time.t())},OmnitureAdapter}(Backbone.View);var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};Time.modules.TgxAdapter=function(_super){function TgxAdapter(){return this.onReadingPaneScrolled=__bind(this.onReadingPaneScrolled,this),TgxAdapter.__super__.constructor.apply(this,arguments)}return __extends(TgxAdapter,_super),TgxAdapter.prototype.DEBUG=!0,TgxAdapter.prototype.enqueuedAds=[],TgxAdapter.prototype._displayAdsTimeout=null,TgxAdapter.prototype.initialize=function(options){return null==options&&(options={}),this.app=options.app,this.ENABLED=options.enabled||!0,"undefined"==typeof TiiAdConfig?(console.error("-- init -- TiiAdConfig/TGX not defined"),this.ENABLED=!1,this):"true"===localStorage.noads?(console.error("-- init -- noads is set"),this.ENABLED=!1,this):this.ENABLED?(this.PRESERVED_AD_PARAMS=["pos","cmpos","ad_div","cmtyp","etype","slide","poll"],this.DISPLAY_DELAY_CONSTANT=!1,this.DISPLAY_DELAY=500,this.DISPLAY_DELAYS={mobile:300,tablet:300,desktop:300},this.DISPLAY_DELAY_MAX=900,this.COMPANION_SIZE_WHITELIST=[["300x251","450x375","728x90","900x250","900x500","970x418","994x250"].join("|")],this.displayQueue=[],this.isRefreshAdsEnqueued=!1,this.adCollection=new Time.collections.DfpAds,this.TOP_BANNER_HEIGHT=null,this.setTopBannerHeight(),$("html").toggleClass("debugads","1"===("undefined"!=typeof localStorage&&null!==localStorage?localStorage.debugads:void 0)),$("body").addClass("hasAd"),"desktop"===Time.device&&$("body").addClass("expandable-ad-enable"),this.bindListeners(),this):(console.error("-- init -- ads disabled"),this)},TgxAdapter.prototype.setTopBannerHeight=function(){return this.TOP_BANNER_HEIGHT=$("body").find(".top-banner").eq(0).height(),this.TOP_BANNER_HEIGHT},TgxAdapter.prototype.bindListeners=function(){return this.listenTo(Time,"dfpAdManager:syncWithLeftRail",function(_this){return function(articleModel,adDivIds,callback){return null==callback&&(callback=!1),_this.syncWithLeftRail(articleModel,adDivIds,callback)}}(this)),this.listenTo(Time,"dfpAdManager:refreshAds",function(_this){return function(articleModel,adDivIds,callback){return null==callback&&(callback=!1),_this.refreshAds(articleModel,adDivIds,callback)}}(this)),this.listenTo(Time,"dfpAdManager:setAdParams",function(_this){return function(query,params){return _this.setAdParams(query,params)}}(this)),this.listenTo(Time,"dfpAdManager:activateAd",function(_this){return function(articleModel,params,callback){null==params&&(params={}),null==callback&&(callback=!1),_this.activateAd(articleModel,params),"function"==typeof callback&&callback(),callback===!0&&_this.refreshAds(articleModel,[params.id])}}(this)),this.listenTo(Time,"dfpAdManager:deleteAd",function(_this){return function(id){return _this.deleteAd(id)}}(this)),this.listenTo(Time,"readingPane:scrolled",this.onReadingPaneScrolled),this.listenTo(Time,"dfpAdManager:removeAds",function(_this){return function(){return _this.removeAds()}}(this)),this.listenTo(Time,"dfpAdManager:setInitialAppLoad",function(value){Time.Ad.set_initial_app_load(value)}),this.listenTo(Time,"dfpAdManager:setInitialLeftRailLoad",function(value){this.model.set("isInitialLeftRailCycle",value)}),this.listenTo(Time,"dfpAdManager:reloadLeftRailAds",function(){Time.Ad.reload_left_rail_ads()}),this.listenTo(Time,"dfpAdManager:renderHomepageLeftRailAd",function(placeholderId,data){Time.Ad.render_homepage_left_rail_ad(placeholderId,data)}),this.listenTo(Time,"dfpAdManager:activateHomepageAds",function(){Time.Ad.activate_homepage_ads()}),this.listenTo(Time,"dfpAdManager:renderLeftRailAd",function(adId){Time.Ad.render_left_rail_ad(adId)}),this.listenTo(Time,"article:deactivated",function(_this){return function(articleView){return _this.onDeactivateArticle(articleView)}}(this)),this.listenTo(Time,"gallery:slide:activated gallery:slides:loadedMore",function(_this){return function(galleryModel,articleView){return _this.onChangeGallerySlide(galleryModel,articleView)}}(this)),this.listenTo(Time,"article:deactivated",function(_this){return function(){return _this.setAdParams({group:"leftRail"},{etype:""})}}(this)),this.listenTo(Time,"sectionfront:ads:activate",function(_this){return function(sectionFrontAdSelector){var ads,wW;ads=[],wW=_this.app.$window.width(),$(sectionFrontAdSelector).each(function(){return wW>600&&"mobile"!==$(this).data("viewport")||600>wW&&"mobile"===$(this).data("viewport")?(ads.push($(this).attr("id")),_this.activateAd(null,{id:$(this).attr("id"),size:[$(this).data("size")],position:$(this).data("position"),type:$(this).data("type"),isCmAd:$(this).data("cmad")})):void 0}),_this.displayAds(null,ads)}}(this)),this.listenTo(Time,"vertical:ads:activate",function(vertical){Time.Ad.activate_vertical_homepage_ads(vertical)}),this.listenTo(Time,"parents:ads:activate",function(_this){return function(parentAdSelector){var ads;ads=[],$(parentAdSelector).each(function(){return ads.push($(this).attr("id")),_this.activateAd(null,{id:$(this).attr("id"),size:[$(this).data("size")],position:$(this).data("position"),type:$(this).data("type"),isCmAd:$(this).data("cmad")})
}),_this.displayAds(null,ads)}}(this)),this.listenTo(Time,"application:rendered",function(_this){return function(){_this.onApplicationRendered()}}(this)),this.listenTo(Time,"dfpAdManager:callback",function(){Tether.position()}),this.listenToOnce(Time,"application:rendered",function(_this){return function(){_this.listenTo(Time,"leftRail:scroll",function(){return _this.app.model.get("isRailOpen")?Tether.position():void 0})}}(this)),this.listenTo(Time,"dfpAdManager:createLeftRailAd",function(options){this.createLeftRailAd(options)}),this.listenTo(this.model,"change:isInitialLeftRailCycle",function(model,value){Time.application.is_homepage=!1,value&&Time.Ad.remove_ads()}),this},TgxAdapter.prototype.createLeftRailAd=function(options){var $ad,$placeholder,adTether,isCollapsed,placeholderSelector,tetherOptions;"desktop"===Time.device&&($("#"+options.id).data("tether")||($ad=$("<div />",options),$ad.data("pos",options.pos),placeholderSelector="#"+options["data-ad_placeholder_id"],$ad.appendTo(placeholderSelector),$placeholder=$(placeholderSelector),isCollapsed=!1,$placeholder.closest(".leftRailModule--collapsible--collapsed").length&&(isCollapsed=!0),$ad.toggleClass("leftRailModule--collapsible__collapsedAd",isCollapsed).data("collapsed",isCollapsed),tetherOptions={enabled:!isCollapsed,element:$ad,target:placeholderSelector,attachment:"top left",targetAttachment:"top left",targetOffset:"10px 9px",optimizations:{gpu:"desktop"!==Time.device,moveElement:"mobile"!==Time.device},constraints:[{to:"scrollParent"}]},adTether=new Tether(tetherOptions),$ad.data("tether",adTether),$placeholder.data("tether",adTether)))},TgxAdapter.prototype.bindLeftRailAds=function(){return this.listenTo(Time,"leftRail:opened",function(_this){return function(){var adIds,unrenderedLeftRailAds;unrenderedLeftRailAds=_this.adCollection.where({group:"leftRail",isRendered:!1}),adIds=_.pluck(unrenderedLeftRailAds,"id"),adIds.length&&_this.refreshAds(null,adIds,function(){return Tether.position()})}}(this)),this.listenTo(Time,"leftRail:scroll",function(_this){return function(railView){var $ads,unrenderedLeftRailAdPositions,unrenderedLeftRailAds,visibleAdIds,visibleAdModels,visibleAdPositions,visibleUnrenderedLeftRailAds;$ads=railView.getAdsInViewport(),visibleAdPositions=_.map($ads,function(adEl){return $(adEl).attr("pos")}),unrenderedLeftRailAds=_this.adCollection.where({group:"leftRail",isRendered:!1}),unrenderedLeftRailAdPositions=_.map(unrenderedLeftRailAds,function(adModel){return adModel.get("position")}),visibleUnrenderedLeftRailAds=_.intersection(visibleAdPositions,unrenderedLeftRailAdPositions),visibleAdModels=_this.adCollection.filter(function(adModel){var _ref;return _ref=adModel.get("position"),__indexOf.call(visibleUnrenderedLeftRailAds,_ref)>=0}),visibleAdIds=_.map(visibleAdModels,function(adModel){return adModel.id}),_this.displayAds(null,visibleAdIds)}}(this))},TgxAdapter.prototype.onApplicationRendered=function(){this.listenToOnce(this.model,"change:isInitialAdCycle",function(_this){return function(){_this.bindLeftRailAds()}}(this)),this.listenTo(Time,"leftRail:flush",function(_this){return function(){_this.model.set("isInitialLeftRailCycle",!0),Time.models.Divider.index=0,Time.models.Divider.bootstrap_index=0}}(this)),this.listenTo(Time,"leftRail:tile:rendered",function(tileView){var adId,collection,collectionLength,isLastTile,isMetAdFrequency,railView,tileIndex;return collection=tileView.collection,railView=collection.view,collectionLength=collection.length,tileIndex=collection.indexOf(tileView.model),isMetAdFrequency=tileIndex?tileIndex%collection.adFrequency===collection.adOffset:!1,isLastTile=tileIndex===collectionLength-1,"collections"===tileView.type?void(isMetAdFrequency&&(adId=railView.appendAd(tileView.el),Time.Ad.render_left_rail_ad(adId))):void(5>collectionLength&&isLastTile&&"popular"!==collection.active_env?(adId=railView.appendAd(tileView.el),Time.Ad.render_left_rail_ad(adId)):isMetAdFrequency&&(adId=railView.appendAd(tileView.el),Time.Ad.render_left_rail_ad(adId)))}),this.listenTo(Time,"leftRail:filter:before",function(_this){return function(){var leftRailAds,leftRailAdsToRemove;leftRailAds=_this.adCollection.where({group:"leftRail"}),leftRailAdsToRemove=_.reject(leftRailAds,function(ad){return"0"===ad.get("position")}),_this.removeAds(leftRailAdsToRemove),_this.app.active_rail.ad_in_left_rail=0,_this.app.active_rail.real_article_index=0}}(this))},TgxAdapter.prototype.onReadingPaneScrolled=function(){var activeArticle,fourthItemOffset,listItems,offsetPadding;activeArticle=this.model.get("activeArticle"),null!=activeArticle&&"list"===activeArticle.get("format")&&(listItems=activeArticle.get("list_items"),offsetPadding=70,fourthItemOffset=$("#"+listItems[3].id).offset(),fourthItemOffset.top>offsetPadding&&fourthItemOffset.top-offsetPadding<this.$notHeader.get(0).scrollTop&&Time.Ad.reload_left_rail_ads())},TgxAdapter.prototype.removeAds=function(adModels){var articleGroups;return null==adModels&&(adModels=null),adModels||(articleGroups=["contentWell","dividers","gallery","leftRail","listAds","rightRail"],adModels=this.adCollection.filter(function(model){return _.contains(articleGroups,model.get("group"))})),_.each(adModels,function(_this){return function(model){var $el,placeholderId;return $el=$("#"+model.id),$el.length&&(placeholderId=$el.data("ad_placeholder_id"),placeholderId&&$("#"+placeholderId).remove(),$el.remove()),null!=model&&model.set("adInstance",null),_this.adCollection.remove(model),model=null}}(this)),this},TgxAdapter.prototype.onDeactivateArticle=function(articleView){var articleId,articleModel,dividerId,dividerModel,dividerView;if(null!=articleView.divider&&(dividerView=articleView.divider,dividerModel=dividerView.model,dividerId=dividerModel.get("divId")))return articleModel=articleView.model,articleId=articleModel.id,this.deleteAd(dividerId),this},TgxAdapter.prototype.onChangeGallerySlide=function(galleryModel,articleView){var adDivIds;if(!(articleView.model.get("galleriesRendered")<articleView.galleriesCollection.size()))return adDivIds=this.adCollection.getIds({isActive:!0,isTrigger:!1,groups:["gallery"]}),this.syncWithLeftRail(articleView.model,adDivIds),this},TgxAdapter.prototype.prioritizeGroups=function(adDivIds){var divGroups,prioritizedDivIds,priority;return priority=["mobileTopAd","leftRail"],divGroups=_.groupBy(adDivIds,function(_this){return function(id){var adModel,group;return(adModel=_this.adCollection.get(id))?(group=adModel.get("group"),_.contains(priority,group)?group:"others"):"others"}}(this)),prioritizedDivIds=[],_.each(priority,function(group){return null!=divGroups[group]?prioritizedDivIds=prioritizedDivIds.concat(divGroups[group]):void 0}),null!=divGroups.others&&(prioritizedDivIds=prioritizedDivIds.concat(divGroups.others)),prioritizedDivIds},TgxAdapter.prototype.setAdParams=function(query,params){var adModels;adModels=this.adCollection.where(query),_.each(adModels,function(adModel){var adInstance,key,value,_results;if(adInstance=adModel.get("adInstance"),!adInstance)return void console.error("no adInstance on model",adModel);_results=[];for(key in params)value=params[key],_results.push(adInstance.setParam(key,value));return _results})},TgxAdapter.prototype.toAdModel=function(params,articleModel){var attributes,_ref,_ref1;return null==params&&(params={}),attributes=_.extend({},params),null!=articleModel&&(attributes.articleId=articleModel.id,("video"===articleModel.get("format")||articleModel.get("totalVideos"))&&(attributes.isCompanion="leftRail"===attributes.group&&"1"===attributes.position,null==this.foundCompanionDivider&&(attributes.isCompanion||(attributes.isCompanion=(_ref=null!=(_ref1=attributes.size)?_ref1.join("|"):void 0,__indexOf.call(this.COMPANION_SIZE_WHITELIST,_ref)>=0))),attributes.isCompanion&&"dividers"===attributes.group&&(this.foundCompanionDivider=!0))),attributes},TgxAdapter.prototype.activateAd=function(articleModel,params){var $el,adInstance,adModel,attributes,factoryInstance;return articleModel||(articleModel=Time.application.model.get("activeArticle")),$el=$("#"+params.id),$el.length?(tgxDo.slots[params.id]&&this.deleteAd(params.id),null!=params.position&&(params.position=params.position+""),this.DEBUG&&console.debug("TgxAdapter -- activateAd",params),attributes=this.toAdModel(params,articleModel),adModel=this.adCollection.push(attributes),adInstance=adModel.get("adInstance"),adInstance||(factoryInstance=this.model.getFactory(),this.model.maybeResetFactory(factoryInstance,articleModel),adInstance=this.getAd(factoryInstance,params),adModel.set("adInstance",adInstance)),adInstance&&(this.writeAd(factoryInstance,adModel,params),adModel.set("isActive",!0)),adModel):(console.error("Not activating ad "+params.id+" -- no div for it"),!1)},TgxAdapter.prototype.activateContentAd=function(articleView){var articleId,articleModel,params;return articleModel=articleView.model,articleId=articleModel.id,this.DEBUG&&console.debug("activateContentAd",articleModel.id),params={id:"content-ad-"+articleId,position:"1",group:"contentWell"},params.size=Time.Ad.getAdSize("content-ad"),params.subgroup="inContent",this.activateAd(articleModel,params),this},TgxAdapter.prototype.activateDividerAd=function(articleView){var articleId,articleModel,dividerId,dividerModel,dividerView,params;if(null!=articleView.divider&&(dividerView=articleView.divider,dividerModel=dividerView.model,dividerId=dividerModel.get("divId")))return articleModel=articleView.model,articleId=articleModel.id,params={id:dividerId,position:"1",group:"dividers"},params.size=Time.Ad.getAdSize("ad-divider"),params.subgroup="advertisement",-1!==dividerId.indexOf("300x600")&&(params.size=Time.Ad.getAdSize("in-article"),params.subgroup="article"),"collection"===this.app.active_route&&(params.size=Time.Ad.getAdSize("collection-ad-divider"),params.subgroup="collection"),this.activateAd(articleModel,params),this},TgxAdapter.prototype.deleteAd=function(id){var $el,adModel,error;if(this.enqueuedAds=_.without(this.enqueuedAds,id),$el=$("#"+id),$el.find("iframe").each(function(){return $(this).attr("src","about:blank")}),$el.length&&$el.css("height",$el.height()),$el.empty(),adModel=this.adCollection.get(id),!adModel)return void console.warn("-- deleteAd -- Ad "+id+" not in collection for delete");adModel.set("adInstance",null),this.adCollection.remove(id);try{delete tgxDo.slots[id]}catch(_error){error=_error,console.warn("-- deleteAd -- could not delete ad id "+id+" from tgxDo")}this.DEBUG&&console.debug("-- deleteAd -- "+id+" deleted")},TgxAdapter.prototype.hasAd=function(id){var result,_ref;return result=("undefined"!=typeof tgxDo&&null!==tgxDo&&null!=(_ref=tgxDo.slots)?_ref[id]:void 0)?!0:!1},TgxAdapter.prototype.getAd=function(factory,params){var ad,cmpos,cmtyp,dim,error;if(this.hasAd(params.id))return console.error("DfpAdManagerView getAd - already got ad",params),null;if(!params.hasOwnProperty("id"))return console.error("-- getAd params needs an id",params),null;if(!params.hasOwnProperty("size")||"object"!=typeof params.size)return console.error("-- getAd params needs a size array of strings",params),null;dim=params.size[0].split("x");try{return params.isCmAd?(cmpos=params.cmpos||params.position,cmtyp=params.cmtyp||params.type,ad=factory.getCmAd(dim[0],dim[1],cmpos,cmtyp)):ad=factory.getAd(dim[0],dim[1]),ad}catch(_error){return error=_error,console.error("-- getAd could not get ad with params ",params),null}},TgxAdapter.prototype.getAdEl=function(id){var $el,selector;return selector="#"+id,$el=$(selector),$el.length||console.error("DfpAdManagerView - getAdEl - couldn't find element in DOM",selector),$el},TgxAdapter.prototype.writeAd=function(factory,adModel,params){var $el,ad,error;if(ad=adModel.get("adInstance"),$el=this.getAdEl(params.id),!$el.length)return console.error("-- writeAd - couldn't find element in DOM",params.id),ad;$el.data("pos",params.position);try{params.size.length>1&&ad.setParam("sz",params.size.join(",")),ad.setParam("pos",params.position),ad.setParam("ad_div",params.id),null!=(null!=params?params.group:void 0)&&"gallery"===params.group?(ad.setParam("etype","gallery"),null!=params.slide&&ad.setParam("slide",params.slide)):(ad.setParam("etype",""),ad.setParam("slide","")),null!=params.extraParams&&_.each(params.extraParams,function(value,key){return ad.setParam(key,value)}),adModel.get("isCompanion")?ad.write(params.id,"companion"):ad.write(params.id)}catch(_error){error=_error,console.error("-- writeAd - could not write ad",ad,params,error)}return ad},TgxAdapter.prototype.isAdWritten=function(adDivId){return tgxDo.slots.hasOwnProperty(adDivId)},TgxAdapter.prototype.syncWithLeftRail=function(articleModel,adDivIds,callback){var leftRailAds;return null==this.app.active_rail||this.app.model.get("isFullscreen")||(leftRailAds=Time.Ad.getLeftRailAds(),adDivIds=_.union(adDivIds,leftRailAds)),this.refreshAds(articleModel,adDivIds,callback),this},TgxAdapter.prototype.refreshAds=function(articleModel,adDivIds,callback){var isImmediate;if(!(null!=adDivIds?adDivIds.length:void 0))return void console.error("-- refreshAds needs ad div ids");if(adDivIds.length)return isImmediate="function"!=typeof callback?callback:!1,this.DEBUG&&console.debug("-- refreshAds with divs:",adDivIds),this.displayAds(articleModel,adDivIds,isImmediate),"function"==typeof callback&&callback(),this},TgxAdapter.prototype.prepFactoryForDisplay=function(articleModel){var factoryInstance;return factoryInstance=this.model.getFactory(),null==factoryInstance?(console.error("-- displayAds -- needs a valid factory",articleModel),this):(this.model.maybeResetFactory(factoryInstance,articleModel),this.model.setFactorySegments(factoryInstance),factoryInstance)},TgxAdapter.prototype.getJqueryObjsByModels=function(adModels){var nodes;return nodes=_.map(adModels,function(m){return document.getElementById(m.id)}),$(nodes)},TgxAdapter.prototype.getJqueryObjsByIds=function(ids){var nodes;return nodes=[],_.each(ids,function(i){return document.getElementById(i)?nodes.push(document.getElementById(i)):void 0}),$(nodes)},TgxAdapter.prototype.displayAds=function(articleModel,adDivIds,isImmediate){var timeoutDelay,_ref,_ref1;return null==isImmediate&&(isImmediate=!1),adDivIds||(adDivIds=this.adCollection.getIds({isActive:!0,isTrigger:!1})),adDivIds.length?((null!=(_ref=this.app.model.get("activeArticle"))?_ref.get("galleriesRendered"):void 0)?this.setAdParams({group:"leftRail"},{etype:"gallery"}):this.setAdParams({group:"leftRail"},{etype:""}),_.each(adDivIds,function(_this){return function(id){var adModel;adModel=_this.adCollection.get(id),null!=adModel&&adModel.set("isRendered",!0),(null!=adModel?adModel.get("renderOnce"):void 0)&&null!=adModel&&adModel.set("isActive",!1)}}(this)),__indexOf.call(adDivIds,"pushdown-ad")>=0&&null!=(_ref1=this.adCollection.get("pushdown-ad"))&&_ref1.set("isActive",!1),isImmediate?(_.defer(function(_this){return function(){var factoryInstance;return factoryInstance=_this.prepFactoryForDisplay(articleModel),_this._deferredDisplayAds(factoryInstance,adDivIds)}}(this)),this):(this.enqueuedAds=_.uniq(this.enqueuedAds.concat(_.compact(adDivIds))),this.DISPLAY_DELAY_CONSTANT?timeoutDelay=this.DISPLAY_DELAY:(timeoutDelay=this.DISPLAY_DELAYS[Time.device]*this.enqueuedAds.length,timeoutDelay>this.DISPLAY_DELAY_MAX&&(timeoutDelay=this.DISPLAY_DELAY_MAX)),window.clearTimeout(this._displayAdsTimeout),this._displayAdsTimeout=window.setTimeout(function(_this){return function(){var $els,factoryInstance;return factoryInstance=_this.prepFactoryForDisplay(articleModel),_this._deferredDisplayAds(factoryInstance,_this.enqueuedAds),_this.enqueuedAds.length=0,$els=_this.getJqueryObjsByIds(_this.enqueuedAds),$els?$els.removeClass("hide-ad"):void 0}}(this),timeoutDelay),this)):this},TgxAdapter.prototype.loadNativoTrigger=function(){var error,originalOOP;this.DEBUG&&console.debug("clear refresh nativo"),originalOOP=window.TGX_SITE_CONFIG.refresh_oop_slot,window.TGX_SITE_CONFIG.refresh_oop_slot=!1;try{this.model.getFactory().clearRefreshAds(["nativo-trigger"],this.PRESERVED_AD_PARAMS)}catch(_error){error=_error,console.error("-- loadNativoTrigger failed to refresh",error)}return window.TGX_SITE_CONFIG.refresh_oop_slot=originalOOP,Time.trigger("nativo:afterRefresh"),this},TgxAdapter.prototype.removeIdsOfUnwrittenAds=function(adDivIds){var id,index,_i,_len,_ref;for(index=_i=0,_len=adDivIds.length;_len>_i;index=++_i)id=adDivIds[index],("undefined"!=typeof tgxDo&&null!==tgxDo&&null!=(_ref=tgxDo.slots)?_ref.hasOwnProperty(id):void 0)||(adDivIds.splice(index,1),console.error("-- removeIds... -- "+id+" is not in tgxDo for some reason"));return this.DEBUG&&console.debug("-- removeIds... -- error checked left",adDivIds,adDivIds.length),adDivIds},TgxAdapter.prototype._deferredDisplayAds=function(factoryInstance,adDivIds){var error,prioritizedIds,sanitizedIds;if(sanitizedIds=this.removeIdsOfUnwrittenAds(adDivIds),prioritizedIds=this.prioritizeGroups(sanitizedIds),0===prioritizedIds.length)return void console.error("-- deferredDisplayAds -- no div ids to refresh");this.DEBUG&&console.debug("-- _deferredDisplayAds -- clearRefreshAds with",prioritizedIds,"OOP:",window.TGX_SITE_CONFIG.refresh_oop_slot);try{factoryInstance.clearRefreshAds(prioritizedIds,this.PRESERVED_AD_PARAMS)}catch(_error){error=_error,console.error("-- _deferredDisplayAds -- could not clearRefreshAds",prioritizedIds,error)}return Time.trigger("dfpAdManager:afterDisplay",prioritizedIds),this},TgxAdapter}(Backbone.View),Time.component.Dropdown=function(){function Dropdown(elSelector,options){return this.$el=$(elSelector),this.opts=$.extend(!0,{},this.opts,options),this.$el.on("touchend.dropdown-"+this.opts.classToAdd+" click.dropdown-"+this.opts.classToAdd,function(_this){return function(evt){return _this.toggle(evt)}}(this)),this}return Dropdown.prototype.opts={parentSelector:"body",classToAdd:"show-nav",menuSelector:".main-nav",handleClickOutside:!0},Dropdown.isShowing=!1,Dropdown.prototype.$html=$("html"),Dropdown.prototype.show=function(evt){return evt&&evt.preventDefault(),$(this.opts.parentSelector).addClass(this.opts.classToAdd),this.isShowing=!0,this.opts.handleClickOutside&&this.bindClose(evt),$(this.opts.menuSelector).trigger("shown"),$(".scroll-for-more").hide(),this.$el},Dropdown.prototype.hide=function(evt){return evt&&evt.preventDefault(),$(this.opts.parentSelector).removeClass(this.opts.classToAdd),$(this.opts.menuSelector).trigger("hidden"),this.isShowing=!1,Time.application.model.get("isRailOpen")&&($(".scroll-for-more").appendTo("body"),$(".scroll-for-more").show()),this.$el},Dropdown.prototype.bindClose=function(e){return $("html").on("click.dropdown-"+this.opts.classToAdd,function(_this){return function(){var $targ,targetIsNotDropdown,targetsNotAChildOfDropdown;return $targ=$(e.target||window.event.srcElement),targetIsNotDropdown=!$targ.is(_this.opts.menuSelector),targetsNotAChildOfDropdown=0===$(_this.opts.menuSelector).has($targ).length,targetIsNotDropdown&&targetsNotAChildOfDropdown?($("html").off(".dropdown-"+_this.opts.classToAdd),_this.hide()):void 0}}(this)),this},Dropdown.prototype.toggle=function(evt){return evt&&evt.preventDefault(),this.isShowing?(this.$el.trigger("clicked-close"),this.hide(evt)):(this.$el.trigger("clicked-open"),this.show(evt))},Dropdown.prototype.destroy=function(){return this.$el.off("dropdown-"+this.opts.classToAdd),$.removeData(this.$el,"Dropdown Navigation MobileNavigation"),$("html").off("dropdown-"+this.opts.classToAdd)},Dropdown}(),Time.component.Gallery=function(){function Gallery(){}return Gallery.prototype.initComponent=function(index){var that;return this.curr_index=index?index:0,this.max_index=this.$items.length-1,this.$counter_total&&this.setCounterTotal(),that=this,Modernizr.touch&&(this.$el.touchwipe({wipeLeft:$.proxy(that.advance,that),wipeRight:$.proxy(that.recede,that),min_move_x:6,min_move_y:6,preventDefaultEvents:!1}),this.$el.click(that.advance,that)),this.updatePositionalClasses(!0),this.trigger("gallery:initComponent")},Gallery.prototype.auto_play=function(milliseconds){return null==milliseconds&&(milliseconds=500),this.timerID&&clearTimeout(this.timerID),this.timerID=setTimeout(function(_this){return function(){return _this.advance()}}(this),milliseconds)},Gallery.prototype.advance=function(e){e&&e.preventDefault(),this.curr_index++,this.curr_index>this.max_index?this.circular?(this.curr_index=0,this.updatePositionalClasses()):this.handle_end():this.updatePositionalClasses()},Gallery.prototype.recede=function(e){e&&e.preventDefault(),this.curr_index--,this.curr_index<0?this.circular?(this.curr_index=this.max_index,this.updatePositionalClasses()):this.handle_beginning():this.updatePositionalClasses()},Gallery.prototype.goto_index=function(index){return this.curr_index=index,this.updatePositionalClasses()},Gallery.prototype.goto_start=function(){return this.goto_index(0)},Gallery.prototype.goto_end=function(){return this.goto_index(this.max_index)},Gallery.prototype.handle_end=function(){return this.trigger("gallery:max_limit"),this.goto_end()},Gallery.prototype.handle_beginning=function(){return this.trigger("gallery:min_limit"),this.goto_start()},Gallery.prototype.updatePositionalClasses=function(){var $el,i,_i,_len,_ref;for(this.trigger("gallery:beforeUpdatePositionalClasses",this),"undefined"!=typeof console&&null!==console&&console.log("Gallery component - update positional classes"),_ref=this.$items,i=_i=0,_len=_ref.length;_len>_i;i=++_i)$el=_ref[i],i<this.curr_index&&$el.addClass("passed").removeClass("current upcoming"),i===this.curr_index&&$el.addClass("current").removeClass("passed upcoming").trigger("isCurrent"),i>this.curr_index&&$el.addClass("upcoming").removeClass("passed current");return this.trigger("gallery:afterUpdatePositionalClasses",this),this.curr_index===this.max_index?this.trigger("gallery:last"):void 0},Gallery.prototype.getCurrentItem=function(){return this.$items[this.curr_index]},Gallery.prototype.getCurrentIndex=function(){return this.curr_index},Gallery.prototype.setCounterTotal=function(index){return this.$counter_total.text(index?index+1:this.max_index+1)},Gallery.prototype.setCounterCurrent=function(index){return this.$counter_current.text(index?index+1:this.curr_index+1)},Gallery}();var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Time.component.InfiniteScroll=function(){function InfiniteScroll(options){return null==options&&(options={}),this.on_scroll=__bind(this.on_scroll,this),arguments.length>1&&(options.parentEl=arguments[0],options.contentEl=arguments[1],options.threshold=arguments[2],options.onDown=arguments[3],options.onUp=arguments[4],options.context=arguments[5]),options.contentEl||(options.contentEl=window),this.$viewport=options.parentEl,this.$content=options.contentEl,this.threshold=options.threshold,null!=options.onUp&&(this.up_callback=options.onUp),null!=options.onDown&&(this.down_callback=options.onDown),this.context=options.context,this.position=this.$viewport.scrollTop(),_.defer(function(_this){return function(){return _this.bind()}}(this)),this}return InfiniteScroll.prototype.bind=function(){return this.$viewport.off("scroll.infinite_scroll"),this.$viewport.on("scroll.infinite_scroll",this.on_scroll),this.$viewport.on("DOMMouseScroll mousewheel",function(_this){return function(e){return(e.originalEvent.detail<0||e.originalEvent.wheelDelta>0)&&_this.$viewport.height()>_this.$content.height()||_this.override?(setTimeout(function(){var _ref;return null!=(_ref=_this.up_callback)?_ref.call(_this.context):void 0},100),_this.override=!1):void 0}}(this))},InfiniteScroll.prototype.unbind=function(){return this.$viewport.off("scroll.infinite_scroll")},InfiniteScroll.prototype.on_scroll=function(){return $(window).trigger("time-infinite-scroll"),this.handle_scroll()},InfiniteScroll.prototype.handle_scroll=_.debounce(function(){return!this.paused&&this.$viewport.scrollTop()<=this.threshold&&null!=this.up_callback&&this.position>this.$viewport.scrollTop()?this.up_callback.call(this.context):!this.paused&&this.$viewport.height()+this.$viewport.scrollTop()+this.threshold>=this.$content.height()&&this.down_callback.call(this.context),this.position=this.$viewport.scrollTop(),this.position},50),InfiniteScroll.prototype.pause=function(){return this.paused=!0},InfiniteScroll.prototype.resume=function(){return this.paused=!1},InfiniteScroll.prototype.reset=function(){return this.position=0},InfiniteScroll.prototype.enableUpScroll=function(){return this.override=!0},InfiniteScroll}();var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.component.MobileNavigation=function(_super){function MobileNavigation(){var $doc,$header,posTop;MobileNavigation.__super__.constructor.apply(this,arguments),$doc=$(document),posTop=0,$header=$(".main-header"),$(this.opts.menuSelector).on("shown",function(){var headerHeight,viewportHeight,viewportWidth;return posTop=$doc.scrollTop(),headerHeight=$header.outerHeight(),viewportHeight=$("body").height(),viewportWidth=$(window).width()}),$(this.opts.menuSelector).on("hidden",function(_this){return function(){return Modernizr.touch&&$doc.scrollTop(posTop),Time.util.enable_scrolling(),$(_this.opts.menuSelector).removeProp("style")}}(this)),$(this.opts.parentSelector).find(".main-nav a:not(.login-nav-item)").on("click",function(_this){return function(){return _this.hide()}}(this))}return __extends(MobileNavigation,_super),MobileNavigation}(Time.component.Dropdown);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.component.RailSearch=function(_super){function RailSearch(){return RailSearch.__super__.constructor.apply(this,arguments)}return __extends(RailSearch,_super),RailSearch.prototype.opts={parentSelector:"body",classToAdd:"show-search",menuSelector:".tabs-inner",handleClickOutside:!0,formSelector:".search-form",fieldSelector:".search-field"},RailSearch.prototype.toggle=function(evt){return evt&&evt.preventDefault(),this.isShowing?(this.handleEnter(),this.exitSearch(evt)):this.enterSearch(evt)},RailSearch.prototype.enterSearch=function(evt){return this.show(evt),this.placeholderShim(),$(".search-field").focus(),$("body").on("keydown.rail-search-"+this.opts.classToAdd,function(_this){return function(e){return _this.handleKeydown(e)}}(this))},RailSearch.prototype.handleKeydown=function(e){var key;return key=e.which||e.keyCode,this.isEnter(key)?this.handleEnter():this.isESC(key)?this.exitSearch():void 0},RailSearch.prototype.handleEnter=function(){var value;return value=$(this.opts.fieldSelector).val(),value!==$(this.opts.fieldSelector).attr("placeholder")&&value.length&&!/\s+/.test(value)?$(this.opts.formSelector).submit():void 0},RailSearch.prototype.exitSearch=function(evt){return $("body").off("keydown.rail-search-"+this.opts.classToAdd),this.hide(evt)},RailSearch.prototype.isEnter=function(key){return 13===parseInt(key)?!0:!1},RailSearch.prototype.isESC=function(key){return 27===parseInt(key)?!0:!1},RailSearch.prototype.placeholderShim=function(){var field,placeholder;return field=$(this.opts.fieldSelector),placeholder=field.attr("placeholder"),field.val()!==placeholder&&field.val(placeholder),field.focus(function(){return this.value===placeholder?(this.setSelectionRange(0,0),field.addClass("empty")):void 0}),field.blur(function(){return""===this.value?this.value=placeholder:void 0}),$("body").on("keydown.@opts.fieldSelector",function(_this){return function(e){return _this.placeholderShimKeyDown(e,field,placeholder)}}(this)),$("body").on("keyup.@opts.fieldSelector",function(_this){return function(e){return _this.placeholderShimKeyUp(e,field,placeholder)}}(this))},RailSearch.prototype.placeholderShimKeyDown=function(e,field,placeholder){return field.val()===placeholder?field.val(field.val().replace(placeholder,"")).removeClass("empty"):void 0},RailSearch.prototype.placeholderShimKeyUp=function(e,field,placeholder){return""===field.val()?field.setSelectionRange(0,0).val(placeholder).addClass("empty"):void 0},RailSearch}(Time.component.Dropdown),Time.component.Ticker=function(){function Ticker(){}return Ticker.prototype.initComponent=function(index){var that;return this.curr_index=index?index:0,this.max_index=this.$items.length-1,this.$counter_total&&this.setCounterTotal(),that=this,Modernizr.touch&&(this.$el.touchwipe({wipeLeft:$.proxy(that.advance,that),wipeRight:$.proxy(that.recede,that),min_move_x:6,min_move_y:6,preventDefaultEvents:!1}),this.$el.click(that.advance,that)),this.updatePositionalClasses(!0),this.trigger("ticker:initComponent")},Ticker.prototype.auto_play=function(milliseconds){return null==milliseconds&&(milliseconds=500),this.timerID&&clearTimeout(this.timerID),this.timerID=setTimeout(function(_this){return function(){return _this.advance()}}(this),milliseconds)},Ticker.prototype.advance=function(e){e&&e.preventDefault(),this.curr_index++,this.curr_index>this.max_index?this.circular?(this.curr_index=0,this.updatePositionalClasses()):this.handle_end():this.updatePositionalClasses()},Ticker.prototype.recede=function(e){e&&e.preventDefault(),this.curr_index--,this.curr_index<0?this.circular?(this.curr_index=this.max_index,this.updatePositionalClasses()):this.handle_beginning():this.updatePositionalClasses()},Ticker.prototype.goto_index=function(index){return this.curr_index=index,this.updatePositionalClasses()},Ticker.prototype.goto_start=function(){return this.goto_index(0)},Ticker.prototype.goto_end=function(){return this.goto_index(this.max_index)},Ticker.prototype.handle_end=function(){return this.trigger("ticker:max_limit"),this.goto_end()},Ticker.prototype.handle_beginning=function(){return this.trigger("ticker:min_limit"),this.goto_start()},Ticker.prototype.updatePositionalClasses=function(){var $el,i,_i,_len,_ref;for(this.trigger("ticker:beforeUpdatePositionalClasses",this),"undefined"!=typeof console&&null!==console&&console.log("ticker component - update positional classes"),_ref=this.$items,i=_i=0,_len=_ref.length;_len>_i;i=++_i)$el=_ref[i],i<this.curr_index&&$el.addClass("passed").removeClass("current upcoming"),i===this.curr_index&&$el.addClass("current").removeClass("passed upcoming").trigger("isCurrent"),i>this.curr_index&&$el.addClass("upcoming").removeClass("passed current");return this.trigger("ticker:afterUpdatePositionalClasses",this),this.curr_index===this.max_index?this.trigger("ticker:last"):void 0},Ticker.prototype.getCurrentItem=function(){return this.$items[this.curr_index]},Ticker.prototype.getCurrentIndex=function(){return this.curr_index},Ticker.prototype.setCounterTotal=function(index){return this.$counter_total.text(index?index+1:this.max_index+1)},Ticker.prototype.setCounterCurrent=function(index){return this.$counter_current.text(index?index+1:this.curr_index+1)},Ticker}(),Time.util={disable_scrolling:function(){return $("body").attr("style","overflow: hidden; position: fixed;")},enable_scrolling:function(){return $("body").css({overflow:"",position:""})},is_android_lte_23:function(){var i,match,uaMatches,_i,_len;if(uaMatches=navigator.userAgent.match(/Android ([0-9]+)/),null==uaMatches||!uaMatches.length)return!1;for(i=_i=0,_len=uaMatches.length;_len>_i;i=++_i)if(match=uaMatches[i],3.1>=parseFloat(match.replace("Android ","")))return!0;return!1},is_native_android_browser:function(){var nua;return nua=navigator.userAgent,nua.indexOf("Mozilla/5.0")>-1&&nua.indexOf("Android ")>-1&&nua.indexOf("AppleWebKit")>-1&&!(nua.indexOf("Chrome")>-1)},getDayOfYear:function(){var firstDay,today;return today=new Date,firstDay=new Date(today.getFullYear(),0,1),Math.round((today-firstDay)/1e3/60/60/24+.5,0)},waitFor:function(reference,referenceType,callback,interval,maxCallCount){return null==callback&&(callback=!1),null==interval&&(interval=500),null==maxCallCount&&(maxCallCount=12),0===maxCallCount?!1:(maxCallCount-=1,setTimeout(function(){return typeof reference===referenceType?callback():Time.util.waitFor(reference,referenceType,callback,interval,maxCallCount)
},interval))}},Time.component.make=function(componentName,selector,config){return $(selector).each(function(){var tempObj;return $.data(this,componentName)?void 0:(tempObj=new Time.component[componentName](selector,config),$.data(this,componentName,tempObj))})},Time.component.Modal=function(){function Modal(elSelector,config){this.opts=$.extend(!0,{},this.defaults,config),this.$el=$(elSelector),this.bind()}return Modal.prototype.defaults={closeSelector:".close-button",buttonSelector:".modal-button",interiorSelector:".modal",classToShow:"active",isShowing:!1,handleResize:!1,$html:$("html")},Modal.prototype.bind=function(){return this.opts.$html.delegate(this.opts.buttonSelector,{"click.smart-modal":function(_this){return function(e){return _this.show(e)}}(this)})},Modal.prototype.show=function(e){var shownEvt;return e&&e.preventDefault(),this.opts.isShowing?this.$el:(shownEvt=$.extend(!0,e,{type:"shown"}),this.isShowing=!0,this.opts.$html.css("overflow","hidden"),this.bindClose(),this.$el.addClass(this.opts.classToShow).trigger(shownEvt))},Modal.prototype.hide=function(e){return e&&e.preventDefault(),this.opts.isShowing=!1,this.unbindClose(),this.opts.$html.css("overflow","visible"),this.$el.removeClass(this.opts.classToShow).trigger("hidden")},Modal.prototype.bindClose=function(){return this.opts.$html.on({"click.smart-modal-close":function(_this){return function(e){var $targ,isCloseBtn,isNotModal;return $targ=$(e.target||event.sourceElement),isCloseBtn=$targ.is(_this.opts.closeSelector||$(_this.opts.closeSelector).has($targ).length>0),isNotModal=!$(_this.opts.interiorSelector).has($targ).length>0&&!$(_this.opts.interiorSelector).is($targ),isNotModal||isCloseBtn?(e.preventDefault(),_this.hide()):void 0}}(this)})},Modal.prototype.unbindClose=function(){return this.opts.$html.off(".smart-modal-close")},Modal.prototype.destroy=function(){return this.opts.$html.off(".smart-modal .smart-modal-close"),this.$el.off(".smart-modal").removeData(".smart-modal")},Modal}();var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.models.Gallery=function(_super){function Gallery(){return Gallery.__super__.constructor.apply(this,arguments)}return __extends(Gallery,_super),Gallery.prototype.defaults={isPrimary:!1,photos:[],hasAds:!0,adfrequency:null,view:null,slideIndex:0},Gallery.prototype.url=function(){return"/api/gallery/"+this.id+"/"},Gallery.prototype.initialize=function(){return this.DEBUG=-1!==window.location.href.indexOf("debuggallery"),_.bindAll(this,"url"),this.syncing=!1,this.listenTo(this,"change:isPrimary",function(model,value){value&&Time.trigger("article:primaryGallery:found",this)}),this.listenToOnce(this,"sync:error",function(){"undefined"!=typeof console&&null!==console&&console.error("GalleryModel "+this.id+" could not sync")}),this.listenToOnce(this,"gallery:dataReady",function(){this.get("adfrequency")||this.set("adfrequency","vertical"===this.get("size")?4:6)}),this},Gallery.prototype.getData=function(){return this.get("photos").length?this.trigger("gallery:dataReady"):(this.listenToOnce(this,"sync:complete",function(){this.trigger("gallery:dataReady")}),this.fetch()),this},Gallery.prototype.parse=function(response){return response.gallery},Gallery.prototype.checkCache=function(){var cachedModelAttributes;return cachedModelAttributes=this.collection.get_from_cache(this.id),null==(null!=cachedModelAttributes?cachedModelAttributes.photos:void 0)?!1:(this.set(cachedModelAttributes),!0)},Gallery.prototype.fetch=function(opts){var complete_callback,success_callback;return null==opts&&(opts={}),this.syncing?!1:(complete_callback=opts.complete,success_callback=opts.success,this.checkCache()?(null!=complete_callback&&complete_callback.call(this),null!=success_callback&&success_callback.call(this),this.trigger("sync:success",this),this):(this.trigger("sync:syncing"),this.syncing=!0,opts.dataType="json",opts.complete=function(_this){return function(response){return _this.trigger("sync:complete"),_this.syncing=!1,null!=complete_callback?complete_callback.call(model,response,options):void 0}}(this),opts.success=function(_this){return function(model,response,options){return"object"!=typeof response?(_this.trigger("sync:error"),opts.error(model,response,options),!1):(_this.trigger("sync:success"),null==response.error&&null!=success_callback?success_callback.call(model,response,options):void 0)}}(this),Backbone.Collection.prototype.fetch.call(this,opts)))},Gallery.prototype.getView=function(parentView){return null!=this.view?this.view:(this.view=new Time.views.GalleryVertical({model:this,parent:parentView}),this.view)},Gallery.prototype.getSlideIndex=function(){return parseInt(this.get("slideIndex"),10)},Gallery.prototype.getTotalSlides=function(){var _ref;return null==(null!=(_ref=this.view)?_ref.slidesCollection.length:void 0)?0:this.view.slidesCollection.length},Gallery}(Backbone.Model);var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.models.Application=function(_super){function Application(){return this.onPrimaryGalleryFound=__bind(this.onPrimaryGalleryFound,this),this.onArticleNavigated=__bind(this.onArticleNavigated,this),this.onRoute=__bind(this.onRoute,this),Application.__super__.constructor.apply(this,arguments)}return __extends(Application,_super),Application.prototype.defaults={isPrintMode:!1,orientation:null,activeArticle:null,activeGallery:null,isFullscreen:!1,isInitialRoute:!0,isRailToggleable:null,isRailUserOpen:!1,isRailOpen:null,isPastPushdowns:null},Application.prototype.initialize=function(){return this.listenTo(Time,"router:route",this.onRoute),this.listenTo(Time,"article:navigated",this.onArticleNavigated),this.listenTo(Time,"article:primaryGallery:found",this.onPrimaryGalleryFound),this},Application.prototype.onRoute=function(){this.get("isInitialRoute")?(Time.trigger("router:first"),this.set("isInitialRoute",!1)):Time.trigger("router:notFirst")},Application.prototype.onArticleNavigated=function(articleModel){var previousActiveArticleModel;previousActiveArticleModel=this.get("activeArticle"),null!=previousActiveArticleModel&&previousActiveArticleModel.set("isActive",previousActiveArticleModel.id===articleModel.id),this.set("activeArticle",articleModel)},Application.prototype.onPrimaryGalleryFound=function(galleryModel){this.set("activeGallery",galleryModel)},Application}(Backbone.Model);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.models.Article=function(_super){function Article(){return Article.__super__.constructor.apply(this,arguments)}return __extends(Article,_super),Article.prototype.defaults={isActive:!1,visible:!1,hasHeroImage:!1,isSingleOnPageload:!1,galleriesRendered:0,totalVideos:0,initialized:!1,isRendered:!1},Article.prototype.initialize=function(){var _ref;return this.views={},this.get("isPhoto")&&this.set("articleType","time-icons-photo"),this.get("isVideo")&&this.set("articleType","time-icons-video"),this.get("isLocked")&&this.set("articleType","time-icons-key"),"vsp"===(null!=(_ref=this.get("sponsor"))?_ref.slug:void 0)&&this.set("sponsor_timestamp",(new Date).getTime()),this.listenTo(this,"change:isActive",function(model,value){value&&this.maybeNavigateTo()}),null!=this.collection&&this.listenTo(this.collection,"flush",function(_this){return function(){_this.set("isActive",!1)}}(this)),this.listenTo(this,"views:destroy",function(){var _ref1,_ref2;this.set({isRendered:!1}),null!=(_ref1=this.views.tile_view)&&_ref1.destroy(),null!=(_ref2=this.views.singleView)&&_ref2.destroy(),this.views={}}),this},Article.prototype.hasComponent=function(component){var _ref,_ref1,_ref2;if((null!=(_ref=Time.bootstrap)&&null!=(_ref1=_ref.single_article)?_ref1.id:void 0)===this.model.id){if(null==(null!=(_ref2=Time.bootstrap.single_article)?_ref2[component]:void 0))return!1}else if(!this.get(component))return!1;return!0},Article.prototype.url=function(){return Time.api_url+"post/"+this.get("id")+"/"},Article.prototype.fetch=function(opts){var fn_complete,fn_error,fn_success;return null==opts&&(opts={}),this.syncing?void 0:((null==opts.cache||opts.cache)&&(opts.cache=!0),this.trigger("sync:syncing"),this.syncing=!0,opts.dataType="json",fn_success=opts.success,opts.success=function(_this){return function(model,response,options){return"object"!=typeof response?(_this.trigger("sync:error"),opts.error(model,response,options),!1):(_this.trigger("sync:success"),null!=fn_success?fn_success(model,response,options):void 0)}}(this),fn_complete=opts.complete,opts.complete=function(_this){return function(model,response,options){return _this.trigger("sync:complete"),_this.syncing=!1,null!=fn_complete?fn_complete(model,response,options):void 0}}(this),fn_error=opts.error,opts.error=function(_this){return function(model,response,options){return _this.trigger("sync:error"),fn_error?fn_error(model,response,options):void 0}}(this),Backbone.Collection.prototype.fetch.call(this,opts))},Article.prototype.getBrandedTitle=function(){var title;return title=this.get("title"),/money_collection|money_collectionpost|money_article/.test(this.get("post_type"))?title+" | Money.com":title+" | TIME"},Article.prototype.getEditDate=function(){return this.get("time").published.substring(0,10)},Article.prototype.createTileView=function(overrides){var coverModel,defaults,options;if(null==overrides&&(overrides={}),defaults={model:this,collection:this.collection},options=_.extend(defaults,overrides),this.get("is_nativo"))return new Time.views.NativoArticleTile(options);switch(this.collection.active_env){case"magazine":return options.magazineId=this.get("magazine_id"),this.get("magazine")?new Time.views.MagazineCollapsible(options):(coverModel=this.collection.findWhere({cover:1,magazine_id:this.get("magazine_id")}),options.cover=coverModel.views.tile_view,options.$parent=options.cover.$el.find('.rail-article-magazine-cover[data-issue="'+this.get("magazine_id")+'"] ~ .leftRailModule--collapsible__body'),new Time.views.MagazineTile(options));case"collection":return options.$el=$("#article-tile-"+this.id),new Time.views.ArticleCollectionsTile(options);default:return new Time.views.ArticleTile(options)}return null},Article.prototype.createSingleView=function(){return this.views.singleView=new Time.views.ReadingPaneArticle({model:this}),this.views.singleView},Article.prototype.is_in_content_well=function(){return Time.application.$viewport.find(".full-article[data-article='"+this.id+"']").length},Article.prototype.maybeNavigateTo=function(){return null!=this.collection&&(this.collection.freeze_url||this.collection.freeze_url_once)?this.collection.freeze_url_once=!1:this.navigateTo(),"undefined"!=typeof console&&null!==console&&console.info("article model triggering article:navigated on Time"),Time.trigger("article:navigated",this),this},Article.prototype.navigateTo=function(){var relative_url;relative_url=Time.application.stripBaseUrl(this.get("url")),Time.application.router.navigate(relative_url,!1),Time.taboola_counter++;try{Time.taboola.renderModules()}catch(_error){}return this},Article}(Backbone.Model);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.models.BrightcoveVideo=function(_super){function BrightcoveVideo(){return BrightcoveVideo.__super__.constructor.apply(this,arguments)}return __extends(BrightcoveVideo,_super),BrightcoveVideo.prototype.defaults={state:"stopped",experience:null,videoPlayer:null,adPlayer:null,isPrimary:null},BrightcoveVideo.prototype.initialize=function(){return this},BrightcoveVideo}(Backbone.Model);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.models.DfpAd=function(_super){function DfpAd(){return DfpAd.__super__.constructor.apply(this,arguments)}return __extends(DfpAd,_super),DfpAd.prototype.defaults={adInstance:null,isCmAd:!1,isActive:!0,isTrigger:!1,isWritten:!1,isRendered:!1,isTethered:!1,tetherTo:null,group:"",subgroup:"",size:null,position:1},DfpAd.prototype.initialize=function(){return this},DfpAd}(Backbone.Model);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.models.DfpAdManager=function(_super){function DfpAdManager(){return DfpAdManager.__super__.constructor.apply(this,arguments)}return __extends(DfpAdManager,_super),DfpAdManager.prototype.defaults={zone:"",factory:null,adSizes:[],isInitialAdCycle:!0,isInitialLeftRailCycle:!0},DfpAdManager.prototype.initialize=function(attributes,options){var authors,error,i,the_authors,the_authors_length,_ref,_ref1,_ref2;if(null==attributes&&(attributes={}),null==options&&(options={}),null!=options.app&&(this.app=options.app),window.TGX_SITE_CONFIG={gpt_sync_mode:"async",refresh_oop_slot:!0},the_authors_length=(null!=(_ref=Time.bootstrap)&&null!=(_ref1=_ref.single_article)&&null!=(_ref2=_ref1.authors)?_ref2.length:void 0)||0,authors=[],the_authors_length){for(the_authors=Time.bootstrap.single_article.authors,i=0;the_authors_length>i;)authors.push(the_authors[i].name),i++;authors=authors.join()}if("undefined"==typeof TIME_DFP||null===TIME_DFP)return console.error("TIME_DFP not defined"),this;window._sf_async_config={uid:3088,domain:"time.com",scrollElement:!0,sections:("undefined"!=typeof TIME_DFP&&null!==TIME_DFP?TIME_DFP.zone:void 0)||"",zone:("undefined"!=typeof TIME_DFP&&null!==TIME_DFP?TIME_DFP.zone:void 0)||"",authors:authors},this.bindListeners(),this.adSizes=[],this.factoryConfig=this.createConfig(),this.factoryData=TIME_DFP,this.factoryZone=this.getFactoryZone(this.factoryData),this.factoryInstance=this.createFactory(this.factoryConfig,this.factoryZone),this.setDefaultFactoryParams(this.factoryInstance),this.setInitialFactoryParams(this.factoryInstance,this.factoryData);try{Time.Ad.setGlobalFactory(this.factoryInstance),Time.Ad.setGlobalAdSizes(this.adSizes),Time.Ad.init()}catch(_error){error=_error,console.error("DfpAdManager -- could not init Time.Ad",error)}return this},DfpAdManager.prototype.bindListeners=function(){return console.debug("DfpAdManager -- bindListeners"),this.listenTo(Time,"dfpAdManager:factory:setDefaultParams",function(_this){return function(factoryInstance){console.debug("DfpAdManager heard dfpAdManager:refreshAds on Time",factoryInstance),_this.setDefaultFactoryParams(factoryInstance)}}(this)),this.listenTo(Time,"dfpAdManager:factory:maybeReset",function(_this){return function(factoryInstance,articleModel){console.debug("Time heard dfpAdManager:factory:maybeReset for article:",null!=articleModel?articleModel.id:void 0),_this.maybeResetFactory(factoryInstance,articleModel)}}(this)),this.listenTo(Time,"dfpAdManager:factory:setZone",function(_this){return function(zone){var factoryInstance;factoryInstance=_this.getFactory(),null!=factoryInstance&&factoryInstance.setZone(zone)}}(this)),this.listenTo(Time,"dfpAdManager:factory:reset",function(_this){return function(params){console.debug("Time heard dfpAdManager:factory:reset"),_this.resetFactory(_this.getFactory(),params)}}(this)),this.listenTo(this,"change:isInitialLeftRailCycle",function(model,value){return Time.trigger("dfpAdManager:change:isInitialLeftRailCycle",value)}),this},DfpAdManager.prototype.createConfig=function(){var adConfig,error;console.debug("DfpAdManager - createConfig");try{return"mobile"===Time.device?(this.sitename="3475.tim_mobile",this.adSizes=Time.Ad.getAdSizes("mobile")):"tablet"===Time.device?(this.sitename="3475.tim_tablet",this.adSizes=Time.Ad.getAdSizes("tablet"===Time.device&&$(window).width()<$(window).height()?"mobile":"tablet")):(this.sitename="3475.tim",this.adSizes=Time.Ad.getAdSizes("desktop")),console.debug("-- createConfig with sitename and use these adSizes",this.sitename,this.adSizes),adConfig=new TiiAdConfig(this.sitename),adConfig.setCmSitename("cm.tim"),adConfig.setRevSciTracking(!0),adConfig.setdisableInitLoad(!0),adConfig}catch(_error){return error=_error,console.error("-- createConfig - couldn't create a config",error),null}},DfpAdManager.prototype.getConfig=function(){var error;console.debug("DfpAdManager - getConfig"),this.factoryConfig=null;try{this.factoryConfig=Time.Ad.getFactoryConfig()}catch(_error){return error=_error,console.error("-- getConfig - couldn't get ad factory config",error),null}return this.factoryConfig},DfpAdManager.prototype.getFactoryZone=function(factoryData){var vertical,zone;return zone="",console.debug("DfpAdManager -- getFactoryZone"),(null!=factoryData?factoryData.zone:void 0)?(zone=factoryData.zone,null==factoryData.params||null==factoryData.params.subch&&"collection"!==factoryData.params.ptype||(vertical=window.history&&history.pushState?document.location.pathname.substring(1).split("/")[0]:document.location.hash.substring(1).split("/")[0],zone="collections/"+factoryData.zone,vertical.match(/money/)&&(zone="money/"+zone)),zone=zone.toLowerCase().replace(/\./g,"")):(console.debug("-- no zone in factoryData",factoryData),"")},DfpAdManager.prototype.getFactory=function(){return this.factoryInstance=Time.Ad.getFactoryInstance(),this.factoryInstance},DfpAdManager.prototype.createFactory=function(factoryConfig,factoryZone){return console.debug("DfpAdManager - createFactory with config ",factoryConfig),factoryConfig=factoryConfig||this.getConfig(),null==factoryConfig?(console.error("-- createFactory -- missing factory config"),null):factoryZone?new TiiAdFactory(factoryConfig,factoryZone):new TiiAdFactory(factoryConfig)},DfpAdManager.prototype.sanitizeFactoryParamsZone=function(zone){return zone.toLowerCase().replace(/\./g,"")},DfpAdManager.prototype.sanitizeFactoryParamsPath=function(url){var path;return path=url.split("/"),path=path.slice(3,path.length-1)},DfpAdManager.prototype.flattenParams=function(params){var k,v;for(k in params)__hasProp.call(params,k)&&(v=params[k],_.isObject(v)&&!_.isArray(v)&&(_.extend(params,v),delete params[k]));return params},DfpAdManager.prototype.sanitizeFactoryParams=function(params){var key,sanitizedParams,value;sanitizedParams={},null!=(null!=params?params.url:void 0)&&(sanitizedParams.path=this.sanitizeFactoryParamsPath(params.url)),sanitizedParams.dcove="d",params=this.flattenParams(params);for(key in params)value=params[key],sanitizedParams[key]="topic"===key||"tags"===key?value.replace(/[^\w,]/g,"").toLowerCase():"string"==typeof value?value.toLowerCase():value;return sanitizedParams},DfpAdManager.prototype.wipeFactoryParams=function(factoryInstance){var key,value,_ref;_ref=factoryInstance.params;for(key in _ref)__hasProp.call(_ref,key)&&(value=_ref[key],console.debug("-- wipeFactoryParam",key),factoryInstance.clearParam(key));return factoryInstance},DfpAdManager.prototype.setFactoryParams=function(factoryInstance,params){var key,value;for(key in params)__hasProp.call(params,key)&&(value=params[key],console.debug("-- setFactoryParams",key,value),factoryInstance.setParam(key,value));return factoryInstance},DfpAdManager.prototype.setInitialFactoryParams=function(factoryInstance,factoryData){var $topic,params;return params={},factoryData.url=document.location.href,params=this.sanitizeFactoryParams(factoryData),$topic=$("body").find(".left-rail-topper").eq(0).find("#topic"),$topic.length&&$topic.hasClass("active")&&(params.ptype="topic"),console.debug("DfpAdManager - setInitialFactoryParams",params),this.setFactoryParams(factoryInstance,params),this},DfpAdManager.prototype.setDefaultFactoryParams=function(factoryInstance){var defaultParams,test;return console.debug("DfpAdManager - setDefaultFactoryParams on ",factoryInstance),defaultParams={rdsn:"yes"},null!=$.cookie("time_visit")&&(console.debug("-- setDefaultFactoryParams setting rvisit to yes"),defaultParams.rvisit=!0),null!=document.referrer&&document.referrer&&(defaultParams.rhost=document.referrer.split("/")[2],console.debug("-- setDefaultFactoryParam setting rhost to "+defaultParams.rhost)),test=("undefined"!=typeof sessionStorage&&null!==sessionStorage?sessionStorage.testads:void 0)||"",console.debug("-- setDefaultFactoryParams with ?testads = "+test),defaultParams.test=test,this.setFactoryParams(factoryInstance,defaultParams)},DfpAdManager.prototype.maybeResetFactory=function(factoryInstance,articleModel){var params,_ref;return null==factoryInstance?(console.error("-- maybeResetFactory in ",this," needs a valid factoryInstance.",factoryInstance),this):null==articleModel?this:articleModel.id===(null!=factoryInstance&&null!=(_ref=factoryInstance.params)?_ref.aid:void 0)?this:(params=Time.Ad.getFactoryData(articleModel),null!=("undefined"!=typeof TIME_DFP&&null!==TIME_DFP?TIME_DFP.zone:void 0)&&"page"===articleModel.get("post_type")&&(params.zone||(params.zone=TIME_DFP.zone)),this.resetFactory(factoryInstance,params),this)},DfpAdManager.prototype.resetFactory=function(factoryInstance,params){var sanitizedParams,zone;return null==factoryInstance?(console.error("DfpAdManager resetFactory in ",this," needs a valid factoryInstance."),this):(console.debug("DfpAdManager reset factory ----------------------------------------"),this.wipeFactoryParams(factoryInstance),zone="",(null!=params?params.zone:void 0)&&(zone=this.sanitizeFactoryParamsZone(params.zone)),factoryInstance.zone!==zone&&factoryInstance.setZone(zone),this.setDefaultFactoryParams(factoryInstance),sanitizedParams=this.sanitizeFactoryParams(params),this.setFactoryParams(factoryInstance,sanitizedParams),console.debug("---------------------------------------- reset factory"),factoryInstance)},DfpAdManager.prototype.setFactorySegments=function(factoryInstance){var quantSegs,revSciSegments;return window.TiiAdGetRevSciSegments&&(revSciSegments=window.TiiAdGetRevSciSegments(),factoryInstance.setParam("rsseg",revSciSegments)),window.TiiAdGetQuantcastSegments&&(quantSegs=window.TiiAdGetQuantcastSegments(),factoryInstance.setParam("qc",quantSegs)),factoryInstance},DfpAdManager}(Backbone.Model);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.models.GalleryLightbox=function(_super){function GalleryLightbox(){return GalleryLightbox.__super__.constructor.apply(this,arguments)}return __extends(GalleryLightbox,_super),GalleryLightbox.prototype.defaults=_.extend({},Time.models.Gallery.prototype.defaults,{lastSlideIndex:0,prerenderCount:3,isFullscreen:!1,isCaptionTruncated:!1,isCaptionExpanded:!0,isInitialSlide:!0,isAdvanceable:!1,isSwappable:!1}),GalleryLightbox.prototype.initialize=function(){return GalleryLightbox.__super__.initialize.apply(this,arguments),this},GalleryLightbox.prototype.getView=function(parentView){return null!=this.view?this.view:(this.view=new Time.views.GalleryLightbox({model:this,parent:parentView}),this.view)},GalleryLightbox.prototype.currentSlide=function(){var _ref;return null!=(_ref=this.view)?_ref.slidesCollection.at(this.get("slideIndex")):void 0},GalleryLightbox.prototype.isAtEnd=function(){return 0===this.getTotalSlides()?!0:this.getSlideIndex()===this.getTotalSlides()-1},GalleryLightbox.prototype.goSlide=function(index){return this.getSlideIndex()===index?this:0>index?this:index>this.getTotalSlides()-1?this:(this.set("slideIndex",index),this)},GalleryLightbox.prototype.goNextSlide=function(){var currentIndex,isAtSecondToLastSlide;return currentIndex=this.getSlideIndex(),isAtSecondToLastSlide=this.getTotalSlides()>=2?this.getTotalSlides()-2:0,this.get("custom_recirc_url")&&currentIndex===isAtSecondToLastSlide?(window.location=this.get("custom_recirc_url"),this):"endless"===this.get("type")&&this.get("next_gallery")&&currentIndex===isAtSecondToLastSlide?($(".gallery__viewport").empty(),$(".gallery__viewport").addClass("loading-overlay"),window.location.href=this.get("next_gallery").url,this):(this.isAtEnd()?this.trigger("gallery:pastEnd"):this.set("slideIndex",currentIndex+1),this)},GalleryLightbox.prototype.goPrevSlide=function(){var currentIndex;return currentIndex=this.getSlideIndex(),0===currentIndex?this.trigger("gallery:swapPrev"):this.set("slideIndex",currentIndex-1),this},GalleryLightbox}(Time.models.Gallery);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.models.GallerySlide=function(_super){function GallerySlide(){return GallerySlide.__super__.constructor.apply(this,arguments)}return __extends(GallerySlide,_super),GallerySlide.prototype.defaults={slideType:"default",isActive:!1,title:"Untitled Image",slug:"",caption:"",credit:"",alt:"",width:0,height:0,orientation:"landscape",url:"",encoded_shortlink:"",galleryTitle:"Untitled Gallery",twitterVia:"Time",twitterText:"",facebookText:"",emailText:""},GallerySlide.prototype.initialize=function(){switch(this.get("slideType")){case"endless":this.view=new Time.views.GallerySlideLightboxEndless({model:this});break;case"related":this.view=new Time.views.GallerySlideLightboxRelated({model:this});break;default:this.view=new Time.views.GallerySlide({model:this})}return this},GallerySlide.prototype.getEncodedGalleryTitle=function(){return encodeURIComponent(this.get("galleryTitle"))},GallerySlide.prototype.getEncodedUrl=function(){return encodeURIComponent(this.get("url"))},GallerySlide.prototype.getShareMail=function(){var emailBody,lineBreak;return lineBreak="%0D%0A%0D%0A",emailBody=this.get("emailText"),emailBody=emailBody?emailBody+lineBreak:"",emailBody=this.getEncodedGalleryTitle()+lineBreak+emailBody+this.getEncodedUrl(),"mailto:?subject="+this.getEncodedGalleryTitle()+"&body="+emailBody},GallerySlide.prototype.getShareTwitter=function(){var twitterText,twitterUrl;return twitterText=this.get("twitterText")||this.getEncodedGalleryTitle(),twitterUrl="https://twitter.com/intent/tweet",twitterUrl+="?url="+this.get("encoded_shortlink"),twitterUrl+="&text="+twitterText,twitterUrl+="&via="+this.get("twitterVia")},GallerySlide.prototype.getShareGplus=function(){return"https://plus.google.com/share?url="+this.getEncodedUrl()},GallerySlide.prototype.getShareLinkedIn=function(){return"http://www.linkedin.com/shareArticle?mini=true&url="+this.getEncodedUrl()+"&title="+this.getEncodedGalleryTitle()},GallerySlide.prototype.getShareFacebook=function(){var fbUrl;return fbUrl="http://facebook.com/sharer.php?s=100",fbUrl+="&p[title]="+this.getEncodedGalleryTitle(),fbUrl+="&p[url]="+this.getEncodedUrl()},GallerySlide}(Backbone.Model);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.models.GallerySlideAd=function(_super){function GallerySlideAd(){return GallerySlideAd.__super__.constructor.apply(this,arguments)}return __extends(GallerySlideAd,_super),GallerySlideAd.prototype.defaults={slideType:"ad",index:0,adIndex:1,isActive:!1,adModelId:""},GallerySlideAd.prototype.initialize=function(attributes,options){var size,templates,_ref;return null==attributes&&(attributes={}),null==options&&(options={}),this.galleryModel=options.galleryModel,this.set("adModelId","gallery__ad--"+this.getAdPosition()),size="vertical"===(null!=(_ref=this.galleryModel)?_ref.get("size"):void 0)?"vertical":"lightbox",templates={lightbox:"gallery-slide-lightbox-ad",vertical:"gallery-slide-vertical-ad"},this.view=new Time.views.GallerySlideAd({template:Time.templates[templates[size]],collection:this.collection,model:this}),this},GallerySlideAd.prototype.getAdPosition=function(){var articleId,articleModel,articleView,galleries,galleryId,slideIndex,_ref,_ref1;return galleryId=(null!=(_ref=this.galleryModel)?_ref.id:void 0)||"",slideIndex=this.get("index")||"",galleries=(null!=(_ref1=this.galleryModel)?_ref1.collection:void 0)||null,articleView=(null!=galleries?galleries.article:void 0)||null,articleModel=(null!=articleView?articleView.model:void 0)||null,articleId=(null!=articleModel?articleModel.id:void 0)||"","a"+articleId+"g"+galleryId+"s"+slideIndex},GallerySlideAd}(Backbone.Model),Time.models.MarketData=Backbone.Model.extend({initialize:function(){return{model:this}}});var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.models.MasonryModel=function(_super){function MasonryModel(){return MasonryModel.__super__.constructor.apply(this,arguments)}return __extends(MasonryModel,_super),MasonryModel.prototype.initialize=function(){return this},MasonryModel}(Backbone.Model);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.models.SpecialPage=function(_super){function SpecialPage(){return SpecialPage.__super__.constructor.apply(this,arguments)}return __extends(SpecialPage,_super),SpecialPage.prototype.defaults={galleriesRendered:0},SpecialPage.prototype.initialize=function(){return this},SpecialPage}(Backbone.Model);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};Time.models.Vault=function(_super){function Vault(){return Vault.__super__.constructor.apply(this,arguments)}return __extends(Vault,_super),Vault.prototype.DEBUG=!1,Vault.prototype.BASE_PATH="vault",Vault.prototype.YEAR_MAX=(new Date).getFullYear(),Vault.prototype.YEAR_MIN=1923,Vault.prototype.DATE_MAX=moment().subtract(3,"months"),Vault.prototype.VALID_CONTEXTS=["covers","pages","spread","page"],Vault.prototype.defaults={context:"covers",filterType:null,year:null,subject:null,magazine:null,page:0,canZoom:null},Vault.prototype.initialize=function(attributes,options){return null==options&&(options={}),this.DEBUG&&console.log("Vault: initialize model"),this.VALID_SUBJECTS=[],this.SUBJECT_HASH=[],this.set("year",this.YEAR_MAX),this.listenTo(this,"change:context",function(model,value){"spread"===value&&this.setOddPage()}),this},Vault.prototype.setYear=function(year){return this.set({context:"covers",filterType:"year",year:year+""}),this
},Vault.prototype.setSubject=function(subject){return this.set({context:"covers",filterType:"subject",subject:subject}),this},Vault.prototype.nextYear=function(){return this.setYear(this.getYear()>=this.YEAR_MAX?this.YEAR_MAX:this.getYear()+1)},Vault.prototype.prevYear=function(){return this.setYear(this.getYear()<=this.YEAR_MIN?this.YEAR_MIN:this.getYear()-1)},Vault.prototype.nextPage=function(bound){var page;return null==bound&&(bound=0),page=parseInt(this.get("page"),10),page+=1,page>bound&&(page=bound),"spread"===this.get("context")&&(page+=1,page>bound&&(page=bound),page!==bound?page=this.getOddPage(page):bound%2&&(page=this.getOddPage(page))),this.set("page",page),this},Vault.prototype.prevPage=function(bound){var page;return null==bound&&(bound=0),page=parseInt(this.get("page"),10),bound>=page?void 0:("page"===this.get("context")&&(page-=1),"spread"===this.get("context")&&(page=this.getOddPage(page-2)),0>page&&(page=0),this.set("page",page),this)},Vault.prototype.getRoute=function(overrides){var context,page,route;if(null==overrides&&(overrides={}),route=[this.BASE_PATH],"covers"===this.get("context"))route.push(this.get("filterType")),route.push(this.getFilterValue());else{if(!overrides.pubDate)return this.BASE_PATH+"/";route.push("issue"),route.push(overrides.pubDate),context=overrides.context||this.get("context"),route.push(context),("page"===context||"spread"===context)&&(page=overrides.page,overrides.page||(page=parseInt(this.get("page"),10),page+=1),page+="",route.push(page))}return route=route.join("/"),route+"/"},Vault.prototype.getOddPage=function(page){return null==page&&(page=this.get("page")),page%2||(page-=1),0>page&&(page=0),page},Vault.prototype.getFilterValue=function(filterType){switch(null==filterType&&(filterType=this.get("filterType")),filterType){case"year":return this.getYear();case"subject":return this.get("subject")}return null},Vault.prototype.getYear=function(){return parseInt(this.get("year"),10)},Vault.prototype.getPrettySubject=function(subjectValue){var subject;return null==subjectValue&&(subjectValue=this.get("subject")),subject=_.findWhere(this.SUBJECT_HASH,{value:subjectValue}),(null!=subject?subject.pretty:void 0)||""},Vault.prototype.setOddPage=function(){var page;page=this.get("page"),this.set("page",this.getOddPage(page))},Vault.prototype.orCurrentYear=function(year){return year=parseInt(year,10),year&&4===year.length?year<this.YEAR_MIN?currentYear:year>this.YEAR_MAX?currentYear:year:currentYear},Vault.prototype.orFirstSubject=function(){return null},Vault.prototype.validateContext=function(context){return __indexOf.call(this.VALID_CONTEXTS,context)>=0?context:"covers"},Vault.prototype.isValidIssueDate=function(pubDate){var dateObject;return dateObject=moment(pubDate,"YYYY-MM-DD",!0),dateObject.isValid()?dateObject.isAfter(this.DATE_MAX)?!1:dateObject.year()>this.YEAR_MAX?!1:dateObject.year()<this.YEAR_MIN?!1:!0:!1},Vault}(Backbone.Model);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.models.VaultMagazine=function(_super){function VaultMagazine(){return VaultMagazine.__super__.constructor.apply(this,arguments)}return __extends(VaultMagazine,_super),VaultMagazine.prototype.defaults={pubDate:moment().format("YYYY-MM-DD"),date:moment().format("MMM D, YYYY"),title:"UNTITLED",issue:"0",volume:"000",hero:null,articles:[],vault:null},VaultMagazine.prototype.initialize=function(){return this.dateObject=moment(this.get("pubDate"),"YYYY-MM-DD"),this.strippedDate=this.dateObject.format("YYYYMMDD"),this.paginatorText='<span class="vault__paginator__issue--long only-desktop">'+this.getFriendlyMeta()+"</span>",this.paginatorText+='<span class="vault__paginator__issue--short non-desktop">'+this.get("pubDate")+"</span>",this},VaultMagazine.prototype.hasActions=function(){return this.getBrowseLink()+this.getWebLink()+this.getBuyLink()},VaultMagazine.prototype.getBrowseLink=function(){var _ref;return null!=this.get("vault")&&((null!=(_ref=this.get("vault").pagePDFs)?_ref.length:void 0)||null!=this.get("vault").error)?"/vault/issue/"+this.get("pubDate")+"/page/1/":""},VaultMagazine.prototype.getWebLink=function(){return this.get("url")},VaultMagazine.prototype.getBuyLink=function(){return this.get("coverStore")},VaultMagazine.prototype.getFriendlyDate=function(abbreviated){return null==abbreviated&&(abbreviated=this.dateObject.format("MMM. D, YYYY")),abbreviated=abbreviated.replace(/(Mar\.)|(Apr\.)|(May\.)|(Jun\.)|(Jul\.)|(Sep\.)/,function(part){return{"Mar.":"March","Apr.":"April","May.":"May","Jun.":"June","Jul.":"July","Sep.":"Sept."}[part]})},VaultMagazine.prototype.getFriendlyMeta=function(){var friendlyMeta;return friendlyMeta=this.getFriendlyDate(),parseInt(this.get("volume"),10)&&(friendlyMeta+=", Vol. "+this.get("volume")),parseInt(this.get("issue"),10)&&(friendlyMeta+=", No. "+this.get("issue")),friendlyMeta},VaultMagazine.prototype.getPaginatorHtml=function(){var longText,shortText;return longText='<span class="vault__paginator__date--long only-desktop">'+this.paginatorText+"</span>",shortText='<span class="vault__paginator__date--short non-desktop">'+this.get("pubDate")+"</span>",longText+shortText},VaultMagazine.prototype.getTotalPages=function(){var _ref;return this.get("vault")?null!=(_ref=this.get("vault").pagePDFs)?_ref.length:void 0:0},VaultMagazine}(Backbone.Model),Time.models.Divider=Backbone.Model.extend({defaults:{type:"",divId:null},initialize:function(){return this.index=Time.models.Divider.index++,this.setType(),this},setType:function(){var activeEnv,_ref;if(activeEnv=null!=(_ref=Time.application.active_rail)?_ref.active_env:void 0,"collection"===activeEnv){if(0===this.index)return void this.set("type","empty");if(this.index%2===0)return void this.set("type","advert");this.set("type","empty")}else{if("mobile"===Time.device)return void this.set("type","advert");if("desktop"===Time.device)return this.index%7===6?void this.init_articles():void this.set("type","advert");this.index%2===0?this.set("type","advert"):this.init_articles()}return this},init_articles:function(){return this.set("type","articles"),null!=Time.bootstrap.dividers&&(this.set("articles_html",Time.bootstrap.dividers[Time.models.Divider.bootstrap_index]),Time.models.Divider.bootstrap_index++,Time.models.Divider.bootstrap_index>=Time.bootstrap.dividers.length)?Time.models.Divider.bootstrap_index=0:void 0},init_taboola:function(){return this.set("type","taboola")}}),Time.models.Divider.index=0,Time.models.Divider.bootstrap_index=0,Time.models.TickerHeadline=Time.models.Article.extend({initialize:function(){return this.view=new Time.views.TickerHeadline({model:this})}});var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.collections.Articles=function(_super){function Articles(){return Articles.__super__.constructor.apply(this,arguments)}return __extends(Articles,_super),Articles.prototype.model=Time.models.Article,Articles.prototype.adFrequency=10,Articles.prototype.adOffset=4,Articles.prototype.syncing=!1,Articles.prototype.page=1,Articles.prototype.endpoint="latest",Articles.prototype.active_env="trending",Articles.prototype.real_article_index=0,Articles.prototype.article_index=0,Articles.prototype.sponsored_article_index=0,Articles.prototype.sponsored_article_cycles=0,Articles.prototype.ad_in_left_rail=0,Articles.prototype.freeze_url=!1,Articles.prototype.freeze_url_once=!1,Articles.prototype.initialize=function(models,options){var _ref;return null==options&&(options={}),this.app=options.app,this.app.load_ticker(),Time.trigger("leftRail:flush"),(null!=(_ref=Time.bootstrap.single_article)?_ref.sponsor:void 0)&&Time.bootstrap.sponsors[0].id===Time.bootstrap.single_article.id&&Time.bootstrap.sponsors.push(Time.bootstrap.sponsors.shift()),this.view=new Time.views.LeftRail({collection:this}),this.listenTo(this,"add",function(model){this.renderArticleTile(model),null!=Time.bootstrap.sponsors&&this.real_article_index%10===6&&this.add_sponsored_article()}),this.listenTo(this,"reset",function(models,options){return _.each(options.previousModels,function(model){var _ref1,_ref2;return null!=(_ref1=model.views.tile_view)&&_ref1.destroy(),model.views.tile_view=null,null!=(_ref2=model.views.singleView)&&_ref2.destroy(),model.views.singleView=null})}),this},Articles.prototype.renderArticleTile=function(model,options){null==options&&(options={}),model.get("is_nativo")||this.real_article_index++,this.article_index++,model.views.tile_view=model.createTileView(),model.views.tile_view.render()},Articles.prototype.getIdFromUrl=function(){var id,matches,route;return route=Backbone.history.fragment,id=null,matches=/^money\/([0-9]+)\/?/.exec(route),matches&&(id=matches[1]),id||(id=route.substring(0,route.indexOf("/"))),isNaN(id)||(id=parseInt(id,10)),id},Articles.prototype.moveArticleFirst=function(article,articles){var id;return null==article&&(article=null),(null!=articles?articles.length:void 0)?(article||(id=this.getIdFromUrl(),article=this.getArticleFromBootstrap(id)),article?(articles=_.reject(articles,function(a){return a.id===article.id}),this.firstArticle=article,articles.unshift(article),articles):(console.info("moveArticleFirst needs an article to move first"),articles)):[article]},Articles.prototype.load_articles=function(firstArticle,articles){var _ref,_ref1,_ref2;return null==firstArticle&&(firstArticle=null!=(_ref=Time.bootstrap)?_ref.single_article:void 0),articles=(null!=(_ref1=Time.bootstrap)&&null!=(_ref2=_ref1.latest)?_ref2.articles:void 0)||[],firstArticle&&(articles=this.moveArticleFirst(firstArticle,articles)),articles.length?this.add(articles):this.app.railXHR=this.fetch(),this},Articles.prototype.url=function(){var url;return url=null!=this.view.vertical?Time.api_url+this.view.vertical+"/"+this.endpoint+"/":Time.api_url+this.endpoint+"/",this.page>1&&(url+="page/"+this.page+"/"),url},Articles.prototype.fetch=function(opts){var fn_complete,fn_error,fn_success;return null==opts&&(opts={}),this.syncing?void 0:((null==opts.cache||opts.cache)&&(opts.cache=!0),this.trigger("sync:syncing"),this.syncing=!0,opts.dataType="json",opts.next_page&&this.page++,fn_complete=opts.complete,opts.complete=function(_this){return function(model,response,options){_this.syncing=!1,_this.trigger("sync:complete"),null!=fn_complete&&fn_complete(model,response,options)}}(this),fn_success=opts.success,opts.success=function(_this){return function(model,response,options){return"object"!=typeof response?(_this.trigger("sync:error"),opts.error(model,response,options),!1):void _this.fetchSuccess(fn_success,model,response,options)}}(this),fn_error=opts.error,opts.error=function(_this){return function(model,response){_this.reached_ceiling=!0,$(".scroll-for-more").hide(),_this.trigger("sync:error"),null!=fn_error&&fn_error(model,response,options)}}(this),Backbone.Collection.prototype.fetch.call(this,opts))},Articles.prototype.fetchSuccess=function(originalCallback,model,response,options){var hasReadAndOrSharedArrays,isLoadedLessThanRequested,noArticles,noMoreToLoad,_ref,_ref1,_ref2;return this.trigger("sync:success"),"function"==typeof originalCallback&&originalCallback(model,response,options),isLoadedLessThanRequested=(null!=response&&null!=(_ref=response.articles)?_ref.length:void 0)<Time.posts_per_page,hasReadAndOrSharedArrays=(null!=response&&null!=(_ref1=response.read)?_ref1.length:void 0)>0||(null!=response&&null!=(_ref2=response.shared)?_ref2.length:void 0)>0,noArticles=response.error||response.articles===!1,noMoreToLoad=null==response||noArticles||isLoadedLessThanRequested,(noMoreToLoad||hasReadAndOrSharedArrays)&&this.reached_page_limit(),this},Articles.prototype.freezeIfSlug=function(slug,articleModel){var _ref,_ref1;return null!=slug?(this.freeze_url_once=!0,"gallery"===(null!=articleModel?articleModel.get("format"):void 0)?Time.initial_gallery_slug=slug:null!=articleModel&&null!=(_ref=articleModel.views)&&null!=(_ref1=_ref.singleView)&&_ref1.jump_to_item(slug),this.app.hide_loader(this.app.$viewportWrapper)):this.app.reset_scroll(),this},Articles.prototype.getArticleFromBootstrap=function(articleId){var article,_ref;return article=!1,articleId===(null!=(_ref=Time.bootstrap.single_article)?_ref.id:void 0)?Time.bootstrap.single_article:null!=Time.bootstrap.latest?article=_.find(Time.bootstrap.latest,function(a){return articleId===a.id}):!1},Articles.prototype.load_single_article=function(article_id,item_slug){var articleData,articleModel;return null!=this.get(article_id)?(this.synchronize(article_id,item_slug),this):(articleModel=new Time.models.Article({id:article_id}),this.listenToOnce(articleModel,"change:title",function(_this){return function(){var $tile;return _this.unshift(articleModel),$tile=$('.rail-article[data-article="'+articleModel.id+'"]').detach(),$tile.prependTo(".article-list"),_this.listenToOnce(articleModel,"article:rendered",function(){_this.app.hide_loader(_this.app.$viewportWrapper),_this.listenToOnce(_this,"viewport_filled",function(){_this.freezeIfSlug(item_slug,articleModel),"undefined"!=typeof console&&null!==console&&console.info("rail load_single_article setting isActive on article model"),articleModel.set("isActive",!0)}),_this.fill_viewport()}),_this.set_visible_article(articleModel),"undefined"!=typeof console&&null!==console&&console.info("rail load_single_article heard article model change:title, rendering single view"),articleModel.createSingleView(),articleModel.views.singleView.render()}}(this)),articleData=this.getArticleFromBootstrap(article_id),null!=articleData?articleModel.set(articleData):articleModel.fetch(),this)},Articles.prototype.parse=function(response){return console.log("collections/_rail -- parse",response),null==response?(console.error("collections/_rail -- parse -- no response"),this.reached_ceiling=!0,$(".scroll-for-more").hide(),null):response.articles?(response.articles=this.moveArticleFirst(null,response.articles),"videos"===this.active_env&&_.each(response.articles,function(article){return article.display_hero=null!=article.hero}),response.articles):(console.info("collections/_rail -- parse -- no articles in response:",response),this.reached_ceiling=!0,$(".scroll-for-more").hide(),null)},Articles.prototype.set_visible_article=function(model){return this.visible_article=model},Articles.prototype.get_visible_article=function(){return this.get(this.visible_article)},Articles.prototype.get_previous_article=function(){var activeArticleIndex,activeArticleModel,previousModel;if(this.app.model.get("activeArticle"))return activeArticleModel=this.app.model.get("activeArticle"),activeArticleIndex=this.indexOf(activeArticleModel),previousModel=this.at(activeArticleIndex-1),null!=previousModel?previousModel:!1},Articles.prototype.get_next_article=function(){var model;return model=this.at(this.indexOf(this.get_visible_article())+1),null!=model?model:!1},Articles.prototype.show_previous_article=function(){var previous_article;return previous_article=this.get_previous_article(),previous_article&&!previous_article.is_in_content_well()?(null==previous_article.views.singleView&&previous_article.createSingleView(),previous_article.views.singleView.render({method:"prepend"})):void 0},Articles.prototype.show_next_article=function(){var next_article,_ref;return next_article=this.get_next_article(),next_article?(next_article.is_in_content_well()||(null==next_article.views.singleView&&next_article.createSingleView(),null!=next_article.get("cover")?(null!=this.app.active_rail&&this.app.model.get("activeArticle")&&null!=(_ref=this.app.model.get("activeArticle"))&&_ref.set("isActive",!1),this.app.readingPane.articleViews.length=0,next_article.views.singleView.render(),next_article.views.tile_view.model.set("isActive",!0)):next_article.views.singleView.render({method:"append"})),this.set_visible_article(next_article)):this.fetch_next_page()},Articles.prototype.fetch_next_page=function(){return this.reached_ceiling?void 0:this.fetch({next_page:!0,remove:!1})},Articles.prototype.reached_page_limit=function(){this.reached_ceiling=!0,$(".scroll-for-more").hide(),this.view.scroll_limit_message(),this.app.$viewport.removeClass("loading")},Articles.prototype.synchronize=function(article_id,item_slug){var article_model,_ref;"undefined"!=typeof console&&null!==console&&console.info("collections/_rail -- synchronize",article_id,item_slug),this.trigger("flush"),null==article_id&&(article_id=this.at(0).cid),article_model=this.get(article_id),item_slug&&article_model.set("slug",item_slug),null==article_model.views.singleView&&article_model.createSingleView(),this.listenToOnce(article_model,"article:rendered",function(_this){return function(){_this.freezeIfSlug(item_slug,article_model),article_model.set("isActive",!0),_this.fill_viewport()}}(this)),null!=(_ref=this.app.infinite_scroll)&&_ref.enableUpScroll(),this.set_visible_article(article_model),"undefined"!=typeof console&&null!==console&&console.info("rail synchronize rendering single view"),article_model.views.singleView.render()},Articles.prototype.fill_viewport=function(){var bodyHeight,scrollHeight;return"undefined"!=typeof console&&null!==console&&console.log("_rail -> fill_viewport = content",this),this.app.model.get("isPrintMode")?this.trigger("viewport_filled"):(bodyHeight=this.app.$body.height()-this.app.$main_header.height(),scrollHeight=this.app.$notHeader.get(0).scrollHeight,!this.reached_ceiling&&0!==scrollHeight&&bodyHeight>=scrollHeight?(this.show_next_article(),window.setTimeout(function(_this){return function(){return _this.fill_viewport()}}(this),100)):this.trigger("viewport_filled"),this)},Articles.prototype.add_sponsored_article=function(){var error,sponsored_article;if(this.sponsored_article_index+1>Time.bootstrap.sponsors.length&&(this.sponsored_article_index=0,this.sponsored_article_cycles++),null==Time.bootstrap.sponsors[this.sponsored_article_index])return!1;this.rail_index=this.article_index+this.sponsored_article_index+Time.bootstrap.sponsors.length*this.sponsored_article_cycles,Time.bootstrap.sponsors[this.sponsored_article_index].id=parseInt(this.sponsored_article_cycles.toString()+Time.bootstrap.sponsors[this.sponsored_article_index].id.toString()),this.add(Time.bootstrap.sponsors[this.sponsored_article_index],{silent:!0,at:this.rail_index}),sponsored_article=this.at(this.rail_index);try{sponsored_article.views.tile_view=sponsored_article.createTileView(),sponsored_article.views.tile_view.render(),this.sponsored_article_index++}catch(_error){error=_error}return this},Articles.prototype.move_model=function(model,toIndex){var fromIndex;if(fromIndex=this.indexOf(model),-1===fromIndex)throw new Error("Can't move a model that's not in the collection");return this.models.splice(toIndex,0,this.models.splice(fromIndex,1)[0])},Articles.prototype.load_tabs=function(label){var href,new_tab_data,sub;return new_tab_data=Time.tab_data["default"],href="/"+this.active_env+"/"+this.sub+"/",sub=this.sub,new_tab_data.tabs[0]={label:null!=this.label?this.label:label,omniture:this.is_collection?"nav-collection":"nav-"+this.sub,env:this.active_env,sub:null!=this.sub?this.sub:sub,href:null!=this.href?this.href:href},this.app.load_tabs(new_tab_data),this.app.tabs_view.set_active(0),this},Articles.prototype.getNextListArticle=function(startIndex){var nextListArticle;return nextListArticle=null,_.each(this.models,function(article,index){return index>startIndex&&article.get("list_gallery_style")&&null===nextListArticle?nextListArticle=article:void 0}),nextListArticle},Articles.prototype.getPrevListArticle=function(startIndex){var prevListArticle;return prevListArticle=null,_.each(this.models,function(article,index){return startIndex>index&&article.get("list_gallery_style")?prevListArticle=article:void 0}),prevListArticle},Articles}(Backbone.Collection);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.collections.AuthorArticles=function(_super){function AuthorArticles(){return AuthorArticles.__super__.constructor.apply(this,arguments)}return __extends(AuthorArticles,_super),AuthorArticles.prototype.active_env="author",AuthorArticles.prototype.endpoint="author",AuthorArticles.prototype.initialize=function(models,opts){return this.app=opts.app,this.freeze_url_once=!0,this.sub=opts.sub,this.endpoint+="/"+this.sub,Time.trigger("leftRail:flush"),this.view=new Time.views.LeftRail({collection:this}),this.listenToOnce(Time,"change:activeArticle",function(model,value){Time.Tracking.article_view(value.toJSON())}),this.listenTo(this,"add",function(model){this.renderArticleTile(model),null!=Time.bootstrap.sponsors&&this.real_article_index%10===6&&this.add_sponsored_article()}),this},AuthorArticles.prototype.load_articles=function(firstArticle,articles){var _ref,_ref1;return null==firstArticle&&(firstArticle=null!=(_ref=Time.bootstrap)?_ref.single_article:void 0),articles=(null!=(_ref1=Time.bootstrap.author)?_ref1[this.sub]:void 0)||[],articles.length?(Time.application.render_top_banner(Time.bootstrap.author[this.sub].author),this.add(Time.bootstrap.author[this.sub].articles),this.view.render_author_header(Time.bootstrap.author[this.sub].author)):this.fetch({success:function(_this){return function(collection,response){return Time.application.render_top_banner(response.author),_this.view.render_author_header(response.author)}}(this)})},AuthorArticles}(Time.collections.Articles);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.collections.CollectionArticles=function(_super){function CollectionArticles(){return CollectionArticles.__super__.constructor.apply(this,arguments)}return __extends(CollectionArticles,_super),CollectionArticles.prototype.initialize=function(models,opts){var _ref,_ref1;return this.app=opts.app,this.active_env="collection",this.is_collection=!0,this.freeze_url_once=!0,Time.trigger("leftRail:flush"),this.sub=opts.sub,this.label=null!=Time.bootstrap.collection?Time.bootstrap.collection.left_rail_title:!1,this.href=null!=Time.bootstrap.collection?Time.bootstrap.collection.url:!1,this.view=new Time.views.LeftRail({collection:this}),(null!=(_ref=Time.bootstrap.collection)?_ref.hide_hub_nav:void 0)||Time.trigger("collection:banner:init"),null!=(null!=(_ref1=Time.bootstrap)?_ref1.collection:void 0)&&this.initBootstrappedCollection(),this.listenToOnce(Time,"change:activeArticle",function(model,value){Time.Tracking.article_view(value.toJSON())}),this.listenTo(this,"add",function(model){var $tileEl;"undefined"!=typeof console&&null!==console&&console.log("collection: add"),this.real_article_index++,$tileEl=$("#article-tile-"+model.id),model.id&&$tileEl.length>0&&(model.views.tile_view=model.createTileView(),model.views.tile_view.render())}),this.reached_page_limit(),this},CollectionArticles.prototype.injectAdZero=function(){return this.view.$el.prepend('<div class="ad-unit" id="ad-unit-0" pos="0"></div>'),this},CollectionArticles.prototype.initBootstrappedCollection=function(){var hubToggleHtml;return Time.bootstrap.collection.show_hub_toggle===!0&&(hubToggleHtml=Time.templates["collection-hub-toggle"].render({text:Time.bootstrap.collection.hub_toggle_text_show}),this.view.$el.prepend(hubToggleHtml)),null!=Time.bootstrap.collection.left_rail_top_ad&&Time.bootstrap.collection.left_rail_top_ad&&this.injectAdZero(),null!=Time.bootstrap.collection.intro_deck&&this.view.$el.prepend('<div id="section-description">'+Time.bootstrap.collection.intro_deck+"</div>"),null!=Time.bootstrap.collection.template&&(this.injectAdZero(),"best_colleges"===Time.bootstrap.collection.template&&(this.isBestColleges=!0,Modernizr.load({load:Time.template_uri+"/js/dist/time-best-colleges.js"})),"best_places"===Time.bootstrap.collection.template&&(this.isBestPlaces=!0,this.adFrequency=10,this.adOffset=5,Modernizr.load({load:Time.template_uri+"/js/dist/best-places.js"}))),this},CollectionArticles.prototype.url=function(){var url;return url=Time.api_url+"collection/"+this.sub+"/","time"!==Time.branding&&(url=Time.api_url+Time.branding+"/collection/"+this.sub+"/"),url},CollectionArticles.prototype.load_articles=function(firstArticle){var _ref;return null==firstArticle&&(firstArticle=null!=(_ref=Time.bootstrap)?_ref.single_article:void 0),Time.bootstrap.collection?(this.add(this.parse(Time.bootstrap.collection)),this.load_tabs(this.sub,".rail-tabs"),this):this},CollectionArticles.prototype.fill_viewport=function(){var bodyHeight,viewportHeight;"undefined"!=typeof console&&null!==console&&console.log("_rail -> fill_viewport = content",this),bodyHeight=this.app.$body.height()-this.app.$main_header.height(),viewportHeight=this.app.$notHeader.get(0).scrollHeight,0!==viewportHeight&&bodyHeight>=viewportHeight?(this.show_next_article(),setTimeout(function(_this){return function(){return _this.fill_viewport()}}(this),100)):(this.show_next_article(),this.trigger("viewport_filled"))},CollectionArticles.prototype.render_ads=function(){var $current,ad_index,ad_placeholder_id,data,i,index,num_article,rail_articles;for(rail_articles=this.view.$scroll_container.find(".collection-rail-article"),num_article=rail_articles.length,ad_index=1,data={},i=0;num_article>i;)index=i+1,index%5===0&&index%10!==0&&($current=$(rail_articles[i]),ad_placeholder_id="ad-unit-"+ad_index,$("<div/>",{"class":"ad-unit",id:ad_placeholder_id,pos:ad_index}).insertBefore($current),Time.trigger("dfpAdManager:renderLeftRailAd",ad_placeholder_id),ad_index+=1),i+=1},CollectionArticles.prototype.fetch_next_page=function(){return this.reached_ceiling=!0,this.app.$viewport.removeClass("loading")},CollectionArticles.prototype.parse=function(response){var article,articles,hub,hubs,_i,_j,_len,_len1,_ref;if("undefined"!=typeof console&&null!==console&&console.log("parse(response): ",response),hubs=null!=response?response.hubs:!1,"undefined"!=typeof console&&null!==console&&console.log("hubs: ",hubs),articles=[],null!=response.intro_post&&(response.intro_post.format="collection_intro",articles.push(response.intro_post)),null!=hubs&&hubs.length)for(_i=0,_len=hubs.length;_len>_i;_i++)if(hub=hubs[_i],null!=hub.articles)for(_ref=hub.articles,_j=0,_len1=_ref.length;_len1>_j;_j++)article=_ref[_j],articles.push(article);return"undefined"!=typeof console&&null!==console&&console.log("collection articles: ",articles),articles},CollectionArticles}(Time.collections.Articles);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.collections.MagazineArticles=function(_super){function MagazineArticles(){return MagazineArticles.__super__.constructor.apply(this,arguments)}return __extends(MagazineArticles,_super),MagazineArticles.prototype.active_env="magazine",MagazineArticles.prototype.endpoint="magazine",MagazineArticles.prototype.initialize=function(models,opts){var full_title;return this.app=opts.app,this.freeze_url_once=!0,Time.trigger("leftRail:flush"),this.region=null!=opts.sub?opts.sub:"us",this.endpoint+=null!=Time.curRoute.magazine_id?"/issue/"+Time.curRoute.magazine_id:"/region/"+this.region,$(".top-banner").html(""),full_title=$("[data-region='"+this.region+"']").html(),$(".toggle-magazine-region-dropdown").html(full_title),Time.application.$body.addClass("has-section-menu"),this.view=new Time.views.LeftRail({collection:this}),this.listenToOnce(Time,"change:activeArticle",function(model,value){Time.Tracking.article_view(value.toJSON())}),this.listenTo(this,"add",function(model){this.renderArticleTile(model)}),this},MagazineArticles.prototype.parse=function(response){var articles,key,val,_ref,_ref1;if(articles=null!=(_ref=response[0])?_ref.articles:void 0,null!=articles&&articles.length&&(articles[0].cover=1,articles[0].magazine={},response[0])){_ref1=response[0];for(key in _ref1)val=_ref1[key],"articles"!==key&&(articles[0].magazine[key]=val)}return"undefined"!=typeof console&&null!==console&&console.log("magazine articles: ",articles),articles},MagazineArticles.prototype.load_articles=function(){return null!=Time.bootstrap.magazine&&Time.bootstrap.magazine[this.region]?this.add(this.parse(Time.bootstrap.magazine[this.region])):this.fetch(),this},MagazineArticles}(Time.collections.Articles);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.collections.MoneyMagazineArticles=function(_super){function MoneyMagazineArticles(){return MoneyMagazineArticles.__super__.constructor.apply(this,arguments)}return __extends(MoneyMagazineArticles,_super),MoneyMagazineArticles.prototype.active_env="money_magazine",MoneyMagazineArticles.prototype.endpoint="magazine",MoneyMagazineArticles.prototype.initialize=function(models,opts){return this.app=opts.app,this.freeze_url_once=!0,Time.trigger("leftRail:flush"),this.sub=opts.sub,this.href=Time.home_url+"/money/magazine/",this.view=new Time.views.LeftRail({collection:this}),this.listenToOnce(Time,"change:activeArticle",function(model,value){Time.Tracking.article_view(value.toJSON())}),this.listenTo(this,"add",function(model){this.renderArticleTile(model),null!=Time.bootstrap.sponsors&&this.real_article_index%10===6&&this.add_sponsored_article()}),this},MoneyMagazineArticles.prototype.load_articles=function(firstArticle){var money_magazine_data,_ref;return null==firstArticle&&(firstArticle=null!=(_ref=Time.bootstrap)?_ref.single_article:void 0),null!=Time.bootstrap.publication&&null!=Time.bootstrap.publication["time-publication-money-magazine"]?(money_magazine_data=Time.bootstrap.publication["time-publication-money-magazine"],money_magazine_data.name&&this.load_tabs(money_magazine_data.name),this.app.render_top_banner(money_magazine_data),null!=money_magazine_data.articles&&this.add(money_magazine_data.articles),this):(this.fetch({success:function(_this){return function(model,response){return response.name&&_this.load_tabs(response.name),_this.app.render_top_banner(response)}}(this)}),this)},MoneyMagazineArticles}(Time.collections.Articles);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.collections.NativoArticles=function(_super){function NativoArticles(){return NativoArticles.__super__.constructor.apply(this,arguments)}return __extends(NativoArticles,_super),NativoArticles.prototype.active_env="nativo",NativoArticles.prototype.initialize=function(models,opts){return this.app=opts.app,Time.trigger("leftRail:flush"),this.view=new Time.views.LeftRail({collection:this}),this.listenToOnce(this,"article:rendered",function(){Time.Tracking.article_view(Time.application.model.get("activeArticle").toJSON())}),this.listenTo(this,"add",function(model){this.renderArticleTile(model)}),this},NativoArticles.prototype.load_articles=function(firstArticle){var _ref;return null==firstArticle&&(firstArticle=null!=(_ref=Time.bootstrap)?_ref.single_article:void 0),!1
},NativoArticles}(Time.collections.Articles);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.collections.PopularArticles=function(_super){function PopularArticles(){return PopularArticles.__super__.constructor.apply(this,arguments)}return __extends(PopularArticles,_super),PopularArticles.prototype.active_env="popular",PopularArticles.prototype.endpoint="popular",PopularArticles.prototype.initialize=function(models,options){return null==options&&(options={}),this.app=options.app,this.freeze_url_once=!0,Time.trigger("leftRail:flush"),this.app.load_ticker(),this.view=new Time.views.LeftRail({collection:this}),this.app.tabs_view.set_active("popular"),this.listenToOnce(Time,"change:activeArticle",function(model,value){Time.Tracking.article_view(value.toJSON())}),this.listenTo(this,"add",function(model){this.renderArticleTile(model)}),this},PopularArticles.prototype.load_articles=function(firstArticle){var _ref;return null==firstArticle&&(firstArticle=null!=(_ref=Time.bootstrap)?_ref.single_article:void 0),this.app.railXHR=this.fetch({success:function(_this){return function(collection,response){return _this.view.render_header("10 Most Read"),_.each(response.read,function(item){return _this.add(new Time.models.Article(item))}),_this.view.render_header("10 Most Shared"),_.each(response.shared,function(item){return _this.add(new Time.models.Article(item))})}}(this)}),this},PopularArticles}(Time.collections.Articles);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.collections.SectionArticles=function(_super){function SectionArticles(){return SectionArticles.__super__.constructor.apply(this,arguments)}return __extends(SectionArticles,_super),SectionArticles.prototype.active_env="section",SectionArticles.prototype.endpoint="section",SectionArticles.prototype.initialize=function(models,options){return null==options&&(options={}),this.app=options.app,this.freeze_url_once=!0,$("body").addClass("tax-time_section"),Time.trigger("leftRail:flush"),this.sub=options.sub,this.endpoint+="/"+this.sub,this.section_tag=options.section_tag,this.view=new Time.views.LeftRail({collection:this}),this.section_tag?(this.load_tabs(this.sub,".rail-tabs"),$("body").addClass("tax-time-section-tag")):$("body").hasClass("tax-time-section-tag")&&$("body").removeClass("tax-time-section-tag"),this.listenToOnce(Time,"change:activeArticle",function(model,value){Time.Tracking.article_view(value.toJSON())}),this.listenTo(this,"add",function(model){this.renderArticleTile(model),null!=Time.bootstrap.sponsors&&this.real_article_index%10===6&&this.add_sponsored_article()}),this},SectionArticles.prototype.fetchArticles=function(){return this.fetch({success:function(_this){return function(collection,response){return _this.section_tag?Time.application.load_ticker():(Time.application.render_section_header(response),Time.trigger("topic:banner:init",response))}}(this)}),this},SectionArticles.prototype.load_articles=function(firstArticle,articles){var bootstrap,initialArticle,_ref,_ref1,_ref2,_ref3;if(null==firstArticle&&(firstArticle=null!=(_ref=Time.bootstrap)?_ref.single_article:void 0),"section"===this.active_env&&null!=(null!=(_ref1=Time.bootstrap.section)?_ref1[this.sub]:void 0))bootstrap=null!=(_ref2=Time.bootstrap.section)?_ref2[this.sub]:void 0,null!=bootstrap.articles&&this.add(this.parse(Time.bootstrap.section[this.sub])),"life"===this.sub&&(bootstrap.life=!0),"lightbox"===this.sub&&(bootstrap.lightbox=!0,bootstrap.name="LightBox"),Time.application.render_section_header(bootstrap),this.view.render_section_header(bootstrap),this.load_tabs(this.sub,".rail-tabs"),Time.trigger("topic:banner:init",bootstrap);else{if(null!=(null!=(_ref3=Time.bootstrap.latest)?_ref3.articles:void 0))return initialArticle=Time.bootstrap.single_article||null,initialArticle&&(articles=this.moveArticleFirst(initialArticle,Time.bootstrap.latest.articles)),void this.add(articles);this.fetchArticles()}},SectionArticles.prototype.load_tabs=function(label,el_selector){var href,new_tab_data,vertical;return vertical=Time.application.hasPushstate?document.location.pathname.substring(1).split("/")[0]:document.location.hash.substring(1).split("/")[0],new_tab_data=Time.tab_data["default"],"us"===label&&(label="U.S."),href=vertical.match(/money/)?"/"+vertical+"/"+this.sub+"/":"/"+this.sub+"/",new_tab_data.tabs[0]={label:label.replace("-"," "),omniture:"nav-"+this.sub,env:this.active_env,sub:this.sub,href:href},Time.application.load_tabs(new_tab_data,el_selector),Time.application.tabs_view.set_active(0)},SectionArticles.prototype.parse=function(response){var articles;return null!=response.lineup?(articles=response.articles,response.format="section-front",response.title="Today in "+response.name,articles.unshift(response),articles):(("life"===this.sub||"lightbox"===this.sub)&&_.each(response.articles,function(article){return article.display_hero=null!=article.hero}),response.articles)},SectionArticles}(Time.collections.Articles);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.collections.SponsorArticles=function(_super){function SponsorArticles(){return SponsorArticles.__super__.constructor.apply(this,arguments)}return __extends(SponsorArticles,_super),SponsorArticles.prototype.active_env="sponsor",SponsorArticles.prototype.endpoint="sponsor",SponsorArticles.prototype.initialize=function(models,options){return null==options&&(options={}),this.app=options.app,Time.trigger("leftRail:flush"),this.sponsor=options.sub,this.endpoint+="/"+this.sponsor,this.view=new Time.views.LeftRail({collection:this}),this.listenToOnce(Time,"change:activeArticle",function(model,value){Time.Tracking.article_view(value.toJSON())}),this.listenTo(this,"add",function(model){this.renderArticleTile(model),null!=Time.bootstrap.sponsors&&this.real_article_index%10===6&&this.add_sponsored_article()}),this},SponsorArticles.prototype.load_articles=function(firstArticle){var _ref;return null==firstArticle&&(firstArticle=null!=(_ref=Time.bootstrap)?_ref.single_article:void 0),null!=Time.bootstrap.sponsor&&null!=Time.bootstrap.sponsor[this.slug]?null!=Time.bootstrap.sponsor[this.slug].articles&&this.add(Time.bootstrap.sponsor[this.slug].articles):this.fetch(),this},SponsorArticles}(Time.collections.Articles);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.collections.TagArticles=function(_super){function TagArticles(){return TagArticles.__super__.constructor.apply(this,arguments)}return __extends(TagArticles,_super),TagArticles.prototype.active_env="tag",TagArticles.prototype.endpoint="tag",TagArticles.prototype.initialize=function(models,options){return this.app=options.app,this.freeze_url_once=!0,Time.trigger("leftRail:flush"),this.sub=options.sub,this.endpoint+="/"+this.sub,this.view=new Time.views.LeftRail({collection:this}),this.listenToOnce(Time,"change:activeArticle",function(model,value){Time.Tracking.article_view(value.toJSON())}),this.listenTo(this,"add",function(_this){return function(model){_this.renderArticleTile(model),null!=Time.bootstrap.sponsors&&_this.real_article_index%10===6&&_this.add_sponsored_article()}}(this)),this},TagArticles.prototype.load_articles=function(firstArticle){var _ref,_ref1;return null==firstArticle&&(firstArticle=null!=(_ref=Time.bootstrap)?_ref.single_article:void 0),null!=(null!=(_ref1=Time.bootstrap.tag)?_ref1[this.sub]:void 0)?(Time.bootstrap.tag[this.sub].name&&this.load_tabs(Time.bootstrap.tag[this.sub].name),null!=Time.bootstrap.tag[this.sub].articles&&this.add(Time.bootstrap.tag[this.sub].articles),this.app.render_top_banner(Time.bootstrap.tag[this.sub]),this):(this.fetch({success:function(_this){return function(model,response){return _this.app.render_top_banner(response),response.name?_this.load_tabs(response.name):void 0}}(this)}),this)},TagArticles}(Time.collections.Articles);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.collections.TopicArticles=function(_super){function TopicArticles(){return TopicArticles.__super__.constructor.apply(this,arguments)}return __extends(TopicArticles,_super),TopicArticles.prototype.active_env="topic",TopicArticles.prototype.endpoint="topic",TopicArticles.prototype.initialize=function(models,options){var vertical,_ref;return this.app=options.app,this.freeze_url_once=!0,Time.trigger("leftRail:flush"),this.sub=options.sub,this.endpoint+="/"+this.sub,vertical=Time.application.hasPushstate?document.location.pathname.substring(1).split("/")[0]:document.location.hash.substring(1).split("/")[0],this.href=vertical.match(/money/)?"/"+vertical+"/topic/"+this.sub+"/":"/topic/"+this.sub+"/",this.view=new Time.views.LeftRail({collection:this}),this.view.unbind=function(_this){return function(){return null!=_this.$topic_embed?_this.$topic_embed.trigger("embed.destroy"):void 0}}(this),null!=(null!=(_ref=Time.bootstrap.topic)?_ref[this.sub]:void 0)&&(this.load_tabs(Time.bootstrap.topic[this.sub].left_rail_title),null!=Time.bootstrap.topic[this.sub].intro&&this.load_intro(Time.bootstrap.topic[this.sub])),this.listenToOnce(Time,"change:activeArticle",function(model,value){var active_article_attributes;active_article_attributes=value?value.toJSON():Time.bootstrap.single_article,Time.Tracking.article_view(active_article_attributes)}),this.listenTo(this,"add",function(model){this.renderArticleTile(model),null!=Time.bootstrap.sponsors&&this.real_article_index%10===6&&this.add_sponsored_article()}),this.listenTo(Time,"router:route",function(_this){return function(){"topic"!==Time.curRoute.env&&_this.app.$body.removeClass("vault-topic")}}(this)),this},TopicArticles.prototype.load_topic_embed=function(topic_embed){var d,embed_id,embed_script,n,_ref;if(embed_id=$(topic_embed).attr("id"),!(null!=(_ref=$("#"+embed_id))?_ref.length:void 0)||Time.application.hasPushstate){if(this.view.render_topic_header_embed(topic_embed),this.$topic_embed=$("#"+embed_id),embed_script=this.$topic_embed.data("script"),null==embed_script)return;d=new Date,n=d.getMilliseconds(),Modernizr.load({load:Time.template_uri+embed_script+"?"+n})}},TopicArticles.prototype.load_articles=function(firstArticle){var _ref,_ref1,_ref2;return null==firstArticle&&(firstArticle=null!=(_ref=Time.bootstrap)?_ref.single_article:void 0),null!=(null!=(_ref1=Time.bootstrap)&&null!=(_ref2=_ref1.topic)?_ref2[this.sub]:void 0)?this.loadArticlesFromBootstrap():(this.fetch({success:function(_this){return function(collection,response){return _this.app.render_top_banner(response),_this.view.render_topic_header(response),_this.load_tabs(response.left_rail_title),null!=response.embed&&(_this.view.render_topic_header_embed(response.embed),_this.load_topic_embed(response.embed)),null!=response.is_vault&&Time.application.$body.addClass("vault-topic"),null!=response.intro?_this.load_intro(response):void 0}}(this)}),this)},TopicArticles.prototype.load_intro=function(topic){var topicIntro;return"undefined"!=typeof console&&null!==console&&console.log("rendering topic intro"),topicIntro=Time.templates["topic-intro"].render(topic),$(topicIntro).prependTo(Time.application.$viewport),this.listenTo(Time,"router:route",function(){return"topic"!==Time.curRoute.env?$(".topic-intro").remove():void 0})},TopicArticles.prototype.loadArticlesFromBootstrap=function(){var articles,initialArticle,topicObject,_ref;return topicObject=Time.bootstrap.topic[this.sub],console.info("-- loadArticlesFromBootstrap ",topicObject),articles=topicObject.articles,null!=articles?(initialArticle=(null!=(_ref=Time.bootstrap)?_ref.single_article:void 0)||null,articles=this.moveArticleFirst(initialArticle,articles),this.add(articles)):console.warn("load_articles -- No articles in topic! How did you get here..."),this.view.render_topic_header(topicObject),"undefined"!=typeof console&&null!==console&&console.info("collection topic -> load articles -> @ : ",this),this.app.render_top_banner(topicObject),null!=topicObject.embed&&this.load_topic_embed(topicObject.embed),this},TopicArticles}(Time.collections.Articles);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.collections.VideoArticles=function(_super){function VideoArticles(){return VideoArticles.__super__.constructor.apply(this,arguments)}return __extends(VideoArticles,_super),VideoArticles.prototype.active_env="videos",VideoArticles.prototype.endpoint="videos",VideoArticles.prototype.initialize=function(models,options){return this.app=options.app,this.freeze_url_once=!0,Time.trigger("leftRail:flush"),this.app.load_ticker(),this.view=new Time.views.LeftRail({collection:this}),this.app.tabs_view.set_active("videos"),Time.trigger("leftRail:load:videos"),this.listenToOnce(Time,"article:activated",function(){Time.Tracking.article_view(Time.application.model.get("activeArticle").toJSON())}),this.listenTo(this,"add",function(_this){return function(model){_this.renderArticleTile(model)}}(this)),this},VideoArticles.prototype.load_articles=function(firstArticle){var _ref;return null==firstArticle&&(firstArticle=null!=(_ref=Time.bootstrap)?_ref.single_article:void 0),Time.application.railXHR=this.fetch({complete:function(){}}),this},VideoArticles}(Time.collections.Articles);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.collections.BrightcoveVideos=function(_super){function BrightcoveVideos(){return BrightcoveVideos.__super__.constructor.apply(this,arguments)}return __extends(BrightcoveVideos,_super),BrightcoveVideos.prototype.model=Time.models.BrightcoveVideo,BrightcoveVideos.prototype.initialize=function(){return this},BrightcoveVideos.prototype.getOthers=function(id){var otherPlayers;return otherPlayers=this.reject(function(otherPlayer){return otherPlayer.id===id})},BrightcoveVideos}(Backbone.Collection);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.collections.DfpAds=function(_super){function DfpAds(){return DfpAds.__super__.constructor.apply(this,arguments)}return __extends(DfpAds,_super),DfpAds.prototype.model=Time.models.DfpAd,DfpAds.prototype.initialize=function(){return this.listenTo(this,"remove",function(model){console.debug(model.id," DfpAd removed from collection, deleting slot");try{delete tgxDo.slots[model.id]}catch(_error){}}),this},DfpAds.prototype.getIds=function(options){var adModels,ids,_ref;if(null==options&&(options=!1),options){if(null!=(_ref=options.groups)?_ref.length:void 0)return console.debug("-- getting div ids for "+options.groups.toString()),ids=[],_.each(options.groups,function(_this){return function(group){var groupIds,newOptions;return newOptions=_.omit(options,"groups"),newOptions.group=group,groupIds=_this.getIds(newOptions),ids=ids.concat(groupIds)}}(this)),ids;adModels=this.where(options)}else adModels=this.models;return ids=_.pluck(adModels,"id")},DfpAds}(Backbone.Collection);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.collections.Galleries=function(_super){function Galleries(){return Galleries.__super__.constructor.apply(this,arguments)}return __extends(Galleries,_super),Galleries.prototype.model=function(attributes,options){switch(null!=attributes?attributes.size:void 0){case"vertical":return new Time.models.Gallery(attributes,options);default:return new Time.models.GalleryLightbox(attributes,options)}},Galleries.prototype.initialize=function(models,options){return null==options&&(options={}),this.cache={},options.article?(this.article=options.article,this.listenTo(this,"add change",function(model){return this.addToCache(model.toJSON(),model.id)}),this.listenTo(this,"gallery:replace",function(oldId,newId){var _ref;return null==oldId&&(oldId=null!=(_ref=Time.activeGallery)?_ref.id:void 0),this.replaceGallery(oldId,newId)})):(console.error("Galleries collection needs an article",options),null)},Galleries.prototype.replaceGallery=function(oldId,newId){var $galleryViewParent,newGalleryModel,oldGalleryModel,_ref;return null==oldId&&(oldId=null!=(_ref=Time.activeGallery)?_ref.id:void 0),oldGalleryModel=this.get(oldId),newGalleryModel=this.get(newId),null==newGalleryModel&&(this.add({id:newId}),newGalleryModel=this.get(newId)),$galleryViewParent=oldGalleryModel.view.$el.parent(),this.listenTo(newGalleryModel,"sync:success",function(){var galleryView,html;return oldGalleryModel.view.remove(),galleryView=newGalleryModel.getView({model:newGalleryModel}),html=galleryView.render().el,$galleryViewParent.html(html),$galleryViewParent.attr("data-gallery",newId),Time.application.model.set("activeGallery",newGalleryModel),galleryView.trigger("gallery:rendered")}),newGalleryModel.get("photos")?newGalleryModel.trigger("sync:success"):newGalleryModel.fetch()},Galleries.prototype.addToCache=function(data,id){return null==id&&(id=null),null==id&&(id=data.id),null==this.cache[id]&&(this.cache[id]=data),this},Galleries.prototype.get_from_cache=function(id){return null!=this.cache[id]?this.model(this.cache[id]):null},Galleries}(Backbone.Collection);var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.collections.GallerySlides=function(_super){function GallerySlides(){return this.model=__bind(this.model,this),GallerySlides.__super__.constructor.apply(this,arguments)}return __extends(GallerySlides,_super),GallerySlides.prototype.model=function(attributes,options){switch(null==attributes&&(attributes={}),null==options&&(options={}),options.collection=this,options.galleryView=this.galleryView||null,options.galleryModel=this.galleryModel||null,null!=attributes?attributes.slideType:void 0){case"ad":return new Time.models.GallerySlideAd(attributes,options)}return new Time.models.GallerySlide(attributes,options)},GallerySlides.prototype.initialize=function(models,options){return null==models&&(models=[]),null==options&&(options={}),console.info("GallerySlides collection -- init",models,options),null==options.gallery?(console.error("GallerySlides collection needs to be attached to a gallery",options),null):(this.galleryView=options.gallery,this.galleryModel=this.galleryView.model,_.map(models,function(_this){return function(model){return model.galleryTitle=_this.galleryModel.get("title")||"Untitled Gallery",model.twitterVia=_this.galleryModel.get("twitter_via")||"Time",model.twitterText=_this.galleryModel.get("twitter_text"),model.facebookText=_this.galleryModel.get("fb_text"),model.emailText=_this.galleryModel.get("email_body")}}(this)),this.galleryModel.get("hasAds")&&this.addAds(models,this.galleryModel.get("adfrequency")),"endless"===this.galleryModel.get("type")&&this.galleryModel.get("next_gallery")?this.addEndless(models,this.galleryModel.get("next_gallery")):this.galleryModel.get("galleries")&&this.addRelated(models,this.galleryModel.get("galleries")),this.listenTo(this.galleryModel,"change:slideIndex",function(_this){return function(){var newActiveSlideIndex,newActiveSlideModel,oldActiveModel;console.info("gallery "+_this.galleryModel.id+" slides collection heard change:slideIndex toggling slide isActive states"),oldActiveModel=_this.findWhere({isActive:!0}),null!=oldActiveModel&&oldActiveModel.set("isActive",!1),newActiveSlideIndex=_this.galleryModel.get("slideIndex"),newActiveSlideModel=_this.at(newActiveSlideIndex),newActiveSlideModel.set({isActive:!0})}}(this)),this.listenTo(this,"gallery:slides:flush",function(){console.info("gallery "+this.galleryModel.id+" slides collection - flush isRendered for slides"),this.invoke("set",{isRendered:!1})}),this)},GallerySlides.prototype.addAds=function(models,frequency){var adsAdded,adsToAd,index,regularSlides;for(null==models&&(models=[]),null==frequency&&(frequency=6),regularSlides=models.length,console.info("gallery slides collection -- adding ads every "+frequency+" slide"),adsToAd=Math.floor(regularSlides/(frequency-1)),adsAdded=0;adsToAd>adsAdded;){if(index=(adsAdded+1)*frequency-1,index>=models.length)return this;models.splice(index,0,{slideType:"ad",index:index,adIndex:adsAdded+1}),adsAdded++}return this},GallerySlides.prototype.addEndless=function(models,nextGallery){return null==models&&(models=[]),null!=this.galleryModel&&this.galleryModel.id===nextGallery.id||"vertical"===this.galleryModel.get("size")||null==nextGallery?void 0:(models.push({slideType:"endless",nextGallery:nextGallery}),this)},GallerySlides.prototype.addRelated=function(models,galleries){return null==models&&(models=[]),"vertical"!==this.galleryModel.get("size")&&(null!=this.galleryModel&&(galleries=_.filter(galleries,function(_this){return function(gallery){return gallery.id!==_this.galleryModel.id}}(this))),null!=galleries?galleries.length:void 0)?(models.push({slideType:"related",galleries:galleries}),this):void 0},GallerySlides}(Backbone.Collection),Time.collections.MarketData=Backbone.Collection.extend({model:Time.models.MarketData,url:"http://www.fortune.idmanagedsolutions.com/money/index/index-quotes-json",parse:function(response){return response},sync:function(method,model,options){var params;return params=_.extend({type:"GET",dataType:"jsonp",url:this.url,processData:!1},options),$.ajax(params)}}),_.extend(Time.collections.MarketData.prototype,Backbone.Events);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.collections.MasonryCollection=function(_super){function MasonryCollection(){return MasonryCollection.__super__.constructor.apply(this,arguments)}return __extends(MasonryCollection,_super),MasonryCollection.prototype.model=Time.models.MasonryModel,MasonryCollection.prototype.adFrequency=5,MasonryCollection.prototype.adOffset=10,MasonryCollection.prototype.reached_ceiling=!1,MasonryCollection.prototype.syncing=!1,MasonryCollection.prototype.page=2,MasonryCollection.prototype.posts_per_page=10,MasonryCollection.prototype.initialize=function(articles,opts){return this.bootstrap=opts.bootstrap,this.view=opts.view,this.ads=[],this.lastContainerWidth=this.view.$container.width(),this.renderMasonry(articles,!0),this.listenTo(this.view,"masonryView:appended",function(_this){return function(){return _this.refreshAds(),"collection"===_this.bootstrap.tax?_this.reachedCeiling():void 0}}(this)),this},MasonryCollection.prototype.url=function(){var url;return url=Time.api_url+this.bootstrap.endpoint,this.page>1&&(url+="page/"+this.page+"/"),url},MasonryCollection.prototype.fetch=function(opts){var fn_complete,fn_error,fn_success;return null==opts&&(opts={}),this.syncing||this.reached_ceiling?void 0:(this.syncing=!0,opts.next_page&&this.page++,fn_complete=opts.complete,opts.complete=function(_this){return function(model,response,options){_this.syncing=!1,null!=fn_complete&&fn_complete(model,response,options)}}(this),fn_success=opts.success,opts.success=function(_this){return function(model,response,options){return _this.bootstrap.userAction="masonry",Time.Tracking.article_view(_this.bootstrap),("object"!=typeof response||response.error)&&opts.error(model,response,options),response.articles.length<_this.posts_per_page?_this.reachedCeiling():void 0}}(this),fn_error=opts.error,opts.error=function(_this){return function(model,response){_this.reachedCeiling(),null!=fn_error&&fn_error(model,response,options)}}(this),Backbone.Collection.prototype.fetch.call(this,opts))},MasonryCollection.prototype.parse=function(response){return response.error||this.renderMasonry(response.articles),response.articles},MasonryCollection.prototype.renderMasonry=function(articles,first){var article,masonryArticles,masonryTiles,_i,_len,_ref;for(null==first&&(first=!1),masonryArticles=[],this.adsToRender=[],_ref=JSON.parse(JSON.stringify(articles)),_i=0,_len=_ref.length;_len>_i;_i++)article=_ref[_i],article.hero&&masonryArticles.push(article);return first&&(masonryArticles=this.stampFirstArticle(masonryArticles)),masonryArticles=this.addAdTiles(masonryArticles),masonryTiles="",_.each(masonryArticles,function(_this){return function(article){switch(article.showCredit=null!=article.first,_this.bootstrap.tax){case"tag":article.showSectionTag=!0;break;case"collection":article.showCredit=null!=article.first||"post"===article.post_type&&article.hero.providers.length}return masonryTiles+=Time.templates["article-masonry-"+article.post_type].render(article)}}(this)),this.view.addAll($(masonryTiles))},MasonryCollection.prototype.stampFirstArticle=function(articles){var introTile,shouldStamp,viewport;return viewport=this.view.$container.width(),shouldStamp=viewport>600,articles[0].first=shouldStamp,"collection"===this.bootstrap.tax&&null!=this.bootstrap.intro_deck?(introTile={intro_deck:this.bootstrap.intro_deck,post_type:"collection-intro",stamp:shouldStamp},viewport>1240?(articles.splice(2,0,articles.splice(0,1)[0]),articles.splice(1,0,introTile)):articles.splice(0,0,introTile)):viewport>1240&&articles.splice(1,0,articles.splice(0,1)[0]),articles},MasonryCollection.prototype.addAdTiles=function(articles){var ad,adIndex,article,index,realIndex,_i,_len;for(index=_i=0,_len=articles.length;_len>_i;index=++_i)article=articles[index],adIndex=this.ads.length+1,realIndex=index+1,realIndex%this.adOffset&&realIndex%this.adFrequency===0&&(ad={hero:!0,post_type:"ad",id:"masonry_ad_"+adIndex,pos:adIndex},articles.splice(index,0,ad),this.adsToRender.push(ad),this.ads.push(ad));return articles},MasonryCollection.prototype.reachedCeiling=function(){return this.reached_ceiling=!0,this.trigger("masonryCollection:reached-ceiling")},MasonryCollection.prototype.resizeHandler=function(){var $container;if(this.lastContainerWidth!==this.view.$container.width())return this.view.$footer.css("display","none"),$container=this.view.$container,$container.empty(),$container.isotope(),this.renderMasonry(this.toJSON(),!0),this.lastContainerWidth=this.view.$container.width()},MasonryCollection.prototype.refreshAds=function(){var ad,_i,_len,_ref;if(this.adsToRender.length){for(_ref=this.adsToRender,_i=0,_len=_ref.length;_len>_i;_i++)ad=_ref[_i],Time.tgxAdapter.activateAd(null,{id:ad.id,size:["300x250"],position:ad.pos,group:"photography"});return Time.tgxAdapter.refreshAds(null,_.pluck(this.adsToRender,"id"))}},MasonryCollection}(Backbone.Collection);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.collections.VaultMagazines=function(_super){function VaultMagazines(){return VaultMagazines.__super__.constructor.apply(this,arguments)}return __extends(VaultMagazines,_super),VaultMagazines.prototype.model=Time.models.VaultMagazine,VaultMagazines.prototype.BASE_PATH="/api/magazine",VaultMagazines.prototype.initialize=function(models,options){var _ref,_ref1;return null==options&&(options={}),this.vault=options.vault,this.cache={},this.lastRequest="",this.isBootstrapped=!1,(null!=(_ref=Time.bootstrap)&&null!=(_ref1=_ref.vault)?_ref1.length:void 0)&&this.bootstrap(options),this},VaultMagazines.prototype.bootstrap=function(options){var bootstrappedModels,request,requestUrl,vaultPath,_ref;return request=[],null!=options.filterType&&request.push(options.filterType),null!=options.filterValue&&request.push(options.filterValue),vaultPath="vault/"+request.join("/")+"/",("year"===(_ref=options.filterType)||"subject"===_ref)&&request.push("noarticles"),requestUrl=this.url(request),Time.application.hasPushstate||Time.bootstrap.pathname===vaultPath?(this.vault.model.DEBUG&&console.log("vault: fragment/path match, bootstrapping"),this.lastRequest=requestUrl,bootstrappedModels=this.parse(Time.bootstrap.vault,{url:requestUrl}),this.set(bootstrappedModels),this):(this.vault.model.DEBUG&&console.log("vault: fragment/path mismatch bootstrap, synchronous fetching"),this.maybeFetch(requestUrl,{url:requestUrl,async:!1}),this)},VaultMagazines.prototype.url=function(fragments){var endpoint;return endpoint=[this.BASE_PATH],(null!=fragments?fragments.length:void 0)?endpoint.push.apply(endpoint,fragments):"covers"===this.vault.model.get("context")&&(endpoint.push(this.vault.model.get("filterType")),endpoint.push(this.vault.model.getFilterValue()),endpoint.push("noarticles")),endpoint=endpoint.join("/"),endpoint+"/"},VaultMagazines.prototype.maybeFetch=function(url,options){var fetchOptions,_ref;return null==url&&(url=this.url()),null==options&&(options={}),this.lastRequest===url?"current":(this.lastRequest=url,url in this.cache?(this.vault.model.DEBUG&&console.log("vault: using cached response for ",url),this.reset(this.cache[url]),"cached"):(this.vault.model.DEBUG&&console.log("vault: fetching ",url),null!=(_ref=this.XHR)&&"function"==typeof _ref.abort&&_ref.abort(),fetchOptions=_.extend({reset:!0},options),this.XHR=this.fetch(fetchOptions),"fetching"))},VaultMagazines.prototype.parse=function(response,options){var url;return null==options&&(options={}),response.error&&(response=[]),"url"in options&&(url=options.url),"fragments"in options&&null==url&&(url=this.url(options.fragments)),null==url&&(url=this.url()),this.cache[url]=response,response},VaultMagazines.prototype.yearUrlFromDate=function(issueDate){var issueYear,url;return url=[this.BASE_PATH],issueYear=issueDate.substring(0,4),url.push("year",issueYear,"noarticles"),url.join("/")+"/"},VaultMagazines.prototype.getByDate=function(issueDate){var issueCacheKey,magazine,yearCacheKey;return magazine=this.findWhere({pubDate:issueDate}),null!=magazine?magazine:(yearCacheKey=this.yearUrlFromDate(issueDate),magazine=this.findWhereCachedByDate(yearCacheKey,{pubDate:issueDate}),null!=magazine?magazine:(issueCacheKey=this.url(["issue",issueDate]),magazine=this.findWhereCachedByDate(issueCacheKey,{pubDate:issueDate}),null!=magazine?magazine:null))
},VaultMagazines.prototype.silentFetch=function(url,success){var _ref;return null!=(_ref=this.XHR)&&"function"==typeof _ref.abort&&_ref.abort(),this.XHR=$.ajax({url:url,async:!0,success:function(_this){return function(result){var cachedModels;return cachedModels=_this.parse(result),_this.reset(cachedModels,{silent:!0}),success(result)}}(this),error:function(_this){return function(){return _this.vault.renderError(_this.vault.E_INVALID_DATE),!1}}(this)}),this.XHR},VaultMagazines.prototype.findWhereCachedByDate=function(cacheKey,attributes){var cachedModels,magazine,originalModels;return cacheKey in this.cache?(originalModels=this.models,cachedModels=this.cache[cacheKey],this.reset(cachedModels,{silent:!0}),magazine=this.findWhere(attributes),null!=magazine?(this.lastRequest=cacheKey,magazine):(this.reset(originalModels,{silent:!0}),null)):null},VaultMagazines}(Backbone.Collection),Time.collections.Ticker=Backbone.Collection.extend({model:Time.models.TickerHeadline,load_headlines:function(){return null!=Time.bootstrap.ticker?(this.add(Time.bootstrap.ticker),this.trigger("reset")):this.fetch({reset:!0})},url:function(){return"money"===Time.branding?Time.api_url+"money_skybox/":Time.api_url+"skybox/"},get_$items:function(){var $items;return $items=[],_.each(this.models,function(this_model){return $items.push(this_model.view.$el)}),$items}}),_.extend(Time.collections.Ticker.prototype,Backbone.Events);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.GallerySlideLightbox=function(_super){function GallerySlideLightbox(){return GallerySlideLightbox.__super__.constructor.apply(this,arguments)}return __extends(GallerySlideLightbox,_super),GallerySlideLightbox.prototype.events={"click [data-gallery-link]":"clickedTile"},GallerySlideLightbox.prototype.initialize=function(){var _ref,_ref1;return null==this.model?null:(this.gallery=null!=(_ref=this.model)&&null!=(_ref1=_ref.collection)?_ref1.gallery:void 0,this)},GallerySlideLightbox.prototype.clickedTile=function(e){var $galleryThumbnail,galleryId;return e.stopPropagation(),null!=this.gallery&&this.gallery.get("isSwappable")?(e.preventDefault(),$galleryThumbnail=$(e.currentTarget),galleryId=$galleryThumbnail.data("gallery-link"),this.swapGallery(galleryId)):void 0},GallerySlideLightbox.prototype.swapGallery=function(galleryId){var _ref,_ref1;if(null!=galleryId)return Time.initial_gallery_slug=!1,null!=(_ref=this.gallery)&&null!=(_ref1=_ref.collection)&&_ref1.trigger("gallery:replace",this.gallery.id,galleryId),this},GallerySlideLightbox}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.GallerySlidesView=function(_super){function GallerySlidesView(){return GallerySlidesView.__super__.constructor.apply(this,arguments)}return __extends(GallerySlidesView,_super),GallerySlidesView.prototype.initialize=function(options){return null==options&&(options={}),console.info("GallerySlidesView init ",options),this.galleryView=options.gallery,this.listenTo(this,"view:destroy",function(){var _ref;console.info("GallerySlidesView heard view:destroy, destroying",this),null!=(_ref=this.collection)&&_ref.invoke("set",{isRendered:!1,isActive:!1}),this.collection=null,this.galleryView=null}),this},GallerySlidesView}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.Gallery=function(_super){function Gallery(){return Gallery.__super__.constructor.apply(this,arguments)}return __extends(Gallery,_super),Gallery.prototype.initialize=function(options){var slidesData,startingIndex,startingSlide;return null==options&&(options={}),this.model=null||options.model,this.parent=null||options.parent,this.$parent=null||options.$parent,this.$slides=null,this.slidesView=null,slidesData=this.model.get("photos").slice(0),this.slidesCollection=new Time.collections.GallerySlides(slidesData,{gallery:this}),this.listenTo(this,"view:destroy",function(){var _ref;console.info("GalleryView (super) heard view:destroy, destroying @slidesView"),null!=(_ref=this.slidesView)&&"function"==typeof _ref.destroy&&_ref.destroy(),this.slidesView=null,this.slidesCollection=null,this.model=null}),Time.initial_gallery_slug&&(startingSlide=this.slidesCollection.findWhere({slug:Time.initial_gallery_slug}),startingSlide&&(startingIndex=this.slidesCollection.indexOf(startingSlide),this.model.set({slideIndex:startingIndex},{silent:!0})),Time.initial_gallery_slug=null),this},Gallery}(Backbone.View),Time.views.error404=Backbone.View.extend({initialize:function(options){return this.app=options.app,this.app.model.set("isInitialRoute",!1),this.rail_view=new Time.views.LeftRail,$(".scroll-for-more").hide(),Time.trigger("dfpAdManager:setInitialAppLoad",!1),this.app.load_tabs(Time.tab_data["default"]),this.app.tabs_view.set_active(0),this.listenToOnce(Time,"application:ready",function(){$(".site-footer").remove(),$("body").removeClass("error404")}),this}});var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};Time.views.Application=function(_super){function Application(){return this.destroyCollection=__bind(this.destroyCollection,this),this.onMainScroll=__bind(this.onMainScroll,this),Application.__super__.constructor.apply(this,arguments)}return __extends(Application,_super),Application.prototype.el=document,Application.prototype.events={"click a":"route","click a.popup":"open_popup","click #Sign_In":"clickedSignin","click .rail-tab":"load_tab","click .toggle-magazine-region-dropdown":"toggle_magazine_region_dropdown","click .magazine-region":"toggle_magazine_region_dropdown","click .ie-message-modal":"hide_ie8_message","click .article-list a":"hide_article_list","click .expand-share":"clickedExpandShare","click body":"clickedBody","click .collection-intro-video":"render_collection_video"},Application.prototype.baseUrl=location.protocol+"//"+location.host,Application.prototype.sizes={},Application.prototype.mobileSafari=/ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()),Application.prototype.isIphone=!1,Application.prototype.mobileSafariViewportOffset=0,Application.prototype.throttleSpeed=100,Application.prototype.hasPushstate=Modernizr.history&&-1===window.location.href.indexOf("nopushstate"),Application.prototype.orientationEvent=__indexOf.call(window,"onorientationchange")>=0?"orientationchange":"resize",Application.prototype.is_homepage=!1,Application.prototype.breakpoints={small:{name:"small",size:400,is_beneath:!1},medium:{name:"medium",size:800,is_beneath:!1},large:{name:"large",size:1024,is_beneath:!1},larger:{name:"larger",size:1206}},Application.prototype.initialize=function(){return this.isIphone=/iphone/i.test(navigator.userAgent.toLowerCase()),this.isIphone&&(this.mobileSafariOffset=60),this.setTabHref(),this.initModel(),this.liveFyre=new Time.views.LiveFyre({app:this}),this.brightcoveVideos=new Time.views.BrightcoveVideos({app:this}),this.readingPane=new Time.views.ReadingPane({el:".readingpane",app:this}),this.promoTray=new Time.views.PromoTray({app:this}),this.listenTo(Time,"env:init",this.destroyCollection),Time.trigger("application:initialized"),this},Application.prototype.initModel=function(){return this.model=new Time.models.Application,this.listenTo(this.model,"change:activeArticle",function(_this){return function(model,value){(null!=value&&"function"==typeof value.get?value.get("isActive"):void 0)&&_this.$window.trigger("time-article-active")}}(this)),this},Application.prototype.initAds=function(){return this.sponsor_index=0,this.sponsor_arr=Time.bootstrap.sponsors?Time.bootstrap.sponsors:null,this.sponsor_length=this.sponsor_arr?this.sponsor_arr.length:0,Time.taboola_counter=0,this.listenTo(Time,"article:activated",function(){return Time.taboola.renderModules()}),this.chartbeatAdapter=new Time.modules.ChartbeatAdapter({app:this}),this.omnitureAdapter=new Time.modules.OmnitureAdapter({app:this}),this.comscoreAdapter=new Time.modules.ComscoreAdapter({app:this}),Time.Ad=window.TimeAdFactory,this.adMediator=new Time.modules.AdMediator({app:this}),this.adMediator.addPeers({omniture:this.omnitureAdapter}),this.adMediator.addPeers({comscore:this.comscoreAdapter}),this.tgxFactory=new Time.models.DfpAdManager({},{app:this}),this.tgxAdapter=Time.tgxAdapter=new Time.modules.TgxAdapter({app:this,model:this.tgxFactory}),this.adMediator.addPeers({tgx:this.tgxAdapter}),this.nativoAdapter=new Time.modules.NativoAdapter({app:this,model:this.tgxFactory}),this.adMediator.addPeers({nativo:this.nativoAdapter}),this.adMediator.initialize(),this},Application.prototype.getPageType=function(){var pageType;return this.isTopicPage()?"topic":(pageType=null!=this.active_route?this.active_route:void 0,"rail"===pageType&&(pageType="article"),pageType)},Application.prototype.isTopicPage=function(){var $topic,_ref;return(null!=(_ref=this.$leftRailHeader)?_ref.length:void 0)?($topic=this.$leftRailHeader.find("#topic"),$topic.length&&$topic.hasClass("active")):!1},Application.prototype.getActiveGallery=function(){var activeArticle,activeArticleView,activeGalleryModel,galleriesCollection,topBannerHeight,windowTop,_ref;return this.model.get("activeArticle")?(activeArticle=this.model.get("activeArticle"),activeArticleView=null!=activeArticle&&null!=(_ref=activeArticle.views)?_ref.singleView:void 0,null==activeArticleView?null:(galleriesCollection=activeArticleView.galleriesCollection,(null!=galleriesCollection?galleriesCollection.size():void 0)?(windowTop=this.$window.scrollTop(),topBannerHeight=this.$top_banner.height(),activeGalleryModel=galleriesCollection.find(function(gallery){var galleryTop,_ref1;return(null!=(_ref1=gallery.view)?_ref1.$el:void 0)?gallery.get("isFullscreen")?!0:(galleryTop=gallery.view.$el.position().top,galleryTop>=windowTop+topBannerHeight?!0:void 0):!1}),null!=activeGalleryModel?(this.model.set("activeGallery",activeGalleryModel),activeGalleryModel):null):null)):null},Application.prototype.render=function(){var isPrintMode;return this.$window=$(window),this.title=$("title").text(),this.$body=$("body"),this.$main_header=$(".main-header"),this.$notHeader=$("#notTheHeader"),this.$notHeaderWrapper=$("#notTheHeader>.wrapper"),this.$viewport=$(".article-viewport"),this.$viewportWrapper=$(".article-viewport > .wrapper"),this.$leftRailWrapper=$(".leftRailWrapper"),this.$articleListScroll=$(".rail-articles-scroll"),this.$top_banner=$(".top-banner"),this.$pushdowns=$(".pushdowns"),this.$pushDown=$("#pushdown-ad"),this.$magazineCover=$(".magazine-cover:first"),this.$admin_bar=$("#wpadminbar"),this.$window.width()<this.$window.height()?this.model.set("orientation","portrait"):this.model.set("orientation","landscape"),this.model.set("pageType",this.getPageType()),this.readingPane.render(),isPrintMode=!$(".print-mode").is(":hidden"),this.model.set("isPrintMode",isPrintMode),$("html").addClass(Time.device).toggleClass("print",isPrintMode),this.hasPushstate||this.set_branding(),Modernizr.svg||this.svgFallback(),isPrintMode||(this.initAds(),this.initRail(),this.bindWindowEvents(),this.$notHeader.on("touchmove scroll",this.onMainScroll),this.setIsPastPushdowns(),this.bindArticleEvents(),this.handle_resize(!0),this.resizeContent(),Modernizr.touch&&this.touchUnfocus(),this.autoshow_ie8_modal(),Time.components.main_modal=new Time.component.Modal("#Sign_In_Modal",{buttonSelector:'.sign-sub-wrap a[href="#signin"], .subscribe a[href="#signin"], .login-nav-wrapper .sign-in'}),this.checkLogin()),Time.trigger("application:rendered"),this.$body.removeClass("hidden"),this},Application.prototype.set_branding=function(){this.$body.addClass(Time.branding+"-branding")},Application.prototype.setTabHref=function(){var i,l,tabs,_results;if("time"!==Time.branding){for(tabs=Time.tab_data["default"].tabs,l=tabs.length,i=0,_results=[];l>i;)tabs[i].href="/"+Time.branding+tabs[i].href,_results.push(i+=1);return _results}},Application.prototype.bindWindowEvents=function(){return this.$window.on("resize",function(_this){return function(){_this.resizeContent(),_this.handle_resize(),"mobile"===Time.device&&Time.util.is_native_android_browser()&&setTimeout(function(){return this.$main_header.css("width",this.$window.outerWidth())},200),Time.trigger("application:resize")}}(this)),this.$window.on("orientationchange",function(_this){return function(){window.innerWidth>window.innerHeight&&_this.$body.scrollTo(0,0),_this.resizeContent(),_this.handle_resize(),Time.trigger("application:resize"),Time.trigger("application:orientationchange")}}(this)),this},Application.prototype.bindPushdownExpansion=function(){var observerConfig,pushdownInterval,target;"mobile"!==Time.device&&this.$pushDown.length&&(target=this.$pushDown.get(0),this.pushdownObserver=new MutationObserver(function(_this){return function(){_this.setIsPastPushdowns(),Time.trigger("pushdown:modified")}}(this)),observerConfig={attributes:!0},this.pushdownObserver.observe(target,observerConfig),this.listenTo(this.model,"change:pushdownHeight",function(_this){return function(){return _this.reposition()}}(this)),pushdownInterval=window.setInterval(function(_this){return function(){return _this.checkPushdownExpansion()}}(this),300))},Application.prototype.checkPushdownExpansion=function(){return this.model.get("isPastPushdowns")?this:(this.model.set("pushdownHeight",this.$pushdowns.height()),this)},Application.prototype.reposition=function(){var pushdownBottom,_ref;this.model.get("isPastPushdowns")||(pushdownBottom=this.$pushdowns.offset().top+this.$pushdowns.height(),null!=(_ref=this.$leftRailHeader)&&_ref.css("top",pushdownBottom)),Tether.position()},Application.prototype.bindArticleEvents=function(){return this.listenToOnce(Time,"article:activated",function(_this){return function(){_this.bindKeyboardEvents()}}(this)),this.listenTo(Time,"article:activated",function(_this){return function(articleView){_this.setTitle(articleView.model.getBrandedTitle())}}(this)),this.listenTo(Time,"gallery:isFullscreen",function(_this){return function(galleryView,isFullscreen){var _ref;_this.model.set("isFullscreen",isFullscreen),$("html").toggleClass("fullscreenmode",isFullscreen),isFullscreen||(null!=galleryView&&null!=(_ref=galleryView.parent)?_ref.$el:void 0)&&_this.$notHeader.scrollTo(galleryView.parent.$el),Tether.position()}}(this)),this},Application.prototype.setIsPastPushdowns=function(force){var contentPaneTop,isPastPushdowns,pushdownsRect,_base;return null!=force?(this.model.set("isPastPushdowns",force),force):(this.$pushdowns.length?(pushdownsRect="function"==typeof(_base=this.$pushdowns).get?_base.get(0).getBoundingClientRect():void 0,contentPaneTop=this.$notHeader.offset().top,isPastPushdowns=pushdownsRect.bottom<=contentPaneTop):isPastPushdowns=!0,this.model.set("isPastPushdowns",isPastPushdowns),isPastPushdowns)},Application.prototype.bindKeyboardEvents=function(){return this.$body.on("keydown.gallery-arrows",function(_this){return function(e){var galleryModel,_ref;return(galleryModel=_this.getActiveGallery()||null)?(null!=(_ref=galleryModel.view)&&_ref.trigger("gallery:keyboardEvent",e),e):e}}(this)),this},Application.prototype.checkLogin=function(){var logoutUrl,signOutDiv,_ref;return document.location.search.replace(/\??(?:([^=]+)=([^&]*)&?)/g,function(){var decode,urlPath;return decode=function(s){return decodeURIComponent(s.split("+").join(" "))},Time.$_GET[decode(arguments[1])]=decode(arguments[2]),Time.$_GET.loginfailure?(urlPath=document.URL.split("?")[0],this.hasPushstate&&window.history.pushState({html:"",pageTitle:""},"",urlPath),$("#Sign_In_Modal_Error").removeClass("hidden"),Time.components.main_modal.show()):void 0}),null!=$.cookie&&null!=$.cookie("TimeIAT")&&null!=(null!=(_ref=Time.bootstrap)?_ref.auth_url:void 0)?(logoutUrl=Time.bootstrap.auth_url+"logout.php",signOutDiv='<a href="'+logoutUrl+"?turl="+window.location+'/">Sign Out</a>',$("span.signedin-wrap").prepend(signOutDiv)):void 0},Application.prototype.resizeContent=function(){var bH,_ref;return bH=Math.ceil(this.$body.height()),this.$subheaderWrapper=this.$body.find(".subheaderWrapper"),this.sizes={},this.sizes.headerHeight=this.$main_header.outerHeight(!0),this.sizes.subHeaderHeight=this.$subheaderWrapper.length?this.$subheaderWrapper.outerHeight(!1):0,this.sizes.headerTop=this.$main_header.offset().top,this.sizes.headerBottom=this.sizes.headerTop+this.sizes.headerHeight,this.sizes.contentHeight=bH-this.sizes.headerBottom-this.sizes.subHeaderHeight,this.$notHeader.css({height:this.sizes.contentHeight+"px"}),this.$leftRailWrapper.length&&(this.sizes.railHeight=this.sizes.contentHeight,this.$leftRailWrapper.css({height:this.sizes.railHeight+"px"})),(null!=(_ref=this.$leftRailHeader)?_ref.length:void 0)&&(this.left_rail_top=this.$leftRailHeader.height()+this.$top_banner.height(),this.left_rail_bottom=bH,this.left_rail_height=this.left_rail_bottom-this.left_rail_top),this.reposition(),this.sizes},Application.prototype.load_ticker=function(){return null==this.ticker||"mobile"===Time.device?this.ticker=new Time.views.TickerModule:this.ticker.render()},Application.prototype.clickedSignin=function(e){var trimmedURL;return e.preventDefault(),trimmedURL=document.URL.split("?"),trimmedURL=trimmedURL[0],$("#rurl").val(trimmedURL+"?loginfailure=true"),$("#turl").val(trimmedURL),$("#sign-in-form").submit()},Application.prototype.clickedExpandShare=function(e){return e.preventDefault(),this.toggle_share_tooltip(e),!0},Application.prototype.clickedBody=function(e){return this.trigger("body:clicked"),$(e.target).hasClass("expand-share")||this.toggle_share_tooltip("close"),this},Application.prototype.touchUnfocus=function(){return this.$body.on("blur","input, textarea",function(){setTimeout(function(){var d,h;return d=$(document),h=d.scrollTop(),d.scrollTop(h+1)},750)})},Application.prototype.setArticleVisibilityAndCheckScroll=function(articleView){var $el,articleAbove,articleBelow,articleModel,article_position,id;$el=articleView.$el,articleModel=articleView.model,id=articleModel.get("id"),articleAbove=this.readingPane.getArticleAbove(articleView),articleBelow=this.readingPane.getArticleBelow(articleView),article_position=this.article_position($el),"above"===article_position||"below"===article_position?articleModel.get("isVisible")&&(this.hide_images($el),$el.addClass("offScreen"),Time.trigger("article:offscreen",articleView),this.$window.trigger("offscreen",articleView),articleModel.set("isVisible",!1),"above"===article_position&&(null!=articleAbove&&articleAbove.model.set("check_scroll",!1),null!=articleBelow&&articleBelow.model.set("check_scroll",!0)),"below"===article_position&&(null!=articleAbove&&articleAbove.model.set("check_scroll",!0),null!=articleBelow&&articleBelow.model.set("check_scroll",!1))):articleModel.get("isVisible")||(this.show_images($el),$el.removeClass("offScreen"),Time.trigger("article:onscreen",articleView),this.$window.trigger("onscreen",articleView),articleModel.set("isVisible",!0),null!=articleAbove&&articleAbove.model.set("check_scroll",!0),null!=articleBelow&&articleBelow.model.set("check_scroll",!0))},Application.prototype.article_position=function($el,thresh){var bH,position,rect,threshhold;return position="in",bH=this.$body.height(),threshhold=thresh||1,rect=$el.get(0).getBoundingClientRect(),rect.bottom<=-(bH*threshhold)&&(position="above"),rect.top>bH+bH*threshhold&&(position="below"),position},Application.prototype.svgFallback=function(){return $('img[src$=".svg"]').each(function(i,el){var $el,fallback,src;return $el=$(el),fallback=$el.attr("data-fallback"),src=$el.attr("src"),$el.attr("src",fallback||src.replace(".svg",".png"))})},Application.prototype.hide_images=function($el){var images;return images=$el.find("img"),images.each(function(){var $this;return $this=$(this),$this.css({height:$this.height()}).attr({"old-src":$this.attr("src"),src:""})})},Application.prototype.show_images=function($el){var images;return images=$el.find("img"),images.each(function(){var $this;return $this=$(this),$this.css({height:""}).attr({src:$this.attr("old-src")})})},Application.prototype.destroy_article=function($el){var height,model;model=this.active_rail.get($el.data("article")),height=$el.height(),model.destroy(),$el.remove(),this.$viewportWrapper.scrollTop(this.$viewportWrapper.get(0).scrollTop-height)},Application.prototype.toggle_share_tooltip=function(e){var $targ,is_showing;return"close"===e?void $(".expand-share").removeClass("expanded"):($targ=$(e.target),is_showing=$targ.hasClass("expanded"),$(".expand-share").removeClass("expanded"),is_showing||$targ.addClass("expanded"),void 0)},Application.prototype.isRailVisible=function(){var _ref;return(null!=(_ref=this.$left_rail)?_ref.length:void 0)?"none"===this.$left_rail.css("display")?!1:this.$left_rail.offset().left>=0?!1:!0:!1},Application.prototype.setIsRailToggleable=function(){var hasRailHandle;return hasRailHandle="block"===$(".rail-handle").css("display"),this.model.set("isRailToggleable",hasRailHandle),hasRailHandle},Application.prototype.moveRailToBody=function(){var _ref,_ref1;this.$leftRailWrapper.detach().appendTo("body"),null!=(_ref=this.active_rail)&&null!=(_ref1=_ref.view)&&_ref1.setElement(".article-list")},Application.prototype.moveRailToContent=function(){var _ref,_ref1;this.$leftRailWrapper.detach().insertAfter(".pushdowns"),null!=(_ref=this.active_rail)&&null!=(_ref1=_ref.view)&&_ref1.setElement(".article-list")},Application.prototype.initRail=function(){var isTabletPortrait;this.$left_rail=$(".left-rail"),this.$leftRailHeader=$(".left-rail-topper"),this.$leftRailWrapper.length&&(this.$body.hasClass("masonary")||(this.$body.addClass("has-left-rail"),this.bindRailEvents(),this.listenTo(this.model,"change:isRailOpen",function(_this){return function(model,value){value?_this.openLeftRail():_this.closeLeftRail()}}(this)),this.listenTo(this.model,"change:isPastPushdowns",function(_this){return function(model,value){value?(_this.$body.addClass("pushdowns-not-visible").removeClass("pushdowns-visible"),_this.moveRailToBody()):(_this.$body.addClass("pushdowns-visible").removeClass("pushdowns-not-visible"),_this.moveRailToContent()),_.delay(function(){return _this.resizeContent()},200)}}(this)),this.listenTo(this.model,"change:isRailToggleable",function(_this){return function(model,value){$("body").toggleClass("left-rail-toggleable",value),value===!0?_this.model.set("isRailOpen",_this.model.get("isRailUserOpen")):_this.model.set("isRailOpen",!0)}}(this)),this.bindPushdownExpansion(),isTabletPortrait="tablet"===Time.device&&"portrait"===this.model.get("orientation"),this.model.set("isRailUserOpen","mobile"!==Time.device&&!isTabletPortrait)))},Application.prototype.userToggleLeftRail=function(){var newOpenValue;return newOpenValue=!this.model.get("isRailOpen"),this.model.set("isRailUserOpen",newOpenValue),this.model.set("isRailOpen",newOpenValue),!1},Application.prototype.openLeftRail=function(){var isEntireRailVisible;return this.$body.addClass("left-rail-open").removeClass("left-rail-closed"),isEntireRailVisible=this.$articleListScroll[0].scrollHeight===this.$articleListScroll.innerHeight(),isEntireRailVisible||$(".scroll-for-more").appendTo("body").show(),setTimeout(function(){return Time.trigger("leftRail:opened")},300),this},Application.prototype.closeLeftRail=function(){return this.$body.addClass("left-rail-closed").removeClass("left-rail-open"),Time.trigger("leftRail:closing"),$(".scroll-for-more").hide(),setTimeout(function(){return Time.trigger("leftRail:closed")},300),this},Application.prototype.bindRailEvents=function(){this.$body.on("click",".article-permalink",function(_this){return function(){_this.model.get("isRailToggleable")&&_this.model.set("isRailOpen",!1)}}(this)),$(".rail-handle").on("touchend click",function(_this){return function(e){e.preventDefault(),e.stopPropagation(),_this.userToggleLeftRail()}}(this)),this.listenTo(Time,"leftRail:collapsible:expanded",function(collapsibleView){var $tetherTargets,_ref,_ref1;$tetherTargets=collapsibleView.$(".tether-target"),null!=$tetherTargets&&$tetherTargets.each(function(index,el){var $target,$tetheredElement,tether;return $target=$(el),tether=$target.data("tether"),null!=tether?($tetheredElement=$(tether.element),$tetheredElement.removeClass("leftRailModule--collapsible__collapsedAd").data("collapsed",!1),tether.enable()):void 0}),null!=collapsibleView&&null!=(_ref=collapsibleView.collection)&&null!=(_ref1=_ref.view)&&_ref1.$el.trigger("scroll"),Tether.position()}),this.listenTo(Time,"leftRail:collapsible:collapsed",function(_this){return function(collapsibleView){var $tetherTargets,_ref,_ref1;$tetherTargets=collapsibleView.$(".tether-target"),null!=$tetherTargets&&$tetherTargets.each(function(index,el){var $target,$tetheredElement,tether;return $target=$(el),tether=$target.data("tether"),null!=tether?(tether.disable(),$tetheredElement=$(tether.element),$tetheredElement.addClass("leftRailModule--collapsible__collapsedAd").data("collapsed",!0)):void 0}),Tether.position(),null!=(_ref=_this.active_rail)&&null!=(_ref1=_ref.view)&&_ref1.fill_viewport()}}(this)),this.listenTo(Time,"leftRail:opened",function(){var $tetherTargets,_ref,_ref1;$tetherTargets=null!=(_ref=this.active_rail)&&null!=(_ref1=_ref.view)?_ref1.$(".tether-target"):void 0,null!=$tetherTargets&&$tetherTargets.each(function(index,el){var $target,$tetheredElement,tether;return $target=$(el),$target.data("collapsed")||(tether=$target.data("tether"),null==tether)?void 0:($tetheredElement=$(tether.element),$tetheredElement.show(),tether.enable())}),Tether.position()}),this.listenTo(Time,"leftRail:closing",function(_this){return function(){var $tetherTargets,_ref,_ref1;$tetherTargets=null!=(_ref=_this.active_rail)&&null!=(_ref1=_ref.view)?_ref1.$(".tether-target"):void 0,null!=$tetherTargets&&$tetherTargets.each(function(index,el){var $target,$tetheredElement,tether;return $target=$(el),tether=$target.data("tether"),null!=tether?(tether.disable(),$tetheredElement=$(tether.element),$tetheredElement.hide()):void 0})}}(this)),this.listenTo(Time,"leftRail:closed",function(){Tether.position()})},Application.prototype.load_tabs=function(tabs,el_selector){return null==tabs&&(tabs=Time.tab_data["default"]),null==el_selector&&(el_selector=!1),null!=this.tabs_view&&this.remove_tabs(),this.tabs_view=new Time.views.Tabs(tabs,el_selector),this.last_tabs=tabs,this.init_search()},Application.prototype.remove_tabs=function(){var _ref;return null!=(_ref=this.tabs_view)&&_ref.destroy(),this.tabs_view=null,$(".rail-tabs").empty(),this},Application.prototype.onMainScroll=function(e){var foundActiveArticle;this.model.get("isFullscreen")||(this.setIsPastPushdowns(),foundActiveArticle=!1,_.each(this.readingPane.articleViews,function(_this){return function(articleView){articleView&&(articleView.model.get("check_scroll")&&_this.setArticleVisibilityAndCheckScroll(articleView),foundActiveArticle||(foundActiveArticle=_this.readingPane.setActiveArticle(articleView)))}}(this)),this.reposition(),Time.trigger("readingPane:scrolled",e))},Application.prototype.reset_scroll=function(scrolltop){return null==scrolltop&&(scrolltop=1),null!=this.infinite_scroll&&this.infinite_scroll.pause(),_.defer(function(_this){return function(){return _this.$notHeader.scrollTop(scrolltop),window.setTimeout(function(){var _ref;return null!=(_ref=_this.infinite_scroll)?_ref.resume():void 0},500),Time.trigger("application:ready"),_this.$body.removeClass("hidden"),$(".wpcom-protected-iframe").length&&(window.TIMEContentLoaded=document.createEvent("Event"),window.TIMEContentLoaded.initEvent("DOMContentLoaded",!0,!0),window.document.dispatchEvent(TIMEContentLoaded)),_this.resizeContent()}}(this)),this},Application.prototype.open_popup=function(e){var clicked_el,height,href,options,width;return e.preventDefault(),clicked_el=e.currentTarget,href=$(clicked_el).data("href")||$(clicked_el).attr("href"),width=550,height=420,options="scrollbars=yes,resizable=yes,toolbar=no,location=yes,width="+width+",height="+height,window.open(href,"Share",options),!1},Application.prototype.isHardLink=function($el){return this.$body.hasClass("home")?!0:this.$body.hasClass("page-template-pagespage-special-story-php")?!0:this.$body.hasClass("masonry")?!0:this.$body.hasClass("error404")?!0:this.$body.hasClass("nativo-template")?!0:$el.is("[data-bypass]")?!0:"collection"===$el.attr("id")?!0:!1},Application.prototype.route=function(e){var $clicked_el,href,isLatestTab,sanitized_url,should_trigger,_ref;if(null!=(_ref=this.infinite_scroll)&&_ref.reset(),href=e.currentTarget.href,$clicked_el=$(e.currentTarget),isLatestTab="nav-latest"===$clicked_el.data("event"),href&&this.isInternalLink(href)){if(e.preventDefault(),this.isHrefToArticle(href)&&!this.isHardLink($(e.currentTarget))&&!isLatestTab)return sanitized_url=this.stripBaseUrl(href),should_trigger=!$clicked_el.is("[data-silent]"),void this.router.navigate(sanitized_url,should_trigger);href&&(window.location.href=href)}},Application.prototype.isLinkToDifferentBrand=function(path){var isMoneyLink;return isMoneyLink=this.isMoney(path),"time"===Time.branding&&isMoneyLink?!0:"money"!==Time.branding||isMoneyLink?!1:!0},Application.prototype.isHrefToArticle=function(url){var baseRegex,isCurrentlyInSection,isInSection,isInSite,isMoneySpecial,moneyPageRegex,sanitizedUrl,sectionRegex;return sanitizedUrl=this.stripBaseUrl(url),this.isLinkToDifferentBrand(sanitizedUrl)?!1:(baseRegex=/^\/($|(author\/)|(magazine)|(money\/)|(collection\/)|(topic\/)|(([0-9]+)\/)|(tag\/)|(content\-from\/)|(right-now\/)|(popular\/)|(videos\/))/,isInSite=baseRegex.test(sanitizedUrl),moneyPageRegex=/^\/money\/page\//,isMoneySpecial=moneyPageRegex.test(sanitizedUrl),isInSite&&!isMoneySpecial?!0:(sectionRegex=/^\/(business|culture|living|entertainment|health|ideas|lightbox|life|newsfeed|opinion|politics|science|sports|style|tech|us|world)\/?$/,isInSection=sectionRegex.test(sanitizedUrl),isCurrentlyInSection=sanitizedUrl.indexOf(Time.curRoute.sub)>-1,isInSection&&isCurrentlyInSection?!0:!1))},Application.prototype.isInternalLink=function(url){return"#"===url.charAt(0)||"#"===url.charAt(url.length-1)?!1:/^mailto:/.test(url)?!1:/^javascript:/.test(url)?!1:-1===url.indexOf("//")?!0:url.substr(0,this.baseUrl.length)===this.baseUrl},Application.prototype.stripBaseUrl=function(url){var sanitizedUrl;return null==url&&(url=""),/^\/[^/]/.test(url)&&(sanitizedUrl=url.substr(1,url.length)),-1!==url.indexOf(this.baseUrl)&&(sanitizedUrl=url.substr(this.baseUrl.length,url.length)),sanitizedUrl},Application.prototype.isMoney=function(path){var REGEX_IS_MONEY;return null==path&&(path=""),REGEX_IS_MONEY=/^\/?money/,path||(path=this.stripBaseUrl(window.location.href)),REGEX_IS_MONEY.test(path)},Application.prototype.html_decode=function(str){var a_el;return a_el=document.createElement("a"),a_el.innerHTML=str,a_el.textContent},Application.prototype.setTitle=function(title){return this.title=this.html_decode(title),document.title=this.title,this.title},Application.prototype.handle_resize=function(init){var this_breakpoint,wW;brightcove.createExperiences(),wW=this.$window.width();
for(this_breakpoint in this.breakpoints)(!this.breakpoints[this_breakpoint].is_beneath||init)&&wW<=this.breakpoints[this_breakpoint].size&&(this.renderMobileNavigation(),this.breakpoints[this_breakpoint].is_beneath=!0),(this.breakpoints[this_breakpoint].is_beneath||init)&&wW>this.breakpoints[this_breakpoint].size&&(this.renderMobileNavigation(),this.breakpoints[this_breakpoint].is_beneath=!1);this.setIsRailToggleable(),this.setIsPastPushdowns(),this.model.get("isRailOpen")||$(".scroll-for-more").hide()},Application.prototype.renderMobileNavigation=function(){return null!=this.$nav_component&&null!=this.$nav_component.data("Navigation")&&(this.$nav_component.data("Navigation").destroy(),this.$nav_component=null),this.$nav_component=Time.component.make("MobileNavigation",".header-nav-button",{menuSelector:".left-rail-header .main-nav",handleClickOutside:!1}),this},Application.prototype.render_section_header=function(data){var html;return html=Time.templates["top-header"].render(data),this.$top_banner.html(html),this.active_rail.load_tabs(this.active_rail.sub,".rail-tabs"),this},Application.prototype.render_top_banner=function(data){var html;return html=Time.templates["top-header"].render(data),this.$top_banner.html(html),this},Application.prototype.twitter_share_url=function(url,text,via){var intent;return intent="https://twitter.com/intent/tweet?",null!=url&&(intent+="&url="+url),null!=text&&(intent+="&text="+text),null!=via&&(intent+="&via="+via),intent},Application.prototype.show_loader=function($container){return $container.addClass("loading-overlay"),$container},Application.prototype.hide_loader=function($container){return $container.removeClass("loading-overlay loading-error"),$container},Application.prototype.show_loader_error=function($container,message,duration){var loader_timeout;return null==message&&(message="Sorry, the requested content could not be loaded"),null==duration&&(duration=3e3),$container.attr("data-error",message),$container.addClass("loading-error"),duration&&(loader_timeout=window.setTimeout(function(_this){return function(){return _this.hide_loader($container)}}(this),duration)),$container},Application.prototype.init_search=function(){return this.$search_component&&(this.$search_component=null,delete this.$search_component),this.$search_component=Time.component.make("RailSearch",".main-nav-search-icon",{})},Application.prototype.destroyCollection=function(){var _ref,_ref1;return clearInterval(Time.homepage_refresh),clearInterval(Time.marketdata_refresh),null!=(_ref=this.railXHR)&&"function"==typeof _ref.abort&&_ref.abort(),this.railXHR=null,this.$body.removeClass("has-section-menu tax-time_section home money-home"),null!=(_ref1=this.infinite_scroll)&&_ref1.unbind(),this.infinite_scroll=null,null!=this.active_rail&&(this.active_rail.view.annihilate(),this.active_rail.reset(),this.active_rail=null),this},Application.prototype.sanitizeRailParams=function(params){var sanitizedParams,_ref,_ref1;return sanitizedParams=$.extend(!0,{},params),sanitizedParams.env=(null!=(_ref=sanitizedParams.env)?_ref.toLowerCase():void 0)||"rail",sanitizedParams.sub=(null!=(_ref1=sanitizedParams.sub)?_ref1.toLowerCase():void 0)||null,sanitizedParams.section_tag=sanitizedParams.section_tag||null,sanitizedParams},Application.prototype.getArticleCollectionClass=function(env){var collectionClassName,collectionType;return null==env&&(env=""),collectionType=env.charAt(0).toUpperCase()+env.slice(1),"Money_magazine"===collectionType&&(collectionType="MoneyMagazine"),"Videos"===collectionType&&(collectionType="Video"),"Rail"===collectionType&&(collectionType=""),collectionClassName=collectionType+"Articles",null==Time.collections[collectionClassName]&&(console.error("Invalid env / collection type",env,collectionType),collectionClassName="Articles"),Time.collections[collectionClassName]},Application.prototype.getArticleCollection=function(params){var articles,collectionClass,old_env,railParams;return console.log("--- getArticleCollection ---",arguments),Time.trigger("env:init",params),railParams=this.sanitizeRailParams(params),old_env=this.$body.data("env"),this.$body.removeClass(old_env+"-template"),this.$body.data("env",railParams.env).addClass(railParams.env+"-template"),Time.curRoute=params,railParams.sub&&(this.active_template=railParams.sub),railParams.env&&(this.active_route=railParams.env),articles=[],collectionClass=this.getArticleCollectionClass(railParams.env),this.active_rail=new collectionClass([],{app:this,sub:railParams.sub,section_tag:railParams.section_tag}),this.listenToOnce(this.active_rail,"add",function(_this){return function(){return _this.infinite_scroll=new Time.component.InfiniteScroll({parentEl:_this.$notHeader,contentEl:_this.$viewport,threshold:10,onDown:_this.active_rail.show_next_article,onUp:_this.active_rail.show_previous_article,context:_this.active_rail}),_.defer(function(){var item_slug;return null!=railParams.article_id?(item_slug=null!=railParams.item_slug?railParams.item_slug:null,_this.active_rail.load_single_article(railParams.article_id,item_slug)):null!=railParams.sync_article_id?_this.active_rail.synchronize(railParams.sync_article_id,params.item_slug):_this.active_rail.synchronize()})}}(this)),railParams.article?this.active_rail.load_articles(railParams.article):this.active_rail.load_articles(),"section"===Time.curRoute.env&&(Time.components.contributor_modal=new Time.component.Modal("#contributor-modal",{buttonSelector:".contributor-signup"})),null!=railParams.open_rail&&this.model.set("isRailOpen",!0),this.active_rail},Application.prototype.cleanArticleId=function(articleId){return/^[^s]/.test(articleId)&&(articleId=parseInt(articleId,10)),articleId},Application.prototype.load_article=function(articleId,item_slug){var articleModel,currentActiveArticle,_ref,_ref1;return console.log("--- load_article ---",arguments),(articleId=this.cleanArticleId(articleId))?(currentActiveArticle=this.model.get("activeArticle"),null!=currentActiveArticle&&currentActiveArticle.set("isActive",!1),this.active_template="article",this.active_route="article",(null!=(_ref=this.active_rail)?_ref.get(articleId):void 0)?(this.active_rail.synchronize(articleId),this):(articleModel=new Time.models.Article({id:articleId}),this.listenToOnce(articleModel,"change",function(_this){return function(){return articleModel.get("hub_id")&&null!=_this.active_rail&&"collection"!==_this.active_rail.active_env?void(window.location=window.location.href):void _this.loadArticleRail(articleModel,articleId,item_slug)}}(this)),articleId===(null!=(_ref1=Time.bootstrap.single_article)?_ref1.id:void 0)?articleModel.set(Time.bootstrap.single_article):articleModel.fetch(),this)):("undefined"!=typeof console&&null!==console&&console.error("-- load_article -- Invalid article ID",articleId),!1)},Application.prototype.loadArticleRail=function(articleModel,articleId,itemSlug){var topic;return console.log("--- loadArticleRail ---",arguments),null!=articleModel.get("topic")?(topic=articleModel.get("topic").slug,this.getArticleCollection({env:"topic",sub:topic,article:articleModel,article_id:articleId,item_slug:itemSlug}),this):(this.getArticleCollection({article:articleModel,article_id:articleId,item_slug:itemSlug}),this)},Application.prototype.toggle_magazine_region_dropdown=function(){return $(".magazine-region-header").toggleClass("open")},Application.prototype.placeholderPolyfill=function(formSelector,fieldSelector){var field,form,placeholder;return form=$(formSelector),field=$(fieldSelector),placeholder=field.attr("placeholder"),""===field.val()&&(field.val(placeholder),field.addClass("empty")),field.focus(function(){return this.value===placeholder?(field.val(""),field.removeClass("empty")):void 0}),field.blur(function(){return""===this.value?(field.val(placeholder),field.addClass("empty")):void 0}),form.submit(function(){return field.val()===placeholder||/\s+/.test(field.val())?!1:void 0})},Application.prototype.localStoragePolyfill=function(){return window.localStorage={getItem:function(sKey){return sKey&&this.hasOwnProperty(sKey)?unescape(document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+escape(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1")):null},key:function(nKeyId){return unescape(document.cookie.replace(/\s*\=(?:.(?!;))*$/,"").split(/\s*\=(?:[^;](?!;))*[^;]?;\s*/)[nKeyId])},setItem:function(sKey,sValue){return sKey?(document.cookie=escape(sKey)+"="+escape(sValue)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/",this.length=document.cookie.match(/\=/g).length):void 0},length:0,removeItem:function(sKey){return sKey&&this.hasOwnProperty(sKey)?(document.cookie=escape(sKey)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",this.length--):void 0},hasOwnProperty:function(sKey){return new RegExp("(?:^|;\\s*)"+escape(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)}}},Application.prototype.autoshow_ie8_modal=function(){var saved_day,this_day_of_year;return $(".lt-ie9").length?(window.localStorage||this.localStoragePolyfill(),window.localStorage.length=(document.cookie.match(/\=/g)||window.localStorage).length,this_day_of_year=Time.util.getDayOfYear(),saved_day=localStorage.getItem("last_day"),null!=saved_day&&parseInt(saved_day)===parseInt(this_day_of_year)?!1:($(".ie-message-modal").show(),localStorage.setItem("last_day",this_day_of_year))):!1},Application.prototype.hide_ie8_message=function(e){$(e.target).is("a")||$(".ie-message-modal").hide()},Application.prototype.render_collection_video=function(e){var $figure,$videoFigure,$videoHtml;return e.preventDefault(),$videoFigure=$(e.target).closest("[data-video]"),$videoHtml=$videoFigure.data("video"),$figure=$videoFigure.addClass("home-video-wrapper").html($videoHtml),$figure.siblings(".image-caption").css("visibility","hidden"),$figure.find(".BrightcoveExperience").length?brightcove.createExperiences():void 0},Application}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.BrightcoveVideos=function(_super){function BrightcoveVideos(){return BrightcoveVideos.__super__.constructor.apply(this,arguments)}return __extends(BrightcoveVideos,_super),BrightcoveVideos.prototype.autoplay=!0,BrightcoveVideos.prototype.activePlayer=null,BrightcoveVideos.prototype.IS_OMNI_ENABLED=!0,BrightcoveVideos.prototype.initialize=function(){return this.players=new Time.collections.BrightcoveVideos,this.userPaused=!1,this.bindAutoplayListeners(),this.listenTo(Time,"brightcove:template:load",function(_this){return function(experienceId){console.info("Brightcove -- template loaded",experienceId),_this.onTemplateLoad(experienceId)}}(this)),this.listenTo(Time,"brightcove:template:ready",function(_this){return function(e){console.info("Brightcove -- template ready",arguments),_this.onTemplateReady(e)}}(this)),this.listenTo(Time,"readingPane:scrolled",function(_this){return function(e){_this.onScroll(e)}}(this)),this.listenTo(Time,"article:deactivated",function(_this){return function(){_this.stopOtherPlayers(null,!0)}}(this)),this},BrightcoveVideos.prototype.bindAutoplayListeners=function(){return this.listenTo(Time,"rail:clicked:videoTile",function(_this){return function(){_this.autoplay=!0}}(this)),this.listenTo(Time,"leftRail:load:videos",function(_this){return function(){_this.autoplay=!0}}(this)),this.listenTo(Time,"article:found:noPrimaryBrightcove",function(_this){return function(){_this.autoplay=!1}}(this)),this},BrightcoveVideos.prototype.maybeAutoplay=function(playerModel){return playerModel.get("isPrimary")&&this.autoplay?(this.autoplay=!1,this.apiPlay(playerModel),playerModel):void 0},BrightcoveVideos.prototype.getPlayerEl=function(id){return $("#"+id)},BrightcoveVideos.prototype.isPrimary=function(experienceId){return this.getPlayerEl(experienceId).closest(".primary-video-wrapper").length>0},BrightcoveVideos.prototype.isVisible=function(playerModel){return playerModel?void 0:!1},BrightcoveVideos.prototype.onScroll=function(e){var el;if(!this.activePlayer)return e;if(el=this.getPlayerEl(this.activePlayer.id),Time.application.readingPane.isFullyInReadingPane(el,!1)){if(this.userPaused)return e;if("ad"===this.activePlayer.get("media"))return e;this.apiPlay(this.activePlayer)}else this.apiStop(this.activePlayer,!0);return e},BrightcoveVideos.prototype.onTemplateLoad=function(experienceId){var $article,$player,adPlayer,api,articleId,continuous,experience,oldPlayer,playerModel,videoPlayer;$player=this.getPlayerEl(experienceId),$article=$player.closest(".full-article").eq(0),continuous=parseInt($player.closest(".video-wrapper").data("continuous"),10),console.info("Brightcove -- continuous play",continuous,$player),articleId=$article.length?parseInt($article.data("article"),10):null,null!=Time.bootstrap.popularVideos&&Time.bootstrap.popularVideos.length>0&&this.loadPopularVideos(experienceId);try{experience=brightcove.api.getExperience(experienceId)||null,api=brightcove.api.modules.APIModules||null,videoPlayer=experience.getModule(api.VIDEO_PLAYER),adPlayer=experience.getModule(api.ADVERTISING),this.IS_OMNI_ENABLED&&omni_myTemplateLoaded(experienceId)}catch(_error){}oldPlayer=this.players.get(experienceId),this.players.remove(oldPlayer),playerModel=this.players.push({id:experienceId,state:"stopped",experience:experience,videoPlayer:videoPlayer,adPlayer:adPlayer,isPrimary:this.isPrimary(experienceId),articleId:articleId,continuous:continuous})},BrightcoveVideos.prototype.onTemplateReady=function(e){var adPlayer,adPolicy,experienceId,playerModel,videoPlayer,_ref,_ref1;try{this.IS_OMNI_ENABLED&&omni_onTemplateReady(e)}catch(_error){}return experienceId=e.target.experience.id,playerModel=this.players.get(experienceId),videoPlayer=playerModel.get("videoPlayer"),videoPlayer.addEventListener(brightcove.api.events.MediaEvent.BEGIN,function(_this){return function(event){return _this.onBegin(event)}}(this)),videoPlayer.addEventListener(brightcove.api.events.MediaEvent.COMPLETE,function(_this){return function(event){return _this.onComplete(event)}}(this)),videoPlayer.addEventListener(brightcove.api.events.MediaEvent.PLAY,function(_this){return function(event){return _this.onPlay(event)}}(this)),videoPlayer.addEventListener(brightcove.api.events.MediaEvent.STOP,function(_this){return function(event){return _this.onStop(event)}}(this)),videoPlayer.addEventListener("click",function(_this){return function(event){return _this.onClick(event)}}(this)),adPlayer=playerModel.get("adPlayer"),null!=(null!=(_ref=Time.bootstrap)&&null!=(_ref1=_ref.collection)?_ref1.intro_post:void 0)&&playerModel.get("articleId")===Time.bootstrap.collection.hubs[0].articles[0].id&&(adPolicy=adPlayer.getAdPolicy(),adPolicy.playAdOnLoad=!1,adPlayer.setAdPolicy(adPolicy)),adPlayer.addEventListener(brightcove.api.events.AdEvent.START,function(_this){return function(event){return _this.onAdStart(event)}}(this)),adPlayer.addEventListener(brightcove.api.events.AdEvent.COMPLETE,function(_this){return function(event){return _this.onPlay(event)}}(this)),adPlayer.addEventListener("click",function(_this){return function(event){return _this.onClick(event)}}(this)),this.maybeAutoplay(playerModel),e},BrightcoveVideos.prototype.onAdStart=function(e){var experienceId;return experienceId=e.target.experience.id,this.activePlayer=this.players.get(experienceId),this.activePlayer.set("media","ad"),this.onPlay(e)},BrightcoveVideos.prototype.onBegin=function(e){var experienceId,playerModel;return experienceId=e.target.experience.id,this.stopOtherPlayers(experienceId),playerModel=this.players.get(experienceId),this.activePlayer=playerModel,this.activePlayer.set("media","video"),this.userPaused=!1,e},BrightcoveVideos.prototype.onComplete=function(e){var experienceId,playerModel,videoPlayer;return experienceId=e.target.experience.id,playerModel=this.players.get(experienceId),videoPlayer=playerModel.get("videoPlayer"),this.popularVideos.length>0&&playerModel.get("continuous")?videoPlayer.loadVideoByID(this.popularVideos.shift()):(this.activePlayer=null,this.userPaused=!1),e},BrightcoveVideos.prototype.onClick=function(e){var experienceId,_ref,_ref1,_ref2;return console.info("Brightcove heard click",e),experienceId=null!=e&&null!=(_ref=e.target)&&null!=(_ref1=_ref.experience)?_ref1.id:void 0,this.stopOtherPlayers(experienceId),(null!=(_ref2=this.activePlayer)?_ref2.id:void 0)===experienceId?"stopped"===this.activePlayer.get("state")&&(this.userPaused=!0):(null!=this.activePlayer&&this.apiStop(this.activePlayer),this.activePlayer=this.players.get(experienceId)),e},BrightcoveVideos.prototype.onPlay=function(e){var experienceId;return experienceId=e.target.experience.id,this.stopOtherPlayers(experienceId),experienceId=e.target.experience.id,this.activePlayer=this.players.get(experienceId),this.activePlayer.set("state","playing"),this.userPaused=!1,clearInterval(Time.homepage_refresh),e},BrightcoveVideos.prototype.onStop=function(e){var experienceId,playerModel;return experienceId=e.target.experience.id,playerModel=this.players.get(experienceId),this.players.get(experienceId).set("state","stopped"),e},BrightcoveVideos.prototype.stopOtherPlayers=function(id,isUserPaused){return null==isUserPaused&&(isUserPaused=!1),_.each(this.players.getOthers(id),function(_this){return function(player){return _this.apiStop(player,isUserPaused)}}(this)),id},BrightcoveVideos.prototype.apiStop=function(playerModel,isScroll){var _ref,_ref1,_ref2;null==isScroll&&(isScroll=!1),isScroll||(null!=(_ref=this.activePlayer)?_ref.id:void 0)!==playerModel.id||(this.userPaused=!0);try{null!=(_ref1=playerModel.get("videoPlayer"))&&"function"==typeof _ref1.pause&&_ref1.pause(!0),null!=(_ref2=playerModel.get("adPlayer"))&&"function"==typeof _ref2.pause&&_ref2.pause(!0)}catch(_error){}return playerModel},BrightcoveVideos.prototype.apiPlay=function(playerModel){var _ref;try{null!=(_ref=playerModel.get("videoPlayer"))&&"function"==typeof _ref.play&&_ref.play(),this.activePlayer=playerModel}catch(_error){}return playerModel},BrightcoveVideos.prototype.loadPopularVideos=function(experienceId){var currentVideo,index,shuffledVideos;for(currentVideo=parseInt(experienceId.replace("bc-video-","").slice(0,-2)),this.popularVideos=Time.bootstrap.popularVideos,index=this.popularVideos.indexOf(currentVideo),index>0&&this.popularVideos.splice(index,1),shuffledVideos=this.popularVideos;this.popularVideos.join()===shuffledVideos.join();)shuffledVideos=_.shuffle(shuffledVideos);return this.popularVideos=shuffledVideos},BrightcoveVideos}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.Divider=function(_super){function Divider(){return Divider.__super__.constructor.apply(this,arguments)}return __extends(Divider,_super),Divider.prototype.initialize=function(options){return null==options&&(options={}),this.articleView=options.article,this.articleModel=this.articleView.model,this.articleId=this.articleModel.get("id"),this.model=new Time.models.Divider,console.info("---- DIVIDER",this,this.model.attributes),this},Divider.prototype.render=function(){var $el,$html,$inner;switch(this.model.get("type")){case"advert":this.model.set("divId","ad-below-"+this.articleId),$html=$("<div />",{"class":"divider-"+this.model.get("type"),id:"ad-below-"+this.articleId}),this.setElement($html);break;case"articles":this.model.set("divId","divider-300x600-"+this.articleId),$el=$("<div />",{"class":"divider-"+this.model.get("type")}),$el.html(this.model.get("articles_html")),$el.find(".divider-300x600").eq(0).attr("id",this.model.get("divId")),this.setElement($el);break;case"empty":this.setElement(null);break;case"taboola":$el=$("<div />",{"class":"divider-"+this.model.get("type")}),$inner=$("<div />",{id:"taboola-mid-page-"+Time.taboola_counter,"class":"taboola"}),$el.html($inner),this.setElement($el)}return this},Divider}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.GallerySlideLightboxEndless=function(_super){function GallerySlideLightboxEndless(){return GallerySlideLightboxEndless.__super__.constructor.apply(this,arguments)}return __extends(GallerySlideLightboxEndless,_super),GallerySlideLightboxEndless.prototype.template=Time.templates["gallery-slide-lightbox-endless"],GallerySlideLightboxEndless.prototype.render=function(){var nextGallery,_ref;return(nextGallery=this.model.get("nextGallery"))?(this.setElement(this.template.render(nextGallery,Time.partials)),(null!=(_ref=this.gallery)?_ref.get("isAdvanceable"):void 0)&&this.listenTo(this.gallery,"gallery:pastEnd",function(){return this.swapGallery(nextGallery.id)}),this):void 0},GallerySlideLightboxEndless}(Time.views.GallerySlideLightbox);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.GallerySlideLightboxRelated=function(_super){function GallerySlideLightboxRelated(){return GallerySlideLightboxRelated.__super__.constructor.apply(this,arguments)}return __extends(GallerySlideLightboxRelated,_super),GallerySlideLightboxRelated.prototype.template=Time.templates["gallery-slide-lightbox-related"],GallerySlideLightboxRelated.prototype.render=function(){var data;return data={galleries:this.model.get("galleries")},this.setElement(this.template.render(data,Time.partials)),this},GallerySlideLightboxRelated}(Time.views.GallerySlideLightbox);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.GalleryLightboxSlides=function(_super){function GalleryLightboxSlides(){return GalleryLightboxSlides.__super__.constructor.apply(this,arguments)}return __extends(GalleryLightboxSlides,_super),GalleryLightboxSlides.prototype.initialize=function(options){return null==options&&(options={}),GalleryLightboxSlides.__super__.initialize.apply(this,arguments),this.render(),this},GalleryLightboxSlides.prototype.render=function(){var startAt,_ref;return console.info("GalleryLightboxSlidesView render"),startAt=(null!=(_ref=this.galleryView.model)?_ref.get("slideIndex"):void 0)||0,this.renderAround(startAt),this.galleryView.trigger("gallery:slides:rendered"),this},GalleryLightboxSlides.prototype.reallyRender=function(models){var renderedViews;return renderedViews=_.map(models,function(_this){return function(slideModel){return _this.renderSlideView(slideModel)}}(this)),this.$el.html(renderedViews),this},GalleryLightboxSlides.prototype.renderSlideView=function(model){return null!=model?(model.set("isRendered",!0),model.view.render().el):void 0},GalleryLightboxSlides.prototype.renderAround=function(index,around){var end,models,start;return null==index&&(index=0),null==around&&(around=3),start=index-around,end=index+around,0>start&&(start=0),end>this.collection.size()&&(end=this.collection.size()),this.collection.invoke("set",{isActive:!1,isRendered:!1}),models=this.collection.slice(start,end+1),console.info("GalleryLightboxSlidesView rendering slides from "+start+" to "+end,models),this.reallyRender(models),this},GalleryLightboxSlides.prototype.renderAt=function(index,append){var model,renderedView;return null==index&&(index=0),null==append&&(append=!0),0>index?this:index>this.collection.size()?this:(model=this.collection.at(index))?("undefined"!=typeof console&&null!==console&&console.info("renderAt",index,append,model),model.get("isRendered")?this:(renderedView=this.renderSlideView(model),append?$(renderedView).appendTo(this.$el):$(renderedView).prependTo(this.$el),this)):this},GalleryLightboxSlides.prototype.cleanAround=function(index,around){var derender,end,start;return null==around&&(around=3),start=index-around,end=index+around,0>start&&(start=0),end>this.collection.size()&&(end=this.collection.size()),derender=this.collection.filter(function(slide,index){return start>index||index>end}),_.each(derender,function(slide){return slide.view.$el.remove(),slide.set("isRendered",!1)}),derender},GalleryLightboxSlides}(Time.views.GallerySlidesView);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.GalleryLightbox=function(_super){function GalleryLightbox(){return GalleryLightbox.__super__.constructor.apply(this,arguments)}return __extends(GalleryLightbox,_super),GalleryLightbox.prototype.events={"click .galleryLightbox__meta":"closeCaption","click .galleryLightbox__slides":"clickedSlide",'click [data-gallery-action="next"]':"goNextSlide",'click [data-gallery-action="prev"]':"goPrevSlide",'click [data-gallery-action="restart"]':"goFirstSlide","click .galleryLightbox__caption__wrapper.truncated":"toggleCaption",'click [data-gallery-action="toggleFullscreen"]':"toggleFullscreen"},GalleryLightbox.prototype.template=Time.templates["gallery-module-lightbox"],GalleryLightbox.prototype.IS_SIDE_CLICKING_ENABLED=!1,GalleryLightbox.prototype.initialize=function(options){return null==options&&(options={}),GalleryLightbox.__super__.initialize.apply(this,arguments),this.$caption=null,this.$captionWrapper=null,this.captionMoreTemplate='<button data-gallery-action = "toggleCaption">MORE</button>',this.captionCloseTemplate='<button data-gallery-action = "toggleCaption">CLOSE</button>',this.$restart=null,this.$shareDiv=null,this.$shareToggle=null,this.$counterCurrent=null,this.$counterTotal=null,this.$shareEmail=null,this.$shareTwitter=null,this.$shareGooglePlus=null,this.$shareLinkedIn=null,this.$shareFacebook=null,this.$fullscreenToggle=null,this.$prevButton=null,this.$nextButton=null,this.bindListeners(),this},GalleryLightbox.prototype.bindListeners=function(){return this.listenTo(Time,"body:clicked",function(_this){return function(){_this.resetCaption()}}(this)),this.listenToOnce(this,"gallery:slides:rendered",function(){this.bindTouchEvents(),this.bindResizeEvents()}),this.listenTo(this,"gallery:slides:rendered",function(){var activeSlide;0!==this.slidesCollection.size()&&(this.setSlideClasses(),this.setMeta(),activeSlide=this.slidesCollection.at(this.model.getSlideIndex()),null!=activeSlide&&activeSlide.set("isActive",!0)),console.info("GalleryVertical view heard gallery:slides:rendered, bubbling up to article"),this.parent.trigger("gallery:slides:rendered",this)}),this.listenTo(this,"gallery:keyboardEvent",function(e){this.doKeyboardEvent(e)}),this.listenTo(this.model,"change:isCaptionExpanded",function(_this){return function(model,value){var captionText,_ref;value?(captionText=null!=(_ref=_this.model.currentSlide())?_ref.get("caption"):void 0,_this.$captionWrapper.html(captionText+_this.captionCloseTemplate),_this.$captionWrapper.trigger("destroy.dot"),_this.$captionWrapper.addClass("expanded")):(_this.$captionWrapper.removeClass("expanded"),_this.setCaption())}}(this)),this.listenTo(this.model,"change:isFullscreen",function(_this){return function(model,value){_this.$el.toggleClass("fullscreen",value),value&&_this.setFullscreenImage(),Time.trigger("gallery:isFullscreen",_this,value)}}(this)),this.listenTo(this.model,"change:slideIndex",function(_this){return function(){var omniData,slideIndex,threeSlidesAfter,threeSlidesBefore;console.info("gallery view heard change:slideIndex on model"),_this.model.set("lastSlideIndex",_this.model.previous("slideIndex")),slideIndex=_this.model.get("slideIndex"),0===slideIndex||slideIndex===_this.model.getTotalSlides()-1?_this.renderOnly():(_this.model.previous("slideIndex")>slideIndex?(threeSlidesBefore=slideIndex-_this.model.get("prerenderCount"),_this.slidesView.renderAt(threeSlidesBefore,!1)):(threeSlidesAfter=slideIndex+_this.model.get("prerenderCount")-1,_this.slidesView.renderAt(threeSlidesAfter,!0)),_this.slidesView.cleanAround(slideIndex)),omniData=Time.application.model.get("activeArticle").toJSON(),omniData.userAction="gallery",Time.Tracking.article_view(omniData),_this.setSlideClasses(),_this.model.get("isFullscreen")&&_this.setFullscreenImage(),_this.resetCaption(),_this.setMeta()}}(this)),this},GalleryLightbox.prototype.render=function($parent){return null==$parent&&($parent=null),console.info("GalleryLightboxView render into ",$parent),this.setElement(this.template.render(this.model.toJSON(),Time.partials)),null!=$parent&&$parent.html(this.el),this.$counterCurrent=this.$(".current-slide"),this.$counter=this.$(".galleryLightbox__counter"),this.$credit=this.$(".galleryLightbox__credit"),this.$caption=this.$(".galleryLightbox__caption"),this.$captionWrapper=this.$(".galleryLightbox__caption__wrapper"),this.$restart=this.$(".galleryLightbox__restart"),this.$shareDiv=this.$(".gallery__shareLinks"),this.$shareEmail=this.$(".time-icons-mail"),this.$shareTwitter=this.$(".time-icons-tw"),this.$shareGooglePlus=this.$(".time-icons-gplus"),this.$shareLinkedIn=this.$(".time-icons-linkedin"),this.$shareFacebook=this.$(".time-icons-fb"),this.$prevButton=this.$('.time-icons[data-gallery-action="prev"]'),this.$nextButton=this.$('.time-icons[data-gallery-action="next"]'),this.trigger("gallery:rendered"),this.$slides=this.$(".galleryLightbox__slides"),this.slidesView=new Time.views.GalleryLightboxSlides({el:this.$slides,gallery:this,collection:this.slidesCollection}),this.setTotal(),this},GalleryLightbox.prototype.renderOnly=function(){return this.slidesCollection.trigger("gallery:slides:flush"),this.$slides.html(this.slidesView.render().el),this.slidesView.renderAround(this.model.get("slideIndex"),this.model.get("prerenderCount")),this},GalleryLightbox.prototype.setMeta=function(){var adSlides,slideIndexText,slideType,_ref;return adSlides=0,this.setCredit(),slideType=null!=(_ref=this.model.currentSlide())?_ref.get("slideType"):void 0,this.$counter.css("ad"===slideType||this.model.isAtEnd()?{visibility:"hidden"}:{visibility:"visible"}),slideIndexText=this.model.getSlideIndex()+1,this.model.get("hasAds")&&!this.model.isAtEnd()&&(slideIndexText-=Math.floor((this.model.getSlideIndex()+1)/6)),this.$counterCurrent.text(slideIndexText),this.$el.attr("data-slideType",slideType),this.setCaption(),"default"===slideType&&this.setShare(this.model.currentSlide()),this.setControlClasses(),this},GalleryLightbox.prototype.setTotal=function(){var totalImages,_ref;return this.$counterTotal=this.$(".total-slides"),totalImages=this.model.getTotalSlides(),null==(null!=(_ref=this.model.attributes)?_ref.custom_recirc_url:void 0)&&(totalImages-=1),this.model.get("hasAds")&&(totalImages-=Math.floor(totalImages/6)),this.$counterTotal.text(totalImages),this},GalleryLightbox.prototype.setCredit=function(text){var _ref;return null==text&&(text=""),text=null!=(_ref=this.model.currentSlide())?_ref.get("credit"):void 0,text||(text="&nbsp;"),this.$credit.html(text),this},GalleryLightbox.prototype.setCaption=function(text){var _ref;return null==text&&(text="&nbsp;"),this.$captionWrapper.trigger("destroy.dot"),text=null!=(_ref=this.model.currentSlide())?_ref.get("caption"):void 0,text?this.$captionWrapper.html(text+this.captionMoreTemplate).dotdotdot({ellipsis:"...",after:"button",watch:!0,callback:function(_this){return function(isTruncated,originalContent){return _this.truncateCaptionCallback(isTruncated,originalContent)
}}(this)}):(text="&nbsp;",this.$captionWrapper.html(text)),this},GalleryLightbox.prototype.truncateCaptionCallback=function(isTruncated){return this.model.set("isCaptionTruncated",isTruncated),this.$captionWrapper.toggleClass("truncated",isTruncated)},GalleryLightbox.prototype.setShare=function(slideModel){return this.$(".time-icons-mail").attr("href",slideModel.getShareMail()),this.$(".time-icons-tw").data("href",slideModel.getShareTwitter()),this.$(".time-icons-gplus").attr("href",slideModel.getShareGplus()),this.$(".time-icons-linkedin").attr("href",slideModel.getShareLinkedIn()),this.$(".time-icons-fb").attr("href",slideModel.getShareFacebook()),this},GalleryLightbox.prototype.setControlClasses=function(currentIndex){var disableNextButton,_ref;return null==currentIndex&&(currentIndex=this.model.getSlideIndex()),this.$prevButton.toggleClass("disabled",0===currentIndex),disableNextButton=this.model.isAtEnd(),this.model.get("isMovePastToNextGalleryEnabled")&&(disableNextButton=disableNextButton&&"endless"!==(null!=(_ref=this.model.currentSlide())?_ref.get("slideType"):void 0)),this.$nextButton.toggleClass("disabled",disableNextButton),this},GalleryLightbox.prototype.setSlideClasses=function(currentIndex,currentSlide){var passedEls,passedModels,upcomingEls,upcomingModels;return null==currentIndex&&(currentIndex=this.model.getSlideIndex()),null==currentSlide&&(currentSlide=this.model.currentSlide()),null!=currentSlide&&currentSlide.view.$el.addClass("current").removeClass("passed upcoming"),passedModels=this.slidesCollection.first(currentIndex),passedEls=_.map(passedModels,function(slideModel){return slideModel.view.el}),$(passedEls).addClass("passed").removeClass("current upcoming"),upcomingModels=this.slidesCollection.rest(currentIndex+1),upcomingEls=_.map(upcomingModels,function(slideModel){return slideModel.view.el}),$(upcomingEls).addClass("upcoming").removeClass("passed current"),this},GalleryLightbox.prototype.resetCaption=function(){return this.model.set("isCaptionTruncated",!1),this.model.set("isCaptionExpanded",!1)},GalleryLightbox.prototype.toggleCaption=function(e){return null!=e&&e.stopPropagation(),this.model.get("isCaptionTruncated")?(Time.application.toggle_share_tooltip("close"),this.model.set("isCaptionExpanded",!this.model.get("isCaptionExpanded")),this):this},GalleryLightbox.prototype.toggleFullscreen=function(toggleOn){return"object"==typeof toggleOn&&(toggleOn=!this.model.get("isFullscreen")),this.model.set("isFullscreen",toggleOn),this},GalleryLightbox.prototype.bindResizeEvents=function(){return this.listenTo(Time,"application:resize",function(_this){return function(){return _this.setCaption()}}(this))},GalleryLightbox.prototype.bindTouchEvents=function(){var _base;if(Modernizr.touch)return"function"==typeof(_base=this.$slides).touchwipe&&_base.touchwipe({preventDefaultEvents:!1,min_move_x:6,min_move_y:6,wipeLeft:function(_this){return function(e){return _this.goNextSlide(e)}}(this),wipeRight:function(_this){return function(e){return _this.goPrevSlide(e)}}(this)}),this},GalleryLightbox.prototype.doKeyboardEvent=function(e){return 27===e.keyCode&&(Time.application.toggle_share_tooltip("close"),this.toggleFullscreen(!1)),37===e.keyCode&&(Time.application.toggle_share_tooltip("close"),this.goPrevSlide(e)),39===e.keyCode&&(Time.application.toggle_share_tooltip("close"),this.goNextSlide(e)),69===e.keyCode&&(Time.application.toggle_share_tooltip("close"),this.goLastSlide(e)),82===e.keyCode&&(Time.application.toggle_share_tooltip("close"),this.goFirstSlide(e)),e},GalleryLightbox.prototype.clickedSlide=function(e){var slideMidpoint;if(!Time.application.model.get("isRailToggleable")||!Time.application.model.get("isRailOpen"))return this.IS_SIDE_CLICKING_ENABLED?(slideMidpoint=e.currentTarget.clientWidth/2,e.offsetX<slideMidpoint?this.model.goPrevSlide():this.model.goNextSlide()):this.model.goNextSlide(),e},GalleryLightbox.prototype.goNextSlide=function(e){return e.stopPropagation(),Time.application.model.get("isRailToggleable")&&Time.application.model.get("isRailOpen")?void 0:this.model.goNextSlide()},GalleryLightbox.prototype.goPrevSlide=function(e){return e.stopPropagation(),Time.application.model.get("isRailToggleable")&&Time.application.model.get("isRailOpen")?void 0:this.model.goPrevSlide()},GalleryLightbox.prototype.goFirstSlide=function(){return this.model.goSlide(0)},GalleryLightbox.prototype.goLastSlide=function(){return this.model.goSlide(this.model.getTotalSlides()-1)},GalleryLightbox.prototype.closeCaption=function(){return this.model.get("isCaptionTruncated")?this.model.set("isCaptionExpanded",!1):this},GalleryLightbox.prototype.setFullscreenImage=function(){var $image,currentSrc,largest,sizes,ww;$image=this.$(".galleryLightbox__slide--image.current img"),sizes=$image.data("fullscreen"),(null!=sizes?sizes.length:void 0)&&(ww=$(window).width(),largest=_.find(sizes,function(size){return ww>size.width?!1:!0}),null==largest&&(largest=_.last(sizes)),currentSrc=$image.attr("src"),(null!=largest?largest.src:void 0)&&currentSrc!==largest.src&&$image.attr("src",largest.src))},GalleryLightbox}(Time.views.Gallery);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.GalleryParent=function(_super){function GalleryParent(){return GalleryParent.__super__.constructor.apply(this,arguments)}return __extends(GalleryParent,_super),GalleryParent.prototype.initialize=function(options){return null==options&&(options={}),console.info("galleryParentView init"),this.$el.length?(this.galleryId=this.$el.data("gallery"),this.galleryId?null==options.article?(console.error("GalleryParentView needs to be attached to an ReadingPaneArticle view",options),this.remove(),null):(this.articleView=options.article,null==options.galleries?(console.error("GalleryParentView needs to be attached to a Galleries collection",options),this.remove(),null):(this.galleriesCollection=options.galleries,this.galleryView=null,this.galleryModel=this.getGalleryModel(this.galleryId),this.listenTo(this,"view:destroy",function(){var _ref,_ref1;console.info("GalleryParentView in article "+articleModel.id+" heard view:destroy"),this.galleriesCollection=null,null!=(_ref=this.galleryView)&&_ref.destroy(),this.galleryView=null,null!=(_ref1=this.galleryModel)&&(_ref1.view=null),this.galleryModel=null,this.articleView=null}),null!=this.galleryModel&&this.render(),this)):(console.error("GalleryParentView couldn't get galleryId from el",this.$el),this.remove(),null)):(console.error("GalleryParentView needs to be instantiated with an el",options),this.remove(),null)},GalleryParent.prototype.render=function(){return console.info("galleryParentView render"),this.listenToOnce(this.galleryModel,"gallery:dataReady",function(_this){return function(){return console.info("GalleryParentView - render - heard gallery:dataReady on galleryModel "+_this.galleryModel.id),_this.galleryView=_this.galleryModel.getView(_this.articleView),null!=_this.articleView.model.collection&&_this.listenTo(Time,"readingPane:reset",function(){var _ref;console.info("GalleryParentView heard readingPane:reset on Time -- destroying GalleryView"),null!=(_ref=_this.galleryView)&&_ref.destroy(),_this.galleryView=null,_this.galleryModel.view=null,_this.$el.empty(),_this.stopListening(Time)}),_this.listenToOnce(_this.galleryView,"gallery:rendered",function(){console.info("GalleryParentView - render - heard gallery:rendered on galleryView "+_this.galleryModel.id),_this.articleView.trigger("gallery:rendered")}),_this.galleryView.render(_this.$el)}}(this)),this.galleryModel.getData(),this},GalleryParent.prototype.getGalleryModel=function(galleryId){var galleryModel,size;return(galleryId=parseInt(galleryId,10))?(galleryModel=this.galleriesCollection.get(galleryId),console.info("GalleryParentView looking for existing model in galleriesCollection",galleryId,"found:",null!=galleryModel),null!=galleryModel?galleryModel:(size=this.$el.data("size"))?(this.galleryModel=this.galleriesCollection.push({id:galleryId,size:size}),this.galleryModel):(console.error("GalleryParentView -- could not create a new gallery model",galleryId,size),null)):(console.error("GalleryParentView -- getGalleryModel -- invalid galleryId",galleryId),null)},GalleryParent}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.GallerySlideAd=function(_super){function GallerySlideAd(){return GallerySlideAd.__super__.constructor.apply(this,arguments)}return __extends(GallerySlideAd,_super),GallerySlideAd.prototype.initialize=function(options){return this.template=options.template,this.listenTo(this.model,"change:isActive",function(_this){return function(model,value){value?_this.activate():_this.deactivate()}}(this)),this},GallerySlideAd.prototype.render=function(){return this.setElement(this.template.render()),this.$(".gallery__ad").attr("id",this.model.get("adModelId")),this},GallerySlideAd.prototype.activate=function(){var adSizes,articleModel,articleView,callback,galleryModel,gallerySize,params,slideModel,slidesCollection,_ref;return console.info("GallerySlideAdView activating",this),slideModel=this.model,slidesCollection=(null!=slideModel?slideModel.collection:void 0)||null,galleryModel=(null!=slidesCollection?slidesCollection.galleryModel:void 0)||null,articleView=(null!=slidesCollection&&null!=(_ref=slidesCollection.galleryView)?_ref.parent:void 0)||null,(articleModel=(null!=articleView?articleView.model:void 0)||null)?(gallerySize=galleryModel.get("size"),adSizes=["300x250"],"vertical"===gallerySize&&"mobile"!==Time.device&&adSizes.push("450x375"),params={id:this.model.get("adModelId"),size:adSizes,position:this.model.get("adIndex"),group:"gallery",subgroup:gallerySize,slide:slideModel.get("index")+1},callback="vertical"!==gallerySize,"vertical"!==gallerySize&&null!=Time.application.active_rail&&(callback=function(){var adDivIds;adDivIds=[params.id],Time.trigger("dfpAdManager:syncWithLeftRail",articleModel,adDivIds)}),Time.trigger("dfpAdManager:activateAd",articleModel,params,callback),this):(console.error("GallerySlideAd.activate - no articleModel",this.model),this)},GallerySlideAd.prototype.deactivate=function(){return console.info("GallerySlideAdView deactivating",this),Time.trigger("dfpAdManager:deleteAd",this.model.get("adModelId")),this},GallerySlideAd.prototype.onActivated=function(){return console.info("GallerySlideAdView activated",this),this},GallerySlideAd}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.GallerySlide=function(_super){function GallerySlide(){return GallerySlide.__super__.constructor.apply(this,arguments)}return __extends(GallerySlide,_super),GallerySlide.prototype.initialize=function(options){var _ref,_ref1,_ref2;return null==options&&(options={}),this.galleryModel=null!=(_ref=this.model)&&null!=(_ref1=_ref.collection)?_ref1.galleryModel:void 0,this.articleView=this.galleryModel.collection.article,this.articleModel=this.articleView.model,"vertical"===(null!=(_ref2=this.galleryModel)?_ref2.get("size"):void 0)?this.initVertical():this.initLightbox(),this},GallerySlide.prototype.initVertical=function(){return this.template=Time.templates["gallery-slide-vertical"],this},GallerySlide.prototype.initLightbox=function(){return this.template=Time.templates["gallery-slide-lightbox"],this.listenTo(this.model,"change:isActive",function(model,value){value&&this.activate()}),this},GallerySlide.prototype.activate=function(){return Time.trigger("gallery:slide:activated",this.galleryModel,this.articleView),this},GallerySlide.prototype.render=function(){return this.setElement(this.template.render(this.model.toJSON(),Time.partials)),this},GallerySlide.prototype.setShare=function(){return this.$(".time-icons-mail").attr("href",this.model.getShareMail()),this.$(".time-icons-tw").data("href",this.model.getShareTwitter()),this.$(".time-icons-gplus").attr("href",this.model.getShareGplus()),this.$(".time-icons-linkedin").attr("href",this.model.getShareLinkedIn()),this.$(".time-icons-fb").attr("href",this.model.getShareFacebook()),this},GallerySlide}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.GalleryVerticalSlides=function(_super){function GalleryVerticalSlides(){return GalleryVerticalSlides.__super__.constructor.apply(this,arguments)}return __extends(GalleryVerticalSlides,_super),GalleryVerticalSlides.prototype.events={"click .galleryVertical__loadMore":"loadMore"},GalleryVerticalSlides.prototype.initialize=function(options){return null==options&&(options={}),GalleryVerticalSlides.__super__.initialize.apply(this,arguments),this.initialRenderLimit=options.initialRenderLimit||6,this},GalleryVerticalSlides.prototype.render=function(){var initialModelsToRender;return initialModelsToRender=this.collection.first(this.initialRenderLimit),this.reallyRender(initialModelsToRender),this.collection.size()>this.initialRenderLimit&&(this.$el.append('<div class="galleryVertical__loadMore">Load More Photos</div>'),this.$loadMore=this.$(".galleryVertical__loadMore")),this.galleryView.trigger("gallery:slides:rendered"),this},GalleryVerticalSlides.prototype.reallyRender=function(models){var html,_ref;return null==models&&(models=this.collection.models),html=_.map(models,function(slideModel){return slideModel.view.render().el}),(null!=(_ref=this.$el)?_ref.children().length:void 0)?this.$el.append(html):this.$el.html(html),_.invoke(models,"set",{isRendered:!0}),this},GalleryVerticalSlides.prototype.loadMore=function(){var remainingModelsToRender,_ref;return null!=(_ref=this.$loadMore)&&_ref.addClass("activated"),remainingModelsToRender=this.collection.rest(this.initialRenderLimit),this.reallyRender(remainingModelsToRender),this.galleryView.trigger("gallery:slides:loadedMore"),this},GalleryVerticalSlides}(Time.views.GallerySlidesView);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.GalleryVertical=function(_super){function GalleryVertical(){return GalleryVertical.__super__.constructor.apply(this,arguments)}return __extends(GalleryVertical,_super),GalleryVertical.prototype.template=Time.templates["gallery-module-vertical"],GalleryVertical.prototype.initialize=function(options){return null==options&&(options={}),GalleryVertical.__super__.initialize.apply(this,arguments),this.articleModel=this.parent.model,this.listenTo(this,"gallery:slides:rendered",function(_this){return function(){console.info("GalleryVertical view heard gallery:slides:rendered, activating slides"),_this.activateSlides(),console.info("GalleryVertical view heard gallery:slides:rendered, bubbling up to article"),_this.parent.trigger("gallery:slides:rendered",_this)}}(this)),this.listenTo(this,"gallery:slides:loadedMore",function(_this){return function(){console.info("GalleryVertical view heard gallery:slides:loadedMore, activating slides"),_this.activateSlides(),Time.trigger("gallery:slides:loadedMore",_this,_this.parent)}}(this)),this.listenTo(this.articleModel,"change:isActive",function(_this){return function(model,value){value===!1&&_this.deactivateSlides()}}(this)),this.slidesView=new Time.views.GalleryVerticalSlides({gallery:this,collection:this.slidesCollection}),this},GalleryVertical.prototype.render=function($parent){return null==$parent&&($parent=null),this.setElement(this.template.render(this.model.toJSON(),Time.partials)),null!=$parent&&$parent.html(this.el),this.trigger("gallery:rendered"),this.$slides=this.$(".galleryVertical__slides"),this.slidesView.setElement(this.$slides),this.slidesView.render(),this},GalleryVertical.prototype.activateSlides=function(){var renderedModels;return renderedModels=this.slidesCollection.where({isRendered:!0}),_.invoke(renderedModels,"set",{isActive:!0})},GalleryVertical.prototype.deactivateSlides=function(){return this.slidesCollection.invoke("set",{isActive:!1})},GalleryVertical}(Time.views.Gallery);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.Homepage=function(_super){function Homepage(){return Homepage.__super__.constructor.apply(this,arguments)}return __extends(Homepage,_super),Homepage.prototype.el=".home",Homepage.prototype.events={"click a[data-video]":"render_homepage_video","click a[data-gallery]":"render_homepage_gallery","click .read-more-divider-hero img":"trigger_promo_click"},Homepage.prototype.homepage_galleries=[],Homepage.prototype.initialize=function(options){return this.app=options.app,this.app.model.set("isInitialRoute",!1),this.app.is_homepage=!0,this.app.active_route="home",this.rail_view=new Time.views.LeftRail({app:this.app}),this.render_ads(),this.app.load_tabs(Time.tab_data["default"]),this.app.tabs_view.set_active(0),this.app.resizeContent(),this.render_market_data(),this.app.placeholderPolyfill(".quote-search",".quote-search-input"),this.render_slideshow(),this.listenToOnce(Time,"application:ready",function(_this){return function(){$("body").removeClass("home"),$(".site-footer").remove(),_this.app.is_homepage=!1}}(this)),$(window).on("blur focus",function(e){"blur"===e.type?clearInterval(Time.homepage_refresh):Time.homepage_refresh=setInterval(function(){return Time.application.is_homepage?window.location=Time.home_url:void 0},48e4)}),Time.trigger("dfpAdManager:setInitialAppLoad",!1),Time.homepage_refresh=setInterval(function(){return Time.application.is_homepage?window.location=Time.home_url:void 0},48e4),this.app.hasPushstate||$("body").removeClass("hidden"),Time.trigger("homepage:initialized"),this},Homepage.prototype.img_html_to_gallery_slide=function($ref){var $img,$wrapped_img;return null==$ref&&($ref=this.$(".home-brief-hero")),$img=$ref.find("img").clone(),$wrapped_img=$(document.createElement("div").className="gallery__viewport").append($img),$(document.createElement("div").className="gallery__slide").append($wrapped_img)},Homepage.prototype.render_homepage_video=function(e){var $figure,$videoFigure,$videoHtml;return $videoFigure=$(e.target).closest("[data-video]"),$videoHtml=$videoFigure.data("video"),$figure=$videoFigure.addClass("home-video-wrapper").html($videoHtml),$figure.siblings(".image-caption").css("visibility","hidden"),$figure.find(".BrightcoveExperience").length&&brightcove.createExperiences(),!1},Homepage.prototype.render_homepage_gallery=function(e){var $galleryViewParent,galleryModel,gallery_id;return e.stopImmediatePropagation(),e.preventDefault(),$galleryViewParent=$(e.target).closest("[data-gallery]"),gallery_id=$galleryViewParent.attr("data-gallery"),this.galleriesCollection=new Time.collections.Galleries,galleryModel=this.galleriesCollection.push(new Time.models.Gallery({id:parseInt(gallery_id,10),$el:$galleryViewParent,template_string_ref:"gallery-module-home"})),this.listenToOnce(galleryModel,"sync:success",function(){var view;return view=galleryModel.createView().view,$galleryViewParent.html(view.render().el)}),galleryModel.fetch(),!1},Homepage.prototype.render_market_data=function(){var marketDataView;return marketDataView=new Time.views.MarketDataView,Time.marketdata_refresh=setInterval(function(){return Time.application.is_homepage?marketDataView=new Time.views.MarketDataView:void 0},5e3)},Homepage.prototype.render_ads=function(){var $current,ad_index,ad_placeholder_id,ads,data,homepage_rail_articles,i,index,num_article,sponsor_model;for(homepage_rail_articles=this.rail_view.$scroll_container.find(".rail-article"),num_article=homepage_rail_articles.length,ad_index=1,data={},i=0,ads=[];num_article>i;)index=i+1,index%3===0&&($current=$(homepage_rail_articles[i]),index%10===3&&Time.application.sponsor_length&&(sponsor_model=Time.application.sponsor_arr[Time.application.sponsor_index],sponsor_model.sponsor&&"vsp"===sponsor_model.sponsor.slug&&(sponsor_model.sponsor_timestamp=(new Date).getTime()),$(Time.templates["article-tile-sponsored"].render(sponsor_model)).insertAfter($current),Time.application.sponsor_index++,Time.application.sponsor_index=Time.application.sponsor_index+1>Time.application.sponsor_length?0:Time.application.sponsor_index)),3===index&&(ad_placeholder_id="ad-unit-"+ad_index,$("<div/>",{id:ad_placeholder_id,"class":"ad-unit"}).insertBefore($current),data=function(this_ad_placeholder_id,this_rail){return{active_rail:this_rail,pos:ad_index}}(ad_placeholder_id,this.rail_view),Time.trigger("dfpAdManager:renderHomepageLeftRailAd",ad_placeholder_id,data),ads.push(ad_placeholder_id),ad_index+=1),i+=1;Time.trigger("dfpAdManager:activateHomepageAds")},Homepage.prototype.render_slideshow=function(){var i,key,opts,slideshow_div_id,slideshow_obj,slideshows_data;if(slideshows_data=Time.bootstrap.homepage?Time.bootstrap.homepage.slideshows:!1,this.slideshows=[],opts={},i=0,slideshows_data)for(key in slideshows_data)slideshow_obj=slideshows_data[key],slideshow_div_id="slideshow-"+key,opts={cycle:"1"===slideshow_obj.loop?!0:!1,isAutoPlay:"1"===slideshow_obj.autoplay?!0:!1,experience:Time.device},this.slideshows[i]=new Time.Slideshow(slideshow_obj.slides,slideshow_div_id,opts),this.slideshows[i].init(),i+=1},Homepage.prototype.trigger_promo_click=function(e){return $(e.target).closest(".read-more-divider-hero").find(".related-article").trigger("click")},Homepage}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.LeftRail=function(_super){function LeftRail(){return LeftRail.__super__.constructor.apply(this,arguments)}return __extends(LeftRail,_super),LeftRail.prototype.tagName="section",LeftRail.prototype.className="article-list",LeftRail.prototype.events={mouseenter:"freeze_scroll",mouseleave:"release_scroll","click .rail-article-title a":"onClickTile","click #section-description a.button":"collectionIntroButton","click #hub-toggle":"toggle_hubs"},LeftRail.prototype.jump_to_active_tiles=!0,LeftRail.prototype.$leftRailHeader=$(".left-rail-header"),LeftRail.prototype.$mainNav=$(".left-rail-header .main-nav"),LeftRail.prototype.$scrollForMore=$(".scroll-for-more"),LeftRail.prototype.initialize=function(){return this.setVertical(),this.$scroll_container=$(".rail-articles-scroll"),this.scrollContainer=this.$scroll_container.get(0),Time.application.model.get("isRailOpen")&&!this.isRailFullyVisible()&&this.$scrollForMore.show(),this.$scrollForMore.appendTo("body"),this.jump_to_active_tiles&&(this.$mainNav.on("shown",function(_this){return function(){_this.$leftRailHeader.find(".header-nav-button").attr("data-event","nav-expose"),_this.jump_to_active_tiles=!1}}(this)),this.$mainNav.on("hidden",function(_this){return function(){_this.$leftRailHeader.find(".header-nav-button").removeAttr("data-event"),_this.jump_to_active_tiles=!0}}(this))),this.bindScroll(),null!=this.collection&&this.initCollection(),this},LeftRail.prototype.annihilate=function(){this.infinite_scroll.unbind(),this.destroy()},LeftRail.prototype.setVertical=function(){var vertical;return vertical=Time.application.hasPushstate?document.location.pathname.substring(1).split("/")[0]:document.location.hash.substring(1).split("/")[0],vertical.match(/money/)&&(this.vertical=vertical),this},LeftRail.prototype.onClickTile=function(e){var $tile,articleId,isVideoTile,tile;return tile=e.target,$tile=$(tile),isVideoTile=$tile.closest(".format-video").length>0,articleId=$tile.closest(".rail-article").data("article"),Time.trigger("leftRail:tile:clicked",articleId),isVideoTile&&Time.trigger("rail:clicked:videoTile",articleId),this},LeftRail.prototype.resetCollection=function(){var old_env;return null!=this.collection.active_env&&(old_env=this.$scroll_container.data("env"),null!=old_env&&this.$scroll_container.removeClass(old_env),this.$scroll_container.data("env",this.collection.active_env),this.$scroll_container.addClass(this.collection.active_env)),this.$el.html(""),this},LeftRail.prototype.initCollection=function(){return this.resetCollection(),this.listenTo(Time,"application:ready",function(_this){return function(){_this.fill_viewport(),Time.application.hide_loader(Time.application.$viewportWrapper)}}(this)),this.listenTo(this.collection,"sync:syncing",function(_this){return function(){_this.show_loader(),_this.collection.models.length||Time.application.show_loader(Time.application.$viewportWrapper)}}(this)),this.listenTo(this.collection,"sync",function(_this){return function(){Time.application.model.get("isRailOpen")&&$(".rail-articles-scroll")[0].scrollHeight!==$(".rail-articles-scroll").innerHeight()&&_this.$scrollForMore.show(),_this.$scrollForMore.appendTo("body"),_this.hide_loader()}}(this)),this.listenTo(this.collection,"sync:error",function(_this){return function(){_this.hide_loader(),_this.show_loader_error(),Time.application.hide_loader(Time.application.$viewportWrapper)}}(this)),this.listenToOnce(this.collection,"add reset",function(_this){return function(){var poyReveal;"undefined"!=typeof console&&null!==console&&console.log("views/rail -- heard add or reset - init infinite scroll, add loading, set ads"),_this.infinite_scroll=new Time.component.InfiniteScroll({parentEl:_this.$scroll_container,contentEl:_this.$el,threshold:20,onDown:_this.collection.fetch_next_page,onUp:null,context:_this.collection}),Time.application.$viewport.addClass("loading"),"time"===Time.branding&&null!=Time.bootstrap.poy_faceoff&&"trending"===_this.collection.active_env&&(poyReveal=new Time.views.TextModule({parent:_this,data:{classes:"leftRailModule--textPoyReveal",title:"See TIME's Person&nbsp;of&nbsp;the&nbsp;Year",titleLink:"/poy"}}),poyReveal.render(),$(".leftRailModule--textPoyReveal a").on("click",function(){"function"==typeof omniTrackEv&&omniTrackEv("tile-poy")}),_this.jump_to_active_tiles=!1)}}(this)),this.render(),this},LeftRail.prototype.render=function(){var $oldList;return null!=this.collection.active_env&&"collection"===this.collection.active_env?this.renderTimeCollection():($oldList=this.$scroll_container.find(".article-list"),$oldList.length?$oldList.replaceWith(this.$el):this.$el.insertAfter("#section-sub-ad"),Time.application.load_tabs(Time.tab_data["default"]),Time.application.tabs_view.set_active(0),Time.application.resizeContent(),null!=this.collection.active_env&&(this.$el.parents("#rail-articles").toggleClass("magazine_rail","magazine"===this.collection.active_env),this.$el.parents("#rail-articles").toggleClass("collection_rail","collection"===this.collection.active_env)),this)},LeftRail.prototype.renderTimeCollection=function(){return this.setElement(".article-list"),this.$el.insertAfter(".article-list"),this.$el.parents("#rail-articles").addClass("collection_rail"),this.$(".leftRailModule--collapsible").each(function(_this){return function(index,el){var $collapsibleEl,collapsible;return $collapsibleEl=$(el),collapsible=new Time.views.CollapsibleModule({collection:_this.collection,parent:_this,$el:$collapsibleEl,isExpanded:$collapsibleEl.hasClass("leftRailModule--collapsible--expanded")}),$(el).data("collapsible",collapsible)}}(this)),this},LeftRail.prototype.fill_viewport=function(){return this.scrollContainer.scrollHeight<=Time.application.$body.height()-Time.application.$main_header.height()?(this.collection.fetch_next_page(),setTimeout(function(_this){return function(){return _this.fill_viewport()}}(this),100)):this.trigger("viewport_filled"),this},LeftRail.prototype.scroll_limit_message=function(){var $message;if(0===$(".response-eot").length)return $message=$("<a />",{"class":"meta response-eot"}),"magazine"===Time.curRoute.env?$message.attr("href","http://content.time.com/time/magazine/").html("Read more articles in the "+Time.curRoute.env+" archive"):"money"===Time.branding?$message.attr("href","/money/").html("Get the latest news on Money.com's home page"):$message.attr("href","/").html("Get the latest news on TIME's home page"),$message.appendTo(this.$el),this},LeftRail.prototype.show_loader=function(){return this.$scroll_container.addClass("fetching"),this},LeftRail.prototype.hide_loader=function(){return this.$scroll_container.removeClass("fetching"),this},LeftRail.prototype.show_loader_error=function(){var $load_error,$manual_fetch;return $load_error=$("<p></p>").addClass("meta response-error").html("The requested content could not be loaded.").appendTo(this.$el),$manual_fetch=$("<a></a>").addClass("manual-fetch").html("Try now").attr("href","javascript:void(0)").one("click",function(_this){return function(){return _this.collection.fetch()}}(this)).appendTo($load_error),this.listenToOnce(this.collection,"sync:syncing",this.remove_loader_error),this},LeftRail.prototype.remove_loader_error=function(){return $(".response-error").remove(),this},LeftRail.prototype.isRailAtEnd=function(){return this.scrollContainer?this.$scroll_container.scrollTop()+this.$scroll_container.innerHeight()>=this.scrollContainer.scrollHeight:!0},LeftRail.prototype.isRailFullyVisible=function(){return this.scrollContainer?this.scrollContainer.scrollHeight<=this.$scroll_container.innerHeight():!1},LeftRail.prototype.freeze_scroll=function(){return this.scroll_freeze=!0,this},LeftRail.prototype.release_scroll=function(){return this.scroll_freeze=!1,this},LeftRail.prototype.bindScroll=function(){return this.$scroll_container.scroll(function(_this){return function(){_this.isRailAtEnd()?_this.$scrollForMore.hide():Time.application.model.get("isRailOpen")&&_this.$scrollForMore.show().appendTo("body"),Time.trigger("leftRail:scroll",_this)}}(this)),this},LeftRail.prototype.getAdsInViewport=function(){var $adEls,$adsInViewport;return Time.tgxAdapter.ENABLED?($adEls=$(".ad-unit").add("#sub-ad"),$adsInViewport=_.filter($adEls,function(_this){return function($el){return _this.isAdInViewport($el,!0)}}(this))):[]},LeftRail.prototype.isAdInViewport=function($el,isAllowPartial){var rect,_ref;return $el instanceof jQuery||($el=$($el)),$el.length<=0?!1:(rect=(null!=(_ref=$el.get(0))?_ref.getBoundingClientRect():void 0)||{bottom:0,height:0,left:0,right:0,top:0,width:0},this.isHorizontallyVisible(rect.left)?isAllowPartial?this.isFullyVisible(rect.top,rect.bottom)||this.isPartiallyVisible(rect.top,rect.bottom):this.isFullyVisible(rect.top,rect.bottom):!1)},LeftRail.prototype.isHorizontallyVisible=function(val){return val>=0},LeftRail.prototype.isFullyVisible=function(elTop,elBottom){return this.isBelowViewportTop(elTop)&&this.isAboveViewportBottom(elBottom)},LeftRail.prototype.isPartiallyVisible=function(elTop,elBottom){return this.isTopCutOff(elTop,elBottom)||this.isBottomCutOff(elTop,elBottom)},LeftRail.prototype.isTopCutOff=function(elTop,elBottom){return this.isAboveViewportTop(elTop)&&this.isBelowViewportTop(elBottom)},LeftRail.prototype.isBottomCutOff=function(elTop,elBottom){return this.isAboveViewportBottom(elTop)&&this.isBelowViewportBottom(elBottom)
},LeftRail.prototype.isAboveViewportTop=function(val){return val<Time.application.left_rail_top},LeftRail.prototype.isAboveViewportBottom=function(val){return val<=Time.application.left_rail_bottom},LeftRail.prototype.isBelowViewportTop=function(val){return val>=Time.application.left_rail_top},LeftRail.prototype.isBelowViewportBottom=function(val){return val>Time.application.left_rail_bottom},LeftRail.prototype.render_author_header=function(data){var $html,template;return null==data&&(data={}),template=Time.templates["rail-header-author"],$html=$(template.render(data)),$html.prependTo(this.$el),this},LeftRail.prototype.render_section_header=function(data){var $html,template;return null==data&&(data={}),template=Time.templates["section-description"],$html=$(template.render(data)),$html.prependTo(this.$el),this},LeftRail.prototype.render_topic_header=function(data){var $html,template;return null==data&&(data={}),template=Time.templates["rail-header-topic"],$html=$(template.render(data)),$html.prependTo(this.$el),this},LeftRail.prototype.render_topic_header_embed=function(embed){return $(embed).prependTo(this.$el),null!=this.$("#ad-unit-0")&&(Time.trigger("dfpAdManager:renderLeftRailAd","ad-unit-0"),"desktop"!==Time.device&&setTimeout(function(_this){return function(){return null!=_this.collection?_this.$scroll_container.trigger("scroll"):void 0}}(this),500)),this},LeftRail.prototype.render_collection_header=function(data){var html;return null==data&&(data={}),"undefined"!=typeof console&&null!==console&&console.log("views/rail -- render collection header: ",data),html=Time.templates["top-header"].render(data),Time.application.$top_banner.html(html),this},LeftRail.prototype.render_header=function(copy,tile_position){var $header_el;return null==copy&&(copy="Most Read"),null==tile_position&&(tile_position=0),$header_el=$("<h3/>",{"class":"rail-list-heading"}).text(copy),null!=this.models&&this.models[tile_position]?$header_el.insertBefore(this.collection.models[tile_position].views.tile_view.$el):$header_el.appendTo(this.$el),this},LeftRail.prototype.appendAd=function(afterEl){var $ad,id,index;return this.collection.ad_in_left_rail+=1,index=this.collection.ad_in_left_rail,id="ad-unit-"+index,$ad=$("<div/>",{"class":"ad-unit",id:id,pos:index}).insertAfter(afterEl),this.collection.length<=5&&$(".rail-articles-scroll").addClass("limited-articles"),id},LeftRail.prototype.collectionIntroButton=function(e){var $button,$tooltip;$button=$(e.currentTarget),$tooltip=$("#section-description").find(".button__tooltip"),"function"==typeof omniTrackEv&&omniTrackEv("submit"),"none"===$tooltip.css("display")?$tooltip.css("display","block"):$tooltip.css("display","none")},LeftRail}(Backbone.View);var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.LiveFyre=function(_super){function LiveFyre(){return this.renderComments=__bind(this.renderComments,this),this.toggleComments=__bind(this.toggleComments,this),LiveFyre.__super__.constructor.apply(this,arguments)}return __extends(LiveFyre,_super),LiveFyre.prototype.el=document,LiveFyre.prototype.events={"click .toggle-comments":"toggleComments"},LiveFyre.prototype.LIVEFYRE_SITE_ID=314099,LiveFyre.prototype._authDelegate=null,LiveFyre.prototype.initialize=function(options){return null==options&&(options={}),this.app=options.app,this.listenTo(Time,"article:activated",function(_this){return function(){_this.render()}}(this)),this.listenTo(Time,"article:comments",function(_this){return function(article){return _this.showComments($("article"),article.get("id"),article.get("url"),article.get("title"))}}(this)),this},LiveFyre.prototype.render=function(){return this.app.model.get("isPrintMode")?void 0:("undefined"!=typeof LF&&null!==LF&&LF.CommentCount({replacer:function(el,count){return $(el).removeClass("livefyre-commentcount").html(count)}}),this)},LiveFyre.prototype.toggleComments=function(e){var $article,$el,footer_pos,id,title,url,_ref;$el=$(e.target),$article=$el.parents("article").eq(0),$el.removeAttr("data-event"),($el.parents(".article-sub-headline").length||$el.parents(".social-links-tooltip").length)&&$el.parents("article").find(".article-footer").length&&((null!=(_ref=this.app.model.get("activeArticle"))?_ref.views.singleView.$el.is(":last-child"):void 0)&&this.app.active_rail.show_next_article(),footer_pos=$el.parents("article").find(".article-footer").offset().top-this.app.$viewport.offset().top+Math.abs(this.app.infinite_scroll.position),this.app.reset_scroll(footer_pos),$article.hasClass("comments-shown"))||($article.hasClass("comments-shown")?(this.hideComments($article),$article.removeClass("comments-shown")):($article.addClass("loading-comments"),id=$el.parents(".article-item").length?$el.parents("article").data("article"):$el.data("lf-article-id"),url=$el.data("url"),title=$el.data("title"),this.showComments($article,id,url,title)))},LiveFyre.prototype.showComments=function($article,articleId,url,title){return yepnope([{test:window.fyre,nope:["http://zor.livefyre.com/wjs/v3.0/javascripts/livefyre.js","http://time.ep.livefyre.com/media/dGltZS5lcC5saXZlZnlyZS5jb20=/javascripts/customprofiles.js"],complete:function(_this){return function(){return _this.renderComments($article,articleId,url,title)}}(this)}]),this},LiveFyre.prototype.renderComments=function($article,articleId,url,title){var cfg,lf_config;return $article.hasClass("comments-rendered")?($article.find(".livefyre-comment").show(),$article.addClass("comments-shown"),!1):($article.addClass("comments-rendered"),this._authDelegate||(this._authDelegate=new fyre.conv.SPAuthDelegate({engage:{app:"time.auth.fyre.co"}})),cfg={network:"time.fyre.co",authDelegate:this._authDelegate,string:{follow:"+Follow Conversation"}},lf_config={app:"main",articleId:articleId,collectionMeta:{articleId:articleId,url:url,title:title},el:"livefyre-"+articleId,postToButtons:["tw","fb","li"],signed:!1,siteId:this.LIVEFYRE_SITE_ID},void fyre.conv.load(cfg,[lf_config],function(widget){return widget.on("commentCountUpdated",function(number){return $article.find(".time-icons-comment").html(number)}),$article.addClass("comments-shown")}))},LiveFyre.prototype.hideComments=function($article){return $article.find(".livefyre-comment").hide(),this},LiveFyre}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.MasonryPageView=function(_super){function MasonryPageView(){return MasonryPageView.__super__.constructor.apply(this,arguments)}return __extends(MasonryPageView,_super),MasonryPageView.prototype.el="body",MasonryPageView.prototype.events={"click .collection-intro a.button":"collectionIntroButton","click .footer__back-to-top":"backToTop"},MasonryPageView.prototype.$container=$("#article-container"),MasonryPageView.prototype.$subheader=$(".subheaderWrapper"),MasonryPageView.prototype.$notHeader=$("#notTheHeader"),MasonryPageView.prototype.$window=$(window),MasonryPageView.prototype.$main_header=$(".main-header"),MasonryPageView.prototype.$footer=$(".site-footer"),MasonryPageView.prototype.$topBanner=$(".top-banner"),MasonryPageView.prototype.lastScrollPosition=0,MasonryPageView.prototype.initialize=function(params){var $container,bootstrap,debounceOnScroll;switch($container=this.$container,Time.application.hasPushstate||this.ie9Shiv(),params.tax){case"section":bootstrap=Time.bootstrap.section[params.sub],bootstrap.endpoint="section/"+params.sub+"/";break;case"tag":bootstrap=Time.bootstrap.tag.photography,bootstrap.endpoint="photography/";break;case"collection":bootstrap=this.parseCollection(Time.bootstrap.collection)}return bootstrap.tax=params.tax,this.renderHeader(bootstrap),this.masonryCollection=new Time.collections.MasonryCollection(bootstrap.articles,{bootstrap:bootstrap,view:this}),$container.isotope({itemSelector:".article-masonry",masonry:{columnWidth:300,gutter:25}}),$container.isotope("unbindResize"),"collection"!==bootstrap.tax&&this.initInfiniteScroll(),Time.Tracking.article_view(bootstrap),this.toggleNavDataEvent(),this.listenTo(Time,"application:resize",function(_this){return function(){return _this.timerID&&clearTimeout(_this.timerID),_this.timerID=setTimeout(function(){return _this.masonryCollection.resizeHandler()},500)}}(this)),this.listenTo(this.masonryCollection,"masonryCollection:reached-ceiling",function(_this){return function(){return _this.$footer.css("display","block"),$(".footer__back-to-top").css("display","block"),_this.$(".masonry__loading").hide()}}(this)),this.$container.width()<Time.application.breakpoints.small.size?(debounceOnScroll=_.debounce(function(_this){return function(){return _this.onScroll()}}(this),10),void this.listenTo(Time,"readingPane:scrolled",function(){return debounceOnScroll()})):this},MasonryPageView.prototype.initInfiniteScroll=function(){return this.infinite_scroll=new Time.component.InfiniteScroll({parentEl:Time.application.$notHeader,contentEl:Time.application.$viewport,threshold:800,onDown:this.fetchNextPage,onUp:null,context:this}),this},MasonryPageView.prototype.fetchNextPage=function(){return this.masonryCollection.fetch({remove:!1,next_page:!0})},MasonryPageView.prototype.parseCollection=function(collection){return collection.articles=[],_.each(collection.hubs,function(hub){return _.each(hub.articles,function(article){return article.post_type="time_collection_post"===article.post_type?"post":article.post_type,collection.articles.push(article)})}),collection},MasonryPageView.prototype.addAll=function(articles){var $articles,$container;return $container=this.$container,$articles=articles,$container.append($articles),_.defer(function(_this){return function(){return $articles.removeClass("hidden"),$container.data("isotope").appended($articles),_this.trigger("masonryView:appended")}}(this))},MasonryPageView.prototype.renderHeader=function(bootstrap){var $title;if("collection"===bootstrap.tax)return $title=this.$topBanner.find(".top-header-title"),null==bootstrap.intro_deck&&$title.addClass("no-intro"),$title.html().length>15&&$title.css("font-size","2.65em"),$title.css("display","block")},MasonryPageView.prototype.collectionIntroButton=function(e){var $button,$tooltip;return $button=$(e.currentTarget),$tooltip=$(".collection-intro").find(".button__tooltip"),"undefined"!=typeof omniTrackEv&&omniTrackEv("submit"),"none"===$tooltip.css("display")?$tooltip.css("display","block"):$tooltip.css("display","none")},MasonryPageView.prototype.backToTop=function(){return this.$notHeader.animate({scrollTop:0},"slow")},MasonryPageView.prototype.onScroll=function(){var $parentEl,contentHeight,currentScrollPosition;return $parentEl=Time.application.$notHeader,currentScrollPosition=$parentEl.scrollTop(),Math.abs(this.lastScrollPosition-currentScrollPosition)<=5?void 0:(currentScrollPosition>this.lastScrollPosition?this.$el.removeClass("nav-down").addClass("nav-up"):(currentScrollPosition+$parentEl.height()<Time.application.$viewport.height()||0>=currentScrollPosition)&&this.$el.removeClass("nav-up").addClass("nav-down"),contentHeight=this.$window.height()-(this.$main_header.outerHeight(!0)+this.$main_header.offset().top),$parentEl.height(contentHeight),this.lastScrollPosition=currentScrollPosition)},MasonryPageView.prototype.ie9Shiv=function(){return $("body").removeClass("hidden"),Time.trigger("application:resize")},MasonryPageView.prototype.toggleNavDataEvent=function(){return $(".left-rail-header .main-nav").on("shown",function(){return $(".left-rail-header .header-nav-button").attr("data-event","nav-expose")}),$(".left-rail-header .main-nav").on("hidden",function(){return $(".left-rail-header .header-nav-button").removeAttr("data-event")})},MasonryPageView}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.ParentsLanding=function(_super){function ParentsLanding(){return ParentsLanding.__super__.constructor.apply(this,arguments)}return __extends(ParentsLanding,_super),ParentsLanding.prototype.el="body",ParentsLanding.prototype.events={"click .parent-sub-menu":"show_menu"},ParentsLanding.prototype.initialize=function(options){return null==options&&(options={}),this.app=options.app,this.app.model.set("isInitialRoute",!1),Time.trigger("parents:ads:activate",".parents_ads"),this.$stories=$(".sub-nav ul"),this.$parentsToggle=$(".parent-sub-menu"),this.render(),this},ParentsLanding.prototype.render=function(){var parentsToggleOffset;return"mobile"===Time.device&&(this.$stories.addClass("collapse"),this.$parentsToggle.css("top",this.app.sizes.headerBottom),parentsToggleOffset="mobile"===Time.device?this.$parentsToggle.outerHeight(!0):0,this.$stories.css("top",this.app.sizes.headerBottom+parentsToggleOffset).css("display","block")),this},ParentsLanding.prototype.show_menu=function(){this.$stories.toggleClass("collapse"),this.$stories.toggleClass("expand")},ParentsLanding}(Backbone.View);var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.PromoTray=function(_super){function PromoTray(){return this.resize=__bind(this.resize,this),this.render=__bind(this.render,this),this.setupTray=__bind(this.setupTray,this),PromoTray.__super__.constructor.apply(this,arguments)}return __extends(PromoTray,_super),PromoTray.prototype.template=Time.templates["promo-tray"],PromoTray.prototype.events={"click .title":"togglePromoTray"},PromoTray.prototype.initialize=function(options){var $el,html,_ref;null==options&&(options={}),this.app=options.app,"desktop"===Time.device&&null!=(null!=(_ref=Time.bootstrap)?_ref.promo_tray:void 0)&&(this.model=Time.bootstrap.promo_tray,html=this.template.render(this.model),$el=$(html),this.setElement($el),this.listenTo(Time,"application:resize",this.resize),this.listenTo(Time,"router:route",this.setupTray))},PromoTray.prototype.setupTray=function(){"magazine"===this.app.active_route&&this.listenToOnce(Time,"article:activated",this.render)},PromoTray.prototype.render=function(){return this.$el.appendTo(this.app.$body),setTimeout(function(_this){return function(){_this.resize(),_this.$el.removeClass("invisible"),setTimeout(function(){_this.$el.removeClass("collapsed")},400),setTimeout(function(){_this.$el.addClass("collapsed")},3e4)}}(this),1e3),this},PromoTray.prototype.resize=function(){var offset,_ref;(null!=(_ref=this.app.$left_rail)?_ref.length:void 0)&&(offset=this.app.$left_rail.offset().left>=0?this.app.$left_rail.width():0,offset+=this.app.$viewportWrapper.width()/2-this.$el.width()/2,this.$el.css("left",offset))},PromoTray.prototype.togglePromoTray=function(e){e.preventDefault(),this.$el.toggleClass("collapsed")},PromoTray}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.ReadingPaneArticle=function(_super){function ReadingPaneArticle(){return ReadingPaneArticle.__super__.constructor.apply(this,arguments)}var TEMPLATE_FORMAT_MAP;return __extends(ReadingPaneArticle,_super),ReadingPaneArticle.prototype.template=Time.templates["article-single"],ReadingPaneArticle.prototype.el=null,TEMPLATE_FORMAT_MAP={list:"article-single-list",gallery:"article-single-gallery",video:"article-single-video",collection_intro:"collection-intro","section-front":"section-front"},ReadingPaneArticle.prototype.initialize=function(options){return null==options&&(options={}),ReadingPaneArticle.__super__.initialize.apply(this,arguments),this.model.set("check_scroll",!0),this.initializeEl(Time.application.$viewportWrapper),this.galleriesCollection=new Time.collections.Galleries([],{article:this}),this.collectPrimaryGallery(),this.collectGalleries(),this.collectListGalleries(),this.detectVideos(),this.model.twitterWidgets=this.$(".twitter-tweet:not(.twitter-tweet-rendered)").removeClass("twitter-tweet").addClass("twitter-widget"),this.listenTo(this.model,"change:isActive",function(_this){return function(model,value){return"undefined"!=typeof console&&null!==console&&console.info("ReadingPaneArticleView heard change:isActive on model, isActive:",value),value?_this.activateView():_this.deactivateView()}}(this)),this},ReadingPaneArticle.prototype.initializeEl=function($parent){var $existing,html;return $existing=$parent.find("#article-"+this.model.id),$existing.length&&""!==$existing.html()?this.setElement($existing):(this.getTemplate(),html=this.template.render(this.model.toJSON(),Time.partials),this.setElement($(html))),this.el},ReadingPaneArticle.prototype.collectPrimaryGallery=function(){var galleryData,galleryModel;return galleryData=this.model.get("gallery"),null!=galleryData?(this.galleriesCollection.add(galleryData),galleryModel=this.galleriesCollection.get(galleryData.id),galleryModel.set("isPrimary",!0),this):void 0},ReadingPaneArticle.prototype.collectGalleries=function(){var galleriesData;return galleriesData=this.model.get("galleries"),null!=galleriesData?(this.galleriesCollection.add(galleriesData),this):void 0},ReadingPaneArticle.prototype.collectListGalleries=function(){var li;return li=this.model.get("list_items"),null!=li?(_.each(li,function(_this){return function(item){var _ref;return(null!=(_ref=item.galleries)?_ref.length:void 0)?_.each(item.galleries,function(listItemGalleryModel){return _this.galleriesCollection.add(listItemGalleryModel)}):void 0}}(this)),this):void 0},ReadingPaneArticle.prototype.detectVideos=function(){var $videoWrappers;$videoWrappers=this.$(".video-wrapper"),this.model.set("totalVideos",$videoWrappers.length)},ReadingPaneArticle.prototype.getRightRailModules=function(){var _this;return this.rightRailHeight=0,_this=this,this.$(".right-rail-module").each(function(index){return $(this).hasClass("rr-share")?void 0:(0===index&&(_this.rightRailHeight+=$(this).position().top),_this.rightRailHeight+=$(this).outerHeight(!0))})},ReadingPaneArticle.prototype.getTemplate=function(){var templateName;return null!=this.model.get("cover")?(this.template=Time.templates["article-single-cover"],this.template):null!=this.model.get("sponsor")?(this.template=Time.templates["article-single-sponsored"],this.template):_.has(TEMPLATE_FORMAT_MAP,this.model.get("format"))?(templateName=TEMPLATE_FORMAT_MAP[this.model.get("format")],this.template=Time.templates[templateName],this.template):Time.templates["article-single"]},ReadingPaneArticle.prototype.render=function(opts){var $existingEl,html;return null==opts&&(opts={}),$existingEl=Time.application.$viewportWrapper.find("#article-"+this.model.id),this.$el.html().length||($existingEl.length&&""!==$existingEl.html()?(this.setElement($existingEl),Time.application.readingPane.articleViews.push(this.model.views.singleView)):(this.getTemplate(),html=this.template.render(this.model.toJSON(),Time.partials),this.setElement($(html)))),null!=opts.method?"append"===opts.method?(Time.application.$viewportWrapper.append(this.$el),Time.application.readingPane.articleViews.push(this)):"prepend"===opts.method&&(Time.application.$viewportWrapper.prepend(this.$el),Time.application.readingPane.articleViews.push(this),Time.application.$notHeader.scrollTop(this.$el.outerHeight()),this.model.set("prepended",!0)):(Time.application.$viewportWrapper.html(this.$el),Time.application.readingPane.articleViews=[this],Time.trigger("readingPane:reset",this.model)),this.model.get("last_article")&&this.$el.addClass("collection-article__last"),"section-front"!==this.model.get("format")&&this.renderDivider(),"list"===this.model.get("format")&&this.renderLists(),this.model.trigger("article:rendered"),this},ReadingPaneArticle.prototype.renderHeroImage=function(){var recursive_count,this_img;return this_img=this.$(".portrait img, .landscape img, .bleed img, .wide img"),recursive_count=0,this},ReadingPaneArticle.prototype.renderListsGallery=function(){var articleIndex,nextArticle,onBegin,onCarouselInit,onEnd,onSlideChange,prevArticle;this.$(".list-gallery__tools").show(),articleIndex=Time.application.active_rail.models.indexOf(this.model),nextArticle=Time.application.active_rail.getNextListArticle(articleIndex),prevArticle=Time.application.active_rail.getPrevListArticle(articleIndex),nextArticle&&(onEnd=function(){return Time.application.router.navigate(Time.application.stripBaseUrl(nextArticle.get("url")),!0)}),prevArticle&&(onBegin=function(){return Time.application.router.navigate(Time.application.stripBaseUrl(prevArticle.get("url")),!0)}),this.$(".list-gallery__nextButton").on("click",function(_this){return function(){return _this.model.listGallery.slickCurrentSlide()===_this.$(".article-items li").length-1&&onEnd?onEnd():_this.model.listGallery.slickNext()}}(this)),this.$(".list-gallery__prevButton").on("click",function(_this){return function(){return 0===_this.model.listGallery.slickCurrentSlide()&&onBegin?onBegin():_this.model.listGallery.slickPrev()}}(this)),this.listenTo(Time,"application:orientationchange",function(_this){return function(){return Time.application.$window.width()>770&&Time.application.$window.width()<1026?_this.model.get("list_gallery_style")?_this.model.trigger("list:toggleView",!0):_this.$(".list-gallery__tools").hide():Time.application.$window.width()>600?_this.$(".list-gallery__tools").show():void 0}}(this)),onSlideChange=function(_this){return function(slider,currentIndex,targetIndex){var $passedAdSlides,omniData,_ref;return omniData=null!=(_ref=Time.application.model.get("activeArticle"))?_ref.toJSON():void 0,omniData.userAction="list-gallery",Time.Tracking.article_view(omniData),Time.trigger("dfpAdManager:reloadLeftRailAds"),$passedAdSlides=_this.$(".list_ad").filter(function(){return $(this).attr("index")<targetIndex}),_this.$(".list-gallery__counter--current").html(targetIndex+1-$passedAdSlides.length),_this.$(".list_ad[index="+targetIndex+"]").length?_this.$(".list-gallery__counter").addClass("offScreen"):_this.$(".list-gallery__counter").removeClass("offScreen"),_this.$(".list-gallery__prevButton, .list-gallery__nextButton").removeClass("disabled"),0!==targetIndex||onBegin||_this.$(".list-gallery__prevButton").addClass("disabled"),targetIndex!==_this.$(".article-items li").length-1||onEnd?void 0:_this.$(".list-gallery__nextButton").addClass("disabled")}}(this),onCarouselInit=function(_this){return function(slider){var $passedAdSlides;return _this.model.get("prepended")&&(_this.model.set("prepended",!1),Time.application.$notHeader.scrollTop(_this.$el.outerHeight())),$passedAdSlides=_this.$(".list_ad").filter(function(){return $(this).attr("index")<slider.currentSlide}),_this.$(".list-gallery__counter--current").html(slider.currentSlide+1-$passedAdSlides.length),0!==slider.currentSlide||onBegin?void 0:_this.$(".list-gallery__prevButton").addClass("disabled")}}(this),this.model.listGallery=this.$(".article-items").slick({adaptiveHeight:!0,arrows:!1,infinite:!1,initialSlide:this.model.get("slug")?this.$("[data-item-slug='"+this.model.get("slug")+"']").index():0,onBeforeChange:onSlideChange,onInit:onCarouselInit,slide:"li",onEnd:onEnd,onBegin:onBegin}),this.$(".article-items").imagesLoaded(function(_this){return function(){var _ref;return null!=(_ref=_this.model.listGallery)?_ref.slickSetHeight():void 0}}(this)),twttr.events.bind("rendered",function(_this){return function(){var _ref;return null!=(_ref=_this.model.listGallery)?_ref.slickSetHeight():void 0}}(this))},ReadingPaneArticle.prototype.renderLists=function(){var wW,_ref;return this.stopListening(this.model,"list:toggleView"),null!=(_ref=this.model.listGallery)&&_ref.unslick(),wW=Time.application.$window.width(),(600>wW||wW>770&&1026>wW)&&(this.$el.removeClass("list-gallery-mode"),this.model.set("list_gallery_style",!1)),this.$(".list-gallery__toggle").on("click",function(_this){return function(e){return e.stopPropagation(),_this.model.trigger("list:toggleView")}}(this)),this.listenToOnce(this.model,"list:toggleView",function(_this){return function(hideToggle){var html,_ref1;return null==hideToggle&&(hideToggle=!1),_this.$el.toggleClass("list-gallery-mode"),null!=(_ref1=_this.model.listGallery)&&_ref1.unslick(),_this.model.set("list_gallery_style",!_this.model.get("list_gallery_style")),_this.model.get("list_gallery_style")||"function"==typeof omniTrackEv&&omniTrackEv("viewaslist"),_this.$(".list-gallery__toggle").off("click"),_this.getTemplate(),html=_this.template.render(_this.model.toJSON(),Time.partials),_this.$el.html($(html)),hideToggle||_this.$(".list-gallery__tools").show(),_this.renderLists()}}(this)),Time.trigger("article:renderAds",this.model),this.model.get("list_gallery_style")&&this.renderListsGallery(),this},ReadingPaneArticle.prototype.renderBrightcoveVideos=function(){var renderDelay;return 0===this.$(".primary-video-wrapper").length&&Time.trigger("article:found:noPrimaryBrightcove"),renderDelay=$("body").hasClass("desktop")?0:3e3,this.brightcoveRenderTimeout=setTimeout(function(){try{return"undefined"!=typeof brightcove&&null!==brightcove?brightcove.createExperiences():void 0}catch(_error){}},renderDelay),this},ReadingPaneArticle.prototype.renderGalleries=function(){return this.$galleries=this.$("div[data-gallery]"),console.info("ReadingPaneArticleView -- renderGalleries "+this.$galleries.length),this.model.get("galleriesRendered")===this.$galleries.length?(console.info("ReadingPaneArticle - "+this.$galleries.length+" galleries already rendered"),this):(this.$galleries.each(function(_this){return function(i,el){var galleryParentView;return galleryParentView=new Time.views.GalleryParent({el:el,article:_this,galleries:_this.galleriesCollection}),_this.getRightRailModules(),$(el).position().top>_this.rightRailHeight?$(el).addClass("galleryContainer--fullwidth"):void 0}}(this)),this)},ReadingPaneArticle.prototype.renderDivider=function(){return Time.application.model.get("isPrintMode")?void 0:(console.info("-- ReadingPaneArticleView -- renderDivider"),null!=this.divider&&(this.divider.destroy(),this.divider=null,delete this.divider),this.divider=new Time.views.Divider({article:this}),this.$el.append(this.divider.render().el),this)},ReadingPaneArticle.prototype.refreshOutbrain=function(){var renderOutbrain;return renderOutbrain=_.debounce(function(_this){return function(){var $outbrainWidgets;$outbrainWidgets=_this.$(".OUTBRAIN"),$outbrainWidgets.each(function(){try{return OBR.extern.refreshSpecificWidget($(this).attr("id").replace("outbrain_widget_",""))}catch(_error){}});try{return OBR.extern.researchWidget()}catch(_error){}}}(this),250),this.model.get("isActive")?renderOutbrain():void 0},ReadingPaneArticle.prototype.deactivateView=function(){var renderedTwitterWidgets,twitterWidgets;return this.stopListening(this.model,"change:componentsToRender"),this.$el.removeClass("active"),twitterWidgets=this.model.twitterWidgets,twitterWidgets.each(function(){return $(this).removeAttr("data-twttr-rendered").removeClass("twitter-tweet")}),renderedTwitterWidgets=this.$(".twitter-tweet-rendered"),renderedTwitterWidgets.each(function(index){return $(this).replaceWith(twitterWidgets[index])}),null!=this.brightcoveRenderTimeout&&clearTimeout(this.brightcoveRenderTimeout),this.brightcoveRenderTimeout=null,this.stopListening(this,"gallery:slides:rendered"),this.galleriesCollection.trigger("galleries:flush"),this.model.set("galleriesRendered",0),Time.trigger("article:deactivated",this),this},ReadingPaneArticle.prototype.activateView=function(){var $w,componentsToRender,_ref;return Time.Tracking.article_view(this.model.toJSON()),this.$(".divider-advert").height("auto"),this.$el.removeClass("offScreen"),this.$el.addClass("active"),$w=$(window),this.model.get("scripts")?Modernizr.load({load:this.model.get("scripts"),complete:function(_this){return function(){var i,l,scripts;return scripts=_this.model.get("scripts"),l=scripts.length,i=0,$w.trigger("post-load",{el:_this.$el})}}(this)}):$w.trigger("post-load",{el:this.$el}),this.loadChartbeat(),this.$(".twitter-widget").addClass("twitter-tweet"),"undefined"!=typeof twttr&&null!==twttr&&null!=(_ref=twttr.widgets)&&_ref.load(),this.renderHeroImage(),this.renderBrightcoveVideos(),this.refreshOutbrain(),this.model.set("componentsToRender",1),this.listenTo(this.model,"change:componentsToRender",function(){console.info("-- components left to render: ",this.model.get("componentsToRender")),0===this.model.get("componentsToRender")&&(this.stopListening(this.model,"change:componentsToRender"),Time.trigger("article:activated",this))}),this.renderComponent("galleriesRendered",this.galleriesCollection.size(),"gallery:slides:rendered")&&this.renderGalleries(),componentsToRender=this.model.get("componentsToRender"),this.model.set("componentsToRender",--componentsToRender),this},ReadingPaneArticle.prototype.renderComponent=function(counter,total,listener){return total?(this.model.set("componentsToRender",this.model.get("componentsToRender")+1),this.listenTo(this,listener,function(_this){return function(){var componentsToRender,newCount;newCount=_this.model.get(counter)+1,_this.model.set(counter,newCount),"undefined"!=typeof console&&null!==console&&console.info("-- ReadingPaneArticle - rendered ",newCount," out of ",total,listener," components"),newCount===total&&(_this.stopListening(_this,listener),componentsToRender=_this.model.get("componentsToRender"),_this.model.set("componentsToRender",--componentsToRender))}}(this)),!0):!1},ReadingPaneArticle.prototype.loadChartbeat=function(){var authors,i,sections,the_authors,the_authors_length,the_section,title,url,zone;if(the_section=this.model.get("section"),sections=the_section?the_section.slug:the_section,zone=sections,url=this.model.get("url"),title=this.model.get("title"),the_authors=this.model.get("authors"),the_authors_length=the_authors?the_authors.length:0){for(i=0,authors=[];the_authors_length>i;)authors.push(the_authors[i].name),i+=1;authors=authors.join()}return Time.trigger("article:chartbeat",url,title,sections,zone,authors),this},ReadingPaneArticle.prototype.unbind_events=function(){return $(window).off(".article-single-"+this.cid)},ReadingPaneArticle.prototype.jump_to_item=function(item_slug){var $item,item_offset_top;if(!this.model.get("list_gallery_style"))return $item=this.$("[data-item-slug='"+item_slug+"']"),$item.length?(item_offset_top=$item.offset().top,"complete"!==document.readyState?window.onload=function(){return Time.application.reset_scroll(item_offset_top)}:Time.application.reset_scroll(item_offset_top),$item):!1},ReadingPaneArticle}(Backbone.View);var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.ReadingPane=function(_super){function ReadingPane(){return this.onResize=__bind(this.onResize,this),ReadingPane.__super__.constructor.apply(this,arguments)}return __extends(ReadingPane,_super),ReadingPane.prototype.articleViews=[],ReadingPane.prototype.ACTIVE_THRESHOLD=.25,ReadingPane.prototype.initialize=function(options){return null==options&&(options={}),this.app=options.app,this.listenTo(Time,"leftRail:flush",function(_this){return function(){_this.articleViews.length=0
}}(this)),this.listenTo(Time,"leftRail:tile:clicked",function(_this){return function(){_this.articleViews.length=0}}(this)),this},ReadingPane.prototype.onResize=function(){this._activeLine=this.app.$body.height()*this.ACTIVE_THRESHOLD,this.resizeCollectionBanner()},ReadingPane.prototype.destroyBanners=function(){var orientationEvent,viewportWrapperEl,_ref;$(".topic-banner").html(""),null!=this.$collectionBannerWrapper&&(this.app.$body.removeClass("has-collection-banner"),null!=(_ref=this.collectionBannerTether)&&_ref.destroy(),orientationEvent=this.app.orientationEvent+".collection_banner_wrapper",this.app.$window.off(orientationEvent),this.$collectionBannerWrapper.remove(),Modernizr.touch&&(viewportWrapperEl=this.app.$viewportWrapper.get(0),viewportWrapperEl.removeEventListener("touchstart",viewportWrapperEl.onTouchStart_ref),viewportWrapperEl.removeEventListener("touchmove",viewportWrapperEl.onTouchMove_ref)))},ReadingPane.prototype.render=function(){this._activeLine=this.app.$body.height()*this.ACTIVE_THRESHOLD,this.$el.on("click",".read-video-article",this.showCollapsibleArticleContents),this.listenTo(Time,"collection:banner:init",function(_this){return function(){return _this.initCollectionBanner()}}(this)),this.listenTo(Time,"topic:banner:init",function(_this){return function(data){return _this.initTopicBanner(data)}}(this)),this.listenTo(Time,"env:init",function(_this){return function(){return _this.destroyBanners()}}(this)),this.listenTo(Time,"pushdown:loaded pushdown:modified",function(_this){return function(){return _this.resizeCollectionBanner()}}(this)),this.listenTo(Time,"application:resize",this.onResize)},ReadingPane.prototype.resizeCollectionBanner=function(){var _ref;null!=this.$collectionBannerWrapper&&(this.$collectionBannerWrapper.width(this.app.$viewportWrapper.width()),null!=(_ref=this.collectionBannerTether)&&_ref.position())},ReadingPane.prototype.initCollectionBanner=function(){var $collectionBannerClone,collectionBannerTetherOptions,data,html,orientationEvent;if(0===$("#collection_hub_banner_wrapper").length)return this.app.$body.addClass("has-collection-banner"),data=Time.bootstrap.collection,html=Time.templates["collections-banner"].render(data),this.$el.prepend(html),this.$collectionBannerWrapper=$("#collection_hub_banner_wrapper"),this.resizeCollectionBanner(),collectionBannerTetherOptions={enabled:!0,element:"#collection_hub_banner_wrapper",target:".article-viewport",attachment:"top left",targetAttachment:"top left",constraints:[{to:"scrollParent",pin:["top"]}],optimizations:{moveElement:!1}},this.collectionBannerTether=new Tether(collectionBannerTetherOptions),$collectionBannerClone=this.app.$notHeader.before(this.$collectionBannerWrapper.clone().addClass("clone").css("top",Time.application.sizes.headerBottom)),"desktop"!==Time.device&&(orientationEvent=this.app.orientationEvent+".collection_banner_wrapper",this.app.$window.on(orientationEvent,function(_this){return function(){_this.app.mobileSafari&&($collection_ul.hide(),setTimeout(function(){return $collection_ul.show()},100)),_this.swipe_render_collection_banner()}}(this)),Modernizr.touch&&"mobile"===Time.device&&this.app.$viewportWrapper.touchwipe({wipeUp:function(_this){return function(){return _this.swipe_render_collection_banner()}}(this),wipeDown:function(_this){return function(){return _this.swipe_hide_collection_banner()}}(this),min_move_x:6,min_move_y:6,preventDefaultEvents:!1})),this},ReadingPane.prototype.swipe_hide_collection_banner=function(){this.$collectionBannerWrapper.addClass("hide")},ReadingPane.prototype.swipe_render_collection_banner=function(){this.$collectionBannerWrapper.removeClass("hide")},ReadingPane.prototype.initTopicBanner=function(data){var html,_ref,_ref1,_ref2;return"magazine"===(_ref=Time.application.active_route)||"videos"===_ref?this:(null!=(_ref1=data.menu)&&null!=(_ref2=_ref1.items)?_ref2.length:void 0)?(html=Time.templates["section-menu"].render(data),$(".topic-banner").html(html),this):this},ReadingPane.prototype.setActiveArticle=function(articleView){var $articleEl,articleBounds,articleEl,articleModel,isArticleAbove,isArticleBelow;return articleModel=articleView.model,$articleEl=articleView.$el,articleEl=articleView.el,$articleEl.length?(articleBounds=articleEl.getBoundingClientRect(),isArticleAbove=articleBounds.top<=this._activeLine,isArticleBelow=articleBounds.bottom>=this._activeLine,isArticleAbove&&isArticleBelow?(articleModel.set("isActive",!0),articleView):!1):(articleModel.set("isActive",!1),this)},ReadingPane.prototype.getArticleIndex=function(articleView){return _.chain(this.articleViews).pluck("cid").indexOf(articleView.cid).value()},ReadingPane.prototype.getArticleAbove=function(articleView){var articleIndex;return articleIndex=this.getArticleIndex(articleView),(articleIndex=0)?null:this.articleViews[articleIndex-1]},ReadingPane.prototype.getArticleBelow=function(articleView){var articleIndex;return articleIndex=this.getArticleIndex(articleView),(articleIndex=this.articleViews.length)?null:this.articleViews[articleIndex+1]},ReadingPane.prototype.isInReadingPane=function(el,isPartialAllowed){var elBottom,elRect,elTop,isTopCutOff,isTopVisible,readingPaneRect;return null!=el.length&&(el=el[0]),el?(readingPaneRect=this.el.getBoundingClientRect(),elRect=el.getBoundingClientRect(),elTop=elRect.top-400,elBottom=elRect.bottom,isTopCutOff=elTop<readingPaneRect.top&&elBottom>readingPaneRect.top,isTopVisible=elTop>readingPaneRect.top&&elTop<=readingPaneRect.bottom,this.isFullyInReadingPane(el)?!0:isPartialAllowed?isTopCutOff||isTopVisible:!1):!1},ReadingPane.prototype.isFullyInReadingPane=function(el){var elBottom,elTop,readingPaneRect,rect;return null!=el.length&&(el=el[0]),el?(readingPaneRect=this.el.getBoundingClientRect(),rect=el.getBoundingClientRect(),elTop=rect.top,elBottom=rect.bottom,elTop>=readingPaneRect.top&&elBottom<=readingPaneRect.bottom):!1},ReadingPane.prototype.showCollapsibleArticleContents=function(e){var $this;e.preventDefault(),$this=$(e.target),$this.toggleClass("collapsed"),$this.text($this.hasClass("collapsed")?"+ READ ARTICLE":"+ HIDE ARTICLE")},ReadingPane}(Backbone.View);var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.SpecialPage=function(_super){function SpecialPage(){return this.resizeInteractives=__bind(this.resizeInteractives,this),this.onScroll=__bind(this.onScroll,this),this.resizeVideo=__bind(this.resizeVideo,this),this.resize_intro=__bind(this.resize_intro,this),this.renderRightRailSticky=__bind(this.renderRightRailSticky,this),SpecialPage.__super__.constructor.apply(this,arguments)}return __extends(SpecialPage,_super),SpecialPage.prototype.el="body",SpecialPage.prototype.events={"click .chapters ul a":"scroll_to_chapter","click .parent-sub-menu":"show_menu","click .article-nav-toggle":"show_nav"},SpecialPage.prototype.isV2=!1,SpecialPage.prototype.isParents=!1,SpecialPage.prototype.lastPassedMarker=-1,SpecialPage.prototype.lastChapter=-1,SpecialPage.prototype.initialize=function(options){return null==options&&(options={}),this.app=options.app,this.app.model.set("isInitialRoute",!1),this.$specialStory=$(".special-story"),this.$nav=$(".article-navigation"),this.$sticky=$(".sticky"),this.$chapters=$(".chapters"),this.$open_chapters=$(".open-chapters"),this.$full_browser=$(".full-browser"),this.$time_video=$("#time_video"),this.$intro_screen=$(".intro-screen"),this.$markers=$(".marker"),this.$navToggle=$(".article-nav-toggle"),this.$parentsToggle=$(".parent-sub-menu"),this.header_height=$(".main-header").height(),this.banner_height=this.app.$top_banner.height(),this.sticky_height=$(".sticky").height(),this.$stories=$(".sub-nav ul"),this.isV2=this.$el.hasClass("page-template-pagespage-special-story-v2-php"),this.isParents=this.$el.hasClass("page-template-pagespage-special-story-parents-php"),null==this.model&&(this.model=new Time.models.SpecialPage({id:this.$specialStory.data("article")})),this.current_page(),this.galleriesCollection=new Time.collections.Galleries([],{article:this}),this.articleModel=new Time.models.Article(Time.bootstrap.single_article),Time.trigger("article:navigated",this.articleModel),this.isV2&&Time.trigger("article:comments",this.articleModel),this.render(),this},SpecialPage.prototype.render=function(){var $bg_cover,$img,time_video;if(""!==window.location.hash&&this.$sticky.addClass("fixed"),this.renderSubNav(),this.renderGalleries(),this.resizeInteractives(),this.isV2&&(this.checkMarkers(),this.renderRightRailSticky()),this.listenTo(Time,"readingPane:scrolled",this.onScroll),this.listenTo(Time,"application:resize",this.resizeInteractives),$(".cue").on("click",function(_this){return function(){_this.app.$notHeader.scrollTo(_this.app.$notHeader.height(),400)}}(this)),this.$full_browser.length>0)if(this.listenTo(Time,"application:resize",this.resizeVideo),this.resizeVideo(),time_video=document.getElementById("time_video"),null!=time_video){if(!document.createElement("video").canPlayType)return;this.$time_video.on("play",function(){return $(".full-browser").animate({opacity:1},2e3)})}else $bg_cover=$(".bg-cover"),$img=$bg_cover.find("img"),$bg_cover.css({"background-image":"url("+$img.attr("src")+")"}),$img.remove(),$(".full-browser").animate({opacity:1},2e3);return this.$intro_screen.length>0&&(this.listenTo(Time,"application:resize",this.resize_intro),this.$intro_screen.imagesLoaded(function(_this){return function(){return _this.resize_intro(),_this.$intro_screen.addClass("visible")}}(this))),Time.trigger("special:ads:activate",this),this},SpecialPage.prototype.renderSubNav=function(){var navToggleOffset,parentsToggleOffset;this.$navToggle.css("top",this.app.sizes.headerBottom),this.$stories.addClass("collapse"),this.listenTo(Time,"application:resize",function(_this){return function(){return _this.$navToggle.css("top",_this.app.sizes.headerBottom)}}(this)),"desktop"!==Time.device&&(this.$navClone=this.$nav.clone(),this.$sticky=this.$navClone.find(".sticky"),this.$open_chapters=this.$navClone.find(".open-chapters"),this.$chapters=this.$navClone.find(".chapters"),this.$nav.addClass("hide"),this.app.$notHeader.before(this.$navToggle,this.$navClone),"mobile"===Time.device&&(this.$parentsToggle.css("top",this.app.sizes.headerBottom),parentsToggleOffset="mobile"===Time.device?this.$parentsToggle.outerHeight(!0):0,this.$stories.css("top",this.app.sizes.headerBottom+parentsToggleOffset).css("display","block"))),"desktop"!==Time.device&&this.isV2&&(this.$sticky.addClass("fixed"),navToggleOffset="mobile"===Time.device?this.$navToggle.outerHeight(!0):0,this.$sticky.css("top",this.app.sizes.headerBottom+navToggleOffset).css("display","block"),this.$(".menu-item-has-children").on("click",function(){return $(this).hasClass("expand")?$(this).removeClass("expand"):($(".menu-item-has-children").removeClass("expand"),$(this).addClass("expand"))})),this.$open_chapters.on("click",function(_this){return function(){_this.$chapters.toggleClass("active")}}(this)),this.$chapters.find("ul a").on("click",function(_this){return function(){_this.$chapters.removeClass("active")}}(this)),Modernizr.touch&&(this.isV2||this.$el.addClass("wipe-enabled"),this.$el.touchwipe({wipeUp:function(_this){return function(){return _this.show_chapter_selector()}}(this),wipeDown:function(_this){return function(){return _this.show_chapter_selector()}}(this),min_move_x:6,min_move_y:6,preventDefaultEvents:!1})),this.$nav.on("click","li",function(e){return e.stopPropagation(),omniTrackEv("poy-ch")})},SpecialPage.prototype.renderGalleries=function(){return this.$galleries=this.$("div[data-gallery]"),console.info("SpecialPageView -- renderGalleries "+this.$galleries.length),this.model.get("galleriesRendered")===this.$galleries.length?(console.info("SpecialPageView - "+this.$galleries.length+" galleries already rendered"),this):(this.model.has("galleriesRendered")||this.model.set("galleriesRendered",0),this.$galleries.each(function(_this){return function(i,el){var galleryView;return galleryView=new Time.views.GalleryParent({el:el,article:_this,galleries:_this.galleriesCollection}),_this.listenTo(galleryView,"gallery:slides:rendered",function(){return _this.model.set("galleriesRendered",_this.model.get("galleriesRendered")+1),"undefined"!=typeof console&&null!==console?console.info("SpecialPageView - rendered ",_this.model.get("galleriesRendered")," out of ",_this.galleriesCollection.size()," galleries"):void 0})}}(this)),this)},SpecialPage.prototype.renderRightRailSticky=function(){var $chapterAnchors,defaultInfoBox,infoBoxChapter,that,topOffset,_ref;this.$rightRailSticky=$(Time.templates["right-rail-sticky"].render(this.articleModel.toJSON())).insertBefore(this.app.$notHeader),this.$chapterInfoButton=$(".rr-chapter-info"),this.$chapterInfoPanel=$(".right-rail-sticky__info-panel"),this.$chapterInfoContent=$(".info-panel__content"),this.$toggleButton=$(".rr-toggle"),topOffset=0,defaultInfoBox=(null!=(_ref=Time.bootstrap)?_ref.info_box:void 0)?Time.bootstrap.info_box:"",infoBoxChapter=null,"mobile"!==Time.device?(topOffset=100,this.$rightRailSticky.addClass("expanded"),this.$toggleButton.hide()):this.$toggleButton.removeClass("time-icons-double-left").addClass("time-icons-share"),this.$rightRailSticky.css("top",this.app.sizes.headerBottom+topOffset),this.$chapterInfoPanel.css("top",this.$rightRailSticky.offset().top+this.$rightRailSticky.outerHeight(!1)),this.$chapterInfoContent.html(defaultInfoBox),$(window).width()<700&&this.$chapterInfoPanel.css("top",this.$rightRailSticky.offset().top+this.$navToggle.outerHeight()),this.$toggleButton.on("click",function(_this){return function(){return _this.$rightRailSticky.toggleClass("expanded"),_this.$sticky.removeClass("expand"),_this.$chapterInfoPanel.removeClass("activated")}}(this)),this.$(".rr-chapter-info").on("click",function(_this){return function(){return _this.$chapterInfoPanel.toggleClass("activated")}}(this)),that=this,this.$(".time-inline-info").on("click",function(){var chapter;return chapter=_.find(that.articleModel.get("chapters"),{anchor:$(this).closest(".chapter").find(".anchor a[name]").attr("name")}),that.$chapterInfoContent.html(chapter.info),that.$chapterInfoContent.scrollTop(0),chapter!==infoBoxChapter?$(that.$chapterInfoPanel).addClass("activated"):$(that.$chapterInfoPanel).toggleClass("activated"),infoBoxChapter=chapter}),this.$(".info-panel__close").on("click",function(_this){return function(){return _this.$chapterInfoPanel.removeClass("activated"),_this.$chapterInfoContent.scrollTop(0)}}(this)),$chapterAnchors=$(".anchor a[name]"),this.listenTo(Time,"readingPane:scrolled",function(_this){return function(){return window.clearTimeout(_this.chapterInfoTimeout),_this.chapterInfoTimeout=window.setTimeout(function(){var currentChapter,highlightCutOff,highlightStart,passed;if(_this.$(".lead").offset().top+_this.$(".lead").outerHeight(!1)-(_this.app.$main_header.outerHeight(!0)+_this.sticky_height)<=0?_this.$rightRailSticky.addClass("activated"):_this.$rightRailSticky.removeClass("activated"),null!=$chapterAnchors?$chapterAnchors.length:void 0){if(passed=$.grep($chapterAnchors,function(item){return $(item).offset().top-(_this.app.$main_header.outerHeight(!0)+_this.sticky_height)<=0}),!$(passed).length)return _this.$chapterInfoContent.html(defaultInfoBox),void _this.$chapterInfoButton.removeClass("active");if(currentChapter=_.find(_this.articleModel.get("chapters"),{anchor:$(passed).last().attr("name")}),currentChapter&&currentChapter.info)return highlightStart=$(passed).last().offset().top-(_this.app.$main_header.outerHeight(!0)+_this.sticky_height),highlightCutOff=-Math.abs($(passed).last().closest("section").outerHeight()/3),highlightStart>highlightCutOff&&0>=highlightStart?_this.$chapterInfoButton.addClass("active"):_this.$chapterInfoButton.removeClass("active"),-1===_this.lastChapter||_this.lastChapter.anchor!==currentChapter.anchor?(_this.lastChapter=currentChapter,_this.$chapterInfoContent.html(currentChapter.info),_this.$chapterInfoContent.scrollTop(0)):void 0}},150)}}(this)),this.$chapterInfoContent.on("click","a",function(){return"function"==typeof omniTrackEv?omniTrackEv("poy-rev-infoclick"):void 0})},SpecialPage.prototype.resize_intro=function(){var calc_height,offset;return this.$intro_screen.css({height:this.app.$notHeader.height()}),calc_height=$(".scale-image .title").height(),calc_height+=$(".scale-image img:visible").height(),calc_height+=$(".scale-image .share").height(),calc_height+=$(".scale-image .actions").outerHeight(),offset=(this.$intro_screen.height()-calc_height)/2,$(".scale-image").css("top",offset+"px"),this},SpecialPage.prototype.resizeVideo=function(){return this.$full_browser.css({height:this.app.$notHeader.height()}),this},SpecialPage.prototype.onScroll=function(){this.headerBottom=this.banner_height,this.app.$admin_bar.length&&(this.headerBottom+=this.app.$admin_bar.height()),this.setNavFixedClass(),this.checkMarkers(),this.$sticky.removeClass("expand"),$(".menu-item-has-children").removeClass("expand")},SpecialPage.prototype.checkMarkers=function(){var difference,direction,newLastPassedMarker;newLastPassedMarker=-1,this.$markers.each(function(_this){return function(i,el){var isMarkerAboveHeader,markerRect;return markerRect=el.getBoundingClientRect(),isMarkerAboveHeader=markerRect.top-_this.headerBottom<=0,isMarkerAboveHeader?newLastPassedMarker=i:void 0}}(this)),newLastPassedMarker!==this.lastPassedMarker&&(-1===newLastPassedMarker||newLastPassedMarker<this.lastPassedMarker?(direction="up",difference=newLastPassedMarker-this.lastPassedMarker):(direction="down",difference=this.lastPassedMarker-newLastPassedMarker),this.lastPassedMarker=newLastPassedMarker,Time.trigger("special:marker:passed",this,direction,difference))},SpecialPage.prototype.setNavFixedClass=function(){var isNavAboveHeader,navTop,scrollPos;this.$nav.length&&(navTop=this.$nav.offset().top,scrollPos=this.app.$notHeader.scrollTop(),"desktop"!==Time.device&&this.isV2===!1?(this.$sticky.toggleClass("fixed open",scrollPos>0),this.isParents===!1&&(this.$sticky.hasClass("fixed")?this.$sticky.css("top",this.app.sizes.headerBottom):this.$sticky.css("top",0))):(isNavAboveHeader=0>navTop-this.headerBottom,this.$sticky.toggleClass("fixed",isNavAboveHeader)))},SpecialPage.prototype.resizeInteractives=function(){return $(".wpcom-protected-iframe").each(function(_this){return function(iframeEl){var $iframe;return $iframe=$(iframeEl),$iframe.hasClass("time-relative-iframe")?$iframe.height(_this.app.$notHeader.height()/2):void 0}}(this)),this},SpecialPage.prototype.show_chapter_selector=function(){return this.isV2||this.$sticky.addClass("open"),this.$chapters.removeClass("active")},SpecialPage.prototype.hide_chapter_selector=function(){return this.isV2||this.$sticky.removeClass("open"),this.$chapters.removeClass("active")},SpecialPage.prototype.scroll_to_chapter=function(e){var ofs;e.preventDefault(),this.hide_chapter_selector(),ofs=this.$sticky.hasClass("fixed")?-50:-this.sticky_height,this.app.$notHeader.scrollTo('a[name="'+$(e.target).attr("href").replace("#","")+'"]',400,{offset:ofs})},SpecialPage.prototype.show_nav=function(){this.$navClone.find(".sticky").toggleClass("expand"),this.$rightRailSticky.removeClass("expanded"),this.$chapterInfoPanel.removeClass("activated")},SpecialPage.prototype.show_menu=function(){this.$stories.toggleClass("collapse"),this.$stories.toggleClass("expand")},SpecialPage.prototype.current_page=function(){var $anchors,$parentAnchors;$anchors=this.$stories.find("a"),$anchors.each(function(){return $(this).attr("href")===window.location.href?$(this).addClass("active"):void 0}),this.isV2&&($anchors=this.$sticky.find("a"),$anchors.each(function(){return $(this).attr("href")===window.location.href?$(this).closest("li").addClass("active"):void 0}),$parentAnchors=this.$sticky.find(".menu > li"),$parentAnchors.each(function(){return $(this).find(".active").length?$(this).addClass("active"):void 0}))},SpecialPage}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.VaultCovers=function(_super){function VaultCovers(){return VaultCovers.__super__.constructor.apply(this,arguments)}return __extends(VaultCovers,_super),VaultCovers.prototype.IS_ADS_ENABLED=!1,VaultCovers.prototype.OOP_ID="vault__oop--cover",VaultCovers.prototype.RESIZE_DEBOUNCE_RATE=500,VaultCovers.prototype.MAX_ADS=4,VaultCovers.prototype.AD_ROW_FREQUENCY=2,VaultCovers.prototype.AD_SIZES={desktop:["728x90"],tablet:["728x90"],mobile:["728x90"]},VaultCovers.prototype.initialize=function(options){var debouncedUpdateAdFrequency;return null==options&&(options={}),this.model.DEBUG&&console.log("Vault: initialize covers"),this.vault=options.vault,this.isRendered=!1,this.isRenderingAds=!1,this.adIds=[],this.listenTo(this.vault,"subview:rendered",function(_this){return function(){var adFrequency;_this.destroyAds(),adFrequency=_this.getAdFrequency(),_this.injectAds(adFrequency),_this.renderOOP(),_this.renderAds()}}(this)),this.listenTo(Time,"dfpAdManager:afterDisplay",function(_this){return function(){var _ref;(null!=(_ref=_this.$ads)?_ref.length:void 0)&&_this.$ads.removeClass("vault__ad--loading"),_.defer(function(){return setTimeout(function(){var _ref1;return(null!=(_ref1=_this.$ads)?_ref1.length:void 0)&&_this.$ads.addClass("vault__ad--loaded"),_this.isRenderingAds=!1},200)})}}(this)),debouncedUpdateAdFrequency=_.debounce(function(_this){return function(){var adFrequency;if(_this.isRendered&&(_this.destroyAds(),!_this.isRenderingAds))return adFrequency=_this.getAdFrequency(),_this.injectAds(adFrequency),_this.renderOOP(),_this.renderAds()}}(this),this.RESIZE_DEBOUNCE_RATE),this.listenTo(Time,"application:resize",debouncedUpdateAdFrequency),this},VaultCovers.prototype.template=Time.templates["vault-covers"],VaultCovers.prototype.filterMagazines=function(){var magazines;return magazines=this.collection.models,"year"===this.model.get("filterType")&&(magazines=this.collection.filter(function(_this){return function(item){return parseInt(item.get("pubDate").substr(0,4),10)===_this.model.getYear()}}(this))),magazines},VaultCovers.prototype.render=function(){var items,itemsData,itemsHtml;return this.model.DEBUG&&console.log("Vault: render covers"),items=this.filterMagazines(),itemsData=items.map(function(magazine){var parsedData,_ref,_ref1;return parsedData={id:magazine.get("id"),thumbnail:null!=(_ref=magazine.get("hero"))&&null!=(_ref1=_ref.src)?_ref1.small:void 0,title:magazine.getFriendlyDate(),date:magazine.getFriendlyDate(),hasActions:magazine.hasActions(),browseLink:magazine.getBrowseLink(),webLink:magazine.getWebLink(),buyLink:magazine.getBuyLink()}}),itemsHtml=this.template.render({items:itemsData},Time.partials),this.$el.html(itemsHtml),null==this.adSize&&("mobile"===Time.device&&null==this.adSize&&(this.adSize=this.AD_SIZES.mobile),"tablet"===Time.device&&null==this.adSize&&(this.adSize=this.AD_SIZES.tablet),null==this.adSize&&(this.adSize=this.AD_SIZES.desktop)),this.isRendered=!0,this.vault.trigger("subview:rendered"),this},VaultCovers.prototype.destroyAds=function(){var _ref;return this.model.DEBUG&&console.log("Vault: covers - destroyAds"),this.isRenderingAds?void 0:((null!=(_ref=this.$ads)?_ref.length:void 0)&&(this.$ads.each(function(index,el){return Time.trigger("dfpAdManager:deleteAd",el.id)}),this.$ads=null),this.$(".vault__ad").remove(),this.adIds=[],this)},VaultCovers.prototype.getAdFrequency=function(){var $vaultItems,currentRowTop,firstItemOffset,frequency,lastItemOffset,row,totalItems;return $vaultItems=this.$(".vault__item"),(totalItems=$vaultItems.length)?(firstItemOffset=$vaultItems.first().offset(),lastItemOffset=$vaultItems.last().offset(),lastItemOffset.top===firstItemOffset.top?totalItems:(frequency=0,row=1,currentRowTop=firstItemOffset.top,$vaultItems.each(function(_this){return function(index,el){var thisTop;return thisTop=$(el).offset().top,thisTop!==currentRowTop?(frequency=index*_this.AD_ROW_FREQUENCY,!1):void 0}}(this)),frequency)):0},VaultCovers.prototype.injectAds=function(adFrequency){var $itemsBeforeAd,ads,newRowSelector;return null==adFrequency&&(adFrequency=this.getAdFrequency()),this.model.DEBUG&&console.log("Vault: injectAds"),adFrequency&&!this.isRenderingAds?(newRowSelector=".vault__item:nth-of-type("+adFrequency+"n)",$itemsBeforeAd=$(newRowSelector).slice(0,this.MAX_ADS-1),$itemsBeforeAd.length||($itemsBeforeAd=$(".vault__item:last-child")),ads=$itemsBeforeAd.map(function(index){var $adDiv,position;return position=index+1,$adDiv=$("<div />",{id:"VaultAd_"+position,"class":"vault__ad vault__ad--loading"}).data("position",position)}),$itemsBeforeAd.each(function(index,$el){return ads[index].insertAfter($el)}),this.$ads=$(ads).map(function(){return this.toArray()}),this):void 0},VaultCovers.prototype.renderOOP=function(){var $oop,params;return this.model.DEBUG&&console.log("Vault: renderOOP"),this.isRenderingAds||-1!==this.adIds.indexOf(this.OOP_ID)?void 0:($oop=$("#"+this.OOP_ID),$oop.length||($oop=$('<div id="'+this.OOP_ID+'" />').hide().appendTo("body")),params={id:this.OOP_ID,size:["1x1"],position:0},Time.trigger("dfpAdManager:factory:setZone","vault"),Time.trigger("dfpAdManager:activateAd",null,params),this.adIds.push(this.OOP_ID),this)},VaultCovers.prototype.renderAds=function(){var cmAdIds,_ref;return this.model.DEBUG&&console.log("Vault: render all ads"),(null!=(_ref=this.$ads)?_ref.length:void 0)&&!this.isRenderingAds?(Time.trigger("dfpAdManager:factory:setZone","vault"),cmAdIds=this.$ads.map(function(_this){return function(index,el){var params;return params={id:el.id,size:_this.adSize,position:$(el).data("position"),isCmAd:!0,group:"vault",cmpos:"archcvrbrwsr",cmtyp:"tout"},Time.trigger("dfpAdManager:activateAd",null,params),el.id}}(this)),this.adIds.push.apply(this.adIds,cmAdIds),this.adIds.length&&(this.isRenderingAds=!0,Time.trigger("dfpAdManager:factory:setZone","vault"),Time.trigger("dfpAdManager:refreshAds",null,this.adIds)),this):void 0},VaultCovers}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.VaultPage=function(_super){function VaultPage(){return VaultPage.__super__.constructor.apply(this,arguments)}return __extends(VaultPage,_super),VaultPage.prototype.events={"click .vault__page__image__container":"onClickPageImageLink","click .vault__page__image__container img":"onClickPageImg","click .vault__spread__image":"onClickSpreadImageLink"},VaultPage.prototype.IMAGE_SIZES={small:"250.jpg",medium:"775.jpg",large:"1550.jpg"},VaultPage.prototype.OOP_ID="vault__oop--issue",VaultPage.prototype.initialize=function(options){return null==options&&(options={}),this.vault=options.vault,this.magazine=options.model.get("magazine"),this.$w=$(window),this.ww=this.$w.width(),this.listenTo(this.model,"change:context",function(_this){return function(model,value){("page"===value||"spread"===value)&&_this.vault.setContextByWindowWidth()}}(this)),this},VaultPage.prototype.onClickPageImageLink=function(e){e.preventDefault()},VaultPage.prototype.onClickPageImg=function(e){e.preventDefault(),this.vault.canZoom&&this.vault.renderZoom(0===this.vault.zoom?1:0)},VaultPage.prototype.onClickSpreadImageLink=function(e){var $a,page;e.preventDefault(),$a=$(e.currentTarget),page=$a.data("page"),page&&this.model.set({context:"page",page:page})},VaultPage.prototype.template=function(){return this.isPageTemplate()?Time.templates["vault-page"]:Time.templates["vault-spread"]},VaultPage.prototype.isPageTemplate=function(){return"page"===this.model.get("context")?!0:0===this.model.get("page")?!0:this.model.get("page")!==this.magazine.getTotalPages()-1||this.magazine.getTotalPages()%2?void 0:!0},VaultPage.prototype.getPageObject=function(page){return page={page:page.physicalPageNumber,small:this.vault.getMediaUrl(this.magazine,page.imageBasePath+this.IMAGE_SIZES.small),medium:this.vault.getMediaUrl(this.magazine,page.imageBasePath+this.IMAGE_SIZES.medium),large:this.vault.getMediaUrl(this.magazine,page.imageBasePath+this.IMAGE_SIZES.large)}},VaultPage.prototype.getPageHtml=function(page){return null==page?"":(this.pageData={page:page.physicalPageNumber,small:this.vault.getMediaUrl(this.magazine,page.imageBasePath+this.getBest("small")),medium:this.vault.getMediaUrl(this.magazine,page.imageBasePath+this.getBest("medium")),large:this.vault.getMediaUrl(this.magazine,page.imageBasePath+this.getBest("large"))},this.template().render(this.pageData,Time.partials))},VaultPage.prototype.getSpreadHtml=function(leftPage,rightPage){var images,leftImage,rightImage;return images=[],leftImage=this.getPageObject(leftPage),rightImage={},rightPage&&(rightImage=this.getPageObject(rightPage)),this.template().render({images:[leftImage,rightImage]},Time.partials)},VaultPage.prototype.render=function(){var isPaywalled,pages,vault;if(vault=this.magazine.get("vault"),!vault)return this.vault.renderError(this.vault.E_MISSING_VAULT,{magazine:this.magazine}),!1;if(this.adIds=[],isPaywalled="error"in vault)this.renderPaywall();else{if(pages=(null!=vault?vault.pagePDFs:void 0)||[],!pages.length)return this.vault.renderError(this.vault.E_NO_PAGES,{magazine:this.magazine}),!1;this.renderPageView(pages)}return this.resize(),$(window).trigger("scroll"),this.vault.trigger("subview:rendered"),this},VaultPage.prototype.renderPageView=function(pages){var leftPage,page,pageHtml,rightPage;return this.isPageTemplate()?(page=pages[this.model.get("page")],pageHtml=this.getPageHtml(page)):(leftPage=pages[this.model.get("page")],rightPage=pages[this.model.get("page")+1],pageHtml=this.getSpreadHtml(leftPage,rightPage)),this.$el.html(pageHtml),this.$(".vault__page__image img").data("original",this.$(".vault__page__image img").attr("src")),this},VaultPage.prototype.resize=function(ww){var bodyBottom,bodyTop,newHeight;return this.ww=null!=ww?ww:this.$w.width(),bodyBottom=this.isPaywalled?this.$w.height():$(".vault__page__options").offset().top,bodyTop=this.$el.offset().top,newHeight=Math.floor(bodyBottom-bodyTop),this.isPaywalled||(newHeight-=this.ww<768?8:this.ww<1025?24:48),this.$(".vault__page, .vault__spread").css({height:newHeight,"min-height":newHeight}),this},VaultPage.prototype.getBest=function(minimum){return null==window.devicePixelRatio&&(window.devicePixelRatio=1),this.ww*window.devicePixelRatio>1023||"large"===minimum?this.IMAGE_SIZES.large:this.ww*window.devicePixelRatio>320||"medium"===minimum?this.IMAGE_SIZES.medium:this.IMAGE_SIZES.small},VaultPage.prototype.printTemplate=Time.templates["vault-print"],VaultPage.prototype.print=function(){var html,win;return html=this.printTemplate.render({title:this.magazine.getFriendlyMeta(),img:this.$(".vault__page__image__container").html()}),win=window.open("","PrintWindow"),win.document.writeln(html),win.document.close(),win.focus(),win.print(),win.close(),this},VaultPage.prototype.destroyAds=function(){var $paywall;return $paywall=this.$(".vault__paywall"),$paywall.length?(Time.trigger("dfpAdManager:deleteAd",this.OOP_ID),$paywall.fadeOut("fast",function(){return $paywall.remove()}),this):void 0},VaultPage.prototype.renderOOP=function(){var $oop,params,_ref;return this.model.DEBUG&&console.log("Vault: issue - renderOOP"),(null!=(_ref=this.$paywall)?_ref.length:void 0)?($oop=$("#"+this.OOP_ID),$oop.length||($oop=$('<div id="'+this.OOP_ID+'" />').hide().appendTo(this.$paywall)),params={id:this.OOP_ID,size:["1x1"],position:0,isCmAd:!0,loggedin:Time.authenticated?"yes":"no"},Time.trigger("dfpAdManager:factory:setZone","vault/issue"),Time.trigger("dfpAdManager:activateAd",null,params),this.adIds.push(this.OOP_ID),this):void 0
},VaultPage.prototype.renderPaywall=function(){return this.model.DEBUG&&console.log("Vault: paywalled"),this.isPaywalled=!0,this.vault.canZoom=!1,this.$el.toggleClass("vault--canZoom",this.vault.canZoom),this.$paywall=$("<div />",{"class":"vault__page vault__paywall"}),this.$el.html(this.$paywall),this.renderOOP(),Time.trigger("dfpAdManager:refreshAds",null,this.adIds),this},VaultPage}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.VaultPages=function(_super){function VaultPages(){return VaultPages.__super__.constructor.apply(this,arguments)}return __extends(VaultPages,_super),VaultPages.prototype.events={"click .vault__pages__spread a":"onClickPage"},VaultPages.prototype.template=Time.templates["vault-pages"],VaultPages.prototype.initialize=function(options){return null==options&&(options={}),this.vault=options.vault,this.magazine=options.model.get("magazine"),this},VaultPages.prototype.onClickPage=function(e){var $a,page,_ref;return e.preventDefault(),$a=$(e.currentTarget),page=$a.data("page"),null!=page?("function"==typeof omniTrackEv&&omniTrackEv("archive-issuepage"),0===page?void this.model.set({context:"page",page:0}):void this.model.set(this.vault.MAX_SPREAD_WIDTH>(_ref=this.ww)&&_ref>this.vault.MIN_SPREAD_WIDTH?{context:"spread",page:this.model.getOddPage(page)}:{context:"page",page:page})):void 0},VaultPages.prototype.groupPages=function(pages){var groupedPages,spread;return groupedPages=[],spread=new Object,_.each(pages,function(_this){return function(page){var isOddPage;return page.pagesImagePath=_this.vault.getMediaUrl(_this.magazine,page.imageBasePath),(isOddPage=parseInt(page.physicalPageNumber,10)%2)?(spread=new Object,spread.left=page,void(page===_.last(pages)&&groupedPages.push(spread))):(spread.right=page,void groupedPages.push(spread))}}(this)),groupedPages},VaultPages.prototype.render=function(){var cover,groupedPages,pageHtml,vault;return vault=this.magazine.get("vault"),cover=vault.pagePDFs[0],cover.pagesImagePath=this.vault.getMediaUrl(this.magazine,cover.imageBasePath),groupedPages=this.groupPages(_.rest(vault.pagePDFs)),pageHtml=this.template.render({magazineId:this.magazine.id,cover:cover,pages:groupedPages},Time.partials),this.$el.html(pageHtml),this.vault.trigger("subview:rendered"),this},VaultPages}(Backbone.View);var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.Vault=function(_super){function Vault(){return this.onChangeSubjectSelecter=__bind(this.onChangeSubjectSelecter,this),this.onChangeYearSelecter=__bind(this.onChangeYearSelecter,this),Vault.__super__.constructor.apply(this,arguments)}return __extends(Vault,_super),Vault.prototype.el="div.vault",Vault.prototype.events={"click .vault__action__browse":"onClickBrowseIssue","click .vault__search .time-icons-search":"onClickSearchIcon","click .vault__browse":"toggleBrowse","click .vault__paginator__next":"nextSet","click .vault__paginator__prev":"prevSet","click .vault__zoom__in":"zoomIn","click .vault__zoom__out":"zoomOut","click .vault__icon__print":"onClickPrint","click .vault__icon__page":"setPageContext","click .vault__icon__spread":"setSpreadContext","click .vault__icon__pages":"setPagesContext","click .vault__page__next .vault__arrow":"onClickNextPage","click .vault__page__prev .vault__arrow":"onClickPrevPage"},Vault.prototype.MEDIA_BASE_PATH="http://content.time.com/time/subscriber/vault/",Vault.prototype.MIN_SPREAD_WIDTH=568,Vault.prototype.MAX_SPREAD_WIDTH=768,Vault.prototype.MIN_PAGES_WIDTH=768,Vault.prototype.MIN_ZOOM_WIDTH=768,Vault.prototype.MIN_CONTEXT_WIDTH=1024,Vault.prototype.MAX_ZOOM_LEVEL=1,Vault.prototype.E_INVALID_DATE=1,Vault.prototype.E_MISSING_VAULT=2,Vault.prototype.E_NO_PAGES=3,Vault.prototype.initialize=function(options){return null==options&&(options={}),this.app=options.app,options.landing?this.initLanding(options):(null==this.model&&(this.model=new Time.models.Vault),this.model.SUBJECT_HASH=this.populateSubjects(),this.model.VALID_SUBJECTS=_.pluck(this.model.SUBJECT_HASH,"values"),this.isError=!1,this.isHardReload=!1,this.subview=null,this.zoom=0,this.isLoadingVault=!1,this.listenTo(this,"subview:rendered",function(_this){return function(){return _this.onSubviewRendered()}}(this)),this)},Vault.prototype.initFromRoute=function(options){var collectionOptions,isInitialized;return null==options&&(options={}),this.model.DEBUG&&console.log("vault: initFromRoute",options),this.clearContext(),this.collection||(this.model.DEBUG&&console.log("vault: initFromRoute, first init"),collectionOptions=_.extend(options,{vault:this}),this.collection=new Time.collections.VaultMagazines(null,collectionOptions),this.swipeEnabled=Modernizr.touch&&$(window).width()<=1024,this.renderHeader(),this.bindListeners()),null==options.filterType&&(options.filterType="year"),isInitialized="issue"===options.filterType?this.initContextIssue(options):this.initContextCovers(options),isInitialized&&(this.collection.isBootstrapped||(this.collection.isBootstrapped=!0,document.title=this.getTitle(),this.setRoute({isInitial:!0}),this.changeContext()),this.render()),this},Vault.prototype.initContextIssue=function(options){var attributes,isPaywalled,magazine,page,vault,_ref,_ref1;return null==options&&(options={}),this.model.DEBUG&&console.log("vault: initContextIssue",options),this.model.isValidIssueDate(options.filterValue)?(magazine=this.collection.getByDate(options.filterValue),null==magazine?(this.renderError(this.E_INVALID_DATE,{date:options.filterValue}),!1):(vault=magazine.get("vault"),null==vault?(this.renderError(this.E_MISSING_VAULT,{date:options.filterValue}),!1):(isPaywalled="error"in vault)?(this.model.set({context:"page",magazine:magazine,page:0}),!0):(null!=vault&&null!=(_ref=vault.pagePDFs)?_ref.length:void 0)?(attributes={context:options.context,magazine:magazine},("page"===(_ref1=options.context)||"spread"===_ref1)&&(page=parseInt(options.page,10)-1,page>=vault.pagePDFs.length&&(page=vault.pagePDFs.length-1),0>=page&&(page=0),attributes.page=page),this.model.set(attributes),!0):(this.renderError(this.E_NO_PAGES,{magazine:magazine}),!1))):(this.renderError(this.E_INVALID_DATE,{date:options.filterValue}),!1)},Vault.prototype.initContextCovers=function(options){var _ref;if(null==options&&(options={}),this.model.DEBUG&&console.log("vault: initContextCovers",options),null==options.context&&(options.context="covers"),"year"===options.filterType){if(null==options.filterValue&&(options.filterValue=this.model.YEAR_MAX),this.model.YEAR_MAX<(_ref=options.filterValue)&&_ref<this.model.YEAR_MIN)return console.error("Invalid filterValue",options.filterValue),this.initContextDefault(),!0;this.model.set({context:options.context,filterType:options.filterType,year:options.filterValue})}else if("subject"===options.filterType){if(this.model.VALID_SUBJECTS.length&&null==options.filterValue&&(options.filterValue=this.model.VALID_SUBJECTS[0]),null==options.filterValue&&(options.filterValue=""),!options.filterValue)return console.error("Invalid filterValue",options.filterValue),this.initContextDefault(),!0;this.model.set({context:options.context,filterType:options.filterType,subject:options.filterValue})}else console.error("Invalid filterType",options.filterType),this.initContextDefault();return!0},Vault.prototype.initContextDefault=function(){return this.model.DEBUG&&console.log("vault: initContextDefault"),this.collection.size()||(this.collection.isBootstrapped=!0),this.model.set({context:"covers",filterType:"year",year:this.model.YEAR_MAX}),this},Vault.prototype.initLanding=function(){var onBeforeChange;onBeforeChange=function(_this){return function(slider,currentIndex,targetIndex){return _this.$(".vault-landing__carousel--indicators li").removeClass("active"),$(_this.$(".vault-landing__carousel--indicators li")[targetIndex]).addClass("active")}}(this),this.vaultLandingCarousel=this.$(".vault-landing__carousel--slides").slick({arrows:!1,onBeforeChange:onBeforeChange,slide:"article"}),this.$(".vault-landing__carousel--next-button").on("click",function(_this){return function(){var _ref;return null!=(_ref=_this.vaultLandingCarousel)?_ref.slickNext():void 0}}(this)),this.$(".vault-landing__carousel--prev-button").on("click",function(_this){return function(){var _ref;return null!=(_ref=_this.vaultLandingCarousel)?_ref.slickPrev():void 0}}(this)),this.renderHeader(!0),Time.trigger("sectionfront:ads:activate",".vault-landing__ad")},Vault.prototype.bindListeners=function(){return this.listenTo(Time,"application:resize",function(_this){return function(){return _this.resize()}}(this)),this.app.$body.on("keydown.vault",function(_this){return function(e){var _ref;if("page"===(_ref=_this.model.get("context"))||"spread"===_ref)return 37===e.keyCode?_this.onClickPrevPage(e):39===e.keyCode?_this.onClickNextPage(e):e}}(this)),this.listenToOnce(Time,"dfpAdManager:afterDisplay",function(){Time.Ad.setInitialAdPageLoad(!1),Time.Ad.set_initial_app_load(!1),window.TGX_SITE_CONFIG.refresh_oop_slot=!1}),this.listenTo(this.collection,"reset",function(_this){return function(){_this.render()}}(this)),this.listenTo(this.model,"change",function(_this){return function(model){var changed;if(_this.collection.isBootstrapped)return document.title=_this.getTitle(),_this.setRoute(),changed=_.keys(model.changedAttributes()),_.intersection(changed,["context","subject","year","magazine"]).length&&(_this.changeContext(),"covers"===_this.model.get("context"))?_this.load():void _this.render()}}(this)),this.listenTo(this.model,"change:page",function(_this){return function(model,value){var _ref;_this.zoom=0,null!=(_ref=_this.subview)&&(_ref.originalSrc=null),_this.setZoomClasses(),_this.setCoverPageClasses(value)}}(this)),this.listenTo(this.model,"change:filterType",function(_this){return function(model,value){value&&_this.renderFilterClass(value)}}(this)),this},Vault.prototype.load=function(){switch(this.collection.maybeFetch()){case"fetching":this.$(".vault__body").empty().addClass("loading-overlay");break;case"current":this.collection.trigger("reset")}return this},Vault.prototype.bindSwipe=function(){var _base;return Modernizr.touch?("function"==typeof(_base=this.$(".vault__page, .vault__spread")).touchwipe&&_base.touchwipe({preventDefaultEvents:!1,min_move_x:6,min_move_y:6,wipeLeft:function(_this){return function(e){return _this.onSwipeNext(e)}}(this),wipeRight:function(_this){return function(e){return _this.onSwipePrev(e)}}(this)}),this):this},Vault.prototype.getMediaUrl=function(magazine,path){return this.MEDIA_BASE_PATH+magazine.dateObject.format("YYYY/MM/YYYYMMDD/")+path},Vault.prototype.getTitle=function(){var title,_ref,_ref1,_ref2;if(title="","page"===(_ref=this.model.get("context"))||"spread"===_ref||"pages"===_ref)("page"===(_ref1=this.model.get("context"))||"spread"===_ref1)&&(title+=this.model.get("page")?"Page "+this.model.get("page"):"Cover ",title+=" - "),title+=null!=(_ref2=this.model.get("magazine"))?_ref2.getFriendlyMeta():void 0;else switch(this.model.get("filterType")){case"year":title+="Covers from "+this.model.getFilterValue();break;case"subject":title+='Covers in "'+this.model.getPrettySubject()+'"'}return title+" - The Vault - TIME"},Vault.prototype.getTocOptionsHtml=function(magazine){var baseUrl,options,optionsArray,_ref;return null==magazine&&(magazine=this.model.get("magazine")),baseUrl=Time.home_url,this.model.DEBUG&&(baseUrl="http://time.com/"),options="",optionsArray=_.map(null!=(_ref=magazine.get("vault"))?_ref.articles:void 0,function(data){var url;return url=data.url||magazine.getWebLink(),'<option value="'+url+'">'+data.title+"</option>"}),options+=optionsArray.join("")},Vault.prototype.getMagazine=function(magazineId){var magazine;return magazine=this.collection.get(magazineId),null==magazine&&(console.error("vault: magazine not found",magazineId),magazine=this.collection.first()),this.model.DEBUG&&console.log("vault: getMagazine",magazineId,magazine),magazine},Vault.prototype.setRoute=function(options){var route,_ref,_ref1;null==options&&(options={}),route=this.model.getRoute({pubDate:null!=(_ref=this.model.get("magazine"))?_ref.get("pubDate"):void 0}),null==options.isInitial&&null!=(_ref1=Time.Tracking)&&"function"==typeof _ref1.omnitureVault&&_ref1.omnitureVault(Time.home_url+"/"+route),this.app.router.navigate(route,{trigger:!1})},Vault.prototype.setShare=function(magazine){var eBody,eHref,eTitle,eUrl,fbHref,lineBreak,route,twHref,url;return null==magazine&&(magazine=this.model.get("magazine")),magazine?(route=this.model.getRoute({pubDate:magazine.get("pubDate")}),url=Time.home_url+"/"+route,lineBreak="%0D%0A",eUrl=encodeURIComponent(url),eTitle=encodeURIComponent(this.getTitle()),0===this.model.get("page")?(eTitle="TIME Magazine from "+magazine.getFriendlyDate(),eBody="Check out what was on the cover of TIME on "+magazine.getFriendlyDate()):(eTitle="From the pages of TIME",eBody="Check out this page from the "+magazine.getFriendlyDate()+" issue of TIME"),eBody+=lineBreak,eBody+=eUrl,eHref="mailto:",eHref+="?subject="+eTitle,eHref+="&body="+eBody,twHref="https://twitter.com/intent/tweet",twHref+="?url="+eUrl,twHref+=0===this.model.get("page")?"&text="+encodeURIComponent("See what was on the cover of TIME on "+magazine.getFriendlyDate()):"&text="+encodeURIComponent("Check out this page from the "+magazine.getFriendlyDate()+" issue of TIME"),twHref+="&via=TIMEHistory",fbHref="https://www.facebook.com/sharer/sharer.php",fbHref+="?u="+eUrl,this.$(".social-link-mail").attr("href",eHref),this.$(".social-link-tw").data("href",twHref),this.$(".social-link-fb").attr("href",fbHref),this.$(".social-link-gplus").attr("href","https://plus.google.com/share?url="+eUrl),void this.$(".social-link-linkedin").attr("href","http://www.linkedin.com/shareArticle?mini=true&url="+eUrl+"&title="+eTitle)):this},Vault.prototype.populateSubjects=function(){var $options,options;return $options=this.$("#vaultSelectSubject").children("option"),options=_.map($options.toArray(),function(optionEl){var $option,hash;return $option=$(optionEl),hash={pretty:$option.data("pretty"),value:$option.attr("value")}})},Vault.prototype.openIssue=function($el){var $item,magazine,magazineId;return"function"==typeof omniTrackEv&&omniTrackEv("archive-cover"),$item=$el.closest(".vault__item"),(magazineId=$item.data("id"))?(magazine=this.getMagazine(magazineId),(null!=magazine?magazine.get("vault"):void 0)?(this.model.set({context:"page",magazine:magazine,page:0}),this):(this.renderError(this.E_MISSING_VAULT,{magazineId:magazineId}),!1)):void 0},Vault.prototype.onClickBrowseIssue=function(e){var $clickedEl;null!=e&&e.preventDefault(),null!=e&&e.stopPropagation(),$clickedEl=$(e.currentTarget),(!$clickedEl.is("img")||Modernizr.touch)&&this.openIssue($clickedEl)},Vault.prototype.onClickSearchIcon=function(e){var _base;this.$(".vault__browse").removeClass("vault__browse--expanded"),this.$("#vaultSearchInput").val()&&(e.preventDefault(),e.stopPropagation(),"function"==typeof(_base=this.$("#vaultSearchInput").closest("form").get(0)).submit&&_base.submit())},Vault.prototype.toggleBrowse=function(e){null!=e&&e.preventDefault(),null!=e&&e.stopPropagation(),this.$(".vault__browse").toggleClass("vault__browse--expanded")},Vault.prototype.setContextByWindowWidth=function(ww){var _ref;return"page"===(_ref=this.model.get("context"))||"spread"===_ref?(this.canZoom=!0,ww<this.MIN_CONTEXT_WIDTH&&(this.MAX_SPREAD_WIDTH>ww&&ww>this.MIN_SPREAD_WIDTH?this.model.set("context","spread"):this.model.set("context","page")),ww<this.MIN_ZOOM_WIDTH&&(this.canZoom=!1,this.zoom=0),this.$el.toggleClass("vault--canZoom",this.canZoom)):"pages"===this.model.get("context")&&ww<this.MIN_PAGES_WIDTH&&this.model.set("context","page"),this},Vault.prototype.resize=function(){var $selectSubject,$selectYear,ww,_ref;ww=$(window).width(),this.setContextByWindowWidth(ww),this.swipeEnabled=Modernizr.touch&&1024>=ww,$selectYear=this.$(".vault__browse__year").find(".selecter-selected"),$selectSubject=this.$(".vault__browse__subject").find(".selecter-selected"),568>ww?("Browse by year"===$selectYear.text()&&$selectYear.text("Year"),"Browse by subject"===$selectSubject.text()&&$selectSubject.text("Subject")):("Year"===$selectYear.text()&&$selectYear.text("Browse by year"),"Subject"===$selectSubject.text()&&$selectSubject.text("Browse by subject")),"covers"===this.model.get("context")&&this.setInProgressPosition(),null!=(_ref=this.subview)&&"function"==typeof _ref.resize&&_ref.resize(ww)},Vault.prototype.nextSet=function(e){return null!=e&&e.preventDefault(),null!=e&&e.stopPropagation(),this.$(".vault__browse").removeClass("vault__browse--expanded"),"covers"===this.model.get("context")?("function"==typeof omniTrackEv&&omniTrackEv("archive-year-scroll"),void this.model.nextYear()):void this.nextVault()},Vault.prototype.prevSet=function(e){return null!=e&&e.preventDefault(),null!=e&&e.stopPropagation(),this.$(".vault__browse").removeClass("vault__browse--expanded"),"covers"===this.model.get("context")?("function"==typeof omniTrackEv&&omniTrackEv("archive-year-scroll"),this.model.prevYear()):void this.prevVault()},Vault.prototype.loadVault=function(issueDate){var newMagazine;return this.isLoadingVault=!0,(newMagazine=this.collection.getByDate(issueDate))?this.changeIssue(newMagazine):(this.$(".vault__body").empty().addClass("loading-overlay"),this.collection.silentFetch(this.collection.yearUrlFromDate(issueDate),function(_this){return function(){return _this.$(".vault__body").removeClass("loading-overlay"),newMagazine=_this.collection.findWhere({pubDate:issueDate}),null==newMagazine?(_this.renderError(_this.E_INVALID_DATE,{date:issueDate}),!1):_this.changeIssue(newMagazine)}}(this)),newMagazine)},Vault.prototype.changeIssue=function(magazine){return this.isLoadingVault=!1,magazine?this.model.set({magazine:magazine,page:0}):(console.error("Could not change to magazine",magazine),this.initContextDefault()),this},Vault.prototype.nextVault=function(){var magazine,vault;if(!this.isLoadingVault)return"function"==typeof omniTrackEv&&omniTrackEv("archive-issue-scroll"),magazine=this.model.get("magazine"),vault=magazine.get("vault"),this.loadVault(vault.nextVault),this},Vault.prototype.prevVault=function(){var magazine,vault;if(!this.isLoadingVault)return"function"==typeof omniTrackEv&&omniTrackEv("archive-issue-scroll"),magazine=this.model.get("magazine"),vault=magazine.get("vault"),this.loadVault(vault.prevVault),this},Vault.prototype.incrementIssue=function(){var index,nextMagazine;return index=this.collection.indexOf(this.model.get("magazine")),-1===index?this:(nextMagazine=this.collection.at(index+1),null==nextMagazine?this:(this.model.set({magazine:nextMagazine,page:0}),this))},Vault.prototype.decrementIssue=function(){var index,prevMagazine;return index=this.collection.indexOf(this.model.get("magazine")),0>=index?this:(prevMagazine=this.collection.at(index-1),null==prevMagazine?this:(this.model.set({magazine:prevMagazine,page:0}),this))},Vault.prototype.zoomIn=function(e){var prevZoom;null!=e&&e.preventDefault(),null!=e&&e.stopPropagation(),this.$(".vault__browse").removeClass("vault__browse--expanded"),this.subview.isPaywalled||("function"==typeof omniTrackEv&&omniTrackEv("archive-zoom"),"page"===this.model.get("context")&&(prevZoom=this.zoom,this.zoom+=1,this.zoom>this.MAX_ZOOM_LEVEL&&(this.zoom=this.MAX_ZOOM_LEVEL),this.renderZoom(this.zoom,prevZoom)))},Vault.prototype.zoomOut=function(e){var prevZoom;null!=e&&e.preventDefault(),null!=e&&e.stopPropagation(),this.$(".vault__browse").removeClass("vault__browse--expanded"),this.subview.isPaywalled||("function"==typeof omniTrackEv&&omniTrackEv("archive-zoom"),"page"===this.model.get("context")&&(prevZoom=this.zoom,this.zoom-=1,this.zoom<0&&(this.zoom=0),this.renderZoom(this.zoom,prevZoom)))},Vault.prototype.setPageContext=function(e){null!=e&&e.preventDefault(),null!=e&&e.stopPropagation(),this.$(".vault__browse").removeClass("vault__browse--expanded"),this.subview.isPaywalled||("function"==typeof omniTrackEv&&omniTrackEv("archive-layout-single"),this.model.set({context:"page"}))},Vault.prototype.setSpreadContext=function(e){null!=e&&e.preventDefault(),null!=e&&e.stopPropagation(),this.$(".vault__browse").removeClass("vault__browse--expanded"),this.subview.isPaywalled||("function"==typeof omniTrackEv&&omniTrackEv("archive-layout-double"),this.model.set({context:"spread"}))},Vault.prototype.setPagesContext=function(e){null!=e&&e.preventDefault(),null!=e&&e.stopPropagation(),this.$(".vault__browse").removeClass("vault__browse--expanded"),this.subview.isPaywalled||("function"==typeof omniTrackEv&&omniTrackEv("archive-layout-thumb"),this.model.set({context:"pages"}))},Vault.prototype.onClickNextPage=function(e){null!=e&&e.preventDefault(),null!=e&&e.stopPropagation(),this.$(".vault__browse").removeClass("vault__browse--expanded"),this.subview.isPaywalled||this.model.nextPage(this.model.get("magazine").getTotalPages()-1)},Vault.prototype.onClickPrevPage=function(e){null!=e&&e.preventDefault(),null!=e&&e.stopPropagation(),this.$(".vault__browse").removeClass("vault__browse--expanded"),this.subview.isPaywalled||this.model.prevPage(0)},Vault.prototype.onSwipeNext=function(){var _ref;this.$(".vault__browse").removeClass("vault__browse--expanded"),this.swipeEnabled&&"page"!==(_ref=!this.model.get("context"))&&"spread"!==_ref&&(this.subview.isPaywalled||this.zoom||this.onClickNextPage())},Vault.prototype.onSwipePrev=function(){var _ref;this.$(".vault__browse").removeClass("vault__browse--expanded"),this.swipeEnabled&&"page"!==(_ref=!this.model.get("context"))&&"spread"!==_ref&&(this.subview.isPaywalled||this.zoom||this.onClickPrevPage())},Vault.prototype.onClickPrint=function(e){null!=e&&e.preventDefault(),null!=e&&e.stopPropagation(),this.$(".vault__browse").removeClass("vault__browse--expanded"),this.subview.isPaywalled||"page"===this.model.get("context")&&("function"==typeof omniTrackEv&&omniTrackEv("archive-print"),this.model.DEBUG&&console.log("vault: print"),this.subview.print())},Vault.prototype.errorTemplate=Time.templates["vault-error"],Vault.prototype.renderError=function(code,data){var errorMessageHtml;return null==code&&(code=0),null==data&&(data={}),this.model.DEBUG&&console.log("rendering error"),this.isError=!0,this.model.set({context:"error"},{silent:!0}),this.clearContext(),this.$el.removeClass("vault--nocontext").addClass("vault--error"),this.$(".vault__body").removeClass("loading-overlay"),this.$(".vault__browse").removeClass("vault__browse--expanded"),errorMessageHtml=this.errorTemplate.render({message:this.getErrorMessage(code,data)}),this.$(".vault__body").html(errorMessageHtml),this.trigger("rendered"),!1},Vault.prototype.getErrorMessage=function(code,data){var errorMessage;switch(null==code&&(code=0),null==data&&(data={}),errorMessage="Unknown error occurred.",code){case this.E_INVALID_DATE:errorMessage="Magazine not found",data.technicalMessage="Invalid date";break;case this.E_MISSING_VAULT:errorMessage="Magazine not found",data.technicalMessage="Missing vault object";break;case this.E_NO_PAGES:errorMessage="Magazine not found",data.technicalMessage="No pages found for magazine"}return console.error("Vault ERROR: ",errorMessage,data),errorMessage},Vault.prototype.clearSelecters=function(){return this.$("#vaultSelectYear").val(null).selecter("update"),this.$("#vaultSelectSubject").val(null).selecter("update"),this},Vault.prototype.clearContext=function(){var _base;return this.zoom=0,this.setZoomClasses(),this.$el.removeClass("vault--paywalled vault--error"),null!=this.subview&&(this.stopListening(this.subview),this.subview.stopListening(),this.subview.isRenderingAds=!1,"function"==typeof(_base=this.subview).destroyAds&&_base.destroyAds(),this.subview=null),this.resize(),this},Vault.prototype.changeContext=function(context){return null==context&&(context=this.model.get("context")),this.model.DEBUG&&console.log("vault: changeContext",context),this.isLoadingVault=!1,this.clearContext(),this.setContextClasses(context),this.setCoverPageClasses(),this.renderContextPaginator(context),this.subview=this.createSubview(context),this},Vault.prototype.createSubview=function(context){var contextOptions;switch(null==context&&(context="covers"),this.model.DEBUG&&console.log("vault: createSubview",context),contextOptions={vault:this,model:this.model,collection:this.collection},context){case"covers":return new Time.views.VaultCovers(contextOptions);case"page":case"spread":return new Time.views.VaultPage(contextOptions);case"pages":return new Time.views.VaultPages(contextOptions)}return this.createSubview("covers")},Vault.prototype.onSubviewRendered=function(){var magazine,_ref;return this.$(".vault__body").removeClass("loading-overlay"),this.subview.isPaywalled?void this.$el.addClass("vault--paywalled"):(this.$el.removeClass("vault--paywalled"),magazine=this.model.get("magazine"),("page"===(_ref=this.model.get("context"))||"spread"===_ref)&&(this.renderPageCounter(),this.renderPageArrows(),this.setShare(),this.bindSwipe()),"page"===this.model.get("context")&&this.renderBuyLink(magazine.get("buyLink")),void("covers"===this.model.get("context")&&this.setInProgressPosition()))},Vault.prototype.setInProgressPosition=function(){return this.$el.height()<$("#notTheHeader").height()?this.$(".vault__inprogress").css("position","absolute"):this.$(".vault__inprogress").css("position","relative"),this},Vault.prototype.render=function(){return this.model.DEBUG&&console.log("rendering VaultView"),this.$(".vault__browse").removeClass("vault__browse--expanded"),null==this.subview&&(this.subview=this.createSubview(this.model.get("context"))),this.subview.setElement(this.$(".vault__body")),this.subview.render(),"covers"!==this.model.get("context")&&this.renderToc(),this.$el.removeClass("vault--nocontext"),this.trigger("rendered"),this},Vault.prototype.setContextClasses=function(context){var contextClass,contextClassPrefix,otherClasses;return context=this.model.validateContext(context),contextClassPrefix="vault__context__",contextClass=contextClassPrefix+context,otherClasses=_.map(this.model.VALID_CONTEXTS,function(otherContext){return contextClassPrefix+otherContext}),this.$el.removeClass(otherClasses.join(" ")).addClass(contextClass),this},Vault.prototype.setCoverPageClasses=function(page){var _ref;return null==page&&(page=this.model.get("page")),"page"!==(_ref=this.model.get("context"))&&"spread"!==_ref||0!==parseInt(page,10)?this.$el.removeClass("vault__page__cover"):this.$el.addClass("vault__page__cover"),this},Vault.prototype.setZoomClasses=function(zoom){return null==zoom&&(zoom=0),this.$(".vault__zoom__in").toggleClass("vault__zoom__active",zoom>0),this.$el.removeClass("vault__zoom__0 vault__zoom__1 vault__zoom__2").addClass("vault__zoom__"+zoom),this},Vault.prototype.renderPaginator=function(options){return null==options&&(options={}),this.model.DEBUG&&console.log("vault: renderPaginator",options),null==options.html&&(options.html=this.model.getYear()),null==options.prevLimit&&(options.prevLimit=this.model.getYear()<=this.model.YEAR_MIN),null==options.nextLimit&&(options.nextLimit=this.model.getYear()>=this.model.YEAR_MAX),this.$(".vault__paginator__text").html(options.html),this.$(".vault__paginator__prev").toggleClass("vault__arrow--limit",options.prevLimit),this.$(".vault__paginator__next").toggleClass("vault__arrow--limit",options.nextLimit),this},Vault.prototype.renderContextPaginator=function(context){var magazine,_ref,_ref1;switch(null==context&&(context=this.model.get("context")),context){case"pages":case"spread":case"page":return magazine=this.model.get("magazine"),this.renderPaginator({html:magazine.getPaginatorHtml(),prevLimit:!(null!=(_ref=magazine.get("vault"))?_ref.prevVault:void 0),nextLimit:!(null!=(_ref1=magazine.get("vault"))?_ref1.nextVault:void 0)});default:if("subject"===this.model.get("filterType"))return this.model.DEBUG&&console.log("vault: renderContextPaginator",this.model.getPrettySubject()),this.renderPaginator({html:this.model.getPrettySubject(),prevLimit:!0,nextLimit:!0})}return this.renderPaginator()},Vault.prototype.renderFilterClass=function(filterType){return null==filterType&&(filterType=this.model.get("filterType")),this.$el.toggleClass("vault__filter--year","year"===filterType).toggleClass("vault__filter--subject","subject"===filterType),this},Vault.prototype.onChangeYearSelecter=function(value){"function"==typeof omniTrackEv&&omniTrackEv("archive-year-click"),(this.isError||this.isHardReload)&&value?window.location.href="/vault/year/"+value+"/":(this.$(".vault__browse").removeClass("vault__browse--expanded"),value&&this.model.setYear(value),this.clearSelecters())},Vault.prototype.onChangeSubjectSelecter=function(value){"function"==typeof omniTrackEv&&omniTrackEv("archive-subject-click"),(this.isError||this.isHardReload)&&value?window.location.href="/vault/subject/"+value+"/":(this.$(".vault__browse").removeClass("vault__browse--expanded"),value&&this.model.setSubject(value),this.clearSelecters())},Vault.prototype.onToggleSelecter=function(e){var $selected,$selecter,eventName,wasClosed;$selected=$(e.currentTarget),$selecter=$selected.closest(".selecter"),wasClosed=$selecter.hasClass("open")||$selecter.hasClass("mobile"),wasClosed&&(eventName=$selected.closest("[data-event]").data("event"),"undefined"!=typeof console&&null!==console&&console.log("firing omniture for eventName "+eventName),null!=eventName&&"function"==typeof omniTrackEv&&omniTrackEv(eventName))},Vault.prototype.renderHeader=function(isHardReload){var $selectSubject,$selectYear;return this.isHardReload=null!=isHardReload?isHardReload:!1,$selectYear=this.$("#vaultSelectYear"),$selectYear.prepend('<option disabled="disabled">Complete archive still in progress</option>'),$selectYear.selecter({customClass:"vault__selecter",label:"Browse by year",callback:this.onChangeYearSelecter}),this.$(".vault__browse__year").add(".vault__browse__year .selecter-options").width(this.$("#vaultSelectYear").width()),$selectYear.parent(".selecter").on("click.selecter",".selecter-selected",this.onToggleSelecter),$selectSubject=this.$("#vaultSelectSubject"),$selectSubject.selecter({customClass:"vault__selecter",label:"Browse by subject",callback:this.onChangeSubjectSelecter}),this.$(".vault__browse__subject").width(this.$("#vaultSelectSubject").width()),$selectSubject.parent(".selecter").on("touchstart.selecter click.selecter",".selecter-selected",this.onToggleSelecter),this.app.placeholderPolyfill(".vault__search form","#vaultSearchInput"),this.renderHeaderIE9(),this},Vault.prototype.renderHeaderIE9=function(){return 9!==document.documentMode?this:(this.$(".vault__browse__year .selecter-options").css({width:this.$("#vaultSelectYear").width()+18,overflowY:"scroll"}),this.$(".vault__browse__subject .selecter-options").css({width:this.$("#vaultSelectSubject").width()+18,overflowY:"scroll"}),this)},Vault.prototype.onChangeTOCSelecter=function(value){return"function"==typeof omniTrackEv&&omniTrackEv("archive-toc-click"),value&&_.defer(function(){return window.location.href=value}),!1},Vault.prototype.renderToc=function(html){var $selectTOC;return null==html&&(html=this.getTocOptionsHtml()),this.$("#vaultSelectToc").data("magazineId")!==this.model.get("magazine").id?($selectTOC=this.$("#vaultSelectToc"),$selectTOC.selecter("destroy").empty(),this.$(".vault__toc").width("auto"),$selectTOC.html(html).data("magazineId",this.model.get("magazine").id).selecter({customClass:"vault__selecter",label:"Table of Contents",callback:this.onChangeTOCSelecter}),this.$(".vault__toc").width(this.$("#vaultSelectToc").width()),$selectTOC.parent(".selecter").on("touchstart.selecter click.selecter",".selecter-selected",this.onToggleSelecter),this):void 0
},Vault.prototype.renderPageArrows=function(){var nextLimit;return this.$(".vault__page__prev .vault__arrow").toggleClass("vault__arrow--limit",this.model.get("page")<=0),nextLimit="page"===this.model.get("context")?this.model.get("page")>=this.model.get("magazine").getTotalPages()-1:this.model.get("page")+1>=this.model.get("magazine").getTotalPages()-1,this.$(".vault__page__next .vault__arrow").toggleClass("vault__arrow--limit",nextLimit),this},Vault.prototype.renderPageCounter=function(current,total){var text;return null==current&&(current=this.model.get("page")),null==total&&(total=this.model.get("magazine").getTotalPages()),null==total&&(total="1"),text=current+1+"/"+total,this.$(".vault__page__counter__text").text(text),this},Vault.prototype.renderBuyLink=function(href){return null==href&&(href=this.model.get("magazine").getBuyLink()),this.$(".vault__page__buy").attr("href",href).toggleClass("vault__page__buy--haslink",!!href.length),this},Vault.prototype.getZoomedSrc=function($img,zoom){return $img.data(zoom?"zoom"+zoom:"original")},Vault.prototype.renderZoom=function(value,previousValue){var $img,$preloader,currentSrc,newSrc,_base;return null==value&&(value=0),null==previousValue&&(previousValue=null),"page"===this.model.get("context")?($img=this.$(".vault__page__image img"),currentSrc=$img.attr("src"),null==(_base=this.subview).originalSrc&&(_base.originalSrc=currentSrc),value>0&&value>this.MAX_ZOOM_LEVEL&&(value=0),newSrc=this.getZoomedSrc($img,value),this.$el.addClass("vault__zoom__loading"),$preloader=$("<img />"),$preloader.one("load",function(_this){return function(){$img.attr("src",newSrc),_this.$el.removeClass("vault__zoom__loading"),_this.setZoomClasses(value),_this.zoom=value}}(this)),$preloader[0].src=newSrc,this):void 0},Vault}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.Vertical=function(_super){function Vertical(){return Vertical.__super__.constructor.apply(this,arguments)}return __extends(Vertical,_super),Vertical.prototype.el="body",Vertical.prototype.initialize=function(options){return this.vertical=options.vertical,this.app=options.app,this.app.model.set("isInitialRoute",!1),this.app.is_homepage=!0,this.app.is_money_homepage=!0,this.app.active_route="home",this.rail_view=new Time.views.LeftRail({app:this.app}),this.app.load_tabs(Time.tab_data["default"]),this.app.tabs_view.set_active(0),this.app.resizeContent(),this.render_market_data(),this.app.placeholderPolyfill(".quote-search",".quote-search-input"),Time.trigger("vertical:ads:activate",this.vertical),Time.trigger("dfpAdManager:setInitialAppLoad",!1),this.app.hasPushstate||$("body").removeClass("hidden"),Time.trigger("vertical:initialized"),this},Vertical.prototype.render_market_data=function(){var marketDataView;return marketDataView=new Time.views.MarketDataView,Time.marketdata_refresh=setInterval(function(_this){return function(){return _this.app.is_homepage?marketDataView=new Time.views.MarketDataView:void 0}}(this),5e3),this},Vertical}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.LeftRailModule=function(_super){function LeftRailModule(){return LeftRailModule.__super__.constructor.apply(this,arguments)}return __extends(LeftRailModule,_super),LeftRailModule.prototype.tagName="div",LeftRailModule.prototype.className="leftRailModule",LeftRailModule.prototype.initialize=function(options){var _ref,_ref1,_ref2;return null==options&&(options={}),this.isRendered=!1,(null!=(_ref=options.$el)?_ref.length:void 0)&&this.setElement(options.$el),null!=options.parent&&(this.parent=options.parent,this.$parent=this.parent.$el,this.collection=this.parent.collection),(null!=(_ref1=options.$parent)?_ref1.length:void 0)&&(this.$parent=options.$parent),options.collection&&(this.collection=options.collection),this.isRendered=(null!=(_ref2=this.$parent)?_ref2.find(this.$el).length:void 0)>0,this},LeftRailModule.prototype.getScrollContainer=function(){var _ref,_ref1;return null!=(_ref=this.collection)&&null!=(_ref1=_ref.view)?_ref1.$scroll_container:void 0},LeftRailModule.prototype.make_visible=function(){var container_outerheight,container_padding_top,container_scroll_y,elTop,el_bottom_y;null==this.$scrollContainer&&(this.$scrollContainer=this.getScrollContainer()),0===this.$el.length&&this.setElement($("#article-"+this.model.id)),elTop=this.$el.position().top,0>elTop?(container_scroll_y=this.$scrollContainer.scrollTop(),container_padding_top=parseInt(this.$parent.css("paddingTop"),10),this.$scrollContainer.scrollTop(elTop+container_scroll_y-container_padding_top)):elTop>this.$scrollContainer.height()-this.$el.outerHeight()-$(".scroll-for-more").outerHeight()&&(el_bottom_y=elTop+this.$el.outerHeight()+$(".scroll-for-more").outerHeight()+10,container_scroll_y=this.$scrollContainer.scrollTop(),container_outerheight=this.$scrollContainer.height(),this.$scrollContainer.scrollTop(el_bottom_y+container_scroll_y-container_outerheight)),"undefined"!=typeof Tether&&null!==Tether&&Tether.position()},LeftRailModule}(Backbone.View);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.ArticleTile=function(_super){function ArticleTile(){return ArticleTile.__super__.constructor.apply(this,arguments)}return __extends(ArticleTile,_super),ArticleTile.prototype.template=function(){return null!=this.model.get("sponsor")?Time.templates["article-tile-sponsored"]:null!=this.model.get("tax")?Time.templates["article-tile-section-front"]:Time.templates["article-tile"]},ArticleTile.prototype.type="article",ArticleTile.prototype.initialize=function(options){var _ref;return null==options&&(options={}),null==options.$parent&&(options.$parent=this.collection.view.$el),null==options.$el&&(options.$el=null!=(_ref=options.$parent)?_ref.find('[data-article="'+this.model.id+'"]'):void 0),ArticleTile.__super__.initialize.apply(this,arguments),this.bindListeners(),this},ArticleTile.prototype.bindListeners=function(){return this.listenTo(this.model,"change:isActive",function(_this){return function(model,value){var _ref,_ref1;value&&(null!=(_ref=_this.collection)&&null!=(_ref1=_ref.view)?_ref1.jump_to_active_tiles:void 0)&&_this.make_visible(),_this.$el.toggleClass("active",value)}}(this)),this},ArticleTile.prototype.render=function(){var html;return this.isRendered||(html=this.template().render(this.model.toJSON()),this.setElement($(html)),this.$el.appendTo(this.$parent)),Time.trigger("leftRail:tile:rendered",this),this},ArticleTile}(Time.views.LeftRailModule);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.CollapsibleModule=function(_super){function CollapsibleModule(){return CollapsibleModule.__super__.constructor.apply(this,arguments)}return __extends(CollapsibleModule,_super),CollapsibleModule.prototype.template=Time.templates["lrm-collapsible"],CollapsibleModule.prototype.events={"click [data-toggle-collapsible]":"onToggle","click [data-toggle-expand]":"onExpand","click [data-toggle-collapse]":"onCollapse"},CollapsibleModule.prototype.initialize=function(options){var collapsibleEl;return null==options&&(options={}),CollapsibleModule.__super__.initialize.apply(this,arguments),this.childViews=[],null!=options.isExpanded&&null==this.isExpanded&&(this.isExpanded=options.isExpanded),null==this.isExpanded&&(this.isExpanded=!0),this.isRendered||(collapsibleEl=this.template.render({isExpanded:this.isExpanded}),this.setElement(collapsibleEl)),this.listenTo(this,"expanded",function(){Time.trigger("leftRail:collapsible:expanded",this)}),this.listenTo(this,"collapsed",function(){Time.trigger("leftRail:collapsible:collapsed",this)}),this},CollapsibleModule.prototype.onToggle=function(e){return e.preventDefault(),this.toggle()},CollapsibleModule.prototype.onExpand=function(e){return e.preventDefault(),this.expand()},CollapsibleModule.prototype.onCollapse=function(e){return e.preventDefault(),this.collapse()},CollapsibleModule.prototype.toggle=function(){return this.isExpanded?this.collapse():this.expand()},CollapsibleModule.prototype.expand=function(){return this.$el.addClass("leftRailModule--collapsible--expanded"),this.$el.removeClass("leftRailModule--collapsible--collapsed"),this.isExpanded=!0,this.trigger("expanded",this),this},CollapsibleModule.prototype.collapse=function(){return this.$el.addClass("leftRailModule--collapsible--collapsed"),this.$el.removeClass("leftRailModule--collapsible--expanded"),this.isExpanded=!1,this.trigger("collapsed",this),this},CollapsibleModule}(Time.views.LeftRailModule);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.ArticleCollectionsTile=function(_super){function ArticleCollectionsTile(){return ArticleCollectionsTile.__super__.constructor.apply(this,arguments)}return __extends(ArticleCollectionsTile,_super),ArticleCollectionsTile.prototype.template=Time.templates["article-tile-collection"],ArticleCollectionsTile.prototype.type="collections",ArticleCollectionsTile.prototype.initialize=function(options){var _ref;return null==options&&(options={}),null==options.$parent&&(options.$parent=$("#hub-"+this.model.get("hub_id"))),null==options.$el&&(options.$el=null!=(_ref=options.$parent)?_ref.find("#article-tile-"+this.model.id):void 0),ArticleCollectionsTile.__super__.initialize.apply(this,arguments),this},ArticleCollectionsTile.prototype.bindListeners=function(){this.listenTo(this.model,"change:isActive",function(_this){return function(model,value){var collapsible,_ref,_ref1,_ref2;value&&model.get("hub_id")&&(collapsible=_this.$el.closest(".leftRailModule--collapsible"),null!=(_ref=collapsible.data("collapsible"))&&_ref.expand()),(null!=(_ref1=_this.collection)&&null!=(_ref2=_ref1.view)?_ref2.jump_to_active_tiles:void 0)&&_this.make_visible(),_this.$el.toggleClass("active",value),_this.model.get("last_article")&&Time.application.$viewport.toggleClass("loading")}}(this))},ArticleCollectionsTile.prototype.render=function(){var html;return this.isRendered||(html=this.template.render(this.model.toJSON()),this.setElement($(html)),this.$el.appendTo(this.$parent),this.model.get("isActive")&&this.model.maybeNavigateTo()),Time.trigger("leftRail:tile:rendered",this),this},ArticleCollectionsTile}(Time.views.ArticleTile);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.MagazineCollapsible=function(_super){function MagazineCollapsible(){return MagazineCollapsible.__super__.constructor.apply(this,arguments)}return __extends(MagazineCollapsible,_super),MagazineCollapsible.prototype.coverTemplate=Time.templates["lrm-magazine-cover"],MagazineCollapsible.prototype.initialize=function(options){var coverHtml;return null==options&&(options={}),null==options.$parent&&(options.$parent=this.collection.view.$el),options.isExpanded=this.model.get("isActive"),MagazineCollapsible.__super__.initialize.apply(this,arguments),coverHtml=this.coverTemplate.render(this.model.toJSON()),this.$el.prepend(coverHtml),this.$coverTile=this.$(".rail-article-magazine-cover"),this.bindListeners(),this},MagazineCollapsible.prototype.bindListeners=function(){return this.listenTo(this.model,"change:isActive",function(_this){return function(model,value){_this.$coverTile.toggleClass("active",value),value&&(_this.collection.view.scroll_freeze||_this.make_visible(),_this.expand())}}(this)),this},MagazineCollapsible.prototype.render=function(){return this.$el.appendTo(this.$parent),Time.trigger("leftRail:tile:rendered",this),this},MagazineCollapsible}(Time.views.CollapsibleModule);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.MagazineTile=function(_super){function MagazineTile(){return MagazineTile.__super__.constructor.apply(this,arguments)}return __extends(MagazineTile,_super),MagazineTile.prototype.template=function(){return Time.templates["lrm-magazine-article"]},MagazineTile.prototype.initialize=function(options){return null==options&&(options={}),MagazineTile.__super__.initialize.apply(this,arguments),this.cover=options.cover,this},MagazineTile.prototype.bindListeners=function(){return this.listenTo(this.model,"change:isActive",function(_this){return function(model,value){var _ref;value&&(_this.collection.view.scroll_freeze||_this.make_visible(),null!=(_ref=_this.cover)&&_ref.expand()),_this.$el.toggleClass("active",value)}}(this)),this},MagazineTile}(Time.views.ArticleTile),Time.views.MarketDataView=Backbone.View.extend({el:".market-data-module",$el:$(this.el),template:Time.templates["market-data"],initialize:function(){var that;return _.bindAll(this,"render"),this.collection=new Time.collections.MarketData,that=this,this.collection.fetch({success:function(){return that.render()}})},render:function(){var date,day,days,html,marketData,marketDataArray,recentStockDateString,recentStockTimestamp,sortedStockList;return days=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],marketDataArray=this.collection.toJSON(),-1===location.href.indexOf("/money")&&(marketDataArray=function(){var _i,_len,_results;for(_results=[],_i=0,_len=marketDataArray.length;_len>_i;_i++)marketData=marketDataArray[_i],"10-YR BOND"!==marketData.label&&_results.push(marketData);return _results}()),_.each(marketDataArray,function(mData,i){return mData.changePercent=parseFloat(mData.changePercent).toFixed(2),mData.change=parseFloat(mData.change).toFixed(2),marketDataArray[i]=mData}),html=$(this.template.render({marketdata:marketDataArray})),sortedStockList=_(marketDataArray).sortBy(function(x){return x.timestamp}).pop(),recentStockTimestamp=sortedStockList.timestamp,date=new Date(1e3*parseInt(recentStockTimestamp,10)),day=days[date.getDay()],recentStockDateString="As of "+day+" "+sortedStockList.dateTimeString,$(".market-data-module").html(html),$(".idc-timestamp").html(""),$(".idc-timestamp").html(recentStockDateString),this.bind_events()},bind_events:function(){return $(".idc-tablestyle tbody tr").each(function(){var perChange;return perChange=parseFloat($(this).find(".idc-td-perchange span").html(),10),perChange>0?($(this).find(".idc-td-perchange span").addClass("idc-changeup"),$(this).find(".idc-td-change span").addClass("idc-changeup")):0>perChange?($(this).find(".idc-td-perchange span").addClass("idc-changedown"),$(this).find(".idc-td-change span").addClass("idc-changedown")):($(this).find(".idc-td-perchange span").addClass("idc-changedown").addClass("idc-change-none"),$(this).find(".idc-td-change span").addClass("idc-changenone"))})}});var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.NativoArticleTile=function(_super){function NativoArticleTile(){return NativoArticleTile.__super__.constructor.apply(this,arguments)}return __extends(NativoArticleTile,_super),NativoArticleTile.prototype.template=Time.templates["article-tile-sponsored"],NativoArticleTile.prototype.type="sponsored",NativoArticleTile.prototype.getData=function(){var data;return data=this.model.toJSON(),null==data.sponsor&&(data.sponsor={}),Time.application.isMoney()&&(data.sponsor.vertical="money"),data},NativoArticleTile.prototype.render=function(){var $previous_tile,html,previous_model,previous_model_index,previous_tile_id;return html=this.template.render(this.getData()),this.setElement($(html)),this.model.get("is_nativo_page")?(this.$el.appendTo(this.$parent),Time.trigger("leftRail:tile:rendered",this)):($previous_tile=this.$parent.find(".rail-article").eq(this.model.get("placement")),previous_tile_id=$previous_tile.data("article"),$previous_tile.after(this.$el),previous_model=this.collection.get(previous_tile_id),previous_model_index=this.collection.indexOf(previous_model),this.collection.move_model(this.model,previous_model_index+1)),this},NativoArticleTile}(Time.views.ArticleTile);var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.PoyPollCollapsible=function(_super){function PoyPollCollapsible(){return this.onClick=__bind(this.onClick,this),this.onPinnionEvent=__bind(this.onPinnionEvent,this),PoyPollCollapsible.__super__.constructor.apply(this,arguments)}return __extends(PoyPollCollapsible,_super),PoyPollCollapsible.prototype.events={"click .leftRailMoule--poy-poll":"onClick"},PoyPollCollapsible.prototype.pollTemplate=Time.templates["lrm-poy-poll"],PoyPollCollapsible.prototype.AUTO_COLLAPSE_TIMEOUT_DELAY=8e3,PoyPollCollapsible.prototype._autoCollapseTimeout=null,PoyPollCollapsible.prototype.isUserInteracted=!1,PoyPollCollapsible.prototype.isAdsRefreshable=!1,PoyPollCollapsible.prototype.AD_ID="LeftRailPoyPollAd",PoyPollCollapsible.prototype.AD_SIZES=["300x50","320x50"],PoyPollCollapsible.prototype.initialize=function(options){return null==options&&(options={}),_.extend(this.events,Time.views.CollapsibleModule.prototype.events),options.isExpanded=!0,PoyPollCollapsible.__super__.initialize.apply(this,arguments),this.createDOM(),this.listenTo(Time,"leftRail:scroll",function(){Tether.position()}),this.listenTo(Time,"leftRail:opened",function(_this){return function(){_this.isUserInteracted||_.defer(function(){return _this.autoCollapse()})}}(this)),this.listenTo(this,"expanded",function(){this.isUserInteracted=!0,window.clearTimeout(this._autoCollapseTimeout),"function"==typeof omniTrackEv&&omniTrackEv("lr_fpoll_open"),this.$(".leftRailModule--poy-poll__toggle").text("Close")}),this.listenTo(this,"collapsed",function(){this.isUserInteracted=!0,window.clearTimeout(this._autoCollapseTimeout),this.$(".leftRailModule--poy-poll__toggle").text("Open")}),this.listenTo(Time,"dfpAdManager:callback:hide",function(_this){return function(adId){var _ref;adId===_this.AD_ID&&(null!=(_ref=_this.$ad)?_ref.length:void 0)&&(_this.$(".leftRailModule--poy-poll__ad").toggle(!_this.$ad.hasClass("hide-ad")),Tether.position())}}(this)),this.listenToOnce(Time,"dfpAdManager:change:isInitialLeftRailCycle",function(_this){return function(){_this.isAdsRefreshable=!0}}(this)),this},PoyPollCollapsible.prototype.createDOM=function(){var pollHtml;return pollHtml=this.pollTemplate.render({titleLink:"http://time.com/3562166/time-person-of-the-year-face-off-poll/",title:'<span class="timered">Face-Off:</span> Choose who should be TIME\'s Person of the Year',fullPollLink:"http://time.com/3562166/time-person-of-the-year-face-off-poll/"}),this.$el.html(pollHtml),this.$pollEmbed=$("#LeftRailPoyPollEmbed"),this.$pollEmbed.length||(this.$pollEmbed=$("<div />",{id:"LeftRailPoyPollEmbed"}),this.$pollEmbed.html(Time.bootstrap.poy_faceoff)),this.$ad=$("#"+this.AD_ID),this.$ad.length||(this.$ad=$("<div />",{id:this.AD_ID})),this},PoyPollCollapsible.prototype.render=function(before){var adParams,adTetherOptions,appendAd,embedTetherOptions,moveElement;return null==before&&(before=!0),before&&this.$el.prependTo(this.$parent),before||this.$el.appendTo(this.$parent),this.$embedContainer=this.$(".leftRailModule--poy-poll__embed"),this.$pollEmbed.appendTo(this.$embedContainer).css("display","block"),this.$embedContainer.height(this.$pollEmbed.height()||this.$pollEmbed.find("iframe").height()),embedTetherOptions={enabled:!0,element:this.$pollEmbed,target:this.$embedContainer,attachment:"top center",targetAttachment:"top center",constraints:[{to:"scrollParent"}],optimizations:{moveElement:!1}},this.tetheredEmbed=new Tether(embedTetherOptions),this.$pollEmbed.data("tether",this.tetheredEmbed),this.$adContainer=this.$(".leftRailModule--poy-poll__ad"),appendAd="body",moveElement=!0,"desktop"!==Time.device&&(appendAd=this.$adContainer,moveElement=!1),this.$ad.appendTo(appendAd),adTetherOptions={enabled:!0,element:this.$ad,target:this.$adContainer,attachment:"top center",targetAttachment:"top center",constraints:[{to:"scrollParent"}],optimizations:{moveElement:moveElement}},this.tetheredAd=new Tether(adTetherOptions),this.$ad.data("tether",this.tetheredAd),adParams={id:this.AD_ID,size:this.AD_SIZES,position:0,group:"leftRail-poypoll",extraParams:{poll:"poy"},renderOnce:!0},Time.trigger("dfpAdManager:activateAd",null,adParams),$(window).off("pinnionEvent.leftRail").on("pinnionEvent.leftRail",this.onPinnionEvent),Time.trigger("leftRail:tile:rendered",this),this},PoyPollCollapsible.prototype.onPinnionEvent=function(e){var data;if(null!=e.originalEvent){if(data=JSON.parse(e.originalEvent.data),window.clearTimeout(this._autoCollapseTimeout),data.events.height_change)return this.$embedContainer.height(this.$pollEmbed.height()||this.$pollEmbed.find("iframe").height()),Tether.position(),void(!this.isUserInteracted&&Time.application.model.get("isRailOpen")&&_.defer(function(_this){return function(){return _this.autoCollapse()}}(this)));this.isUserInteracted=!0,this.isAdsRefreshable&&(data.events.q_advance||data.events.q_previous)&&Time.trigger("dfpAdManager:refreshAds",null,[this.AD_ID])}},PoyPollCollapsible.prototype.autoCollapse=function(){return window.clearTimeout(this._autoCollapseTimeout),this._autoCollapseTimeout=window.setTimeout(function(_this){return function(){return _this.isUserInteracted?void 0:_this.collapse()}}(this),this.AUTO_COLLAPSE_TIMEOUT_DELAY),this},PoyPollCollapsible.prototype.onClick=function(){window.clearTimeout(this._autoCollapseTimeout),this.isUserInteracted=!0},PoyPollCollapsible}(Time.views.CollapsibleModule),Time.views.Tabs=Backbone.View.extend({el:".rail-tabs",template:Time.templates["rail-tabs"],events:{click:"load_rail"},initialize:function(display_data,el_selector){return null!=el_selector&&el_selector&&!Time.application.breakpoints.medium.is_beneath&&(this.el=el_selector),this.render(display_data),this},render:function(display_data){return"undefined"!=typeof console&&null!==console&&console.dir(display_data),$(this.template.render(display_data)).appendTo(this.$el)},load_rail:function(e){var $el,env,pos,sub;return $el=$(e.target),$el.is(".rail-tab")?$el.hasClass("active")?!1:(pos=this.$el.index($el),env=$el.attr("id"),sub=$el.attr("data-sub"),this.set_active(env||0),null!=$el.data("event")?omniTrackEv($el.data("event")):void 0):e},set_active:function(env){return this.$(".rail-tab").removeClass("active"),"number"==typeof env?this.$(".rail-tab").eq(0).addClass("active"):this.$(".rail-tab#"+env).addClass("active"),this},destroy:function(){return this.undelegateEvents(),this.$el.removeData().unbind().empty(),this}});var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.views.TextModule=function(_super){function TextModule(){return TextModule.__super__.constructor.apply(this,arguments)}return __extends(TextModule,_super),TextModule.prototype.template=Time.templates["lrm-text"],TextModule.prototype.type="text",TextModule.prototype.initialize=function(options){var _ref;return null==options&&(options={}),TextModule.__super__.initialize.apply(this,arguments),this.data=options.data||(null!=(_ref=this.model)?_ref.toJSON():void 0),null==this.data&&(this.data={}),this},TextModule.prototype.render=function(){var html;return this.isRendered||(html=this.template.render(this.data),this.setElement($(html)),this.$el.appendTo(this.$parent)),this},TextModule}(Time.views.LeftRailModule),Time.views.Poll=Backbone.View.extend({template:Time.templates["poll-module"],events:{"click .user-poll-button-primary":"fetch_results","click .user-poll-button-secondary":"fetch_results"},initialize:function(){return this.render()},render:function(){var html;return html=this.template.render(this.model.toJSON()),this.setElement(html)},fetch_results:function(){return this.model.fetch_results(),!1},display_results:function(){return this.results||(this.results=new Time.models.PollResult({model:this.model.get("results")})),this.$el.append(this.results.view.$el).addClass("show-results")}}),Time.views.PollResult=Backbone.View.extend({template:Time.templates["poll-results"],events:{"click .return-to-poll":"show_options"},initialize:function(){return this.render(),this.animate_graphs()},render:function(){var html;return html=this.template.render(this.model.get("model")),this.setElement(html)},animate_graphs:function(){return setTimeout(function(_this){return function(){var graphs;return graphs=_this.$(".user-poll-graph-filled"),graphs.each(function(i,thisEl){return $(thisEl).css({width:_this.model.get("model").options[i].percentage+"%"})})}}(this),500)},show_options:function(){return this.$el.closest($(".show-results")).removeClass("show-results"),!1}}),Time.views.TickerHeadline=Backbone.View.extend({template:Time.templates["article-single-header-video"],events:{"click .ticker-tweet":"Time.application.open_popup"},initialize:function(){return this.render()},render:function(){var articles,recentVideo1,recentVideo2,videos,videosJsonArray;return articles=this.model.get("articles"),videos=_(articles).shuffle(),recentVideo1=videos[0],recentVideo2=videos[1],videosJsonArray={articles:[recentVideo1,recentVideo2]},this.setElement($(this.template.render(videosJsonArray))),this.bind_events(),this.$el},bind_events:function(){return this.$el.on("isCurrent",$.proxy(this.updateTweeterButton,this))},updateTweeterButton:function(){var tw_link;return tw_link=Time.application.twitter_share_url(this.model.get("encoded_shortlink"),this.model.get("twitter_text"),this.model.get("twitter_via")),$(".ticker-tweet").attr("href",tw_link)}}),Time.views.TickerModule=Backbone.View.extend({template:Time.templates["ticker-module"],el:".top-banner",$el:$(this.el),items:[],$items:[],$itemContainer:{},circular:!0,height:66,events:{"click .next":"advance","click .prev":"recede"},initialize:function(){return this.listenTo(this,"ticker:recalc",function(_this){return function(){return _this.on_recalc()}}(this)),this.$tweet_btn=this.$(".ticker-tweet"),this.items=new Time.collections.Ticker,this.listenTo(this.items,"reset",function(_this){return function(){return _this.render()}}(this)),this.items.load_headlines(),this},render:function(){return this.html=this.template.render({}),this.$el.html($(this.html)),this.$itemContainer=this.$(".headlines"),this.$items=this.items.get_$items(),this.$itemContainer.html(this.$items),this.$items.length>0?(this.init_ticker(),this.handle_scaling()):void 0},enter_large:function(){return this.handle_scaling()},exit_large:function(){return this.handle_scaling()},init_ticker:function(at){return this.$items=this.items.get_$items(),this.initComponent(at?at:0),this.auto_play(5e3)},handle_scaling:function(){return this},on_recalc:function(){var data;return data=this.items.models[this.getCurrentIndex()].toJSON(),this.$tweet_btn.data("href","https://twitter.com/intent/tweet?url="+encodeURIComponent(data.twitter_shortlink)+"&text="+data.twitter_text+"&via="+data.twitter_via),this.auto_play(5e3)}}),_.extend(Time.views.TickerModule.prototype,Time.component.Ticker.prototype,Backbone.Events);var Time;Time=window.Time||(window.Time={}),_(Time).extend(Backbone.Events),window.TIME_onTemplateLoad=function(id){console.log("BrightCove on Template ========================================"),Time.trigger("brightcove:template:load",id)},window.TIME_onTemplateReady=function(e){console.log("BrightCove on Ready ========================================"),Time.trigger("brightcove:template:ready",e)},Time.initial_gallery_slug=!1,Time.$_GET={},Time.taboola_counter=0,null==Time.bootstrap&&(Time.bootstrap={}),Time.application=new Time.views.Application,$(function(){var fragment,isSilentStart,pathname;return Time.application.render(),Time.application.router=new Time.Router({app:Time.application}),fragment=null,isSilentStart=!Time.application.hasPushstate,$(".error404").length?(Time.page=new Time.views.error404({app:Time.application}),!1):$(".page-template-pagespage-special-story-php, .money-home, .masonry").length?(Backbone.history.start({pushState:!1,hashChange:!1}),!1):(Backbone.history.start({pushState:Time.application.hasPushstate,hashChange:!Time.application.hasPushstate,silent:isSilentStart}),void(Time.application.hasPushstate?Time.bootstrap.pathname=Backbone.history.fragment:(pathname=window.location.pathname.substr(Backbone.history.options.root.length),Time.bootstrap.pathname=pathname,$(".page-template-pagespage-vault-php").length&&(fragment=Backbone.history.fragment),fragment||(fragment=pathname),fragment||(fragment="index"),Backbone.history.navigate("/",{trigger:!1}),Backbone.history.navigate(fragment,{trigger:!0,replace:!0}))))});var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Time.Router=function(_super){function Router(){return Router.__super__.constructor.apply(this,arguments)}return __extends(Router,_super),Router.prototype.routes={"(/)":"index",index:"index","time_homepage/:homepage/":"index","money/magazine/":"moneyMagazine","money/popular/":"popular","money/videos/":"videos","money/topic/:topic/":"topic","money/page/:special/":"special","money/content-from/:sponsor/(:article_id/)(:article_slug/)":"moneySponsored","parents/":"parents","popular/":"popular","right-now/":"right_now","videos/":"videos","photography/(:section/)":"photography","tag/:tag/":"tag","topic/:topic/":"topic","author/:author/":"author","magazine/(:region/)(:magazine_id/)(:magazine_slug/)":"magazine","content-from/:sponsor/(:article_id/)(:article_slug/)":"sponsored","vault/(:filterType/)(:filterValue)(/)(:context)(/)(:page)(/)":"vault","time_vault/:id/":"vault","(:vertical)/homepage/(:money_homepage_slug/)":"vertical",":special/":"special"},Router.prototype.initialize=function(options){return this.app=null!=options?options.app:void 0,Time.author=!1,Time.curRoute={env:"",sub:""},this.listenTo(this,"route",function(route,params){console.log(""),console.log(" new route: ",route," params: ",params),console.log(""),Time.trigger("router:route",route,params)}),this.route(/^([0-9]+)\/([a-z0-9-]+)?(\/(item|photo)\/([a-z0-9-_]+))?(\/)?/,"article"),this.route(/^(business|culture|history|living|life|lightbox|entertainment|health|ideas|newsfeed|opinion|politics|science|sports|style|tech|us|world)\/?$/,"section"),this.route(/^collection\/([a-z0-9-]+)\/([a-z0-9-]+)?/,"collection"),this.route(/^(collection|tag|topic)\/([a-z0-9-]+)\/grid\/?$/,"photography"),this.route(/^money\/([0-9]+)\/([a-z0-9-]+)?(\/(item|photo)\/([a-z0-9-_]+))?(\/)?/,"article"),this.route(/^money\/(retirement|everyday-money|real-estate|careers|family-finance|investing)\/?$/,"section"),this.route(/^money\/collection\/([a-z0-9-]+)\/([a-z0-9-]+)?/,"collection"),this.route(/^(money)\/?$/,"vertical"),this
},Router.prototype._fragmentOverride=function(){var matched,params,route;if(Backbone.history.fragment)return null==this.routePairs&&(this.routePairs=_.pairs(this.routes)),route=null,matched=_.find(this.routePairs,function(_this){return function(pair){return route=_.isRegExp(pair[0])?pair[0]:_this._routeToRegExp(pair[0]),route.test(Backbone.history.fragment)}}(this)),matched&&(params=this._extractParameters(route,Backbone.history.fragment),route=matched[1],this[route].apply(this,params)),this},Router.prototype.isPreview=function(url){var regexIsPost,regexIsPreview;return regexIsPreview=/&preview=true/,regexIsPost=/\?p=/,regexIsPreview.test(url)||regexIsPost.test(url)},Router.prototype.index=function(){return this.isPreview(window.location.href)?this.preview():this.app.model.get("isInitialRoute")?void(Time.page=new Time.views.Homepage({app:this.app})):void window.location.reload()},Router.prototype.preview=function(){var isMoneyPage,isPage,matchesCollection,matchesCollectionMasonry,matchesMagazine,matchesPost,regexIsMoneyPage,regexIsPage,regexIsPost,regexMatchesCollection,regexMatchesCollectionMasonry,regexMatchesMagazine,regexMatchesPost;return regexIsPost=/\?p=/,regexIsPost.exec(window.location.href)?this.article(window.location.href.split("=")[1]):(regexIsMoneyPage=/money_page&p=([0-9]+)/,(isMoneyPage=regexIsMoneyPage.test(window.location.href))?this.special():(regexMatchesMagazine=/post_type=time_magazine&p=([0-9]+)/,matchesMagazine=regexMatchesMagazine.exec(window.location.href),(null!=matchesMagazine?matchesMagazine[1]:void 0)?this.magazine(null,matchesMagazine[1],null):(regexMatchesCollection=/post_type=time_collection&p=([0-9]+)/,matchesCollection=regexMatchesCollection.exec(window.location.href),regexMatchesCollectionMasonry=/&view=masonry/,matchesCollectionMasonry=regexMatchesCollectionMasonry.exec(window.location.href),null!=matchesCollection&&null!=matchesCollectionMasonry?this.photography("collection"):(null!=matchesCollection?matchesCollection[1]:void 0)?this.collection(matchesCollection[1],null):(regexMatchesPost=/p=([0-9]+)/,matchesPost=regexMatchesPost.exec(window.location.href),(null!=matchesPost?matchesPost[1]:void 0)?this.article(matchesPost[1]):(regexIsPage=/page_id=([0-9]+)/,(isPage=regexIsPage.test(window.location.href))?this.special():void console.error("Unmatched &preview=true route!"))))))},Router.prototype.right_now=function(){return this.app.getArticleCollection()},Router.prototype.article=function(articleId,article_slug,item_slug_raw,item_type,item_slug){var _ref;(null!=(_ref=this.app.active_rail)?_ref.is_collection:void 0)||this.app.model.get("isInitialRoute")&&Time.bootstrap.collection?null==articleId||this.app.model.get("isInitialRoute")?this.collection(Time.bootstrap.collection.collection_slug,null,articleId,item_slug):(this.app.load_article(articleId,item_slug),this.app.active_route="collection"):this.app.load_article(articleId,item_slug)},Router.prototype.section=function(section){this.app.getArticleCollection({env:"section",sub:section,open_rail:!0})},Router.prototype.author=function(author){Time.author=!0,this.app.getArticleCollection({env:"author",sub:author,open_rail:!0})},Router.prototype.topic=function(topic){this.app.getArticleCollection({env:"topic",sub:topic,open_rail:!0})},Router.prototype.tag=function(tag){this.app.getArticleCollection({env:"tag",sub:tag,open_rail:!0})},Router.prototype.magazine=function(region,magazine_id){return null!=magazine_id?void this.app.getArticleCollection({env:"magazine",sub:region,magazine_id:magazine_id}):void this.app.getArticleCollection({env:"magazine",sub:region})},Router.prototype.popular=function(){return this.app.getArticleCollection({env:"popular"})},Router.prototype.videos=function(){return this.app.getArticleCollection({env:"videos"})},Router.prototype.special=function(){Time.page=new Time.views.SpecialPage({app:this.app})},Router.prototype.setHubArticle=function(hubArticle){this.app.load_article(hubArticle.id)},Router.prototype.initialCollection=function(articleId,itemSlug){var _ref;null==articleId&&(articleId=null!=(_ref=Time.bootstrap.collection)?_ref.initial_time_hub_article_id:void 0),this.app.getArticleCollection({env:"collection",sub:null,sync_article_id:articleId,item_slug:itemSlug}),this.app.active_rail.freeze_url=!1,this.app.active_route="collection"},Router.prototype.initialCollectionHub=function(hubSlug){var hub,_ref,_ref1;hub=_.findWhere(null!=(_ref=Time.bootstrap.collection)?_ref.hubs:void 0,{slug:hubSlug}),null!=hub?(this.app.active_rail.freeze_url=!0,this.app.active_route="collection",this.setHubArticle(hub.articles[0]),this.app.active_rail.freeze_url=!1):window.location=(null!=(_ref1=Time.bootstrap.collection)?_ref1.url:void 0)||window.location.href},Router.prototype.collection=function(collectionSlug,hubSlug,articleId,itemSlug){return this.app.model.get("isInitialRoute")?this.initialCollection(articleId,itemSlug):"collection"!==this.app.active_rail.active_env?window.location.reload():null==Time.bootstrap.collection?window.location.reload():Time.bootstrap.collection.collection_slug!==collectionSlug?window.location.reload():null!=hubSlug?this.initialCollectionHub(hubSlug):this.setHubArticle(null!=Time.bootstrap.collection.intro_post?Time.bootstrap.collection.intro_post:Time.bootstrap.collection.hubs[0])},Router.prototype.vertical=function(vertical){return this.app.model.get("isInitialRoute")?void(Time.page=new Time.views.Vertical({app:this.app,vertical:vertical})):void window.location.reload()},Router.prototype.vault=function(filterType,filterValue,context,page){var options;return"year"===filterType||"subject"===filterType||"issue"===filterType?(options={app:this.app,filterType:filterType,filterValue:filterValue,context:context,page:page},null==Time.vault&&(Time.vault=new Time.views.Vault({app:Time.application})),void Time.vault.initFromRoute(options)):(options={app:this.app,landing:!0},void(Time.vault=new Time.views.Vault(options)))},Router.prototype.parents=function(){return this.app.page_view=new Time.views.ParentsLanding({app:this.app})},Router.prototype.photography=function(tax){var TAX_MAP,sub;null==tax&&(tax="tag"),TAX_MAP={life:"section",lightbox:"section"},_.has(TAX_MAP,tax)&&(sub=tax,tax=TAX_MAP[tax]),Time.page=new Time.views.MasonryPageView({app:this.app,tax:tax,sub:sub})},Router.prototype.sponsored=function(sponsor,articleId){return this.app.model.get("isInitialRoute")&&this.maybeRouteNativo(),null!=articleId?this.app.load_article(articleId):void this.app.getArticleCollection({env:"sponsor",sub:sponsor})},Router.prototype.maybeRouteNativo=function(){var isNativoMatch;return isNativoMatch=/\?ntv_a=(.*)/.exec(window.location.href),null!=isNativoMatch?this.app.getArticleCollection({env:"nativo"}):void 0},Router.prototype.moneyMagazine=function(){this.app.getArticleCollection({env:"money_magazine",sub:"magazine",open_rail:!0})},Router.prototype.moneySponsored=function(sponsor,articleId){this.app.model.set("isMoneySponsor",!0),this.sponsored(sponsor,articleId)},Router}(Backbone.Router)}(jQuery);;
