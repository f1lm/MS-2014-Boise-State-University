(function(a){function z(){var b=l.scrollLeft(),c=l.width();a([d,n]).css("left",b+c/2);A&&a(e).css({left:b,top:l.scrollTop(),width:c,height:l.height()})}function B(b){b?a("object").add(C?"select":"embed").each(function(a,b){v[a]=[b,b.style.visibility];b.style.visibility="hidden"}):(a.each(v,function(a,b){b[0].style.visibility=b[1]}),v=[]);b=b?"bind":"unbind";l[b]("scroll resize",z);a(document)[b]("keydown",L)}function L(b){b=b.keyCode;var d=a.inArray;return 0<=d(b,c.closeKeys)?D():0<=d(b,c.nextKeys)? E():0<=d(b,c.previousKeys)?F():!1}function F(){return w(p)}function E(){return w(q)}function w(a){0<=a&&(g=a,r=h[g][0],p=(g||(c.loop?h.length:0))-1,q=(g+1)%h.length||(c.loop?0:-1),G(),d.className="lbLoading",j=new Image,j.onload=M,j.src=r);return!1}function M(){d.className="";a(m).css({backgroundImage:"url("+r+")",visibility:"hidden",display:""});a(x).width(j.width);a([x,s,t]).height(j.height);a(H).html(h[g][1]||"");a(I).html((1<h.length&&c.counterText||"").replace(/{x}/,g+1).replace(/{y}/,h.length)); 0<=p&&(J.src=h[p][0]);0<=q&&(K.src=h[q][0]);f=m.offsetWidth;k=m.offsetHeight;var b=Math.max(0,y-k/2);d.offsetHeight!=k&&a(d).animate({height:k,top:b},c.resizeDuration,c.resizeEasing);d.offsetWidth!=f&&a(d).animate({width:f,marginLeft:-f/2},c.resizeDuration,c.resizeEasing);a(d).queue(function(){a(n).css({width:f,top:b+k,marginLeft:-f/2,visibility:"hidden",display:""});a(m).css({display:"none",visibility:"",opacity:""}).fadeIn(c.imageFadeDuration,N)})}function N(){0<=p&&a(s).show();0<=q&&a(t).show(); a(u).css("marginTop",-u.offsetHeight).animate({marginTop:0},c.captionAnimationDuration);n.style.visibility=""}function G(){j.onload=null;j.src=J.src=K.src=r;a([d,m,u]).stop(!0);a([s,t,m,n]).hide()}function D(){0<=g&&(G(),g=p=q=-1,a(d).hide(),a(e).stop().fadeOut(c.overlayFadeDuration,B));return!1}var l=a(window),c,h,g=-1,r,p,q,A,y,f,k,C=!window.XMLHttpRequest,v=[],j={},J=new Image,K=new Image,e,d,m,x,s,t,n,u,H,I;a(function(){a("body").append(a([e=a('<div id="lbOverlay" />')[0],d=a('<div id="lbCenter" />')[0], n=a('<div id="lbBottomContainer" />')[0]]).css("display","none"));m=a('<div id="lbImage" />').appendTo(d).append(x=a('<div style="position: relative;" />').append([s=a('<a id="lbPrevLink" href="#" />').click(F)[0],t=a('<a id="lbNextLink" href="#" />').click(E)[0]])[0],a('<a id="lbCloseLink" href="#" />').add(e).click(D)[0])[0];u=a('<div id="lbBottom" />').appendTo(n).append([H=a('<div id="lbCaption" />')[0],I=a('<div id="lbNumber" />')[0],a('<div style="clear: both;" />')[0]])[0]});a.slimbox=function(b, g,j){c=a.extend({loop:!1,overlayOpacity:0.8,overlayFadeDuration:400,resizeDuration:400,resizeEasing:"swing",initialWidth:250,initialHeight:250,imageFadeDuration:400,captionAnimationDuration:400,counterText:"{x}/{y}",closeKeys:[27,88,67],previousKeys:[37,80],nextKeys:[39,78]},j);"string"==typeof b&&(b=[[b,g]],g=0);y=l.scrollTop()+l.height()/2;f=c.initialWidth;k=c.initialHeight;a(d).css({top:Math.max(0,y-k/2),width:f,height:k,marginLeft:-f/2}).show();if(A=C||e.currentStyle&&"fixed"!=e.currentStyle.position)e.style.position= "absolute";a(e).css("opacity",c.overlayOpacity).fadeIn(c.overlayFadeDuration);z();B(1);h=b;c.loop=c.loop&&1<h.length;return w(g)};a.fn.slimbox=function(b,c,d){c=c||function(b){return[b.href,a(b).next(".ai").html()]};d=d||function(){return!0};var g=this;return g.unbind("click").click(function(){var h=this,j=0,f,e=0,k;f=a.grep(g,function(a,b){return d.call(h,a,b)});for(k=f.length;e<k;++e)f[e]==h&&(j=e),f[e]=c(f[e],e);return a.slimbox(f,j,b)})}})(jQuery);