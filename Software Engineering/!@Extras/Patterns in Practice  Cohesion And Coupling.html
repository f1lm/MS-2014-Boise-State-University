<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0054)http://msdn.microsoft.com/en-us/magazine/cc947917.aspx -->
<html xmlns="http://www.w3.org/1999/xhtml" style="" overflow:auto""="" class=""><head id="ctl00_Head"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link id="ctl00_HeaderLink2" rel="stylesheet" type="text/css" href="./Patterns in Practice  Cohesion And Coupling_files/Msdn10a-bn1651.css"><link id="ctl00_HeaderLink3" rel="stylesheet" type="text/css" href="./Patterns in Practice  Cohesion And Coupling_files/Magazine2-bn1651.css"><link rel="alternate" type="application/rss+xml" title="MSDN Magazine - Current Issue" href="http://msdn.microsoft.com/magazine/rss/default.aspx?z=z&iss=1"><link rel="alternate" type="application/rss+xml" title="MSDN Magazine - Complete" href="http://msdn.microsoft.com/magazine/rss/default.aspx?z=z&all=1"><link rel="alternate" type="application/rss+xml" title="MSDN Magazine Blog" href="http://blogs.msdn.com/msdnmagazine/rss.xml"><meta name="NormalizedUrl" content="http://msdn.microsoft.com/en-us/magazine(d=default)/cc947917(l=en-us,v=MSDN.10).aspx"><meta name="VotingContextUrl" content="http://msdn.microsoft.com/en-us/magazine(d=default)/cc947917(l=en-us,v=MSDN.10).aspx"><meta name="ROBOTS" content="NOINDEX,NOFOLLOW"><meta name="MN" content="BF1CA93B-11:27:35 AM"><meta name="ms.locale" content="en-us"><meta name="Search.ShortId" content="cc947917">
<!-- Looking for metadata? Use the robot view instead http://currentsite/currenturl(robot).aspx -->
<link rel="stylesheet" type="text/css" href="./Patterns in Practice  Cohesion And Coupling_files/mtps-bn1651.css"><link rel="alternate" media="print" href="http://msdn.microsoft.com/en-us/magazine/cc947917(printer).aspx">
<title>
	Patterns in Practice: Cohesion And Coupling
</title><style type="text/css"></style><link rel="stylesheet" type="text/css" href="chrome-extension://cgndfbhngibokieehnjhbjkkhbfmhojo/css/validation.css"><style type="text/css">.fancybox-margin{margin-right:0px;}</style></head>
<body id="ctl00_MTPS_Body" class="MsdnPageBody" dir="ltr" data-gclp-initialized="true" data-gistbox-initialized="true">
    <form name="aspnetForm" method="post" action="./Patterns in Practice  Cohesion And Coupling_files/Patterns in Practice  Cohesion And Coupling.html" id="aspnetForm">
<div>
<input type="hidden" name="__EVENTTARGET" id="__EVENTTARGET" value="">
<input type="hidden" name="__EVENTARGUMENT" id="__EVENTARGUMENT" value="">
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwUBMGQYAQUeX19Db250cm9sc1JlcXVpcmVQb3N0QmFja0tleV9fFgEFImN0bDAwJE1hc3RoZWFkJFNlYXJjaCRTZWFyY2hCdXR0b24lmakQCE49nay/Oh+qSjeDZiRv+Q==">
</div>

<script type="text/javascript" async="" src="./Patterns in Practice  Cohesion And Coupling_files/ms2.js"></script><script type="text/javascript">
//<![CDATA[
var theForm = document.forms['aspnetForm'];
if (!theForm) {
    theForm = document.aspnetForm;
}
function __doPostBack(eventTarget, eventArgument) {
    if (!theForm.onsubmit || (theForm.onsubmit() != false)) {
        theForm.__EVENTTARGET.value = eventTarget;
        theForm.__EVENTARGUMENT.value = eventArgument;
        theForm.submit();
    }
}
//]]>
</script>


<script src="./Patterns in Practice  Cohesion And Coupling_files/WebResource.axd" type="text/javascript"></script>


<script type="text/javascript">
//<![CDATA[
var CurUserId="AxUFAAAAAAA1BwAArbRGHyFOk+up9KmARiqTNQ!!";var ClientURL="http%3a%2f%2fmsdn.microsoft.com%2fen-us%2fmagazine(d%3ddefault)%2fcc947917(l%3den-us%2cv%3dMSDN.10).aspx";var maxRating=5;var RatingObjId="ctl00_tb1_Flyout_Rating1";var tbCommentsId="ctl00_tb1_Flyout_tbComments";var PageId="cc947917";var pageTag="contentRatingcc947917MSDN.10en-us";var sendBtnId="ctl00_tb1_Flyout_btnSend";var curRating="4";var contentRated=false;var RatingTooltipText="Click a star and provide feedback";var RatedTooltipText="You have already rated this content. Thank you for your feedback.";var userIPAddress="132.178.9.19";var MtpsPageDirection="ltr";var RatingFlyoutID="ctl00_tb1_Flyout";var Rating_Device="default";//]]>
</script>

<script src="./Patterns in Practice  Cohesion And Coupling_files/jquery-1.2.6-bn1651.js" type="text/javascript"></script>
<script src="./Patterns in Practice  Cohesion And Coupling_files/Silverlight-bn1651.js" type="text/javascript"></script>
<script type="text/javascript">
//<![CDATA[
var wt_nvr_ru = "WT_NVR_RU";var wt_fpcdom = ".microsoft.com";var wt_domlist = "msdn.microsoft.com";var wt_pathlist = "";var wt_paramlist = "DCSext.mtps_devcenter";var wt_siteid = "MSDN";var gDomain="m.webtrends.com";
var gDcsId="dcsmgru7m99k7mqmgrhudo0k8_8c6m";
var gFpc="WT_FPC";
/*<![CDATA[*/
if(document.cookie.indexOf(gFpc+"=")==-1){document.write("<scr"+"ipt type='text/javascript' src='"+"http"+(window.location.protocol.indexOf('https:')==0?'s':'')+"://"+gDomain+"/"+gDcsId+"/wtid.js"+"'><\/scr"+"ipt>");}
/*]]>*/
var detectedLocale = 'en-us';
var wtsp="_msdnmag_";
var gTrackEvents = 1;
var omni_guid='27c80a4f-da2f-4407-b5c6-6fb4d8efedb5';//]]>
</script>
<script src="./Patterns in Practice  Cohesion And Coupling_files/omni_rsid_msdn-bn1651.js" type="text/javascript"></script><noscript>&lt;a href='http://www.omniture.com' title='Web Analytics'&gt;&lt;img src='http://msstonojsmsdn.112.2o7.net/b/ss/msstonojsmsdn/1/H.20.2--NS/0'  height='1' width='1' border='0' alt='' /&gt;&lt;/a&gt;</noscript>
<script type="text/javascript">
//<![CDATA[
$(document).ready(function() { var sf = "a[@rel$='sitefeedback']"; if ($(sf) == null) return;  $(sf).click(function() {   var t = $(this).attr('targetUrl');   window.open(t,'SiteFeedback','width=670,resizable=no,height=700,toolbar=no,location=no,scrollbars=yes,directories=no,status=no,menubar=no'); return false; }); });//]]>
</script>

<script src="./Patterns in Practice  Cohesion And Coupling_files/compositejscript3.js" type="text/javascript"></script>
<script src="./Patterns in Practice  Cohesion And Coupling_files/js" type="text/javascript"></script>
<script src="./Patterns in Practice  Cohesion And Coupling_files/js(1)" type="text/javascript"></script>
<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="42B7A491">
</div>
    <script type="text/javascript">
//<![CDATA[
Sys.WebForms.PageRequestManager._initialize('ctl00$ScriptManager1', 'aspnetForm', [], [], [], 90, 'ctl00');
//]]>
</script>

    <div id="ctl00_checkFlyer">

</div>
    
    
    <div id="BodyBackground">
        <div id="ctl00_JelloSizer" class="JelloSizer">
            <div id="JelloExpander">
                <div id="ctl00_JelloWrapper" class="JelloWrapper">
                    <div class="Clear"> </div>
                    
                        <div class="Clear"> </div>
                        

<div class="Masthead">
    <div id="ctl00_Masthead_brandLogo" class="BrandLogo">
        <a href="http://msdn.microsoft.com/en-us/magazine/default.aspx" id="ctl00_Masthead_brandlink" title="MSDN Magazine">MSDN Magazine</a>
    </div>
    <div class="Search">
        <div id="ctl00_Masthead_Search_SearchBox" class="SearchBox">
    <input name="ctl00$Masthead$Search$SearchTextBox" type="text" id="ctl00_Masthead_Search_SearchTextBox" title="Search MSDN Magazine with Bing" class="TextBoxSearch" autocomplete="off" style="color: rgb(170, 170, 170); font-style: italic;">
    <input type="image" name="ctl00$Masthead$Search$SearchButton" id="ctl00_Masthead_Search_SearchButton" title="Search MSDN Magazine with Bing" class="SearchButton" alt="Click here to search" src="./Patterns in Practice  Cohesion And Coupling_files/clear.gif" style="border-width:0px;">
    <span class="Bing"></span>
<script type="text/javascript" defer="defer" src="./Patterns in Practice  Cohesion And Coupling_files/SearchBox.jss" id="mscom.srch.searchBox"></script><div id="SearchFlyoutContainer" style="display: none; text-align: left; border: 1px solid buttonshadow; position: absolute; z-index: 1000; padding: 2px; color: rgb(0, 0, 0); font-family: Arial; font-size: 13px; background-color: rgb(255, 255, 255);"><div id="SuggestionContainer"><ul style="list-style: none; padding: 4px 2px 0px 1px; cursor: pointer; margin: 1px; white-space: nowrap;"></ul></div></div></div>
    </div>
    <div class="GlobalBar">
        <div id="ctl00_Masthead_passportScarab" class="PassportScarab"> 
            <a id="idPPScarab" href="http://login.live.com/logout.srf?ct=1418326057&rver=6.0.5276.0&lc=1033&id=254354&ru=http%3a%2f%2fmsdn.microsoft.com%2fen-us%2fmagazine%2fcc947917.aspx&mkt=en-US"><span id="idPPScarabSOT" class="MTPS_GlobalToolbarLinks_msdn">Sign out</span></a>
<div id="idPPMWOverlay" style="display: none;"></div>
        </div>
        <div class="LocaleFlyout">
            
    <div id="MainDiv" onmouseover="FlyoutPopupShow()" onmouseout="FlyoutPopupHide()">
        <div id="FlyoutTop">
            <a id="ctl00_Masthead_LocaleManagement_linkCountryLanguage" class="LocaleManagementFlyoutStaticLink">United States - English&nbsp;</a>
            <img id="img_Arrow" class="LocaleManagementFlyoutPopArrow" src="./Patterns in Practice  Cohesion And Coupling_files/clear.gif" alt="choose your country or language">
        </div>
        <div id="FlyoutPopup" class="LocaleManagementFlyoutPopup">
            <table class="LocaleManagementFlyoutPopupTable">
                <tbody><tr><td><a id="ctl00_Masthead_LocaleManagement_lkbtn_Arg" href="javascript:__doPostBack('ctl00$Masthead$LocaleManagement$lkbtn_Arg','')">
                Argentina (Español)</a></td></tr>
                <tr><td><a id="ctl00_Masthead_LocaleManagement_lkbtn_Bra" href="javascript:__doPostBack('ctl00$Masthead$LocaleManagement$lkbtn_Bra','')">
                Brasil (Português)</a></td></tr>
                <tr><td><a id="ctl00_Masthead_LocaleManagement_lkbtn_CanE" href="javascript:__doPostBack('ctl00$Masthead$LocaleManagement$lkbtn_CanE','')">
                Canada (English)</a></td></tr>
                <tr><td><a id="ctl00_Masthead_LocaleManagement_lkbtn_CanF" href="javascript:__doPostBack('ctl00$Masthead$LocaleManagement$lkbtn_CanF','')">
                Canada (Français)</a></td></tr>
                <tr><td><a id="ctl00_Masthead_LocaleManagement_lkbtn_Chi" href="javascript:__doPostBack('ctl00$Masthead$LocaleManagement$lkbtn_Chi','')">
                中国 (简体中文)</a></td></tr>
                <tr><td><a id="ctl00_Masthead_LocaleManagement_lkbtn_Col" href="javascript:__doPostBack('ctl00$Masthead$LocaleManagement$lkbtn_Col','')">
                Colombia (Español)</a></td></tr>
                <tr><td><a id="ctl00_Masthead_LocaleManagement_lkbtn_Deu" href="javascript:__doPostBack('ctl00$Masthead$LocaleManagement$lkbtn_Deu','')">
                Deutschland (Deutsch)</a></td></tr>
                <tr><td><a id="ctl00_Masthead_LocaleManagement_lkbtn_Esp" href="javascript:__doPostBack('ctl00$Masthead$LocaleManagement$lkbtn_Esp','')">
                España (Español)</a></td></tr>
                <tr><td><a id="ctl00_Masthead_LocaleManagement_lkbtn_Fra" href="javascript:__doPostBack('ctl00$Masthead$LocaleManagement$lkbtn_Fra','')">
                France (Français)</a></td></tr>
                <tr><td><a id="ctl00_Masthead_LocaleManagement_lkbtn_Ind" href="javascript:__doPostBack('ctl00$Masthead$LocaleManagement$lkbtn_Ind','')">
                India (English)</a></td></tr>
                <tr><td><a id="ctl00_Masthead_LocaleManagement_lkbtn_Ita" href="javascript:__doPostBack('ctl00$Masthead$LocaleManagement$lkbtn_Ita','')">
                Italia (Italiano)</a></td></tr>
                <tr><td><a id="ctl00_Masthead_LocaleManagement_lkbtn_Jpa" href="javascript:__doPostBack('ctl00$Masthead$LocaleManagement$lkbtn_Jpa','')">
                日本 (日本語)</a></td></tr>
                <tr><td><a id="ctl00_Masthead_LocaleManagement_lkbtn_Kor" href="javascript:__doPostBack('ctl00$Masthead$LocaleManagement$lkbtn_Kor','')">
                한국 (한국어)</a></td></tr>
                <tr><td><a id="ctl00_Masthead_LocaleManagement_lkbtn_Mex" href="javascript:__doPostBack('ctl00$Masthead$LocaleManagement$lkbtn_Mex','')">
                México (Español)</a></td></tr>
                <tr><td><a id="ctl00_Masthead_LocaleManagement_lkbtn_Per" href="javascript:__doPostBack('ctl00$Masthead$LocaleManagement$lkbtn_Per','')">
                Perú (Español)</a></td></tr>
                <tr><td><a id="ctl00_Masthead_LocaleManagement_lkbtn_Рос" href="javascript:__doPostBack('ctl00$Masthead$LocaleManagement$lkbtn_Рос','')">
                Россия (Pусский)</a></td></tr>
                <tr><td><a id="ctl00_Masthead_LocaleManagement_lkbtn_Tai" href="javascript:__doPostBack('ctl00$Masthead$LocaleManagement$lkbtn_Tai','')">
                台灣 (繁體中文)</a></td></tr>
                <tr><td><a id="ctl00_Masthead_LocaleManagement_lkbtn_UK" href="javascript:__doPostBack('ctl00$Masthead$LocaleManagement$lkbtn_UK','')">
                United Kingdom (English)</a></td></tr>
                <tr><td><a id="ctl00_Masthead_LocaleManagement_lkbtn_US" href="javascript:__doPostBack('ctl00$Masthead$LocaleManagement$lkbtn_US','')">
                United States (English)</a></td></tr>
                <tr><td class="LocaleManagementFlyoutPopupHr"></td></tr>
                <tr><td><a id="ctl00_Masthead_LocaleManagement_lkbtn_More" href="http://msdn.microsoft.com/en-us/selectLocale">More...</a></td></tr>
            </tbody></table>
        </div>
    </div>


        </div>
        <div class="Clear"></div>
        <div id="ctl00_Masthead_ProfileLink_UserName" class="UserName"><a title="Milstein Munakami" href="http://social.msdn.microsoft.com/Profile">Milstein Munakami</a></div>
    </div>
    <div class="Clear"></div>
    <div id="ctl00_Masthead_networkTagLineArea" class="NetworkLogo">
        <a href="http://msdn.microsoft.com/en-us/default.aspx" id="ctl00_Masthead_networkLink"><img title="microsoft developer network" src="./Patterns in Practice  Cohesion And Coupling_files/brand_logo.png" style="border-width:0px;"></a>
    </div>
    

<div class="leftcap"></div>
    <div class="internav">
	    <div id="ctl00_Masthead_tabs_manTabsHolder"><a id="ctl00_Masthead_tabs_ctl01" class="normal" href="http://msdn.microsoft.com/en-us/magazine/default.aspx" onclick="javascript:Track(&#39;|TabStrip Link|ctl00_Masthead_tabs_ctl00|ctl00_Masthead_tabs_ctl01&#39;,this);">Home</a><a id="ctl00_Masthead_tabs_ctl03" class="normal" href="http://msdn.microsoft.com/en-us/magazine/ee532082.aspx" onclick="javascript:Track(&#39;|TabStrip Link|ctl00_Masthead_tabs_ctl02|ctl00_Masthead_tabs_ctl03&#39;,this);">Topics</a><a id="ctl00_Masthead_tabs_ctl05" class="active" href="http://msdn.microsoft.com/en-us/magazine/ee310108.aspx" onclick="javascript:Track(&#39;|TabStrip Link|ctl00_Masthead_tabs_ctl04|ctl00_Masthead_tabs_ctl05&#39;,this);">Issues and Downloads</a><a id="ctl00_Masthead_tabs_ctl07" class="normal" href="http://msdn.microsoft.com/en-us/magazine/ee358702.aspx" onclick="javascript:Track(&#39;|TabStrip Link|ctl00_Masthead_tabs_ctl06|ctl00_Masthead_tabs_ctl07&#39;,this);">Subscribe</a><a id="ctl00_Masthead_tabs_ctl09" class="normal" href="http://msdn.microsoft.com/en-us/magazine/ee291618.aspx" onclick="javascript:Track(&#39;|TabStrip Link|ctl00_Masthead_tabs_ctl08|ctl00_Masthead_tabs_ctl09&#39;,this);">Submit an Article</a><a id="ctl00_Masthead_tabs_ctl11" class="normal" href="http://msdn.microsoft.com/en-us/magazine/cc194384.aspx" onclick="javascript:Track(&#39;|TabStrip Link|ctl00_Masthead_tabs_ctl10|ctl00_Masthead_tabs_ctl11&#39;,this);">RSS</a></div>
    </div>
<div class="rightcap"></div>
<div class="Clear"></div>
   
</div>
                        <div class="Clear"> </div>
                        <div class="topleftcorner"> </div>
                        <div class="toprightcorner"> </div>
                        <div class="alley">
                            <div class="wrapper">
                                <div class="inner">
                                    
                                    <div class="Clear"> </div>
                                    <div id="ctl00_EyebrowMenu_EyebrowContainer" class="EyebrowContainer"><a id="ctl00_EyebrowMenu_ctl00" title="MSDN Magazine" class="EyebrowLink" href="http://msdn.microsoft.com/en-us/magazine/dd767791.aspx" onclick="javascript:Track(&#39;|Eyebrow|ctl00_EyebrowMenu_EyebrowContainer|ctl00_EyebrowMenu_ctl00&#39;,this);">MSDN Magazine</a><span>&nbsp;&gt;&nbsp;</span><a id="ctl00_EyebrowMenu_ctl01" title="Issues and Downloads" class="EyebrowLink" href="http://msdn.microsoft.com/en-us/magazine/ee310108.aspx" onclick="javascript:Track(&#39;|Eyebrow|ctl00_EyebrowMenu_EyebrowContainer|ctl00_EyebrowMenu_ctl01&#39;,this);">Issues and Downloads</a><span>&nbsp;&gt;&nbsp;</span><a id="ctl00_EyebrowMenu_ctl02" title="2008" class="EyebrowLink" href="http://msdn.microsoft.com/en-us/magazine/cc135847.aspx" onclick="javascript:Track(&#39;|Eyebrow|ctl00_EyebrowMenu_EyebrowContainer|ctl00_EyebrowMenu_ctl02&#39;,this);">2008</a><span>&nbsp;&gt;&nbsp;</span><a id="ctl00_EyebrowMenu_ctl03" title="October" class="EyebrowLink" href="http://msdn.microsoft.com/en-us/magazine/cc992993.aspx" onclick="javascript:Track(&#39;|Eyebrow|ctl00_EyebrowMenu_EyebrowContainer|ctl00_EyebrowMenu_ctl03&#39;,this);">October</a><span>&nbsp;&gt;&nbsp;</span><span class="EyebrowElement">&nbsp;Patterns in Practice: Cohesion And Coupling</span></div>
                                    <div class="Clear"> </div>
                                    <table border="0" cellpadding="0" cellspacing="0" width="100%" style="width: 100%; table-layout: fixed;">
                                        <tbody><tr>
                                            <td style="vertical-align: top; width: auto;" valign="top">
                                                
                                                <div id="MainContent" style="width: 100%">
                                                    
                                                            
                                                            <div class="navpage"><div><div class="topic"><div class="ColumnTypeTitle">Patterns in Practice</div><div class="ColumnTypeSubTitle">Cohesion And Coupling</div><div class="ColumnByLine">Jeremy Miller</div><div><span>
<div class="MTPS_CollapsibleRegion">
<div class="CollapseRegionLink"> <!-- ApplyClick with current id -->
<img class="LibC_o" src="./Patterns in Practice  Cohesion And Coupling_files/clear.gif" style="border-width:0px;vertical-align:middle;">
&nbsp;Contents
</div>
<div class="MTPS_CollapsibleSection" style="display:block;">  
<a href="http://msdn.microsoft.com/en-us/magazine/cc947917.aspx#id0070009" xmlns:ms="urn:schemas-microsoft-com:xslt">Decrease Coupling</a><br><a href="http://msdn.microsoft.com/en-us/magazine/cc947917.aspx#id0070020" xmlns:ms="urn:schemas-microsoft-com:xslt">Increase Cohesion</a><br><a href="http://msdn.microsoft.com/en-us/magazine/cc947917.aspx#id0070027" xmlns:ms="urn:schemas-microsoft-com:xslt">Eliminate Inappropriate Intimacy</a><br><a href="http://msdn.microsoft.com/en-us/magazine/cc947917.aspx#id0070040" xmlns:ms="urn:schemas-microsoft-com:xslt">The Law of Demeter</a><br><a href="http://msdn.microsoft.com/en-us/magazine/cc947917.aspx#id0070045" xmlns:ms="urn:schemas-microsoft-com:xslt">Tell, Don't Ask</a><br><a href="http://msdn.microsoft.com/en-us/magazine/cc947917.aspx#id0070052" xmlns:ms="urn:schemas-microsoft-com:xslt">Say It Once and Only Once</a><br><a href="http://msdn.microsoft.com/en-us/magazine/cc947917.aspx#id0070083" xmlns:ms="urn:schemas-microsoft-com:xslt">Wrapping Up</a><br>
</div>
</div>
</span></div><div class="ArticleNormalPara" id="id0070001">Much of software design involves the ongoing question, where should this code go? I'm constantly looking for the best way to organize my code to make it easier to write, easier to understand, and easier to change later. If I structure my code well, I'll go on to fame and glory. Structure it badly, and the developers who follow me will curse my name for eternity.</div><div class="ArticleNormalPara" id="id0070002">In particular, I would like to achieve three specific things with my code structure:</div><div class="ArticleNormalPara" id="id0070003"><ol><li>Keep things that have to change together as close together in the code as possible.</li><li>Allow unrelated things in the code to change independently (also known as orthogonality).</li><li>Minimize duplication in the code.</li></ol></div><div class="ArticleNormalPara" id="id0070006">To achieve these three goals, I need some tools to help me know where new code should go and some other tools to help me recognize when I've put code in the wrong place.</div><div class="ArticleNormalPara" id="id0070007">By and large, these goals are closely related to the classic code qualities of cohesion and coupling. I achieve these goals by moving toward higher cohesion and looser coupling. Of course, first we need to understand what these qualities mean and why coupling and cohesion are helpful concepts. Then I'd like to discuss some of what I'm going to call "design vectors" that help us move toward better structures and recognize when we need to move away from bad structures that have crept into our code.</div><div class="ArticleNormalPara" id="id0070008">Just as a note, I'm the primary developer of an open source inversion of control (IOC) tool called StructureMap. I'm going to be using some real-life examples from StructureMap to illustrate the design problems that these vectors address. In other words, don't make the same mistakes that I made.</div><p><br></p><div class="ArticleTypeTitle" id="id0070009">Decrease Coupling</div><div class="ArticleNormalPara" id="id0070010">You can't help but hear the terms "loose coupling" or "tight coupling" in almost any discussion on software design. Coupling among classes or subsystems is a measure of how interconnected those classes or subsystems are. Tight coupling means that related classes have to know internal details of each other, changes ripple through the system, and the system is potentially harder to understand. <strong>Figure 1</strong> shows a contrived sample of a business-processing module that is very tightly coupled to various other concerns besides the business logic.</div><div class="figmargin" id="id013"><span>
<div class="MTPS_CollapsibleRegion">
<div class="CollapseRegionLink"> <!-- ApplyClick with current id -->
<img class="LibC_o" src="./Patterns in Practice  Cohesion And Coupling_files/clear.gif" style="border-width:0px;vertical-align:middle;">
&nbsp;Figure 1 Tightly Coupled Code
</div>
<div class="MTPS_CollapsibleSection" style="display:block;">  
<span id="ctl00_MTContentSelector1_mainContentContainer_ctl24_ctl00_ctl00">
<div class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl24_ctl00_ctl00_">
    
    <div class="CodeSnippetTitleBar">
        <div class="CodeDisplayLanguage">
            
        </div>
        
    </div>
    <div dir="ltr" style="background-color: #ddd">
    <pre class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl24_ctl00_ctl00_code" space="preserve" data-initialized="true" data-gclp-id="0">public class BusinessLogicClass { public void DoSomething() { // Go get some configuration int threshold = int.Parse(ConfigurationManager.AppSettings["threshold"]); string connectionString = ConfigurationManager.AppSettings["connectionString"]; string sql = @"select * from things size &gt; "; sql += threshold; using (SqlConnection connection = new SqlConnection(connectionString)) { connection.Open(); SqlCommand command = new SqlCommand(sql, connection); using (SqlDataReader reader = command.ExecuteReader()) { while (reader.Read()) { string name = reader["Name"].ToString(); string destination = reader["destination"].ToString(); // do some business logic in here doSomeBusinessLogic(name, destination, connection); } } } } }</pre>
    </div>
</div>

</span>
</div>
</div>
</span></div><div class="ArticleNormalPara" id="id0070011">Let's say that what we really care about is the actual business processing, but our business logic code is intertwined with data-access concerns and configuration settings. So what's potentially wrong with this style of code?</div><div class="ArticleNormalPara" id="id0070012">The first problem is that the code is somewhat hard to understand because of the way the different concerns are intertwined. I'll discuss this further in the next section on cohesion.</div><div class="ArticleNormalPara" id="id0070013">The second problem is that any changes in data-access strategy, database structure, or configuration strategies will ripple through the business logic code as well because it's all in one code file. This business logic knows too much about the underlying infrastructure.</div><div class="ArticleNormalPara" id="id0070014">Third, we can't reuse the business logic code independent of the specific database structure or without the existence of the AppSettings keys. We also can't reuse the data-access functionality embedded in the BusinessLogicClass. That coupling between data access and business logic might not be an issue, but what if we want to repurpose this business logic for usage against data entered directly into an Excel spreadsheet by analysts? What if we want to test or debug the business logic by itself? We can't do any of that because the business logic is tightly coupled to the data-access code. The business logic would be a lot easier to change if we could isolate it from the other concerns.</div><div class="ArticleNormalPara" id="id0070015">To summarize, the goals behind achieving loose coupling between classes and modules are to:</div><div class="ArticleNormalPara" id="id0070016"><ol><li>Make the code easier to read.</li><li>Make our classes easier to consume by other developers by hiding the ugly inner workings of our classes behind well-designed APIs.</li><li>Isolate potential changes to a small area of code.</li><li>Reuse classes in completely new contexts.</li></ol></div><div class="SidebarContainer" id="id017"><div class="SidebarHeadline">Code Smells</div><div class="ArticleNormalPara" id="id0170001">It's obviously good to know how to do the right things when designing new code, but it might be even more important to recognize when your existing code or design has developed problems. Like inappropriate intimacy, "code smell" (defined by Martin Fowler in the book Refactoring: Improving the Design of Existing Code) is a tool that you can utilize to spot potential problems in code.</div><div class="ArticleNormalPara" id="id0170002">A code smell is a sign that something may be wrong in your code. It doesn't mean that you need to rip out your existing code and throw it away on the spot, but you definitely need to take a closer look at the code that gives off the offending "smell." A code smell can be spotted by simple inspection. Learning about code smells is a powerful tool to remove little problems in your code and class design before those problems become bigger issues.</div><div class="ArticleNormalPara" id="id0170003">Many, if not most, of the commonly described code smells are signs of poor cohesion or harmful tight coupling. Here are some other examples:</div><div class="ArticleNormalPara" id="id0170004"><strong>Divergent Changes</strong> A single class that has to be changed in different ways for different reasons. This smell is a sign that the class is not cohesive. You might refactor this class to extract distinct responsibilities into new classes.</div><div class="ArticleNormalPara" id="id0170005"><strong>Feature Envy</strong> A method in ClassA seems way too interested in the workings and data fields of ClassB. The feature envy from ClassA to ClassB is an indication of tight coupling from ClassA to ClassB. The usual fix is to try moving the functionality of the interested method in ClassA to ClassB, which is already closer to most of the data involved in the task.</div><div class="ArticleNormalPara" id="id0170006"><strong>Shotgun Surgery</strong> A certain type of change in the system repeatedly leads to making lots of small changes to a group of classes. Shotgun surgery generally implies that a single logical idea or function is spread out over multiple classes. Try to fix this by pulling all the parts of the code that have to change together into a single cohesive class.</div></div><p><br></p><div class="ArticleTypeTitle" id="id0070020">Increase Cohesion</div><div class="ArticleNormalPara" id="id0070021">The academic definition of cohesion is that it is a measure of how closely related all the responsibilities, data, and methods of a class are to each other. I like to think of cohesion as a measure of whether a class has a well-defined role within the system. We generally consider high cohesion to be a good thing and repeat the words "highly cohesive" like a mantra. But why?</div><div class="ArticleNormalPara" id="id0070022">Let's think of coding as having a conversation with the computer. More accurately, we're having several simultaneous conversations with the computer. We're having conversations about how security is carried out, how the infrastructure concerns are supposed to behave, and what the business rules are.</div><div class="ArticleNormalPara" id="id0070023">When you're at a loud party with a lot of different conversations going on at once, it can be difficult to focus on the one conversation you're trying to have. It's much easier to have a conversation in a quiet setting where there's only one conversation going on.</div><div class="ArticleNormalPara" id="id0070024">An easy test for cohesion is to look at a class and decide whether all the contents of the class are directly related to and described by the name of the class—vague class names, such as InvoiceManager, do not count. If the class has responsibilities that don't relate to its name, those responsibilities probably belong to a different class. If you find a subset of methods and fields that could easily be grouped separately under another class name, then maybe you should extract these methods and fields to a new class.</div><div class="ArticleNormalPara" id="id0070025">To illustrate, if you find methods and data in your TrainStation, Train, and Conductor classes that seem to most accurately fit the theme of the TrainSchedule class, move those methods and data into the TrainSchedule. One of my favorite sayings about design is applicable here: put code where you'd expect to find it. It's most logical to me that functionality involving a train schedule would be in the TrainSchedule class.</div><div class="ArticleNormalPara" id="id0070026">To stretch my earlier conversation analogy, a system consisting of cohesive classes and subsystems is like a well-designed online discussion group. Each area in the online group is narrowly focused on one specific topic so the discussion is easy to follow, and if you're looking for a dialog on a certain subject, there's only one room you have to visit.</div><p><br></p><div class="ArticleTypeTitle" id="id0070027">Eliminate Inappropriate Intimacy</div><div class="ArticleNormalPara" id="id0070028">Inappropriate intimacy refers to a method in a class that has too much intimate knowledge of another class. Inappropriate intimacy is a sign of harmful, tight coupling between classes. Let's say that we have a business logic class that calls an instance of class DataServer1 to get the data it needs for its business-logic processing. <strong>Figure 2</strong> shows an example. In this case, the Process method has to know a lot of the inner workings of DataServer1 and a bit about the SqlDataReader class.</div><div class="figmargin" id="id015"><span>
<div class="MTPS_CollapsibleRegion">
<div class="CollapseRegionLink"> <!-- ApplyClick with current id -->
<img class="LibC_o" src="./Patterns in Practice  Cohesion And Coupling_files/clear.gif" style="border-width:0px;vertical-align:middle;">
&nbsp;Figure 2 Inappropriate Intimacy
</div>
<div class="MTPS_CollapsibleSection" style="display:block;">  
<span id="ctl00_MTContentSelector1_mainContentContainer_ctl25_ctl00_ctl00">
<div class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl25_ctl00_ctl00_">
    
    <div class="CodeSnippetTitleBar">
        <div class="CodeDisplayLanguage">
            
        </div>
        
    </div>
    <div dir="ltr" style="background-color: #ddd">
    <pre class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl25_ctl00_ctl00_code" space="preserve" data-initialized="true" data-gclp-id="1">public void Process() { string connectionString = getConnectionString(); SqlConnection connection = new SqlConnection(connectionString); DataServer1 server = new DataServer1(connection); int daysOld = 5; using (SqlDataReader reader = server.GetWorkItemData(daysOld)) { while (reader.Read()) { string name = reader.GetString(0); string location = reader.GetString(1); processItem(name, location); } } }</pre>
    </div>
</div>

</span>
</div>
</div>
</span></div><div class="ArticleNormalPara" id="id0070029">Now, let's rewrite the code in <strong>Figure 2</strong> to remove the inappropriate intimacy:</div><p><span id="ctl00_MTContentSelector1_mainContentContainer_ctl06">
</span></p><div class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl06_">
    
    <div class="CodeSnippetTitleBar">
        <div class="CodeDisplayLanguage">
            
        </div>
        
    </div>
    <div dir="ltr" style="background-color: #ddd">
    <pre class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl06_code" space="preserve" data-initialized="true" data-gclp-id="2">public void Process() { DataServer2 server = new DataServer2(); foreach (DataItem item in server.GetWorkItemData(5)) { processItem(item); } }</pre>
    </div>
</div>

<p></p><div class="ArticleNormalPara" id="id0070036">As you can see in this version of the code, I've encapsulated all the SqlConnection and SqlDataReader object manipulation inside the DataServer2 class. DataServer2 is also assumed to be taking care of its own configuration, so the new Process method doesn't have to know anything about setting up DataServer2. The DataItem objects returned from GetWorkItemData are also strongly typed objects.</div><div class="ArticleNormalPara" id="id0070037">Now, let's analyze the two versions of Process method against some of the goals of loose coupling. First, what about making the code easier to read? The first and second versions of Process perform the same basic task, but which is easier to read and understand? Personally, I can more easily read and understand the business logic processing without wading through data-access code.</div><div class="ArticleNormalPara" id="id0070038">How about making our classes easier to consume? Consumers of DataServer1 have to know how to create a SqlConnection object, understand the structure of the DataReader returned, and iterate through and clean up the DataReader. A consumer of DataServer2 only has to call a no-argument constructor and then call a single method that returns an array of strongly typed objects. DataServer2 is taking care of its own ADO.NET connection setup and cleaning up open DataReaders.</div><div class="ArticleNormalPara" id="id0070039">And as for isolating potential changes to a small area of code? In the first version of the code, almost any change in the way DataServer works would impact the Process method. In the second, more encapsulated version of DataServer, you could switch the data store to an Oracle database or to an XML file without any effect on the Process method.</div><p><br></p><div class="ArticleTypeTitle" id="id0070040">The Law of Demeter</div><div class="ArticleNormalPara" id="id0070041">The Law of Demeter is a design rule of thumb. The terse definition of the law is: only talk to your immediate friends. The Law of Demeter is a warning about the potential dangers of code, as in <strong>Figure 3</strong>.</div><div class="figmargin" id="id019"><span>
<div class="MTPS_CollapsibleRegion">
<div class="CollapseRegionLink"> <!-- ApplyClick with current id -->
<img class="LibC_o" src="./Patterns in Practice  Cohesion And Coupling_files/clear.gif" style="border-width:0px;vertical-align:middle;">
&nbsp;Figure 3 Breaking the Law
</div>
<div class="MTPS_CollapsibleSection" style="display:block;">  
<span id="ctl00_MTContentSelector1_mainContentContainer_ctl27_ctl00_ctl00">
<div class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl27_ctl00_ctl00_">
    
    <div class="CodeSnippetTitleBar">
        <div class="CodeDisplayLanguage">
            
        </div>
        
    </div>
    <div dir="ltr" style="background-color: #ddd">
    <pre class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl27_ctl00_ctl00_code" space="preserve" data-initialized="true" data-gclp-id="3">public interface DataService { InsuranceClaim[] FindClaims(Customer customer); } public class Repository { public DataService InnerService { get; set; } } public class ClassThatNeedsInsuranceClaim { private Repository _repository; public ClassThatNeedsInsuranceClaim(Repository repository) { _repository = repository; } public void TallyAllTheOutstandingClaims(Customer customer) { // This line of code violates the Law of Demeter InsuranceClaim[] claims = _repository.InnerService.FindClaims(customer); } }</pre>
    </div>
</div>

</span>
</div>
</div>
</span></div><div class="ArticleNormalPara" id="id0070042">The ClassThatNeedsInsuranceClaim class needs to get InsuranceClaim data. It has a reference to the Repository class, which itself has a DataService object. ClassThatNeedsInsuranceClaim reaches inside Repository to grab the inner DataService object, then calls Repository.FindClaims to get its data. Note that the call to _repository.InnerService.FindClaims(customer) is a clear violation of the Law of Demeter because ClassThatNeedsInsuranceClaim is directly calling a method on a property of its Repository field. Now please turn your attention to <strong>Figure 4</strong>, which shows another sample of the same code, but this time it is following the Law of Demeter.</div><div class="figmargin" id="id021"><span>
<div class="MTPS_CollapsibleRegion">
<div class="CollapseRegionLink"> <!-- ApplyClick with current id -->
<img class="LibC_o" src="./Patterns in Practice  Cohesion And Coupling_files/clear.gif" style="border-width:0px;vertical-align:middle;">
&nbsp;Figure 4 Better Decoupling
</div>
<div class="MTPS_CollapsibleSection" style="display:block;">  
<span id="ctl00_MTContentSelector1_mainContentContainer_ctl28_ctl00_ctl00">
<div class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl28_ctl00_ctl00_">
    
    <div class="CodeSnippetTitleBar">
        <div class="CodeDisplayLanguage">
            
        </div>
        
    </div>
    <div dir="ltr" style="background-color: #ddd">
    <pre class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl28_ctl00_ctl00_code" space="preserve" data-initialized="true" data-gclp-id="4">public class Repository2 { private DataService _service; public Repository2(DataService service) { _service = service; } public InsuranceClaim[] FindClaims(Customer customer) { // we're simply going to delegate to the inner // DataService for now, but who knows what // we want to do in the future? return _service.FindClaims(customer); } } public class ClassThatNeedsInsuranceClaim2 { private Repository2 _repository; public ClassThatNeedsInsuranceClaim2( Repository2 repository) { _repository = repository; } public void TallyAllTheOutstandingClaims( Customer customer) { // This line of code now follows the Law of Demeter InsuranceClaim[] claims = _repository.FindClaims(customer); } }</pre>
    </div>
</div>

</span>
</div>
</div>
</span></div><div class="ArticleNormalPara" id="id0070043">What did we accomplish? Repository2 is easier to use than Repository because you have a direct method to call for the InsuranceClaim information. When we were violating the Law of Demeter, the consumers of Repository were tightly coupled to the implementation of Repository. With the revised code, I have more ability to change the Repository implementation to add more caching or swap out the underlying DataService with something completely different.</div><div class="ArticleNormalPara" id="id0070044">The Law of Demeter is a powerful tool to help you spot potential coupling problems, but don't follow the Law of Demeter blindly. Violating the Law of Demeter does add tighter coupling to your system, but in some cases you may judge that the potential cost of coupling to a stable element of your code is less expensive than writing a lot of delegation code to eliminate the Law of Demeter violations.</div><p><br></p><div class="ArticleTypeTitle" id="id0070045">Tell, Don't Ask</div><div class="ArticleNormalPara" id="id0070046">The Tell, Don't Ask design principle urges you to tell objects what to do. What you don't want to do is ask an object about its internal state, make some decisions about that state, then tell that object what to do. Following the Tell, Don't Ask style of object interaction is a good way to ensure that responsibilities are put in the right places.</div><div class="ArticleNormalPara" id="id0070047"><strong>Figure 5</strong> illustrates a violation of Tell, Don't Ask. The code is taking a purchase of some sort, checking for the possibility of a discount for purchases of more than $10,000, and finally examining the account data to decide whether there are sufficient funds. The previous DumbPurchase and DumbAccount classes are, well, dumb. The account and purchase business rules are both encoded in ClassThatUsesDumbEntities.</div><div class="figmargin" id="id023"><span>
<div class="MTPS_CollapsibleRegion">
<div class="CollapseRegionLink"> <!-- ApplyClick with current id -->
<img class="LibC_o" src="./Patterns in Practice  Cohesion And Coupling_files/clear.gif" style="border-width:0px;vertical-align:middle;">
&nbsp;Figure 5 Asking Too Much
</div>
<div class="MTPS_CollapsibleSection" style="display:block;">  
<span id="ctl00_MTContentSelector1_mainContentContainer_ctl29_ctl00_ctl00">
<div class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl29_ctl00_ctl00_">
    
    <div class="CodeSnippetTitleBar">
        <div class="CodeDisplayLanguage">
            
        </div>
        
    </div>
    <div dir="ltr" style="background-color: #ddd">
    <pre class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl29_ctl00_ctl00_code" space="preserve" data-initialized="true" data-gclp-id="5">public class DumbPurchase { public double SubTotal { get; set; } public double Discount { get; set; } public double Total { get; set; } } public class DumbAccount { public double Balance { get; set;} } public class ClassThatUsesDumbEntities { public void MakePurchase( DumbPurchase purchase, DumbAccount account) { purchase.Discount = purchase.SubTotal &gt; 10000 ? .10 : 0; purchase.Total = purchase.SubTotal*(1 - purchase.Discount); if (purchase.Total &lt; account.Balance) { account.Balance -= purchase.Total; } else { rejectPurchase(purchase, "You don't have enough money."); } } }</pre>
    </div>
</div>

</span>
</div>
</div>
</span></div><div class="ArticleNormalPara" id="id0070048">This type of code can be problematic in a couple of ways. In a system like this, you potentially have duplication because the business rules for an entity are scattered in procedural code outside of the entities. You might duplicate logic unknowingly because it's not obvious where the previously written business logic would be.</div><div class="ArticleNormalPara" id="id0070049"><strong>Figure 6</strong> shows the same code, but this time following the Tell, Don't Ask pattern. In this code, I moved the business rules for purchasing and accounts into the Purchase and Account classes themselves. When we go to make a purchase, we just tell the Account class to deduct the purchase from itself. Account and Purchase know about themselves and their internal rules. All a consumer of Account has to know is to call the Account.Deduct(Purchase, PurchaseMessenger) method.</div><div class="figmargin" id="id025"><span>
<div class="MTPS_CollapsibleRegion">
<div class="CollapseRegionLink"> <!-- ApplyClick with current id -->
<img class="LibC_o" src="./Patterns in Practice  Cohesion And Coupling_files/clear.gif" style="border-width:0px;vertical-align:middle;">
&nbsp;Figure 6 Telling Your App What to Do
</div>
<div class="MTPS_CollapsibleSection" style="display:block;">  
<span id="ctl00_MTContentSelector1_mainContentContainer_ctl30_ctl00_ctl00">
<div class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl30_ctl00_ctl00_">
    
    <div class="CodeSnippetTitleBar">
        <div class="CodeDisplayLanguage">
            
        </div>
        
    </div>
    <div dir="ltr" style="background-color: #ddd">
    <pre class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl30_ctl00_ctl00_code" space="preserve" data-initialized="true" data-gclp-id="6">public class Purchase { private readonly double _subTotal; public Purchase(double subTotal) { _subTotal = subTotal; } public double Total { get { double discount = _subTotal &gt; 10000 ? .10 : 0; return _subTotal*(1 - discount); } } } public class Account { private double _balance; public void Deduct( Purchase purchase, PurchaseMessenger messenger) { if (purchase.Total &lt; _balance) { _balance -= purchase.Total; } else { messenger.RejectPurchase(purchase, this); } } } public class ClassThatObeysTellDontAsk { public void MakePurchase( Purchase purchase, Account account) { PurchaseMessenger messenger = new PurchaseMessenger(); account.Deduct(purchase, messenger); } }</pre>
    </div>
</div>

</span>
</div>
</div>
</span></div><div class="ArticleNormalPara" id="id0070050">The Account and Purchase objects are easier to use because you don't have to know quite so much about these classes to execute our business logic. We've also potentially reduced duplication in the system. The business rules for Accounts and Purchases can be effortlessly reused throughout the system because those rules are inside the Account and Purchase classes instead of being buried inside the code that uses those classes. In addition, it should be easier to change the business rules for Purchases and Accounts as those rules are found in just one place in the system.</div><div class="ArticleNormalPara" id="id0070051">Closely related to Tell, Don't Ask is the Information Expert pattern. If you have a new responsibility for your system, in what class should the new responsibility go? The Information Expert pattern asks, who knows the information necessary to fulfill this responsibility? In other words, your first candidate for any new responsibility is the class that already has the data fields affected by that responsibility. In the purchasing sample, the Purchase class knows the information about a purchase that you would use to determine any possible discount rates, so the Purchase class itself is the immediate candidate for calculating discount rates.</div><p><br></p><div class="ArticleTypeTitle" id="id0070052">Say It Once and Only Once</div><div class="ArticleNormalPara" id="id0070053">As an industry we've learned that writing reusable code deliberately is very expensive, yet we still try for reuse because of the obvious benefits. It may behoove us to look for duplication in our system and find ways to eliminate or centralize that duplication.</div><div class="ArticleNormalPara" id="id0070054">One of the best ways to improve cohesion in your system is to eliminate duplication wherever you spot it. It's probably best if you assume that you don't know exactly how your system is going to change in the future, but you can improve your code's ability to accept change by maintaining good cohesion and coupling in class structures.</div><div class="ArticleNormalPara" id="id0070055">I was peripherally involved years ago with a large shipping application that managed the flow of boxes on a factory floor. In its original incarnation, the system polled a message queue for incoming messages, then responded to those messages by applying a large set of business rules to determine where the boxes went next.</div><div class="ArticleNormalPara" id="id0070056">The next year the business needed to start the box-routing logic from a desktop client. Unfortunately, the business logic code was far too tightly coupled with the mechanisms for reading and writing to MQ Series queues. It was judged too risky to untangle the original business logic code from the MQ Series infrastructure, so the entire corpus of business rules were duplicated in a parallel library for the new desktop client. That decision made the new desktop client feasible, but it also made all future efforts more difficult because each change to the box-routing logic required a parallel change to two very different libraries—and those kinds of business rules change frequently.</div><div class="ArticleNormalPara" id="id0070057">This real scenario presents us with a couple of lessons. Duplication in the code had a real cost to the organization that built the system, and that duplication was largely caused by poor coupling and cohesion qualities in their class structure. This stuff can directly affect a company's profit and loss.</div><div class="ArticleNormalPara" id="id0070058">One way of looking at duplication in your code is as an opportunity to improve your design later. If you find yourself with two or more classes that duplicate some piece of functionality, you can say that the duplicated functionality must be a completely different responsibility. One of the best ways to improve the cohesion quality of your codebase is to simply pull out duplication into separate classes that can be shared across the codebase.</div><div class="ArticleNormalPara" id="id0070059">I learned the hard way that even innocuous-looking duplication can cause headaches. With the advent of generics in the Microsoft .NET Framework 2.0, many people started creating parameterized Repository classes that looked something like this:</div><p><span id="ctl00_MTContentSelector1_mainContentContainer_ctl15">
</span></p><div class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl15_">
    
    <div class="CodeSnippetTitleBar">
        <div class="CodeDisplayLanguage">
            
        </div>
        
    </div>
    <div dir="ltr" style="background-color: #ddd">
    <pre class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl15_code" space="preserve" data-initialized="true" data-gclp-id="7">public interface IRepository&lt;T&gt; { void Save(T subject); void Delete(T subject); }</pre>
    </div>
</div>

<p></p><div class="ArticleNormalPara" id="id0070064">In this interface, T would be a domain entity like Invoice or Order or Shipment. Users of StructureMap wanted to be able to call this code and get a fully formed repository object that could handle a specific domain entity, such as an Invoice object:</div><p><span id="ctl00_MTContentSelector1_mainContentContainer_ctl16">
</span></p><div class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl16_">
    
    <div class="CodeSnippetTitleBar">
        <div class="CodeDisplayLanguage">
            
        </div>
        
    </div>
    <div dir="ltr" style="background-color: #ddd">
    <pre class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl16_code" space="preserve" data-initialized="true" data-gclp-id="8">IRepository&lt;Invoice&gt; repository = ObjectFactory.GetInstance&lt;IRepository&lt;Invoice&gt;&gt;();</pre>
    </div>
</div>

<p></p><div class="ArticleNormalPara" id="id0070067">It sounded like a great feature to have, so I sat down to add support for these kinds of parameterized types. Making this change to StructureMap turned out to be very difficult because of code like this:</div><p><span id="ctl00_MTContentSelector1_mainContentContainer_ctl17">
</span></p><div class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl17_">
    
    <div class="CodeSnippetTitleBar">
        <div class="CodeDisplayLanguage">
            
        </div>
        
    </div>
    <div dir="ltr" style="background-color: #ddd">
    <pre class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl17_code" space="preserve" data-initialized="true" data-gclp-id="9">_PluginFamilies.Add(family.PluginType.FullName, family);</pre>
    </div>
</div>

<p></p><div class="ArticleNormalPara" id="id0070069">And code like this:</div><p><span id="ctl00_MTContentSelector1_mainContentContainer_ctl18">
</span></p><div class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl18_">
    
    <div class="CodeSnippetTitleBar">
        <div class="CodeDisplayLanguage">
            
        </div>
        
    </div>
    <div dir="ltr" style="background-color: #ddd">
    <pre class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl18_code" space="preserve" data-initialized="true" data-gclp-id="10">MementoSource source = this.getMementoSourceForFamily(pluginType.FullName);</pre>
    </div>
</div>

<p></p><div class="ArticleNormalPara" id="id0070072">And code like this as well:</div><p><span id="ctl00_MTContentSelector1_mainContentContainer_ctl19">
</span></p><div class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl19_">
    
    <div class="CodeSnippetTitleBar">
        <div class="CodeDisplayLanguage">
            
        </div>
        
    </div>
    <div dir="ltr" style="background-color: #ddd">
    <pre class="libCScode" id="ctl00_MTContentSelector1_mainContentContainer_ctl19_code" space="preserve" data-initialized="true" data-gclp-id="11">private IInstanceFactory this[Type PluginType] { get { return this[PluginType.FullName]; } set { this[PluginType.FullName] = value; } }</pre>
    </div>
</div>

<p></p><div class="ArticleNormalPara" id="id0070081">Have you spotted the duplication yet? Not to get too involved with this sample, but I had an implicit rule that stated that objects related to a System.Type were stored by using the Type.FullName property as the key in a Hashtable. It's a tiny little bit of logic, but I had duplicated it all over the codebase. When I implemented generics, I determined that it would be better if I stored objects internally by the actual type instead of Type.FullName.</div><div class="ArticleNormalPara" id="id0070082">This seemingly minor change in behavior took me days instead of the hours I assumed up front because of how many times I had duplicated this little bit of data. The lesson learned here is that any rule in your system, no matter how seemingly trivial, should be expressed once, and only once.</div><p><br></p><div class="ArticleTypeTitle" id="id0070083">Wrapping Up</div><div class="ArticleNormalPara" id="id0070084">Cohesion and coupling applies to every level of a design and architecture, but I've mostly focused on fine-grained details at the class and method levels. Sure, you better get the big architectural decisions right—technology selection, project structure, and physical deployment are all important, but usually these are fairly constrained in the number of choices and the trade-offs are generally well understood.</div><div class="ArticleNormalPara" id="id0070085">I've found that the cumulative effect of the hundreds and thousands of little decisions you make at the class and method levels add up to have a more profound impact on the success of a project—and you've got a far greater range of choices and alternatives in regard to the little things. While it may not be true of life in general, in software design, sweat the small things.</div><div class="ArticleNormalPara" id="id0070086">There's a common attitude with developers that worrying about all this cohesion and coupling stuff is ivory tower theory that detracts from getting the work done. My feeling is that good cohesion and coupling qualities in your code will sustain productivity in your code over time. My strong advice is to internalize your recognition of cohesion and coupling qualities to the point where you don't have to consciously think about these qualities. Moreover, one of the best exercises I can recommend for improving your design skills is to revisit your previous coding efforts, try to find ways you could have improved the old code, and try to remember the elements of your past design that either made changing the code easy or made adjusting the code difficult.</div><p><br></p><div class="clsGloss">Send your questions and comments to <a id="ctl00_MTContentSelector1_mainContentContainer_ctl20" href="mailto:mmpatt@microsoft.com" onclick="javascript:Track(&#39;ctl00_MTContentSelector1_mainContentContainer_ctl00|ctl00_MTContentSelector1_mainContentContainer_ctl20&#39;,this);">mmpatt@microsoft.com</a>.</div><p><br></p><div class="AuthorBio"><strong>Jeremy Miller</strong>, a Microsoft MVP for C#, is also the author of the open source StructureMap (<a id="ctl00_MTContentSelector1_mainContentContainer_ctl21" href="http://structuremap.sourceforge.net/" onclick="javascript:Track(&#39;ctl00_MTContentSelector1_mainContentContainer_ctl00|ctl00_MTContentSelector1_mainContentContainer_ctl21&#39;,this);">structuremap.sourceforge.net</a>) tool for Dependency Injection with .NET and the forthcoming StoryTeller (<a id="ctl00_MTContentSelector1_mainContentContainer_ctl22" href="http://storyteller.tigris.org/" onclick="javascript:Track(&#39;ctl00_MTContentSelector1_mainContentContainer_ctl00|ctl00_MTContentSelector1_mainContentContainer_ctl22&#39;,this);">storyteller.tigris.org</a>) tool for supercharged FIT testing in .NET.</div><p><br></p><div class="solidLine"><!--PublishThis!: An empty tag was encountered. This comment was inserted to prevent a self-closing tag.--></div></div></div></div>
                                                        
                                                </div>
                                                <div class="FeatureSmallHeadWithLogo">&nbsp;</div>
                                            </td>
                                            <td style="width: 303px; vertical-align: top; padding-left: 3px;" valign="top">
                                                <div id="RightContent">
                                                    <div id="ctl00_RightSideBox">
	<p:primary pcat:primaryformat="Mtps.Xhtml" xmlns:asp="http://msdn2.microsoft.com/aspnet" xmlns:pcat="urn:mtpg-com:mtps/2004/1/primary/category" xmlns:p="urn:mtpg-com:mtps/2004/1/primary"><div class="navpage"><div style="margin-bottom:10px;"><iframe frameborder="0" framespacing="0" height="0" id="4f2320cbb2378" name="4f2320cbb2378" scrolling="no" src="about:blank" width="0" style="display: none !important; visibility: hidden !important; opacity: 0 !important; background-position: 300px 250px;">&lt;a id="ctl00_ctl15" href="http://ox-d.101m3.com/w/1.0/rc?cs=4f2320cbb2378&amp;cb=INSERT_RANDOM_NUMBER_HERE" onclick="javascript:Track('ctl00_ctl14|ctl00_ctl15',this);"&gt;&lt;img alt="" border="0" src="http://ox-d.101m3.com/w/1.0/ai?auid=139281&amp;amp;cs=4f2320cbb2378&amp;amp;cb=INSERT_RANDOM_NUMBER_HERE" /&gt;&lt;/a&gt;</iframe></div><div style="margin-bottom:10px;"><iframe frameborder="0" framespacing="0" height="0" id="4f2320971b57d" name="4f2320971b57d" scrolling="no" src="about:blank" width="0" style="display: none !important; visibility: hidden !important; opacity: 0 !important; background-position: 300px 250px;">&lt;a id="ctl00_ctl16" href="http://ox-d.101m3.com/w/1.0/rc?cs=4f2320971b57d&amp;cb=INSERT_RANDOM_NUMBER_HERE" onclick="javascript:Track('ctl00_ctl14|ctl00_ctl16',this);"&gt;&lt;img alt="" border="0" src="http://ox-d.101m3.com/w/1.0/ai?auid=139280&amp;amp;cs=4f2320971b57d&amp;amp;cb=INSERT_RANDOM_NUMBER_HERE" /&gt;&lt;/a&gt;</iframe></div><div style="border-width:5px;border-color:black;border-style:solid;"><div style="margin-left:5px; margin-right:5px;"><h3><a id="ctl00_ctl17" href="http://blogs.msdn.com/msdnmagazine/" onclick="javascript:Track(&#39;ctl00_ctl14|ctl00_ctl17&#39;,this);">MSDN Magazine Blog</a></h3><p><!-- RSSURL : http://blogs.msdn.com/msdnmagazine/rss.xml | RSS GUID : 44CFFA5F-CCC2-14A2-2403-529DE793E787 --></p><div id="ctl00_ctl18_MtpsFeedViewerBasicPanelWebSlice" class="hslice">
		
	<p id="ctl00_ctl18_titlediv" class="entry-title"></p>
	<div class="entry-content">
			
		<div id="ctl00_ctl18_MtpsFeedViewerBasicPanel" class="MtpsFeedViewerBasicRootPanelClass">
				
			<div id="ctl00_ctl18_MtpsFeedViewerBasicHeaderPanel" class="MtpsFeedViewerBasicHeaderStylePanel">
					
			
				</div>
		<div class="ColumnDiv">
					<div id="ctl00_ctl18_ctl02" class="BasicHeadlinesItemPanelCssClass" style="width:99%;">
						<a id="ctl00_ctl18_ctl03" title="Charles Petzold Departing" class="BasicHeadlinesTitleBold" href="http://blogs.msdn.com/b/msdnmagazine/archive/2014/10/01/10561803.aspx" onclick="javascript:Track(&#39;ctl00_ctl18_ctl02|ctl00_ctl18_ctl03&#39;,this);">Charles Petzold Departing</a><br><span class="BasicHeadlinesDescLabelCssClass">&nbsp;  As I describe in this month’s Editor’s Note column, the October issue of MSDN Magazine is Charles Petzold’s last as a regular columnist. He is leav... </span><a id="ctl00_ctl18_ctl06" title="Charles Petzold Departing" href="http://blogs.msdn.com/b/msdnmagazine/archive/2014/10/01/10561803.aspx" onclick="javascript:Track(&#39;ctl00_ctl18_ctl02|ctl00_ctl18_ctl06&#39;,this);">More...</a><br><span class="FVBPubDateLabel">Wednesday, Oct 1</span>
					</div>
				</div><div class="ColumnDiv">
					<div id="ctl00_ctl18_ctl10" class="BasicHeadlinesItemPanelCssClass" style="width:99%;">
						<a id="ctl00_ctl18_ctl11" title="MSDN Magazine July Issue Preview: All About Azure Web Sites" class="BasicHeadlinesTitleBold" href="http://blogs.msdn.com/b/msdnmagazine/archive/2014/06/30/10538491.aspx" onclick="javascript:Track(&#39;ctl00_ctl18_ctl10|ctl00_ctl18_ctl11&#39;,this);">MSDN Magazine July Issue Preview: All About Azure Web Sites</a><br><span class="BasicHeadlinesDescLabelCssClass">&nbsp;  The July issue of MSDN Magazine is themed around the updated features and functionality of Microsoft Azure Web Sites, and reflects the rapid-fire p... </span><a id="ctl00_ctl18_ctl14" title="MSDN Magazine July Issue Preview: All About Azure Web Sites" href="http://blogs.msdn.com/b/msdnmagazine/archive/2014/06/30/10538491.aspx" onclick="javascript:Track(&#39;ctl00_ctl18_ctl10|ctl00_ctl18_ctl14&#39;,this);">More...</a><br><span class="FVBPubDateLabel">Monday, Jun 30</span>
					</div>
				</div><div class="EmptyPanel">

				</div>
			</div>
	
		</div>

	</div><p></p><p><a id="ctl00_ctl19" href="http://blogs.msdn.com/msdnmagazine/" onclick="javascript:Track(&#39;ctl00_ctl14|ctl00_ctl19&#39;,this);">More MSDN Magazine Blog entries &gt;</a></p></div><div style="margin-left:5px; margin-right:5px; background-color:#5b6871;height:12px"><!--PublishThis!: An empty tag was encountered. This comment was inserted to prevent a self-closing tag.--></div><div style="margin-left:5px; margin-right:5px;"><p><br></p><div style="text-align:left;font-family:Segoe UI;font-size:12pt;">Current Issue</div><div style="text-align:center;display:block;height:260px"><p><br><a id="ctl00_ctl20" href="http://msdn.microsoft.com/en-us/magazine/dn857348.aspx" onclick="javascript:Track(&#39;ctl00_ctl14|ctl00_ctl20&#39;,this);"><img align="Middle" alt="December 2014" height="239" src="./Patterns in Practice  Cohesion And Coupling_files/dn857348.cover_lrg(en-us,MSDN.10).jpg" title="December 2014" width="179"></a></p></div><div style="text-align:right;"><p><a id="ctl00_ctl21" href="http://msdn.microsoft.com/en-us/magazine/ee310108.aspx" onclick="javascript:Track(&#39;ctl00_ctl14|ctl00_ctl21&#39;,this);">Browse All MSDN Magazines</a><br></p></div><div style="background-color:#5b6871;height:12px"><!--PublishThis!: An empty tag was encountered. This comment was inserted to prevent a self-closing tag.--></div></div><div style="margin-left:5px; margin-right:5px;"><div style="text-align:Right;font-family:Segoe UI;font-size:12pt;"><p><br><a id="ctl00_ctl22" href="http://msdn.microsoft.com/en-US/aa570311.aspx?ocid=msdn_magazine" onclick="javascript:Track(&#39;ctl00_ctl14|ctl00_ctl22&#39;,this);"><img align="Left" alt="Subscribe to the MSDN Flash newsletter" src="./Patterns in Practice  Cohesion And Coupling_files/dd799403.Question_opt(en-us,MSDN.10).png" title="Subscribe to the MSDN Flash newsletter"> Subscribe to MSDN Flash newsletter</a></p></div><div style="text-align:left;"><p><br>Receive the MSDN Flash e-mail newsletter every other week, with news and information personalized to your interests and areas of focus.</p></div></div></div></div></p:primary>
</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody></table>
                                    <div id="ctl00_FooterAd" class="MsdnPage_ContentInclude" align="center"><div>
	<div>
		<div class="navpage"><p>&nbsp;</p><div><iframe frameborder="0" framespacing="0" height="0" id="4f2320f8e860a" name="4f2320f8e860a" scrolling="no" src="about:blank" width="0" style="display: none !important; visibility: hidden !important; opacity: 0 !important; background-position: 728px 90px;">&lt;a id="ctl00_ctl31" href="http://ox-d.101m3.com/w/1.0/rc?cs=4f2320f8e860a&amp;cb=INSERT_RANDOM_NUMBER_HERE" onclick="javascript:Track('ctl00_ctl30|ctl00_ctl31',this);"&gt;&lt;img alt="" border="0" src="http://ox-d.101m3.com/w/1.0/ai?auid=139282&amp;amp;cs=4f2320f8e860a&amp;amp;cb=INSERT_RANDOM_NUMBER_HERE" /&gt;&lt;/a&gt;</iframe></div></div>
	</div>
</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="Clearbottom"> </div>
                        <div class="bottomleftcorner"> </div>
                        <div class="bottomrightcorner"> </div>
                        <div id="Footer">
                            

<div class="FooterLinks">
    <div id="ctl00_Footer1_SiteLinks">

</div>
    <span id="ctl00_Footer1_Copyright" title="© 2014  Microsoft. All rights reserved." class="FooterCopyright">© 2014  Microsoft. All rights reserved.</span>
    <a id="ctl00_Footer1_Terms" title="Terms of Use" href="http://msdn.microsoft.com/cc300389.aspx">Terms of Use</a>
    <span class="Pipe">|</span>
    <a id="ctl00_Footer1_Trademarks" title="Trademarks" href="http://www.microsoft.com/library/toolbar/3.0/trademarks/en-us.mspx">Trademarks</a>
    <span class="Pipe">|</span>
    <a id="ctl00_Footer1_PrivacyStatement" title="Privacy Statement" href="http://www.microsoft.com/info/privacy.mspx">Privacy Statement</a>
    <span id="ctl00_Footer1_PipeSpan3" class="Pipe">|</span>
    <a id="ctl00_Footer1_Feedback" title="Site Feedback" rel="sitefeedback" targeturl="https://lab.msdn.microsoft.com/mailform/contactus.aspx?refurl=http://msdn.microsoft.com/en-us/magazine/cc947917.aspx&amp;loc=en-us" href="https://lab.msdn.microsoft.com/mailform/contactus.aspx?refurl=http://msdn.microsoft.com/en-us/magazine/cc947917.aspx&loc=en-us" target="_blank">Site Feedback</a>
</div>

                        </div>
                    
                </div>
            </div>
        </div>
    </div>
    <div style="display:none"><img src="./Patterns in Practice  Cohesion And Coupling_files/trans_pixel.asp" width="0" height="0" hspace="0" vspace="0" border="0" alt="Page view tracker"></div>
    
<script src="./Patterns in Practice  Cohesion And Coupling_files/webtrendsscript-bn1651.js" type="text/javascript"></script>
<noscript>
&lt;div&gt;&lt;img alt="DCSIMG" id="Img1" width="1" height="1" src="http://m.webtrends.com/dcsmgru7m99k7mqmgrhudo0k8_8c6m/njs.gif?dcsuri=/nojavascript&amp;amp;WT.js=No" /&gt;&lt;/div&gt;
</noscript>
    <script type="text/javascript" src="./Patterns in Practice  Cohesion And Coupling_files/mtps-bn1651.js"></script>
    

<script type="text/javascript">
//<![CDATA[
 RegisterAutoSubmit('ctl00_tb1_Flyout_Rating1','ctl00_tb1_Flyout_btnSend','contentRatingcc947917MSDN.10en-us');

//]]>
</script>
</form>


<script language="javascript" type="text/javascript" src="./Patterns in Practice  Cohesion And Coupling_files/broker.js"></script>

<script src="./Patterns in Practice  Cohesion And Coupling_files/broker-config.js"></script><iframe frameborder="0" scrolling="no" style="border: 0px; display: none; background-color: transparent;"></iframe><div id="GOOGLE_INPUT_CHEXT_FLAG" input="null" input_stat="{&quot;tlang&quot;:true,&quot;tsbc&quot;:true,&quot;pun&quot;:true,&quot;mk&quot;:false,&quot;ss&quot;:true}" style="display: none;"></div><div id="html-validator-loading"><img src="chrome-extension://cgndfbhngibokieehnjhbjkkhbfmhojo/images/loading.gif">Validating...</div><div id="html-validator-message"><span id="html-validation-message-close">X</span><div id="html-validator-message-content"></div></div><form id="gclp-frame-form" target="gclp-frame" method="post" style="display: none;"></form><div class="gclp-code-grabber" data-gclp-id="0" data-hasqtip="true" style="left: 1069.5px; top: 974px; display: none;"></div><div class="gclp-code-grabber" data-gclp-id="1" data-hasqtip="true" style="left: 1069.5px; top: 2752px; display: none;"></div><div class="gclp-code-grabber" data-gclp-id="2" data-hasqtip="true" style="left: 1069.5px; top: 2951px; display: none;"></div><div class="gclp-code-grabber" data-gclp-id="3" data-hasqtip="true" style="left: 1069.5px; top: 3471px; display: none;"></div><div class="gclp-code-grabber" data-gclp-id="4" data-hasqtip="true" style="left: 1069.5px; top: 3793px; display: none;"></div><div class="gclp-code-grabber" data-gclp-id="5" data-hasqtip="true" style="left: 1069.5px; top: 4379px; display: none;"></div><div class="gclp-code-grabber" data-gclp-id="6" data-hasqtip="true" style="left: 1069.5px; top: 4756px; display: none;"></div><div class="gclp-code-grabber" data-gclp-id="7" data-hasqtip="true" style="left: 1069.5px; top: 5750px; display: none;"></div><div class="gclp-code-grabber" data-gclp-id="8" data-hasqtip="true" style="left: 1069.5px; top: 5908px; display: none;"></div><div class="gclp-code-grabber" data-gclp-id="9" data-hasqtip="true" style="left: 1069.5px; top: 6050px; display: none;"></div><div class="gclp-code-grabber" data-gclp-id="10" data-hasqtip="true" style="left: 1069.5px; top: 6176px; display: none;"></div><div class="gclp-code-grabber" data-gclp-id="11" data-hasqtip="true" style="left: 1069.5px; top: 6302px; display: none;"></div><div id="_WEDCSInsertedData" style="display: none;"><iframe id="_msnFrame" src="./Patterns in Practice  Cohesion And Coupling_files/c.gif" style="z-index:-1;height:1px;width:1px;display:none;visibility:hidden;" onload="javascript:MscomBeacon();"></iframe></div></body></html>